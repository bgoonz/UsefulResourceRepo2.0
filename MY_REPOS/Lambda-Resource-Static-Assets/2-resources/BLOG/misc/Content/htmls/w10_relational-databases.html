<!DOCTYPE html><html><head>
      <title>w10_relational-databases</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\almyk\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.5.13\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header undefined" id="week-10brrelational-databases">WEEK 10<br><em>Relational Databases</em></h1>

<hr>
<p><a href="#make-it-pretty-learning-objectives"><strong>Make It Pretty Learning Objectives</strong></a></p>
<ul>
<li><a href="#make-it-pretty-practice"><strong>Make It Pretty Practice</strong></a>
<ul>
<li><a href="#what-recruiters-are-looking-for">What Recruiters Are Looking For</a></li>
<li><a href="#attributes-of-great-looking-websites">Attributes of Great Looking Websites</a></li>
<li><a href="#additional-requirements">Additional requirements</a></li>
<li><a href="#avoid-these-things">Avoid these things</a></li>
<li><a href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>
<p><a href="#rdbms-and-database-entity-learning-objectives"><strong>RDBMS And Database Entity Learning Objectives</strong></a></p>
<ul>
<li><a href="#database-lingobrthe-relational-database-management-system"><strong>Database Lingo: Relational Database Management System</strong></a>
<ul>
<li><a href="#rdbms">RDBMS</a></li>
<li><a href="#what-is-postgresql">What is PostgreSQL?</a></li>
<li><a href="#what-is-sql">What is SQL?</a></li>
</ul>
</li>
<li><a href="#installing-postgresql-12-and-postbird-on-windows"><strong>Installing PostgreSQL 12 and Postbird on Windows</strong></a></li>
<li><a href="#installing-postgresql-12-and-postbird-on-macos"><strong>Installing PostgreSQL 12 and Postbird on macOS</strong></a></li>
<li><a href="#user-management-walk-through"><strong>User Management Walk-Through</strong></a>
<ul>
<li><a href="#naming-a-user">Naming a user</a></li>
<li><a href="#creating-a-superuser">Creating a superuser</a></li>
<li><a href="#creating-a-limited-user">Creating a limited user</a></li>
<li><a href="#removing-a-user">Removing a user</a></li>
<li><a href="#case-sensitivity">Case sensitivity</a></li>
</ul>
</li>
<li><a href="#database-management-walk-through"><strong>Database Management Walk-Through</strong></a>
<ul>
<li><a href="#naming-a-database">Naming a database</a></li>
<li><a href="#creating-a-database-for-your-user">Creating a database for your user</a></li>
<li><a href="#creating-other-users-and-databases">Creating other users and databases</a></li>
<li><a href="#applying-security-to-databases">Applying security to databases</a></li>
<li><a href="#listing-databases-and-granting-privileges">Listing databases and granting privileges</a></li>
<li><a href="#time-to-clean-up">Time to clean up</a></li>
</ul>
</li>
<li><a href="#table-management-walk-through-part-i"><strong>Table Management Walk-Through - Part I</strong></a>
<ul>
<li><a href="#what-is-a-table">What is a table?</a></li>
<li><a href="#defining-tables">Defining tables</a></li>
<li><a href="#other-data-types">Other data types</a></li>
<li><a href="#naming-a-table">Naming a table</a></li>
<li><a href="#writing-the-sql">Writing the SQL</a></li>
<li><a href="#listing-tables-and-table-definitions">Listing tables and table definitions</a></li>
<li><a href="#deleting-a-table">Deleting a table</a></li>
</ul>
</li>
<li><a href="#table-management-walk-through-part-ii"><strong>Table Management Walk-Through - Part II</strong></a>
<ul>
<li><a href="#nullable-columns">Nullable columns</a></li>
<li><a href="#default-values">Default values</a></li>
<li><a href="#primary-keys">Primary keys</a></li>
<li><a href="#unique-values">Unique values</a></li>
<li><a href="#refactor-for-data-integrity">Refactor for data integrity</a></li>
<li><a href="#order-of-table-declarations">Order of table declarations</a></li>
</ul>
</li>
<li><a href="#database-management-project"><em>Database Management Project</em></a></li>
</ul>
<p><a href="#sql-learning-objectives"><strong>SQL Learning Objectives</strong></a></p>
<ul>
<li><a href="#retrieving-rows-from-a-table-using-select"><strong>Retrieving Rows From A Table Using SELECT</strong></a>
<ul>
<li><a href="#what-is-a-query">What is a query?</a></li>
<li><a href="#example-table">Example table</a></li>
<li><a href="#using-psql-in-the-terminal">Using psql in the terminal</a></li>
<li><a href="#simple-select-query">Simple SELECT Query</a></li>
<li><a href="#formatting-select-statements">Formatting SELECT statements</a></li>
</ul>
</li>
<li><a href="#selecting-table-rows-using-where-and-common-operators"><strong>Selecting Table Rows Using WHERE And Common Operators</strong></a>
<ul>
<li><a href="#using-select-and-where">Using SELECT and WHERE</a></li>
</ul>
</li>
<li><a href="#inserting-data-into-a-table"><strong>Inserting Data Into A Table</strong></a></li>
<li><a href="#foreign-keys-and-the-join-operation"><strong>Foreign Keys And The JOIN Operation</strong></a>
<ul>
<li><a href="#setting-up-the-database">Setting up the database</a></li>
<li><a href="#using-join-to-retrieve-rows-from-multiple-tables">Using JOIN to retrieve rows from multiple tables</a></li>
<li><a href="#helpful-links">Helpful links:</a></li>
</ul>
</li>
<li><a href="#writing-and-running-a-seed-file-in-psql"><strong>Writing And Running A Seed File In PSQL</strong></a>
<ul>
<li><a href="#creating-a-seed-file">Creating a seed file</a></li>
<li><a href="#populating-a-database-via-left-caret">Populating a database via &lt; (&#x201C;left caret&#x201D;)</a></li>
<li><a href="#populating-the-database-via-pipe">Populating the database via | (&#x201C;pipe&#x201D;)</a></li>
</ul>
</li>
<li><a href="#create-and-seed-a-database-project"><em>Create And Seed A Database Project</em></a></li>
<li><a href="#solving-the-sql-menagerie-project"><em>Solving The SQL Menagerie Project</em></a></li>
<li><a href="#creating-a-schema-for-relational-database-design"><strong>Creating A Schema For Relational Database Design</strong></a>
<ul>
<li><a href="#what-is-relational-database-design">What is Relational Database Design?</a></li>
<li><a href="#stages-of-relational-database-design">Stages of Relational Database Design</a></li>
<li><a href="#schema-design-tools">Schema design tools</a></li>
</ul>
</li>
<li><a href="#using-sql-transactions"><strong>Using SQL Transactions</strong></a>
<ul>
<li><a href="#what-is-a-transaction">What is a transaction?</a></li>
<li><a href="#implicit-vs-explicit-transactions">Implicit vs. explicit transactions</a></li>
<li><a href="#when-to-use-transactions-and-why">When to use transactions and why</a></li>
<li><a href="#transaction-properties-acid">Transaction properties: ACID</a></li>
<li><a href="#helpful-links-1">Helpful links:</a></li>
</ul>
</li>
<li><a href="#joins-vs-subqueries"><strong>Joins vs. Subqueries</strong></a>
<ul>
<li><a href="#what-is-a-join">What is a JOIN?</a></li>
<li><a href="#what-is-a-subquery">What is a subquery?</a></li>
<li><a href="#using-joins-vs-subqueries">Using joins vs. subqueries</a></li>
<li><a href="#helpful-links-2">Helpful links:</a></li>
</ul>
</li>
<li><a href="#postgresql-indexes"><strong>PostgreSQL Indexes</strong></a>
<ul>
<li><a href="#what-is-a-postgresql-index">What is a PostgreSQL index?</a></li>
<li><a href="#how-to-create-an-index">How to create an index</a></li>
<li><a href="#when-to-use-an-index">When to use an index</a></li>
</ul>
</li>
<li><a href="#node-postgres-and-prepared-statements"><strong>Node-Postgres And Prepared Statements</strong></a>
<ul>
<li><a href="#connecting">Connecting</a></li>
<li><a href="#prepared-statement">Prepared Statement</a></li>
<li><a href="#try-it-out-for-yourself">Try it out for yourself</a></li>
</ul>
</li>
<li><a href="#recipe-box-project"><em>Recipe Box Project</em></a></li>
</ul>
<p><a href="#orm-learning-objectives"><strong>ORM Learning Objectives</strong></a></p>
<ul>
<li><a href="#installing-and-using-sequelize"><strong>Installing And Using Sequelize</strong></a>
<ul>
<li><a href="#what-is-an-orm">What Is An ORM?</a></li>
<li><a href="#how-to-install-sequelize">How To Install Sequelize</a></li>
<li><a href="#how-to-initialize-sequelize">How To Initialize Sequelize</a></li>
<li><a href="#verifying-that-sequelize-can-connect-to-the-database">Verifying That Sequelize Can Connect To The Database</a></li>
<li><a href="#our-preexisting-database-schema">Our Preexisting Database Schema</a></li>
<li><a href="#using-sequelize-to-generate-the-model-file">Using Sequelize To Generate The Model File</a></li>
<li><a href="#examining-and-modifying-a-sequelize-model-file">Examining (And Modifying) A Sequelize Model File</a></li>
<li><a href="#using-the-cat-model-to-fetch-and-update-sql-data">Using The <code>Cat</code> Model To Fetch And Update SQL Data</a></li>
<li><a href="#reading-and-changing-record-attributes">Reading And Changing Record Attributes</a></li>
</ul>
</li>
<li><a href="#using-database-migrations"><strong>Using Database Migrations</strong></a>
<ul>
<li><a href="#sequelize-migration-files">Sequelize Migration Files</a></li>
<li><a href="#running-a-migration">Running A Migration</a></li>
<li><a href="#rolling-back-a-migration">Rolling Back A Migration</a></li>
<li><a href="#editing-a-migration-file">Editing A Migration File</a></li>
<li><a href="#up-and-down-are-asynchronous"><code>up</code> And <code>down</code> are Asynchronous</a></li>
<li><a href="#writing-a-down-method">Writing A <code>down</code> Method</a></li>
<li><a href="#advantages-of-migrations">Advantages Of Migrations</a></li>
</ul>
</li>
<li><a href="#crud-operations-using-sequelize"><strong>CRUD Operations Using Sequelize</strong></a>
<ul>
<li><a href="#creating-a-new-record">Creating A New Record</a></li>
<li><a href="#reading-a-record-by-primary-key">Reading A Record By Primary Key</a></li>
<li><a href="#updating-a-record">Updating A Record</a></li>
<li><a href="#destroying-a-record">Destroying A Record</a></li>
<li><a href="#class-methods-for-crud">Class Methods For CRUD</a></li>
</ul>
</li>
<li><a href="#querying-using-sequelize"><strong>Querying Using Sequelize</strong></a>
<ul>
<li><a href="#basic-usage-of-findall-to-retrieve-multiple-records">Basic Usage Of <code>findAll</code> To Retrieve Multiple Records</a></li>
<li><a href="#using-findall-to-find-objects-not-matching-a-criterion">Using <code>findAll</code> To Find Objects Not Matching A Criterion</a></li>
<li><a href="#combining-criteria-with-opand">Combining Criteria with <code>Op.and</code></a></li>
<li><a href="#combining-criteria-with-opor">Combining Criteria with <code>Op.or</code></a></li>
<li><a href="#querying-with-comparisons">Querying With Comparisons</a></li>
<li><a href="#ordering-results">Ordering Results</a></li>
<li><a href="#limiting-results-and-findone">Limiting Results and <code>findOne</code></a></li>
</ul>
</li>
<li><a href="#model-validations-with-sequelize"><strong>Model Validations With Sequelize</strong></a>
<ul>
<li><a href="#validating-that-an-attribute-is-not-null">Validating That An Attribute Is Not <code>NULL</code></a></li>
<li><a href="#the-notempty-validation">The <code>notEmpty</code> Validation</a></li>
<li><a href="#forbidding-long-string-values">Forbidding Long String Values</a></li>
<li><a href="#validating-that-a-numeric-value-is-within-a-specified-range">Validating That A Numeric Value Is Within A Specified Range</a></li>
<li><a href="#validating-that-an-attribute-is-among-a-finite-set-of-values">Validating That An Attribute Is Among A Finite Set Of Values</a></li>
</ul>
</li>
<li><a href="#transactions-with-sequelize"><strong>Transactions With Sequelize</strong></a>
<ul>
<li><a href="#the-problem-database-updates-can-fail">The Problem: Database Updates Can Fail</a></li>
<li><a href="#the-solution-database-transactions">The Solution: Database Transactions</a></li>
<li><a href="#the-bankaccounts-schema">The <code>BankAccounts</code> Schema</a></li>
<li><a href="#example-an-update-fails-because-of-validation-failure">Example: An Update Fails Because Of Validation Failure</a></li>
<li><a href="#incorrect-solutions">Incorrect Solutions</a></li>
<li><a href="#using-a-database-transaction-with-sequelize">Using A Database Transaction With Sequelize</a></li>
<li><a href="#aside-what-is-the-transaction-object">Aside: What Is The <code>Transaction</code> Object?</a></li>
<li><a href="#transactions-prevent-_race-conditions_">Transactions Prevent <em>Race Conditions</em></a></li>
</ul>
</li>
<li><a href="#recipe-box-with-sequelize-project"><em>Recipe Box With Sequelize Project</em></a></li>
</ul>
<hr>
<h1 class="mume-header undefined" id="week-10-day-1brhello-database">WEEK-10 DAY-1<br><em>Hello, Database!</em></h1>

<hr>
<h1 class="mume-header" id="make-it-pretty-learning-objectives">Make It Pretty Learning Objectives</h1>

<p>It is really important that you make the best impression that you can with the<br>
projects that you will soon start. To that end, the objectives for your learning<br>
with this section should allow you to</p>
<ul>
<li>Recall the items recruiters are most interested</li>
<li>Explain the aspects of good looking Web application</li>
<li>Identify App Academy&apos;s expectations of your projects for after you graduate</li>
<li>Practice good code hygiene when making projects live</li>
</ul>
<hr>
<h1 class="mume-header" id="make-it-pretty-practice">Make It Pretty Practice</h1>

<p>Your portfolio projects are the first impression that a company has of you.<br>
Imagine you are a non-technical person looking to hire a developer to build your<br>
website. What would you think if you reviewed a site that looked unfinished, or<br>
poorly styled, even if the functionality worked perfectly? Would you have the<br>
perspective to tell the difference from a poorly implemented site and one that<br>
is robust, but not visually polished?</p>
<p>Non-technical people will be looking at your projects before engineers, and they<br>
can&apos;t see the amount of work it takes to get a backend up and running. All they<br>
see is the visual appearance, so unless you take care of your frontend you&apos;ll<br>
never even get the chance to talk about the backend work you did.</p>
<p>This material should make it so that you can</p>
<ul>
<li>Evaluate your site against industry-standard visual styles</li>
<li>Identify the attributes of current trends in website presentation</li>
<li>Identify gaps that can cause a website to be perceived as incomplete</li>
</ul>
<h2 class="mume-header" id="what-recruiters-are-looking-for">What Recruiters Are Looking For</h2>

<p>Recruiters expect professionalism and good design (we&apos;ll discuss more about what<br>
good design means below). A good litmus test is: if you were to stumble upon<br>
your portfolio sight unexpectedly, would you be able to tell that this wasn&apos;t<br>
done by a professional dev? In other words, does your website look on par with<br>
the millions of other production sites that exist on the internet?</p>
<p>In response to what recruiters and interviewers might ask about how you choose<br>
different styles for your Web applications, review TopTal&apos;s <a href="https://www.toptal.com/designers/web/interview-questions">12 Essential Web<br>
Interview Questions</a>.</p>
<h2 class="mume-header" id="attributes-of-great-looking-websites">Attributes of Great Looking Websites</h2>

<p>Unless you know exactly what you are doing when deciding on a visual approach,<br>
you should select and follow a modern design framework, or use a template.</p>
<p>The first thing to pay attention to is padding and margin. Every element should<br>
have padding so that its inner contents are not butting up against its edges and<br>
margin so that the element itself is not butting up against any other elements.<br>
In general sibling elements should NOT touch or overlap.  A good way to estimate<br>
the correct amount is to imagine a lower-case <code>a</code> in the same size and font of<br>
nearby text.  You should be able to fit this <code>a</code> in both the padding and the<br>
margin such that it just barely touches the edge/text on each side.</p>
<p>Be sure to balance whitespace when laying out your elements and adding<br>
margin/padding. If you have 20px of whitespace to the left of the element you<br>
should probably have 20px to the right as well. Make sure things are centered<br>
correctly (horizontally and vertically) and be consistent! I.E. If you have a<br>
row of buttons in the header they should all be aligned vertically with<br>
consistent margin and padding.</p>
<p>Use a <a href="https://99designs.com/blog/tips/the-7-step-guide-to-understanding-color-theory/">color palette</a> to determine your website&apos;s themes and avoid color<br>
clashes. You should have a primary color, a secondary color, and 1 or 2 accent<br>
colors. Your primary color is going to be the most abundant on the site followed<br>
by your secondary color. The accent color is used for things like buttons,<br>
tools, and other areas that you want to draw the user&apos;s eye to.  Use it<br>
sparingly!</p>
<p>Use <a href="https://fonts.google.com/">Google Font Pairing</a> recommendations to find good fonts. In general, you<br>
should not have more than 2 fonts in a web app and you should avoid mixing serif<br>
and sans-serif fonts.</p>
<p>Pay attention to font-size and weight! You should use <a href="https://blog.designcrowd.com/article/867/understanding-the-hierarchy-of-text">textual hierarchies</a> to<br>
break up your text and make it easier to read. Prefer multiple short lines to<br>
fewer long lines of text when displaying info to the user. Your headers should<br>
be large and paragraphs should be slightly smaller font size. Having widely<br>
varying and inconsistent font sizes is one of the surest signs that a website<br>
was designed by a beginner.  When in doubt, simplify.</p>
<p>Make sure your color and text choices pass <a href="https://webaim.org/resources/contrastchecker/">contrast requirements</a>.</p>
<p>Most modern websites slightly round the corners of buttons and background<br>
cards/modals. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/border-radius">You should, too</a>. Also, take advantage of advanced CSS features<br>
like transitions and shadows to make your site pop. Make sure you let your user<br>
know what parts of the site are alive through affordances.</p>
<h2 class="mume-header" id="additional-requirements">Additional requirements</h2>

<p>In addition to the above recommendations, App Academy also expects your projects<br>
to include the following:</p>
<ul>
<li><strong>Seed Data</strong>: Make sure your seeds are plentiful and appropriate. Even an<br>
excellently designed site will fail to impress if you don&apos;t have a good seed<br>
data.</li>
<li><strong>Favicon</strong>: Make sure your website has a <a href="https://www.abeautifulsite.net/what-are-favicons">favicon</a>.</li>
<li><strong>Demo Login</strong>: Make sure your website has a demo login. Most recruiters will<br>
not sign up for your website with their own email address as the chance for<br>
misuse of said email address is too high.</li>
<li><strong>Console output</strong>: Be sure that your console is free of logs and error<br>
messages. Nothing screams amateur more than seeing a ton of console.logs when<br>
visiting a potential candidate&apos;s website.</li>
<li><strong>Personal Links</strong>: Any links to your GitHub, LinkedIn, or Angel List should<br>
open in a new tab.</li>
<li><strong>Scorecard</strong>: After you graduate, you&apos;ll stop using Progress Tracker and<br>
start using InterviewDB, another one of our applications. When you go to turn<br>
in your project on InterviewDB, be sure to include the scorecard so that your<br>
advisor can grade your work. Note that you&apos;ll need to make your own copy and<br>
save it to your google drive before adding the link to InterviewDB.</li>
</ul>
<h2 class="mume-header" id="avoid-these-things">Avoid these things</h2>

<p>We have collected a lot of feedback from recruiters and hiring managers over the<br>
years. These are the tips and tricks that they tell us will turn them off to<br>
reviewing a student&apos;s project.</p>
<ul>
<li>Avoid fonts that look like handwriting</li>
<li>Avoid over using accent colors</li>
<li>Avoid themes that relate to specific holidays (ie. don&apos;t make a Christmas<br>
themed app)</li>
<li>Dead Links. If you didn&apos;t implement a feature then don&apos;t put a link to it. If<br>
you do, then you&apos;re forcing recruiters to find the needle of implemented<br>
features in a haystack of unimplemented features.  Your site will be perceived<br>
as incomplete or broken</li>
<li>Avoid linking to the actual site that you are cloning</li>
<li>Avoid neon, bright, or crazy colors</li>
<li>Avoid having too many different colors in your app.</li>
<li>Avoid putting affordances on things that can&apos;t be clicked or interacted with</li>
<li>Avoid blinking, spinning or flashing images</li>
<li>Avoid busy tiled background images with any color text</li>
<li>Avoid having everything centered.  When in doubt, do not center.  Do not<br>
center more than three lines of text</li>
<li>Avoid too many images or huge images.  Minify all images that are not of a<br>
product and do not need to be examined closely</li>
<li>Avoid long lists of links</li>
<li>Avoid too many headlines</li>
<li>Do not use blinking or flashing text, images, or transitions</li>
</ul>
<h2 class="mume-header" id="exercise">Exercise</h2>

<p>Select three sites from <a href="https://www.producthunt.com/">Product Hunt</a>.  For each site, list the:</p>
<ul>
<li>Fonts Used</li>
<li>Colors in Palette</li>
<li>Contrast ratio of the main text and it&apos;s background (<a href="https://webaim.org/resources/contrastchecker/">Use the contrast<br>
checker</a>)</li>
<li>The size of padding/margins compared to a lowercase &apos;a&apos;</li>
<li>The maximum number of lines in a row center-justified anywhere on the site</li>
<li>Load Time</li>
<li>Theme or style based on (Bootstrap, Material, etc.)</li>
<li>Number of broken or under construction pages</li>
</ul>
<hr>
<h1 class="mume-header" id="rdbms-and-database-entity-learning-objectives">RDBMS And Database Entity Learning Objectives</h1>

<p>Databases are an essential part of many Web applications. There are lots of<br>
things we could store in a database and use in a Web app, including user<br>
information, product information, review information, and more. Learning how to<br>
create databases and retrieve information stored in a database to display in a<br>
Web app is a foundational development skill.</p>
<p>In this section, you will be able to:</p>
<ul>
<li>Define what a relational database management system is</li>
<li>Describe what relational data is</li>
<li>Define what a database is</li>
<li>Define what a database table is</li>
<li>Describe the purpose of a primary key</li>
<li>Describe the purpose of a foreign key</li>
<li>Describe how to properly name things in PostgreSQL</li>
<li>Install and configure PostgreSQL 12, its client tools, and a GUI client for it<br>
named Postbird</li>
<li>Connect to an instance of PostgreSQL with the command line tool <code>psql</code></li>
<li>Identify whether a user is a normal user or a superuser by the prompt in the<br>
<code>psql</code> shell</li>
<li>Create a user for the relational database management system</li>
<li>Create a database in the database management system</li>
<li>Configure a database so that only the owner (and superusers) can connect to<br>
it</li>
<li>View a list of databases in an installation of PostgreSQL</li>
<li>Create tables in a database</li>
<li>View a list of tables in a database</li>
<li>Identify and describe the common data types used in PostgreSQL</li>
<li>Describe the purpose of the UNIQUE and NOT NULL constraints, and create<br>
columns in database tables that have them</li>
<li>Create a primary key for a table</li>
<li>Create foreign key constraints to relate tables</li>
<li>Explain that SQL is not case sensitive for its keywords but is for its entity<br>
names</li>
</ul>
<hr>
<h1 class="mume-header" id="database-lingobrthe-relational-database-management-system">Database Lingo<br><em>The Relational Database Management System</em></h1>

<p>Databases are an essential part of many Web applications. There are lots of<br>
things we could store in a database and use in a Web app, including user<br>
information, product information, review information, and more. Learning how to<br>
create databases and retrieve information stored in a database to display in a<br>
Web app is a foundational development skill.</p>
<p>The most popular kind of database is called a <em>relational database</em>. That&apos;s what<br>
you&apos;ll primarily use in this course. There are other databases called &quot;document<br>
databases&quot;, &quot;non-relational databases&quot;, or &quot;NoSQL databases&quot; that have become<br>
popular since the mid-2000s. They serve a different purpose that relational<br>
databases by storing data in ways that are different than the way relational<br>
databases store their data.</p>
<p>In this reading, you will learn about <strong>relational database management<br>
systems</strong>. Then, you will install one. Then, you will start using it!</p>
<h2 class="mume-header" id="rdbms">RDBMS</h2>

<p>That&apos;s quite an ugly acronym, but it&apos;s what developers have when referring to<br>
the software application that manages databases for us. Here&apos;s an important<br>
difference for you to understand.</p>
<p>The <strong>RDBMS</strong> is a software application that you run that your programs can<br>
connect to that they can store, modify, and retrieve data. The RDBS that you<br>
will use in this course is called <a href="https://www.postgresql.org/">PostgreSQL</a>, often shortened to just<br>
&quot;postgres&quot;, pronounced like it&apos;s spelled. It is an &quot;open-source&quot; RDBMS which<br>
means that you can go read the source code for it, copy it, modify it, and make<br>
your own specialized version of an RDBMS. Often, developers will talk about the<br>
&quot;database server&quot;. That is the computer on which the RDBMS is running.</p>
<p>A <strong>database</strong> (or more properly <strong>relational database</strong>) is a collection of<br>
structured data that the RDBMS manages for you. A single running RDBMS can have<br>
hundreds of databases in it that it manages.</p>
<p>Software developers will often use the term &quot;database&quot; to refer to the RDBMS.<br>
They will also say that &quot;the data is in postgres&quot; or &quot;the data is in Oracle&quot;<br>
which is terribly ambiguous because those are the names of the RDBMSes, not a<br>
database where the data is stored. That&apos;d be like asking someone their address<br>
and them replying &quot;Chicago&quot;.</p>
<p>Just be aware that the language around these terms is loose.</p>
<h2 class="mume-header" id="what-is-postgresql">What is PostgreSQL?</h2>

<p>Again, PostgreSQL is software. Specifically, it is an open-source, relational<br>
database management system. It is derived from the POSTGRES package written at<br>
UC Berkeley. The specific name &#x201C;PostgreSQL&#x201D; was coined in 1996, after SQL was<br>
implemented as its core query language. PostgreSQL provided a new program (new<br>
for 1996) for interactive SQL queries called <code>[psql]</code>, which is terminal-based<br>
front-end to PostgreSQL that lets you to type in queries interactively, issue<br>
them to PostgreSQL, and see the query results.</p>
<p>You install PostgreSQL onto a computer. It then runs as a &quot;service&quot;, that is, a<br>
program that runs in the background that should not stop until the machine does.<br>
You will install it on your computer. It will quietly run in the background,<br>
eagerly awaiting for you to connect to it and interact with it from the command<br>
line, from a GUI tool, or from your application.</p>
<p>When you do connect with it, you will interact with it through a small set of<br>
its own commands and SQL.</p>
<h2 class="mume-header" id="what-is-sql">What is SQL?</h2>

<p>SQL (pronounced &quot;sequel&quot; or &quot;s-q-l&quot;) stands for &quot;Structured Query Language&quot;. It<br>
is not a programming language like JavaScript. JavaScript, as you well know, has<br>
<em>control flow</em>, with <code>for</code> loops and <code>if</code> statements. Most SQL that you write<br>
doesn&apos;t have all that. Instead, it is a <em>declarative</em> programming language. You<br>
tell the database what computation you want it to do, and it does it. In that<br>
way, SQL is more like CSS than JavaScript.</p>
<p>Whereas JavaScript works on variables and arrays of single values, most SQL<br>
works on <em>sets</em> of records. You&apos;ll see more what that means later, but just know<br>
that in the SQL that you learn, you won&apos;t declare a single variable in that SQL.</p>
<p>SQL, the language, is the primary way that you will interact with the RDBMS to<br>
affect the data in a single database or the structure of the database itself.<br>
The process of using SQL takes two steps:</p>
<ol>
<li>Connect to an RDBMS specifying
<ul>
<li>credentials, user name and password</li>
<li>the name of the database that you want to use</li>
</ul>
</li>
<li>Issue one or more SQL statements to interact with
<ul>
<li>the structure of the database</li>
<li>the data in the database</li>
</ul>
</li>
</ol>
<p>Some vendor-specific variants of SQL <em>do</em> have loops and if-statements. However,<br>
you will be learning the general kind of SQL, the one managed by the American<br>
National Standards Institute, called ANSI SQL which defines the way that we get<br>
data out of, put data into, modify data in, and remove data from a database.<br>
This type of SQL is <em>portable</em> between different types of database management<br>
systems. That means most of what you learn in this course, you will be able to<br>
use on <em>any</em> relational database management system that supports ANSI SQL,<br>
RDBMSes such as</p>
<ul>
<li><strong>Informix</strong>, a commercial RDBMS from IBM intended to run on servers and<br>
mainframes</li>
<li><strong>Microsoft Access</strong>, a commercial RDBMS from Microsoft intended for personal<br>
use</li>
<li><strong>Microsoft SQL Server</strong>, a commercial RDBMS from Microsoft intended to run on<br>
servers</li>
<li><strong>MySQL</strong>, an open-source RDBMS comparable to PostgreSQL</li>
<li><strong>Oracle DB</strong>, a commercial RDBMS from Microsoft intended to run on servers</li>
<li><strong>SQLite</strong>, an open-source RDBMS that many applications <em>embed</em> into the<br>
program to efficiently store the application&apos;s data relational data</li>
</ul>
<p>Now that this preamble is out of the way, the next step is to install<br>
PostgreSQL!</p>
<h2 class="mume-header" id="what-we-learned">What we learned:</h2>

<p>In this article you learned that</p>
<ul>
<li>A <em>relational database management</em> system is software that usually runs as a<br>
service that manages collections of structured data called databases.</li>
<li>PostgreSQL is one of many relational database management systems and the one<br>
that you will mostly use in this course</li>
<li>A <em>database</em> is a collection of structured data that an RDBMS manages for you.</li>
<li>The Structured Query Language (SQL) is a programming language that allows you<br>
to interact with the structure of the database and the actual data that&apos;s<br>
stored in it.</li>
</ul>
<hr>
<h1 class="mume-header" id="installing-postgresql-12-and-postbird-on-windows">Installing PostgreSQL 12 and Postbird on Windows</h1>

<p>You will install three pieces of software so that you can start using<br>
PostgreSQL. You will install PostgreSQL itself on your Windows installation.<br>
Then, you will install <code>psql</code> in your Ubuntu installation. Then you will also<br>
install Postbird, a cross-platform graphical user interface that makes working<br>
with SQL and PostgreSQL better than just using the command line tool <code>psql</code>.</p>
<p>When you read &quot;installation&quot;, that means the actual OS that&apos;s running on your<br>
machine. So, you have a Windows installation, Windows 10, that&apos;s running when<br>
you boot your computer. Then, when you start the Ubuntu installation, it&apos;s as if<br>
there&apos;s a completely separate computer running inside your computer. It&apos;s like<br>
having two completely different laptops.</p>
<h2 class="mume-header" id="installing-postgresql-12">Installing PostgreSQL 12</h2>

<p>To install PostgreSQL 12, you need to download the installer from the Internet.<br>
PostgreSQL&apos;s commercial company, Enterprise DB, offers installers for PostgreSQL<br>
for every major platform.</p>
<p>Open <a href="https://www.enterprisedb.com/downloads/postgres-postgresql-downloads">https://www.enterprisedb.com/downloads/postgres-postgresql-downloads</a>. Click<br>
the link for PostgreSQL 12 for Windows x86-64.</p>
<p><img src="images/download-postgresql.png" alt="Download PostgreSQL"></p>
<p>Once that installer downloads, run it. You need to go through the normal steps<br>
of installing software.</p>
<ul>
<li>
<p>Yes, Windows, let the installer make changes to <em>my</em> device.</p>
</li>
<li>
<p>Thanks for the welcome. Next.</p>
</li>
<li>
<p>Yeah, that&apos;s a good place to install it. Next.</p>
</li>
<li>
<p>I don&apos;t want that pgAdmin nor the Stack Builder things. Uncheck. Uncheck.<br>
Next.</p>
<p><img src="images/postgresql-installation-uncheck-components.png" alt="Deselect pgAdmin 4 and Stack Builder components"></p>
</li>
<li>
<p>Also, great looking directory. Thanks. Next.</p>
</li>
<li>
<p>Oooh! A password! I&apos;ll enter ********. I sure won&apos;t forget that because, if I<br>
do, I&apos;ll have to uninstall and reinstall PostgreSQL and lose all of my hard<br>
work. <strong>Seriously, write down this password or use one you will not forget.</strong><br>
Next.</p>
</li>
<li>
<p>Sure. 5432. Good to go. Next.</p>
</li>
<li>
<p>Not even sure what that means. Default! Next.</p>
</li>
<li>
<p>Yep. Looks good. Next.</p>
</li>
<li>
<p>Geez. Really? Thanks. Next.</p>
</li>
<li>
<p><em>Time to get a tea.</em></p>
</li>
<li>
<p>All right! All done. Finish!</p>
</li>
</ul>
<h2 class="mume-header" id="installing-postgresql-client-tools-on-ubuntu">Installing PostgreSQL Client Tools on Ubuntu</h2>

<p>Now, to install the PostgreSQL Client tools for Ubuntu. You need to do this so<br>
that the Node.js (and later Python) programs running on your Ubuntu installation<br>
can access the PostgreSQL server running on your Windows installation. You need<br>
to tell <code>apt</code>, the package manager, that you want it to go find the PostgreSQL<br>
12 client tools from PostgreSQL itself rather than the common package<br>
repositories. You do that by issuing the following two commands. Copy and paste<br>
them one at a time into your shell. (If your Ubuntu shell isn&apos;t running, start<br>
one.)</p>
<p><strong>Pro-tip</strong>: Copy those commands because you&apos;re not going to type them, right?<br>
After you copy one of them, you can just right-click on the Ubuntu shell. That<br>
should paste them in there for you.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">wget</span> --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc <span class="token operator">|</span> <span class="token function">sudo</span> apt-key add -
</pre><p>If prompted for your password, type it.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token keyword">echo</span> <span class="token string">&quot;deb http://apt.postgresql.org/pub/repos/apt/ <span class="token variable"><span class="token variable">`</span>lsb_release -cs<span class="token variable">`</span></span>-pgdg main&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span>  /etc/apt/sources.list.d/pgdg.list
</pre><p>The last line of output of those two commands running should read &quot;OK&quot;. If it<br>
does not, try copying and pasting them one at a time.</p>
<p>Now that you&apos;ve registered the PostgreSQL repositories as a source to look for<br>
PostgreSQL, you need to update the <code>apt</code> registry. You should do this before you<br>
install <em>any</em> software on Ubuntu.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> update
</pre><p>Once that&apos;s finished running, the new entries for PostgreSQL 12 should be in the<br>
repository. Now, you can install them with the following command.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> postgresql-client-12 postgresql-common
</pre><p>If it asks you if you want to install them, please tell it &quot;Y&quot;.</p>
<p>Test that it installed by typing <code>psql --version</code>. You should see it print out<br>
information about the version of the installed tools. If it tells you that it<br>
can&apos;t find the command, try these instructions over.</p>
<h2 class="mume-header" id="configuring-the-client-tools">Configuring the client tools</h2>

<p>Since you&apos;re going to be accessing the PosgreSQL installation from your Ubuntu<br>
installation on your Windows installation, you&apos;re going to have to type that<br>
you want to access it over and over, which means extra typing. To prevent you<br>
from having to do this, you can customize your shell to always add the extra<br>
commands for you.</p>
<p>This assumes you&apos;re still using Bash. If you changed the shell that your Ubuntu<br>
installation uses, please follow that shell&apos;s directions for adding an alias to<br>
its startup file.</p>
<p>Make sure you&apos;re in your Ubuntu home directory. You can do that by typing <code>cd</code><br>
and hitting enter. Use <code>ls</code> to find out if you have a <code>.bashrc</code> file. Type<br>
<code>ls .bashrc</code>. If it shows you that one exists, that&apos;s the one you will add<br>
the alias to. If it tells you that there is no file named that, then type <code>ls .profile</code>. If it shows you that one exists, that&apos;s the one you will add the<br>
alias to. If it shows you that it does not exist, then use the file name<br>
<code>.bashrc</code> in the following section.</p>
<p>Now that you know which profile file to use, type <code>code &#xAB;profile file name&#xBB;</code><br>
where &quot;profile file name&quot; is the name of the file you determined from the last<br>
section. Once Visual Studio Code starts up with your file, at the end of it (or<br>
if you&apos;ve already added aliases, in that section), type the following.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">alias</span> psql<span class="token operator">=</span><span class="token string">&quot;psql -h localhost&quot;</span>
</pre><p>When you run <code>psql</code> from the command line, it will now always add the part about<br>
wanting to connect to <em>localhost</em> every time. You would have to type that each<br>
time, otherwise.</p>
<p>To make sure that you set that up correctly, type <code>psql -U postgres postgres</code>.<br>
This tells the <code>psql</code> client that you want to connect as the user &quot;postgres&quot;<br>
(<code>-U postgres</code>) to the database postgres (<code>postgres</code> at the end), which is the<br>
default database created when PostgreSQL is installed. It will prompt you for a<br>
password. Type the password that you used when you installed PostgrSQL, earlier.<br>
If the alias works correctly and you type the correct password, then you should<br>
see something like the following output.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql <span class="token punctuation">(</span>12.2 <span class="token punctuation">(</span>Ubuntu 12.2-2.pgdg18.04+1<span class="token punctuation">))</span>
Type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> help.

postgres<span class="token operator">=</span><span class="token comment">#</span>
</pre><p>Type <code>\q</code> and hit Enter to exit the PostgreSQL client tool.</p>
<p>Now, you will add a user for your Ubuntu identity so that you don&apos;t have to<br>
specify it all the time. Then, you will create a file that PostgreSQL will use<br>
to automatically send your password every time.</p>
<p>Copy and paste the following into your Ubuntu shell. Think of a password that<br>
you want to use for your user. <strong>Replace the password in the single quotes in the<br>
command with the password that you want.</strong> It <em>has</em> to be a non-empty string.<br>
PostgreSQL doesn&apos;t like it when it&apos;s not.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql -U postgres -c <span class="token string">&quot;CREATE USER <span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span> WITH PASSWORD &apos;password&apos; SUPERUSER&quot;</span>
</pre><p>It should prompt you for a password. Type the password that you created when you<br>
installed PostgreSQL. Once you type the correct password, you should see &quot;CREATE<br>
ROLE&quot;.</p>
<p>Now you will create your PostgreSQL password file. Type the following into your<br>
Ubuntu shell to open Visual Studio Code and create a new file.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">code ~/.pgpass
</pre><p>In that file, you will add this line, which tells it that on localhost for port<br>
5432 (where PostgreSQL is running), for all databases (*), <strong>use your Ubuntu user<br>
name and the password that you just created for that user with the <code>psql</code><br>
command you just typed.</strong> (If you have forgotten your Ubuntu user name, type<br>
<code>whoami</code> on the command line.) Your entry in the file should have this format.</p>
<pre data-role="codeBlock" data-info class="language-"><code>localhost:5432:*:&#xAB;your Ubuntu user name&#xBB;:&#xAB;the password you just used&#xBB;
</code></pre><p>For the curriculum writers&apos; systems, it looks like this in Visual Studio Code.</p>
<p><img src="images/windows-pgpass-configuration.png" alt="pgpass file"></p>
<p>Once you have that information in the file, save it, and close Visual Studio<br>
Code.</p>
<p>The last step you have to take is change the permission on that file so that it<br>
is only readable by your user. PostgreSQL will ignore it if just anyone can read<br>
and write to it. This is for <em>your</em> security. Change the file permissions so<br>
only you can read and write to it. You did this once upon a time. Here&apos;s the<br>
command.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">chmod</span> go-rw ~/.pgpass
</pre><p>You can confirm that only you have read/write permission by typing <code>ls -al ~/.pgpass</code>. That should return output that looks like this, <strong>with your Ubuntu<br>
user name instead of &quot;appacademy&quot;.</strong></p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">-rw------- 1 appacademy appacademy 37 Mar 28 21:20 /home/appacademy/.pgpass
</pre><p>Now, try connecting to PostreSQL by typing <code>psql postgres</code>. Because you added<br>
the alias to your startup script, and because you created your <strong>.pgpass</strong> file,<br>
it should now connect without prompting you for any credentials! Type <code>\q</code> and<br>
press Enter to exit the PostgreSQL command line client.</p>
<h2 class="mume-header" id="installing-postbird">Installing Postbird</h2>

<p>Head over to the <a href="https://github.com/Paxa/postbird/releases">Postbird releases page on GitHub</a>. Click the installer for<br>
Windows which you can recognize because it&apos;s the only file in the list that ends<br>
with &quot;.exe&quot;.</p>
<p><img src="images/download-postbird.png" alt="Download Postbird"></p>
<p>After that installer downloads, run it. You will get a warning from Windows that<br>
this is from an unidentified developer. If you don&apos;t want to install this, find<br>
a PostgreSQL GUI client that you do trust and install it or do everything from<br>
the command line.</p>
<p><img src="images/postbird-installation-warning.png" alt="Postbird installation warning"></p>
<p>You should get used to seeing this because many open-source applications aren&apos;t<br>
signed with the Microsoft Store for monetary and philosophical reasons.</p>
<p>Otherwise, if you trust Paxa like App Academy and tens of thousands of other<br>
developers do, then click the link that reads &quot;More info&quot; and the &quot;Run anyway&quot;<br>
button.</p>
<p><img src="images/postbird-installation-run-anyway.png" alt="Postbird run anyway"></p>
<p>When it&apos;s done installing, it will launch itself. Test it out by typing the<br>
&quot;postgres&quot; into the &quot;Username&quot; field and the password from your installation in<br>
the &quot;Password&quot; field. Click the Connect button. It should properly connect to<br>
the running</p>
<p>You can close it for now. It also installed an icon on your desktop. You can<br>
launch it from there or your Start Menu at any time.</p>
<h2 class="mume-header" id="what-you-did">What you did</h2>

<p>You installed and configured PosgreSQL 12, a relational database management<br>
system, and tools to use it! Well done!</p>
<hr>
<h1 class="mume-header" id="installing-postgresql-12-and-postbird-on-macos">Installing PostgreSQL 12 and Postbird on macOS</h1>

<p>You will install two pieces of software so that you can start using PostgreSQL.<br>
You sill install PostgreSQL itself along with all of its tools. Then you will<br>
also install Postbird, a cross-platform graphical user interface that makes<br>
working with SQL and PostgreSQL better than just using the command line tool<br>
<code>psql</code>.</p>
<p>You can install both of these products using Homebrew. Your Windows-using<br>
classmates don&apos;t have this convenience, so pretend you&apos;re having a hard time<br>
doing this. &#x1F609;</p>
<h2 class="mume-header" id="installing-postgresql-12-1">Installing PostgreSQL 12</h2>

<p>First, update your Homebrew installation. You should do this before each thing<br>
that you install using Homebrew.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">brew update
</pre><p>Now, make sure that you have the correct Homebrew recipe. Type the following<br>
and make sure that the first line of the output contains some version of &quot;12&quot;.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">brew info postgresql
</pre><p>You should see something like this in the output.</p>
<pre data-role="codeBlock" data-info class="language-"><code>postgresql: stable 12.2 (bottled), HEAD
</code></pre><p>Now, launch the installation.</p>
<pre data-role="codeBlock" data-info class="language-"><code>brew install postgresql
</code></pre><p>This may take a while. Have a tea.</p>
<h2 class="mume-header" id="configuring-postgresql-12">Configuring PostgreSQL 12</h2>

<p>When that completes, you can read the <strong>Caveats</strong> section from the installation<br>
output. You should do this with <em>everything</em> that you install using Homebrew.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">To migrate existing data from a previous major version of PostgreSQL run:
  brew postgresql-upgrade-database

To have launchd start postgresql now and restart at login:
  brew services start postgresql
Or, <span class="token keyword">if</span> you don&apos;t want/need a background <span class="token function">service</span> you can just run:
  pg_ctl -D /usr/local/var/postgres start
</pre><p>You definitely want PostgreSQL to run now and every time you log in. Otherwise<br>
you&apos;d have to start it every time you reboot your computer which can be a<br>
hassle. Following the instructions, please type the following into the command<br>
line.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">brew services start postgresql
</pre><p>That should report that PostgreSQL is now started.</p>
<h2 class="mume-header" id="connecting-to-postgresql">Connecting to PostgreSQL</h2>

<p>To make sure your client tools are configured properly, type the following in<br>
a Terminal. This tells the <code>psql</code> client that you want to connect to the<br>
&quot;postgres&quot; database, which is the default database created when PostgreSQL is<br>
installed.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql postgres
</pre><p>That will connect to the &quot;postgres&quot; database as your user that you&apos;re logged in<br>
as, which the installer configured for you during the installation. It&apos;s the<br>
same as specifying your user name by using the &quot;-U&quot; command line parameter and<br>
typing.</p>
<pre data-role="codeBlock" data-info class="language-"><code>psql -U &#xAB;your user name&#xBB; postgres
</code></pre><p>When you successfully log in, it should show you the following output.</p>
<pre data-role="codeBlock" data-info class="language-"><code>psql (12.2)
Type &quot;help&quot; for help.

postgres=#
</code></pre><p>Type <code>\q</code> and hit Return to quit the PostgreSQL client.</p>
<h2 class="mume-header" id="installing-postbird-1">Installing Postbird</h2>

<p>Make sure that your Homebrew can find Postbird. Search for it using the <code>brew search</code> command.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">brew search postbird
</pre><p>You should get something back that looks like this.</p>
<pre data-role="codeBlock" data-info class="language-"><code>==&gt; Casks
postbird
</code></pre><p>That means it could find it. Since it&apos;s a <strong>Cask</strong>, that means it&apos;s an<br>
application that is meant to be used as a graphical user interface rather than<br>
on the command line. To install it, you need to include &quot;cask&quot; in the command.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">brew cask <span class="token function">install</span> postbird
</pre><p>Once it installs, try starting it. It&apos;s in your Applications directory. You can<br>
use Spotlight to launch it by pressing Command+Space. In the Spotlight window,<br>
type &quot;postbird&quot;. It should show you the recently-installed application&apos;s logo in<br>
the list as a white circle with a blue elephant. Select that and press Enter (or<br>
click it, if you&apos;re the touchpad/mouse kind of person).</p>
<p>The first time it starts, you may get this error.</p>
<p><img src="images/postbird-installation-unidentified-developer.png" alt="Postbird unidentified developer"></p>
<p>You should get used to seeing this because many open-source applications aren&apos;t<br>
signed with an Apple Developer Certificate yet. Click &quot;Cancel&quot;. We will need<br>
to tell macOS we would like to run this application despite it not being signed.</p>
<p>Open up your Applications directory by clicking on the shortcut in the left bar<br>
of Finder.</p>
<p><img src="images/finder-applications-shortcut.png" alt="Finder Applications shortcut"></p>
<p>Find the Postbird application in there. Hold down the Option key and left-click<br>
the icon. (If you&apos;re using the touchpad, this probably means two-finger tap.)<br>
Once the context menu shows up, you can let go of the Option key. Then, click<br>
the &quot;Open&quot; menu item. You will now see a new version of the popup from before<br>
with an extra button.</p>
<p><img src="images/postbird-installation-open-confirmation.png" alt="Postbird open confirmation"></p>
<p>Click the &quot;Open&quot; button. That will let Postbird run. Now that you&apos;ve done that<br>
once, you won&apos;t have to do it again for Postbird. This is valuable knowledge<br>
about how to run open-source software on macOS that isn&apos;t signed by the<br>
developers. However, it is a good security practice to only run applications<br>
from developers that you trust. The Postbird application is used by tens of<br>
thousands of software developers and is something that you can trust.</p>
<p>In fact, the developer of Postbird has an <a href="https://github.com/Paxa/postbird/issues/16">&apos;issue&apos; on github</a> about this very<br>
thing. So hopefully they will get the signing of the app fixed in a future<br>
version.</p>
<p>When Postbird starts, type &quot;postgres&quot; into the database field. Then, click the<br>
&quot;Connect&quot; button. It should open a new tab and show you basically a blank page.<br>
That means everything worked! Exit Postbird by pressing Command+Q or selecting<br>
Postbird &gt; &quot;Quit Postbird&quot; from the menu.</p>
<h2 class="mume-header" id="what-you-did-1">What you did</h2>

<p>You installed and configured PosgreSQL 12, a relational database management<br>
system, and tools to use it! Well done!</p>
<hr>
<h1 class="mume-header" id="user-management-walk-through">User Management Walk-Through</h1>

<p><strong>This is a walk-through</strong>: Please type along as you read what&apos;s going on in<br>
this article.</p>
<p>In this walk-through, you will</p>
<ul>
<li>Create superusers with full access to the system,</li>
<li>Create normal users,</li>
<li>Delete users from the system, and,</li>
<li>See how SQL is not case sensitive</li>
</ul>
<p>It&apos;s good practice to create a different database user for each application that<br>
you will have connect to an RDBMS. This prevents applications from reading and<br>
changing data in <em>other</em> databases that they should not have access to.</p>
<p>The &quot;User&quot; in PostgreSQL is a <strong>database entity</strong> that represents a person or<br>
system that will connect to the RDBMS and access data from one or more<br>
databases. This is the first entity that you will create, modify, and destroy.</p>
<p>All user management is beyond the scope of the ANSI SQL standard. That means<br>
each relational database management system has its own vendor-specific<br>
extensions about how to do this. When working with a new RDBMS, check out its<br>
documentation about how to create users, groups, and other security entities.</p>
<h2 class="mume-header" id="naming-a-user">Naming a user</h2>

<p>Names of users should not create spaces or dashes. They should contain only<br>
lower case letters, numbers, and underscores.</p>
<ul>
<li>Good user names
<ul>
<li>appacademy</li>
<li>patel_kush_112</li>
<li>bdorsey</li>
</ul>
</li>
<li>Bad (incorrect) user names
<ul>
<li>Ned Ruggeri</li>
<li>melvin-howard-torm&#xE9;</li>
<li>b.d.o.r.s.e.y</li>
</ul>
</li>
</ul>
<h2 class="mume-header" id="creating-a-superuser">Creating a superuser</h2>

<p>On Windows, open your Ubuntu shell. On macOS, open your Terminal. Start the<br>
PostgreSQL command line client with the command <code>psql postgres</code>.</p>
<p>You should see some information about the version of the database and the<br>
command line tool, plus a helpful hint to type &quot;help&quot; if you need help. Then,<br>
you will see the <code>psql</code> prompt:</p>
<pre data-role="codeBlock" data-info class="language-"><code>postgres=#
</code></pre><p>The value &quot;postgres&quot; means that you&apos;re currently connected to the &quot;postgres&quot;<br>
database. More on that in the next article.</p>
<p>To create a user in PostgreSQL you will use the following command. It creates a<br>
user with the name &quot;test_superuser&quot; and the password &quot;test&quot;. <em>Type</em> that command<br>
(please don&apos;t copy and paste it) and run it by hitting Enter (or Return).</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> test_superuser
<span class="token keyword">WITH</span>
PASSWORD <span class="token string">&apos;test&apos;</span>
SUPERUSER<span class="token punctuation">;</span>
</pre><p>Note that this SQL statement ends with a semicolon. All SQL statements in<br>
PostgreSQL do. Don&apos;t forget it. If you do forget it, just type it on an empty<br>
line. The above statement, for example, can also be entered as the following<br>
where the semicolon is on a line all its own.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> test_superuser
<span class="token keyword">WITH</span>
PASSWORD <span class="token string">&apos;test&apos;</span>
SUPERUSER
<span class="token punctuation">;</span>
</pre><p>If you typed it correctly, you will see the message <code>CREATE ROLE</code>. Because you<br>
created test_superuser as a super user, when a person or application uses that<br>
login, they can do whatever they want. You will test out that fact, now.</p>
<p>Quit your current session by typing <code>\q</code> and hitting Enter (or Return). Now type<br>
the following command to connect to PostgreSQL with the newly-created user. It<br>
instructs the client to connect as the user &quot;test_superuser&quot; (<code>-U test_superuser</code>) to the database named &quot;postgres&quot; (<code>postgres</code>) and prompt for<br>
the password (<code>-W</code>) for the user.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql -W -U test_superuser postgres
</pre><p>At the prompt, type the password <em>test</em> that you used when you created the user.<br>
If everything went well, then you will find yourself at the SQL prompt just like<br>
before. To prove to you that you&apos;re now the &quot;test_superuser&quot;, type the following<br>
command.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_USER</span><span class="token punctuation">;</span>
</pre><p>It should respond with the following output:</p>
<pre data-role="codeBlock" data-info class="language-"><code>  current_user
----------------
 test_superuser
(1 row)
</code></pre><h2 class="mume-header" id="creating-a-limited-user">Creating a limited user</h2>

<p>You&apos;re logged in as a super user that can do anything. Use that power! Create<br>
another user that does not have such amazing power. You will rarely create super<br>
users in real life. The following user creation is more appropriate. It creates<br>
just a normal user that can log in. Then, you can assign that user specific<br>
access to specific databases.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> test_normal_user
<span class="token keyword">WITH</span>
PASSWORD <span class="token string">&apos;test&apos;</span><span class="token punctuation">;</span>
</pre><p>That should also give you the <code>CREATE ROLE</code> message that means everything went<br>
ok.</p>
<p>Quit the session by typing <code>\q</code> and pressing Enter (or Return). Start another as<br>
the new user.</p>
<pre data-role="codeBlock" data-info="psql" class="language-psql"><code>psql -U test_normal_user -W postgres
</code></pre><p>Type the password <em>test</em> for this user. Confirm that you are now that new user<br>
by using the <code>SELECT CURRENT_USER;</code> command. Once confirmed, try to create a<br>
user named <em>hacking_the_planet</em> with a password of <em>pwned!</em>. What happens?</p>
<p>That&apos;s right. This user doesn&apos;t have the security privileges to create users.</p>
<p>Create users to do the job you want them to do. Then, give the appropriate<br>
permissions to that user. This will make a safe and secure application<br>
development world for you and your team.</p>
<h2 class="mume-header" id="removing-a-user">Removing a user</h2>

<p>Time to remove both of these users. The opposite of <code>CREATE USER</code> is <code>DROP USER</code>. To drop a user, you just type <code>DROP USER &#xAB;user name&#xBB;;</code>.</p>
<p>Connect again as just you, the OG super user. (Once again, that&apos;s with the<br>
command <code>psql postgres</code>.)</p>
<p>Drop the normal user with the command</p>
<pre data-role="codeBlock" data-info class="language-"><code>DROP USER test_normal_user;
</code></pre><p>Then, drop the user with the name &quot;test_superuser&quot;. You should receive the<br>
message &quot;DROP ROLE&quot; for each of your commands.</p>
<h2 class="mume-header" id="case-sensitivity">Case sensitivity</h2>

<p>Unlike JavaScript, the keywords in SQL are case insensitive. that means you can<br>
type any of the following and they&apos;ll all work.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">USER</span> test_user<span class="token punctuation">;</span>
<span class="token keyword">Drop</span> <span class="token keyword">User</span> test_user<span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">user</span> test_user<span class="token punctuation">;</span>
</pre><p>Notice that entity names like user names <em>are</em> case sensitive.</p>
<p>SQL is conventionally written in all uppercase to distinguish the commands from<br>
the names that you will have for your entities and their properties.</p>
<h2 class="mume-header" id="what-you-learned">What you learned</h2>

<ul>
<li>That a user is a <em>database entity</em> in PostgreSQL</li>
<li>That it is best practice to create a user for each application that you will<br>
create</li>
<li>How to create a super user with the <code>CREATE USER ... SUPERUSER</code> command</li>
<li>How to create a restricted (normal) user with the <code>CREATE USER</code> command</li>
<li>How to remove a user with the <code>DROP USER</code> command</li>
<li>SQL keywords are not sensitive to case, but are conventionally written in<br>
uppercase</li>
</ul>
<hr>
<h1 class="mume-header" id="database-management-walk-through">Database Management Walk-Through</h1>

<p><strong>This is a walk-through</strong>: Please type along as you read what&apos;s going on in<br>
this article.</p>
<p>In this walk-through, you will</p>
<ul>
<li>Create a database for your user,</li>
<li>Create databases for other users,</li>
<li>Apply security to the databases to prevent access,</li>
<li>See the first example of &quot;relational data&quot; in the RDBMS, and,</li>
<li>Create other databases and apply security to them.</li>
</ul>
<p>Now that you can create users for each of your applications, it&apos;s time for you<br>
to be able to create a <strong>database</strong>. The database is where you will store the<br>
data for your application.</p>
<p>You&apos;ve been using the following command to log in as your superuser to the<br>
&quot;postgres&quot; database. This works because if you don&apos;t specify a user with the<br>
<code>-U</code> command line parameter, it just uses the name of the currently logged in<br>
user, your user name.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">psql postgres
</pre><p>That&apos;s because if you don&apos;t specify a database, then PostgreSQL will try to<br>
connect you to a database that has the same name as your user. Try it, now.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">psql
</pre><p>When you run this, if there is no database with your user name, then you will<br>
receive an error message that reads like the following. (The text has been<br>
wrapped in the example for readability.)</p>
<pre data-role="codeBlock" data-info class="language-"><code>psql: error: could not connect to server:
      FATAL:  database &quot;appacademy&quot; does not exist
</code></pre><h2 class="mume-header" id="naming-a-database">Naming a database</h2>

<p>Names of databases should not create spaces or dashes. They should contain only<br>
lower case letters, numbers, and underscores.</p>
<ul>
<li>Good database names
<ul>
<li>appacademydata</li>
<li>financials2020</li>
<li>chicago_office</li>
</ul>
</li>
<li>Bad (incorrect) database names
<ul>
<li>App Academy Data</li>
<li>financials-2020</li>
<li>chicago.office</li>
</ul>
</li>
</ul>
<h2 class="mume-header" id="creating-a-database-for-your-user">Creating a database for your user</h2>

<p>So that you don&apos;t have to type &quot;postgres&quot; every time you want to connect on the<br>
command line, you can create a database with your user name so that one will<br>
exist. To determine your user name, type the following command at your shell,<br>
<em>not</em> in PostgreSQL.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">whoami</span>
</pre><p>That will show you the name of your user. Remember that name. Now, start your<br>
PostgreSQL command line as your superuser.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql postgres
</pre><p>That should result in the <code>psql</code> command prompt of <code>postgres=#</code>. Again, that<br>
means that you are currently connected to the &quot;postgres&quot; database.</p>
<p>Once you&apos;re greeted by the <code>postgres=#</code> command prompt, you can create a<br>
database for your user by typing the following command. Don&apos;t copy and paste,<br>
here. Type it out.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> &#xAB;your <span class="token keyword">user</span> name&#xBB; <span class="token keyword">WITH</span> OWNER &#xAB;your <span class="token keyword">user</span> name&#xBB;<span class="token punctuation">;</span>
</pre><p>By making yourself the owner of that database, then your user can do anything<br>
with it.</p>
<p>For the examples in these articles, the user name is &quot;appacademy&quot;, so the<br>
authors typed</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> appacademy <span class="token keyword">WITH</span> OWNER appacademy<span class="token punctuation">;</span>
</pre><p>If the command succeeds, you will see the message &quot;CREATE DATABASE&quot;. Now, quit<br>
the client using <code>\q</code>. Now, connect, again, to PostgreSQL by just typing the<br>
following.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql
</pre><p>Now, when you log in, you will be greeted by a command prompt that reads</p>
<pre data-role="codeBlock" data-info class="language-"><code>&#xAB;your user name&#xBB;=#
</code></pre><p>You&apos;re connected to your very own database! And, now, you have less to type when<br>
you want to start <code>psql</code>! Yay for less typing!</p>
<h2 class="mume-header" id="creating-other-users-and-databases">Creating other users and databases</h2>

<p>Create two normal users with the following user names and passwords using the<br>
<code>CREATE USER</code> command from the last article.</p>
<table>
<thead>
<tr>
<th>User name</th>
<th>Password</th>
</tr>
</thead>
<tbody>
<tr>
<td>ada</td>
<td>ada1234</td>
</tr>
<tr>
<td>odo</td>
<td>ODO!!!1</td>
</tr>
</tbody>
</table>
<p>Now, create two databases, each named for a user with that user as the owner.<br>
Again, type these rather than copying and pasting.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> ada <span class="token keyword">WITH</span> OWNER ada<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> odo <span class="token keyword">WITH</span> OWNER odo<span class="token punctuation">;</span>
</pre><p>Now that you have new users and databases for them, it&apos;s time to test out that<br>
you can connect to PostgreSQL with those users. Quit your current session by<br>
typing <code>\q</code> and pressing Enter (or Return). Then, start a new session for &quot;ada&quot;<br>
by using the following <code>psql</code> command that will prompt for the user&apos;s password<br>
(<code>-W</code>) and connect as the specified user (<code>-U ada</code>).</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql -W -U ada
</pre><p><strong>Note</strong>: Those command line parameters can come in any order, usually. The<br>
above statement can also be written as <code>psql -U ada -W</code>, for example.</p>
<p>When you enter that and type the password for &quot;ada&quot; which is &quot;ada1234&quot; from the<br>
table above, you should see that you are now connected to the &quot;ada&quot; database in<br>
the prompt.</p>
<pre data-role="codeBlock" data-info class="language-"><code>ada=&gt;
</code></pre><p>Notice that the character at the end is now a &quot;&gt;&quot; rather than the &quot;#&quot; that<br>
you&apos;re used to seeing. That&apos;s because &quot;ada&quot; is a normal user. Normal user<br>
prompts end with &quot;&gt;&quot;. Your user, the one tied to your user name, is a super<br>
user. That results in a &quot;#&quot;</p>
<p>Quit this session and connect as the &quot;odo&quot; user, now. You will notice that<br>
because &quot;odo&quot; is a normal user, that you will see this prompt, too.</p>
<pre data-role="codeBlock" data-info class="language-"><code>odo=&gt;
</code></pre><h2 class="mume-header" id="applying-security-to-databases">Applying security to databases</h2>

<p>You&apos;ve created a database for &quot;odo&quot;. Type the following command which will try<br>
to connect as the user &quot;ada&quot; (<code>-U ada</code>) to the database &quot;odo&quot; (<code>odo</code>).</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql -W -U ada odo
</pre><p>After you type the password, you may be surprised to find out that &quot;ada&quot; can<br>
connect to the database &quot;odo&quot; that&apos;s owned by the user &quot;odo&quot;! That&apos;s because all<br>
databases, when they&apos;re created, by default allow access to what is known as the<br>
&quot;PUBLIC&quot; schema, a kind of group that everyone belongs to. You sure don&apos;t want<br>
that if you want to prevent the user &quot;ada&quot; from messing up the data in the<br>
database &quot;odo&quot;, and the user &quot;odo&quot; from messing up the data in the database<br>
&quot;ada&quot;.</p>
<p>To do that, you have to revoke connection privileges to &quot;PUBLIC&quot;. That&apos;s like<br>
putting a biometric lock on a bank safety deposit box so that only the owner of<br>
that deposit box (and bank officials) can get into it and do stuff with its<br>
contents.</p>
<p>To do that, quit the current <code>psql</code> session if you&apos;re in one. Connect to<br>
PostgreSQL as your user, a superuser. Again, now that you have your own<br>
database, you can just type <code>psql</code> at your macOS Terminal command line or Ubuntu<br>
shell command line. Once you have your prompt</p>
<pre data-role="codeBlock" data-info class="language-"><code>&#xAB;your user name&#xBB;=#
</code></pre><p>you want to type a command that will revoke all privileges from the databases<br>
named &quot;odo&quot; and &quot;ada&quot; the connection privileges of the entire &quot;PUBLIC&quot; group. To<br>
do that, you write the command with the form:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">REVOKE</span> <span class="token keyword">CONNECT</span> <span class="token keyword">ON</span> <span class="token keyword">DATABASE</span> &#xAB;<span class="token keyword">database</span> name&#xBB; <span class="token keyword">FROM</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">;</span>
</pre><p>Do that for both databases. Each time you run it, you should see the message<br>
&quot;REVOKE&quot; showing that it worked.</p>
<p>Now, quit your session (<code>\q</code>). With the connection privilege revoked, &quot;ada&quot; can<br>
no longer connect to database &quot;odo&quot; and vice versa. Try typing the following.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql -W -U ada odo
</pre><p>You should see an error message similar to the following.</p>
<pre data-role="codeBlock" data-info class="language-"><code>psql: error: could not connect to server:
      FATAL:  permission denied for database &quot;odo&quot;
DETAIL:  User does not have CONNECT privilege.
</code></pre><p>Try connecting with the user &quot;odo&quot; to the database named &quot;ada&quot;. You should see<br>
the same error message except with the database named &quot;ada&quot; in it.</p>
<p>But, your superuser status will not be thwarted! You can still connect to either<br>
of those because of your superuser privileges. Neither of the following commands<br>
should fail.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token comment"># Connect to the database &quot;odo&quot; as your superuser</span>
psql odo
</pre><pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token comment"># Connect to the database &quot;ada&quot; as your superuser</span>
psql ada
</pre><p>Superusers can connect to any and all databases. Because <em>superuser</em>!</p>
<p>Remember you created a database for your user? Now, revoke connection privileges<br>
from it for &quot;PUBLIC&quot;, too.</p>
<h2 class="mume-header" id="listing-databases-and-granting-privileges">Listing databases and granting privileges</h2>

<p>Now, say the user &quot;ada&quot; needs another database, one that will contain data that<br>
&quot;ada&quot; wants to keep separate from the data in the database &quot;ada&quot;. Connect to<br>
PostgreSQL as your user. Create a new database without specifying the owner.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> hr_data<span class="token punctuation">;</span>
</pre><p>Now, type the command to list databases on your installation of PostgreSQL.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">\list
</pre><p>You will see something akin to the following. The entries in the &quot;Collate&quot;,<br>
&quot;Cypte&quot;, and &quot;Access privileges&quot; columns may differ. That&apos;s fine and can be<br>
ignored. Also, where you see &quot;appacademy&quot;, you&apos;ll probably see your user name.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Owner</th>
<th>Encoding</th>
<th>Collate</th>
<th>Ctype</th>
<th>Access privileges</th>
</tr>
</thead>
<tbody>
<tr>
<td>ada</td>
<td>ada</td>
<td>UTF8</td>
<td>C</td>
<td>C</td>
<td>=T/ada                   +</td>
</tr>
<tr>
<td colspan="5"></td>




<td>ada=CTc/ada</td>
</tr>
<tr>
<td>appacademy</td>
<td>appacademy</td>
<td>UTF8</td>
<td>C</td>
<td colspan="2">C</td>

</tr>
<tr>
<td>hr_data</td>
<td>appacademy</td>
<td>UTF8</td>
<td>C</td>
<td colspan="2">C</td>

</tr>
<tr>
<td>odo</td>
<td>odo</td>
<td>UTF8</td>
<td>C</td>
<td>C</td>
<td>=T/odo                   +</td>
</tr>
<tr>
<td colspan="5"></td>




<td>odo=CTc/odo</td>
</tr>
<tr>
<td>postgres</td>
<td>appacademy</td>
<td>UTF8</td>
<td>C</td>
<td colspan="2">C</td>

</tr>
<tr>
<td>template0</td>
<td>appacademy</td>
<td>UTF8</td>
<td>C</td>
<td>C</td>
<td>=c/appacademy            +</td>
</tr>
<tr>
<td colspan="5"></td>




<td>appacademy=CTc/appacademy</td>
</tr>
<tr>
<td>template1</td>
<td>appacademy</td>
<td>UTF8</td>
<td>C</td>
<td>C</td>
<td>=c/appacademy            +</td>
</tr>
<tr>
<td colspan="5"></td>




<td>appacademy=CTc/appacademy</td>
</tr>
</tbody>
</table>
<p>You will see that for the database that you just created, &quot;hr_data&quot;, that the<br>
owner is you. Go ahead and revoke all access to it from &quot;PUBLIC&quot; like you did in<br>
the last section. Once you&apos;ve done that, no one but you (and other superusers)<br>
can connect to the &quot;hr_data&quot; database. (You may want to exit the <code>psql</code> shell<br>
and try connecting with the credentials for the &quot;ada&quot; user just to make sure. If<br>
you do that, reconnect as your user so you can continue with the security<br>
management.)</p>
<p>Now, you need to add &quot;ada&quot; back to it so that user can connect to the database.<br>
The opposite of <code>REVOKE ... FROM ...</code> is <code>GRANT ... TO ...</code>. So, you will type<br>
the following:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">CONNECT</span> <span class="token keyword">ON</span> <span class="token keyword">DATABASE</span> hr_data <span class="token keyword">TO</span> ada<span class="token punctuation">;</span>
</pre><p>Now, if you exit the <code>psql</code> shell and connect as &quot;ada&quot;, you will see that user<br>
can connect. Make sure that&apos;s true.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql -U ada hr_data
</pre><p>Once you have confirmed that &quot;ada&quot; can connect, make sure that user &quot;odo&quot; cannot<br>
connect.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql -U odo hr_data
</pre><p>That command should return the error message that reads that the user &quot;does not<br>
have CONNECT privilege.&quot;</p>
<h2 class="mume-header" id="time-to-clean-up">Time to clean up</h2>

<p>Time to clean up the entities that you&apos;ve created in this walk-through. You<br>
already know how to delete a user by using the <code>DROP USER</code> statement. Log in as<br>
your superuser and try to drop the &quot;ada&quot; user. You should see an error message<br>
similar to the following.</p>
<pre data-role="codeBlock" data-info class="language-"><code>ERROR:  role &quot;ada&quot; cannot be dropped because some objects depend on it
DETAIL:  owner of database ada
privileges for database hr_data
</code></pre><p>This tells you that you can&apos;t drop that user because database objects in the<br>
system rely on the existence of the user &quot;ada&quot;. This is the first example that<br>
you&apos;ve seen of <em>relational data</em>. The database &quot;ada&quot; is related to the user<br>
&quot;ada&quot; because user &quot;ada&quot; owns the database &quot;ada&quot;. The database &quot;hr_data&quot; is<br>
related to the user &quot;ada&quot; because the user &quot;ada&quot; has access privileges for the<br>
database &quot;hr_data&quot;.</p>
<p>This is one of the primary reasons that relational databases provide such an<br>
important role in application design and development. If you or your application<br>
puts data into the database that relates to other data, you can&apos;t just remove it<br>
without removing <em>all of the related data, too</em>!</p>
<p>To remove the related data from user &quot;ada&quot;, you need to revoke the connect<br>
privilege on &quot;hr_data&quot; for user &quot;ada&quot;. Then, you need to delete the database<br>
&quot;ada&quot; that user &quot;ada&quot; owns. You&apos;ve seen some <code>REVOKE</code> statements in this article<br>
that revoke the connect privilege from &quot;PUBLIC&quot;. It&apos;s the same for an individual<br>
user, too, just replace &quot;PUBLIC&quot; with the name of the user.</p>
<p>Then, the opposite of <code>CREATE DATABASE</code> is <code>DROP DATABASE</code> just like the<br>
opposite of <code>CREATE USER</code> is <code>DROP USER</code>.</p>
<p>Putting together those two hints, you can type commands like this to get the<br>
job done.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">REVOKE</span> <span class="token keyword">CONNECT</span> <span class="token keyword">ON</span> <span class="token keyword">DATABASE</span> hr_data <span class="token keyword">FROM</span> ada<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> ada<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">USER</span> ada<span class="token punctuation">;</span>
</pre><p>Run in that order, the first two statements remove the data <em>related</em> to the<br>
user &quot;ada&quot;. Once that&apos;s gone, you can finally remove the user &quot;ada&quot; itself.</p>
<p>Do the same for the user &quot;odo&quot;, deleting the related data, first. Remember, you<br>
can run the <code>DROP</code> statement for the user &quot;odo&quot; to see what data relates to that<br>
user.</p>
<p><strong>Note</strong>: When you run a statement in PostgreSQL that results in an error<br>
message, do not worry! You have not corrupted anything! These are helpful<br>
statements to let you know that the state of the database won&apos;t allow you to<br>
perform the requested operation. These kinds of error statements are guideposts<br>
for you to follow to get to the place you want to be.</p>
<h2 class="mume-header" id="what-youve-done">What you&apos;ve done</h2>

<p>You have successfully created databases for yourself and other users. You have<br>
created a database with you as the owner and given access to it to another user.<br>
You have locked down databases so only owners (and superusers) can access them.<br>
You know how to see the owner of a database. You know how to remove a user from<br>
a database after removing all data related to the user.</p>
<p>This is the start of a lovely secure set of databases.</p>
<hr>
<h1 class="mume-header" id="table-management-walk-through-part-i">Table Management Walk-Through -  Part I</h1>

<p><strong>This is a walk-through</strong>: Please type along as you read what&apos;s going on in<br>
this article.</p>
<p>In this walk-through, you will</p>
<ul>
<li>Learn about what a table is,</li>
<li>How to create and delete tables,</li>
<li>Who owns a table, and,</li>
<li>Learn about different data types that you can use when defining a table.</li>
</ul>
<p>You can now create users that can connect to the relational database management<br>
system. You can now create databases and secure them so only certain users can<br>
connect to them. Now, it&apos;s time to get into the part where you define the<br>
entities that actually hold the data: <strong>tables</strong>!</p>
<h2 class="mume-header" id="what-is-a-table">What is a table?</h2>

<p>A table is a &quot;logical&quot; structure that defines how data is stored and contains<br>
that data that meets the definition. Most people think about tables like<br>
spreadsheets that have a specific number of columns and rows that contain the<br>
data.</p>
<p>It is called a &quot;logical&quot; structure because we reason about it in terms of<br>
columns and rows; however, the RDMBS is in charge of how the data is actually<br>
stored on disk and, quite often, for performance reasons, it does <em>not</em> look<br>
like rows and columns. The way it is stored on disk is called the &quot;physical&quot;<br>
structure because that&apos;s what is the actual physical representation of it. We do<br>
not cover physical structures because they vary by RDBMS. If you become a<br>
<strong>database administrator</strong> in the future, you may have to learn such things.</p>
<p>Here is a spreadsheet that contains some data about puppies.</p>
<p><img src="images/tables-puppies-spreadsheet.png" alt="Puppies spreadsheet"></p>
<p>You can see that the columns are</p>
<ul>
<li>name</li>
<li>age_yrs</li>
<li>breed</li>
<li>weight_lbs</li>
<li>microchipped</li>
</ul>
<p>Now, look at the data each column contains. You can guess at what kind of data<br>
type is in each of them by their values. If you were to write that out using the<br>
data types that you know from JavaScript, you might come up with the following<br>
table.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>string</td>
</tr>
<tr>
<td>age_yrs</td>
<td>number</td>
</tr>
<tr>
<td>breed</td>
<td>string</td>
</tr>
<tr>
<td>weight_lbs</td>
<td>number</td>
</tr>
<tr>
<td>microchipped</td>
<td>Boolean</td>
</tr>
</tbody>
</table>
<p>In table definitions, you have to be more specific, unfortunately. This is so<br>
the database can know things like &quot;the maximum length of the string&quot; or &quot;will<br>
the number have decimal points&quot;? This is important information so that database<br>
can know how to store it most efficiently. The following table shows you the<br>
corresponding ANSI SQL data types for the JavaScript types from before.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>JavaScript data type</th>
<th>Max length</th>
<th>ANSI SQL data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>string</td>
<td>50</td>
<td>VARCHAR(50)</td>
</tr>
<tr>
<td>age_yrs</td>
<td colspan="2">number</td>

<td>NUMERIC(3,1)</td>
</tr>
<tr>
<td>breed</td>
<td>string</td>
<td>100</td>
<td>VARCHAR(100)</td>
</tr>
<tr>
<td>weight_lbs</td>
<td colspan="2">number</td>

<td>INTEGER</td>
</tr>
<tr>
<td>microchipped</td>
<td colspan="2">Boolean</td>

<td>BOOLEAN</td>
</tr>
</tbody>
</table>
<p>You can see that &quot;string&quot; values map to something called a &quot;VARCHAR&quot; with a<br>
maximum length.</p>
<p>You can see that &quot;number&quot; values map to something called a &quot;NUMERIC&quot; with some<br>
numbers, or an INTEGER which is just a whole number.</p>
<p>You can see that &quot;Boolean&quot; values map to something called a &quot;BOOLEAN&quot; which is<br>
nice because that&apos;s convenient.</p>
<h2 class="mume-header" id="defining-tables">Defining tables</h2>

<p>To define a table, you need to know what the different pieces of related data it<br>
will store. Then, you need to know what kind each of those pieces are. Once you<br>
have that, you can create a table with an ANSI SQL statement.</p>
<h3 class="mume-header" id="string-types">String types</h3>

<p>There are three kinds of commonly used string types that databases support based<br>
on the ANSI SQL standard. This section talks about them.</p>
<p>The most commonly used type is known as the <strong>CHARACTER VARYING</strong> type. It means<br>
that it can contain text of varying lengths up to a specified maximum. That<br>
maximum is provided when you define the table. Instead of having to type<br>
<em>CHARACTER VARYING</em> all the time, you can use its weirdly named alias<br>
<strong>VARCHAR</strong>, (pronounced &quot;var-car&quot; or &quot;var-char&quot; where each part rhymes with<br>
&quot;car&quot;). So, to specify that a column can hold up to 50 characters, you would<br>
write <code>VARCHAR(50)</code> in the table definition. (Remember, SQL is case insensitive<br>
for its keywords. You can also write <code>varchar(50)</code> or <code>VarChar(50)</code> if you so<br>
desired. Just be consistent.)</p>
<p>Another commonly used type is known simply as <strong>TEXT</strong>. This is a column that<br>
can contain an &quot;unlimited&quot; number of characters. You may ask yourself, &quot;Why<br>
don&apos;t I just always use TEXT, then?&quot; Performance is the reason. Columns with the<br>
<em>TEXT</em> type are notoriously slower than those with other string types. Use them<br>
judiciously.</p>
<p>Purposefully left out from this discussion is a type named <strong>CHARACTER</strong> or<br>
<strong>CHAR</strong>. It is like the <strong>VARCHAR</strong>, except that it is a fixed-width character<br>
field. This author has <em>never</em> seen it used in a production system except for<br>
Oracle DB which did not, at one time, support a Boolean type. Other than that,<br>
it was only useful back in the 1970s - 1990s when computer disk space and speed<br>
were slow and expensive.</p>
<h3 class="mume-header" id="numeric-types">Numeric types</h3>

<p>ANSI SQL (and PostgreSQL) supports <strong>INTEGER</strong>, <strong>NUMERIC</strong>, and floating-point<br>
numbers.</p>
<p>The <em>INTEGER</em> should be familiar. It&apos;s just a number. In PostgreSQL, it can hold<br>
almost all values that your application can handle. That&apos;s from -2,147,483,648<br>
to +2,147,483,647. If, for some reason, you were writing a database that would<br>
contain a record for every person in the world, you would need integers bigger<br>
than that. To solve that problem, ANSI SQL (and PostgreSQL) supports the<br>
<strong>BIGINT</strong> type that will hold values between -9,223,372,036,854,775,808 to<br>
9,223,372,036,854,775,807. If your application needs bigger integers, there are<br>
extensions available.</p>
<p>The <strong>NUMERIC</strong> type is a fixed-point number. When you specify it, it takes up<br>
to two arguments. The first number is the total number of digits that a number<br>
can have in that column. The second number is the number of digits after the<br>
decimal point that you want to track. The specification <em>NUMERIC(4,2)</em> will hold<br>
the number <em>23.22</em>, but not the numbers <em>123.22</em> (too many total digits) or<br>
<em>23.222</em> (which it will just ignore the extra decimal places and store <em>23.22</em>).<br>
These exact numbers are important for things like storing values of money, where<br>
rounding errors could cause significant errors in calculations.</p>
<p>If you don&apos;t care about rounding errors, you can use the <strong>DOUBLE PRECISION</strong>.<br>
There is no short alias for it. You can just put decimal numbers in there and<br>
they will come out pretty much the same. Don&apos;t use this kind of data type for<br>
columns that contain values of money because they will round and someone will<br>
get in trouble, eventually.</p>
<h2 class="mume-header" id="other-data-types">Other data types</h2>

<p>PostgreSQL supports a lot of other data types, as well. It has specialized data<br>
types for money, dates and times, geometric types, network addresses, and JSON!<br>
Ones that you will use a lot in this course are the ones for dates and times, as<br>
well as the one for JSON.</p>
<p>Here&apos;s the link to the documentation on <a href="https://www.postgresql.org/docs/current/datatype.html">PostgreSQL data types</a>. Go review the<br>
documentation for the types that support dates and times as you will need to<br>
know the <strong>TIMESTAMP</strong> and <strong>DATE</strong> types.</p>
<h2 class="mume-header" id="naming-a-table">Naming a table</h2>

<p>Names of tables should not create spaces or dashes. They should contain only<br>
lower case letters, numbers, and underscores.</p>
<p>Conventionally, many software developers name their database table names as the<br>
plural form of the data that it holds. More importantly, many software libraries<br>
known as ORMs (which you will cover, this week) use the plural naming<br>
convention. You should use the plural naming convention while here at App<br>
Academy.</p>
<ul>
<li>Good table names
<ul>
<li>student_grades</li>
<li>office_locations</li>
<li>people</li>
</ul>
</li>
<li>Bad (incorrect) table names
<ul>
<li>Student Grades</li>
<li>office-locations</li>
<li>person</li>
</ul>
</li>
</ul>
<p><strong>Note</strong>: The opinion that database table names should be plural is the subject<br>
of heated debate among many software developers. We don&apos;t argue about it at App<br>
Academy. We acknowledge that it <em>really doesn&apos;t matter</em> how they&apos;re named. You<br>
should just be consistent in the way they&apos;re named. Because our tools will use<br>
the plural forms, we use the plural forms.</p>
<h2 class="mume-header" id="writing-the-sql">Writing the SQL</h2>

<p>Creating a table with SQL has this general syntax.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> &#xAB;<span class="token keyword">table</span> name&#xBB; <span class="token punctuation">(</span>
  &#xAB;<span class="token keyword">column</span> name&#xBB; &#xAB;<span class="token keyword">data</span> <span class="token keyword">type</span>&#xBB;<span class="token punctuation">,</span>
  &#xAB;<span class="token keyword">column</span> name&#xBB; &#xAB;<span class="token keyword">data</span> <span class="token keyword">type</span>&#xBB;<span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  &#xAB;<span class="token keyword">column</span> name&#xBB; &#xAB;<span class="token keyword">data</span> <span class="token keyword">type</span>&#xBB;
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>A couple of things to note. First, it uses parentheses, not curly braces. Many<br>
developers that use curly brace languages like JavaScript will eventually, out<br>
of habit, put curly braces instead of parentheses. If you were to do that, the<br>
RDBMS will tell you that you have a syntax error. Just grin and replace the<br>
curly braces with parentheses.</p>
<p>Another thing to note is that the last column specification <em>cannot</em> have a<br>
comma after it. In JavaScript, we can have commas after the last entry in an<br>
array or in a literal object definition. Not so in SQL. Again, the RDBMS will<br>
tell you that there is a syntax error. Just delete that last comma.</p>
<p>Here&apos;s the table that contains the column definitions for the &quot;puppies&quot;<br>
spreadsheet from before.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>JavaScript data type</th>
<th>Max length</th>
<th>ANSI SQL data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>string</td>
<td>50</td>
<td>VARCHAR(50)</td>
</tr>
<tr>
<td>age_yrs</td>
<td colspan="2">number</td>

<td>NUMERIC(3,1)</td>
</tr>
<tr>
<td>breed</td>
<td>string</td>
<td>100</td>
<td>VARCHAR(100)</td>
</tr>
<tr>
<td>weight_lbs</td>
<td colspan="2">number</td>

<td>INTEGER</td>
</tr>
<tr>
<td>microchipped</td>
<td colspan="2">Boolean</td>

<td>BOOLEAN</td>
</tr>
</tbody>
</table>
<p>To write that as SQL, you would just put in the table name, column names, and<br>
data types in the syntax from above. You would get the following.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  breed <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Log into your database, if you&apos;re not already. (Make sure you&apos;re in <em>your</em><br>
database by looking at the prompt. It should read <code>&#xAB;your user name&#xBB;=#</code>.) Type in<br>
the SQL statement from above. If you do it correctly, PostgreSQL will return the<br>
message &quot;CREATE TABLE&quot;.</p>
<h2 class="mume-header" id="listing-tables-and-table-definitions">Listing tables and table definitions</h2>

<p>You can see the tables in your database by typing <code>\dt</code> at the <code>psql</code> shell<br>
prompt. The <code>\dt</code> command means &quot;describe tables&quot;. If you do that now, assuming<br>
that you&apos;ve only created the &quot;puppies&quot; table, you should see the following with<br>
your user name, of course.</p>
<pre data-role="codeBlock" data-info class="language-"><code>           List of relations
 Schema |  Name   | Type  |   Owner
--------+---------+-------+------------
 public | puppies | table | appacademy
</code></pre><p>The user that runs the SQL statement that creates the table is the owner of that<br>
table. Table owners, like database owners, will always be able to access the<br>
table and its data. If you want a user other than the one that you&apos;re logged in<br>
as to own the table, you have two ways of doing that.</p>
<ul>
<li>Log out and log in as the user that you want to own the table and run the<br>
<code>CREATE TABLE</code> statement as that user.</li>
<li>As the superuser, run the <code>SET ROLE &#xAB;user name&#xBB;</code> command to switch the current<br>
user and run the <code>CREATE TABLE</code> statement as that user.</li>
</ul>
<p>To see the definition of a particular table table, type <code>\d &#xAB;table name&#xBB;</code>. For<br>
puppies, type <code>\d puppies</code>. You should see the following output.</p>
<pre data-role="codeBlock" data-info class="language-"><code>                         Table &quot;public.puppies&quot;
    Column    |          Type          | Collation | Nullable | Default
--------------+------------------------+-----------+----------+---------
 name         | character varying(50)  |           |          |
 age_yrs      | numeric(3,1)           |           |          |
 breed        | character varying(100) |           |          |
 weight_lbs   | integer                |           |          |
 microchipped | boolean                |           |          |
</code></pre><p>For now, ignore the &quot;Collation&quot;, &quot;Nullable&quot;, and &quot;Default&quot; columns in that<br>
output. The next article will address &quot;Nullable&quot; and &quot;Default&quot;.</p>
<p>You can see that the data types that you provided have been translated into<br>
their ANSI SQL full name equivalents.</p>
<p>Now, connect to the &quot;postgres&quot; database using the <code>\c postgres</code> command. It<br>
should give you a message that you&apos;re now connected to the &quot;postgres&quot; database<br>
as your user. The prompt should change from one that has your name to<br>
<code>postgres=#</code>. Now, type <code>\dt</code> to list the tables in the &quot;postgres&quot; database. If<br>
you haven&apos;t created any tables there, it will read &quot;Did not find any relations.&quot;<br>
If you type <code>\d puppies</code>, it will report that it can&apos;t find a relation named<br>
&quot;puppies&quot;.</p>
<p>This is because you&apos;re in a different database than the one in which you created<br>
the &quot;puppies&quot; table. You just don&apos;t see the &quot;puppies&quot; table, here, because it<br>
doesn&apos;t exit. That table is in another database, your user database. That&apos;s how<br>
databases work: they provide an area where you can create tables in which you&apos;ll<br>
store data. Different databases have different tables. You can&apos;t easily get at<br>
tables in another database from the one that you&apos;re currently in. And, really,<br>
you don&apos;t want to. Databases provide the storage and security boundaries for<br>
data.</p>
<p>Change back to your user database by executing the command <code>\c &#xAB;your user name&#xBB;</code>.</p>
<h2 class="mume-header" id="deleting-a-table">Deleting a table</h2>

<p>In the same way that you can delete users and databases by using the <code>DROP</code><br>
command, you can do the same for tables. To get rid of the &quot;puppies&quot; table,<br>
execute the following SQL command.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> puppies<span class="token punctuation">;</span>
</pre><p>It should tell you that it dropped the table. You can confirm that it is no<br>
longer there by executing the <code>\dt</code> command.</p>
<h2 class="mume-header" id="what-youve-done-1">What you&apos;ve done</h2>

<p>In this section, you learned the basics about creating database entities called<br>
&quot;tables&quot; and their ownership. You learned that tables are where you store data.<br>
You discovered that the data that you store is defined by the columns and their<br>
data types. You can now write SQL to create and drop tables.</p>
<p>Next up, you will learn about special kinds of columns, column constraints, and<br>
building relations between tables.</p>
<hr>
<h1 class="mume-header" id="table-management-walk-through-part-ii">Table Management Walk-Through - Part II</h1>

<p><strong>This is a walk-through</strong>: Please type along as you read what&apos;s going on in<br>
this article.</p>
<p>In this walk-through, you will</p>
<ul>
<li>Learn about nullable columns,</li>
<li>Learn about default values for columns,</li>
<li>Learn how to make columns have unique values,</li>
<li>Learn about primary keys, and,</li>
<li>Learn about relating tables through foreign keys to maintain data and<br>
referential integrity.</li>
</ul>
<p>Here is the &quot;puppies&quot; spreadsheet, table definition, and the SQL to create it<br>
from the last article.</p>
<p><img src="images/tables-puppies-spreadsheet.png" alt="Puppies spreadsheet"></p>
<table>
<thead>
<tr>
<th>Column</th>
<th>JavaScript data type</th>
<th>Max length</th>
<th>ANSI SQL data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>string</td>
<td>50</td>
<td>VARCHAR(50)</td>
</tr>
<tr>
<td>age_yrs</td>
<td colspan="2">number</td>

<td>NUMERIC(3,1)</td>
</tr>
<tr>
<td>breed</td>
<td>string</td>
<td>100</td>
<td>VARCHAR(100)</td>
</tr>
<tr>
<td>weight_lbs</td>
<td colspan="2">number</td>

<td>INTEGER</td>
</tr>
<tr>
<td>microchipped</td>
<td colspan="2">Boolean</td>

<td>BOOLEAN</td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  breed <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>In this article, you will add more specifications to this table so that you can<br>
properly use it. Then, you will refactor it into two tables that relate to one<br>
another.</p>
<h2 class="mume-header" id="nullable-columns">Nullable columns</h2>

<p>By default, when you define a table, each column does not require a value when<br>
you create a record (row). Look at the spreadsheet. You can see all of the rows<br>
in it have data in every column. The SQL that you wrote does not enforce that.</p>
<p>The value <code>NULL</code> is a strange value because it means <em>the absence of a value</em>.<br>
When a value in a row is <code>NULL</code>, that means that it didn&apos;t get entered. Many<br>
database administrators, experts in databases and the models of data in them,<br>
detest the value <code>NULL</code> for one reason: it adds a weird state.</p>
<p>Think about a Boolean value in JavaScript. It can one of two values: <code>true</code> or<br>
<code>false</code>. In databases, a &quot;nullable&quot; <code>BOOLEAN</code> column, that is a <code>BOOLEAN</code> column<br>
that can hold <code>NULL</code> values, can have <em>three</em> values in it: <code>TRUE</code>, <code>FALSE</code>, and<br>
<code>NULL</code>. What does that mean to you as a software developer? It is this weird<br>
third state that leads to a strange offshoot of mathematics named <a href="https://en.wikipedia.org/wiki/Three-valued_logic">three-valued<br>
logic</a>. To prevent that, you should (nearly) always put the <code>NOT NULL</code><br>
constraint on each of your column definitions. That will make your previous SQL<br>
statement look like this.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  breed <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Type that SQL into your <code>psql</code> shell and execute it. (If you already have a<br>
&quot;puppies&quot; table, drop the existing one first.) Then, run <code>\d puppies</code>. You<br>
will see, now, that the column &quot;Nullable&quot; reads &quot;not null&quot; for every single one.</p>
<pre data-role="codeBlock" data-info class="language-"><code>                         Table &quot;public.puppies&quot;
    Column    |          Type          | Collation | Nullable | Default
--------------+------------------------+-----------+----------+---------
 name         | character varying(50)  |           | not null |
 age_yrs      | numeric(3,1)           |           | not null |
 breed        | character varying(100) |           | not null |
 weight_lbs   | integer                |           | not null |
 microchipped | boolean                |           | not null |
</code></pre><p>Now, when someone tries to add data to the table, they must provide a value for<br>
every single column.</p>
<p><strong>Note</strong>: An empty string is <em>not</em> a <code>NULL</code> value. It is still possible for<br>
someone to insert the string &quot;&quot; into the &quot;name&quot; column, for example. There are<br>
ways to prevent that, but you should check it in your JavaScript code before<br>
actually inserting the data.</p>
<h2 class="mume-header" id="default-values">Default values</h2>

<p>Sometimes, you just want a column to have a default value. When there is a<br>
default value, the applications that insert data into the table can just rely<br>
on the default value and not have to specify it.</p>
<p>For the &quot;puppies&quot; table, a reasonable default value for the &quot;microchipped&quot;<br>
column would be <code>FALSE</code>. You can add that to your SQL using the <code>DEFAULT</code><br>
keyword.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  breed <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Drop the existing &quot;puppies&quot; table and type in that SQL. Then, run <code>\d puppies</code><br>
to see how it shows up in the table definition.</p>
<h2 class="mume-header" id="primary-keys">Primary keys</h2>

<p>Being able to identify a single row in a table is <em>very</em> important. Here&apos;s the<br>
screenshot of the spreadsheet, again.</p>
<p><img src="images/tables-puppies-spreadsheet.png" alt="Puppies spreadsheet"></p>
<p>Let&apos;s say that the puppy named &quot;Max&quot; gains a couple of pounds. You want to<br>
update the spreadsheet. You scan through the list of names and find it on row<br>
11. Then, you update the weight to be 69 pounds.</p>
<p>Now, what happens when you are tracking 300 dogs in the spreadsheet? What<br>
happens when your spreadsheet has 17 dogs named &quot;Max&quot;? It is helpful to have<br>
some way to uniquely identify a row in the spreadsheet. This is the idea behind<br>
a <strong>primary key</strong>. You can specify a column to be the primary key with the<br>
keywords <code>PRIMARY KEY</code>. A column that acts as a primary key cannot be <code>NULL</code>, so<br>
that is implied.</p>
<p>Here&apos;s the spreadsheet with a new column in it named &quot;id&quot; that just contains<br>
numbers to uniquely identify each row.</p>
<p><img src="https://appacademy-open-assets.s3-us-west-1.amazonaws.com/Module-SQL/assets/spreadsheet-puppies-with-primary-key.png" alt="Puppies spreadsheet with primary key"></p>
<p>You may ask yourself, &quot;Why can&apos;t I just use the row number as each row&apos;s<br>
identifier?&quot; That&apos;s a very valid question! Here is the reason why. You can see<br>
that &quot;Max&quot; has an &quot;id&quot; of 10 on row 11. What happens if you wanted to look at<br>
the data differently, say sorted by name? Here&apos;s what that spreadsheet looks<br>
like.</p>
<p><img src="images/spreadsheet-puppies-with-primary-key-sorted-by-name.png" alt="Puppies spreadsheet with primary key sorted by name"></p>
<p>You can see that when you sort them by name, if you relied on row number, &quot;Max&quot;<br>
now lives on row 10 rather than row 11. That changes the unique identifer of<br>
&quot;Max&quot; based on the way that you view the data. You want the unique identifier to<br>
<em>be part of the row definition</em> so that the number always stays with the row no<br>
matter how you&apos;ve sorted the data. You will always know that the row with &quot;id&quot;<br>
value of 10 is &quot;Max&quot;.</p>
<p>Keeping track of what the next number would be in that column could cause you a<br>
lot or headaches. What if two people (or applications) were entering data at the<br>
same time? Who would get the correct &quot;next id&quot; and still have it be unique? The<br>
answer to that is to let the database handle it. All databases have some way of<br>
specifying that you want to set the column to a special data type that will<br>
auto-assign and auto-increment an integer value for the column. In PostgreSQL,<br>
that special data type is called <code>SERIAL</code>.</p>
<p>Putting that all together, you would add a new column definition to your table<br>
with the name of &quot;id&quot; and the type <code>SERIAL</code>. Then, to specify that it is the<br>
primary key, you can do it one of two ways. The following example shows it as<br>
part of the column definition.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  id <span class="token keyword">SERIAL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  breed <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Or, you can put it in what is known as <strong>constraint syntax</strong> after the columns<br>
specifications but before the close parenthesis.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  id <span class="token keyword">SERIAL</span><span class="token punctuation">,</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  breed <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Either way you do it, when you view the output of <code>\d puppies</code>, you see some new<br>
things in the output.</p>
<pre data-role="codeBlock" data-info class="language-"><code>                                      Table &quot;public.puppies&quot;
    Column    |          Type          | Collation | Nullable |               Default
--------------+------------------------+-----------+----------+-------------------------------------
 id           | integer                |           | not null | nextval(&apos;puppies_id_seq&apos;::regclass)
 name         | character varying(50)  |           | not null |
 age_yrs      | numeric(3,1)           |           | not null |
 breed        | character varying(100) |           | not null |
 weight_lbs   | integer                |           | not null |
 microchipped | boolean                |           | not null | false
Indexes:
    &quot;puppies_pkey&quot; PRIMARY KEY, btree (id)
</code></pre><p>First, you&apos;ll notice that there is a weird default value for the &quot;id&quot; column.<br>
That&apos;s the way that PostgreSQL populates it with a new integer value every time<br>
you add a new row.</p>
<p>You will also see that that there is a section named &quot;Indexes&quot; after the column<br>
specifications. This shows that there is a thing named &quot;puppies_pkey&quot; which is<br>
the primary key on the column &quot;id&quot;.</p>
<h2 class="mume-header" id="unique-values">Unique values</h2>

<p>Sometimes, you want all of the data in a column to be unique. For example, if<br>
you a table of people records. You want to collect their email address for them<br>
to sign up for your Web site. In general, people don&apos;t share email addresses<br>
(although it has been known to happen). You can put a constraint on a column by<br>
putting <code>UNIQUE</code> in the column&apos;s definition. For example, here&apos;s a sample<br>
&quot;people&quot; table with a unique constraint on the email column.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> people <span class="token punctuation">(</span>
  id <span class="token keyword">SERIAL</span><span class="token punctuation">,</span>
  first_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>When you use the <code>\d people</code> command to view the definition of the table, you<br>
will see this.</p>
<pre data-role="codeBlock" data-info class="language-"><code>                                      Table &quot;public.people&quot;
   Column   |          Type          | Collation | Nullable |              Default
------------+------------------------+-----------+----------+------------------------------------
 id         | integer                |           | not null | nextval(&apos;people_id_seq&apos;::regclass)
 first_name | character varying(50)  |           | not null |
 last_name  | character varying(50)  |           | not null |
 email      | character varying(250) |           | not null |
Indexes:
    &quot;people_pkey&quot; PRIMARY KEY, btree (id)
    &quot;people_email_key&quot; UNIQUE CONSTRAINT, btree (email)
</code></pre><p>Down there at the bottom, you see that PostgreSQL has added a <code>UNIQUE CONSTRAINT</code> to the list of indexes for the &quot;email&quot; field. Now, if someone tried<br>
to put an email address into the table that someone had previously used, then<br>
the database would return an error.</p>
<pre data-role="codeBlock" data-info class="language-"><code>ERROR:  duplicate key value violates unique constraint &quot;people_email_key&quot;
DETAIL:  Key (email)=(a) already exists.
</code></pre><h2 class="mume-header" id="refactor-for-data-integrity">Refactor for data integrity</h2>

<p>Now is the time for thinking about the nature of the data. When you create<br>
database tables, you need to ask yourself about the data that you&apos;re going to<br>
store in them. One of the first questions that you should ask yourself is, &quot;Do<br>
any of the columns have values that come from a list?&quot; Or, another way to ask<br>
that is, &quot;Do any of the columns come from a set of predefined values?&quot; If you<br>
look at this data, does anything seem like it comes from a list, or that the<br>
data could repeat itself?</p>
<p>Take a look, again, at the spreadsheet. Does anything jump out at you?</p>
<p><img src="images/spreadsheet-puppies-with-primary-key-sorted-by-name.png" alt="Puppies spreadsheet with primary key sorted by name"></p>
<p>If you looked at it and answered &quot;the breed column&quot;, that&apos;s the ticket! The<br>
values that go into the breed column is finite. You don&apos;t want one person typing<br>
&quot;Corgi&quot; and another person typing &quot;CORGI&quot; and another &quot;corgi&quot; because, as you<br>
know, those are <em>three different values</em>! You want them all to be the same<br>
value! Supporting this is the primary reason that relational databases exist.</p>
<p>Instead of having just one table, you could have two tables. One that contains<br>
the puppy information and another that contains the breed information. Then,<br>
using the magic of relational databases, you can create a relation between the<br>
two tables so that the &quot;puppies&quot; table will reference entries in the &quot;breeds&quot;<br>
table.</p>
<p>This process is called <strong>normalization</strong>. It&apos;s a <em>really big deal</em> in database<br>
communities. And, it&apos;s a really big deal for application developers to maintain<br>
the integrity of the data. Bad data leads to bad applications.</p>
<p>To do this follows a fairly simple set of steps.</p>
<ol>
<li>Figure out what related data repeats itself. In this case, it is only the<br>
single column that contains the <strong>breed</strong> names.</li>
<li>Create a new table to hold that data. Make sure it has a primary key. In this<br>
case, you can create a &quot;breeds&quot; table that contains an &quot;id&quot; the name of the<br>
breed.</li>
<li>Replace all of the columns in the original table that you extracted with a<br>
single value that will contain the corresponding &quot;id&quot; value from the new<br>
table. In this case, you will replace the &quot;breed&quot; column with a column named<br>
&quot;breed_id&quot; because it will have the id of the specific breed from the<br>
&quot;breeds&quot; table.</li>
</ol>
<p>Here&apos;s what that would look like with two spreadsheets.</p>
<p>![Puppies and breed spreadsheets normalized]</p>
<p>You might think to yourself, &quot;That&apos;s not simpler! That&apos;s ... that&apos;s harder!&quot;<br>
From a human perspective looking at the two separate tables and associating the<br>
id in the &quot;breed_id&quot; column with the value in the &quot;id&quot; column of the &quot;breeds&quot;<br>
table to lookup the name of the breed <em>is</em> harder. But, SQL provides tools to<br>
make this <em>very easy</em>. You will learn about that in the homework, tonight, and<br>
in all of the database work that you&apos;ll be doing from here on out. Eventually,<br>
thinking this way about data will become second nature.</p>
<p>To represent this in SQL, you will need two SQL statements. The first one, the<br>
one for the &quot;breeds&quot; table, you should be able to construct that already with<br>
the knowledge that you have. It would look like this. Type this into your<br>
<code>plsql</code> shell.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> breeds <span class="token punctuation">(</span>
  id <span class="token keyword">SERIAL</span><span class="token punctuation">,</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now, here&apos;s the new thing. You want the database to make sure that the value in<br>
the &quot;breed_id&quot; column of the &quot;puppies&quot; table references the value in the &quot;id&quot;<br>
table of the &quot;breeds&quot; table. This reference is called a <strong>foreign key</strong>. That<br>
means that the value in the column <em>must exist</em> as the value of a primary key in<br>
the table that it references. This <strong>referential integrity</strong> is the backbone of<br>
relational databases. It prevents bad data from getting put into those foreign<br>
key columns.</p>
<p>Here&apos;s what the new &quot;puppies&quot; SQL looks like. Drop the old &quot;puppies&quot; table and<br>
type this SQL in there.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  id <span class="token keyword">SERIAL</span><span class="token punctuation">,</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  breed_id <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>breed_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> breeds<span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>That new thing at the bottom of the definition, that&apos;s how you relate one table<br>
to another. If follows the syntax</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>&#xAB;<span class="token keyword">column</span> name <span class="token operator">in</span> this <span class="token keyword">table</span>&#xBB;<span class="token punctuation">)</span>
  <span class="token keyword">REFERENCES</span> &#xAB;other <span class="token keyword">table</span> name&#xBB;<span class="token punctuation">(</span>&#xAB;<span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">column</span> <span class="token operator">in</span> other <span class="token keyword">table</span>&#xBB;<span class="token punctuation">)</span>
</pre><p>Looking at the spreadsheets, again, the presence of the foreign key would make<br>
it <em>impossible</em> for someone to enter a value in the &quot;breed_id&quot; column that did<br>
not exist in the &quot;id&quot; column of the &quot;breeds&quot; table.</p>
<p>![Puppies and breed spreadsheets normalized]</p>
<p>You can see that the puppies with ids of 1 and 9, &quot;Cooper&quot; and &quot;Leinni&quot;, both<br>
have the &quot;breed_id&quot; of 8. That means they&apos;re both &quot;Miniature Schnauzers&quot;. What<br>
if, originally, someone had misspelled &quot;Schnauzers&quot;? If it was still just a text<br>
column in the &quot;puppies&quot; sheet, you&apos;d have to go find and replace every single<br>
instance of the misspelling. Now, because it&apos;s only spelled once and then<br>
<em>referenced</em>, you would only need to update the misspelling in one place!</p>
<h2 class="mume-header" id="order-of-table-declarations">Order of table declarations</h2>

<p>The order of running these table definitions is important. Because &quot;puppies&quot;<br>
now relies on &quot;breeds&quot; to exist for that foreign key relationship, you <em>must</em><br>
create the &quot;breeds&quot; table first. If you had tried to create the &quot;puppies&quot; table<br>
first, you would see the following error message.</p>
<pre data-role="codeBlock" data-info class="language-"><code>ERROR: relation &quot;breeds&quot; does not exist
</code></pre><p>Now that you have both of those tables in your database, what do you think would<br>
happen if you tried to drop the &quot;breeds&quot; table? Another table depends on it.<br>
When you tried to drop a user that owned a database, you got an error because<br>
that database object depended on that user existing, the same things happens<br>
now.</p>
<p>Type the SQL to drop the &quot;breeds&quot; table from the database. You should see the<br>
following error message.</p>
<pre data-role="codeBlock" data-info class="language-"><code>ERROR:  cannot drop table breeds because other objects depend on it
DETAIL:  constraint puppies_breed_id_fkey on table puppies depends on table breeds
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
</code></pre><p>You can see that PostgreSQL has told you that other things depend on the<br>
&quot;breeds&quot; table and, specifically, a thing called &quot;puppies_breed_id_fkey&quot; depends<br>
on it. That is the auto-generated name for the foreign key that you created<br>
in the &quot;puppies&quot; table. It took the name of the table, the name of the column,<br>
and the string &quot;fkey&quot; and joined them all together with underscores.</p>
<p>In the homework for tomorrow, you will see how to <em>join</em> together two tables<br>
into one virtual table so that the breed names are right there along with the<br>
puppies data.</p>
<h2 class="mume-header" id="what-youve-done-2">What you&apos;ve done</h2>

<p>In this walk-through, you</p>
<ul>
<li>Learned about nullable columns and how to control that behavior by writing<br>
<code>NOT NULL</code> in your column specifications</li>
<li>Learned that <code>NULL</code> means an &quot;absence of a value&quot; which makes database<br>
administrators groan with displeasure</li>
<li>Learned about how to specify default values for a column</li>
<li>Learned the purpose of and how to declare integer-valued primary keys for a<br>
table using the <code>PRIMARY KEY</code> constraint and <code>SERIAL</code> data type</li>
<li>Learned about <em>normalization</em> and the steps to refactor a table to remove<br>
duplicated data</li>
<li>Learned the purpose of and how to declare foreign keys to relate the column of<br>
one table to the primary key of another table</li>
</ul>
<p>[Puppies and breed spreadsheets normalized]: images/spreadsheet-puppies-and-breeds-normalized.pngimages/spreadsheet-puppies-and-breeds-normalized.pngort &quot;[TOC]&quot; {cmd=&quot;toc&quot; depthFrom=2 depthTo=6 orderedList=false} --&gt;</p>
<hr>
<p><strong>This is a walk-through</strong>: Please type along as you read what&apos;s going on in<br>
this article.</p>
<p>In this walk-through, you will</p>
<ul>
<li>Learn about nullable columns,</li>
<li>Learn about default values for columns,</li>
<li>Learn how to make columns have unique values,</li>
<li>Learn about primary keys, and,</li>
<li>Learn about relating tables through foreign keys to maintain data and<br>
referential integrity.</li>
</ul>
<p>Here is the &quot;puppies&quot; spreadsheet, table definition, and the SQL to create it<br>
from the last article.</p>
<p><img src="images/tables-puppies-spreadsheet.png" alt="Puppies spreadsheet"></p>
<table>
<thead>
<tr>
<th>Column</th>
<th>JavaScript data type</th>
<th>Max length</th>
<th>ANSI SQL data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>string</td>
<td>50</td>
<td>VARCHAR(50)</td>
</tr>
<tr>
<td>age_yrs</td>
<td colspan="2">number</td>

<td>NUMERIC(3,1)</td>
</tr>
<tr>
<td>breed</td>
<td>string</td>
<td>100</td>
<td>VARCHAR(100)</td>
</tr>
<tr>
<td>weight_lbs</td>
<td colspan="2">number</td>

<td>INTEGER</td>
</tr>
<tr>
<td>microchipped</td>
<td colspan="2">Boolean</td>

<td>BOOLEAN</td>
</tr>
</tbody>
</table>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  breed <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>In this article, you will add more specifications to this table so that you can<br>
properly use it. Then, you will refactor it into two tables that relate to one<br>
another.</p>
<hr>
<h1 class="mume-header" id="database-management-project">Database Management Project</h1>

<p>This project asks you to write some SQL to make some tests pass. You must do<br>
them in order of the file name.</p>
<p>You&apos;ll be writing your SQL in *.sql files. This is just like writing it in the<br>
<code>psql</code> client. You put semicolons after each statement. But, you don&apos;t have to<br>
worry about silly mistakes because it&apos;s in a file and they&apos;re easy to fix.</p>
<h2 class="mume-header" id="instructions">Instructions</h2>

<ul>
<li>Clone the project from<br>
<a href="https://github.com/appacademy-starters/sql-database-management-starter">https://github.com/appacademy-starters/sql-database-management-starter</a>.</li>
<li><code>cd</code> into the project folder</li>
<li><code>npm install</code> to install dependencies in the project root directory</li>
<li><code>npm test</code> to run the specs</li>
<li>You can view the test cases in <code>test</code>. Your job is to write code in
<ul>
<li><strong>01-create-users.sql</strong> to write statements that will create users</li>
<li><strong>01-create-databases.sql</strong> to write statements that will create databases</li>
<li><strong>01-create-aa-times-tables.sql</strong> will create related tables in a database</li>
</ul>
</li>
</ul>
<hr>
<h1 class="mume-header undefined" id="week-10-day-2brdata-data-data">WEEK-10 DAY-2<br><em>Data! Data! Data!</em></h1>

<hr>
<h1 class="mume-header" id="sql-learning-objectives">SQL Learning Objectives</h1>

<p>SQL is the language of relational data. It is one of the core languages that<br>
most software developers know because of its prevalence in the industry due to<br>
the common use of RDBMSes. The objectives for your SQL learning journey cover:</p>
<ul>
<li>How to use the <code>SELECT ... FROM ...</code> statement to select data from a single<br>
table</li>
<li>How to use the <code>WHERE</code> clause on <code>SELECT</code>, <code>UPDATE</code>, and <code>DELETE</code> statements<br>
to narrow the scope of the command</li>
<li>How to use the <code>JOIN</code> keyword to join two (or more) tables together into a<br>
single virtual table</li>
<li>How to use the <code>INSERT</code> statement to insert data into a table</li>
<li>How to use an <code>UPDATE</code> statement to update data in a table</li>
<li>How to use a <code>DELETE</code> statement to remove data from a table</li>
<li>How to use a seed file to populate data in a database</li>
<li>How to perform relational database design</li>
<li>How to use transactions to group multiple SQL commands into one succeed or<br>
fail operation</li>
<li>How to apply indexes to tables to improve performance</li>
<li>Explain what and why someone would use <code>EXPLAIN</code></li>
<li>Demonstrate how to install and use the <strong>node-postgres</strong> library and its<br>
<code>Pool</code> class to query a PostgreSQL-managed database</li>
<li>Explain how to write prepared statements with placeholders for parameters<br>
of the form &quot;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant="normal">&quot;</mi><mo separator="true">,</mo><mi mathvariant="normal">&quot;</mi></mrow><annotation encoding="application/x-tex">1&quot;, &quot;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord">&quot;</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">&quot;</span></span></span></span>2&quot;, and so on</li>
</ul>
<hr>
<h1 class="mume-header" id="retrieving-rows-from-a-table-using-select">Retrieving Rows From A Table Using SELECT</h1>

<p>In the first reading, we covered SQL and PostgreSQL and how to set up<br>
PostgreSQL. In this reading, we&apos;re going to learn how to write a simple SQL<br>
query using SELECT.</p>
<h2 class="mume-header" id="what-is-a-query">What is a query?</h2>

<p>SQL stands for <em>Structured Query Language</em>, and whenever we write<br>
SQL we&apos;re usually querying a database. A query is simply a question we&apos;re<br>
asking a database, and we&apos;re aiming to get a response back. The response comes<br>
back to us as a list of table rows.</p>
<h2 class="mume-header" id="example-table">Example table</h2>

<p>Let&apos;s say we had the following database table called <code>puppies</code>. We&apos;ll use this<br>
table to make our queries:</p>
<p><em><strong>puppies table</strong></em></p>
<table>
<thead>
<tr>
<th>name</th>
<th>age_yrs</th>
<th>breed</th>
<th>weight_lbs</th>
<th>microchipped</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cooper</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>18</td>
<td>yes</td>
</tr>
<tr>
<td>Indie</td>
<td>0.5</td>
<td>Yorkshire Terrier</td>
<td>13</td>
<td>yes</td>
</tr>
<tr>
<td>Kota</td>
<td>0.7</td>
<td>Australian Shepherd</td>
<td>26</td>
<td>no</td>
</tr>
<tr>
<td>Zoe</td>
<td>0.8</td>
<td>Korean Jindo</td>
<td>32</td>
<td>yes</td>
</tr>
<tr>
<td>Charley</td>
<td>1.5</td>
<td>Basset Hound</td>
<td>25</td>
<td>no</td>
</tr>
<tr>
<td>Ladybird</td>
<td>0.6</td>
<td>Labradoodle</td>
<td>20</td>
<td>yes</td>
</tr>
<tr>
<td>Callie</td>
<td>0.9</td>
<td>Corgi</td>
<td>16</td>
<td>no</td>
</tr>
<tr>
<td>Jaxson</td>
<td>0.4</td>
<td>Beagle</td>
<td>19</td>
<td>yes</td>
</tr>
<tr>
<td>Leinni</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>25</td>
<td>yes</td>
</tr>
<tr>
<td>Max</td>
<td>1.6</td>
<td>German Shepherd</td>
<td>65</td>
<td>no</td>
</tr>
</tbody>
</table>
<h2 class="mume-header" id="using-psql-in-the-terminal">Using psql in the terminal</h2>

<p>As we covered in the first reading, psql allows us to access the PostgreSQL<br>
server and make queries via the terminal. Open up the terminal on your machine,<br>
and connect to the PostgreSQL server by using the following psql command:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql -U postgres
</pre><p>The above command lets you access the PostgreSQL server as the user &apos;postgres&apos;<br>
(<code>-U</code> stands for user). After you enter this command, you&apos;ll be prompted for the<br>
password that you set for the &apos;postgres&apos; user during installation. Type it in,<br>
and hit Enter. Once you&apos;ve successfully logged in, you should see the following<br>
in the terminal:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">Password <span class="token keyword">for</span> user postgres:
psql <span class="token punctuation">(</span>11.5, server 11.6<span class="token punctuation">)</span>
Type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> help.

postgres<span class="token operator">=</span><span class="token comment">#</span>
</pre><p>You can exit psql at anytime with the command <code>\q</code>, and you can log back in with<br>
<code>psql -U postgres</code>. (<em>See this <a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">Postgres Cheatsheet</a> for a list of more PSQL commands.</em>)</p>
<p>We&apos;ll use the following PostgreSQL to create the <code>puppies</code> table above. After<br>
you&apos;ve logged into the psql server, type the following code and hit Enter.</p>
<p><em><strong>puppies.sql</strong></em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> puppies <span class="token punctuation">(</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  breed <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INT</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> puppies
<span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token string">&apos;Cooper&apos;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&apos;Miniature Schnauzer&apos;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> puppies
<span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token string">&apos;Indie&apos;</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token string">&apos;Yorkshire Terrier&apos;</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Kota&apos;</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token string">&apos;Australian Shepherd&apos;</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token string">&apos;no&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Zoe&apos;</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">&apos;Korean Jindo&apos;</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Charley&apos;</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token string">&apos;Basset Hound&apos;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&apos;no&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Ladybird&apos;</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token string">&apos;Labradoodle&apos;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Callie&apos;</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token string">&apos;Corgi&apos;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">&apos;no&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Jaxson&apos;</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token string">&apos;Beagle&apos;</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Leinni&apos;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&apos;Miniature Schnauzer&apos;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Max&apos;</span><span class="token punctuation">,</span> <span class="token number">1.6</span><span class="token punctuation">,</span> <span class="token string">&apos;German Shepherd&apos;</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token string">&apos;no&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>In the above SQL, we created a new table called <code>puppies</code>, and we gave it the<br>
following columns: <code>name</code>, <code>age_yrs</code>, <code>breed</code>, <code>weight_lbs</code>, and <code>microchipped</code>.<br>
We filled the table with ten rows containing data for each puppy, by using<br>
<code>insert into puppies values ()</code>.</p>
<p>We used the following <a href="http://www.postgresqltutorial.com/postgresql-data-types/">PostgreSQL data types</a>: <code>VARCHAR</code>, <code>NUMERIC</code>, <code>INT</code>,<br>
and <code>BOOLEAN</code>.</p>
<ul>
<li><code>VARCHAR(n)</code> is a variable-length character string that lets you store up to<br>
<em>n</em> characters. Here we&apos;ve set the character limit to 100 for the <code>name</code> and<br>
<code>breed</code> columns.</li>
<li><code>NUMERIC(p,s)</code> is a floating-point number with <em>p</em> digits and <em>s</em> number of<br>
places after the decimal point. Here we&apos;ve set the values for the <code>age_yrs</code><br>
column to up to two digits before the decimal and one place after the decimal.</li>
<li><code>INT</code> is a 4-byte integer, which we&apos;ve set on the <code>weight_lbs</code> column.</li>
<li><code>BOOLEAN</code> is, of course, a Boolean value. We&apos;ve set the <code>microchipped</code> column<br>
to accept Boolean values. SQL accepts the standard Boolean values <code>true</code>,<br>
<code>false</code>, or <code>null</code>. However, you&apos;ll note that we&apos;ve used <code>yes</code> and <code>no</code> in our<br>
<code>microchipped</code> column because <a href="http://www.postgresqltutorial.com/postgresql-boolean/">PostgreSQL Booleans</a> can be any of the<br>
following values:</li>
</ul>
<table>
<thead>
<tr>
<th>TRUE</th>
<th>FALSE</th>
</tr>
</thead>
<tbody>
<tr>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>&apos;t&apos;</td>
<td>&apos;f&apos;</td>
</tr>
<tr>
<td>&apos;true&apos;</td>
<td>&apos;false&apos;</td>
</tr>
<tr>
<td>&apos;yes&apos;</td>
<td>&apos;no&apos;</td>
</tr>
<tr>
<td>&apos;y&apos;</td>
<td>&apos;n&apos;</td>
</tr>
<tr>
<td>&apos;1&apos;</td>
<td>&apos;0&apos;</td>
</tr>
</tbody>
</table>
<h2 class="mume-header" id="simple-select-query">Simple SELECT Query</h2>

<p>We can write a simple <a href="https://sqlzoo.net/wiki/SELECT_Reference">SELECT query</a> to get results back from the table<br>
above. The syntax for the SELECT query is <code>SELECT [columns] FROM [table]</code>.</p>
<h3 class="mume-header" id="select-all-rows">SELECT all rows</h3>

<p>Using <code>SELECT *</code> is a quick way to get back all the rows in a given table. It<br>
is discouraged in queries that you write for your applications. Use it only when<br>
playing around with data, not for production code.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span>   puppies<span class="token punctuation">;</span>
</pre><p>Type the query above into your psql terminal, and make sure to add a semicolon<br>
at the end, which terminates the statement. <code>SELECT</code> and <code>FROM</code> should be<br>
capitalized. The above query should give us back the entire <code>puppies</code> table:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>age_yrs</th>
<th>breed</th>
<th>weight_lbs</th>
<th>microchipped</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cooper</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>18</td>
<td>yes</td>
</tr>
<tr>
<td>Indie</td>
<td>0.5</td>
<td>Yorkshire Terrier</td>
<td>13</td>
<td>yes</td>
</tr>
<tr>
<td>Kota</td>
<td>0.7</td>
<td>Australian Shepherd</td>
<td>26</td>
<td>no</td>
</tr>
<tr>
<td>Zoe</td>
<td>0.8</td>
<td>Korean Jindo</td>
<td>32</td>
<td>yes</td>
</tr>
<tr>
<td>Charley</td>
<td>1.5</td>
<td>Basset Hound</td>
<td>25</td>
<td>no</td>
</tr>
<tr>
<td>Ladybird</td>
<td>0.6</td>
<td>Labradoodle</td>
<td>20</td>
<td>yes</td>
</tr>
<tr>
<td>Callie</td>
<td>0.9</td>
<td>Corgi</td>
<td>16</td>
<td>no</td>
</tr>
<tr>
<td>Jaxson</td>
<td>0.4</td>
<td>Beagle</td>
<td>19</td>
<td>yes</td>
</tr>
<tr>
<td>Leinni</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>25</td>
<td>yes</td>
</tr>
<tr>
<td>Max</td>
<td>1.6</td>
<td>German Shepherd</td>
<td>65</td>
<td>no</td>
</tr>
</tbody>
</table>
<h3 class="mume-header" id="select-by-column">SELECT by column</h3>

<p>We can see all the rows in a given column by using <code>SELECT [column name]</code>.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name
<span class="token keyword">FROM</span>   puppies<span class="token punctuation">;</span>
</pre><p>Type the query above into your psql terminal, and make sure to add a semicolon<br>
at the end, which terminates the statement. <code>SELECT</code> and <code>FROM</code> should be<br>
capitalized. The above query should give us back the following:</p>
<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cooper</td>
</tr>
<tr>
<td>Indie</td>
</tr>
<tr>
<td>Kota</td>
</tr>
<tr>
<td>Zoe</td>
</tr>
<tr>
<td>Charley</td>
</tr>
<tr>
<td>Ladybird</td>
</tr>
<tr>
<td>Callie</td>
</tr>
<tr>
<td>Jaxson</td>
</tr>
<tr>
<td>Leinni</td>
</tr>
<tr>
<td>Max</td>
</tr>
</tbody>
</table>
<h3 class="mume-header" id="select-multiple-columns">SELECT multiple columns</h3>

<p>To see multiple columns, we can concatenate the column names by using commas<br>
between column names.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name
     <span class="token punctuation">,</span> age_yrs
     <span class="token punctuation">,</span> weight_lbs
<span class="token keyword">FROM</span>   puppies<span class="token punctuation">;</span>
</pre><p>Type the query above into your psql terminal, and make sure to add a semicolon<br>
at the end, which terminates the statement. <code>SELECT</code> and <code>FROM</code> should be<br>
capitalized. The above query should give us back the following:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>age_yrs</th>
<th>weight_lbs</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cooper</td>
<td>1</td>
<td>18</td>
</tr>
<tr>
<td>Indie</td>
<td>0.5</td>
<td>13</td>
</tr>
<tr>
<td>Kota</td>
<td>0.7</td>
<td>26</td>
</tr>
<tr>
<td>Zoe</td>
<td>0.8</td>
<td>32</td>
</tr>
<tr>
<td>Charley</td>
<td>1.5</td>
<td>25</td>
</tr>
<tr>
<td>Ladybird</td>
<td>0.6</td>
<td>20</td>
</tr>
<tr>
<td>Callie</td>
<td>0.9</td>
<td>16</td>
</tr>
<tr>
<td>Jaxson</td>
<td>0.4</td>
<td>19</td>
</tr>
<tr>
<td>Leinni</td>
<td>1</td>
<td>25</td>
</tr>
<tr>
<td>Max</td>
<td>1.6</td>
<td>65</td>
</tr>
</tbody>
</table>
<h2 class="mume-header" id="formatting-select-statements">Formatting SELECT statements</h2>

<p>This is another of those hot-button topics with software developers. Some people<br>
like to put all the stuff on one line for each SQL keyword.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> age_yrs<span class="token punctuation">,</span> weight_lbs
<span class="token keyword">FROM</span>   puppies<span class="token punctuation">;</span>
</pre><p>That works for short lists. But some tables have hundreds of columns. That gets<br>
long.</p>
<p>Some developers like what you saw earlier, the &quot;each column name on its own line<br>
with the comma at the front&quot;.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name
     <span class="token punctuation">,</span> age_yrs
     <span class="token punctuation">,</span> weight_lbs
<span class="token keyword">FROM</span>   puppies<span class="token punctuation">;</span>
</pre><p>They like this because if they need to comment out a column name, they can just<br>
put a couple of dashes at the beginning of the line.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name
<span class="token comment">--     , age_yrs</span>
     <span class="token punctuation">,</span> weight_lbs
<span class="token keyword">FROM</span>   puppies<span class="token punctuation">;</span>
</pre><p>Some developers just do a word wrap when lines get too long.</p>
<p>All of these are fine. Just stay consistent within a project how you do them.</p>
<h2 class="mume-header" id="what-we-learned-1">What we learned:</h2>

<ul>
<li>What a query is</li>
<li>How to connect to the PostgreSQL server with psql</li>
<li>How to construct an example SQL table</li>
<li>PostgreSQL data types</li>
<li>How to write a simple SELECT query</li>
<li>How to SELECT all rows, rows by column, and rows by multiple columns</li>
</ul>
<hr>
<h1 class="mume-header" id="selecting-table-rows-using-where-and-common-operators">Selecting Table Rows Using WHERE And Common Operators</h1>

<p>In the last reading, we learned how to create a simple SQL query using SELECT.<br>
In this reading, we&apos;ll be adding a <a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">WHERE clause</a> to our SELECT statement to<br>
further filter a database table and get specific rows back.</p>
<h2 class="mume-header" id="using-select-and-where">Using SELECT and WHERE</h2>

<p>Previously, we covered how to use SELECT queries to fetch all of a table&apos;s rows<br>
or specified table rows by column(s). We can filter information returned by our query by using a WHERE clause in our SELECT statement.</p>
<p>Let&apos;s look at some examples of adding a WHERE clause using our <code>puppies</code> table<br>
from before:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>age_yrs</th>
<th>breed</th>
<th>weight_lbs</th>
<th>microchipped</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cooper</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>18</td>
<td>yes</td>
</tr>
<tr>
<td>Indie</td>
<td>0.5</td>
<td>Yorkshire Terrier</td>
<td>13</td>
<td>yes</td>
</tr>
<tr>
<td>Kota</td>
<td>0.7</td>
<td>Australian Shepherd</td>
<td>26</td>
<td>no</td>
</tr>
<tr>
<td>Zoe</td>
<td>0.8</td>
<td>Korean Jindo</td>
<td>32</td>
<td>yes</td>
</tr>
<tr>
<td>Charley</td>
<td>1.5</td>
<td>Basset Hound</td>
<td>25</td>
<td>no</td>
</tr>
<tr>
<td>Ladybird</td>
<td>0.6</td>
<td>Labradoodle</td>
<td>20</td>
<td>yes</td>
</tr>
<tr>
<td>Callie</td>
<td>0.9</td>
<td>Corgi</td>
<td>16</td>
<td>no</td>
</tr>
<tr>
<td>Jaxson</td>
<td>0.4</td>
<td>Beagle</td>
<td>19</td>
<td>yes</td>
</tr>
<tr>
<td>Leinni</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>25</td>
<td>yes</td>
</tr>
<tr>
<td>Max</td>
<td>1.6</td>
<td>German Shepherd</td>
<td>65</td>
<td>no</td>
</tr>
</tbody>
</table>
<h3 class="mume-header" id="where-clause-for-a-single-value">WHERE clause for a single value</h3>

<p>The simplest WHERE clause finds a row by a single column value. See the example<br>
below, which finds the rows where the breed equals &apos;Corgi&apos;:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">SELECT name, breed FROM puppies
  WHERE breed <span class="token operator">=</span> <span class="token string">&apos;Corgi&apos;</span><span class="token punctuation">;</span>
</pre><p><code>SELECT</code>, <code>FROM</code>, and <code>WHERE</code> are capitalized. Notice that the string must use<br>
single quotation marks. <em>Note: PostgreSQL converts all names of tables, columns,<br>
functions, etc. to lowercase unless they&apos;re double quoted.</em> For example:<br>
<code>create table Foo()</code> will create a table called <code>foo</code>, and <code>create table &quot;Bar&quot;()</code> will create a table called <code>Bar</code>. If you use double quotation marks in<br>
the query above, you&apos;ll get an error that says <code>column &quot;Corgi&quot; does not exist</code><br>
because it thinks you&apos;re searching for the capitalized column name <code>Corgi</code>.</p>
<p>Use the command <code>psql -U postgres</code> in the terminal, and type in your &apos;postgres&apos;<br>
user password to connect to the PostgreSQL server. You should have a puppies<br>
table in your postgres database from the last reading. Once you&apos;re in psql,<br>
enter the query above into the terminal and press Enter. You should get back one<br>
result for Callie the Corgi.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">  name  <span class="token operator">|</span> breed
--------+-------
 Callie <span class="token operator">|</span> Corgi
</pre><h3 class="mume-header" id="where-clause-for-a-list-of-values">WHERE clause for a list of values</h3>

<p>We can also add a WHERE clause to check for a list of values. The syntax is<br>
<code>WHERE [column] IN (&apos;value1&apos;, &apos;value2&apos;, &apos;value3&apos;)</code>. Let&apos;s say we wanted to find<br>
the name and breed of the puppies who are Corgis, Beagles, or Yorkshire<br>
Terriers. We could do so with the query below:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">SELECT name, breed FROM puppies
  WHERE breed IN <span class="token punctuation">(</span><span class="token string">&apos;Corgi&apos;</span>, <span class="token string">&apos;Beagle&apos;</span>, <span class="token string">&apos;Yorkshire Terrier&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Entering this query into psql should yield the following results:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">  name  <span class="token operator">|</span>       breed
--------+-------------------
 Indie  <span class="token operator">|</span> Yorkshire Terrier
 Callie <span class="token operator">|</span> Corgi
 Jaxson <span class="token operator">|</span> Beagle
</pre><h3>WHERE clause for a range of values</h3>
<p>In addition to checking for string values, we can use the WHERE clause to check<br>
for a range of numeric/integer values. This time, let&apos;s find the name, breed,<br>
and age of the puppies who are between 0 to 6 months old.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">SELECT name, breed, age_yrs FROM puppies
  WHERE age_yrs BETWEEN 0 AND 0.6<span class="token punctuation">;</span>
</pre><p>Entering this query into psql should yield the following results:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">   name   <span class="token operator">|</span>       breed       <span class="token operator">|</span> age_yrs
----------+-------------------+---------
 Indie    <span class="token operator">|</span> Yorkshire Terrier <span class="token operator">|</span>     0.5
 Ladybird <span class="token operator">|</span> Labradoodle       <span class="token operator">|</span>     0.6
 Jaxson   <span class="token operator">|</span> Beagle            <span class="token operator">|</span>     0.4
</pre><h2>ORDER BY</h2>
<p>Getting the values back from a database in any order it wants to give them to<br>
you is ludicrous. Instead, you will often want to specify the order in which<br>
you get them back. Say you wanted them in alphabetical order by their name.<br>
Then, you would write</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> breed
<span class="token keyword">FROM</span> puppies
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span>
</pre><p>Say you wanted that returned from oldest dog to youngest dog. You would write</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> breed
<span class="token keyword">FROM</span> puppies
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age_yrs <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</pre><p>where <code>DESC</code> means in descending order. Note that the column that you order on<br>
does not have to appear in the column list of the <code>SELECT</code> statement.</p>
<h2>LIMIT and OFFSET</h2>
<p>Say your query would return one million rows because you&apos;ve cataloged every<br>
puppy in the world. That would be a lot for any application to handle. Instead,<br>
you may want to limit the number of rows returned. You can do that with the<br>
<code>LIMIT</code> keyword.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> breed
<span class="token keyword">FROM</span> puppies
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age_yrs
<span class="token keyword">LIMIT</span> <span class="token number">100</span><span class="token punctuation">;</span>
</pre><p>That would return the name and breed of the 100 youngest puppies. (Why?) That<br>
is, of the million rows that the statement would find, it <em>limits</em> the number to<br>
only 100.</p>
<p>Let&apos;s say you want to see the <em>next</em> 100 puppies after the first hundred. You<br>
can do that with the <code>OFFSET</code> keyword which comes after the <code>LIMIT</code> clause.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> breed
<span class="token keyword">FROM</span> puppies
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> age_yrs
<span class="token keyword">LIMIT</span> <span class="token number">100</span> <span class="token keyword">OFFSET</span> <span class="token number">100</span><span class="token punctuation">;</span>
</pre><p>That will return only rows 101 - 200 of the result set. It <em>limits</em> the total<br>
number of records to return to 100. Then, it starts at the 100th row and counts<br>
100 records. Those are the records returned.</p>
<h2>SQL operators</h2>
<p>A SQL operator is a word or character that is used inside a WHERE clause to<br>
perform comparisons or arithmetic operations. In the three examples above, we<br>
used SQL operators inside of WHERE clauses to filter table rows -- <code>=</code>, <code>IN</code>,<br>
<code>BETWEEN</code>, and <code>AND</code>.</p>
<p>The following is a listing of SQL operators. We can combine any of these<br>
operators in our query or use a single operator by itself.</p>
<h3>Logical operators</h3>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ALL</td>
<td>TRUE if all of the subquery values meet the condition.</td>
</tr>
<tr>
<td>AND</td>
<td>TRUE if all the conditions separated by AND are TRUE.</td>
</tr>
<tr>
<td>ANY</td>
<td>TRUE if any of the subquery values meet the condition.</td>
</tr>
<tr>
<td>BETWEEN</td>
<td>TRUE if the operand is within the range of comparisons.</td>
</tr>
<tr>
<td>EXISTS</td>
<td>TRUE if the subquery returns one or more records.</td>
</tr>
<tr>
<td>IN</td>
<td>TRUE if the operand is equal to one of a list of expressions.</td>
</tr>
<tr>
<td>LIKE</td>
<td>TRUE if the operand matches a pattern (accepts &quot;wildcards&quot;).</td>
</tr>
<tr>
<td>NOT</td>
<td>Displays a record if the condition(s) is NOT TRUE.</td>
</tr>
<tr>
<td>OR</td>
<td>TRUE if any of the conditions separated by OR is TRUE.</td>
</tr>
<tr>
<td>SOME</td>
<td>TRUE if any of the subquery values meet the condition.</td>
</tr>
</tbody>
</table>
<p>Here is another example query with a WHERE clause using several logical<br>
operators: <code>NOT</code>, <code>IN</code>, <code>AND</code>, and <code>LIKE</code>.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">SELECT name, breed FROM puppies
  WHERE breed NOT IN <span class="token punctuation">(</span><span class="token string">&apos;Miniature Schnauzer&apos;</span>, <span class="token string">&apos;Basset Hound&apos;</span>, <span class="token string">&apos;Labradoodle&apos;</span><span class="token punctuation">)</span>
    AND breed NOT LIKE <span class="token string">&apos;%Shepherd&apos;</span><span class="token punctuation">;</span>
</pre><p><strong>Note</strong>: Pay attention to that <code>LIKE</code> operator. You will use it more than you<br>
want to. The wildcard it uses is the percent sign. Here&apos;s a table to help you<br>
understand.</p>
<table>
<thead>
<tr>
<th><code>LIKE</code></th>
<th>Matches &quot;dog&quot;</th>
<th>Matches &quot;hotdog&quot;</th>
<th>Matches &quot;dog-tired&quot;</th>
<th>Matches &quot;ordogordo&quot;</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&apos;dog&apos;</code></td>
<td>yes</td>
<td>no</td>
<td>no</td>
<td>no</td>
</tr>
<tr>
<td><code>&apos;%dog&apos;</code></td>
<td>yes</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
<tr>
<td><code>&apos;dog%&apos;</code></td>
<td>yes</td>
<td>no</td>
<td>yes</td>
<td>no</td>
</tr>
<tr>
<td><code>&apos;%dog%&apos;</code></td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p>Entering this query into psql should yield the following results:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">  name  <span class="token operator">|</span>       breed
--------+-------------------
 Indie  <span class="token operator">|</span> Yorkshire Terrier
 Zoe    <span class="token operator">|</span> Korean Jindo
 Callie <span class="token operator">|</span> Corgi
 Jaxson <span class="token operator">|</span> Beagle
</pre><p>With the query above, we filtered out six puppies: two Miniature Schnauzers, one<br>
Basset Hound, one Labradoodle, and two Shepherds. We started with ten puppies in<br>
the table, so we&apos;re left with four table rows. There are two puppies who are<br>
Shepherd breeds: an Australian Shepherd and a German Shepherd. We used the<br>
<code>LIKE</code> operator to filter these. In <code>&apos;%Shepherd</code>, the <code>%</code> matches any substring<br>
value before the substring &apos;Shepherd&apos;.</p>
<h3>Arithmetic operators</h3>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Meaning</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td>+</td>
<td>Addition</td>
<td>a + b</td>
</tr>
<tr>
<td>-</td>
<td>Subtraction</td>
<td>a - b</td>
</tr>
<tr>
<td>*</td>
<td>Multiplication</td>
<td>a * b</td>
</tr>
<tr>
<td>/</td>
<td>Division</td>
<td>a / b</td>
</tr>
<tr>
<td>%</td>
<td>Modulus (returns remainder)</td>
<td>a % b</td>
</tr>
</tbody>
</table>
<p>Here is an example query with a WHERE clause using the multiplication operator<br>
to find puppies that are 6 months old:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">SELECT name, breed, age_yrs FROM puppies
  WHERE age_yrs * 10 <span class="token operator">=</span> 6<span class="token punctuation">;</span>
</pre><p>Entering the above query into psql will yield one result:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">   name   <span class="token operator">|</span>    breed    <span class="token operator">|</span> age_yrs
----------+-------------+---------
 Ladybird <span class="token operator">|</span> Labradoodle <span class="token operator">|</span>     0.6
</pre><h3>Comparison operators</h3>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Meaning</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td>=</td>
<td>Equals</td>
<td>a = b</td>
</tr>
<tr>
<td>!=</td>
<td>Not equal to</td>
<td>a != b</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>Not equal to</td>
<td>a &lt;&gt; b</td>
</tr>
<tr>

<td colspan="2">Greater than</td>
<td>a &gt; b</td>
</tr>
<tr>
<td>&lt;</td>
<td>Less than</td>
<td>a &lt; b</td>
</tr>
<tr>
<td>&gt;=</td>
<td>Greater than or equal to</td>
<td>a &gt;= b</td>
</tr>
<tr>
<td>&lt;=</td>
<td>Less than or equal to</td>
<td>a &lt;= b</td>
</tr>
<tr>
<td>!&lt;</td>
<td>Not less than</td>
<td>a !&lt; b</td>
</tr>
<tr>
<td>!&gt;</td>
<td>Not greater than</td>
<td>a !&gt; b</td>
</tr>
</tbody>
</table>
<p>Here is an example query with a WHERE clause using the <code>&gt;</code> comparison operator:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">SELECT name, breed, weight_lbs FROM puppies
  WHERE weight_lbs <span class="token operator">&gt;</span> 50<span class="token punctuation">;</span>
</pre><p>Entering the above query into psql will yield one result:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"> name <span class="token operator">|</span>      breed      <span class="token operator">|</span> weight_lbs
------+-----------------+------------
 Max  <span class="token operator">|</span> German Shepherd <span class="token operator">|</span>         65
</pre><h2 class="mume-header" id="what-we-learned-2">What we learned:</h2>

<ul>
<li>How to use a WHERE clause in a SELECT query</li>
<li>How to construct WHERE clauses matching a single value, a list of values, and<br>
a range of values</li>
<li>What SQL operators are</li>
<li>How to use logical operators, arithmetic operators, and comparison operators</li>
</ul>
<hr>
<h1 class="mume-header" id="inserting-data-into-a-table">Inserting Data Into A Table</h1>

<hr>
<p>If you have data, but it&#x2019;s not in tables, does the data even exist? Not to an<br>
app! We often need to create relational databases on the back end of the Web<br>
apps we&#x2019;re building so that we can ultimately display this data on the front<br>
end of our application. All relational database data is stored in tables, so<br>
it&#x2019;s important to learn how to create tables and successfully query them.</p>
<p>Of the four data manipulation statements, <code>INSERT</code> is the easiest.</p>
<p>Create a new database named &quot;folks&quot;. Now, create a new table named &quot;friends&quot;<br>
with the following column specifications.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Data type</th>
<th>Constraints</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td><code>SERIAL</code></td>
<td><code>PRIMARY KEY</code></td>
</tr>
<tr>
<td>first_name</td>
<td><code>VARCHAR(255)</code></td>
<td><code>NOT NULL</code></td>
</tr>
<tr>
<td>last_name</td>
<td><code>VARCHAR(255)</code></td>
<td><code>NOT NULL</code></td>
</tr>
</tbody>
</table>
<p>Now that we have a new table, we need to add table rows with some data. We can<br>
insert a new table row using the following syntax:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">INSERT INTO table_name
VALUES
  <span class="token punctuation">(</span>column1_value, colum2_value, column3_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Let&#x2019;s fill out our &#x201C;friends&#x201D; table with information about five friends. In<br>
psql, enter the following to add new table rows. <em>Note the use of single<br>
quotation marks for string values. Also note that, since we used the <a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546"><code>SERIAL</code><br>
pseudo-type</a> to auto-increment the ID values, we can simply write <code>DEFAULT</code><br>
for the ID values when inserting new table rows.</em></p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">INSERT INTO friends <span class="token punctuation">(</span>id, first_name, last_name<span class="token punctuation">)</span>
VALUES
  <span class="token punctuation">(</span>DEFAULT, <span class="token string">&apos;Amy&apos;</span>, <span class="token string">&apos;Pond&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>You can also completely omit the <code>DEFAULT</code> keyword if you specify the names of<br>
the columns that you want to insert into.</p>
<p>You can also use the &quot;multiple values&quot; insert. This prevents you from having to<br>
write <code>INSERT</code> with every statement. Even better, if one fails, they all fail.<br>
That can help protect your data integrity.</p>
<pre data-role="codeBlock" data-info class="language-"><code>INSERT INTO friends (first_name, last_name)
VALUES
(&apos;Rose&apos;, &apos;Tyler&apos;),
(&apos;Martha&apos;, &apos;Jones&apos;),
(&apos;Donna&apos;, &apos;Noble&apos;),
(&apos;River&apos;, &apos;Song&apos;);
</code></pre><p>Use <code>SELECT * FROM friends;</code> to verify that there are rows in the &#x201C;friends&#x201D;<br>
table:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">appacademy<span class="token operator">=</span><span class="token comment"># SELECT * FROM friends;</span>
 <span class="token function">id</span> <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name
----+------------+-----------
  1 <span class="token operator">|</span> Amy        <span class="token operator">|</span> Pond
  2 <span class="token operator">|</span> Rose       <span class="token operator">|</span> Tyler
  3 <span class="token operator">|</span> Martha     <span class="token operator">|</span> Jones
  4 <span class="token operator">|</span> Donna      <span class="token operator">|</span> Noble
  5 <span class="token operator">|</span> River      <span class="token operator">|</span> Song
</pre><p>Now let&#x2019;s try to insert a new row using the ID of 5:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">INSERT INTO friends <span class="token punctuation">(</span>id, first_name, last_name<span class="token punctuation">)</span>
VALUES <span class="token punctuation">(</span>5, <span class="token string">&apos;Jenny&apos;</span>, <span class="token string">&apos;Who&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Because ID is a primary key and that ID is already taken, we should get a<br>
message in psql that it already exists:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">appacademy<span class="token operator">=</span><span class="token comment"># insert into friends values (5, &apos;Jenny&apos;, &apos;Who&apos;);</span>
ERROR:  duplicate key value violates unique constraint <span class="token string">&quot;friends_pkey&quot;</span>
DETAIL:  Key <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>5<span class="token punctuation">)</span> already exists.
</pre><h2 class="mume-header" id="what-we-learned-3">What we learned:</h2>

<ul>
<li>How to connect to an existing PostgreSQL database</li>
<li>How to create a new PostgreSQL database</li>
<li>How to create a new database table</li>
<li>Accepted PostgreSQL data types</li>
<li>How to add new rows to a database table</li>
<li>What a primary key is/does</li>
</ul>
<hr>
<h1 class="mume-header" id="foreign-keys-and-the-join-operation">Foreign Keys And The JOIN Operation</h1>

<p>In relational databases, <em>relationships</em> are key. We can create relationships,<br>
or <em>associations</em>, among tables so that they can access and share data. In a<br>
SQL database, we create table associations through <em>foreign keys</em> and <em>primary<br>
keys</em>.</p>
<p>You&apos;ve learned about primary and foreign keys. Now, it&apos;s time to put them to<br>
use.</p>
<h2 class="mume-header" id="setting-up-the-database">Setting up the database</h2>

<p>Create a new database called &quot;learn_joins&quot;. Connect to that database. Run the<br>
following SQL statements to create tables and the data in them.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> breeds <span class="token punctuation">(</span>
  id <span class="token keyword">SERIAL</span><span class="token punctuation">,</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> breeds <span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token string">&apos;Australian Shepherd&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Basset Hound&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Beagle&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Corgi&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;German Shepherd&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Korean Jindo&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Labradoodle&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Miniature Schnauzer&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Yorkshire Terrier&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  id <span class="token keyword">SERIAL</span><span class="token punctuation">,</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  breed_id <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>breed_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> breeds<span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> puppies <span class="token punctuation">(</span>name<span class="token punctuation">,</span> age_yrs<span class="token punctuation">,</span> breed_id<span class="token punctuation">,</span> weight_lbs<span class="token punctuation">,</span> microchipped<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token string">&apos;Cooper&apos;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Indie&apos;</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Kota&apos;</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Zoe&apos;</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Charley&apos;</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Ladybird&apos;</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Callie&apos;</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Jaxson&apos;</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Leinni&apos;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Max&apos;</span><span class="token punctuation">,</span> <span class="token number">1.6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="using-join-to-retrieve-rows-from-multiple-tables">Using JOIN to retrieve rows from multiple tables</h2>

<p>Now that we&#x2019;ve set up an association between the &#x201C;puppies&#x201D; table and the<br>
&#x201C;friends&#x201D; table, we can access data from both tables. We can do so by using a<br>
<a href="http://www.postgresqltutorial.com/postgresql-boolean/">JOIN operation</a> in our SELECT query. Type the following into psql:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> puppies
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> breeds <span class="token keyword">ON</span> <span class="token punctuation">(</span>puppies<span class="token punctuation">.</span>breed_id <span class="token operator">=</span> breeds<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>JOIN</code> operation above is joining the &quot;puppies&quot; table with the &quot;breeds&quot;<br>
table together into a single table using the foreign key/primary key shared<br>
between the two tables: <code>breed_id</code>.</p>
<p>You should get all rows back containing all information for the puppies and<br>
breeds with matching <code>breed_id</code> values:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">postgres<span class="token operator">=</span><span class="token comment"># SELECT * FROM puppies</span>
postgres<span class="token operator">-</span><span class="token comment"># INNER JOIN breeds ON (puppies.breed_id = breeds.id);</span>
 id <span class="token operator">|</span>   name   <span class="token operator">|</span> age_yrs <span class="token operator">|</span> breed_id <span class="token operator">|</span> weight_lbs <span class="token operator">|</span> microchipped <span class="token operator">|</span> id <span class="token operator">|</span>        name
<span class="token comment">----+----------+---------+----------+------------+--------------+----+---------------------</span>
  <span class="token number">1</span> <span class="token operator">|</span> Cooper   <span class="token operator">|</span>     <span class="token number">1.0</span> <span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span>         <span class="token number">18</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> Miniature Schnauzer
  <span class="token number">2</span> <span class="token operator">|</span> Indie    <span class="token operator">|</span>     <span class="token number">0.5</span> <span class="token operator">|</span>        <span class="token number">9</span> <span class="token operator">|</span>         <span class="token number">13</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> Yorkshire Terrier
  <span class="token number">3</span> <span class="token operator">|</span> Kota     <span class="token operator">|</span>     <span class="token number">0.7</span> <span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">26</span> <span class="token operator">|</span> f            <span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> Australian Shepherd
  <span class="token number">4</span> <span class="token operator">|</span> Zoe      <span class="token operator">|</span>     <span class="token number">0.8</span> <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>         <span class="token number">32</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> Korean Jindo
  <span class="token number">5</span> <span class="token operator">|</span> Charley  <span class="token operator">|</span>     <span class="token number">1.5</span> <span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span>         <span class="token number">25</span> <span class="token operator">|</span> f            <span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> Basset Hound
  <span class="token number">6</span> <span class="token operator">|</span> Ladybird <span class="token operator">|</span>     <span class="token number">0.6</span> <span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span>         <span class="token number">20</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> Labradoodle
  <span class="token number">7</span> <span class="token operator">|</span> Callie   <span class="token operator">|</span>     <span class="token number">0.9</span> <span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span>         <span class="token number">16</span> <span class="token operator">|</span> f            <span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> Corgi
  <span class="token number">8</span> <span class="token operator">|</span> Jaxson   <span class="token operator">|</span>     <span class="token number">0.4</span> <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>         <span class="token number">19</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> Beagle
  <span class="token number">9</span> <span class="token operator">|</span> Leinni   <span class="token operator">|</span>     <span class="token number">1.0</span> <span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span>         <span class="token number">25</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> Miniature Schnauzer
 <span class="token number">10</span> <span class="token operator">|</span> Max      <span class="token operator">|</span>     <span class="token number">1.6</span> <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>         <span class="token number">65</span> <span class="token operator">|</span> f            <span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> German Shepherd
<span class="token punctuation">(</span><span class="token number">10</span> <span class="token keyword">rows</span><span class="token punctuation">)</span>
</pre><p>We could make our query more specific by selecting specific columns, adding a<br>
<code>WHERE</code> clause, or doing any number of operations that we could do in a normal<br>
<code>SELECT</code> query. Aside from an <code>INNER JOIN</code>, we could also do different types of<br>
<code>JOIN</code> operations. (Refer to this overview on <a href="https://sqlzoo.net/wiki/SELECT_Reference">PostgreSQL JOINS</a> for more<br>
information.)</p>
<h2 class="mume-header" id="what-we-learned-4">What we learned:</h2>

<ul>
<li>What a foreign key is/does</li>
<li>How to create a foreign key</li>
<li>How to alter/update an existing table</li>
<li>How to use the JOIN operation to get rows from two tables</li>
</ul>
<h2 class="mume-header" id="helpful-links">Helpful links:</h2>

<ul>
<li><a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">PostgreSQL Docs: Constraints</a></li>
<li><a href="http://www.postgresqltutorial.com/postgresql-data-types/">PostgreSQL Docs: Data Types &gt; Numeric Types</a></li>
<li><a href="http://www.postgresqltutorial.com/postgresql-boolean/">PostgreSQL Docs: Joins Between Tables</a></li>
<li><a href="https://sqlzoo.net/wiki/SELECT_Reference">PostgreSQL Tutorial: PostgreSQL Joins</a></li>
</ul>
<hr>
<h1 class="mume-header" id="writing-and-running-a-seed-file-in-psql">Writing And Running A Seed File In PSQL</h1>

<p>After a database is created, we need to populate it, or <em>seed</em> it, with data.<br>
Until now, we&#x2019;ve used the command-line psql interface to create tables and<br>
insert rows into those tables. While that&#x2019;s fine for small datasets, it would<br>
be cumbersome to add a large dataset using the command line.</p>
<p>In this reading, we&#x2019;ll learn how to create and run a seed file, which makes the<br>
process of populating a database with test data much easier.</p>
<h2 class="mume-header" id="creating-a-seed-file">Creating a seed file</h2>

<p>You can create a seed file by opening up VSCode or any text editor and saving a<br>
file with the <code>.sql</code> extension.</p>
<p>Let&#x2019;s create a seed file called <code>seed-data.sql</code> that&#x2019;s going to create a new<br>
table called <code>pies</code> and insert 50 pie rows into the table. Use the code below<br>
to create the seed file, and make sure to save your seed file on your machine.</p>
<p><em><strong>seed-data.sql</strong></em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> pies <span class="token punctuation">(</span>
  flavor <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  price <span class="token keyword">FLOAT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Apple&apos;</span><span class="token punctuation">,</span> <span class="token number">19.95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Caramel Apple Crumble&apos;</span><span class="token punctuation">,</span> <span class="token number">20.53</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Blueberry&apos;</span><span class="token punctuation">,</span> <span class="token number">19.31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Blackberry&apos;</span><span class="token punctuation">,</span> <span class="token number">22.86</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Cherry&apos;</span><span class="token punctuation">,</span> <span class="token number">22.32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Peach&apos;</span><span class="token punctuation">,</span> <span class="token number">20.45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Raspberry&apos;</span><span class="token punctuation">,</span> <span class="token number">20.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Mixed Berry&apos;</span><span class="token punctuation">,</span> <span class="token number">21.45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Strawberry Rhubarb&apos;</span><span class="token punctuation">,</span> <span class="token number">24.81</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Banana Cream&apos;</span><span class="token punctuation">,</span> <span class="token number">18.66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Boston Toffee&apos;</span><span class="token punctuation">,</span> <span class="token number">25.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Banana Nutella&apos;</span><span class="token punctuation">,</span> <span class="token number">22.12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Bananas Foster&apos;</span><span class="token punctuation">,</span> <span class="token number">24.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Boston Cream&apos;</span><span class="token punctuation">,</span> <span class="token number">23.75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Cookies and Cream&apos;</span><span class="token punctuation">,</span> <span class="token number">18.27</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Coconut Cream&apos;</span><span class="token punctuation">,</span> <span class="token number">22.89</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Chess&apos;</span><span class="token punctuation">,</span> <span class="token number">25.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Lemon Chess&apos;</span><span class="token punctuation">,</span> <span class="token number">25.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Key Lime&apos;</span><span class="token punctuation">,</span> <span class="token number">19.34</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Lemon Meringue&apos;</span><span class="token punctuation">,</span> <span class="token number">19.58</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Guava&apos;</span><span class="token punctuation">,</span> <span class="token number">18.92</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Mango&apos;</span><span class="token punctuation">,</span> <span class="token number">19.55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Plum&apos;</span><span class="token punctuation">,</span> <span class="token number">20.21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Apricot&apos;</span><span class="token punctuation">,</span> <span class="token number">20.55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Gooseberry&apos;</span><span class="token punctuation">,</span> <span class="token number">23.54</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Lingonberry&apos;</span><span class="token punctuation">,</span> <span class="token number">24.35</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Pear Vanilla Butterscotch&apos;</span><span class="token punctuation">,</span> <span class="token number">25.13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Baked Alaska&apos;</span><span class="token punctuation">,</span> <span class="token number">25.71</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Chocolate&apos;</span><span class="token punctuation">,</span> <span class="token number">19.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Chocolate Mousse&apos;</span><span class="token punctuation">,</span> <span class="token number">21.46</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Mexican Chocolate&apos;</span><span class="token punctuation">,</span> <span class="token number">28.33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Chocolate Caramel&apos;</span><span class="token punctuation">,</span> <span class="token number">26.67</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Chocolate Chip Cookie Dough&apos;</span><span class="token punctuation">,</span> <span class="token number">18.65</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Pecan&apos;</span><span class="token punctuation">,</span> <span class="token number">26.33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Bourbon Caramel Pecan&apos;</span><span class="token punctuation">,</span> <span class="token number">27.88</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Chocolate Pecan&apos;</span><span class="token punctuation">,</span> <span class="token number">27.63</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Pumpkin&apos;</span><span class="token punctuation">,</span> <span class="token number">20.91</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Sweet Potato&apos;</span><span class="token punctuation">,</span> <span class="token number">20.75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Purple Sweet Potato&apos;</span><span class="token punctuation">,</span> <span class="token number">26.34</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Cheesecake&apos;</span><span class="token punctuation">,</span> <span class="token number">28.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Butterscotch Praline&apos;</span><span class="token punctuation">,</span> <span class="token number">29.78</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Salted Caramel&apos;</span><span class="token punctuation">,</span> <span class="token number">30.32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Salted Honey&apos;</span><span class="token punctuation">,</span> <span class="token number">59.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Sugar Cream&apos;</span><span class="token punctuation">,</span> <span class="token number">33.89</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Mississippi Mud&apos;</span><span class="token punctuation">,</span> <span class="token number">28.67</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Turtle Fudge&apos;</span><span class="token punctuation">,</span> <span class="token number">30.58</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Fruit Loops&apos;</span><span class="token punctuation">,</span> <span class="token number">20.45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Black Forest&apos;</span><span class="token punctuation">,</span> <span class="token number">34.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Maple Cream&apos;</span><span class="token punctuation">,</span> <span class="token number">35.88</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Smores&apos;</span><span class="token punctuation">,</span> <span class="token number">26.43</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pies <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Milk Bar&apos;</span><span class="token punctuation">,</span> <span class="token number">46.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> pies<span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="populating-a-database-via-left-caret">Populating a database via &lt; (&#x201C;left caret&#x201D;)</h2>

<p>Now that you have a seed file, you can insert it into a database with a<br>
simple command.</p>
<p>Create a database named &quot;bakery&quot;.</p>
<p>The syntax is <code>psql -d [database] &lt; [path_to_file/file.sql]</code>. The left caret<br>
(<code>&lt;</code>) takes the standard input from the file on the right (your seed file) and<br>
inputs it into the program on the left (<code>psql</code>).</p>
<p>Open up your terminal, and enter the following command. Make sure to replace<br>
<code>path_to_my_file</code> with the actual file path.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">psql -d bakery <span class="token operator">&lt;</span> path_to_my_file/seed-data.sql
</pre><p>In the terminal, you should see a bunch of <code>INSERT</code> statements and the entire<br>
&#x201C;pies&#x201D; table printed out (from the <code>SELECT *</code> query in the seed file).</p>
<p>You can log into psql and use <code>\dt</code> to verify that your new table has been<br>
added to the database:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">postgres<span class="token operator">=</span><span class="token comment"># \dt</span>
List of relations
 Schema <span class="token operator">|</span>     Name     <span class="token operator">|</span> Type  <span class="token operator">|</span>  Owner
 public <span class="token operator">|</span> breeds       <span class="token operator">|</span> table <span class="token operator">|</span> appacademy
 public <span class="token operator">|</span> pies         <span class="token operator">|</span> table <span class="token operator">|</span> appacademy
 public <span class="token operator">|</span> puppies      <span class="token operator">|</span> table <span class="token operator">|</span> appacademy
</pre><h2 class="mume-header" id="populating-the-database-via-pipe">Populating the database via | (&#x201C;pipe&#x201D;)</h2>

<p>You could also use the &#x201C;pipe&#x201D; (<code>|</code>) to populate the database with your seed<br>
file.</p>
<p>The syntax is <code>cat [path_to_file/file.sql] | psql -d [database]</code>. &#x2018;cat&#x2019; is a<br>
standard Unix utility that reads files sequentially, writing them to standard<br>
output. The &#x201C;pipe&#x201D; (<code>|</code>) takes the standard output of the command on the left<br>
and pipes it as standard input to the command on the right.</p>
<p>Try out this method in your terminal. If you have an existing &#x201C;pies&#x201D; table,<br>
you&#x2019;ll need to drop this table before you can add it again:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> pies<span class="token punctuation">;</span>
</pre><p>Then, enter the following. Make sure to replace <code>path_to_my_file</code> with the<br>
actual file path.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">cat</span> path_to_my_file/seed-data.sql <span class="token operator">|</span> psql -d postgres
</pre><p>Again, you should see a bunch of <code>INSERT</code> statements and the entire &#x201C;pies&#x201D;<br>
table printed out (from the <code>SELECT *</code> query in the seed file).</p>
<p>You can log into psql and use <code>\dt</code> to verify that your new table has been<br>
added to the database:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">postgres<span class="token operator">=</span><span class="token comment"># \dt</span>
List of relations
 Schema <span class="token operator">|</span>     Name     <span class="token operator">|</span> Type  <span class="token operator">|</span>  Owner
 public <span class="token operator">|</span> friends      <span class="token operator">|</span> table <span class="token operator">|</span> postgres
 public <span class="token operator">|</span> pies         <span class="token operator">|</span> table <span class="token operator">|</span> postgres
 public <span class="token operator">|</span> puppies      <span class="token operator">|</span> table <span class="token operator">|</span> postgres
</pre><h2 class="mume-header" id="what-we-learned-5">What we learned:</h2>

<ul>
<li>What a seed file is</li>
<li>How to create a seed file</li>
<li>How to populate a database with a seed file using &lt;</li>
<li>How to populate a database with a seed file using |</li>
</ul>
<hr>
<h1 class="mume-header" id="create-and-seed-a-database-project">Create And Seed A Database Project</h1>

<p>In our SQL readings, we installed PostgreSQL, and we learned how to create a new<br>
PostgreSQL database and how to create and run a seed file in our database.</p>
<p>In this project, you&apos;ll practice seeding your database with a seed file that&apos;s<br>
full of, well, <em>seeds</em>! Hopefully when you&apos;re done, you&apos;ll have <em>grown</em> your SQL<br>
knowledge.</p>
<h2 class="mume-header" id="project-overview">Project overview</h2>

<p>Practice creating a new database and piping a seed file into your database.</p>
<ul>
<li>In Phase 1, you&apos;ll create a new database.</li>
<li>In Phase 2, you&apos;ll create a new seed data file.</li>
<li>In Phase 3, you&apos;ll pipe your seed data in your database via <code>psql</code> on the<br>
command line.</li>
</ul>
<h2 class="mume-header" id="phase-1-create-a-new-database">Phase 1: Create a new database</h2>

<p>First, log into <code>psql</code> on the command line as your user.</p>
<p>Second, create a new database in PostgreSQL called <code>farm</code> by using the following<br>
syntax:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span>databasename<span class="token punctuation">]</span><span class="token punctuation">;</span>
</pre><p><em>Note:</em> You can check to make sure you&apos;ve created a new database by viewing the<br>
list of databases with <code>\l</code>.</p>
<h2 class="mume-header" id="phase-2-create-a-seeds-seed-file">Phase 2: Create a seeds seed file</h2>

<p>Create a seed file full of seeds! Set up a SQL file with seed data that will<br>
produce two tables: an &quot;edible_seeds&quot; with 40 rows and a &quot;flower_seeds&quot; table<br>
with 20 rows.</p>
<p><strong>Edible Seeds</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>type</th>
<th>price_per_pound</th>
<th>in_stock</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chia</td>
<td>Pseudocereal</td>
<td>6.95</td>
<td>yes</td>
</tr>
<tr>
<td>2</td>
<td>Flax</td>
<td>Pseudocereal</td>
<td>6.90</td>
<td>yes</td>
</tr>
<tr>
<td>3</td>
<td>Amaranth</td>
<td>Pseudocereal</td>
<td>14.99</td>
<td>yes</td>
</tr>
<tr>
<td>4</td>
<td>Quinoa</td>
<td>Pseudocereal</td>
<td>12.49</td>
<td>no</td>
</tr>
<tr>
<td>5</td>
<td>Sesame</td>
<td>Pseudocereal</td>
<td>13.49</td>
<td>yes</td>
</tr>
<tr>
<td>6</td>
<td>Hemp</td>
<td>Other</td>
<td>10.99</td>
<td>yes</td>
</tr>
<tr>
<td>7</td>
<td>Chickpea</td>
<td>Legume</td>
<td>7.99</td>
<td>yes</td>
</tr>
<tr>
<td>8</td>
<td>Pea</td>
<td>Legume</td>
<td>7.50</td>
<td>no</td>
</tr>
<tr>
<td>9</td>
<td>Soybean</td>
<td>Legume</td>
<td>12.99</td>
<td>yes</td>
</tr>
<tr>
<td>10</td>
<td>Acorn</td>
<td>Nut</td>
<td>11.99</td>
<td>yes</td>
</tr>
<tr>
<td>11</td>
<td>Almond</td>
<td>Nut</td>
<td>13.99</td>
<td>yes</td>
</tr>
<tr>
<td>12</td>
<td>Beech</td>
<td>Nut</td>
<td>10.94</td>
<td>yes</td>
</tr>
<tr>
<td>13</td>
<td>Chestnut</td>
<td>Nut</td>
<td>13.99</td>
<td>yes</td>
</tr>
<tr>
<td>14</td>
<td>Water Chestnut</td>
<td>Nut</td>
<td>9.99</td>
<td>no</td>
</tr>
<tr>
<td>15</td>
<td>Macadamia</td>
<td>Nut</td>
<td>25.00</td>
<td>yes</td>
</tr>
<tr>
<td>16</td>
<td>Pistachio</td>
<td>Nut</td>
<td>20.00</td>
<td>yes</td>
</tr>
<tr>
<td>17</td>
<td>Pine nuts</td>
<td>Nut-like gymnosperm</td>
<td>23.00</td>
<td>yes</td>
</tr>
<tr>
<td>18</td>
<td>Pecan</td>
<td>Nut</td>
<td>6.99</td>
<td>yes</td>
</tr>
<tr>
<td>19</td>
<td>Juniper berries</td>
<td>Nut-like gymnosperm</td>
<td>11.99</td>
<td>yes</td>
</tr>
<tr>
<td>20</td>
<td>Cashew</td>
<td>Nut</td>
<td>23.61</td>
<td>yes</td>
</tr>
<tr>
<td>21</td>
<td>Hazelnut</td>
<td>Nut</td>
<td>25.49</td>
<td>yes</td>
</tr>
<tr>
<td>22</td>
<td>Sunflower seed</td>
<td>Other</td>
<td>9.99</td>
<td>yes</td>
</tr>
<tr>
<td>23</td>
<td>Poppy seed</td>
<td>Other</td>
<td>12.99</td>
<td>yes</td>
</tr>
<tr>
<td>24</td>
<td>Barley</td>
<td>Cereal</td>
<td>9.99</td>
<td>yes</td>
</tr>
<tr>
<td>25</td>
<td>Maize</td>
<td>Cereal</td>
<td>6.98</td>
<td>yes</td>
</tr>
<tr>
<td>26</td>
<td>Oats</td>
<td>Cereal</td>
<td>9.99</td>
<td>yes</td>
</tr>
<tr>
<td>27</td>
<td>Rice</td>
<td>Cereal</td>
<td>7.90</td>
<td>yes</td>
</tr>
<tr>
<td>28</td>
<td>Rye</td>
<td>Cereal</td>
<td>9.87</td>
<td>yes</td>
</tr>
<tr>
<td>29</td>
<td>Spelt</td>
<td>Cereal</td>
<td>7.50</td>
<td>yes</td>
</tr>
<tr>
<td>30</td>
<td>Wheat berries</td>
<td>Cereal</td>
<td>2.50</td>
<td>no</td>
</tr>
<tr>
<td>31</td>
<td>Buckwheat</td>
<td>Pseudocereal</td>
<td>5.60</td>
<td>yes</td>
</tr>
<tr>
<td>32</td>
<td>Jackfruit</td>
<td>Other</td>
<td>15.00</td>
<td>yes</td>
</tr>
<tr>
<td>33</td>
<td>Durian</td>
<td>Other</td>
<td>8.26</td>
<td>no</td>
</tr>
<tr>
<td>34</td>
<td>Lotus seed</td>
<td>Other</td>
<td>12.99</td>
<td>yes</td>
</tr>
<tr>
<td>35</td>
<td>Ginko</td>
<td>Nut-like gymnosperm</td>
<td>12.80</td>
<td>yes</td>
</tr>
<tr>
<td>36</td>
<td>Peanut</td>
<td>Legume</td>
<td>5.99</td>
<td>yes</td>
</tr>
<tr>
<td>37</td>
<td>Pumpkin seed</td>
<td>Other</td>
<td>5.99</td>
<td>yes</td>
</tr>
<tr>
<td>38</td>
<td>Watermelon seed</td>
<td>Other</td>
<td>6.99</td>
<td>yes</td>
</tr>
<tr>
<td>39</td>
<td>Pomegranate seed</td>
<td>Other</td>
<td>27.63</td>
<td>yes</td>
</tr>
<tr>
<td>40</td>
<td>Cacao bean</td>
<td>Other</td>
<td>12.99</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p>Use the following data types for your &quot;edible_seeds&quot; columns:</p>
<ul>
<li>id - SERIAL</li>
<li>name - VARCHAR that accepts 255 characters</li>
<li>type - VARCHAR that accepts 255 characters</li>
<li>price_per_pound - FLOAT or REAL</li>
<li>in_stock - BOOLEAN</li>
</ul>
<p><strong>Flower Seeds</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>main_color</th>
<th>seeds_per_packet</th>
<th>price_per_packet</th>
<th>in_stock</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Begonia Fiona Red</td>
<td>Red</td>
<td>25</td>
<td>4.95</td>
<td>yes</td>
</tr>
<tr>
<td>2</td>
<td>Moonflower Seeds</td>
<td>White</td>
<td>25</td>
<td>2.95</td>
<td>yes</td>
</tr>
<tr>
<td>3</td>
<td>Easy Wave F1 Lavender Sky Blue Petunia Seeds</td>
<td>Lavender</td>
<td>10</td>
<td>4.25</td>
<td>yes</td>
</tr>
<tr>
<td>4</td>
<td>Super Hero Spry Marigold Seeds</td>
<td>Marigold</td>
<td>50</td>
<td>2.95</td>
<td>no</td>
</tr>
<tr>
<td>5</td>
<td>Zinnia Zinderella Lilac</td>
<td>Pink</td>
<td>25</td>
<td>3.95</td>
<td>yes</td>
</tr>
<tr>
<td>6</td>
<td>Mini Ornamental Mint Seeds</td>
<td>Green</td>
<td>10</td>
<td>3.95</td>
<td>yes</td>
</tr>
<tr>
<td>7</td>
<td>Kabloom Light Pink Blast Calibrachoa</td>
<td>Green</td>
<td>10</td>
<td>4.95</td>
<td>yes</td>
</tr>
<tr>
<td>8</td>
<td>Calibrachoa Kabloom Coral</td>
<td>Coral</td>
<td>10</td>
<td>4.95</td>
<td>no</td>
</tr>
<tr>
<td>9</td>
<td>Fiesta del Sol Mexican Sunflower Seeds</td>
<td>Red</td>
<td>30</td>
<td>3.95</td>
<td>no</td>
</tr>
<tr>
<td>10</td>
<td>Cosmos Apricot Lemonade</td>
<td>Yellow</td>
<td>25</td>
<td>3.95</td>
<td>yes</td>
</tr>
<tr>
<td>11</td>
<td>Zinderella Purple Zinnia Seeds</td>
<td>Purple</td>
<td>25</td>
<td>3.95</td>
<td>yes</td>
</tr>
<tr>
<td>12</td>
<td>Fireball Marigold Seeds</td>
<td>Varies</td>
<td>25</td>
<td>3.95</td>
<td>yes</td>
</tr>
<tr>
<td>13</td>
<td>Gerbera Revolution Bicolor Red Lemon</td>
<td>Red</td>
<td>10</td>
<td>8.95</td>
<td>no</td>
</tr>
<tr>
<td>14</td>
<td>Paradise Island Calibrachoa Fuseables Seeds</td>
<td>Varies</td>
<td>5</td>
<td>6.95</td>
<td>yes</td>
</tr>
<tr>
<td>15</td>
<td>Cheyenne Spirit Coneflower Seeds</td>
<td>Varies</td>
<td>15</td>
<td>7.95</td>
<td>no</td>
</tr>
<tr>
<td>16</td>
<td>Leucanthemum Madonna</td>
<td>White</td>
<td>25</td>
<td>4.95</td>
<td>no</td>
</tr>
<tr>
<td>17</td>
<td>Zinnia Zinderella Peach</td>
<td>Peach</td>
<td>25</td>
<td>3.95</td>
<td>yes</td>
</tr>
<tr>
<td>18</td>
<td>Kabloom Orange Calibrachoa</td>
<td>Orange</td>
<td>10</td>
<td>4.95</td>
<td>yes</td>
</tr>
<tr>
<td>19</td>
<td>Fountain Blue Lobelia Seeds</td>
<td>Blue</td>
<td>100</td>
<td>2.50</td>
<td>yes</td>
</tr>
<tr>
<td>20</td>
<td>Envy Zinnia Seeds</td>
<td>Green</td>
<td>50</td>
<td>2.95</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p>Use the following data types for your &quot;flower_seeds&quot; columns:</p>
<ul>
<li>id - SERIAL</li>
<li>name - VARCHAR that accepts 300 characters</li>
<li>main_color - VARCHAR that accepts 100 characters</li>
<li>seeds_per_packet - INT</li>
<li>price_per_packet - FLOAT</li>
<li>in_stock - BOOLEAN</li>
</ul>
<p><em>Note:</em> Make sure to save your seed file on your machine so that you can pipe it<br>
into your database in the next phase!</p>
<h2 class="mume-header" id="phase-3-pipe-your-seed-file-into-your-new-database">Phase 3: Pipe your seed file into your new database</h2>

<p>After you&apos;ve saved your seed file, use the caret and pipe methods to seed<br>
your <code>farm</code> database with the data from the &quot;edible_seeds&quot; table. (<em>Note: Make<br>
sure you&apos;ve quit <code>psql</code> first with <code>\q</code>.</em>)</p>
<p>There are two ways to seed your database:</p>
<h3 class="mume-header" id="method-1-seed-your-database-via-caret-method">Method 1. Seed your database via caret method</h3>

<pre data-role="codeBlock" data-info="sql" class="language-sql">psql <span class="token operator">-</span>d <span class="token punctuation">[</span><span class="token keyword">database</span><span class="token punctuation">]</span> <span class="token operator">-</span>U <span class="token punctuation">[</span>username<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token punctuation">[</span>path_to_file<span class="token operator">/</span><span class="token keyword">file</span><span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">]</span>
</pre><h3 class="mume-header" id="method-2-seed-your-database-via-pipe-method">Method 2. Seed your database via pipe method</h3>

<pre data-role="codeBlock" data-info="sql" class="language-sql">cat <span class="token punctuation">[</span>path_to_file<span class="token operator">/</span><span class="token keyword">file</span><span class="token punctuation">.</span><span class="token keyword">sql</span><span class="token punctuation">]</span> <span class="token operator">|</span> psql <span class="token operator">-</span>d <span class="token punctuation">[</span><span class="token keyword">database</span><span class="token punctuation">]</span> <span class="token operator">-</span>U <span class="token punctuation">[</span>username<span class="token punctuation">]</span>
</pre><p>Try both of these methods.</p>
<h3 class="mume-header" id="if-you-want-to-seed-using-the-file-again-you-need-to-first-drop-the-tables">If you want to seed using the file again, you need to first drop the tables.</h3>

<p>Access the database by:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">psql <span class="token operator">-</span>d <span class="token punctuation">[</span><span class="token keyword">database</span><span class="token punctuation">]</span> <span class="token operator">-</span>U <span class="token punctuation">[</span>username<span class="token punctuation">]</span>
</pre><p>Then drop the tables:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">table</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</pre><p>Then you can run the seed file again using any of the two above methods.</p>
<h3 class="mume-header" id="check-to-make-sure-your-seed-file-has-actually-updated-the-farm-database">Check to make sure your seed file has actually updated the <code>farm</code> database</h3>

<ul>
<li>Log into <code>psql</code> again.</li>
<li>Connect to the <code>farm</code> database (syntax: <code>\c [database]</code>).</li>
<li>Make sure your &quot;edible_seeds&quot; table is filled with seeds: <code>SELECT * FROM &#xAB;table name&#xBB;;</code></li>
<li>Make sure your &quot;flower_seeds&quot; table is filled with seeds: <code>SELECT * FROM &#xAB;table name&#xBB;;</code></li>
</ul>
<hr>
<h1 class="mume-header" id="solving-the-sql-menagerie-project">Solving The SQL Menagerie Project</h1>

<p>In our SQL readings, we learned how to write basic SQL queries and incorporate<br>
<code>WHERE</code> clauses to filter for more specific results. We also learned how to use<br>
a <code>JOIN</code> operation to get information from multiple tables.</p>
<p>In this project, put your SQL knowledge to the test and show off your querying<br>
skills.</p>
<p>We&apos;ve put together a collection (let&apos;s call it a <em>menagerie</em>) of SQL problems<br>
for you to solve below. Solve them all, and you&apos;ll be the master of the<br>
menagerie!</p>
<h2 class="mume-header" id="getting-started">Getting started</h2>

<p>Clone the starter repository from<br>
<a href="https://github.com/appacademy-starters/sql-select-exercises-starter">https://github.com/appacademy-starters/sql-select-exercises-starter</a>.</p>
<h2 class="mume-header" id="project-overview-1">Project overview</h2>

<ol>
<li>In Phase 1, pipe the seed file into a new database.</li>
<li>In Phase 2, query the seed tables with basic <code>SELECT</code> statements.</li>
<li>In Phase 3, query the seed tables using <code>WHERE</code> clauses to get more specific<br>
rows back.</li>
<li>In Phase 4, use a <code>JOIN</code> operation to get data from both seed tables.</li>
<li>Bonuses! Go beyond what we learned in the readings to deepen your SQL query<br>
knowledge.</li>
</ol>
<h2 class="mume-header" id="phase-1-pipe-in-a-seed-file-to-create-new-database-tables">Phase 1: Pipe in a seed file to create new database tables</h2>

<p>We&apos;ve set up a seed file for you to use in this project called<br>
<em>**cities_and_airports.sql</em>** that will create two tables: a &quot;cities&quot; table and<br>
an &quot;airports&quot; table. These tables show the top 25 most populous U.S. cities and<br>
their airports, respectively. Pipe this file into your database, and use these<br>
tables for the rest of the project phases.</p>
<p>Go through the following steps:</p>
<ol>
<li>Log into <code>psql</code>.</li>
<li>Create a new database called &quot;travel&quot;.</li>
<li>Pipe the <em>cities_and_airports.sql</em> seed file into the &quot;travel&quot; database.</li>
<li>Check that there&apos;s data in both the &quot;cities&quot; and &quot;airports&quot; tables.</li>
</ol>
<h2 class="mume-header" id="phase-2-write-basic-select-statements">Phase 2: Write basic SELECT statements</h2>

<p>Retrieve rows from a table using <code>SELECT</code> FROM SQL statements.</p>
<ol>
<li>
<p>Write a SQL query that returns the city, state, and estimated population in<br>
2018 from the &quot;cities&quot; table.</p>
</li>
<li>
<p>Write a SQL query that returns all of the airport names contained in the<br>
&quot;airports&quot; table.</p>
</li>
</ol>
<h2 class="mume-header" id="phase-3-add-where-clauses">Phase 3: Add WHERE clauses</h2>

<p>Select specific rows from a table using WHERE and common operators.</p>
<ol>
<li>Write a SQL query that uses a <code>WHERE</code> clause to get the estimated population<br>
in 2018 of the city of San Diego.</li>
<li>Write a SQL query that uses a <code>WHERE</code> clause to get the city, state, and<br>
estimated population in 2018 of cities in this list: Phoenix, Jacksonville,<br>
Charlotte, Nashville.</li>
<li>Write a SQL query that uses a <code>WHERE</code> clause to get the cities with an<br>
estimated 2018 population between 800,000 and 900,000 people. Show the city,<br>
state, and estimated population in 2018 columns.</li>
<li>Write a SQL query that uses a <code>WHERE</code> clause to get the names of the cities<br>
that had an estimated population in 2018 of at least 1 million people (or<br>
1,000,000 people).</li>
<li>Write a SQL query to get the city and estimated population in 2018 in number<br>
of millions (<em>i.e. without zeroes at the end: 1 million</em>), and that uses a<br>
<code>WHERE</code> clause to return only the cities in Texas.</li>
<li>Write a SQL query that uses a <code>WHERE</code> clause to get the city, state, and<br>
estimated population in 2018 of cities that are NOT in the following states:<br>
New York, California, Texas.</li>
<li>Write a SQL query that uses a <code>WHERE</code> clause with the <code>LIKE</code> operator to get<br>
the city, state, and estimated population in 2018 of cities that start with<br>
the letter &quot;S&quot;. (<em>Note: See the PostgreSQL doc on <a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">Pattern Matching</a> for<br>
more information.</em>)</li>
<li>Write a SQL query that uses a <code>WHERE</code> clause to find the cities with either<br>
a land area of over 400 square miles OR a population over 2 million people<br>
(or 2,000,000 people). Show the city name, the land area, and the estimated<br>
population in 2018.</li>
<li>Write a SQL query that uses a <code>WHERE</code> clause to find the cities with either<br>
a land area of over 400 square miles OR a population over 2 million people<br>
(or 2,000,000 people) -- but not the cities that have both. Show the city<br>
name, the land area, and the estimated population in 2018.</li>
<li>Write a SQL query that uses a <code>WHERE</code> clause to find the cities where the<br>
population has increased by over 200,000 people from 2010 to 2018. Show<br>
the city name, the estimated population in 2018, and the census population<br>
in 2010.</li>
</ol>
<h2 class="mume-header" id="phase-4-use-a-join-operation">Phase 4: Use a JOIN operation</h2>

<p>Retrieve rows from multiple tables joining on a foreign key.</p>
<p>The &quot;airports&quot; table has a foreign key called <code>city_id</code> that references<br>
the <code>id</code> column in the &quot;cities&quot; table.</p>
<ol>
<li>Write a SQL query using an INNER JOIN to join data from the &quot;cities&quot; table<br>
with data from the &quot;airports&quot; table using the <code>city_id</code> foreign key.<br>
Show the airport names and city names only.</li>
<li>Write a SQL query using an INNER JOIN to join data from the &quot;cities&quot; table<br>
with data from the &quot;airports&quot; table to find out how many airports are in New<br>
York City using the city name. (<em>Note: Use the <a href="http://www.postgresqltutorial.com/postgresql-data-types/">aggregate function</a><br>
COUNT() to count the number of matching rows.</em>)</li>
</ol>
<h2 class="mume-header" id="bonuses">Bonuses</h2>

<ol>
<li>
<p><strong>Apostrophe:</strong> Write a SQL query to get all three ID codes (<em>the Federal<br>
Aviation Administration (FAA) ID, the International Air Transport Association<br>
(IATA) ID, and the International Civil Aviation Organization (ICAO) ID</em>) from<br>
the &quot;airports&quot; table for Chicago O&apos;Hare International Airport. (<em>Note:<br>
You&apos;ll need to escape the quotation mark in O&apos;Hare.<br>
See <a href="http://www.postgresqltutorial.com/postgresql-boolean/">How to include a single quote in a SQL query</a>.</em>)</p>
</li>
<li>
<p><strong>Formatting Commas:</strong> Refactor Phase 2, Query #1 to turn the INT for<br>
estimated population in 2018 into a character string with commas.<br>
(<em>Note: See <a href="https://sqlzoo.net/wiki/SELECT_Reference">Data Type Formatting Functions</a></em>)</p>
<ul>
<li>Phase 2, Query #1: Write a SQL query that returns the city, state, and<br>
estimated population in 2018 from the &quot;cities&quot; table.</li>
</ul>
</li>
<li>
<p><strong>Decimals and Rounding:</strong> Refactor Phase 3, Query #5 to turn number of<br>
millions from an integer into a decimal rounded to a precision of two decimal<br>
places. (<em>Note: See <a href="https://www.postgresql.org/docs/9.6/datatype-numeric.html">Numeric Types</a> and the <a href="https://www.postgresqltutorial.com/postgresql-round/">ROUND function</a>.</em>)</p>
<ul>
<li>Phase 3, Query #5: Write a SQL query to get the city and estimated<br>
population in 2018 in number of millions (<em>i.e. without zeroes at the end:<br>
1 million</em>), and that uses a <code>WHERE</code> clause to return only the cities in Texas.</li>
</ul>
</li>
<li>
<p><strong>ORDER BY and LIMIT Clauses:</strong> Refactor Phase 3, Query #10 to return only<br>
one city with the biggest population increase from 2010 to 2018. Show the<br>
city name, the estimated population in 2018, and the census population in<br>
2010 for that city. (_Note: You&apos;ll do the same calculation as before, but<br>
instead of comparing it to 200,000, use the <a href="https://www.postgresql.org/docs/9.6/sql-select.html#SQL-ORDERBY">ORDER BY Clause</a> with the<br>
<a href="https://www.postgresql.org/docs/9.6/sql-select.html#SQL-LIMIT">LIMIT</a> Clause to sort the results and grab only the top result.)</p>
<ul>
<li>Phase 3, Query #10: Write a SQL query that uses a <code>WHERE</code> clause to find<br>
the cities where the population has increased by over 200,000 people from<br>
2010 to 2018. Show the city name, the estimated population in 2018, and the<br>
census population in 2010.</li>
</ul>
</li>
</ol>
<hr>
<h1 class="mume-header undefined" id="week-10-day-3brdeeper-into-data">WEEK-10 DAY-3<br><em>Deeper Into Data</em></h1>

<hr>
<hr>
<h1 class="mume-header" id="creating-a-schema-for-relational-database-design">Creating A Schema For Relational Database Design</h1>

<p>Schemas allow use to easily visualize database tables and their relationships to<br>
one another, so that we can identify areas that need clarity, refinement, or<br>
redesign.</p>
<p>In this reading, we&#x2019;re going to cover the stages of relational database design<br>
and how to create schema that depicts database table relationships.</p>
<h2 class="mume-header" id="what-is-relational-database-design">What is Relational Database Design?</h2>

<p>According to Technopedia, <a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">Relational Database Design</a> (or RDD) differs from<br>
other databases in terms of data organization and transactions: &#x201C;In an RDD, the<br>
data are organized into tables and all types of data access are carried out via<br>
controlled transactions.&#x201D;</p>
<p>In previous readings, we created relational database tables and accessed data<br>
from these tables through PostgreSQL queries. These tables (a.k.a. <em>entities</em>)<br>
contain rows (a.k.a. <em>records</em>) and columns (a.k.a. <em>fields</em>). We also learned<br>
how to uniquely identify table records by adding a <code>PRIMARY KEY</code> and how to<br>
create a table association by adding a <code>FOREIGN KEY</code>.</p>
<p>A relational database usually contains multiple tables. It&#x2019;s useful to create<br>
schema to help us visualize these tables, keep track of primary keys and foreign<br>
keys, and create relationships among tables. This is a key part of the RDD<br>
process defined below.</p>
<h2 class="mume-header" id="stages-of-relational-database-design">Stages of Relational Database Design</h2>

<p>There are four generally-agreed-upon stages of Relational Database Design:</p>
<ol>
<li>Define the purpose/entities of the relational DB.</li>
<li>Identify primary keys.</li>
<li>Establish table relationships.</li>
<li>Apply normalization rules.</li>
</ol>
<h3 class="mume-header" id="1-define-database-purpose-and-entities">1. Define database purpose and entities</h3>

<p>The first stage is identifying the purpose of the database (<em>Why is the database<br>
being created? What problem is it solving? What is the data used for?</em>), as well<br>
as identifying the main entities, or <em>tables</em>, that need to be created. It also<br>
typically involves identifying the table&#x2019;s attributes (i.e. <em>columns</em> and<br>
<em>rows</em>).</p>
<p>For example, if we were creating a database for order processing on an<br>
e-commerce application, we would need a database with at least three tables: a<br>
<code>products</code> table, an <code>orders</code> tables, and a <code>users</code> (i.e. customers) table. We<br>
know that a product will probably have an ID, name, and price, and an order will<br>
contain one or more product IDs. We also know that users can create multiple<br>
orders.</p>
<p><img src="images/orders-erd-entities.svg" alt="Orders ERD entities"></p>
<h3 class="mume-header" id="2-identify-primary-keys">2. Identify primary keys</h3>

<p>The second stage is to identify the primary key (<em>PK</em>) of each table. As we<br>
previously learned, a table&#x2019;s primary key contains a unique value, or values,<br>
that identify each distinct record. For our above example of online orders, we<br>
would probably create IDs to serve as the primary key for each table: a product<br>
ID, an order ID, and a user ID.</p>
<p><img src="images/orders-erd-primary-keys.svg" alt="orders-erd-primary-keys.svg"></p>
<h3 class="mume-header" id="3-establish-table-relationships">3. Establish table relationships</h3>

<p>The third stage is to establish the relationships among the tables in the<br>
database. There are three types of relational database table relationships:</p>
<ul>
<li>One-to-one</li>
<li>One-to-many</li>
<li>Many-to-many</li>
</ul>
<p><strong>One-to-one relationship</strong></p>
<p>In a one-to-one relationship, one record in a table is associated with only one<br>
record in another table. We could say that only one record in Table B belongs to<br>
only one record in Table A.</p>
<p>A one-to-one relationship is the least common type of table relationship. While<br>
the two tables above could be combined into a single table, we may want to keep<br>
some less-used data separate from the main <code>products</code> table.</p>
<p><img src="images/products-erd-one-to-one.svg" alt="products-erd-one-to-one.svg"></p>
<p>The above schema depicts two tables: a &#x201C;products&#x201D; table and a &#x201C;product_details&#x201D;<br>
table. A <code>product_details</code> record belongs to only one product record. We&apos;ve used<br>
an arrow to indicate the one-to-one relationship between the tables. Both tables<br>
have the same primary key -- <code>product_id</code> -- which we can use in a <a href="http://www.postgresqltutorial.com/postgresql-data-types/"><code>JOIN</code></a><br>
operation to get data from both tables.</p>
<p>This table relationship would produce the following example data (note that not<br>
all columns are shown below):</p>
<p><strong>Products</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1597</td>
<td>Glass Coffee Mug</td>
</tr>
<tr>
<td>1598</td>
<td>Metallic Coffee Mug</td>
</tr>
<tr>
<td>1599</td>
<td>Smart Coffee Mug</td>
</tr>
</tbody>
</table>
<p><strong>Product Details</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>product_id</th>
<th>full_description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1597</td>
<td>Sturdy tempered glass coffee mug with natural cork band and silicone lid. Barista standard - fits under commercial coffee machine heads and most cup-holders.</td>
</tr>
<tr>
<td>2</td>
<td>1598</td>
<td>Fun coffee mug that comes in various metallic colors. Sleek, stylish, and easy to wash. Makes a great addition to your kitchen. Take it on the go by attaching the secure lid.</td>
</tr>
<tr>
<td>3</td>
<td>1599</td>
<td>This smart mug goes beyond being a simple coffee receptacle. Its smart features let you set and maintain an exact drinking temperature for up to 1.5 hours, so your coffee is never too hot or too cold.</td>
</tr>
</tbody>
</table>
<p>Take a moment to analyze the data above. Using the foreign keys, you should be<br>
able to reason out that the &quot;Metallic Coffee Mug&quot; is a &quot;Fun coffee mug that<br>
comes in various metallic colors.&quot;</p>
<p><strong>One-to-many relationship</strong></p>
<p>In a one-to-many relationship, each record in Table A is associated with<br>
multiple records in Table B. Each record in Table B is associated with only one<br>
record in Table A.</p>
<p><img src="images/orders-erd-one-to-many.svg" alt="orders-erd-one-to-many.svg"></p>
<p>The above schema depicts a one-to-many relationship between the &#x201C;users&#x201D; table<br>
and the <code>orders</code> table: One user can create multiple orders. The primary key of<br>
the &#x201C;orders&#x201D; table (<code>id</code>) is a foreign key in the &#x201C;users&#x201D; table (<code>order_id</code>). We<br>
can use this foreign key in a <code>JOIN</code> operation to get data from both tables.</p>
<p>This table relationship would produce the following example data (note that not<br>
all columns are shown below):</p>
<p><strong>Users</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
</tr>
</tbody>
</table>
<p><strong>Orders</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>purchaser_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>1</td>
</tr>
<tr>
<td>11</td>
<td>1</td>
</tr>
<tr>
<td>12</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Take a moment to analyze the data above. Using the foreign keys, you should be<br>
able to reason out that &quot;Alice&quot; has made two orders and &quot;Bob&quot; has made one<br>
order.</p>
<p><strong>Many-to-many relationship</strong></p>
<p>In a many-to-many relationship, multiple records in Table A are associated with<br>
multiple records in Table B. You would normally create a third table for this<br>
relationship called a <em><strong>join table</strong></em>, which contains the primary keys from<br>
both tables.</p>
<p><img src="images/orders-erd-many-to-many.svg" alt="orders-erd-many-to-many.svg"></p>
<p>The above schema depicts a many-to-many relationship between the <code>products</code><br>
table and the <code>orders</code> table. A single order can have multiple products, and a<br>
single product can belong to multiple orders. We created a third join table<br>
called <code>order_details</code>, which contains both the<code>order_id</code> and <code>product_id</code><br>
fields as foreign keys.</p>
<p>This table relationship would produce the following example data(note that not<br>
all columns are shown below):</p>
<p><strong>Products</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1597</td>
<td>Glass Coffee Mug</td>
</tr>
<tr>
<td>1598</td>
<td>Metallic Coffee Mug</td>
</tr>
<tr>
<td>1599</td>
<td>Smart Coffee Mug</td>
</tr>
</tbody>
</table>
<p><strong>Users</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
</tr>
<tr>
<td>2</td>
<td>Bob</td>
</tr>
</tbody>
</table>
<p><strong>Orders</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>purchaser_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>1</td>
</tr>
<tr>
<td>11</td>
<td>1</td>
</tr>
<tr>
<td>12</td>
<td>2</td>
</tr>
</tbody>
</table>
<p><strong>Order Details</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>order_id</th>
<th>product_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>10</td>
<td>1599</td>
</tr>
<tr>
<td>2</td>
<td>11</td>
<td>1597</td>
</tr>
<tr>
<td>3</td>
<td>11</td>
<td>1598</td>
</tr>
<tr>
<td>4</td>
<td>12</td>
<td>1597</td>
</tr>
<tr>
<td>5</td>
<td>12</td>
<td>1598</td>
</tr>
<tr>
<td>6</td>
<td>12</td>
<td>1599</td>
</tr>
</tbody>
</table>
<p>Take a moment to analyze the data above. Using the foreign keys, you should be<br>
able to reason out that &quot;Alice&quot; has two orders. One order containing a &quot;Smart<br>
Coffee Mug&quot; and another order containing both a &quot;Glass Coffee Mug&quot; and &quot;Metallic<br>
Coffee Mug&quot;.</p>
<h3 class="mume-header" id="4-apply-normalization-rules">4. Apply normalization rules</h3>

<p>The fourth stage in RDD is <em><strong>normalization</strong></em>. Normalization is the process of<br>
optimizing the database structure so that redundancy and confusion are<br>
eliminated.</p>
<p>The rules of normalization are called &#x201C;normal forms&#x201D; and are as follows:</p>
<ol>
<li>First normal form</li>
<li>Second normal form</li>
<li>Third normal form</li>
<li>Boyce-Codd normal form</li>
<li>Fifth normal form</li>
</ol>
<p>The first three forms are widely used in practice, while the fourth and fifth<br>
are less often used.</p>
<p><strong>First normal form rules:</strong></p>
<ul>
<li>Eliminate repeating groups in individual tables.</li>
<li>Create a separate table for each set of related data.</li>
<li>Identify each set of related data with a primary key.</li>
</ul>
<p><strong>Second normal form rules:</strong></p>
<ul>
<li>Create separate tables for sets of values that apply to multiple records.</li>
<li>Relate these tables with a foreign key.</li>
</ul>
<p><strong>Third normal form rules:</strong></p>
<ul>
<li>Eliminate fields that do not depend on the table&#x2019;s key.</li>
</ul>
<p><em>Note: For examples of how to apply these forms, read <a href="http://www.postgresqltutorial.com/postgresql-boolean/">&#x201C;Description of the<br>
database normalization basics&#x201D;</a> from Microsoft.</em></p>
<h2 class="mume-header" id="schema-design-tools">Schema design tools</h2>

<p>Many people draw their relational database design schema with good ol&#x2019; pen and<br>
paper, or on a whiteboard. However, there are also lots of online tools created<br>
for this purpose if you&#x2019;d like to use something easily exportable/shareable.<br>
Feel free to check out the ERD (short for &#x201C;Entity Relationship Diagram&#x201D;) tools<br>
below.</p>
<p>Free Database Diagram (ERD) Design Tools:</p>
<ul>
<li><a href="https://sqlzoo.net/wiki/SELECT_Reference">Lucidchart</a></li>
<li><a href="https://www.postgresql.org/docs/9.6/datatype-numeric.html">draw.io</a></li>
<li><a href="https://www.postgresqltutorial.com/postgresql-round/">dbdiagram.io</a></li>
<li><a href="https://www.postgresql.org/docs/9.6/sql-select.html#SQL-ORDERBY">QuickDBD</a></li>
</ul>
<h2 class="mume-header" id="what-we-learned-6">What we learned:</h2>

<ul>
<li>Stages of Relational Database Design (RDD)</li>
<li>Examples of schema depicting table relationships</li>
<li>Normalization rules</li>
<li>Schema drawing tools</li>
</ul>
<hr>
<h1 class="mume-header" id="using-sql-transactions">Using SQL Transactions</h1>

<p>Transactions allow us to make changes to a SQL database in a consistent and<br>
durable way, and it&#x2019;s a best practice to use them regularly.</p>
<p>In this reading, we&#x2019;ll cover what a transaction is and why we want to use it, as<br>
well as how to write explicit transactions.</p>
<h2 class="mume-header" id="what-is-a-transaction">What is a transaction?</h2>

<p>A transaction is a single unit of work, which can contain multiple operations,<br>
performed on a database. According to the <a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">PostgreSQL docs</a>, the important<br>
thing to note about a transaction is that &#x201C;it bundles multiple steps into a<br>
single, all-or-nothing operation&#x201D;. If any operation within the transaction<br>
fails, then the entire transaction fails. If all the operations succeed, then<br>
the entire transaction succeeds.</p>
<h2 class="mume-header" id="implicit-vs-explicit-transactions">Implicit vs. explicit transactions</h2>

<p>Every SQL statement is effectively a transaction. When you insert a new table<br>
row into a database table, for example, you are creating a transaction. The<br>
following <code>INSERT</code> statement is a transaction:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> hobbits<span class="token punctuation">(</span>name<span class="token punctuation">,</span>purpose<span class="token punctuation">)</span>
  <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Frodo&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;Destroy the One Ring of power.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The above code is known as an  <em>implicit</em> transaction. With an implicit<br>
transaction, changes to the database happen immediately, and we have no way to<br>
undo or roll back these changes. We can only make subsequent changes/<br>
transactions.</p>
<p>An <em>explicit</em> transaction, however, allows us to create save points and roll<br>
back to whatever point in time we choose. An explicit transaction begins with<br>
the command <code>BEGIN</code>, followed by the SQL statement, and then ends with either a<br>
<code>COMMIT</code> or <code>ROLLBACK</code>.</p>
<h3 class="mume-header" id="postgresql-transactional-commands">PostgreSQL transactional commands</h3>

<p><strong><a href="http://www.postgresqltutorial.com/postgresql-boolean/">BEGIN</a></strong><br>
-- Initiates a transaction block. All statements after a BEGIN command will be<br>
executed in a single transaction until an explicit COMMIT or ROLLBACK is given.</p>
<p>Starting a transaction:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> hobbits<span class="token punctuation">(</span>name<span class="token punctuation">,</span>purpose<span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Frodo&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;Destroy the One Ring of power.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong><a href="https://sqlzoo.net/wiki/SELECT_Reference">COMMIT</a></strong><br>
-- Commits the current transaction. All changes made by the transaction become<br>
visible to others and are guaranteed to be durable if a crash occurs.</p>
<p>Committing a transaction:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> hobbits<span class="token punctuation">(</span>name<span class="token punctuation">,</span>purpose<span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Frodo&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;Destroy the One Ring of power.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</pre><p><strong><a href="https://www.postgresql.org/docs/9.6/datatype-numeric.html">ROLLBACK</a></strong><br>
-- Rolls back the current transaction and causes all the updates made by the<br>
transaction to be discarded. Can only undo transactions since the last COMMIT or<br>
ROLLBACK command was issued.</p>
<p>Rolling back a transaction (i.e. abort all changes):</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> hobbits<span class="token punctuation">(</span>name<span class="token punctuation">,</span>purpose<span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">&apos;Frodo&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;Destroy the One Ring of power.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
</pre><p><strong><a href="https://www.postgresqltutorial.com/postgresql-round/">SAVEPOINT</a></strong><br>
-- Establishes a new save point within the current transaction. Allows all<br>
commands executed after the save point to be rolled back, restoring the<br>
transaction state to what it was at the time of the save point.</p>
<p>Syntax to create save point: <code>SAVEPOINT savepoint_name;</code><br>
Syntax to delete a save point: <code>RELEASE SAVEPOINT savepoint_name;</code></p>
<p>Let&#x2019;s say we had the following table called <code>fellowship</code>:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>Frodo</td>
<td>50</td>
</tr>
<tr>
<td>Samwise</td>
<td>38</td>
</tr>
<tr>
<td>Merry</td>
<td>36</td>
</tr>
<tr>
<td>Pippin</td>
<td>28</td>
</tr>
<tr>
<td>Aragorn</td>
<td>87</td>
</tr>
<tr>
<td>Boromir</td>
<td>40</td>
</tr>
<tr>
<td>Legolas</td>
<td>2000</td>
</tr>
<tr>
<td>Gandalf</td>
<td>2000</td>
</tr>
</tbody>
</table>
<p>We&apos;ll create a transaction on this table containing a few operations. Inside<br>
the transaction, we&#x2019;ll establish a save point that we&#x2019;ll roll back to before<br>
committing.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
  <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> fellowship
    <span class="token keyword">WHERE</span> age <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token keyword">SAVEPOINT</span> first_savepoint<span class="token punctuation">;</span>
  <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> fellowship
    <span class="token keyword">WHERE</span> age <span class="token operator">&gt;</span> <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> fellowship
    <span class="token keyword">WHERE</span> age <span class="token operator">&gt;=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  <span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> first_savepoint<span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</pre><p>Once our transaction is committed, our table would look like this:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>age</th>
</tr>
</thead>
<tbody>
<tr>
<td>Frodo</td>
<td>50</td>
</tr>
<tr>
<td>Samwise</td>
<td>38</td>
</tr>
<tr>
<td>Merry</td>
<td>36</td>
</tr>
<tr>
<td>Pippin</td>
<td>28</td>
</tr>
<tr>
<td>Aragorn</td>
<td>87</td>
</tr>
<tr>
<td>Boromir</td>
<td>40</td>
</tr>
</tbody>
</table>
<p>We can see that the deletion that happened just prior to the savepoint creation<br>
was preserved.</p>
<p><strong><a href="https://www.postgresql.org/docs/9.6/sql-select.html#SQL-ORDERBY">SET TRANSACTION</a></strong><br>
-- Sets the characteristics of the current transaction. (_Note: To set<br>
characteristics for subsequent transactions in a session, use <code>SET SESSION CHARACTERISTICS</code>.) The available transaction characteristics are the<br>
transaction isolation level, the transaction access mode (read/write or<br>
read-only), and the deferrable mode. (<em>Read more about these characteristics<br>
in the <a href="https://www.postgresql.org/docs/9.6/sql-select.html#SQL-ORDERBY">PostgreSQL docs</a>.</em>)</p>
<p>Example of setting transaction characteristics:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
  <span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">READ</span> ONLY<span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="when-to-use-transactions-and-why">When to use transactions and why</h2>

<p>It is generally a good idea to use explicit SQL transactions when making any<br>
updates, insertions, or deletions, to a database. However, you generally<br>
wouldn&#x2019;t write an explicit transaction for a simple <code>SELECT</code> query.</p>
<p>Transactions help you deal with crashes, failures, data consistency, and error<br>
handling. The ability to create savepoints and roll back to earlier points is<br>
tremendously helpful when doing multiple updates and helps maintain data<br>
integrity.</p>
<p>Another benefit of transactions is the <em><strong>atomic</strong></em>, or &#x201C;all-or-nothing&#x201D;, nature<br>
of their operations. Because all of the operations in a transaction must succeed<br>
or else be aborted, partial or incomplete updates to the database will not be<br>
made. End-users will see only the final result of the transaction.</p>
<h2 class="mume-header" id="transaction-properties-acid">Transaction properties: ACID</h2>

<p>A SQL transaction has four properties known collectively as &#x201C;ACID&#x201D; -- which is an acronym for <em>Atomic, Consistent, Isolated, and Durable</em>. The following descriptions come from the IBM doc &#x201C;<a href="http://www.postgresqltutorial.com/postgresql-data-types/">ACID properties of transactions</a>&#x201D;:</p>
<p><strong>Atomicity</strong><br>
-- All changes to data are performed as if they are a single operation. That is, all the changes are performed, or none of them are.</p>
<p>For example, in an application that transfers funds from one account to another,<br>
the atomicity property ensures that, if a debit is made successfully from one<br>
account, the corresponding credit is made to the other account.</p>
<p><strong>Consistency</strong><br>
-- Data is in a consistent state when a transaction starts and when it ends.</p>
<p>For example, in an application that transfers funds from one account to another,<br>
the consistency property ensures that the total value of funds in both the<br>
accounts is the same at the start and end of each transaction.</p>
<p><strong>Isolation</strong><br>
-- The intermediate state of a transaction is invisible to other transactions.<br>
As a result, transactions that run concurrently appear to be serialized.</p>
<p>For example, in an application that transfers funds from one account to another,<br>
the isolation property ensures that another transaction sees the transferred<br>
funds in one account or the other, but not in both, nor in neither.</p>
<p><strong>Durability</strong><br>
-- After a transaction successfully completes, changes to data persist and are<br>
not undone, even in the event of a system failure.</p>
<p>For example, in an application that transfers funds from one account to another,<br>
the durability property ensures that the changes made to each account will not<br>
be reversed.</p>
<h3 class="mume-header" id="banking-transaction-example">Banking transaction example</h3>

<p>Let&#x2019;s look at an example from the <a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">PostgreSQL Transactions doc</a> that<br>
demonstrates the ACID properties of a transaction. We have a bank database that<br>
contains customer account balances, as well as total deposit balances for<br>
branches. We want to record a payment of $100.00 from Alice&apos;s account to Bob&apos;s<br>
account, as well as update the total branch balances. The transaction would<br>
look like the code below.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
  <span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">100.00</span>
      <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">&apos;Alice&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">UPDATE</span> branches <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">100.00</span>
      <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> branch_name <span class="token keyword">FROM</span> accounts <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">&apos;Alice&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">100.00</span>
      <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">&apos;Bob&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">UPDATE</span> branches <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">100.00</span>
      <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> branch_name <span class="token keyword">FROM</span> accounts <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">&apos;Bob&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</pre><p>There are several updates happening above. The bank wants to make sure that all<br>
of the updates happen or none happen, in order to ensure that funds are<br>
transferred from the proper account (i.e. Alice&#x2019;s account) to the proper<br>
recipient&#x2019;s account (i.e. Bob&#x2019;s account). If any of the updates fails, none of<br>
them will take effect. That is, if something goes wrong either with withdrawing<br>
funds from Alice&#x2019;s account or transferring the funds into Bob&#x2019;s account, then<br>
the entire transaction will be aborted and no changes will occur. This prevents<br>
Alice or Bob from seeing a transaction in their account summaries that isn&#x2019;t<br>
supposed to be there.</p>
<p>There are many other scenarios where we would want to use an atomic operation to<br>
ensure a successful end result. Transactions are ideal for such scenarios, and<br>
we should use them whenever they&#x2019;re applicable.</p>
<h2 class="mume-header" id="helpful-links-1">Helpful links:</h2>

<ul>
<li><a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">PostgreSQL: Transactions</a></li>
<li><a href="https://www.postgresql.org/docs/9.6/sql-select.html#SQL-LIMIT">PostgreSQL Tutorial: PostgreSQL Transaction</a></li>
<li><a href="http://www.postgresqltutorial.com/postgresql-boolean/">PostgreSQL: BEGIN</a></li>
<li><a href="https://sqlzoo.net/wiki/SELECT_Reference">PostgreSQL: COMMIT</a></li>
<li><a href="https://www.postgresql.org/docs/9.6/datatype-numeric.html">PostgreSQL: ROLLBACK</a></li>
<li><a href="https://www.postgresqltutorial.com/postgresql-round/">PostgreSQL: SAVEPOINT</a></li>
<li><a href="https://www.postgresqltutorial.com/postgresql-round/">PostgreSQL: SET TRANSACTION</a></li>
</ul>
<hr>
<h1 class="mume-header" id="joins-vs-subqueries">Joins vs. Subqueries</h1>

<p>To select, or not to select? That is the query. We&#x2019;ve barely scratched the<br>
surface of SQL queries. Previously, we went over how to write simple SQL<br>
queries using the <code>SELECT</code> statement, and we learned how to incorporate a <code>WHERE</code> clause into our queries.</p>
<p>There&#x2019;s a lot more we could add to our queries to get more refined results. In<br>
this reading, we&#x2019;ll go over joins and subqueries and talk about when we would<br>
use one over the other.</p>
<h2 class="mume-header" id="what-is-a-join">What is a JOIN?</h2>

<p>We briefly looked at the <code>JOIN</code> operation after we created foreign keys in a<br>
previous reading. The <a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">JOIN operation</a> allows us to retrieve rows from<br>
multiple tables.</p>
<p>To review, we had two tables: a &quot;breeds&quot; table and a &quot;puppies&quot; table. The two<br>
tables shared information through a foreign key. The foreign key <code>breed_id</code><br>
lives on the &quot;puppies&quot; table and is related to the primary key <code>id</code> of the<br>
&quot;breeds&quot; table.</p>
<p>We wrote the following <code>INNER JOIN</code> operation to get only the rows from the<br>
&#x201C;puppies&#x201D; table with a matching <code>breed_id</code> in the &#x201C;friends&#x201D; table:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> puppies
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> breeds <span class="token keyword">ON</span> <span class="token punctuation">(</span>puppies<span class="token punctuation">.</span>breed_id <span class="token operator">=</span> breeds<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><a href="http://www.postgresqltutorial.com/postgresql-data-types/">INNER JOIN</a> can be represented as a Venn Diagram, which produces rows from<br>
Table A that match some information in Table B.</p>
<p><img src="images/inner-join-venn-diagram.png" alt="inner-join-venn-diagram"></p>
<p>We got the following table rows back from our <code>INNER JOIN</code> on the &quot;puppies&quot;<br>
table. These rows represent the center overlapping area of the two circles. We<br>
can see that the data from &quot;puppies&quot; appears first, followed by the joined data<br>
from the &quot;friends&quot; table.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"> id <span class="token operator">|</span>   name   <span class="token operator">|</span> age_yrs <span class="token operator">|</span> breed_id <span class="token operator">|</span> weight_lbs <span class="token operator">|</span> microchipped <span class="token operator">|</span> id <span class="token operator">|</span>        name
<span class="token comment">----+----------+---------+----------+------------+--------------+----+---------------------</span>
  <span class="token number">1</span> <span class="token operator">|</span> Cooper   <span class="token operator">|</span>     <span class="token number">1.0</span> <span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span>         <span class="token number">18</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> Miniature Schnauzer
  <span class="token number">2</span> <span class="token operator">|</span> Indie    <span class="token operator">|</span>     <span class="token number">0.5</span> <span class="token operator">|</span>        <span class="token number">9</span> <span class="token operator">|</span>         <span class="token number">13</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> Yorkshire Terrier
  <span class="token number">3</span> <span class="token operator">|</span> Kota     <span class="token operator">|</span>     <span class="token number">0.7</span> <span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">26</span> <span class="token operator">|</span> f            <span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> Australian Shepherd
  <span class="token number">4</span> <span class="token operator">|</span> Zoe      <span class="token operator">|</span>     <span class="token number">0.8</span> <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>         <span class="token number">32</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> Korean Jindo
  <span class="token number">5</span> <span class="token operator">|</span> Charley  <span class="token operator">|</span>     <span class="token number">1.5</span> <span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span>         <span class="token number">25</span> <span class="token operator">|</span> f            <span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> Basset Hound
  <span class="token number">6</span> <span class="token operator">|</span> Ladybird <span class="token operator">|</span>     <span class="token number">0.6</span> <span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span>         <span class="token number">20</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> Labradoodle
  <span class="token number">7</span> <span class="token operator">|</span> Callie   <span class="token operator">|</span>     <span class="token number">0.9</span> <span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span>         <span class="token number">16</span> <span class="token operator">|</span> f            <span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> Corgi
  <span class="token number">8</span> <span class="token operator">|</span> Jaxson   <span class="token operator">|</span>     <span class="token number">0.4</span> <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>         <span class="token number">19</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> Beagle
  <span class="token number">9</span> <span class="token operator">|</span> Leinni   <span class="token operator">|</span>     <span class="token number">1.0</span> <span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span>         <span class="token number">25</span> <span class="token operator">|</span> t            <span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> Miniature Schnauzer
 <span class="token number">10</span> <span class="token operator">|</span> Max      <span class="token operator">|</span>     <span class="token number">1.6</span> <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>         <span class="token number">65</span> <span class="token operator">|</span> f            <span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> German Shepherd
</pre><p>There are different types of <code>JOIN</code> operations. The ones you&apos;ll use most often are:</p>
<ol>
<li><strong>Inner Join</strong> -- Returns a result set containing rows in the left table that<br>
match rows in the right table.</li>
<li><strong>Left Join</strong> --  Returns a result set containing all rows from the left<br>
table with the matching rows from the right table. If there is no match, the<br>
right side will have null values.</li>
<li><strong>Right Join</strong> -- Returns a result set containing all rows from the right<br>
table with matching rows from the left table. If there is no match, the left<br>
side will have null values.</li>
<li><strong>Full Outer Join</strong> -- Returns a result set containing all rows from both the<br>
left and right tables, with the matching rows from both sides where<br>
available. If there is no match, the missing side contains null values.</li>
<li><strong>Self-Join</strong> -- A self-join is a query in which a table is joined to itself.<br>
Self-joins are useful for comparing values in a column of rows within the<br>
same table.</li>
</ol>
<p>(<em>See this tutorial doc on <a href="http://www.postgresqltutorial.com/postgresql-boolean/">PostgreSQL Joins</a> for more information on the<br>
different <code>JOIN</code> operations.</em>)</p>
<h2 class="mume-header" id="what-is-a-subquery">What is a subquery?</h2>

<p>A subquery is essentially a <code>SELECT</code> statement nested inside another <code>SELECT</code><br>
statement. A subquery can return a single (&#x201C;scalar&#x201D;) value or multiple rows.</p>
<h3 class="mume-header" id="single-value-subquery">Single-value subquery</h3>

<p>Let&#x2019;s see an example of how to use a subquery to return a single value. Take<br>
the &quot;puppies&quot; table from before. We had a column called <code>age_yrs</code> in that table<br>
(see below).</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">postgres<span class="token operator">=</span><span class="token comment"># SELECT * FROM puppies;</span>
 id <span class="token operator">|</span>   name   <span class="token operator">|</span> age_yrs <span class="token operator">|</span> breed_id <span class="token operator">|</span> weight_lbs <span class="token operator">|</span> microchipped
<span class="token comment">----+----------+---------+----------+------------+--------------</span>
  <span class="token number">1</span> <span class="token operator">|</span> Cooper   <span class="token operator">|</span>     <span class="token number">1.0</span> <span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span>         <span class="token number">18</span> <span class="token operator">|</span> t
  <span class="token number">2</span> <span class="token operator">|</span> Indie    <span class="token operator">|</span>     <span class="token number">0.5</span> <span class="token operator">|</span>        <span class="token number">9</span> <span class="token operator">|</span>         <span class="token number">13</span> <span class="token operator">|</span> t
  <span class="token number">3</span> <span class="token operator">|</span> Kota     <span class="token operator">|</span>     <span class="token number">0.7</span> <span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span>         <span class="token number">26</span> <span class="token operator">|</span> f
  <span class="token number">4</span> <span class="token operator">|</span> Zoe      <span class="token operator">|</span>     <span class="token number">0.8</span> <span class="token operator">|</span>        <span class="token number">6</span> <span class="token operator">|</span>         <span class="token number">32</span> <span class="token operator">|</span> t
  <span class="token number">5</span> <span class="token operator">|</span> Charley  <span class="token operator">|</span>     <span class="token number">1.5</span> <span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span>         <span class="token number">25</span> <span class="token operator">|</span> f
  <span class="token number">6</span> <span class="token operator">|</span> Ladybird <span class="token operator">|</span>     <span class="token number">0.6</span> <span class="token operator">|</span>        <span class="token number">7</span> <span class="token operator">|</span>         <span class="token number">20</span> <span class="token operator">|</span> t
  <span class="token number">7</span> <span class="token operator">|</span> Callie   <span class="token operator">|</span>     <span class="token number">0.9</span> <span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span>         <span class="token number">16</span> <span class="token operator">|</span> f
  <span class="token number">8</span> <span class="token operator">|</span> Jaxson   <span class="token operator">|</span>     <span class="token number">0.4</span> <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>         <span class="token number">19</span> <span class="token operator">|</span> t
  <span class="token number">9</span> <span class="token operator">|</span> Leinni   <span class="token operator">|</span>     <span class="token number">1.0</span> <span class="token operator">|</span>        <span class="token number">8</span> <span class="token operator">|</span>         <span class="token number">25</span> <span class="token operator">|</span> t
 <span class="token number">10</span> <span class="token operator">|</span> Max      <span class="token operator">|</span>     <span class="token number">1.6</span> <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>         <span class="token number">65</span> <span class="token operator">|</span> f
<span class="token punctuation">(</span><span class="token number">10</span> <span class="token keyword">rows</span><span class="token punctuation">)</span>
</pre><p>We&#x2019;ll use the <a href="https://sqlzoo.net/wiki/SELECT_Reference">PostgreSQL aggregate function</a> <code>AVG</code> to get an average puppy<br>
age.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span>
  <span class="token function">AVG</span> <span class="token punctuation">(</span>age_yrs<span class="token punctuation">)</span>
<span class="token keyword">FROM</span>
  puppies<span class="token punctuation">;</span>
</pre><p>Assuming our previous &#x201C;puppies&#x201D; table still exists in our database, if we<br>
entered the above statement into psql we&#x2019;d get an <em><strong>average age of 0.9</strong></em>.<br>
(<em>Note: Try it out yourself in psql! Refer to the reading &quot;Retrieving Rows From<br>
A Table Using SELECT&quot; if you need help remembering how we set up the &#x201C;puppies&#x201D;<br>
table.</em>)</p>
<p>Let&apos;s say that we wanted to find all of the puppies that are older than the<br>
average age of 0.9. We could write the following query:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span>
  name<span class="token punctuation">,</span>
  age_yrs<span class="token punctuation">,</span>
  breed
<span class="token keyword">FROM</span>
  puppies
<span class="token keyword">WHERE</span>
  age_yrs <span class="token operator">&gt;</span> <span class="token number">0.9</span><span class="token punctuation">;</span>
</pre><p>In the above query, we compared <code>age_yrs</code> to an actual number (0.9). However, as<br>
more puppies get added to our table, the average age could change at any time.<br>
To make our statement more dynamic, we can plug in the query we wrote to find<br>
the average age into another statement as a <em>subquery</em> (surrounded by<br>
parentheses).</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span>
  puppies<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
  age_yrs<span class="token punctuation">,</span>
  breeds<span class="token punctuation">.</span>name
<span class="token keyword">FROM</span>
  puppies
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>
  breeds <span class="token keyword">ON</span> <span class="token punctuation">(</span>breeds<span class="token punctuation">.</span>id <span class="token operator">=</span> puppies<span class="token punctuation">.</span>breed_id<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span>
  age_yrs <span class="token operator">&gt;</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span>
      <span class="token function">AVG</span> <span class="token punctuation">(</span>age_yrs<span class="token punctuation">)</span>
    <span class="token keyword">FROM</span>
      puppies
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>We should get the following table rows, which include only the puppies older<br>
than 9 months:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">  name   <span class="token operator">|</span> age_yrs <span class="token operator">|</span>        breed
---------+---------+---------------------
 Cooper  <span class="token operator">|</span>     1.0 <span class="token operator">|</span> Miniature Schnauzer
 Charley <span class="token operator">|</span>     1.5 <span class="token operator">|</span> Basset Hound
 Leinni  <span class="token operator">|</span>     1.0 <span class="token operator">|</span> Miniature Schnauzer
 Max     <span class="token operator">|</span>     1.6 <span class="token operator">|</span> German Shepherd
</pre><h3 class="mume-header" id="multiple-row-subquery">Multiple-row subquery</h3>

<p>We could also write a subquery that returns multiple rows.</p>
<p>In the reading &quot;Creating A Table In An Existing PostgreSQL Database&quot;, we<br>
created a &#x201C;friends&#x201D; table. In &quot;Foreign Keys And The JOIN Operation&quot;, we set up a<br>
primary key in the &#x201C;puppies&#x201D; table that is a foreign key in the &#x201C;friends&#x201D; table<br>
-- <code>puppy_id</code>. We&#x2019;ll use this ID in our subquery and outer query.</p>
<p><strong>&quot;friends&quot; table</strong></p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">id</span> <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name <span class="token operator">|</span> puppy_id
----+------------+-----------+----------
  1 <span class="token operator">|</span> Amy        <span class="token operator">|</span> Pond      <span class="token operator">|</span>        4
  2 <span class="token operator">|</span> Rose       <span class="token operator">|</span> Tyler     <span class="token operator">|</span>        5
  3 <span class="token operator">|</span> Martha     <span class="token operator">|</span> Jones     <span class="token operator">|</span>        6
  4 <span class="token operator">|</span> Donna      <span class="token operator">|</span> Noble     <span class="token operator">|</span>        7
  5 <span class="token operator">|</span> River      <span class="token operator">|</span> Song      <span class="token operator">|</span>        8
</pre><p>Let&#x2019;s say we wanted to find all the puppies that are younger than 6 months old.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> puppy_id
<span class="token keyword">FROM</span> puppies
<span class="token keyword">WHERE</span>
  age_yrs <span class="token operator">&lt;</span> <span class="token number">0.6</span><span class="token punctuation">;</span>
</pre><p>This would return two rows:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell">puppy_id
----------
        2
        8
<span class="token punctuation">(</span>2 rows<span class="token punctuation">)</span>
</pre><p>Now we want to use the above statement as a subquery (inside parentheses) in<br>
another query. You&#x2019;ll notice we&#x2019;re using a <code>WHERE</code> clause with the <a href="https://www.postgresql.org/docs/9.6/datatype-numeric.html">IN</a><br>
operator to check if the <code>puppy_id</code> from the &#x201C;friends&#x201D; table meets the<br>
conditions in the subquery.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> friends
<span class="token keyword">WHERE</span>
  puppy_id <span class="token operator">IN</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> puppy_id
    <span class="token keyword">FROM</span> puppies
    <span class="token keyword">WHERE</span>
      age_yrs <span class="token operator">&lt;</span> <span class="token number">0.6</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>We should get just one row back. River Song has a puppy younger than 6 months<br>
old.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"> <span class="token function">id</span> <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name <span class="token operator">|</span> puppy_id
----+------------+-----------+----------
  5 <span class="token operator">|</span> River      <span class="token operator">|</span> Song      <span class="token operator">|</span>        8
<span class="token punctuation">(</span>1 row<span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="using-joins-vs-subqueries">Using joins vs. subqueries</h2>

<p>We can use either a <code>JOIN</code> operation or a subquery to filter for the same<br>
information. Both methods can be used to get info from multiple tables. Take the query/subquery from above:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> friends
<span class="token keyword">WHERE</span>
  puppy_id <span class="token operator">IN</span>  <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> puppy_id
    <span class="token keyword">FROM</span> puppies
    <span class="token keyword">WHERE</span>
      age_yrs <span class="token operator">&lt;</span> <span class="token number">0.6</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Which produced the following result:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"> <span class="token function">id</span> <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name <span class="token operator">|</span> puppy_id
----+------------+-----------+----------
  5 <span class="token operator">|</span> River      <span class="token operator">|</span> Song      <span class="token operator">|</span>        8
<span class="token punctuation">(</span>1 row<span class="token punctuation">)</span>
</pre><p>Instead of using a <code>WHERE</code> clause with a subquery, we could use a <code>JOIN</code><br>
operation:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> friends
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> puppies <span class="token keyword">ON</span> <span class="token punctuation">(</span>puppies<span class="token punctuation">.</span>puppy_id <span class="token operator">=</span> friends<span class="token punctuation">.</span>puppy_id<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span>
  puppies<span class="token punctuation">.</span>age_yrs <span class="token operator">&lt;</span> <span class="token number">0.6</span><span class="token punctuation">;</span>
</pre><p>Again, we&#x2019;d get back one result, but because we used an <code>INNER JOIN</code> we have<br>
information from both the &#x201C;puppies&#x201D; and &#x201C;friends&#x201D; tables.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">id</span> <span class="token operator">|</span> first_name <span class="token operator">|</span> last_name <span class="token operator">|</span> puppy_id <span class="token operator">|</span>  name  <span class="token operator">|</span> age_yrs <span class="token operator">|</span> breed  <span class="token operator">|</span> weight_lbs <span class="token operator">|</span> microchipped <span class="token operator">|</span> puppy_id
----+------------+-----------+----------+--------+---------+--------+------------+--------------+----------
  5 <span class="token operator">|</span> River      <span class="token operator">|</span> Song      <span class="token operator">|</span>        8 <span class="token operator">|</span> Jaxson <span class="token operator">|</span>     0.4 <span class="token operator">|</span> Beagle <span class="token operator">|</span>         19 <span class="token operator">|</span> t            <span class="token operator">|</span>        8
<span class="token punctuation">(</span>1 row<span class="token punctuation">)</span>
</pre><h3 class="mume-header" id="should-i-use-a-join-or-a-subquery">Should I use a JOIN or a subquery?</h3>

<p>As stated earlier, we could use either a JOIN operation or a subquery to filter<br>
for table rows. However, you might want to think about whether using a JOIN or a<br>
subquery is more appropriate for retrieving data.</p>
<p>A JOIN operation is ideal when you want to combine rows from one or more tables<br>
based on a match condition. Subqueries work great when you&#x2019;re returning a single<br>
value. When you&#x2019;re returning multiple rows, you could opt for a subquery or a<br>
JOIN.</p>
<p>Executing a query using a JOIN could potentially be faster than executing a<br>
subquery that would return the same data. (A subquery will execute once for each<br>
row returned in the outer query, whereas the <code>INNER JOIN</code> only has to make one<br>
pass through the data.) However, this isn&#x2019;t always the case. Performance<br>
depends on the size of your data, what you&#x2019;re filtering for, and how the server<br>
optimizes the query. With smaller datasets, the difference in performance of a<br>
JOIN and subquery is imperceptible. However, there are use cases where a<br>
subquery would improve performance.</p>
<p>(<em>See this article for more info: <a href="https://www.postgresqltutorial.com/postgresql-round/">When is a SQL Subquery 260x Faster than a<br>
Left Join?</a></em>)</p>
<p>We can use the the <a href="http://www.postgresqltutorial.com/postgresql-explain/">EXPLAIN</a> statement to see runtime statistics of our<br>
queries that help with debugging slow queries. (We&apos;ll get into this more later!)</p>
<h2 class="mume-header" id="helpful-links-2">Helpful links:</h2>

<ul>
<li>PostgreSQL Tutorial: <a href="http://www.postgresqltutorial.com/postgresql-boolean/">PostgreSQL Joins</a></li>
<li>PostgreSQL Tutorial: <a href="https://www.postgresql.org/docs/9.6/sql-select.html#SQL-ORDERBY">PostgreSQL Subquery</a></li>
<li>PostgreSQL Docs: <a href="https://www.postgresql.org/docs/9.6/sql-select.html#SQL-LIMIT">Subquery Expressions</a></li>
<li>Essential SQL: <a href="https://www.essentialsql.com/what-is-the-difference-between-a-join-and-subquery/">Subqueries versus Joins</a></li>
<li>Essential SQL: <a href="https://www.essentialsql.com/get-ready-to-learn-sql-server-20-using-subqueries-in-the-select-statement/">Using Subqueries with the Select Statement</a></li>
</ul>
<hr>
<h1 class="mume-header" id="postgresql-indexes">PostgreSQL Indexes</h1>

<p>PostgreSQL indexes can help us optimize our queries for faster performance. In<br>
this reading, we&apos;ll learn how to create an index, when to use an index, and when<br>
to avoid using them.</p>
<h2 class="mume-header" id="what-is-a-postgresql-index">What is a PostgreSQL index?</h2>

<p>A PostgreSQL index works like an index in the back of a book. It points to<br>
information contained elsewhere and can be a faster method of looking up the<br>
information we want.</p>
<p>A book index contains a list of references with page numbers. Instead of having<br>
to scan all the pages of the book to find the places where specific information<br>
appears, a reader can simply check the index. In similar fashion, PostgreSQL<br>
indexes, which are special lookup tables, let us make faster database queries.</p>
<p>Let&#x2019;s say we had the following table:</p>
<table>
<thead>
<tr>
<th>addresses</th>
</tr>
</thead>
<tbody>
<tr>
<td>address_id</td>
</tr>
<tr>
<td>address</td>
</tr>
<tr>
<td>address2</td>
</tr>
<tr>
<td>city_id</td>
</tr>
<tr>
<td>postal_code</td>
</tr>
<tr>
<td>phone_number</td>
</tr>
</tbody>
</table>
<p>And we made a query to the database like the following:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> addresses <span class="token keyword">WHERE</span> phone_number <span class="token operator">=</span> <span class="token string">&apos;5556667777&apos;</span><span class="token punctuation">;</span>
</pre><p>The above query would scan every row of the &quot;addresses&quot; table to find matching<br>
rows based on the given phone number. If &quot;addresses&quot; is a large table (let&apos;s say<br>
with millions of entries), and we only expect to get a small number of results<br>
back (one row, or a few rows), then such a query would be an inefficient way to<br>
retrieve data. Instead of scanning every row, we could create an index for the<br>
phone column for faster data retrieval.</p>
<h2 class="mume-header" id="how-to-create-an-index">How to create an index</h2>

<p>To create a <a href="https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546">PostgreSQL index</a>, use the following syntax:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>We can create a phone number index for the above &quot;addresses&quot; table with the<br>
following:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> addresses_phone_index <span class="token keyword">ON</span> addresses <span class="token punctuation">(</span>phone_number<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>You can delete an index using the <code>DROP INDEX</code> command:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> addresses_phone_index<span class="token punctuation">;</span>
</pre><p>After an index has been created, the system will take care of the rest -- it<br>
will update an index when the table is modified and use the index in queries<br>
when it improves performance over a full table scan.</p>
<h3 class="mume-header" id="types-of-indexes">Types of indexes</h3>

<p>PostgreSQL provides several index types: B-tree, Hash, GiST and GIN. The CREATE<br>
INDEX command creates B-tree indexes by default, which fit the most common<br>
situations. While it&apos;s good to know other index types exist, you&apos;ll probably<br>
find yourself using the default B-tree most often.</p>
<p><strong>Single-Column Indexes</strong><br>
Uses only one table column.</p>
<p>Syntax:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Addresses Example:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> addresses_phone_index <span class="token keyword">ON</span> addresses <span class="token punctuation">(</span>phone_number<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Multiple-Column Indexes</strong><br>
Uses more than one table column.</p>
<p>Syntax:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>col1_name<span class="token punctuation">,</span> col2_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Addresses Example:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_addresses_city_post_code <span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>city_id<span class="token punctuation">,</span> postal_code<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Partial Indexes</strong><br>
Uses subset of a table defined by a conditional expression.</p>
<p>Syntax:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>conditional_expression<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Addresses Example:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> addresses_phone_index <span class="token keyword">ON</span> addresses <span class="token punctuation">(</span>phone_number<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>city_id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Note</strong>: Check out <a href="http://www.postgresqltutorial.com/postgresql-boolean/">Chapter 11 on Indexes</a> in the PostgreSQL docs for more<br>
about types of indexes.</p>
<h2 class="mume-header" id="when-to-use-an-index">When to use an index</h2>

<p>Indexes are intended to enhance database performance and are generally thought<br>
to be a faster data retrieval method than a sequential (or row-by-row) table<br>
scan. However, there are instances where using an index would not improve<br>
efficiency, such as the following:</p>
<ul>
<li>When working with a relatively small table (i.e. not a lot of rows)</li>
<li>When a table has frequent, large-batch update or insert operations</li>
<li>When working with columns that contain many NULL values</li>
<li>When working with columns that are frequently manipulated</li>
</ul>
<p>An important thing to note about indexes is that, while they can optimize READ<br>
(i.e. table query) speed, they can also hamper WRITE (i.e. table<br>
updates/insertions) speed. The latter&apos;s performance is affected due to the<br>
system having to spend time updating indexes whenever a change or insertion is<br>
made to the table.</p>
<p>The system optimizes database performance and decides whether to use an<br>
index in a query or to perform a sequential table scan, but we can analyze query<br>
performance ourselves to debug slow queries using <code>EXPLAIN</code> and <code>EXPLAIN ANALYZE</code>.</p>
<p>Here is an example of using <code>EXPLAIN</code> from the <a href="http://www.postgresqltutorial.com/postgresql-data-types/">PostgreSQL docs</a>:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tenk1<span class="token punctuation">;</span>

                         QUERY <span class="token keyword">PLAN</span>
<span class="token comment">-------------------------------------------------------------</span>
 Seq Scan <span class="token keyword">on</span> tenk1  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">.</span><span class="token number">.458</span><span class="token number">.00</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">10000</span> width<span class="token operator">=</span><span class="token number">244</span><span class="token punctuation">)</span>
</pre><p>In the QUERY PLAN above, we can see that a sequential table scan (<code>Seq Scan</code>)<br>
was performed on the table called &quot;tenk1&quot;. In parentheses, we see performance<br>
information:</p>
<ul>
<li>Estimated start-up cost (or time expended before the scan can start): 0.00</li>
<li>Estimated total cost: 458.00</li>
<li>Estimated number of rows output: 10000</li>
<li>Estimated average width (in bytes) of rows: 244</li>
</ul>
<p>It&apos;s important to note that, although we might mistake the number next to <code>cost</code><br>
for milliseconds, <code>cost</code> is not measured in any particular unit and is<br>
an arbitrary measurement relatively based on other query costs.</p>
<p>If we use the <code>ANALYZE</code> keyword after <code>EXPLAIN</code> on a <code>SELECT</code> statement, we can<br>
get more information about query performance:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">EXPLAIN</span> <span class="token keyword">ANALYZE</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> tenk1 t1<span class="token punctuation">,</span> tenk2 t2
<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>unique1 <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token operator">AND</span> t1<span class="token punctuation">.</span>unique2 <span class="token operator">=</span> t2<span class="token punctuation">.</span>unique2<span class="token punctuation">;</span>

                                                            QUERY <span class="token keyword">PLAN</span>
<span class="token comment">----------------------------------------------------------------------------------------------------------------------------------</span>
Nested <span class="token keyword">Loop</span>  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">2.37</span><span class="token punctuation">.</span><span class="token number">.553</span><span class="token number">.11</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">106</span> width<span class="token operator">=</span><span class="token number">488</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>actual <span class="token keyword">time</span><span class="token operator">=</span><span class="token number">1.392</span><span class="token punctuation">.</span><span class="token number">.12</span><span class="token number">.700</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">100</span> loops<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token operator">-</span><span class="token operator">&gt;</span>  Bitmap Heap Scan <span class="token keyword">on</span> tenk1 t1  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">2.37</span><span class="token punctuation">.</span><span class="token number">.232</span><span class="token number">.35</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">106</span> width<span class="token operator">=</span><span class="token number">244</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>actual <span class="token keyword">time</span><span class="token operator">=</span><span class="token number">0.878</span><span class="token punctuation">.</span><span class="token number">.2</span><span class="token number">.367</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">100</span> loops<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        Recheck Cond: <span class="token punctuation">(</span>unique1 <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span>  Bitmap <span class="token keyword">Index</span> Scan <span class="token keyword">on</span> tenk1_unique1  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">.</span><span class="token number">.2</span><span class="token number">.37</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">106</span> width<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>actual <span class="token keyword">time</span><span class="token operator">=</span><span class="token number">0.546</span><span class="token punctuation">.</span><span class="token number">.0</span><span class="token number">.546</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">100</span> loops<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
              <span class="token keyword">Index</span> Cond: <span class="token punctuation">(</span>unique1 <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token operator">-</span><span class="token operator">&gt;</span>  <span class="token keyword">Index</span> Scan <span class="token keyword">using</span> tenk2_unique2 <span class="token keyword">on</span> tenk2 t2  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">.</span><span class="token number">.3</span><span class="token number">.01</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">1</span> width<span class="token operator">=</span><span class="token number">244</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>actual <span class="token keyword">time</span><span class="token operator">=</span><span class="token number">0.067</span><span class="token punctuation">.</span><span class="token number">.0</span><span class="token number">.078</span> <span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">1</span> loops<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token keyword">Index</span> Cond: <span class="token punctuation">(</span>unique2 <span class="token operator">=</span> t1<span class="token punctuation">.</span>unique2<span class="token punctuation">)</span>
Total runtime: <span class="token number">14.452</span> ms
</pre><p>We can see in the QUERY PLAN above that there are other types of scans<br>
happening: Bitmap Heap Scan, Bitmap Index Scan, and Index Scan. We know that an<br>
index has been created, and the system is using it to scan for results instead<br>
of performing a sequential scan. At the bottom, we also have a total runtime of<br>
14.42 ms, which is pretty fast.</p>
<h2 class="mume-header" id="helpful-links-3">Helpful links:</h2>

<ul>
<li><a href="http://www.postgresqltutorial.com/postgresql-boolean/">PostgreSQL docs: Indexes</a></li>
<li><a href="https://sqlzoo.net/wiki/SELECT_Reference">PostgreSQL docs: Performance Tips</a></li>
<li><a href="https://www.postgresql.org/docs/9.6/datatype-numeric.html">Heroku DevCenter: Efficient Use of PostgreSQL Indexes</a></li>
</ul>
<h2 class="mume-header" id="what-we-learned-7">What we learned:</h2>

<ul>
<li>How to create a PostgreSQL index</li>
<li>Types of indexes</li>
<li>Use cases for indexes and when to avoid them</li>
<li>How to use <code>EXPLAIN</code> to analyze query performance</li>
</ul>
<hr>
<h1 class="mume-header" id="node-postgres-and-prepared-statements">Node-Postgres And Prepared Statements</h1>

<p>The library <a href="https://www.node-postgres.com">node-postgres</a> is, not too surprisingly, the library that Node.js<br>
applications use to connect to a database managed by a PostgreSQL RDBMS. The<br>
applications that you deal with will use this library to make connections to the<br>
database and get rows returned from your SQL <code>SELECT</code> statements.</p>
<h2 class="mume-header" id="connecting">Connecting</h2>

<p>The <strong>node-postgres</strong> library provides two ways to connect to it. You can use a<br>
single <code>Client</code> object, or you can use a <code>Pool</code> of <code>Client</code> objects. Normally,<br>
you want to use a <code>Pool</code> because creating and opening single connections to any<br>
database server is a &quot;costly&quot; operation in terms of CPU and network resources.<br>
A <code>Pool</code> creates a group of those <code>Client</code> connections and lets your code use<br>
them whenever it needs to.</p>
<p>To use a <code>Pool</code>, you specify any specific portions of the following connection<br>
parameters that you need. The default values for each parameter is listed with<br>
each parameter.</p>
<table>
<thead>
<tr>
<th>Connection parameter</th>
<th>What it indicates</th>
<th>Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td>user</td>
<td>The name of the user you want to connect as</td>
<td>The user name that runs the application</td>
</tr>
<tr>
<td>password</td>
<td>The password to use</td>
<td>The password set in your configuration</td>
</tr>
<tr>
<td>database</td>
<td>The name of the database to connect to</td>
<td>The user&apos;s database</td>
</tr>
<tr>
<td>port</td>
<td>The port over which to connect</td>
<td>5432</td>
</tr>
<tr>
<td>host</td>
<td>The name of the server to connect to</td>
<td>localhost</td>
</tr>
</tbody>
</table>
<p>Normally, you will only override the user and password fields, and sometimes the<br>
database if it doesn&apos;t match the user&apos;s name. You do that by instantiating a<br>
new <code>Pool</code> object and passing in an object with those key/value pairs.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Pool <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;pg&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token string">&apos;application_user&apos;</span><span class="token punctuation">,</span>
  password<span class="token punctuation">:</span> <span class="token string">&apos;iy7qTEcZ&apos;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Once you have an instance of the <code>Pool</code> class, you can use the <code>query</code> method on<br>
it to run queries. (The <code>query</code> method returns a Promise, so it&apos;s nice to just<br>
use <code>await</code> for it to finish.)</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
  SELECT id, name, age_yrs
  FROM puppies;
`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>When this runs, you will get an object that contains a property named &quot;rows&quot;.<br>
The value of &quot;rows&quot; will be an array of the rows that match the statement.<br>
Here&apos;s an example output from the code above.</p>
<pre data-role="codeBlock" data-info class="language-"><code>{
  rows:
    [ { id: 1, name: &apos;Cooper&apos;, age_yrs: &apos;1.0&apos; },
      { id: 2, name: &apos;Indie&apos;, age_yrs: &apos;0.5&apos; },
      { id: 3, name: &apos;Kota&apos;, age_yrs: &apos;0.7&apos; },
      { id: 4, name: &apos;Zoe&apos;, age_yrs: &apos;0.8&apos; },
      { id: 5, name: &apos;Charley&apos;, age_yrs: &apos;1.5&apos; },
      { id: 6, name: &apos;Ladybird&apos;, age_yrs: &apos;0.6&apos; },
      { id: 7, name: &apos;Callie&apos;, age_yrs: &apos;0.9&apos; },
      { id: 8, name: &apos;Jaxson&apos;, age_yrs: &apos;0.4&apos; },
      { id: 9, name: &apos;Leinni&apos;, age_yrs: &apos;1.0&apos; },
      { id: 10, name: &apos;Max&apos;, age_yrs: &apos;1.6&apos; } ],
}
</code></pre><p>You can see that the &quot;rows&quot; property contains an array of objects. Each object<br>
represents a row in the &quot;puppies&quot; table that matches the query. Each object has<br>
a property named after the column selected in the <code>SELECT</code> statement. The query<br>
read <code>SELECT id, name, age_yrs</code> and each object has an &quot;id&quot;, &quot;name&quot;, and an<br>
&quot;age_yrs&quot; property.</p>
<p>You can then use that array to loop over and do things with it. For example,<br>
you could print them to the console like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> row <span class="token keyword">of</span> results<span class="token punctuation">.</span>rows<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>row<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>row<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>row<span class="token punctuation">.</span>age_yrs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> old&lt;/li&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>Which would show</p>
<pre data-role="codeBlock" data-info class="language-"><code>1. Cooper is 1.0 years old
2. Indie is 0.5 years old
3. Kots is 0.7 years old
...
</code></pre><h2 class="mume-header" id="prepared-statement">Prepared Statement</h2>

<p>Prepared statements are SQL statements that have parameters in them that you can<br>
use to substitute values. The parameters are normally part of the <code>WHERE</code> clause<br>
in all statements. You will also use then in the <code>SET</code> portion of <code>UPDATE</code><br>
statements and the <code>VALUES</code> portion of <code>INSERT</code> statements.</p>
<p>For example, say your application collected the information to create a new row<br>
in the puppy table by asking for the puppy&apos;s name, age, breed, weight, and if<br>
it was microchipped. You&apos;d have those values stored in variables somewhere.<br>
You&apos;d want to create an <code>INSERT</code> statement that inserts the data from those<br>
variables into a SQL statement that the RDBMS could then execute to insert a<br>
new row.</p>
<p>Think about what a generic <code>INSERT</code> statement would look like. It would have to<br>
have the</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> puppies <span class="token punctuation">(</span>name<span class="token punctuation">,</span> age_yrs<span class="token punctuation">,</span> breed<span class="token punctuation">,</span> weight_lbs<span class="token punctuation">,</span> microchipped<span class="token punctuation">)</span>
</pre><p>portion of the statement. The part that would change with each time you inserted<br>
would be the specific values that would go into the <code>VALUES</code> section of the<br>
<code>INSERT</code> statement. With prepared statements, you use <em>positional parameters</em><br>
to act as placeholders for the actual values that you will provide the query.</p>
<p>For example, the generic <code>INSERT</code> statement from above would look like this.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> puppies <span class="token punctuation">(</span>name<span class="token punctuation">,</span> age_yrs<span class="token punctuation">,</span> breed<span class="token punctuation">,</span> weight_lbs<span class="token punctuation">,</span> microchipped<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">2</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">4</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Each of the &quot;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">&quot;</mi><mi>p</mi><mi>l</mi><mi>a</mi><mi>c</mi><mi>e</mi><mi>h</mi><mi>o</mi><mi>l</mi><mi>d</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>i</mi><mi>s</mi><mi>a</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>u</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>t</mi><mi>h</mi><mi>a</mi><mi>t</mi><mi>y</mi><mi>o</mi><mi>u</mi><mi>p</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi mathvariant="normal">.</mi><mi>T</mi><mi>h</mi><mi>a</mi><mi>t</mi><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi><mi>s</mi><mo separator="true">,</mo><mi>t</mi><mi>h</mi><mi>e</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>a</mi><mi>t</mi><mi>p</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>w</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>b</mi><mi>e</mi><mi>p</mi><mi>u</mi><mi>t</mi><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi mathvariant="normal">&quot;</mi></mrow><annotation encoding="application/x-tex">&quot; placeholders is a positional argument for the parameters that
you pass in. That means, the value that pass in for the first parameter will be
put where the &quot;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">&quot;</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault">h</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">u</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord">&quot;</span></span></span></span>1&quot; placeholder is, which is the value for the &quot;name&quot; of the<br>
puppy. The &quot;$2&quot; corresponds to the &quot;age_yrs&quot; column, so it should contain the<br>
age of the puppy. This continues for the third, fourth, and fifth parameters,<br>
as well.</p>
<p>Assume that in your code, you have the variables <code>name</code>, <code>age</code>, <code>breedName</code>,<br>
<code>weight</code>, and <code>isMicrochipped</code> containing the values that the user provided for<br>
the new puppy. Then, your use of the <code>query</code> method will now include another<br>
argument, the values that you want to pass in inside an array.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
  INSERT INTO puppies (name, age_yrs, breed, weight_lbs, microchipped)
  VALUES ($1, $2, $3, $4, $5);
`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> breedName<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> isMicrochipped<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>You can see that the variable <code>name</code> is in the first position of the array, so<br>
it will be substituted into the placeholder &quot;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant="normal">&quot;</mi><mi mathvariant="normal">.</mi><mi>T</mi><mi>h</mi><mi>e</mi><mi mathvariant="normal">&#x2018;</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi mathvariant="normal">&#x2018;</mi><mi>v</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>a</mi><mi>y</mi><mo separator="true">,</mo><mi>s</mi><mi>o</mi><mi>i</mi><mi>t</mi><mi>w</mi><mi>i</mi><mi>l</mi><mi>l</mi><mi>b</mi><mi>e</mi><mi>s</mi><mi>u</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>t</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>t</mi><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi mathvariant="normal">&quot;</mi></mrow><annotation encoding="application/x-tex">1&quot;. The `age` variable is in the
second position of the array, so it will be substituted into the &quot;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord">&quot;</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord">&#x2018;</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">e</span><span class="mord">&#x2018;</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">u</span><span class="mord mathdefault">b</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord">&quot;</span></span></span></span>2&quot;<br>
placeholder.</p>
<p>The full documentation for how to use queries with <strong>node-postgres</strong> can be<br>
found on the <a href="https://node-postgres.com/features/queries">Queries</a> documentation page on their Web site.</p>
<h2 class="mume-header" id="try-it-out-for-yourself">Try it out for yourself</h2>

<p>Make sure you have a database with a table that has data in it. If you don&apos;t,<br>
create a new database and run the following SQL.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> puppies <span class="token punctuation">(</span>
  id <span class="token keyword">SERIAL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  age_yrs <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  breed <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  weight_lbs <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  microchipped <span class="token keyword">BOOLEAN</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">FALSE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> puppies<span class="token punctuation">(</span>name<span class="token punctuation">,</span> age_yrs<span class="token punctuation">,</span> breed<span class="token punctuation">,</span> weight_lbs<span class="token punctuation">,</span> microchipped<span class="token punctuation">)</span>
<span class="token keyword">values</span>
<span class="token punctuation">(</span><span class="token string">&apos;Cooper&apos;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&apos;Miniature Schnauzer&apos;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Indie&apos;</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token string">&apos;Yorkshire Terrier&apos;</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Kota&apos;</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token string">&apos;Australian Shepherd&apos;</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token string">&apos;no&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Zoe&apos;</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token string">&apos;Korean Jindo&apos;</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Charley&apos;</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token string">&apos;Basset Hound&apos;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&apos;no&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Ladybird&apos;</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token string">&apos;Labradoodle&apos;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Callie&apos;</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token string">&apos;Corgi&apos;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">&apos;no&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Jaxson&apos;</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token string">&apos;Beagle&apos;</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Leinni&apos;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&apos;Miniature Schnauzer&apos;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&apos;yes&apos;</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&apos;Max&apos;</span><span class="token punctuation">,</span> <span class="token number">1.6</span><span class="token punctuation">,</span> <span class="token string">&apos;German Shepherd&apos;</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token string">&apos;no&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now that you have ten rows in the &quot;puppies&quot; table of a database, you can create<br>
a simple Node.js project to access it.</p>
<p>Create a new directory somewhere that&apos;s not part of an existing project. Run<br>
<code>npm init -y</code> to initialize the <strong>package.json</strong> file. Then, run <code>npm install pg</code> to install the library from this section. (Why is the name of the library<br>
&quot;node-postgres&quot; but you install &quot;pg&quot;? Dunno.) Finally, open Visual Studio Code<br>
for the current directory with <code>code .</code>.</p>
<p>Create a new file named <strong>sql-test.js</strong>.</p>
<p>The first thing you need to do is import the <code>Pool</code> class from the<br>
<strong>node-postgres</strong> library. The name of the library in the <strong>node_modules</strong><br>
directory is &quot;pg&quot;. That line of code looks like this and can be found all over the<br>
<a href="https://www.node-postgres.com">node-postgres</a> documentation.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Pool <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;pg&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now, write some SQL that will select all of the records from the &quot;puppies&quot;<br>
table. (This is assuming you want to select puppies. If you&apos;re using a different<br>
table with different data, write the appropriate SQL here.)</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Pool <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;pg&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> allPuppies <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
  SELECT id, name, age_yrs, breed, weight_lbs, microchipped
  FROM puppies;
`</span></span><span class="token punctuation">;</span>
</pre><p>You will now use that with a new <code>Pool</code> object. You will need to know the name<br>
of the database that the &quot;puppies&quot; table is in (or whatever database you want<br>
to connect to).</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Pool <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;pg&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> allPuppies <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
  SELECT id, name, age_yrs, breed, weight_lbs, microchipped
  FROM puppies;
`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  database<span class="token punctuation">:</span> <span class="token string">&apos;&#xAB;database name&#xBB;&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Of course, replace &quot;&#xAB;database name&#xBB;&quot; with the name of your database. Otherwise,<br>
when you run it, you will see this error message.</p>
<pre data-role="codeBlock" data-info class="language-"><code>UnhandledPromiseRejectionWarning: error: database &quot;&#xAB;database name&#xBB;&quot; does not exist
</code></pre><p>This will, by default, connect to &quot;localhost&quot; on port &quot;5432&quot; with your user<br>
credentials because you did not specify any other parameters.</p>
<p>Once you have the pool, you can execute the query that you have in <code>allPuppies</code>.<br>
Remember that the <code>query</code> method returns a Promise. This code wraps the call to<br>
<code>query</code> in an <code>async function</code> so that it can use the <code>await</code> keyword for<br>
simplicity&apos;s sake. Then, it prints out the rows that it fetched to the console.<br>
Finally, it calls <code>end</code> on the connection pool object to tell <strong>node-postgres</strong><br>
to close all the connections and quit. Otherwise, your application will just<br>
hang and you&apos;ll have to close it with Control+C.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Pool <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;pg&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> allPuppiesSql <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
  SELECT id, name, age_yrs, breed, weight_lbs, microchipped
  FROM puppies;
`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  database<span class="token punctuation">:</span> <span class="token string">&apos;&#xAB;database name&#xBB;&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">selectAllPuppies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>allPuppiesSql<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
  pool<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">selectAllPuppies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>When you run this with <code>node sql-test.js</code>, you should see some output like this<br>
although likely in a nicer format.</p>
<pre data-role="codeBlock" data-info class="language-"><code>[ { id: 1, name: &apos;Cooper&apos;, age_yrs: &apos;1.0&apos;, breed: &apos;Miniature Schnauzer&apos;, weight_lbs: 18, microchipped: true },
  { id: 2, name: &apos;Indie&apos;, age_yrs: &apos;0.5&apos;, breed: &apos;Yorkshire Terrier&apos;, weight_lbs: 13, microchipped: true },
  { id: 3, name: &apos;Kota&apos;, age_yrs: &apos;0.7&apos;, breed: &apos;Australian Shepherd&apos;, weight_lbs: 26, microchipped: false },
  { id: 4, name: &apos;Zoe&apos;, age_yrs: &apos;0.8&apos;, breed: &apos;Korean Jindo&apos;, weight_lbs: 32, microchipped: true },
  { id: 5, name: &apos;Charley&apos;, age_yrs: &apos;1.5&apos;, breed: &apos;Basset Hound&apos;, weight_lbs: 25, microchipped: false },
  { id: 6, name: &apos;Ladybird&apos;, age_yrs: &apos;0.6&apos;, breed: &apos;Labradoodle&apos;, weight_lbs: 20, microchipped: true },
  { id: 7, name: &apos;Callie&apos;, age_yrs: &apos;0.9&apos;, breed: &apos;Corgi&apos;, weight_lbs: 16, microchipped: false },
  { id: 8, name: &apos;Jaxson&apos;, age_yrs: &apos;0.4&apos;, breed: &apos;Beagle&apos;, weight_lbs: 19, microchipped: true },
  { id: 9, name: &apos;Leinni&apos;, age_yrs: &apos;1.0&apos;, breed: &apos;Miniature Schnauzer&apos;, weight_lbs: 25, microchipped: true },
  { id: 10, name: &apos;Max&apos;, age_yrs: &apos;1.6&apos;, breed: &apos;German Shepherd&apos;, weight_lbs: 65, microchipped: false } ]
</code></pre><p>Now, try one of those parameterized queries. Comment out the <code>selectAllPuppies</code><br>
function and invocation.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// async function selectAllPuppies() {</span>
<span class="token comment">//   const results = await pool.query(allPuppiesSql);</span>
<span class="token comment">//   console.log(results.rows);</span>
<span class="token comment">//   pool.end();</span>
<span class="token comment">// }</span>

<span class="token comment">// selectAllPuppies();</span>
</pre><p>Add the following content to the bottom of the file.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Define the parameterized query where it will select a puppy</span>
<span class="token comment">// based on an id</span>
<span class="token keyword">const</span> singlePuppySql <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
  SELECT id, name, age_yrs, breed, weight_lbs, microchipped
  FROM puppies
  WHERE ID = $1;
`</span></span><span class="token punctuation">;</span>

<span class="token comment">// Run the parameterized SQL by passing in an array that contains</span>
<span class="token comment">// the puppyId to the query method. Then, print the results and</span>
<span class="token comment">// end the pool.</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">selectOnePuppy</span><span class="token punctuation">(</span><span class="token parameter">puppyId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>singlePuppySql<span class="token punctuation">,</span> <span class="token punctuation">[</span>puppyId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
  pool<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Get the id from the command line and store it</span>
<span class="token comment">// in the variable &quot;id&quot;. Pass that value to the</span>
<span class="token comment">// selectOnePuppy function.</span>
<span class="token keyword">const</span> id <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">selectOnePuppy</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now, when you run the program, include a number after the command. For example,<br>
if you run <code>node sql-test.js 1</code>, it will print out</p>
<pre data-role="codeBlock" data-info class="language-"><code>[ { id: 1,
    name: &apos;Cooper&apos;,
    age_yrs: &apos;1.0&apos;,
    breed: &apos;Miniature Schnauzer&apos;,
    weight_lbs: 18,
    microchipped: true } ]
</code></pre><p>If you run <code>node sql-test.js 4</code>, it will print out</p>
<pre data-role="codeBlock" data-info class="language-"><code>[ { id: 4,
    name: &apos;Zoe&apos;,
    age_yrs: &apos;0.8&apos;,
    breed: &apos;Korean Jindo&apos;,
    weight_lbs: 32,
    microchipped: true } ]
</code></pre><p>That&apos;s because the number that you type on the command line is being substituted<br>
in for the &quot;$1&quot; in the parameterized query. That means, when you pass in &quot;4&quot;,<br>
It&apos;s like the RDMBS takes the parameterized query</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age_yrs<span class="token punctuation">,</span> breed<span class="token punctuation">,</span> weight_lbs<span class="token punctuation">,</span> microchipped
<span class="token keyword">FROM</span> puppies
<span class="token keyword">WHERE</span> ID <span class="token operator">=</span> $<span class="token number">1</span><span class="token punctuation">;</span>
</pre><p>and your value &quot;4&quot;</p>
<p>and mushes them together to make</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age_yrs<span class="token punctuation">,</span> breed<span class="token punctuation">,</span> weight_lbs<span class="token punctuation">,</span> microchipped
<span class="token keyword">FROM</span> puppies
<span class="token keyword">WHERE</span> ID <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">-- Value substituted here by PostgreSQL.</span>
</pre><p>That happens because when you run the query, you call the <code>query</code> method like<br>
this.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>singlePuppySql<span class="token punctuation">,</span> <span class="token punctuation">[</span>puppyId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>which passes along the sql stored in <code>singlePuppySql</code> and the value stored in<br>
<code>puppyId</code> (as the first parameter) to PostgreSQL.</p>
<p>What do you think will happen if you change <code>singlePuppySql</code> to have <em>two</em><br>
parameters instead of one, but only pass in one parameter through the <code>query</code><br>
method?</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> singlePuppySql <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
  SELECT id, name, age_yrs, breed, weight_lbs, microchipped
  FROM puppies
  WHERE ID = $1
  AND age_yrs &gt; $2;
`</span></span><span class="token punctuation">;</span>
</pre><p>PostgreSQL is smart enough to see that you&apos;ve only provided one parameter value<br>
but it needs <em>two</em> positional parameters. It gives you the error message</p>
<pre data-role="codeBlock" data-info class="language-"><code>error: bind message supplies 1 parameters, but prepared statement &quot;&quot; requires 2
</code></pre><p>In this error message, the term &quot;bind message&quot; is the kind of message that the<br>
<code>query</code> method sends to PostgreSQL when you provide parameters to it.</p>
<p>Change the query back to how it was. Now, add an extra parameter to the<br>
invocation of the <code>query</code> method. What do you think will</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>singlePuppySql<span class="token punctuation">,</span> <span class="token punctuation">[</span>puppyId<span class="token punctuation">,</span> <span class="token string">&apos;extra parameter&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Again, PostgreSQL gives you an error message about a mismatch in the number of<br>
placeholders in the SQL and the number of values you passed to it.</p>
<pre data-role="codeBlock" data-info class="language-"><code>error: bind message supplies 2 parameters, but prepared statement &quot;&quot; requires 1
</code></pre><h2 class="mume-header" id="what-youve-learned">What you&apos;ve learned</h2>

<p>Here, you&apos;ve seen how to connect to a PostgreSQL database using the<br>
<strong>node-postgres</strong> library named &quot;pg&quot;. You saw how to run simple SQL statements<br>
against it and handle the results. You also saw how to create parameterized<br>
queries so that you can pass in values to be substituted.</p>
<p>If you are using the <strong>node-postgres</strong> library and running your own handcrafted<br>
SQL, you will most often use parameterized queries. It&apos;s good to get familiar<br>
with them.</p>
<hr>
<h1 class="mume-header" id="recipe-box-project">Recipe Box Project</h1>

<p>In this project, you will build the Data Access Layer to power a Web<br>
application. This means that you will provide all of the SQL that it takes to<br>
get data into and from the database. You will do this in SQL files that the<br>
application will load and read.</p>
<p><strong>Note</strong>: This is not a good way to create a database-backed application. This<br>
project is structured this way so that it isolates the activity of SQL writing.<br>
Do not use this project as a template for your future projects.</p>
<h2 class="mume-header" id="the-data-model-analysis">The data model analysis</h2>

<p>What goes into a recipe box? Why, recipes, of course! Here&apos;s an example recipe<br>
card.</p>
<p><img src="images/sql-recipe-card.jpeg" alt="Recipe card"></p>
<p>You can see that a recipe is made up of three basic parts:</p>
<ul>
<li>A title,</li>
<li>A list of ingredients, and</li>
<li>A list of instructions.</li>
</ul>
<p>You&apos;re going to add a little more to that, too. It will also have</p>
<ul>
<li>The date/time that it was entered into the recipe box, and</li>
<li>The date/time it was last updated in the recipe box.</li>
</ul>
<p>These are good pieces of data to have so that you can show them &quot;most recent&quot;<br>
for example.</p>
<p>Ingredients themselves are complex data types and need their own structure. They<br>
&quot;belong&quot; to a recipe. That means they&apos;ll need to reference that recipe. That<br>
means an ingredient is made up of:</p>
<ul>
<li>An amount (optional),</li>
<li>A unit of measure (optional),</li>
<li>The actual food stuff, and</li>
<li>The id of the recipe that it belongs to.</li>
</ul>
<p>That unit of measure is a good candidate for normalization, don&apos;t you think?<br>
It&apos;s a predefined list of options that should not change and that you don&apos;t want<br>
people just typing whatever they want in there, not if you want to maintain<br>
data integrity. Otherwise, you&apos;ll end up with &quot;C&quot;, &quot;c&quot;, &quot;cup&quot;, &quot;CUP&quot;, &quot;Cup&quot;, and<br>
all the other permutations, each of which is a distinct value but means the same<br>
thing.</p>
<p>Instructions are also complex objects, but not by looking at them. Initially,<br>
one might only see text that comprises an instruction. But, very importantly,<br>
instructions have <em>order</em>. They also <em>belong</em> to the recipe. With that in mind,<br>
an instruction is made up of:</p>
<ul>
<li>The text of the instruction,</li>
<li>The order that it appears in the recipe, and</li>
<li>The id of the recipe that it belongs to.</li>
</ul>
<p>That is enough to make a good model for the recipe box.</p>
<p><img src="images/sql-recipe-box-data-model.png" alt="recipe box data model"></p>
<h2 class="mume-header" id="getting-started-1">Getting started</h2>

<ul>
<li>Download the starter project from<br>
<a href="https://github.com/appacademy-starters/sql-recipe-box">https://github.com/appacademy-starters/sql-recipe-box</a></li>
<li>Run <code>npm install</code> to install the packages</li>
<li>Run <code>npm start</code> to start the server on port 3000</li>
</ul>
<p>You&apos;ll do all of your work in the <strong>data-access-layer</strong> directory. In there, you<br>
will find a series of SQL files. In each, you will find instructions of what to<br>
do to make the user interface to work. They are numbered in an implied order for<br>
you to complete them. The only real requirement is that you finish the SQL for<br>
the <strong>00a-schema.sql</strong> and <strong>00b-seed.sql</strong> files first. That way, as you make<br>
your way through the rest of the SQL files, the tables and some of the data will<br>
already exist for you. You can run the command <code>npm run seed</code> to run both of<br>
those files or pipe each it into <code>psql</code> as you&apos;ve been doing.</p>
<p>Either way that you decide to seed the database, you&apos;ll need to stop your<br>
server. The seed won&apos;t correctly run while the application maintains a<br>
connection to the application database. You may also need to exit all of the<br>
active <code>psql</code> instances that you have running to close out all of the active<br>
connections. When you run the seed, if it reports that it can&apos;t do something<br>
because of active connections, look for a running instance of the server,<br>
Postbird, or <code>psql</code> with that connection.</p>
<p><strong>Warning</strong>: running the seed files will destroy all data that you have in the<br>
database.</p>
<h2 class="mume-header" id="your-sql">Your SQL</h2>

<p>When you write the SQL, they will mostly be parameterized queries. The first<br>
couple of files will show you how it needs to be done, where you will place the<br>
parameter placeholders &quot;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant="normal">&quot;</mi><mo separator="true">,</mo><mi mathvariant="normal">&quot;</mi></mrow><annotation encoding="application/x-tex">1&quot;, &quot;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord">&quot;</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">&quot;</span></span></span></span>2&quot;, and so on. If you need to, refer to the<br>
<a href="https://node-postgres.com/features/queries#Parameterized%20query">Parameterized query</a> section of the documentation for <strong>node-postgres</strong>.</p>
<p>In each of the following files in the <strong>data-access-layer</strong>, you will find one<br>
or more lines with the content <code>-- YOUR CODE HERE</code>. It is your job to write the<br>
SQL statement described in the block above that code. Each file is named with<br>
the intent of the SQL that it should contain.</p>
<h2 class="mume-header" id="the-application">The application</h2>

<p>The application is a standard <a href="https://www.expressjs.com">express.js</a> application using the <a href="https://pugjs.org">pug</a> library<br>
to generate the HTML and the <a href="https://www.node-postgres.com">node-postgres</a> library to connect to the database.</p>
<p>It reads your SQL files whenever it wants to make a database call. If your file<br>
throws an error, then the UI handles it by telling you what needs to be fixed<br>
so that the UI will work. The application will also output error messages for<br>
missing functionality.</p>
<p>The SQL files contain a description of what the content is and where it&apos;s used<br>
in the application. Tying those together, you&apos;ll know you&apos;re done when you have<br>
all of the SQL files containing queries and there are no errors in the UI or<br>
console.</p>
<h2 class="mume-header" id="directions">Directions</h2>

<p>Fill out the <strong>00a-schema.sql</strong> and <strong>00b-seed.sql</strong> files first. Then seed<br>
the database with command, <code>npm run seed</code>.</p>
<h3 class="mume-header" id="home-page">Home Page</h3>

<p>Start the server by running <code>npm run dev</code>. Then go to <code>localhost:3000</code> you should<br>
see the home page with &quot;Latest Recipes&quot;. To show the latest recipes properly,<br>
complete the <code>01-get-ten-most-recent-recipes.sql</code> file.</p>
<p>After completing the file, make sure you correctly defined the sql query so that<br>
the first recipe listed is the most recently updated recipe.</p>
<h3 class="mume-header" id="recipesid"><code>/recipes/:id</code></h3>

<p>If you click on one of the recipes in the list of recipes on the home page, it<br>
will direct you to that recipe&apos;s Detail Page. Complete the following files that<br>
correspond to this page and make sure to test a file right after you fill out<br>
the file by refreshing the page:</p>
<ul>
<li><code>02a-get-recipe-by-id.sql</code></li>
<li><code>02b-get-ingredients-by-recipe-id.sql</code></li>
<li><code>02c-get-instructions-by-recipe-id.sql</code></li>
</ul>
<p>Make sure to read the instructions well! In all the above sql queries, the<br>
<code>$1</code> parameter will be the recipe id.</p>
<h3 class="mume-header" id="recipesnew"><code>/recipes/new</code></h3>

<p>Click on <code>ADD A RECIPE</code> button on the Navigation Bar to direct you to the<br>
New Recipe Form page. Fill out the <code>03a-insert-new-recipe.sql</code> file so you can<br>
create a new recipe.</p>
<h3 class="mume-header" id="recipesidedit"><code>/recipes/:id/edit</code></h3>

<p>After creating a new recipe, you will be directed to the Recipe Edit page where<br>
you can add instructions and ingredients to a recipe. Complete the following<br>
files that correspond to this page and make sure to test a file right after<br>
you fill out the file:</p>
<ul>
<li><code>03b-get-units-of-measure.sql</code></li>
<li><code>04-insert-new-ingredient.sql</code></li>
<li><code>05-insert-new-instruction.sql</code></li>
<li><code>06-delete-recipe.sql</code></li>
</ul>
<h3 class="mume-header" id="recipestermsearchterm"><code>/recipes?term={searchTerm}</code></h3>

<p>Allow users to find recipes by a part of their name using the Search Bar in the<br>
Navigation Bar. Complete <code>07-search-recipes.sql</code> for this feature.</p>
<hr>
<h1 class="mume-header undefined" id="week-10-day-4brsequelize-orm">WEEK-10 DAY-4<br><em>Sequelize ORM</em></h1>

<h1 class="mume-header" id="orm-learning-objectives">ORM Learning Objectives</h1>

<p>To ease the use of SQL, the object-relational mapping tool was invented. This<br>
allows developers to focus on their application code and let a library generate<br>
all of the SQL for them. Depending on which developer you ask, this is a miracle<br>
or a travesty. Either way, those developers use them because writing all of the<br>
SQL by hand is a chore that most software developers just don&apos;t want to do.</p>
<p>In this section, you will learn:</p>
<ul>
<li>How to install, configure, and use Sequelize, an ORM for JavaScript</li>
<li>How to use database migrations to make your database grow with your<br>
application in a source-control enabled way</li>
<li>How to perform CRUD operations with Sequelize</li>
<li>How to query using Sequelize</li>
<li>How to perform data validations with Sequelize</li>
<li>How to use transactions with Sequelize</li>
</ul>
<hr>
<h1 class="mume-header" id="installing-and-using-sequelize">Installing And Using Sequelize</h1>

<p>Now that you have gained experience with SQL, it is time to learn how to<br>
access data stored in a SQL database using a JavaScript program. You<br>
will use a JavaScript library called Sequelize to do this. Sequelize is<br>
an example of an <em>Object Relational Mapping</em> (commonly abbreviated<br>
<em>ORM</em>). An ORM allows a JavaScript programmer to fetch and store data in<br>
a SQL database using JavaScript functions instead of writing SQL code.</p>
<p>When you finish this reading you will be able to:</p>
<ul>
<li>Describe what an Object Relational Mapping is and what it is used for.</li>
<li>Install and configure the packages needed to use Sequelize.</li>
<li>Use Sequelize to generate JavaScript code that fetches and stores data<br>
in a SQL database.</li>
<li>Use those auto-generated methods to fetch and store data in a SQL<br>
database.</li>
</ul>
<h2 class="mume-header" id="what-is-an-orm">What Is An ORM?</h2>

<p>An <em>Object Relational Mapping</em> is a library that allows you to access<br>
data stored in a SQL database through object-oriented, non-SQL code<br>
(such as JavaScript). You will write <em>object-oriented</em> code that<br>
accesses data stored in a <em>relational</em> SQL database like Postgres. The<br>
ORM is the <em>mapping</em> that will &quot;translate&quot; your object-oriented code<br>
into SQL code that the database can run. The ORM will automatically<br>
generate SQL code for common tasks like fetching and storing data.</p>
<p>You will learn how to use the <a href="https://sequelize.org/v5/">Sequelize ORM</a>.<br>
Sequelize is the most widely used JavaScript ORM library.</p>
<h2 class="mume-header" id="how-to-install-sequelize">How To Install Sequelize</h2>

<p>After creating a new node project with <code>npm init</code> we are ready to install the<br>
Sequelize library.</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> sequelize@^5.0.0
<span class="token function">npm</span> <span class="token function">install</span> sequelize-cli@^5.0.0
<span class="token function">npm</span> <span class="token function">install</span> pg@^8.0.0
</pre><p>We have installed not only the Sequelize library, but also a command<br>
line tool called <code>sequelize-cli</code> that will help us auto-generate and<br>
manage JavaScript files which will hold our Sequelize ORM code.</p>
<p>Last, we have also installed the pg library. This library allows<br>
Sequelize to access a Postgres database. If you were using a different<br>
database software (such as MySQL), you would need to install a different<br>
library.</p>
<h2 class="mume-header" id="how-to-initialize-sequelize">How To Initialize Sequelize</h2>

<p>We can run the command <code>npx sequelize init</code> to automatically setup the following directory structure for our project:</p>
<pre data-role="codeBlock" data-info class="language-"><code>.
&#x251C;&#x2500;&#x2500; config
&#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; config.json
&#x251C;&#x2500;&#x2500; migrations
&#x251C;&#x2500;&#x2500; models
&#x2502;&#xA0;&#xA0; &#x2514;&#x2500;&#x2500; index.js
&#x251C;&#x2500;&#x2500; node_modules
&#x251C;&#x2500;&#x2500; package-lock.json
&#x251C;&#x2500;&#x2500; package.json
&#x2514;&#x2500;&#x2500; seeders
</code></pre><blockquote>
<p>Aside: the <code>npx</code> tool allows you to easily run scripts provided by<br>
packages like <code>sequelize-cli</code>. If you don&apos;t already have <code>npx</code>, you can<br>
install it with <code>npm install npx --global</code>. Without <code>npx</code> you would have<br>
to run the bash command: <code>./node_modules/.bin/sequelize init</code>. This<br>
directly runs the <code>sequelize</code> script provided by the installed<br>
<code>sequelize-cli</code> package.</p>
</blockquote>
<p>Having run <code>npx sequelize init</code>, we must write our database login<br>
information into <code>config/config.json</code>.</p>
<p>By default this file contains different sections we call &quot;environments&quot;. In a<br>
typical company you will have different database servers and configuration<br>
depending on where you app is running. Development is usually where you do<br>
your development work. In our case this is our local computer. But test might be<br>
and environment where you run tests, and production is the environment where<br>
real users are interacting with your application.</p>
<p>Since we are doing development, we can just modify the &quot;development&quot; section to look<br>
like this:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;development&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;catsdbuser&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;catsdbpassword&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;database&quot;</span><span class="token operator">:</span> <span class="token string">&quot;catsdb&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dialect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;postgres&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>...
</pre><p>Here we are supposing that we have already created a <code>catsdb</code> database<br>
owned by the user <code>catsdbuser</code>, with password <code>catsdbpassword</code>. By<br>
setting <code>host</code> to <code>127.0.0.1</code>, we are saying that the database will run<br>
on the same machine as my JavaScript application. Last, we specify that<br>
we are using a <code>postgres</code> database.</p>
<h2 class="mume-header" id="verifying-that-sequelize-can-connect-to-the-database">Verifying That Sequelize Can Connect To The Database</h2>

<p>At the top level of our project, we should create an <code>index.js</code> file.<br>
From this file we will verify that Sequelize can connect to the SQL<br>
database. To do this, we use the <code>authenticate</code> method of the sequelize object.</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./index.js</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Database connection failure.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Database connection success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Sequelize is ready to use!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Close database connection when done with it.</span>
  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Prints:</span>
<span class="token comment">//</span>
<span class="token comment">// Executing (default): SELECT 1+1 AS result</span>
<span class="token comment">// Database connection success!</span>
<span class="token comment">// Sequelize is ready to use!</span>
</pre><p>You may observe that the <code>authenticate</code> method returns a JavaScript<br>
<code>Promise</code> object. We use <code>await</code> to wait for the database connection to<br>
be established. If <code>authenticate</code> fails to connect, the <code>Promise</code> will<br>
be rejected. Since we use <code>await</code>, an exception will be thrown.</p>
<p>Many Sequelize methods return <code>Promise</code>s. Using <code>async</code> and <code>await</code> lets<br>
us use Sequelize methods as if they were synchronous. This helps reduce<br>
code complexity significantly.</p>
<p>Note that I call <code>sequelize.close()</code>. This closes the connection to<br>
the database. A Node.js JavaScript program will not terminate until all<br>
open files and database connections are closed. Thus, to make sure the<br>
Node.js program doesn&apos;t &quot;hang&quot; at the end, we close the database<br>
connection. Otherwise we will be forced to kill the Node.js program with<br>
<code>CTRL-C</code>, which is somewhat annoying.</p>
<h2 class="mume-header" id="our-preexisting-database-schema">Our Preexisting Database Schema</h2>

<p>We are assuming that we are working with a preexisting SQL database. Our<br>
<code>catsdb</code> has a single table: <code>Cats</code>. Using the <code>psql</code> command-line<br>
program, we can describe the pre-existing <code>Cats</code> table below.</p>
<pre data-role="codeBlock" data-info class="language-"><code>catsdb=&gt; \d &quot;Cats&quot;
                                         Table &quot;public.Cats&quot;
    Column    |           Type           | Collation | Nullable |              Default
--------------+--------------------------+-----------+----------+------------------------------------
 id           | integer                  |           | not null | nextval(&apos;&quot;Cats_id_seq&quot;&apos;::regclass)
 firstName    | character varying(255)   |           |          |
 specialSkill | character varying(255)   |           |          |
 age          | integer                  |           |          |
 createdAt    | timestamp with time zone |           | not null |
 updatedAt    | timestamp with time zone |           | not null |
Indexes:
    &quot;Cats_pkey&quot; PRIMARY KEY, btree (id)
</code></pre><p>Besides a primary key <code>id</code>, each <code>Cats</code> record has a <code>firstName</code>, a<br>
<code>specialSkill</code>, and an <code>age</code>. Each record also keeps track of two<br>
timestamps: the time when the cat was created (<code>createdAt</code>), and the<br>
most recent time when a column of the cat has been updated<br>
(<code>updatedAt</code>).</p>
<h2 class="mume-header" id="using-sequelize-to-generate-the-model-file">Using Sequelize To Generate The Model File</h2>

<p>We will configure Sequelize to access the <code>Cats</code> table via a JavaScript<br>
class called <code>Cat</code>. To do this, we first use our trusty Sequelize CLI:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># Oops, forgot age:integer! (Don&apos;t worry we&apos;ll fix it later)</span>
npx sequelize model:generate --name Cat --attributes <span class="token string">&quot;firstName:string,specialSkill:string&quot;</span>
</pre><p>This command generates two files: a <em>model</em> file (<code>./models/cat.js</code>)<br>
and a <em>migration</em> file (<code>./migrations/20200203211508-Cat.js</code>). We will<br>
ignore the migration file for now, and focus on the model file.</p>
<p>When using Sequelize&apos;s <code>model:generate</code> command, we specify two things.<br>
First: we specify the <em>singular</em> form of the <code>Cats</code> table name (<code>Cat</code>).<br>
Second: we list the columns of the <code>Cats</code> table after the <code>--attributes</code><br>
flag: <code>firstName</code> and <code>specialSkill</code>. We tell Sequelize that these are<br>
both <code>string</code> columns (Sequelize calls SQL <code>character varying(255)</code><br>
columns <code>string</code>s).</p>
<p>We do not need to list <code>id</code>, <code>createdAt</code>, or <code>updatedAt</code>. Sequelize will<br>
always presume those exist. Notice that we have <strong>forgotten</strong> to list<br>
<code>age:integer</code> -- we will fix that soon!</p>
<h2 class="mume-header" id="examining-and-modifying-a-sequelize-model-file">Examining (And Modifying) A Sequelize Model File</h2>

<p>Let us examine the generated <code>./models/cat.js</code> file:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./models/cat.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Cat <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Cat&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    specialSkill<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Cat<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Cat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>This file exports a function that defines a <code>Cat</code> class. When you use<br>
<code>Sequelize</code> to query the <code>Cats</code> table, each row retrieved will be<br>
transformed by Sequelize into an instance of the <code>Cat</code> class. A<br>
JavaScript class like <code>Cat</code> that corresponds to a SQL table is called a<br>
<em>model</em> class.</p>
<p>The <code>./models/cat.js</code> will not be loaded by us directly. Sequelize will<br>
load this file and call the exported function to define the <code>Cat</code> class.<br>
The exported function uses Sequelize&apos;s <code>define</code> method to auto-generate<br>
a new class (called <code>Cat</code>).</p>
<blockquote>
<p>Note: You may notice we aren&apos;t using the JavaScript&apos;s <code>class</code> keyword<br>
to define the Cat class. With Sequelize, it is going to do all that for us<br>
with the <code>define</code> method. This is because Sequelize was around way before<br>
the <code>class</code> keyword was added to JavaScript. It is possible to use the class<br>
keyword with Sequelize, but it&apos;s <a href="https://codewithhugo.com/using-es6-classes-for-sequelize-4-models/">undocumented</a>.</p>
</blockquote>
<p>The first argument of <code>define</code> is the name of the class to define:<br>
<code>Cat</code>. Notice how the second argument is an <code>Object</code> of <code>Cats</code> table<br>
columns:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    specialSkill<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span>
<span class="token punctuation">}</span>
</pre><p>This object tells Sequelize about each of the columns of <code>Cats</code>. It maps<br>
each column name (<code>firstName</code>, <code>specialSkill</code>) to the type of data<br>
stored in the corresponding column of the <code>Cats</code> table. It is<br>
unnecessary to list <code>id</code>, <code>createdAt</code>, <code>updatedAt</code>, since Sequelize will<br>
already assume those exist.</p>
<p>We can correct our earlier mistake of forgetting <code>age</code>. We update the<br>
definition as so:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> Cat <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Cat&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  firstName<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  specialSkill<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>A complete list of Sequelize datatypes can be found in the<br>
<a href="https://sequelize.org/v5/manual/data-types.html">documentation</a>.</p>
<h2 class="mume-header" id="using-the-cat-model-to-fetch-and-update-sql-data">Using The <code>Cat</code> Model To Fetch And Update SQL Data</h2>

<p>We are now ready to use our <code>Cat</code> model class. When Sequelize defines<br>
the <code>Cat</code> class, it will generate instance and class methods needed to<br>
interact with the <code>Cats</code> SQL table.</p>
<p>As we mentioned before we don&apos;t require our <code>cats.js</code> file directly.<br>
Instead we require <code>./models</code> which loads the file <code>./models/index.js</code>.</p>
<p>Inside this file it reads through all our models and attaches them to an object<br>
that it exports. So we can use destructuring to get a reference to our model<br>
class <code>Cat</code> like so:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now let&apos;s update <em>our</em> <code>index.js</code> file to fetch a <code>Cat</code> from the <code>Cats</code><br>
table:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Database connection failure.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Database connection success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Sequelize is ready to use!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This code prints:</span>
<span class="token comment">//</span>
<span class="token comment">// Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;id&quot; = 1;</span>
<span class="token comment">// {</span>
<span class="token comment">//   id: 1,</span>
<span class="token comment">//   firstName: &apos;Markov&apos;,</span>
<span class="token comment">//   specialSkill: &apos;sleeping&apos;,</span>
<span class="token comment">//   age: 5,</span>
<span class="token comment">//   createdAt: 2020-02-03T21:32:28.960Z,</span>
<span class="token comment">//   updatedAt: 2020-02-03T21:32:28.960Z</span>
<span class="token comment">// }</span>
</pre><p>We use the <code>Cat.findByPk</code> static class method to fetch a single cat: the one<br>
with <code>id</code> equal to 1. This static method exists because our <code>Cat</code> model class<br>
<em>extends</em> <code>Sequelize.Model</code>.</p>
<p>&quot;Pk&quot; stands for <em>primary key</em>; the <code>id</code> field is the primary key for the<br>
<code>Cats</code> table. <code>findByPk</code> returns a <code>Promise</code>, so we must <code>await</code> the<br>
result. The result is an instance of the <code>Cat</code> model class.</p>
<p>The cleanest way to log a fetched database record is to first call the<br>
<code>toJSON</code> method. <code>toJSON</code> converts a <code>Cat</code> object to a <em>Plain Old<br>
JavaScript Object</em> (POJO). <code>Cat</code> instances have many private variables<br>
and methods that can be distracting when printed. When you call<br>
<code>toJSON</code>, only the public data fields are copied into a JavaScript<br>
<code>Object</code>. Printing this raw JavaScript <code>Object</code> is thus much cleaner.</p>
<blockquote>
<p>The author has a pet-peeve about the <code>.toJSON()</code> method of Sequelize,<br>
it does not return JSON. It instead returns a POJO. If you needed it to be<br>
JSON you would still need to call <code>JSON.stringify(cat.toJSON())</code>. Perhaps<br>
they should have called it <code>.toObject</code> or <code>.toPOJO</code> instead.</p>
</blockquote>
<p>Note that Sequelize has logged the SQL query it ran to fetch Markov&apos;s<br>
information. This logging information is often helpful when trying to<br>
figure out what Sequelize is doing.</p>
<p>You&apos;ll also notice that Sequelize puts double quotes around the table and field<br>
names.  So if you are trying to look at your &quot;Cats&quot; table from the <code>psql</code><br>
command you will need to quote them there as well. This is because PostgreSQL<br>
lowercases all identifiers like table and fields names before the query is run<br>
if they aren&apos;t quoted.</p>
<h2 class="mume-header" id="reading-and-changing-record-attributes">Reading And Changing Record Attributes</h2>

<p>While <code>toJSON</code> is useful for logging a <code>Cat</code> object, it is not the<br>
simplest way to access individual column values. To read the <code>id</code>,<br>
<code>firstName</code>, etc of a <code>Cat</code>, you can directly access those attributes on<br>
the <code>Cat</code> instance itself:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Sequelize authentication code from above...</span>

  <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cat<span class="token punctuation">.</span>firstName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> has been assigned id #</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cat<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`They are </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cat<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> years old.`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Their special skill is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cat<span class="token punctuation">.</span>specialSkill<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This code prints:</span>
<span class="token comment">//</span>
<span class="token comment">// Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;id&quot; = 1;</span>
<span class="token comment">// Markov has been assigned id #1.</span>
<span class="token comment">// They are 5 years old.</span>
<span class="token comment">// Their special skill is sleeping.</span>
</pre><p>Accessing data directly through the <code>Cat</code> object is just like reading an<br>
attribute on any other JavaScript class. You may likewise <em>change</em><br>
values in the database:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Sequelize authentication code from above...</span>

  <span class="token comment">// Fetch existing cat from database.</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Change cat&apos;s attributes.</span>
  cat<span class="token punctuation">.</span>firstName <span class="token operator">=</span> <span class="token string">&quot;Curie&quot;</span><span class="token punctuation">;</span>
  cat<span class="token punctuation">.</span>specialSkill <span class="token operator">=</span> <span class="token string">&quot;jumping&quot;</span><span class="token punctuation">;</span>
  cat<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>

  <span class="token comment">// Save the new name to the database.</span>
  <span class="token keyword">await</span> cat<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Prints:</span>
<span class="token comment">//</span>
<span class="token comment">// Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;id&quot; = 1;</span>
<span class="token comment">// Executing (default): UPDATE &quot;Cats&quot; SET &quot;firstName&quot;=$1,&quot;specialSkill&quot;=$2,&quot;age&quot;=$3,&quot;updatedAt&quot;=$4 WHERE &quot;id&quot; = $5</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Note that changing the <code>firstName</code> attribute value does not immediately<br>
change the stored value in the SQL database. Changing the <code>firstName</code><br>
without calling <code>save</code> <strong>has no effect</strong> on the database. Only when we<br>
call <code>cat.save()</code> (and <code>await</code> the promise to resolve) will the changes<br>
to <code>firstName</code>, <code>specialSkill</code>, and <code>age</code> be saved to the SQL database.<br>
All these values are updated simultaneously.</p>
<h2 class="mume-header" id="conclusion">Conclusion</h2>

<p>Having completed this reading, you should be able to:</p>
<ul>
<li>Describe what an Object Relational Mapping is and what it is used for.</li>
<li>Install the <code>sequelize</code>, <code>sequelize-cli</code>, <code>pg</code> packages.</li>
<li>Configure Sequelize via the <code>config/config.json</code> file.</li>
<li>Use Sequelize&apos;s <code>authenticate</code> method to verify that Sequelize can<br>
connect to the database.</li>
<li>Use the Sequelize CLI <code>model:generate</code> command to generate a model<br>
file.</li>
<li>Configure a model file to tell Sequelize about each database column.</li>
<li>Use the <code>findByPk</code> class method to fetch data from a SQL table.</li>
<li>Read data attributes from a model instance.</li>
<li>Modify a model instance&apos;s attributes and save the changes back to the<br>
SQL database using the <code>save</code> method.</li>
</ul>
<hr>
<h1 class="mume-header" id="using-database-migrations">Using Database Migrations</h1>

<p>We&apos;ve seen how to use an ORM like Sequelize to fetch and store data in a<br>
SQL database using JavaScript classes and methods. Sequelize also lets<br>
you write JavaScript code that creates, modifies, or drops SQL tables.<br>
The JavaScript code that does this is called a <em>migration</em>. A migration<br>
&quot;moves&quot; the database from an old schema to a new schema.</p>
<p>When you finish this reading you will be able to:</p>
<ul>
<li>Describe advantages to using migrations over raw SQL commands to<br>
create and drop tables.</li>
<li>Write migrations that create and drop tables.</li>
<li>Undo incorrect migrations, fix them, and rerun them.</li>
</ul>
<h2 class="mume-header" id="sequelize-migration-files">Sequelize Migration Files</h2>

<p>In the prior reading we assumed that a <code>Cats</code> table already existed in<br>
our <code>catsdb</code> database. In this reading, we will presume that the <code>Cats</code><br>
table does not exist, and that we have to create the table ourselves.<br>
This is the typical case when you aren&apos;t merely interacting with a<br>
preexisting database. When you develop your own application, the<br>
database will start out empty and with a blank schema.</p>
<p>We previously used the Sequelize CLI tool to autogenerate a <code>Cat</code> model<br>
file like so:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># Oops, forgot age:integer!</span>
npx sequelize model:generate --name Cat --attributes <span class="token string">&quot;firstName:string,specialSkill:string&quot;</span>
</pre><p>We noted that this creates <em>two</em> files. We&apos;ve already examined the model<br>
file <code>./models/cat.js</code>. We will now look at the auto-generated<br>
<em>migration</em> file <code>./migrations/20200203211508-create-cat.js</code>.</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./migrations/20200203211508-create-cat.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&apos;Cats&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      specialSkill<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      updatedAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">down</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&apos;Cats&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The migration file exports two functions: <code>up</code> and <code>down</code>. The <code>up</code><br>
function tells Sequelize how to create a <code>Cats</code> table. The <code>down</code><br>
function tells Sequelize how to &quot;undo&quot; the <code>up</code> function. The <code>down</code><br>
function drops the <code>Cats</code> table.</p>
<p>We will examine these functions more closely, but let&apos;s first see how to<br>
use a migration.</p>
<blockquote>
<p>Note: The timestamp <code>20200203211508</code> preceding <code>-create-cat.js</code><br>
represents February 2, 2020. It gives the time and day that the<br>
migration was generated. (Your date should be when you generated your migration)<br>
By using the date and time as part of the filename, all migration files will<br>
have unique names. Also, alphabetical sorting will order the files from oldest<br>
to most recent migration.</p>
</blockquote>
<h2 class="mume-header" id="running-a-migration">Running A Migration</h2>

<p>To create the <code>Cats</code> table, we must run our migration code. Having<br>
generated the <code>20200203211508-create-cat.js</code> migration file, we will use<br>
the Sequelize CLI tool to run the migration. We may do this like so:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># Run the migration&apos;s `up` method.</span>
npx sequelize db:migrate
</pre><p>By giving Sequelize the <code>db:migrate</code> subcommand, it will know that we<br>
are asking it to run any new migrations. To run a migration, Sequelize<br>
will call the <code>up</code> method defined in the migration file. The <code>up</code> method<br>
will run the necessary <code>CREATE TABLE ...</code> SQL command for us. Sequelize<br>
will record (in a special <code>catsdb</code> table called <code>SequelizeMeta</code>) that<br>
the migration has been run. The next time we call <code>npx sequelize db:migrate</code>, Sequelize will not try to &quot;redo&quot; this already performed<br>
migration. It will do nothing the second time.</p>
<p>Having run the migration, we can verify that the <code>Cats</code> table looks like<br>
it should (with the exception of the <code>age</code> column):</p>
<p>Note that we we are using the table name in quotes here in <code>psql</code>.</p>
<pre data-role="codeBlock" data-info class="language-"><code>catsdb=&gt; \d &quot;Cats&quot;;
                                         Table &quot;public.Cats&quot;
    Column    |           Type           | Collation | Nullable
--------------+--------------------------+-----------+----------
 id           | integer                  |           | not null
 firstName    | character varying(255)   |           |
 specialSkill | character varying(255)   |           |
 createdAt    | timestamp with time zone |           | not null
 updatedAt    | timestamp with time zone |           | not null
Indexes:
    &quot;Cats_pkey&quot; PRIMARY KEY, btree (id)
</code></pre><h2 class="mume-header" id="rolling-back-a-migration">Rolling Back A Migration</h2>

<p>We made a mistake when generating our <code>Cat</code> migration. We forgot to<br>
include the <code>age</code> column.</p>
<p>One way to fix this is to generate a <em>second</em> migration that adds the<br>
forgotten <code>age</code> column. If we have already pushed our migration code to<br>
a remote git server, we should opt for this option.</p>
<p>If the migration has not yet been pushed, we can fix the migration<br>
directly. We will &quot;undo&quot; (AKA <em>rollback</em>) the migration that created the<br>
<code>Cats</code> table (dropping the table), fix the <code>up</code> method so that the <code>age</code><br>
column is included, and finally rerun the migration.</p>
<blockquote>
<p>Note: this is not the same as the SQL command ROLLBACK.</p>
</blockquote>
<p>To undo the migration, we run:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">npx sequelize db:migrate:undo
</pre><p>Sequelize will call the <code>down</code> method for us, and the <code>Cats</code> table is<br>
dropped.</p>
<p>Why should you not use the <code>db:migrate:undo</code> way when the migration file<br>
has already been pushed to a remote git server? The reason is this: you<br>
can easily tell other developers to fix a broken migration by writing a<br>
second fixup migration (for instance, that adds the <code>age</code> column). All<br>
you need to do is check this new migration file into source control and<br>
push it. When another developer pulls your new migration code, the next<br>
time they run <code>npx sequelize db:migrate</code>, your fixup migration will be<br>
run on their local machine.</p>
<p>When rolling back already-checked-in migrations, there is no way to<br>
easily communicate to other developers that they should (1) rollback<br>
your migration and (2) rerun the newly corrected version of this<br>
migration. To avoid this communication problem, you should only rollback<br>
commits if you haven&apos;t already pushed them to a remote git server.</p>
<h2 class="mume-header" id="editing-a-migration-file">Editing A Migration File</h2>

<p>Let&apos;s examine the <code>up</code> and <code>down</code> methods more closely. Let&apos;s start with<br>
the <code>up</code> method:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&apos;Cats&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      specialSkill<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      updatedAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The <code>up</code> method will be passed a QueryInterface<br>
(<a href="https://sequelize.org/master/class/lib/query-interface.js~QueryInterface.html">documentation</a>) object. This object provides a<br>
number of commands for modifying the SQL database schema. The<br>
<code>createTable</code> method is amongst the most important.</p>
<p>We pass the table name (<code>&apos;Cats&apos;</code>) along with an object mapping column<br>
names to column attributes. Every column must have a specified <code>type</code>.<br>
This is similar to what we saw when we generated a model file. Note that<br>
we <strong>do not</strong> take <code>id</code>, <code>createdAt</code>, or <code>updatedAt</code> for granted. We<br>
need to include those columns. Luckily, everything has been<br>
auto-generated for us!</p>
<p>We will talk about <code>allowNull</code> and <code>primaryKey</code> in a later reading.<br>
These attributes ask Sequelize to add database constraints to a column.<br>
Likewise we will ignore <code>autoIncrement</code> for the moment (this allows a<br>
unique <code>id</code> to be auto-generated by the database for each saved row in<br>
the <code>Cats</code> table).</p>
<p>We fix the <code>up</code> method like so:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&apos;Cats&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      specialSkill<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// Here we add the `age` column.</span>
      age<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Adding the <code>age</code> column to the migration is a lot like how we added<br>
<code>age</code> to our model file.</p>
<p>Having fixed our migration, we may now &quot;rerun&quot; it the same way we ran it<br>
the first time:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">npx sequelize db:migrate
</pre><p>We may now behold the fixed table:</p>
<pre data-role="codeBlock" data-info class="language-"><code>catsdb=&gt; \d &quot;Cats&quot;
                                         Table &quot;public.Cats&quot;
    Column    |           Type           | Collation | Nullable
--------------+--------------------------+-----------+----------
 id           | integer                  |           | not null
 firstName    | character varying(255)   |           |
 specialSkill | character varying(255)   |           |
 age          | integer                  |           |
 createdAt    | timestamp with time zone |           | not null
 updatedAt    | timestamp with time zone |           | not null
Indexes:
    &quot;Cats_pkey&quot; PRIMARY KEY, btree (id)
</code></pre><h2 class="mume-header" id="up-and-down-are-asynchronous"><code>up</code> And <code>down</code> are Asynchronous</h2>

<p>A final note about <code>up</code> (and also <code>down</code>). Sequelize expects <code>up</code> to be<br>
<em>asynchronous</em>. That is, Sequelize expects <code>up</code> to return a <code>Promise</code><br>
object. Sequelize will wait for the <code>Promise</code> to be resolved. When the<br>
<code>Promise</code> is resolved, Sequelize will know the work of the <code>up</code> method<br>
is complete.</p>
<p>The <code>createTable</code> method is also asynchronous (returns a <code>Promise</code>). The<br>
promise resolves when <code>createTable</code> is done creating the table. This is<br>
why <code>up</code> is written as:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// up returns Promise returned by `createTable`.</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&apos;Cats&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Sequelize is able to autogenerate a migration to create a <code>Cats</code> table,<br>
but many other migrations (for instance, to add an <code>age</code> column to our<br>
<code>Cats</code> table) must be written by hand. When writing your own migrations,<br>
you may prefer using <code>async</code>/<code>await</code>, which is clearer:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// Note the addition of the `async` keyword</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// await `createTable` to finish its work.</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&apos;Cats&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// No need to return anything. An `async` method always returns a</span>
    <span class="token comment">// Promise that waits for all `await`ed work to be performed.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="writing-a-down-method">Writing A <code>down</code> Method</h2>

<p>A <code>down</code> method is written just like an <code>up</code> method. In the <code>down</code><br>
method we &quot;undo&quot; what has been performed by the <code>up</code> method. We call<br>
<code>QueryInterface</code>&apos;s <code>dropTable</code> method to drop the <code>Cats</code> table we<br>
created in <code>up</code>:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function-variable function">down</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&apos;Cats&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// OR, async/await way:</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function-variable function">down</span><span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&apos;Cats&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p><strong>Imagine we had forgotten to drop the <code>Cats</code> table in the <code>down</code><br>
method.</strong> That is: imagine the <code>down</code> method was somehow left empty. If<br>
we rollback the migration nothing will be done by the empty <code>down</code><br>
method. Thus the incorrect <code>Cats</code> table we created will not have been<br>
dropped. The wrong <code>Cats</code> table would still exist.</p>
<p>Imagine we next fix the migration&apos;s <code>up</code> method. We want to rerun the<br>
migration now and create the corrected <code>Cats</code> table. But when try to do<br>
this, Sequelize will hit an error! Rerunning the migration will try to<br>
<code>CREATE TABLE &quot;Cats&quot;</code> again, but SQL will complain because a <code>Cats</code><br>
table already exists. It was created the first time we ran the<br>
migration, but never dropped when we tried to rollback the migration!</p>
<p>Inevitably all programmers will sometimes make mistakes like this. In<br>
these circumstances, you will probably have to open <code>psql</code> and write a<br>
SQL <code>DROP TABLE</code> command to fix things. Having manually corrected<br>
things, you can finally rerun the corrected migration.</p>
<p>You should <strong>never</strong> manually drop a table on a production database.<br>
That is incredibly dangerous, and typically cannot be undone. Even if<br>
database backups do not exist, recently inserted data will be lost<br>
forever. This is yet another reason why you ought not rollback<br>
migrations that have been pushed from your local development<br>
environment!</p>
<h2 class="mume-header" id="advantages-of-migrations">Advantages Of Migrations</h2>

<p>Having seen how to <em>use</em> Sequelize migrations, we can discuss their<br>
benefits versus writing SQL commands like <code>CREATE TABLE ...</code> yourself.</p>
<p>The first advantage is that Sequelize migration code is written in<br>
JavaScript, which you may find simpler to write/read than the<br>
corresponding SQL code. Most programmers write more JavaScript than SQL,<br>
so they are typically better at remembering how to do things in<br>
JavaScript than in SQL.</p>
<p>A second advantage is that migration files store SQL schema change code<br>
permanently. The migration files can be checked into git, so that you<br>
don&apos;t ever forget how your database was configured.</p>
<p>A third (related) advantage comes when another developer wants to<br>
collaborate on your JavaScript program. By cloning your git repository,<br>
they get all the migration files, too. To setup their own copy of your<br>
database, a collaborator can run the migration files on their own<br>
computer, playing back the schema changes one-by-one. Because they apply<br>
the same migrations as you, they end up with the same schema as you.</p>
<p>Last, by using migrations you are able to rollback database changes to<br>
fix bugs. This can be helpful in a local development environment where<br>
it is typical to make mistakes. Remember though: you should <strong>never</strong><br>
rollback migrations that have been run on a production server.</p>
<h2 class="mume-header" id="conclusion-1">Conclusion</h2>

<p>Having completed this reading, you now are able to:</p>
<ul>
<li>Describe advantages to using migrations over raw SQL commands to<br>
create, modify, and drop tables.</li>
<li>Generate (and modify as needed)) migrations that create and drop<br>
tables.</li>
<li>Run migrations to change the database schema.</li>
<li>Undo incorrect migrations, fix them, and rerun them.</li>
</ul>
<hr>
<h1 class="mume-header" id="crud-operations-using-sequelize">CRUD Operations Using Sequelize</h1>

<p>There are four general ways to interact with a database. To illustrate<br>
these, recall our <code>Cats</code> table. We can:</p>
<ol>
<li>Save a new cat to the database by <em>creating</em> a new row in the<br>
<code>Cats</code> table,</li>
<li>We can <em>read</em> previously stored cat data by fetching a row (or<br>
multiple rows) out of the <code>Cats</code> table,</li>
<li>We can <em>update</em> some of the column values for a pre-existing cat by<br>
modifying a row in the <code>Cats</code> table,</li>
<li>We can delete (<em>destroy</em>) the data for a cat by removing a row in<br>
the <code>Cats</code> table.</li>
</ol>
<p>These four actions are sometimes abbreviated as <em>CRUD</em>. After this<br>
reading, you will be able to:</p>
<ul>
<li>Use Sequelize to create new records in a table,</li>
<li>Use Sequelize to read/fetch existing records by primary key,</li>
<li>Use Sequelize to update existing records with new attribute values,</li>
<li>Use Sequelize to delete records from a table.</li>
</ul>
<h2 class="mume-header" id="creating-a-new-record">Creating A New Record</h2>

<p>To save a new cat&apos;s data as a row in the <code>Cats</code> table, we do a two step<br>
process:</p>
<ol>
<li>We call the static <code>build</code> method on the <code>Cat</code> class with the desired values.</li>
<li>We call the <code>save</code> method on the <code>cat</code> instance.</li>
</ol>
<p>Let&apos;s see an example:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Constructs an instance of the JavaScript `Cat` class. **Does not</span>
  <span class="token comment">// save anything to the database yet**. Attributes are passed in as a</span>
  <span class="token comment">// POJO.</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">&quot;Markov&quot;</span><span class="token punctuation">,</span>
    specialSkill<span class="token punctuation">:</span> <span class="token string">&quot;sleeping&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// This actually creates a new `Cats` record in the database. We must</span>
  <span class="token comment">// wait for this asynchronous operation to succeed.</span>
  <span class="token keyword">await</span> cat<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Running the code:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): INSERT INTO &quot;Cats&quot; (&quot;id&quot;,&quot;firstName&quot;,&quot;specialSkill&quot;,&quot;age&quot;,&quot;createdAt&quot;,&quot;updatedAt&quot;) VALUES (DEFAULT,$1,$2,$3,$4,$5) RETURNING *;
{
  id: 1,
  firstName: &apos;Markov&apos;,
  specialSkill: &apos;sleeping&apos;,
  age: 5,
  updatedAt: 2020-02-11T19:04:23.116Z,
  createdAt: 2020-02-11T19:04:23.116Z
}
</code></pre><p>A new row has been inserted into the <code>Cats</code> table. We see that <code>id</code>,<br>
<code>updatedAt</code>, and <code>createdAt</code> were each autogenerated for us.</p>
<h2 class="mume-header" id="reading-a-record-by-primary-key">Reading A Record By Primary Key</h2>

<p>Let&apos;s read an existing record from the database:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fetch the cat with id #1.</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Running this code prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;id&quot; = 1;
{
  id: 1,
  firstName: &apos;Markov&apos;,
  specialSkill: &apos;sleeping&apos;,
  age: 5,
  createdAt: 2020-02-11T19:04:23.116Z,
  updatedAt: 2020-02-11T19:04:23.116Z
}
</code></pre><p>Fetching a record by primary key is the most common form of read<br>
operation from a database. In another reading we will learn other ways<br>
to fetch data. For instance: we will learn how to fetch all cats named<br>
&quot;Markov&quot; (there may be many).</p>
<h2 class="mume-header" id="updating-a-record">Updating A Record</h2>

<p>Let&apos;s tweak our reading code to change (<em>update</em>) an attribute of Markov:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Old Markov: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// The Cat object is modified, but the corresponding record in the</span>
  <span class="token comment">// database is *not* yet changed at all.</span>
  cat<span class="token punctuation">.</span>specialSkill <span class="token operator">=</span> <span class="token string">&quot;super deep sleeping&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// Only by calling `save` will the data be saved.</span>
  <span class="token keyword">await</span> cat<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;New Markov: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Running this code prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;id&quot; = 1;
Old Markov:
{
  id: 1,
  firstName: &apos;Markov&apos;,
  specialSkill: &apos;sleeping&apos;,
  age: 5,
  createdAt: 2020-02-11T19:04:23.116Z,
  updatedAt: 2020-02-11T19:04:23.116Z
}
Executing (default): UPDATE &quot;Cats&quot; SET &quot;specialSkill&quot;=$1,&quot;updatedAt&quot;=$2 WHERE &quot;id&quot; = $3
New Markov:
{
  id: 1,
  firstName: &apos;Markov&apos;,
  specialSkill: &apos;super deep sleeping&apos;,
  age: 5,
  createdAt: 2020-02-11T19:04:23.116Z,
  updatedAt: 2020-02-11T19:15:08.668Z
}
</code></pre><p><strong>Important note</strong>: changing an attribute of a <code>Cat</code> object does not<br>
immediately change any data in the <code>Cats</code> table. To change data in the<br>
<code>Cats</code> table, you must also call <code>save</code>. If you forget to call <code>save</code>,<br>
no data will be changed. <code>save</code> is asynchronous, so you must also<br>
<code>await</code> for it to complete.</p>
<p>If you look carefully, you can see that the <code>updatedAt</code> attribute was<br>
changed for us when we updated Markov!</p>
<h2 class="mume-header" id="destroying-a-record">Destroying A Record</h2>

<p>We can also destroy records and remove them from the database:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Remove the Markov record.</span>
  <span class="token keyword">await</span> cat<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This code prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;id&quot; = 1;
Executing (default): DELETE FROM &quot;Cats&quot; WHERE &quot;id&quot; = 1
</code></pre><h2 class="mume-header" id="class-methods-for-crud">Class Methods For CRUD</h2>

<p>When creating a record, you can avoid the two step process of (1)<br>
creating a <code>Cat</code> instance and (2) calling the <code>save</code> instance method.<br>
You can do a one step process of calling the <code>create</code> <strong>class method</strong>:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">&quot;Curie&quot;</span><span class="token punctuation">,</span>
    specialSkill<span class="token punctuation">:</span> <span class="token string">&quot;jumping&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>create</code> class method does both steps in one. It is just a<br>
convenience. Similar to before, this code prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): INSERT INTO &quot;Cats&quot; (&quot;id&quot;,&quot;firstName&quot;,&quot;specialSkill&quot;,&quot;age&quot;,&quot;createdAt&quot;,&quot;updatedAt&quot;) VALUES (DEFAULT,$1,$2,$3,$4,$5) RETURNING *;
{
  id: 3,
  firstName: &apos;Curie&apos;,
  specialSkill: &apos;jumping&apos;,
  age: 4,
  updatedAt: 2020-02-11T19:36:03.858Z,
  createdAt: 2020-02-11T19:36:03.858Z
}
</code></pre><p>When destroying, we also did a two step process: (1) fetch the record,<br>
(2) call the <code>destroy</code> instance method. Instead, we could just call the<br>
<code>destroy</code> <strong>class method</strong> directly:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Destroy the Cat record with id #3.</span>
  <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): DELETE FROM &quot;Cats&quot; WHERE &quot;id&quot; = 3
</code></pre><p>An advantage to the class method form of destroying is that we avoid an<br>
unnecessary fetch of <code>Cat.findByPk(3)</code>. Database queries can<br>
sometimes be slow, though typically a few extra queries won&apos;t make a big<br>
difference. Choosing between the instance and class methods of<br>
destroying usually comes down to which you consider easier to<br>
read/understand.</p>
<h2 class="mume-header" id="conclusion-2">Conclusion</h2>

<p>As ever, the best resource for learning about Sequelize model methods is<br>
the <a href="https://sequelize.org/master/class/lib/model.js~Model.html">documentation</a>. The documentation<br>
explains the <code>create</code>, <code>destroy</code>, <code>findByPk</code>, and <code>save</code> methods<br>
in depth.</p>
<p>Having completed this reading, you now know how to:</p>
<ul>
<li>Use Sequelize to create new records in a table (using both instance<br>
and class methods),</li>
<li>Use Sequelize to read/fetch existing records by primary key,</li>
<li>Use Sequelize to update existing records with new attribute values,</li>
<li>Use Sequelize to delete records from a table (using both instance and<br>
class methods).</li>
</ul>
<hr>
<h1 class="mume-header" id="querying-using-sequelize">Querying Using Sequelize</h1>

<p>We have already seen how to find a single record by primary key:<br>
<code>findByPk</code>. In this reading we will learn about more advanced ways to<br>
query a table. We will learn how to:</p>
<ul>
<li>Fetch all <code>Cats</code> whose name is <code>&quot;Markov&quot;</code>,</li>
<li>Fetch all <code>Cats</code> whose name is <code>&quot;Markov&quot;</code> <strong>OR</strong> <code>&quot;Curie&quot;</code>,</li>
<li>Fetch all <code>Cats</code> whose age is <strong>not</strong> 5,</li>
<li>Fetch all <code>Cats</code> whose name is <code>&quot;Markov&quot;</code> <strong>AND</strong> whose age is 5,</li>
<li>Fetch all <code>Cats</code> whose age is <strong>less than</strong> 5,</li>
</ul>
<p>We will also learn how to:</p>
<ul>
<li>Order <code>Cats</code> results by age (descending or ascending),</li>
<li>Limit <code>Cats</code> results to a finite number.</li>
</ul>
<h2 class="mume-header" id="basic-usage-of-findall-to-retrieve-multiple-records">Basic Usage Of <code>findAll</code> To Retrieve Multiple Records</h2>

<p>Let&apos;s consider a simple example where we want to retrieve all the <code>Cats</code><br>
in the database:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// `findAll` asks to retrieve _ALL_ THE CATS!!  An array of `Cat`</span>
  <span class="token comment">// objects will be returned.</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Log the fetched cats.</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Since this is an array we can&apos;t use that <code>.toJSON()</code> method we learned earlier,<br>
so we can instead use <code>JSON.stringify</code> on the Array.</p>
<p>Pro tip: giving a 3rd argument to <code>JSON.stringify</code> will pretty-print the<br>
result with the specified spacing. (We pass <code>null</code> as the 2nd argument<br>
to skip it.) You can read more at the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify"><code>JSON.stringify</code><br>
docs</a>.</p>
<p>Running this code prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot;;
[
  {
    &quot;id&quot;: 4,
    &quot;firstName&quot;: &quot;Markov&quot;,
    &quot;specialSkill&quot;: &quot;sleeping&quot;,
    &quot;age&quot;: 5,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;
  },
  {
    &quot;id&quot;: 5,
    &quot;firstName&quot;: &quot;Curie&quot;,
    &quot;specialSkill&quot;: &quot;jumping&quot;,
    &quot;age&quot;: 4,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;
  }
]
</code></pre><p>It isn&apos;t typical to want to fetch <em>every</em> record. We typically want to<br>
get only those records that match some criterion. In SQL, we use a<br>
<code>WHERE</code> clause to do this. With Sequelize, we issue a <code>WHERE</code> query like<br>
so:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fetch all cats named Markov.</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      firstName<span class="token punctuation">:</span> <span class="token string">&quot;Markov&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Which prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;firstName&quot; = &apos;Markov&apos;;
[
  {
    &quot;id&quot;: 4,
    &quot;firstName&quot;: &quot;Markov&quot;,
    &quot;specialSkill&quot;: &quot;sleeping&quot;,
    &quot;age&quot;: 5,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;
  }
]
</code></pre><p>We&apos;ve passed the <code>findAll</code> class method the <code>where</code> option. The <code>where</code><br>
option tells Sequelize to use a <code>WHERE</code> clause. The option value passed<br>
is <code>{ firstName: &quot;Markov&quot; }</code>. This tells Sequelize to only return those<br>
<code>Cats</code> where <code>firstName</code> is equal to <code>&quot;Markov&quot;</code>.</p>
<p>If we wanted to select those <code>Cats</code> named Markov <strong>OR</strong> Curie, we can<br>
map <code>firstName</code> to an array of <code>[&quot;Markov&quot;, &quot;Curie&quot;]</code>. For example:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fetch all cats named either Markov or Curie.</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      firstName<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Markov&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Curie&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;firstName&quot; IN (&apos;Markov&apos;, &apos;Curie&apos;);
[
  {
    &quot;id&quot;: 4,
    &quot;firstName&quot;: &quot;Markov&quot;,
    &quot;specialSkill&quot;: &quot;sleeping&quot;,
    &quot;age&quot;: 5,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;
  },
  {
    &quot;id&quot;: 5,
    &quot;firstName&quot;: &quot;Curie&quot;,
    &quot;specialSkill&quot;: &quot;jumping&quot;,
    &quot;age&quot;: 4,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;
  }
]
</code></pre><p>The difference is that we&apos;ve passed <code>{ firstName: [&quot;Markov&quot;, &quot;Curie&quot; ]}</code>. Sequelize will return all <code>Cats</code> whose <code>firstName</code> matches either<br>
<code>&quot;Markov&quot;</code> or <code>&quot;Curie&quot;</code>.</p>
<h2 class="mume-header" id="using-findall-to-find-objects-not-matching-a-criterion">Using <code>findAll</code> To Find Objects Not Matching A Criterion</h2>

<p>We can also find all the <code>Cats</code> whose names are <strong>NOT</strong> Markov, but we will<br>
need to require in the <code>Op</code> object from Sequelize so we can use the &quot;not equal&quot; operator from it:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Op <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./db/models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// Op.ne means the &quot;not equal&quot; operator.</span>
        <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>ne<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;Markov&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;firstName&quot; != &apos;Markov&apos;;
[
  {
    &quot;id&quot;: 5,
    &quot;firstName&quot;: &quot;Curie&quot;,
    &quot;specialSkill&quot;: &quot;jumping&quot;,
    &quot;age&quot;: 4,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;
  }
]
</code></pre><p>This is our first example of a Sequelize<br>
<a href="https://sequelize.org/v5/manual/querying.html#operators"><em>operator</em></a>: <code>Op.ne</code>. <code>ne</code> stands for &quot;not<br>
equal.&quot; Instead of mapping <code>firstName</code> to a single value like <code>&quot;Markov&quot;</code><br>
or an array of values like <code>[&quot;Markov&quot;, &quot;Curie&quot;]</code>, we have mapped it to:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token punctuation">{</span> <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>ne<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;Markov&quot;</span> <span class="token punctuation">}</span>
</pre><p>How does this work? <code>Op.ne</code> is a JavaScript <em>symbol</em>: <code>Op.ne === Symbol.for(&apos;ne&apos;)</code>. To simplify, let&apos;s just imagine that <code>Op.ne === &quot;ne&quot;</code>.</p>
<p>When we write <code>{ [Op.ne]: &quot;Markov&quot; }</code>, the <code>[]</code> brackets perform key<br>
interpolation. So this is equal to <code>{ &quot;ne&quot;: &quot;Markov&quot; }</code>. So overall, we<br>
are effectively writing:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">db<span class="token punctuation">.</span>Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Won&apos;t exactly work (you need to use `[Op.ne]` after all). Does</span>
    <span class="token comment">// illustrate the concept though.</span>
    firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;ne&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Markov&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</pre><p>This perhaps makes it clearer how Sequelize understands what we want.<br>
Sequelize is being passed an <em>object</em> as the <code>firstName</code> value. The<br>
object is specifying that we want to do a <code>!=</code> SQL operation by using<br>
the <code>&quot;ne&quot;</code> (&quot;not equal&quot;) key. The value to &quot;not equal&quot; is specified as<br>
<code>&quot;Markov&quot;</code>.</p>
<h2 class="mume-header" id="combining-criteria-with-opand">Combining Criteria with <code>Op.and</code></h2>

<p>We&apos;ve seen one way to do an <code>OR</code> operation above (by mapping a column<br>
name to an array of values). Let&apos;s see how to do an <code>AND</code> operation:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Op <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// fetch cats with name != Markov AND age = 4.</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>ne<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;Markov&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      age<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;firstName&quot; != &apos;Markov&apos; AND &quot;Cat&quot;.&quot;age&quot; = 4;
[
  {
    &quot;id&quot;: 5,
    &quot;firstName&quot;: &quot;Curie&quot;,
    &quot;specialSkill&quot;: &quot;jumping&quot;,
    &quot;age&quot;: 4,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;
  }
]
</code></pre><p>Simply by listing more key/value pairs in the <code>where</code> object, we ask<br>
Sequelize to &quot;AND&quot; together multiple criteria.</p>
<p>Another way to do the same thing is like so:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Op <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>and<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>ne<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;Markov&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The use of the <code>Op.and</code> operator is somewhat similar to <code>Op.ne</code>. This<br>
time we map <code>Op.and</code> to an <em>array</em> of criteria. Returned records must<br>
match all the criteria.</p>
<h2 class="mume-header" id="combining-criteria-with-opor">Combining Criteria with <code>Op.or</code></h2>

<p>We&apos;ve already seen how to do an <code>OR</code> to match a <em>single column</em> against<br>
<em>multiple values</em>. You can use <code>Op.or</code> for even greater flexibility:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Op <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// fetch cats with name == Markov OR age = 4.</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>or<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> firstName<span class="token punctuation">:</span> <span class="token string">&quot;Markov&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE (&quot;Cat&quot;.&quot;firstName&quot; = &apos;Markov&apos; OR &quot;Cat&quot;.&quot;age&quot; = 4);
[
  {
    &quot;id&quot;: 4,
    &quot;firstName&quot;: &quot;Markov&quot;,
    &quot;specialSkill&quot;: &quot;sleeping&quot;,
    &quot;age&quot;: 5,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;
  },
  {
    &quot;id&quot;: 5,
    &quot;firstName&quot;: &quot;Curie&quot;,
    &quot;specialSkill&quot;: &quot;jumping&quot;,
    &quot;age&quot;: 4,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;
  }
]
</code></pre><p>Our query is to find all cats whose names are &quot;Markov&quot; and whose age is<br>
4. Therefore both cats are returned: Markov and Curie (whose age is 4).</p>
<h2 class="mume-header" id="querying-with-comparisons">Querying With Comparisons</h2>

<p>We can use operators like <code>Op.gt</code> (greater than) and <code>Op.lt</code> (less than)<br>
to select by comparing values. We use these just like <code>Op.ne</code>:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Op <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fetch all cats whose age is &gt; 4.</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      age<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>gt<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;age&quot; &gt; 4;
[
  {
    &quot;id&quot;: 4,
    &quot;firstName&quot;: &quot;Markov&quot;,
    &quot;specialSkill&quot;: &quot;sleeping&quot;,
    &quot;age&quot;: 5,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;
  }
]
</code></pre><h2 class="mume-header" id="ordering-results">Ordering Results</h2>

<p>We&apos;ve seen how to use a <code>where</code> query option to filter results with a<br>
SQL <code>WHERE</code> clause. We can use the <code>order</code> query option to perform a SQL<br>
<code>ORDER BY</code>:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DESC&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; ORDER BY &quot;Cat&quot;.&quot;age&quot; DESC;
[
  {
    &quot;id&quot;: 4,
    &quot;firstName&quot;: &quot;Markov&quot;,
    &quot;specialSkill&quot;: &quot;sleeping&quot;,
    &quot;age&quot;: 5,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;
  },
  {
    &quot;id&quot;: 5,
    &quot;firstName&quot;: &quot;Curie&quot;,
    &quot;specialSkill&quot;: &quot;jumping&quot;,
    &quot;age&quot;: 4,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.398Z&quot;
  }
]
</code></pre><p>We&apos;ve specified <code>{ order: [[&quot;age&quot;, &quot;DESC&quot;]] }</code>. Notice how we specify<br>
the sort order with a doubly-nested array. If we wanted to sort<br>
ascending we could more simply write: <code>{ order: [&quot;age&quot;] }</code>.</p>
<p>What if we wanted to sort by <em>two</em> columns? For instance, say we wanted<br>
to <code>SORT BY age DESC, firstName</code>. We would write: <code>{ order: [[&quot;age&quot;, &quot;DESC&quot;], &quot;firstName&quot;] }</code>. That would sort descending by <code>age</code>, and then<br>
ascending by <code>firstName</code> for cats with the same age.</p>
<h2 class="mume-header" id="limiting-results-and-findone">Limiting Results and <code>findOne</code></h2>

<p>If we want only the oldest cat we can use the <code>limit</code> query option:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DESC&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    limit<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cats<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This selects only one (the oldest) cat:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; ORDER BY &quot;Cat&quot;.&quot;age&quot; DESC LIMIT 1;
[
  {
    &quot;id&quot;: 4,
    &quot;firstName&quot;: &quot;Markov&quot;,
    &quot;specialSkill&quot;: &quot;sleeping&quot;,
    &quot;age&quot;: 5,
    &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;,
    &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;
  }
]
</code></pre><p>Since we know that there will be only one result, it is pointless to<br>
return an array. In cases when we want a maximum of one result, we can<br>
use <code>findOne</code>:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DESC&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cat<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Which prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>&gt;&gt; node index.js
Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; ORDER BY &quot;Cat&quot;.&quot;age&quot; DESC LIMIT 1;
{
  &quot;id&quot;: 4,
  &quot;firstName&quot;: &quot;Markov&quot;,
  &quot;specialSkill&quot;: &quot;sleeping&quot;,
  &quot;age&quot;: 5,
  &quot;createdAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;,
  &quot;updatedAt&quot;: &quot;2020-02-11T23:03:25.388Z&quot;
}
</code></pre><p>This returned the <code>Cat</code> object directly, not wrapped in an array.</p>
<p>If there is no record matching the criteria passed to <code>findOne</code>, it will<br>
return <code>null</code> (rather than an empty array):</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Try to find a non-existant cat.</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">await</span> Cat<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      firstName<span class="token punctuation">:</span> <span class="token string">&quot;Franklin Delano Catsevelt&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cat<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>No such cat exists:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;firstName&quot;, &quot;specialSkill&quot;, &quot;age&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;Cats&quot; AS &quot;Cat&quot; WHERE &quot;Cat&quot;.&quot;firstName&quot; = &apos;Franklin Delano Catsevelt&apos; LIMIT 1;
null
</code></pre><h2 class="mume-header" id="conclusion-3">Conclusion</h2>

<p>We&apos;ve scratched the surface of the many query options supported by<br>
Sequelize. You may find more information as necessary by reading the<br>
<a href="https://sequelize.org/v5/manual/querying.html">Sequelize querying documentation</a>. You can in<br>
particular review the <a href="https://sequelize.org/v5/manual/querying.html#operators">list of Sequelize query<br>
operators</a>.</p>
<p>Now that you&apos;ve completed this reading you should know how to:</p>
<ul>
<li>Use the <code>where</code> query option,</li>
<li>Use the <code>Op.and</code> operator to match <strong>all</strong> of multiple criteria,</li>
<li>Use the <code>Op.or</code> operator to match <strong>any</strong> of multiple criteria,</li>
<li>Use the <code>Op.ne</code> to match rows where the value <strong>does not equal</strong> the<br>
specified value,</li>
<li>Use the <code>Op.gt</code>, <code>Op.lt</code> operators to <strong>compare</strong> values,</li>
<li>Use the <code>order</code> query option to <strong>order</strong> results,</li>
<li>Use the <code>limit</code> query option to <strong>limit</strong> the number of returned<br>
results,</li>
<li>Use <code>findOne</code> when only one result is expected or desired.</li>
</ul>
<hr>
<h1 class="mume-header" id="model-validations-with-sequelize">Model Validations With Sequelize</h1>

<p>It&apos;s important to make sure that data stored to a database is not<br>
erroneous or incomplete. Imagine the following forms of &quot;garbage data:&quot;</p>
<ul>
<li>A <code>Cats</code> record with <code>firstName</code> set to <code>NULL</code>. All <code>Cats</code> ought to<br>
have a name.</li>
<li>A <code>Cats</code> record with <code>firstName</code> set to the empty string: <code>&quot;&quot;</code>.</li>
<li>A <code>Cats</code> record with an <code>age</code> less than <code>0</code>. <code>age</code> must always be<br>
non-negative.</li>
<li>Perhaps the <code>specialSkill</code> should come from a pre-defined limited list<br>
of <code>[&quot;jumping&quot;, &quot;sleeping&quot;, &quot;purring&quot;]</code>. A <code>Cats</code> record with a<br>
<code>specialSkill</code> of <code>&quot;pearl diving&quot;</code> would thus be invalid.</li>
</ul>
<p>Sequelize lets us write JavaScript code that will check that these data<br>
requirements are satisfied before saving a record to the database. The<br>
JavaScript code that does this is called a <em>validation</em>. A validation is<br>
code that makes sure that data is valid.</p>
<p>In this reading you will learn how to:</p>
<ol>
<li>Validate that an attribute is not set to <code>NULL</code>.</li>
<li>Validate that a string attribute is not set to the empty string <code>&quot;&quot;</code>.</li>
<li>Validate that a string attribute is not too long (has too many<br>
characters).</li>
<li>Validate that a numeric attribute meets minimum or maximum<br>
thresholds.</li>
<li>Validate that an attribute is within a limited set of options.</li>
</ol>
<h2 class="mume-header" id="validating-that-an-attribute-is-not-null">Validating That An Attribute Is Not <code>NULL</code></h2>

<p>We should not allow a <code>Cat</code> to be saved to the database if it lacks</p>
<ol>
<li>a <code>firstName</code>,</li>
<li>an <code>age</code>, or</li>
<li>a <code>specialSkill</code>.</li>
</ol>
<p>None of these should be set to <code>NULL</code>.</p>
<p>Before adding validations to check these requirements, let&apos;s review what<br>
our <code>Cat</code> model code currently looks like:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./models/cat.js</span>
<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Cat <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Cat&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    specialSkill<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Cat<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Cat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>We will modify our model definition to give more specific instructions<br>
to Sequelize about the <code>firstName</code>, <code>specialSkill</code>, and <code>age</code><br>
attributes:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./models/cat.js</span>
<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Cat <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Cat&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;firstName must not be null&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    specialSkill<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;specialSkill must not be null&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;age must not be null&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Cat<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Cat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>What has changed? We now map each attribute name (<code>firstName</code>,<br>
<code>specialSkill</code>, <code>age</code>) to a POJO that tells Sequelize how to configure<br>
that attribute. Here is the POJO for <code>firstName</code>:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      msg<span class="token punctuation">:</span> <span class="token string">&quot;firstName must not be null&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</pre><p>The <code>type</code> attribute is of course vital: this used to be the only thing<br>
we specified. We&apos;ve added two new attributes. The first is <code>allowNull: false</code>. This tells Sequelize not to let us set the <code>firstName</code> attribute<br>
to <code>NULL</code>.</p>
<p>The second attribute is <code>validate</code>. We will spend a lot of time<br>
examining this attribute in this reading. Validation logic for<br>
<code>firstName</code> is configured inside the <code>validate</code> attribute. Our<br>
<code>validate</code> configuration is:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token punctuation">{</span>
  notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    msg<span class="token punctuation">:</span> <span class="token string">&quot;firstName must not be null&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</pre><p>This configuration tells Sequelize what error message to give if we try<br>
to set the <code>firstName</code> attribute to <code>NULL</code>. It&apos;s odd that we have to set<br>
both <code>allowNull: false</code> and <code>notNull: { msg: ... }</code>. This feels like<br>
unnecessary duplication. Regardless, that&apos;s what Sequelize wants us to<br>
do. On the other hand, we do get a chance to specify the error message<br>
to print if the validation fails (<code>&quot;firstName must not be null&quot;</code>).</p>
<p>Let&apos;s see how the validation logic helps us avoid saving junk data to<br>
our database:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// index.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// Empty cat. All fields set to `null`.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Try to save cat to the database.</span>
    <span class="token keyword">await</span> cat<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Save success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cat<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Save failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Print list of errors.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> validationError <span class="token keyword">of</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> validationError<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>Running this code prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Save failed!
* firstName must not be null
* specialSkill must not be null
* age must not be null
</code></pre><p>What happened? When we call the <code>save</code> method on a <code>Cat</code>, Sequelize will<br>
check that all the specified validations are satisfied. In this case<br>
none of them are! The <code>save</code> method will throw an exception, which we<br>
handle using <code>try { ... } catch (err) { ... }</code>.</p>
<p>What kind of exception? The thrown error is a<br>
<a href="https://sequelize.org/v5/class/lib/errors/validation-error.js~ValidationError.html"><code>ValidationError</code></a>. This has an <code>errors</code><br>
attribute, which stores an array of<br>
<a href="https://sequelize.org/v5/class/lib/errors/validation-error.js~ValidationErrorItem.html"><code>ValidationErrorItem</code>s</a>. We print out the<br>
message for each item error.</p>
<p>Because there were validation failures, Sequelize <strong>will not save</strong> the<br>
invalid <code>Cats</code> record to the database. Sequelize thus keeps us from<br>
inserting junk data into the database.</p>
<p>If we want to save our <code>Cat</code> object, we would have to change its<br>
attributes to meet the validations (i.e., set them to something other<br>
than <code>NULL</code>) and call <code>save</code> a second time. For example:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// index.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// Empty cat. All fields set to `null`.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> cat<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The save will not succeed!</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;We will fix and try again!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Fix the various validation problems.</span>
  cat<span class="token punctuation">.</span>firstName <span class="token operator">=</span> <span class="token string">&quot;Markov&quot;</span><span class="token punctuation">;</span>
  cat<span class="token punctuation">.</span>specialSkill <span class="token operator">=</span> <span class="token string">&quot;sleeping&quot;</span><span class="token punctuation">;</span>
  cat<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Trying to save a second time!</span>
    <span class="token keyword">await</span> cat<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The save *should* succeed!</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="the-notempty-validation">The <code>notEmpty</code> Validation</h2>

<p>Even though we are not allowed to set <code>firstName</code> and <code>specialSkill</code> to<br>
<code>NULL</code>, we could still set them to the empty string <code>&quot;&quot;</code>:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// index.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    specialSkill<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Try to save cat to the database.</span>
    <span class="token keyword">await</span> cat<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Save success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cat<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Save failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Print list of errors.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> validationError <span class="token keyword">of</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> validationError<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info class="language-"><code>Executing (default): INSERT INTO &quot;Cats&quot; (&quot;id&quot;,&quot;firstName&quot;,&quot;specialSkill&quot;,&quot;age&quot;,&quot;createdAt&quot;,&quot;updatedAt&quot;) VALUES (DEFAULT,$1,$2,$3,$4,$5) RETURNING *;
Save success!
{
  &quot;id&quot;: 8,
  &quot;firstName&quot;: &quot;&quot;,
  &quot;specialSkill&quot;: &quot;&quot;,
  &quot;age&quot;: 5,
  &quot;updatedAt&quot;: &quot;2020-02-12T21:34:49.250Z&quot;,
  &quot;createdAt&quot;: &quot;2020-02-12T21:34:49.250Z&quot;
}
</code></pre><p>This is bogus: <code>Cats</code> records should have a non-empty <code>firstName</code> and<br>
<code>specialSkill</code>. We will therefore add a second validation for both<br>
<code>firstName</code> and <code>specialSkill</code>:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./models/cat.js</span>
<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Cat <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Cat&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;firstName must not be null&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;firstName must not be empty&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    specialSkill<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;specialSkill must not be null&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;specialSkill must not be empty&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Cat<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Cat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>When we run the same <code>index.js</code> that tries to save the <code>Cats</code> record<br>
with the empty <code>firstName</code> and <code>specialSkill</code>, we now print:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Save failed!
* firstName must not be empty
* specialSkill must not be empty
</code></pre><p>Excellent! We&apos;ve added the new validation by adding a <code>notEmpty</code> key to<br>
the <code>validate</code> POJO. Just like with <code>notNull</code>, we specify a message to<br>
print.</p>
<p>This is the typical story: we add new validations by adding new<br>
key/value pairs to the <code>validate</code> POJO. Sequelize provides many<br>
different kinds of validations for us, but we configure all of them in<br>
the same general manner.</p>
<h2 class="mume-header" id="forbidding-long-string-values">Forbidding Long String Values</h2>

<p>We don&apos;t want our cats to have names that are too long. We add a <code>len</code><br>
validation like so:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./models/cat.js</span>
<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Cat <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Cat&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;firstName must not be null&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;firstName must not be empty&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        len<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;firstName must not be more than eight letters long&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Cat<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Cat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>If we try to run:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// index.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> Cat <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cat <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token string">&quot;Markov The Magnificent&quot;</span><span class="token punctuation">,</span>
    specialSkill<span class="token punctuation">:</span> <span class="token string">&quot;sleeping&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Try to save cat to the database.</span>
    <span class="token keyword">await</span> cat<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Save success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cat<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Save failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Print list of errors.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> validationError <span class="token keyword">of</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> validationError<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>We will be told:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Save failed!
* firstName must not be more than eight letters long
</code></pre><p>The <code>len</code> validation gets a <code>msg</code> attribute as usual. We also configure<br>
<code>args: [0, 8]</code>. These are the &quot;arguments&quot; to the <code>len</code> validation. We<br>
are telling Sequelize to trigger a validation error if the <code>firstName</code><br>
property has a length less than zero (impossible) or greater than eight.</p>
<p>Note that even though the <code>len</code> validation is not triggered for a length<br>
of zero, the <code>notEmpty</code> validation still will be.</p>
<p>If desired, we could use the <code>len</code> validation to set a true minimum<br>
length for a string. If we wanted a minimum length of two letters, we<br>
would just change <code>args: [2, 8]</code>. (We ought also update the <code>msg</code><br>
appropriately.)</p>
<h2 class="mume-header" id="validating-that-a-numeric-value-is-within-a-specified-range">Validating That A Numeric Value Is Within A Specified Range</h2>

<p>A <code>Cat</code> should never have a negative age. Perhaps, also, a <code>Cat</code> should<br>
have a theoretical maximum age of 99 years. We can add validations to<br>
enforce these requirements:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./models/cat.js</span>
<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Cat <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Cat&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    age<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;age must not be null&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        min<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;age must not be less than zero&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        max<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;age must not be greater than 99&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Cat<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Cat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>You can see that the <code>min</code> and <code>max</code> validations are configured in the<br>
same sort of way that the <code>len</code> validation is.</p>
<p>If we try to save a <code>Cat</code> with an <code>age</code> of <code>-1</code>, we are printed:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Save failed!
* age must not be less than zero
</code></pre><p>Likewise, if we try to save a <code>Cat</code> with an <code>age</code> of <code>123</code> we are<br>
printed:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Save failed!
* age must not be greater than 99
</code></pre><p><em>(Note: I&apos;ve stopped repeating our <code>index.js</code> file, since there are only<br>
trivial modifications to a <code>Cat</code>&apos;s attributes each time.)</em></p>
<h2 class="mume-header" id="validating-that-an-attribute-is-among-a-finite-set-of-values">Validating That An Attribute Is Among A Finite Set Of Values</h2>

<p>Let&apos;s say that a <code>Cat</code>&apos;s <code>specialSkill</code> should be restricted to a<br>
pre-defined list of <code>[&quot;jumping&quot;, &quot;sleeping&quot;, &quot;purring&quot;]</code>. That is: a<br>
<code>Cat</code> should not be allowed to have just any <code>specialSkill</code>. The<br>
<code>specialSkill</code> must be on the list.</p>
<p>We can enforce this requirement like so:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./models/cat.js</span>
<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Cat <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Cat&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    specialSkill<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;specialSkill must not be null&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;specialSkill must not be empty&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        isIn<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;jumping&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sleeping&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;purring&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;specialSkill must be either jumping, sleeping, or purring&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Cat<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Cat<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Notice how we <strong>doubly-nest</strong> the list of special skills (<code>[&quot;jumping, &quot;sleeping&quot;, &quot;purring&quot;]</code>) when specifying the <code>args</code> for the <code>isIn</code><br>
validation. This is because we want to pass <strong>one</strong> argument: an array<br>
of three possible special skills.</p>
<p>Now when we try to save a <code>Cat</code> with <code>specialSkill</code> set to <code>&quot;pearl diving&quot;</code>, our code will print:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Save failed!
* specialSkill must be either jumping, sleeping, or purring
</code></pre><h2 class="mume-header" id="conclusion-4">Conclusion</h2>

<p>There is a very large variety of validations that are provided by<br>
Sequelize. You can find many more in the Sequelize <a href="https://sequelize.org/v5/manual/models-definition.html#validations">documentation for<br>
validations</a>.</p>
<p>Having completed this reading, you now know how to:</p>
<ol>
<li>Validate that an attribute is not set to <code>NULL</code>.</li>
<li>Validate that a string attribute is not set to the empty string <code>&quot;&quot;</code>.</li>
<li>Validate that a string attribute is not too long (has too many<br>
characters).</li>
<li>Validate that a numeric attribute meets minimum or maximum<br>
thresholds.</li>
<li>Validate that an attribute is within a limited set of options.</li>
</ol>
<hr>
<h1 class="mume-header" id="transactions-with-sequelize">Transactions With Sequelize</h1>

<p>In this reading, we will learn about database <em>transactions</em> and how we<br>
use them via Sequelize. We will learn how to group multiple update<br>
operations into a single atomic, indivisible unit.</p>
<p>At the end of the reading, you should know:</p>
<ol>
<li>How to write code that is resilient to SQL operation failures,</li>
<li>How to group multiple operations into a database transaction using<br>
Sequelize (the <code>sequelize.transaction</code> method),</li>
<li>How to prevent &quot;race conditions&quot; using transactions.</li>
</ol>
<h2 class="mume-header" id="the-problem-database-updates-can-fail">The Problem: Database Updates Can Fail</h2>

<p>Imagine a scenario with a banking database. Markov wants to transfer<br>
$7,500 to Curie. To perform the transfer, we will perform two database<br>
update operations:</p>
<ol>
<li>Reduce Markov&apos;s account balance by $7,500,</li>
<li>Increase Curie&apos;s account balance by $7,500.</li>
</ol>
<p>When transferring money, it&apos;s very important that <em>both</em> operations be<br>
performed. If we reduce Markov&apos;s balance but fail to increase Curie&apos;s<br>
balance, the bank effectively steals money from Markov. If we increase<br>
Curie&apos;s balance without reducing Markov&apos;s balance, the bank effectively<br>
gives away free money to Curie. Neither is acceptable.</p>
<p>We must keep in mind that any attempt to perform a database update can<br>
sometimes <em>fail</em>. It can fail for a number of reasons:</p>
<ol>
<li>The command is sent, but the database has previously been shut down<br>
by the database administrator. Because the database is not running,<br>
the database is not listening for our update, won&apos;t receive it, and<br>
thus won&apos;t process it.</li>
<li>A bug in the database or operating system software has caused the<br>
database or operating system to crash. Again, the database is not<br>
running, so it can neither receive nor process our update.</li>
<li>Power has been lost to the machine running the database. The database<br>
is not running.</li>
<li>The internet connection that connects us to the database machine is<br>
disrupted. The database may be running and listening for SQL requests<br>
to process. However, our update request cannot get through to the<br>
database machine. Because the database cannot receive our request,<br>
the database cannot process it.</li>
<li>The update asks the database to violate a pre-defined constraint. For<br>
example: the database may have a constraint that an account balance<br>
must never be less than zero. Any update that asks the database to<br>
reduce an account balance to less than zero will be rejected and<br>
therefore fail.</li>
</ol>
<p>Only this last scenario is &quot;our fault.&quot; The fact is that database<br>
updates can fail <strong>through no fault of our own</strong>. With regard to our<br>
example: our first SQL request to reduce Markov&apos;s account balance may<br>
succeed, but the database may then crash before we have sent the request<br>
to increase Curie&apos;s balance. Through no fault of our own, the bank has<br>
stolen money from Markov without giving it to Curie.</p>
<p>How can we write code that avoids this fundamental problem?</p>
<h2 class="mume-header" id="the-solution-database-transactions">The Solution: Database Transactions</h2>

<p>One way to solve the problem is to &quot;group&quot; or &quot;pair&quot; the two update<br>
operations somehow. We want to tell the database &quot;Reduce Markov&apos;s<br>
balance AND increment Curie&apos;s balance.&quot; We want to tell the database:<br>
&quot;If for any reason you cannot perform <strong>both</strong> operations, make sure not<br>
to perform <strong>either</strong>.&quot; We want to tell the database: &quot;If you crash<br>
after reducing Markov&apos;s balance, make sure to either (a) increase<br>
Curie&apos;s balance when you restart, or (b) undo the increase to Markov&apos;s<br>
balance when you restart.&quot;</p>
<p>We want to ask the database to treat the pair of updates as one <em>atomic</em><br>
(meaning <strong>indivisible</strong>) unit. SQL lets you do this using a feature<br>
called <em>transactions</em>.</p>
<p>You&apos;ve previously seen how to use SQL transactions:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token comment">-- Reduce Markov&apos;s balance by $7500</span>
<span class="token keyword">UPDATE</span> <span class="token string">&quot;BankAccounts&quot;</span> <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">7500</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">-- Increment Curie&apos;s balance by $7500</span>
<span class="token keyword">UPDATE</span> <span class="token string">&quot;BankAccounts&quot;</span> <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">7500</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</pre><p>SQL guarantees to you that everything between <code>START TRANSACTION</code> and<br>
<code>COMMIT TRANSACTION</code> will be processed <em>atomically</em>. If any update<br>
operation fails, none of the updates will be performed. The transaction<br>
is &quot;all-or-nothing.&quot;</p>
<p>In this reading you will learn how to use SQL transactions with the<br>
Sequelize ORM.</p>
<h2 class="mume-header" id="the-bankaccounts-schema">The <code>BankAccounts</code> Schema</h2>

<p>For our example in this reading, I will use a single table with two<br>
accounts.</p>
<pre data-role="codeBlock" data-info class="language-"><code>catsdb=&gt; SELECT * FROM &quot;BankAccounts&quot;;
 id | clientName | balance | ...
----+------------+---------+-----
  1 | Markov     |    5000 | ...
  2 | Curie      |   10000 | ...
(2 rows)
</code></pre><p>I have generated a Sequelize model corresponding to the <code>BankAccounts</code><br>
table:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./models/bank_account.js</span>
<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Define BankAccount model.</span>
  <span class="token keyword">const</span> BankAccount <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;BankAccount&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// Define clientName attribute.</span>
    clientName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// Define validations on clientName.</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// clientName must not be null.</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;clientName must not be NULL&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// clientName must not be empty.</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;clientName must not be empty&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// Define balance attribute.</span>
    balance<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// Define validations on balance.</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// balance must not be less than zero.</span>
        min<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&quot;balance must not be less than zero&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> BankAccount<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Notice that the <code>min</code> validation on <code>balance</code> will not allow us to save<br>
an account balance that is below zero.</p>
<h2 class="mume-header" id="example-an-update-fails-because-of-validation-failure">Example: An Update Fails Because Of Validation Failure</h2>

<p>Let&apos;s imagine that Markov wants to transfer <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7</mn><mo separator="true">,</mo><mn>500</mn><mi>t</mi><mi>o</mi><mi>C</mi><mi>u</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi mathvariant="normal">.</mi><mi>U</mi><mi>n</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>u</mi><mi>n</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>l</mi><mi>y</mi><mo separator="true">,</mo><mi>M</mi><mi>a</mi><mi>r</mi><mi>k</mi><mi>o</mi><mi>v</mi><mi>h</mi><mi>a</mi><mi>s</mi><mi>o</mi><mi>n</mi><mi>l</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">7,500 to Curie.
Unfortunately, Markov has only</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">7</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span>5,000 in his account! Decrementing<br>
Markov&apos;s account balance by $7,500 would put it in the negative, which<br>
our validation will not allow. Thus the transfer must fail.</p>
<p>Imagine that Markov is unaware that his account balance cannot cover the<br>
transfer. He tries to perform the transfer anyway:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./index.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize <span class="token punctuation">,</span> BankAccount <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This code will try to transfer $7,500 from Markov to Curie.</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fetch Markov and Curie&apos;s accounts.</span>
  <span class="token keyword">const</span> markovAccount <span class="token operator">=</span> <span class="token keyword">await</span> BankAccount<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> curieAccount <span class="token operator">=</span> <span class="token keyword">await</span> BankAccount<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Increment Curie&apos;s balance by $7,500.</span>
    curieAccount<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> curieAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Decrement Markov&apos;s balance by $7,500.</span>
    markovAccount<span class="token punctuation">.</span>balance <span class="token operator">-=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> markovAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Report if anything goes wrong.</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> e <span class="token keyword">of</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>clientName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Running this code prints the following:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;clientName&quot;, &quot;balance&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;BankAccounts&quot; AS &quot;BankAccount&quot; WHERE &quot;BankAccount&quot;.&quot;id&quot; = 1;
Executing (default): SELECT &quot;id&quot;, &quot;clientName&quot;, &quot;balance&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;BankAccounts&quot; AS &quot;BankAccount&quot; WHERE &quot;BankAccount&quot;.&quot;id&quot; = 2;
Executing (default): UPDATE &quot;BankAccounts&quot; SET &quot;balance&quot;=$1,&quot;updatedAt&quot;=$2 WHERE &quot;id&quot; = $3
Error!
Markov: balance must not be less than zero
</code></pre><p>Everything starts out fine. We fetch Markov and Curie&apos;s accounts. We<br>
increase Curie&apos;s balance. But then we hit a snag: when we call<br>
<code>markovAccount.save()</code>, Sequelize detects that we are trying to set<br>
Markov&apos;s balance below zero. Sequelize therefore <strong>does not</strong> send a SQL<br>
request to update Markov&apos;s account balance. Instead,<br>
<code>markovAccount.save()</code> throws an exception. We print the error: Markov&apos;s<br>
balance must not be less than zero.</p>
<p>We thus avoid saving a negative balance for Markov. But other damage has<br>
already been done. If we now check account balances, we will see:</p>
<pre data-role="codeBlock" data-info class="language-"><code>catsdb=&gt; SELECT * FROM &quot;BankAccounts&quot;;
 id | clientName | balance | ...
----+------------+---------+-----
  1 | Markov     |    5000 | ...
  2 | Curie      |   17500 | ...
(2 rows)
</code></pre><p>The bank has given free money to Curie! We should have &quot;rolledback&quot; the<br>
increase of Curie&apos;s balance. We will learn how to do that!</p>
<h2 class="mume-header" id="incorrect-solutions">Incorrect Solutions</h2>

<p>One may suggest a fix: make sure to decrement Markov&apos;s account balance<br>
before incrementing Curie&apos;s balance! If Markov&apos;s balance is<br>
insufficient, we can stop the transfer before giving Curie any money.</p>
<p>We <em>could</em> swap the order of the updates, and it would indeed fix this<br>
specific problem. But imagine if Markov tries to transfer $2,500 (an<br>
amount he can afford). We first decrement Markov&apos;s account balance and<br>
then -- the operating system crashes before the second update can be<br>
submitted. Curie&apos;s balance is not incremented. The bank has stolen<br>
Markov&apos;s money!</p>
<p>The problem is fundamental: no matter what order we perform the two<br>
updates in, the database can always fail <em>after</em> processing the first,<br>
but <em>before</em> processing the second. For our code to be resilient to<br>
unavoidable failures, there is no other choice but to use a database<br>
transaction.</p>
<h2 class="mume-header" id="using-a-database-transaction-with-sequelize">Using A Database Transaction With Sequelize</h2>

<p>Let&apos;s return to our previous example of trying to transfer $7,500 from<br>
Markov to Curie. Specifically, we will rewrite this key part:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// Increment Curie&apos;s balance by $7,500.</span>
curieAccount<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> curieAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Decrement Markov&apos;s balance by $7,500.</span>
markovAccount<span class="token punctuation">.</span>balance <span class="token operator">-=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> markovAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>To ask Sequelize to perform the two updates in a SQL database<br>
transaction, we use the <code>sequelize.transaction</code> method. We will write<br>
this like so, instead:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">tx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Increment Curie&apos;s balance by $7,500.</span>
  curieAccount<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> curieAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Decrement Markov&apos;s balance by $7,500.</span>
  markovAccount<span class="token punctuation">.</span>balance <span class="token operator">-=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> markovAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Let&apos;s go through the transaction code and explain each part:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// Start a transaction. Queries run inside the callback can be part of</span>
<span class="token comment">// the transaction.</span>
<span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">tx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Increment Curie&apos;s balance by $7,500.</span>
  curieAccount<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
  <span class="token comment">// Pass the `tx` transaction object so that Sequelize knows to</span>
  <span class="token comment">// update Curie&apos;s account as part of this transaction (rather than</span>
  <span class="token comment">// &quot;on its own&quot; per usual).</span>
  <span class="token keyword">await</span> curieAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Decrement Markov&apos;s balance by $7,500.</span>
  markovAccount<span class="token punctuation">.</span>balance <span class="token operator">-=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
  <span class="token comment">// Again, pass the `tx` transaction object. Thus both updates are part</span>
  <span class="token comment">// of the same transaction.</span>
  <span class="token keyword">await</span> markovAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// If no exceptions have been thrown, `sequelize.transaction` will</span>
  <span class="token comment">// `COMMIT` the transaction after the end of the callback.</span>
  <span class="token comment">//</span>
  <span class="token comment">// If any error gets thrown, `sequelize.transaction` will abort</span>
  <span class="token comment">// the transaction by issuing a `ROLLBACK`. This will cancel all</span>
  <span class="token comment">// updates.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Let&apos;s put the transaction code back into our original program:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./index.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sequelize<span class="token punctuation">,</span> BankAccount <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./models&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fetch Markov and Curie&apos;s accounts.</span>
  <span class="token keyword">const</span> markovAccount <span class="token operator">=</span> <span class="token keyword">await</span> BankAccount<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> curieAccount <span class="token operator">=</span> <span class="token keyword">await</span> BankAccount<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">tx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Increment Curie&apos;s balance by $7,500.</span>
      curieAccount<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> curieAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Decrement Markov&apos;s balance by $7,500.</span>
      markovAccount<span class="token punctuation">.</span>balance <span class="token operator">-=</span> <span class="token number">7500</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> markovAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Report if anything goes wrong.</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> e <span class="token keyword">of</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>clientName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Running this code prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (default): SELECT &quot;id&quot;, &quot;clientName&quot;, &quot;balance&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;BankAccounts&quot; AS &quot;BankAccount&quot; WHERE &quot;BankAccount&quot;.&quot;id&quot; = 1;
Executing (default): SELECT &quot;id&quot;, &quot;clientName&quot;, &quot;balance&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;BankAccounts&quot; AS &quot;BankAccount&quot; WHERE &quot;BankAccount&quot;.&quot;id&quot; = 2;
Executing (208b3951-9ab9-489b-97f0-afb49aaff807): START TRANSACTION;
Executing (208b3951-9ab9-489b-97f0-afb49aaff807): UPDATE &quot;BankAccounts&quot; SET &quot;balance&quot;=$1,&quot;updatedAt&quot;=$2 WHERE &quot;id&quot; = $3
Executing (208b3951-9ab9-489b-97f0-afb49aaff807): ROLLBACK;
Error!
Markov: balance must not be less than zero
</code></pre><p>Let&apos;s review what happened. We again start by fetching both<br>
<code>BankAccount</code>s. We next <code>START TRANSACTION</code>. We issue the update to<br>
Curie&apos;s account.</p>
<p>Then Sequelize detects the validation failure when trying to run<br>
<code>markovAccount.save({ transaction: tx })</code>. Markov doesn&apos;t have enough<br>
money in his account! Sequelize throws an exception. The<br>
<code>sequelize.transaction</code> method <em>catches the exception</em> and issues a<br>
<code>ROLLBACK</code> for the transaction. This tells the database to undo the<br>
prior increment of Curie&apos;s account balance.</p>
<p>Having rolled back the transaction, the <code>sequelize.transaction</code><br>
method <em>rethrows</em> the error, so that our logging code gets a chance to<br>
learn about the error and print its details.</p>
<h2 class="mume-header" id="aside-what-is-the-transaction-object">Aside: What Is The <code>Transaction</code> Object?</h2>

<p><em>This is bonus information in case you are troubled by what the <code>tx</code><br>
parameter to <code>sequelize.transaction</code> is for. You can use transactions<br>
correctly without knowing this bonus information.</em></p>
<p>What is the mysterious <code>tx</code> that is passed by <code>sequelize.transaction</code><br>
to our callback? It is basically just a unique ID. In this case, the ID<br>
is: <code>208b3951-9ab9-489b-97f0-afb49aaff807</code>. You can see this ID in the<br>
logs above.</p>
<p>When we say <code>curieAccount.save({ transaction: tx })</code>, we are telling<br>
Sequelize: &quot;update Curie&apos;s account as part of transaction number<br>
<code>208b3951-9ab9-489b-97f0-afb49aaff807</code>.&quot;</p>
<p>Sequelize needs transaction IDs because it can be running many SQL<br>
transactions <em>concurrently</em> (loosely speaking: &quot;in parallel&quot;). One part<br>
of the application could be transferring money from Markov to Curie at<br>
the same time another part of the application is transferring money from<br>
Kate to Ned.</p>
<p>If Sequelize did not keep track of transaction IDs, it would not know<br>
that <code>curieAccount.save()</code> should be a part of the Markov/Curie<br>
transaction rather than the Kate/Ned transaction.</p>
<h2 class="mume-header" id="transactions-prevent-_race-conditions_">Transactions Prevent <em>Race Conditions</em></h2>

<p>There is still a subtle mistake in my bank transfer code. There is a<br>
potential problem if someone modifies Markov&apos;s or Curie&apos;s account in<br>
between (1) the initial fetch of their accounts, and (2) the transaction<br>
to update the accounts.</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token comment">// ./index.js</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// I will transfer only $5,000 so that Markov&apos;s balance can cover the</span>
  <span class="token comment">// amount. Markov starts out with $5,000.</span>

  <span class="token comment">// Fetch Markov and Curie&apos;s accounts.</span>
  <span class="token keyword">const</span> markovAccount <span class="token operator">=</span> <span class="token keyword">await</span> BankAccount<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> curieAccount <span class="token operator">=</span> <span class="token keyword">await</span> BankAccount<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ***</span>
  <span class="token comment">// Imagine that right now some other program transfers the $5,000 out</span>
  <span class="token comment">// of Markov&apos;s account. Markov&apos;s true account **in the database** now</span>
  <span class="token comment">// has a balance of $0. But `markovAccount.balance` is still $5,000,</span>
  <span class="token comment">// because we fetched Markov&apos;s `BankAccount` **before** the transfer</span>
  <span class="token comment">// was made!</span>
  <span class="token comment">// ***</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">tx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Increment Curie&apos;s balance by $5,000 (to $15,000).</span>
      curieAccount<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> curieAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Decrement `markovAccount.balance` by $5,000.</span>
      <span class="token comment">// `markovAccount.balance` is set to zero.</span>
      markovAccount<span class="token punctuation">.</span>balance <span class="token operator">-=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
      <span class="token comment">// Save and set Markov&apos;s balance to zero.</span>
      <span class="token keyword">await</span> markovAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Problem: Markov&apos;s balance in the database was *already* zero.</span>
      <span class="token comment">// Markov had no money to transfer. He should not have been able</span>
      <span class="token comment">// to transfer the $5,000.</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Because another program can &quot;race in between&quot; (1) the reading of the<br>
account balances and (2) the updating of the balances, we call this<br>
potential problem a <em>race condition</em>. The easiest way to fix the race<br>
condition is to prohibit anyone else from modifying Markov&apos;s account<br>
balance in between (1) and (2).</p>
<p>Luckily, the solution is simple. Any data used in a transaction will be<br>
<em>locked</em> until the transaction completes. Data that is locked can be<br>
neither read nor written by other transactions. If our transaction reads<br>
(or writes) data, no one else can read or write that data until our<br>
transaction completes. When we <code>COMMIT</code> (or <code>ROLLBACK</code>) all the locked<br>
data is freed (the locks are <em>released</em>).</p>
<p>We don&apos;t have to lock the data ourselves. Simply by doing all our<br>
queries inside the same transaction, the database will lock the data for<br>
us. Therefore, to fix the problem, we should move the initial account<br>
fetching by <code>findByPk</code> into the transaction (i.e., pass it <code>{ transaction: tx }</code>):</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do all database access within the transaction.</span>
    <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">tx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Fetch Markov and Curie&apos;s accounts.</span>
      <span class="token keyword">const</span> markovAccount <span class="token operator">=</span> <span class="token keyword">await</span> BankAccount<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> curieAccount <span class="token operator">=</span> <span class="token keyword">await</span> BankAccount<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>
        <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// No one can mess with Markov or Curie&apos;s accounts until the</span>
      <span class="token comment">// transaction completes! The account data has been locked!</span>

      <span class="token comment">// Increment Curie&apos;s balance by $5,000.</span>
      curieAccount<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> curieAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Decrement Markov&apos;s balance by $5,000.</span>
      markovAccount<span class="token punctuation">.</span>balance <span class="token operator">-=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> markovAccount<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transaction<span class="token punctuation">:</span> tx <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This prints:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Executing (76321a03-93c5-47c0-861a-cf24c3e6f3bf): START TRANSACTION;
Executing (76321a03-93c5-47c0-861a-cf24c3e6f3bf): SELECT &quot;id&quot;, &quot;clientName&quot;, &quot;balance&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;BankAccounts&quot; AS &quot;BankAccount&quot; WHERE &quot;BankAccount&quot;.&quot;id&quot; = 1;
Executing (76321a03-93c5-47c0-861a-cf24c3e6f3bf): SELECT &quot;id&quot;, &quot;clientName&quot;, &quot;balance&quot;, &quot;createdAt&quot;, &quot;updatedAt&quot; FROM &quot;BankAccounts&quot; AS &quot;BankAccount&quot; WHERE &quot;BankAccount&quot;.&quot;id&quot; = 2;
Executing (76321a03-93c5-47c0-861a-cf24c3e6f3bf): UPDATE &quot;BankAccounts&quot; SET &quot;balance&quot;=$1,&quot;updatedAt&quot;=$2 WHERE &quot;id&quot; = $3
Executing (76321a03-93c5-47c0-861a-cf24c3e6f3bf): UPDATE &quot;BankAccounts&quot; SET &quot;balance&quot;=$1,&quot;updatedAt&quot;=$2 WHERE &quot;id&quot; = $3
Executing (76321a03-93c5-47c0-861a-cf24c3e6f3bf): COMMIT;
</code></pre><p>Notice that now <em>everything</em> is done in the transaction<br>
<code>76321a03-93c5-47c0-861a-cf24c3e6f3bf</code>. This includes the initial<br>
fetching of the accounts. Because the fetching is done within the<br>
transaction, other users are not allowed to modify the accounts until<br>
the transaction is finished.</p>
<p>Moving our read operations into the transaction has solved our race<br>
condition problem. Every Sequelize operation - whether reading or<br>
writing - can take a <code>transaction: tx</code> option. This includes:</p>
<ol>
<li><code>findByPk</code></li>
<li><code>findAll</code></li>
<li><code>save</code></li>
<li><code>create</code></li>
<li><code>destroy</code></li>
</ol>
<h2 class="mume-header" id="conclusion-5">Conclusion</h2>

<p>Having completed this reading, here are the important things to take<br>
away:</p>
<ol>
<li>You should know that any SQL update operation may fail, often through<br>
no fault of your own.</li>
<li>You should know that you must write code resilient to SQL failures.</li>
<li>You should know that when performing multiple update operations as<br>
part of a group, you must use a transaction.</li>
<li>You should know how to use <code>sequelize.transaction</code> to run commands<br>
within a SQL transaction.</li>
<li>You should know how to pass a transaction object as the<br>
<code>{ transaction: tx }</code> parameter to a Sequelize command (such as<br>
<code>save</code>).</li>
<li>You should know what a <em>race condition</em> is: the possibility that<br>
someone else modifies previously fetched data before you are finished<br>
using/updating it.</li>
<li>You should know how to use transactions to guard against race<br>
conditions. That is: you should know that both reading and writing<br>
operations should be put in the same transaction.</li>
</ol>
<hr>
<h1 class="mume-header" id="recipe-box-with-sequelize-project">Recipe Box With Sequelize Project</h1>

<p>In this project, you will build the Data Access Layer to power a Web<br>
application. Unlike previously, you will use the Sequelize library and tools to<br>
do this to build a more maintainable application.</p>
<p>It has more steps than the SQL version, but it&apos;s more maintainable in the long<br>
run. Also, the SQL version hid a lot of complexity from you with respect to the<br>
running of the SQL. Go look at the SQL version of the files in the<br>
<strong>controllers</strong> directory to see what we had to do to load the SQL and execute<br>
it.</p>
<p>Now, compare the <em>simplicity</em> of those with the simplicity of the files in the<br>
<strong>controllers</strong> directory for <em>this</em> version of the application. It&apos;s easier to<br>
understand <em>this</em> version. You want to know where to add a column to a table?<br>
Go to the migrations. You want to know where to fix a query? Go to the proper<br>
repository file.</p>
<p>It&apos;s just <em>so</em> much better organized.</p>
<p>Quite often, you will see that you will have more files and, overall, more lines<br>
of code in well-organized, highly-maintainable software project. Remembering<br>
where code is <em>is hard</em>. That&apos;s why having clearly-named files and directories<br>
is so very important.</p>
<h2 class="mume-header" id="the-data-model-analysis-1">The data model analysis</h2>

<p>This looks no different because it&apos;s the same application.</p>
<p>What goes into a recipe box? Why, recipes, of course! Here&apos;s an example recipe<br>
card.</p>
<p><img src="images/sql-recipe-card.jpeg" alt="Recipe card"></p>
<p>You can see that a recipe is made up of three basic parts:</p>
<ul>
<li>A title,</li>
<li>A list of ingredients, and</li>
<li>A list of instructions.</li>
</ul>
<p>You&apos;re going to add a little more to that, too. It will also have</p>
<ul>
<li>The date/time that it was entered into the recipe box, and</li>
<li>The date/time it was last updated in the recipe box.</li>
</ul>
<p>These are good pieces of data to have so that you can show them &quot;most recent&quot;<br>
for example.</p>
<p>Ingredients themselves are complex data types and need their own structure. They<br>
&quot;belong&quot; to a recipe. That means they&apos;ll need to reference that recipe. That<br>
means an ingredient is made up of:</p>
<ul>
<li>An amount (optional),</li>
<li>A unit of measure (optional),</li>
<li>The actual food stuff, and</li>
<li>The id of the recipe that it belongs to.</li>
</ul>
<p>That unit of measure is a good candidate for normalization, don&apos;t you think?<br>
It&apos;s a predefined list of options that should not change and that you don&apos;t want<br>
people just typing whatever they want in there, not if you want to maintain<br>
data integrity. Otherwise, you&apos;ll end up with &quot;C&quot;, &quot;c&quot;, &quot;cup&quot;, &quot;CUP&quot;, &quot;Cup&quot;, and<br>
all the other permutations, each of which is a distinct value but means the same<br>
thing.</p>
<p>Instructions are also complex objects, but not by looking at them. Initially,<br>
one might only see text that comprises an instruction. But, very importantly,<br>
instructions have <em>order</em>. They also <em>belong</em> to the recipe. With that in mind,<br>
an instruction is made up of:</p>
<ul>
<li>The text of the instruction,</li>
<li>The order that it appears in the recipe, and</li>
<li>The id of the recipe that it belongs to.</li>
</ul>
<p>That is enough to make a good model for the recipe box.</p>
<p><img src="images/sql-recipe-box-data-model.png" alt="recipe box data model"></p>
<h2 class="mume-header" id="the-application-1">The application</h2>

<p>The application is a standard <a href="https://www.expressjs.com">express.js</a> application using the <a href="https://pugjs.org">pug</a> library<br>
to generate the HTML and the <a href="https://www.node-postgres.com">node-postgres</a> library to connect to the database.</p>
<p>It already has <a href="https://www.npmjs.com/package/sequelize">sequelize</a> and <a href="https://www.npmjs.com/package/sequelize-cli">sequelize-cli</a> installed.</p>
<h2 class="mume-header" id="getting-started-2">Getting started</h2>

<ul>
<li>Clone the starter project from<br>
<a href="https://github.com/appacademy-starters/sql-orm-recipe-box">https://github.com/appacademy-starters/sql-orm-recipe-box</a></li>
<li>Run <code>npm install</code> to install the packages</li>
<li>Run <code>npm run dev</code> to start the server on port 3000</li>
</ul>
<p>You&apos;ll do all of your work in the <strong>data-access-layer</strong> directory. In there, you<br>
will find a series of JS files. Each of these will hold your JavaScript code<br>
rather than SQL code.</p>
<h2 class="mume-header" id="your-code">Your code</h2>

<p>You&apos;re going to be using JavaScript and the tools of Sequelize. Keep the<br>
<a href="https://sequelize.org/v5/">Sequelize documentation</a> open and handy. Even developers that use ORMs every<br>
day will keep the documentation open because there&apos;s so much to know about them.</p>
<h2 class="mume-header" id="phase-1-initialize-the-sequelize-project">Phase 1: Initialize the Sequelize project</h2>

<p>Because this project already has <a href="https://www.npmjs.com/package/sequelize-cli">sequelize-cli</a> installed, you can initialize<br>
the project by typing <code>npx sequelize-cli init</code>. The <code>npx</code> command runs<br>
locally-installed tools. That will create the project structure that Sequelize<br>
expects for us to continue to use its tools.</p>
<h2 class="mume-header" id="phase-2-create-a-database-user-for-the-project">Phase 2: Create a database user for the project</h2>

<p>Using a PostgreSQL client like <code>psql</code> or Postbird, create a new user for this<br>
application named &quot;sequelize_recipe_box_app&quot; with the password &quot;HfKfK79k&quot; <em>and</em><br>
the ability to create a database. Here&apos;s the <a href="https://www.postgresql.org/docs/current/sql-createuser.html">link to the CREATE USER<br>
documentation</a> so that you can determine which options to give.</p>
<h2 class="mume-header" id="phase-2-change-the-connection-configuration">Phase 2: Change the connection configuration</h2>

<p>The project contains a directory named <strong>config</strong>. Inside there, you will find a<br>
file named <strong>config.json</strong>. You need to make some configuration changes.</p>
<ul>
<li>Change all the &quot;user&quot; and &quot;password&quot; values to the information for the user<br>
that you created in Phase 2.</li>
<li>Change the &quot;database&quot; values to be &quot;recipe_box_development&quot;,<br>
&quot;recipe_box_test&quot;, and &quot;recipe_box_production&quot;.</li>
<li>Change all of the &quot;dialect&quot; values from &quot;mysql&quot; to &quot;postgres&quot;.</li>
<li>Delete all of the &quot;operatorAliases&quot; entries. It&apos;s to support earlier versions<br>
of the Sequelize library. Make sure to remove the comma from the preceding<br>
line so that it&apos;s valid JSON.</li>
<li>Because you&apos;ll be using seed data in this project, add <code>&quot;seederStorage&quot;: &quot;sequelize&quot;</code> to each of the different blocks so that Sequelize CLI won&apos;t run<br>
a seeder more than once causing duplicate entries in the database.</li>
</ul>
<p>That will configure the application and the Sequelize tools to properly connect<br>
to your development database.</p>
<h2 class="mume-header" id="phase-3-create-your-database">Phase 3: Create your database</h2>

<p>Rather than writing SQL to do this, you will use the tools. Run</p>
<pre data-role="codeBlock" data-info class="language-"><code>npx sequelize-cli db:create
</code></pre><p>That runs the Sequelize CLI with the command <code>db:create</code>.</p>
<p>When you run this, it will default to the &quot;development&quot; setting and read the<br>
information from the configuration file to create your database for you! It<br>
should print out something like</p>
<pre data-role="codeBlock" data-info class="language-"><code>Sequelize CLI [Node: 10.19.0, CLI: 5.5.1, ORM: 5.21.5]

Loaded configuration file &quot;config/config.json&quot;.
Using environment &quot;development&quot;.
Database recipe_box_development created.
</code></pre><p>You can also drop the database by typing ... you guessed it! The Sequelize CLI<br>
with the command <code>db:drop</code>!</p>
<pre data-role="codeBlock" data-info class="language-"><code>npx sequelize-cli db:drop
</code></pre><p>If you run that, run the &quot;create&quot; command, again, so the database exists.</p>
<h2 class="mume-header" id="phase-4-the-units-of-measurement-data">Phase 4: The units of measurement data</h2>

<p>Just as a review, here is the specification for the table that holds units of<br>
measurement.</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Column Type</th>
<th>Constraints</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>SERIAL</td>
<td>PK</td>
</tr>
<tr>
<td>name</td>
<td>VARCHAR(20)</td>
<td>NOT NULL</td>
</tr>
</tbody>
</table>
<p>Luckily, the Sequelize models and migrations take care of the &quot;id&quot; property for<br>
you without you having to do anything. So, you can just focus on that &quot;name&quot;<br>
property.</p>
<h3 class="mume-header" id="create-a-migration">Create a migration</h3>

<p>It&apos;s time to create the first migration, the one that defines the table that<br>
will hold units of measure. You can use the Sequelize CLI to generate the<br>
migration for you. You can <em>also</em> tell it to create a model for you, and it will<br>
create a migration along <em>with</em> the model. You should do that to get the biggest<br>
return on investment for the characters that you will type.</p>
<p>The command is <code>model:generate</code> and it takes a couple of arguments, &quot;--name&quot;<br>
which contains the name of the model (as a singular noun) to generate,<br>
and &quot;--attributes&quot; which has a comma-separated list of &quot;property-name:data-type&quot;<br>
pairs.</p>
<p><strong>Learning Tip</strong>: It is <em>so very important</em> that you don&apos;t copy and paste this.<br>
Type these things out so it has a better chance of creating durable knowledge.</p>
<pre data-role="codeBlock" data-info class="language-"><code>npx sequelize-cli model:generate \
  --name MeasurementUnit \
  --attributes name:string
</code></pre><p>That will create two files, if everything works well. (The name of your<br>
migration file will be different because it&apos;s time-based.)</p>
<pre data-role="codeBlock" data-info class="language-"><code>New model was created at models/measurementunit.js
New migration was created at migrations/20200101012349-MeasurementUnit.js
</code></pre><p>The <strong>model</strong> file will be used by the application to query the database. It<br>
will be used by the express.js application. It is part of the running software.</p>
<p>The <strong>migration</strong> file is used to construct the database. It is only used by the<br>
Sequelize CLI tool to build the database. Unlike those schema and seed files<br>
that you had in the SQL version of this project which destroyed <em>everything</em><br>
when run, migrations are designed to change your database as your application<br>
grows. This is a much better strategy so that existing data in the databases<br>
that other people use aren&apos;t damaged.</p>
<p>Because the data model requires the &quot;name&quot; column to be both non-null <em>and</em><br>
unique, you have to add some information to the migration file. Open it and, for<br>
the &quot;name&quot; property, make non-nullable by looking at how the other properties<br>
are configured. Then, add the &quot;unique&quot; property set to <code>true</code> to the &quot;name&quot;<br>
configuration, as well. That should be enough for Sequelize to create the table<br>
for you.</p>
<p>The last thing to do is to change the length of the &quot;name&quot; property. By default,<br>
Sequelize will make it 255 characters long. The specification for the table<br>
says it should really only be 20 characters. To tell the migration that, change<br>
the type for &quot;name&quot; from <code>Sequelize.STRING</code> to <code>Sequelize.STRING(20)</code>.</p>
<h2 class="mume-header" id="run-your-migration">Run your migration</h2>

<p>If you now run your migration with the Sequelize CLI, it will create the table<br>
for you.</p>
<pre data-role="codeBlock" data-info class="language-"><code>npx sequelize-cli db:migrate
</code></pre><p>That should give you some output that looks similar to this.</p>
<pre data-role="codeBlock" data-info class="language-"><code>Loaded configuration file &quot;config/config.json&quot;.
Using environment &quot;development&quot;.
== 20200101012349-create-measurement-unit: migrating =======
== 20200101012349-create-measurement-unit: migrated (0.021s)
</code></pre><p>You can confirm that the table &quot;MeasurementUnits&quot; is created by using your<br>
PostgreSQL client. You&apos;ll also see that another table is created,<br>
&quot;SequelizeMeta&quot;, which contains information about which migration has most<br>
recently been run. It contains a single column, &quot;name&quot;. Each row contains an<br>
entry of which migration file has run. Now that you&apos;ve run your migration file,<br>
the table contains one entry, the name of your migration file. When you run<br>
more migrations, you will see more rows, each containing the name of the file<br>
that you&apos;ve run.</p>
<p><strong>psql Note</strong>: If you are using <code>psql</code> as you PostgreSQL command, be aware that<br>
it will lowercase any entity and column names you type in there. If you type<br>
<code>SELECT * FROM MeasurementUnits</code>, it converts that to <code>SELECT * FROM measurementunits</code> before running it. To prevent that from happening, use<br>
quotation marks around the table name. <code>SELECT * FROM &quot;MeasurementUnits&quot;</code> will<br>
do the trick.</p>
<p>It&apos;s important that you <em>never</em> change the name of a migration file after it&apos;s<br>
been run.</p>
<p>In the real world, you should <em>never</em> change the content of a migration file<br>
after it&apos;s been committed and shared in your Git repository. Asking others to<br>
rollback their migrations just because you changed one of yours is bad manners.<br>
Instead, you should add a new migration that makes the change that you want.</p>
<h2 class="mume-header" id="create-the-seed-data">Create the seed data</h2>

<p>You can create the seed data for the unit of measurements by creating a<br>
<strong>seeder</strong> as the Sequelize CLI calls them. You can create one using the<br>
Sequelize CLI tool. Run the following and make sure you don&apos;t get any errors.</p>
<pre data-role="codeBlock" data-info class="language-"><code>npx sequelize-cli seed:generate --name default-measurement-units
</code></pre><p>Now, you want to insert the seed data. You will do this by using the<br>
<code>bulkInsert</code> method of the object passed in through the <code>queryInterface</code><br>
parameter of the <code>up</code> method. Feel free to delete the comment in the <code>up</code> method<br>
and replace it with this.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">bulkInsert</span><span class="token punctuation">(</span><span class="token string">&apos;MeasurementUnits&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;cups&apos;</span><span class="token punctuation">,</span> createdAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> updatedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>bulkInsert</code> method takes two parameters:</p>
<ul>
<li>The name of the table to insert into, and</li>
<li>An array of objects that have property names that match the column names in<br>
the table.</li>
</ul>
<p>You can see that the first object has been provided by the example. Now, create<br>
objects for all of these values, as well. (The empty item in the list is an<br>
empty string and is intentional) Make sure you do them <strong>in this order,</strong> or<br>
when we get to the seed data for the other tables it won&apos;t work. (We&apos;ve supplied<br>
you with files for the seed data for the other tables because there is a lot of<br>
it)</p>
<ul>
<li>&quot;fluid ounces&quot;</li>
<li>&quot;gallons&quot;</li>
<li>&quot;grams&quot;</li>
<li>&quot;liters&quot;</li>
<li>&quot;milliliters&quot;</li>
<li>&quot;ounces&quot;</li>
<li>&quot;pinch&quot;</li>
<li>&quot;pints&quot;</li>
<li>&quot;pounds&quot;</li>
<li>&quot;quarts&quot;</li>
<li>&quot;tablespoons&quot;</li>
<li>&quot;teaspoons&quot;</li>
<li>&quot;&quot;</li>
<li>&quot;cans&quot;</li>
<li>&quot;slices&quot;</li>
<li>&quot;splash&quot;</li>
</ul>
<p>Now, run the Sequelize CLI with the command <code>db:seed:all</code>.</p>
<p>After you get that done, you can confirm that all of the records (rows) were<br>
created in the &quot;MeasurementUnits&quot; table.</p>
<h2 class="mume-header" id="phase-5-the-recipe-table-model">Phase 5: The recipe table model</h2>

<p>This will go much like the last one, except there&apos;s no seed data. Just to<br>
refresh your memory, here&apos;s the specification for the &quot;recipes&quot; table.</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Column Type</th>
<th>Constraints</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>SERIAL</td>
<td>PK</td>
</tr>
<tr>
<td>title</td>
<td>VARCHAR(200)</td>
<td>NOT NULL</td>
</tr>
<tr>
<td>created</td>
<td>TIMESTAMP</td>
<td>NOT NULL, DEFAULT CURRENT_TIMESTAMP</td>
</tr>
<tr>
<td>updated</td>
<td>TIMESTAMP</td>
<td>NOT NULL, DEFAULT CURRENT_TIMESTAMP</td>
</tr>
</tbody>
</table>
<p>As you&apos;ve discovered, Sequelize takes care of the &quot;id&quot; for you <em>and</em> the columns<br>
to track when the recipe has been created and updated! Your job is to</p>
<ul>
<li>Generate a model for the &quot;recipe&quot;</li>
<li>Customize the migration so the &quot;title&quot; column is not nullable</li>
</ul>
<p>Run your migration and confirm that you defined it correctly by checking the<br>
attributes in the description of the table. The important parts to check are<br>
that the &quot;title&quot; column is a VARCHAR(200) and is non-nullable. (The &quot;Collation&quot;<br>
column has been removed for brevity.)</p>
<pre data-role="codeBlock" data-info class="language-"><code>                  Table &quot;public.Recipes&quot;
  Column   |           Type           | Nullable |  Default
-----------+--------------------------+----------+------------
 id        | integer                  | not null | nextval(...
 title     | character varying(200)   | not null |
 createdAt | timestamp with time zone | not null |
 updatedAt | timestamp with time zone | not null |
Indexes:
    &quot;Recipes_pkey&quot; PRIMARY KEY, btree (id)
</code></pre><h2 class="mume-header" id="phase-6-the-instruction-table-model">Phase 6: The instruction table model</h2>

<p>Now, things get a little trickier because this model will reference the recipe<br>
model. Here&apos;s the specification for the &quot;instructions&quot; table.</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Column Type</th>
<th>Constraints</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>SERIAL</td>
<td>PK</td>
</tr>
<tr>
<td>specification</td>
<td>TEXT</td>
<td>NOT NULL</td>
</tr>
<tr>
<td>listOrder</td>
<td>INTEGER</td>
<td>NOT NULL</td>
</tr>
<tr>
<td>recipeId</td>
<td>INTEGER</td>
<td>FK, NOT NULL</td>
</tr>
</tbody>
</table>
<p>When you type out your migration generation command, the &quot;--attributes&quot;<br>
parameter will look like this:</p>
<pre data-role="codeBlock" data-info class="language-"><code>--attributes column1:type1,column2:type2,column3:type3
</code></pre><p>Instead of using &quot;string&quot; for the &quot;specification&quot; column of the table, use<br>
&quot;text&quot; to generate a TEXT column.</p>
<p>After it generates the migration file, modify each of the column descriptors in<br>
the migration so that the columns are not nullable. Then, add a new property<br>
to the one for &quot;recipeId&quot; called &quot;references&quot; that is an object that contains<br>
a &quot;model&quot; property set to &quot;Recipes&quot;. It should look like this.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">recipeId<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  references<span class="token punctuation">:</span> <span class="token punctuation">{</span> model<span class="token punctuation">:</span> <span class="token string">&quot;Recipes&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</pre><p>With that in place, run the migration. Then, check the table definition in your<br>
PostgreSQL client.</p>
<pre data-role="codeBlock" data-info class="language-"><code>                   Table &quot;public.Instructions&quot;
    Column     |           Type           | Nullable |     Default
---------------+--------------------------+----------+-----------------
 id            | integer                  | not null | nextval(&apos;&quot;Ins...
 specification | text                     | not null |
 listOrder     | integer                  | not null |
 recipeId      | integer                  | not null |
 createdAt     | timestamp with time zone | not null |
 updatedAt     | timestamp with time zone | not null |
Indexes:
    &quot;Instructions_pkey&quot; PRIMARY KEY, btree (id)
Foreign-key constraints:
    &quot;Instructions_recipeId_fkey&quot; FOREIGN KEY (&quot;recipeId&quot;)
                                 REFERENCES &quot;Recipes&quot;(id)
</code></pre><p>You should see all non-null columns and a foreign key between the &quot;Instructions&quot;<br>
table and the &quot;Recipes&quot; table.</p>
<h2 class="mume-header" id="phase-7-the-ingredients-model">Phase 7: The ingredients model</h2>

<p>The model for ingredients has <em>two</em> foreign keys. Create the model and migration<br>
for it. Here&apos;s the table specification.</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Column Type</th>
<th>Constraints</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>SERIAL</td>
<td>PK</td>
</tr>
<tr>
<td>amount</td>
<td>NUMERIC(5, 2)</td>
<td>NOT NULL</td>
</tr>
<tr>
<td>measurementUnitId</td>
<td>INTEGER</td>
<td>FK, NOT NULL</td>
</tr>
<tr>
<td>foodStuff</td>
<td>VARCHAR(500)</td>
<td>NOT NULL</td>
</tr>
<tr>
<td>recipeId</td>
<td>INTEGER</td>
<td>FK, NOT NULL</td>
</tr>
</tbody>
</table>
<p>After you modify and run your migration, you should have a table in your<br>
database that looks like this, with two foreign keys, one to the &quot;Recipes&quot;<br>
table and the other to the &quot;MeasurementUnits&quot; table.</p>
<pre data-role="codeBlock" data-info class="language-"><code>                       Table &quot;public.Ingredients&quot;
      Column       |           Type           | Nullable |      Default
-------------------+--------------------------+----------+-----------------
 id                | integer                  | not null | nextval(&apos;&quot;Ing...
 amount            | numeric(5,2)             | not null |
 measurementUnitId | integer                  | not null |
 foodStuff         | character varying(500)   | not null |
 recipeId          | integer                  | not null |
 createdAt         | timestamp with time zone | not null |
 updatedAt         | timestamp with time zone | not null |
Indexes:
    &quot;Ingredients_pkey&quot; PRIMARY KEY, btree (id)
Foreign-key constraints:
    &quot;Ingredients_measurementUnitId_fkey&quot;
        FOREIGN KEY (&quot;measurementUnitId&quot;)
        REFERENCES &quot;MeasurementUnits&quot;(id)
    &quot;Ingredients_recipeId_fkey&quot;
        FOREIGN KEY (&quot;recipeId&quot;)
        REFERENCES &quot;Recipes&quot;(id)
</code></pre><h2 class="mume-header" id="phase-8-seed-data-for-all-of-the-tables">Phase 8: Seed data for all of the tables</h2>

<p>Now that you have tables in the database, it&apos;s time to create some seed data for<br>
all of them. In the <strong>data-access-layer</strong> directory, you will find three text<br>
files each containing JavaScript objects on each row that match the tables<br>
in the previous three sections.</p>
<p>If you didn&apos;t seed the MeasurementUnits data in the correct order listed in the<br>
section above, you may have to redo that seed file, because the data from the<br>
text files depends on the ids of the data in the <code>MeasurementUnits</code> table being<br>
correct.</p>
<p>There are three tables to seed: Ingredients, Instructions, and Recipes. It is<br>
important to note that you will need to seed them in the correct order due to<br>
foreign key dependencies.</p>
<p>Look at the data model for the application, again.</p>
<p><img src="images/sql-recipe-box-data-model.png" alt="recipe box data model"></p>
<p>You can see that the Instructions depends on Recipes because it has the foreign<br>
key &quot;recipeId&quot; to the Recipes table. You can also see that the Ingredients table<br>
has dependencies on the Recipes and MeasurementUnits tables because of its<br>
foreign keys &quot;measurementUnitId&quot; and &quot;recipeId&quot;. (You&apos;ve already seeded the<br>
MeasurementUnits table in Phase 4, so that data exists for use by the<br>
Ingredients table.) Recipes does not have any foreign keys. You need to seed<br>
Recipes, first, because it does not have any foreign keys and, therefore, does<br>
not have any data dependencies. Then, you can seed the Instructions and<br>
Ingredients tables in either order because their data dependencies will have<br>
been met.</p>
<p>Create seeder files for them in that order: Recipes, first, then Ingredients and<br>
Instructions. Use the contents of each of the text files in<br>
<strong>data-access-layer</strong> to do bulk inserts.</p>
<p>After you create each seed file, run</p>
<pre data-role="codeBlock" data-info class="language-"><code>npx sequelize-cli db:seed:all
</code></pre><p>to make sure you don&apos;t have any errors. If you do, fix them before moving onto<br>
the next seed file.</p>
<p>If you end up seeding the data in the wrong order and getting a foreign key<br>
constraint error, just use the CLI to drop the database, create the database,<br>
migrate the database, and then you can try running your seeders, again. You may<br>
need to rename your migration filenames to get your seeds running in the<br>
correct order.</p>
<h2 class="mume-header" id="phase-9-updating-models-with-references">Phase 9: Updating models with references</h2>

<p>Now that you have all of the migrations set up correctly and a database defined,<br>
it is time for you to turn your attention to the model files that were<br>
generated in the previous phases.</p>
<p>Consider the relationship between an Instruction and a Recipe. A Recipe <em>has<br>
many</em> Instructions. In the other direction, you would say that an Instruction<br>
<em>has one</em> Recipe, or that Instruction <em>belongs to</em> the Recipe. To set that up in<br>
your model, open the file <strong>models/recipe.js</strong>. In there, you will see the<br>
following.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Recipe <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Recipe&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Recipe<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Recipe<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>In the <code>associate</code> function is where you can define the association between the<br>
Recipe and the Instruction. Replace the comment with the following statement.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">Recipe<span class="token punctuation">.</span><span class="token function">hasMany</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Instruction<span class="token punctuation">,</span> <span class="token punctuation">{</span> foreignKey<span class="token punctuation">:</span> <span class="token string">&apos;recipeId&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This instructs Sequelize that Recipe should have a collection of Instruction<br>
objects associated with it. To insure that Sequelize uses the foreign key column<br>
that you created on the &quot;Instructions&quot; table in your migration, you must specify<br>
it as part of the collection definition.</p>
<p>In the file <strong>models/instruction.js</strong>, replace the comment with the following to<br>
define the other side of the relationship.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">Instruction<span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Recipe<span class="token punctuation">,</span> <span class="token punctuation">{</span> foreignKey<span class="token punctuation">:</span> <span class="token string">&apos;recipeId&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This instructs Sequelize that Instruction has a single Recipe object associated<br>
with it. Again, because of inconsistent naming conventions used by Sequelize,<br>
you must specify the foreign key column name in the &quot;Instructions&quot; table.</p>
<p>Think about the many-to-one and one-to-many relationships between Ingredient,<br>
MeasurementUnit, and Recipe. Then, modify those model files accordingly with<br>
the <code>hasMany</code> and <code>belongsTo</code> associations, always specifying the name of the<br>
foreign key column that binds the two tables together.</p>
<h2 class="mume-header" id="phase-10-updating-models-with-validations">Phase 10: Updating models with validations</h2>

<p>Now that you have seed data created, it will be important to prevent users from<br>
entering data that does not meet the expectations of the data model.</p>
<p>Consider the content of <strong>models/instruction.js</strong></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Instruction <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Instruction&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    specification<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">,</span>
    listOrder<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    recipeId<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Instruction<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Instruction<span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Recipe<span class="token punctuation">,</span> <span class="token punctuation">{</span> foreignKey<span class="token punctuation">:</span> <span class="token string">&apos;recipeId&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Instruction<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>It would be nice if the model could validate each of those properties to make<br>
sure that no one sets them to null and that <code>listOrder</code> is greater than 0, for<br>
example. You can do that with <a href="https://sequelize.org/master/manual/validations-and-constraints.html#per-attribute-validations">per-attribute validations</a>.</p>
<p>For example, you can change the above code to the following to make sure that<br>
the &quot;specification&quot; property won&apos;t get set to an empty string when someone tries<br>
to save the object.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Instruction <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Instruction&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    specification<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notEmpty<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    listOrder<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    recipeId<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Instruction<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Instruction<span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Recipe<span class="token punctuation">,</span> <span class="token punctuation">{</span> foreignKey<span class="token punctuation">:</span> <span class="token string">&apos;recipeId&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Instruction<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Make sure all of the other string properties in the models won&apos;t allow the empty<br>
string to be set on them.</p>
<h2 class="mume-header" id="phase-11-cascade-delete-for-recipes">Phase 11: Cascade delete for recipes</h2>

<p>The Recipe model has dependencies: the Instruction and the Ingredient both have<br>
<em>belongs to</em> relationships. This means that the row in the &quot;Recipes&quot; table must<br>
exist to have records in the &quot;Ingredients&quot; and &quot;Instructions&quot; table. If you try<br>
to delete a Recipe row from the database that has either Instructions or<br>
Ingredients, it won&apos;t work due to referential integrity. You would have to<br>
delete all of the Ingredients and Instructions <em>before</em> being able to delete the<br>
Recipe.</p>
<p>Sequelize provides a handy shortcut for that and will manage deleting the<br>
associated records for you when you delete a row from the Recipes table. It&apos;s<br>
called a <em>cascading delete</em>. Open the <strong>models/recipe.js</strong> file. In there,<br>
modify the second argument of each of the <code>hasMany</code> calls to include two new<br>
property/value pairs:</p>
<ul>
<li><code>onDelete: &apos;CASCADE&apos;</code></li>
<li><code>hooks: true</code></li>
</ul>
<p>Refer to the documentation on <a href="https://sequelize.org/master/manual/hooks.html#associations">Associations</a> to see an example. But, don&apos;t<br>
delete the <code>foreignKey</code> property that you put there in Phase 9.</p>
<h2 class="mume-header" id="phase-12-building-the-repositories">Phase 12: Building the repositories</h2>

<p>Now that you have the seeds, models, and migrations out of the way, you can<br>
build the data access layer with a lot of speed. Sequelize will now handle all<br>
of the SQL generation for you. You can just use the models that you&apos;ve<br>
painstakingly crafted.</p>
<p>Because you are writing JavaScript files, you want the server to restart because<br>
it won&apos;t automatically reload the changed JavaScript that you&apos;re writing. To<br>
that end, you will use a different command while developing.</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm run dev
</code></pre><p>This runs a special script that will reload the JavaScript in the data access<br>
layer every time you make a change. You can see what&apos;s run in the<br>
<strong>package.json</strong> file in this project in the &quot;scripts&quot; section for the &quot;dev&quot;<br>
property.</p>
<p>You will work in the three files named</p>
<ul>
<li><strong>recipes-repository.js</strong>: The collection of functions needed to interact with<br>
recipes for the application</li>
<li><strong>instructions-repository.js</strong>: The collection of functions needed to interact<br>
with the instructions for the application</li>
<li><strong>ingredients-repository.js</strong>: The collection of functions needed to interact<br>
with the ingredients for the application</li>
</ul>
<p>Each of the files imports your models and makes them available to you. Then,<br>
you can use them in your querying. Follow the hints in each of the repository<br>
functions.</p>

      </div>
      <div class="md-sidebar-toc"><ul>
<li><a href="#make-it-pretty-learning-objectives">Make It Pretty Learning Objectives</a></li>
<li><a href="#make-it-pretty-practice">Make It Pretty Practice</a>
<ul>
<li><a href="#what-recruiters-are-looking-for">What Recruiters Are Looking For</a></li>
<li><a href="#attributes-of-great-looking-websites">Attributes of Great Looking Websites</a></li>
<li><a href="#additional-requirements">Additional requirements</a></li>
<li><a href="#avoid-these-things">Avoid these things</a></li>
<li><a href="#exercise">Exercise</a></li>
</ul>
</li>
<li><a href="#rdbms-and-database-entity-learning-objectives">RDBMS And Database Entity Learning Objectives</a></li>
<li><a href="#database-lingobrthe-relational-database-management-system">Database Lingo<br><em>The Relational Database Management System</em></a>
<ul>
<li><a href="#rdbms">RDBMS</a></li>
<li><a href="#what-is-postgresql">What is PostgreSQL?</a></li>
<li><a href="#what-is-sql">What is SQL?</a></li>
<li><a href="#what-we-learned">What we learned:</a></li>
</ul>
</li>
<li><a href="#installing-postgresql-12-and-postbird-on-windows">Installing PostgreSQL 12 and Postbird on Windows</a>
<ul>
<li><a href="#installing-postgresql-12">Installing PostgreSQL 12</a></li>
<li><a href="#installing-postgresql-client-tools-on-ubuntu">Installing PostgreSQL Client Tools on Ubuntu</a></li>
<li><a href="#configuring-the-client-tools">Configuring the client tools</a></li>
<li><a href="#installing-postbird">Installing Postbird</a></li>
<li><a href="#what-you-did">What you did</a></li>
</ul>
</li>
<li><a href="#installing-postgresql-12-and-postbird-on-macos">Installing PostgreSQL 12 and Postbird on macOS</a>
<ul>
<li><a href="#installing-postgresql-12-1">Installing PostgreSQL 12</a></li>
<li><a href="#configuring-postgresql-12">Configuring PostgreSQL 12</a></li>
<li><a href="#connecting-to-postgresql">Connecting to PostgreSQL</a></li>
<li><a href="#installing-postbird-1">Installing Postbird</a></li>
<li><a href="#what-you-did-1">What you did</a></li>
</ul>
</li>
<li><a href="#user-management-walk-through">User Management Walk-Through</a>
<ul>
<li><a href="#naming-a-user">Naming a user</a></li>
<li><a href="#creating-a-superuser">Creating a superuser</a></li>
<li><a href="#creating-a-limited-user">Creating a limited user</a></li>
<li><a href="#removing-a-user">Removing a user</a></li>
<li><a href="#case-sensitivity">Case sensitivity</a></li>
<li><a href="#what-you-learned">What you learned</a></li>
</ul>
</li>
<li><a href="#database-management-walk-through">Database Management Walk-Through</a>
<ul>
<li><a href="#naming-a-database">Naming a database</a></li>
<li><a href="#creating-a-database-for-your-user">Creating a database for your user</a></li>
<li><a href="#creating-other-users-and-databases">Creating other users and databases</a></li>
<li><a href="#applying-security-to-databases">Applying security to databases</a></li>
<li><a href="#listing-databases-and-granting-privileges">Listing databases and granting privileges</a></li>
<li><a href="#time-to-clean-up">Time to clean up</a></li>
<li><a href="#what-youve-done">What you&apos;ve done</a></li>
</ul>
</li>
<li><a href="#table-management-walk-through-part-i">Table Management Walk-Through -  Part I</a>
<ul>
<li><a href="#what-is-a-table">What is a table?</a></li>
<li><a href="#defining-tables">Defining tables</a>
<ul>
<li><a href="#string-types">String types</a></li>
<li><a href="#numeric-types">Numeric types</a></li>
</ul>
</li>
<li><a href="#other-data-types">Other data types</a></li>
<li><a href="#naming-a-table">Naming a table</a></li>
<li><a href="#writing-the-sql">Writing the SQL</a></li>
<li><a href="#listing-tables-and-table-definitions">Listing tables and table definitions</a></li>
<li><a href="#deleting-a-table">Deleting a table</a></li>
<li><a href="#what-youve-done-1">What you&apos;ve done</a></li>
</ul>
</li>
<li><a href="#table-management-walk-through-part-ii">Table Management Walk-Through - Part II</a>
<ul>
<li><a href="#nullable-columns">Nullable columns</a></li>
<li><a href="#default-values">Default values</a></li>
<li><a href="#primary-keys">Primary keys</a></li>
<li><a href="#unique-values">Unique values</a></li>
<li><a href="#refactor-for-data-integrity">Refactor for data integrity</a></li>
<li><a href="#order-of-table-declarations">Order of table declarations</a></li>
<li><a href="#what-youve-done-2">What you&apos;ve done</a></li>
</ul>
</li>
<li><a href="#database-management-project">Database Management Project</a>
<ul>
<li><a href="#instructions">Instructions</a></li>
</ul>
</li>
<li><a href="#sql-learning-objectives">SQL Learning Objectives</a></li>
<li><a href="#retrieving-rows-from-a-table-using-select">Retrieving Rows From A Table Using SELECT</a>
<ul>
<li><a href="#what-is-a-query">What is a query?</a></li>
<li><a href="#example-table">Example table</a></li>
<li><a href="#using-psql-in-the-terminal">Using psql in the terminal</a></li>
<li><a href="#simple-select-query">Simple SELECT Query</a>
<ul>
<li><a href="#select-all-rows">SELECT all rows</a></li>
<li><a href="#select-by-column">SELECT by column</a></li>
<li><a href="#select-multiple-columns">SELECT multiple columns</a></li>
</ul>
</li>
<li><a href="#formatting-select-statements">Formatting SELECT statements</a></li>
<li><a href="#what-we-learned-1">What we learned:</a></li>
</ul>
</li>
<li><a href="#selecting-table-rows-using-where-and-common-operators">Selecting Table Rows Using WHERE And Common Operators</a>
<ul>
<li><a href="#using-select-and-where">Using SELECT and WHERE</a>
<ul>
<li><a href="#where-clause-for-a-single-value">WHERE clause for a single value</a></li>
<li><a href="#where-clause-for-a-list-of-values">WHERE clause for a list of values</a></li>
</ul>
</li>
<li><a href="#what-we-learned-2">What we learned:</a></li>
</ul>
</li>
<li><a href="#inserting-data-into-a-table">Inserting Data Into A Table</a>
<ul>
<li><a href="#what-we-learned-3">What we learned:</a></li>
</ul>
</li>
<li><a href="#foreign-keys-and-the-join-operation">Foreign Keys And The JOIN Operation</a>
<ul>
<li><a href="#setting-up-the-database">Setting up the database</a></li>
<li><a href="#using-join-to-retrieve-rows-from-multiple-tables">Using JOIN to retrieve rows from multiple tables</a></li>
<li><a href="#what-we-learned-4">What we learned:</a></li>
<li><a href="#helpful-links">Helpful links:</a></li>
</ul>
</li>
<li><a href="#writing-and-running-a-seed-file-in-psql">Writing And Running A Seed File In PSQL</a>
<ul>
<li><a href="#creating-a-seed-file">Creating a seed file</a></li>
<li><a href="#populating-a-database-via-left-caret">Populating a database via &lt; (&#x201C;left caret&#x201D;)</a></li>
<li><a href="#populating-the-database-via-pipe">Populating the database via | (&#x201C;pipe&#x201D;)</a></li>
<li><a href="#what-we-learned-5">What we learned:</a></li>
</ul>
</li>
<li><a href="#create-and-seed-a-database-project">Create And Seed A Database Project</a>
<ul>
<li><a href="#project-overview">Project overview</a></li>
<li><a href="#phase-1-create-a-new-database">Phase 1: Create a new database</a></li>
<li><a href="#phase-2-create-a-seeds-seed-file">Phase 2: Create a seeds seed file</a></li>
<li><a href="#phase-3-pipe-your-seed-file-into-your-new-database">Phase 3: Pipe your seed file into your new database</a>
<ul>
<li><a href="#method-1-seed-your-database-via-caret-method">Method 1. Seed your database via caret method</a></li>
<li><a href="#method-2-seed-your-database-via-pipe-method">Method 2. Seed your database via pipe method</a></li>
<li><a href="#if-you-want-to-seed-using-the-file-again-you-need-to-first-drop-the-tables">If you want to seed using the file again, you need to first drop the tables.</a></li>
<li><a href="#check-to-make-sure-your-seed-file-has-actually-updated-the-farm-database">Check to make sure your seed file has actually updated the <code>farm</code> database</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#solving-the-sql-menagerie-project">Solving The SQL Menagerie Project</a>
<ul>
<li><a href="#getting-started">Getting started</a></li>
<li><a href="#project-overview-1">Project overview</a></li>
<li><a href="#phase-1-pipe-in-a-seed-file-to-create-new-database-tables">Phase 1: Pipe in a seed file to create new database tables</a></li>
<li><a href="#phase-2-write-basic-select-statements">Phase 2: Write basic SELECT statements</a></li>
<li><a href="#phase-3-add-where-clauses">Phase 3: Add WHERE clauses</a></li>
<li><a href="#phase-4-use-a-join-operation">Phase 4: Use a JOIN operation</a></li>
<li><a href="#bonuses">Bonuses</a></li>
</ul>
</li>
<li><a href="#creating-a-schema-for-relational-database-design">Creating A Schema For Relational Database Design</a>
<ul>
<li><a href="#what-is-relational-database-design">What is Relational Database Design?</a></li>
<li><a href="#stages-of-relational-database-design">Stages of Relational Database Design</a>
<ul>
<li><a href="#1-define-database-purpose-and-entities">1. Define database purpose and entities</a></li>
<li><a href="#2-identify-primary-keys">2. Identify primary keys</a></li>
<li><a href="#3-establish-table-relationships">3. Establish table relationships</a></li>
<li><a href="#4-apply-normalization-rules">4. Apply normalization rules</a></li>
</ul>
</li>
<li><a href="#schema-design-tools">Schema design tools</a></li>
<li><a href="#what-we-learned-6">What we learned:</a></li>
</ul>
</li>
<li><a href="#using-sql-transactions">Using SQL Transactions</a>
<ul>
<li><a href="#what-is-a-transaction">What is a transaction?</a></li>
<li><a href="#implicit-vs-explicit-transactions">Implicit vs. explicit transactions</a>
<ul>
<li><a href="#postgresql-transactional-commands">PostgreSQL transactional commands</a></li>
</ul>
</li>
<li><a href="#when-to-use-transactions-and-why">When to use transactions and why</a></li>
<li><a href="#transaction-properties-acid">Transaction properties: ACID</a>
<ul>
<li><a href="#banking-transaction-example">Banking transaction example</a></li>
</ul>
</li>
<li><a href="#helpful-links-1">Helpful links:</a></li>
</ul>
</li>
<li><a href="#joins-vs-subqueries">Joins vs. Subqueries</a>
<ul>
<li><a href="#what-is-a-join">What is a JOIN?</a></li>
<li><a href="#what-is-a-subquery">What is a subquery?</a>
<ul>
<li><a href="#single-value-subquery">Single-value subquery</a></li>
<li><a href="#multiple-row-subquery">Multiple-row subquery</a></li>
</ul>
</li>
<li><a href="#using-joins-vs-subqueries">Using joins vs. subqueries</a>
<ul>
<li><a href="#should-i-use-a-join-or-a-subquery">Should I use a JOIN or a subquery?</a></li>
</ul>
</li>
<li><a href="#helpful-links-2">Helpful links:</a></li>
</ul>
</li>
<li><a href="#postgresql-indexes">PostgreSQL Indexes</a>
<ul>
<li><a href="#what-is-a-postgresql-index">What is a PostgreSQL index?</a></li>
<li><a href="#how-to-create-an-index">How to create an index</a>
<ul>
<li><a href="#types-of-indexes">Types of indexes</a></li>
</ul>
</li>
<li><a href="#when-to-use-an-index">When to use an index</a></li>
<li><a href="#helpful-links-3">Helpful links:</a></li>
<li><a href="#what-we-learned-7">What we learned:</a></li>
</ul>
</li>
<li><a href="#node-postgres-and-prepared-statements">Node-Postgres And Prepared Statements</a>
<ul>
<li><a href="#connecting">Connecting</a></li>
<li><a href="#prepared-statement">Prepared Statement</a></li>
<li><a href="#try-it-out-for-yourself">Try it out for yourself</a></li>
<li><a href="#what-youve-learned">What you&apos;ve learned</a></li>
</ul>
</li>
<li><a href="#recipe-box-project">Recipe Box Project</a>
<ul>
<li><a href="#the-data-model-analysis">The data model analysis</a></li>
<li><a href="#getting-started-1">Getting started</a></li>
<li><a href="#your-sql">Your SQL</a></li>
<li><a href="#the-application">The application</a></li>
<li><a href="#directions">Directions</a>
<ul>
<li><a href="#home-page">Home Page</a></li>
<li><a href="#recipesid"><code>/recipes/:id</code></a></li>
<li><a href="#recipesnew"><code>/recipes/new</code></a></li>
<li><a href="#recipesidedit"><code>/recipes/:id/edit</code></a></li>
<li><a href="#recipestermsearchterm"><code>/recipes?term={searchTerm}</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orm-learning-objectives">ORM Learning Objectives</a></li>
<li><a href="#installing-and-using-sequelize">Installing And Using Sequelize</a>
<ul>
<li><a href="#what-is-an-orm">What Is An ORM?</a></li>
<li><a href="#how-to-install-sequelize">How To Install Sequelize</a></li>
<li><a href="#how-to-initialize-sequelize">How To Initialize Sequelize</a></li>
<li><a href="#verifying-that-sequelize-can-connect-to-the-database">Verifying That Sequelize Can Connect To The Database</a></li>
<li><a href="#our-preexisting-database-schema">Our Preexisting Database Schema</a></li>
<li><a href="#using-sequelize-to-generate-the-model-file">Using Sequelize To Generate The Model File</a></li>
<li><a href="#examining-and-modifying-a-sequelize-model-file">Examining (And Modifying) A Sequelize Model File</a></li>
<li><a href="#using-the-cat-model-to-fetch-and-update-sql-data">Using The <code>Cat</code> Model To Fetch And Update SQL Data</a></li>
<li><a href="#reading-and-changing-record-attributes">Reading And Changing Record Attributes</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li><a href="#using-database-migrations">Using Database Migrations</a>
<ul>
<li><a href="#sequelize-migration-files">Sequelize Migration Files</a></li>
<li><a href="#running-a-migration">Running A Migration</a></li>
<li><a href="#rolling-back-a-migration">Rolling Back A Migration</a></li>
<li><a href="#editing-a-migration-file">Editing A Migration File</a></li>
<li><a href="#up-and-down-are-asynchronous"><code>up</code> And <code>down</code> are Asynchronous</a></li>
<li><a href="#writing-a-down-method">Writing A <code>down</code> Method</a></li>
<li><a href="#advantages-of-migrations">Advantages Of Migrations</a></li>
<li><a href="#conclusion-1">Conclusion</a></li>
</ul>
</li>
<li><a href="#crud-operations-using-sequelize">CRUD Operations Using Sequelize</a>
<ul>
<li><a href="#creating-a-new-record">Creating A New Record</a></li>
<li><a href="#reading-a-record-by-primary-key">Reading A Record By Primary Key</a></li>
<li><a href="#updating-a-record">Updating A Record</a></li>
<li><a href="#destroying-a-record">Destroying A Record</a></li>
<li><a href="#class-methods-for-crud">Class Methods For CRUD</a></li>
<li><a href="#conclusion-2">Conclusion</a></li>
</ul>
</li>
<li><a href="#querying-using-sequelize">Querying Using Sequelize</a>
<ul>
<li><a href="#basic-usage-of-findall-to-retrieve-multiple-records">Basic Usage Of <code>findAll</code> To Retrieve Multiple Records</a></li>
<li><a href="#using-findall-to-find-objects-not-matching-a-criterion">Using <code>findAll</code> To Find Objects Not Matching A Criterion</a></li>
<li><a href="#combining-criteria-with-opand">Combining Criteria with <code>Op.and</code></a></li>
<li><a href="#combining-criteria-with-opor">Combining Criteria with <code>Op.or</code></a></li>
<li><a href="#querying-with-comparisons">Querying With Comparisons</a></li>
<li><a href="#ordering-results">Ordering Results</a></li>
<li><a href="#limiting-results-and-findone">Limiting Results and <code>findOne</code></a></li>
<li><a href="#conclusion-3">Conclusion</a></li>
</ul>
</li>
<li><a href="#model-validations-with-sequelize">Model Validations With Sequelize</a>
<ul>
<li><a href="#validating-that-an-attribute-is-not-null">Validating That An Attribute Is Not <code>NULL</code></a></li>
<li><a href="#the-notempty-validation">The <code>notEmpty</code> Validation</a></li>
<li><a href="#forbidding-long-string-values">Forbidding Long String Values</a></li>
<li><a href="#validating-that-a-numeric-value-is-within-a-specified-range">Validating That A Numeric Value Is Within A Specified Range</a></li>
<li><a href="#validating-that-an-attribute-is-among-a-finite-set-of-values">Validating That An Attribute Is Among A Finite Set Of Values</a></li>
<li><a href="#conclusion-4">Conclusion</a></li>
</ul>
</li>
<li><a href="#transactions-with-sequelize">Transactions With Sequelize</a>
<ul>
<li><a href="#the-problem-database-updates-can-fail">The Problem: Database Updates Can Fail</a></li>
<li><a href="#the-solution-database-transactions">The Solution: Database Transactions</a></li>
<li><a href="#the-bankaccounts-schema">The <code>BankAccounts</code> Schema</a></li>
<li><a href="#example-an-update-fails-because-of-validation-failure">Example: An Update Fails Because Of Validation Failure</a></li>
<li><a href="#incorrect-solutions">Incorrect Solutions</a></li>
<li><a href="#using-a-database-transaction-with-sequelize">Using A Database Transaction With Sequelize</a></li>
<li><a href="#aside-what-is-the-transaction-object">Aside: What Is The <code>Transaction</code> Object?</a></li>
<li><a href="#transactions-prevent-_race-conditions_">Transactions Prevent <em>Race Conditions</em></a></li>
<li><a href="#conclusion-5">Conclusion</a></li>
</ul>
</li>
<li><a href="#recipe-box-with-sequelize-project">Recipe Box With Sequelize Project</a>
<ul>
<li><a href="#the-data-model-analysis-1">The data model analysis</a></li>
<li><a href="#the-application-1">The application</a></li>
<li><a href="#getting-started-2">Getting started</a></li>
<li><a href="#your-code">Your code</a></li>
<li><a href="#phase-1-initialize-the-sequelize-project">Phase 1: Initialize the Sequelize project</a></li>
<li><a href="#phase-2-create-a-database-user-for-the-project">Phase 2: Create a database user for the project</a></li>
<li><a href="#phase-2-change-the-connection-configuration">Phase 2: Change the connection configuration</a></li>
<li><a href="#phase-3-create-your-database">Phase 3: Create your database</a></li>
<li><a href="#phase-4-the-units-of-measurement-data">Phase 4: The units of measurement data</a>
<ul>
<li><a href="#create-a-migration">Create a migration</a></li>
</ul>
</li>
<li><a href="#run-your-migration">Run your migration</a></li>
<li><a href="#create-the-seed-data">Create the seed data</a></li>
<li><a href="#phase-5-the-recipe-table-model">Phase 5: The recipe table model</a></li>
<li><a href="#phase-6-the-instruction-table-model">Phase 6: The instruction table model</a></li>
<li><a href="#phase-7-the-ingredients-model">Phase 7: The ingredients model</a></li>
<li><a href="#phase-8-seed-data-for-all-of-the-tables">Phase 8: Seed data for all of the tables</a></li>
<li><a href="#phase-9-updating-models-with-references">Phase 9: Updating models with references</a></li>
<li><a href="#phase-10-updating-models-with-validations">Phase 10: Updating models with validations</a></li>
<li><a href="#phase-11-cascade-delete-for-recipes">Phase 11: Cascade delete for recipes</a></li>
<li><a href="#phase-12-building-the-repositories">Phase 12: Building the repositories</a></li>
</ul>
</li>
</ul>
</div>
      <a id="sidebar-toc-btn">&#x2261;</a>
    
    
    
    
    
    
    
    
<script>

var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </body></html>