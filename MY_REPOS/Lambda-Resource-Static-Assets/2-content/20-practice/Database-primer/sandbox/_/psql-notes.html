<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>psql-notes</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h2 id="rdbms">RDBMS</h2>
<p>That’s quite an ugly acronym, but it’s what developers have when referring to the software application that manages databases for us. Here’s an important difference for you to understand.</p>
<p>The <strong>RDBMS</strong> is a software application that you run that your programs can connect to that they can store, modify, and retrieve data. The RDBS that you will use in this course is called <a href="https://www.postgresql.org/">PostgreSQL</a>, often shortened to just “postgres”, pronounced like it’s spelled. It is an “open-source” RDBMS which means that you can go read the source code for it, copy it, modify it, and make your own specialized version of an RDBMS. Often, developers will talk about the “database server”. That is the computer on which the RDBMS is running.</p>
<p>A <strong>database</strong> (or more properly <strong>relational database</strong>) is a collection of structured data that the RDBMS manages for you. A single running RDBMS can have hundreds of databases in it that it manages.</p>
<h2 id="what-is-postgresql">What is PostgreSQL?</h2>
<p>Again, PostgreSQL is software. Specifically, it is an open-source, relational database management system. It is derived from the POSTGRES package written at UC Berkeley. The specific name “PostgreSQL” was coined in 1996, after SQL was implemented as its core query language. PostgreSQL provided a new program (new for 1996) for interactive SQL queries called <code>[psql]</code>, which is terminal-based front-end to PostgreSQL that lets you to type in queries interactively, issue them to PostgreSQL, and see the query results.</p>
<p>When you do connect with it, you will interact with it through a small set of its own commands and SQL.</p>
<h2 id="what-is-sql">What is SQL?</h2>
<p>SQL (pronounced “sequel” or “s-q-l”) stands for “Structured Query Language”. It is not a programming language like JavaScript. JavaScript, as you well know, has <em>control flow</em>, with <code>for</code> loops and <code>if</code> statements. Most SQL that you write doesn’t have all that. Instead, it is a <em>declarative</em> programming language. You tell the database what computation you want it to do, and it does it.</p>
<h1 id="sql-structured-query-language-in-one-page">SQL (Structured Query Language) in one page</h1>
<table>
<caption>
Data Types
</caption>
<tbody>
<tr>
<th>
Data Type
</th>
<th>
Description
</th>
</tr>
<tr>
<td>
integer(size)
</td>
<td rowspan="4">
    Hold integers only. The maximum number of digits are specified in parenthesis.
</td>
</tr>
<tr>
<td>
int(size)
</td>
</tr>
<tr>
<td>
smallint(size)
</td>
</tr>
<tr>
<td>
tinyint(size)
</td>
</tr>
<tr>
<td>
decimal(size,d)
</td>
<td rowspan="2">
    Hold numbers with fractions. The maximum number of digits are specified in “size”. The maximum number of digits to the right of the decimal is specified in “d”.
</td>
</tr>
<tr>
<td>
numeric(size,d)
</td>
</tr>
<tr>
<td>
char(size)
</td>
<td>
    Holds a fixed length string (can contain letters, numbers, and special characters). The fixed size is specified in parenthesis.
</td>
</tr>
<tr>
<td>
varchar(size)
</td>
<td>
    Holds a variable length string (can contain letters, numbers, and special characters). The maximum size is specified in parenthesis.
</td>
</tr>
<tr>
<td>
date(yyyymmdd)
</td>
<td>
    Holds a date
</td>
</tr>
</tbody>
</table>
<pre><code>ALTER TABLE table\_name ADD column\_name datatype       Add columns in an existing table. ALTER TABLE Person ADD Sex char(6) ALTER TABLE table\_name DROP column\_name datatype       Delete columns in an existing table. ALTER TABLE Person DROP Sex char(6) DROP TABLE table\_name       Delete a table. DROP TABLE Person  Index Manipulation CREATE INDEX index\_name
ON table\_name (column\_name\_1, column\_name\_2, ...)       Create a simple index. CREATE INDEX PersonIndex
ON Person (LastName, FirstName) CREATE UNIQUE INDEX index\_name
ON table\_name (column\_name\_1, column\_name\_2, ...)       Create a unique index. CREATE UNIQUE INDEX PersonIndex
ON Person (LastName DESC) DROP INDEX table\_name.index\_name       Delete a index. DROP INDEX Person.PersonIndex  Data Manipulation INSERT INTO table\_name
VALUES (value\_1, value\_2,....)       Insert new rows into a table. INSERT INTO Persons
VALUES(&#39;Hussein&#39;, &#39;Saddam&#39;, &#39;White House&#39;) INSERT INTO table\_name (column1, column2,...)
VALUES (value\_1, value\_2,....) INSERT INTO Persons (LastName, FirstName, Address)
VALUES(&#39;Hussein&#39;, &#39;Saddam&#39;, &#39;White House&#39;) UPDATE table\_name
SET column\_name\_1 = new\_value\_1, column\_name\_2 = new\_value\_2
WHERE column\_name = some\_value       Update one or several columns in rows. UPDATE Person
SET Address = &#39;ups&#39;
WHERE LastName = &#39;Hussein&#39; DELETE FROM table\_name
WHERE column\_name = some\_value       Delete rows in a table. DELETE FROM Person WHERE LastName = &#39;Hussein&#39; TRUNCATE TABLE table\_name       Deletes the data inside the table. TRUNCATE TABLE Person  Select SELECT column\_name(s) FROM table\_name       Select data from a table. SELECT LastName, FirstName FROM Persons SELECT \* FROM table\_name       Select all data from a table. SELECT \* FROM Persons SELECT DISTINCT column\_name(s) FROM table\_name       Select only distinct (different) data from a table. SELECT DISTINCT LastName, FirstName FROM Persons SELECT column\_name(s) FROM table\_name
WHERE column operator value
      AND column operator value
      OR column operator value
      AND (... OR ...)
      ...       Select only certain data from a table. SELECT \* FROM Persons WHERE sex=&#39;female&#39;
</code></pre>
<table>
<caption>
Operators
</caption>
<tbody>
<tr>
<th>
Operator
</th>
<th>
Description
</th>
</tr>
<tr>
<td>
=
</td>
<td>
    Equal
</td>
</tr>
<tr>
<td>
&lt;&gt;
</td>
<td>
    Not equal
</td>
</tr>
<tr>
<td>
&gt;
</td>
<td>
    Greater than
</td>
</tr>
<tr>
<td>
&lt;
</td>
<td>
    Less than
</td>
</tr>
<tr>
<td>
&gt;=
</td>
<td>
    Greater than or equal
</td>
</tr>
<tr>
<td>
&lt;=
</td>
<td>
    Less than or equal
</td>
</tr>
<tr>
<td>
BETWEEN
</td>
<td>
    Between an inclusive range
</td>
</tr>
<tr>
<td>
LIKE
</td>
<td>
    Search for a pattern.<br>A “%” sign can be used to define wildcards (missing letters in the pattern) both before and after the pattern.
</td>
</tr>
</tbody>
</table>
<pre><code>SELECT \* FROM Persons WHERE Year&gt;1970 SELECT \* FROM Persons
WHERE FirstName=&#39;Saddam&#39;
AND LastName=&#39;Hussein&#39; SELECT \* FROM Persons
WHERE FirstName=&#39;Saddam&#39;
OR LastName=&#39;Hussein&#39; SELECT \* FROM Persons WHERE
(FirstName=&#39;Tove&#39; OR FirstName=&#39;Stephen&#39;)
AND LastName=&#39;Svendson&#39; SELECT \* FROM Persons WHERE FirstName LIKE &#39;O%&#39; SELECT \* FROM Persons WHERE FirstName LIKE &#39;%a&#39; SELECT \* FROM Persons WHERE FirstName LIKE &#39;%la%&#39; SELECT column\_name(s) FROM table\_name
WHERE column\_name IN (value1, value2, ...)       The IN operator may be used if you know the exact value you want to return for at least one of the columns. SELECT \* FROM Persons
WHERE LastName IN (&#39;Hansen&#39;,&#39;Pettersen&#39;) SELECT column\_name(s) FROM table\_name
ORDER BY row\_1, row\_2 DESC, row\_3 ASC, ...       Select data from a table with sort the rows.</code></pre>
<pre class="note:"><code>
*   ASC (ascend) is a alphabetical and numerical order (optional)
*   DESC (descend) is a reverse alphabetical and numerical order

SELECT \* FROM Persons
ORDER BY LastName SELECT FirstName, LastName FROM Persons
ORDER BY LastName DESC SELECT Company, OrderNumber FROM Orders
ORDER BY Company DESC, OrderNumber ASC SELECT column\_1, ..., SUM(group\_column\_name)
FROM table\_name
GROUP BY group\_column\_name       GROUP BY... was added to SQL because aggregate functions (like SUM) return the aggregate of all column values every time they are called, and without the GROUP BY function it was impossible to find the sum for each individual group of column values. SELECT Company, SUM(Amount)
FROM Sales
GROUP BY Company

&lt;table&gt;&lt;caption&gt;Some aggregate functions&lt;/caption&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th&gt;Function&lt;/th&gt;&lt;th&gt;Description&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;AVG(column)&lt;/td&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Returns the average value of a column&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;COUNT(column)&lt;/td&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Returns the number of rows (without a NULL value) of a column&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;MAX(column)&lt;/td&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Returns the highest value of a column&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;MIN(column)&lt;/td&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Returns the lowest value of a column&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;SUM(column)&lt;/td&gt;&lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Returns the total sum of a column&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;

SELECT column\_1, ..., SUM(group\_column\_name)
FROM table\_name
GROUP BY group\_column\_name
HAVING SUM(group\_column\_name) condition value       HAVING... was added to SQL because the WHERE keyword could not be used against aggregate functions (like SUM), and without HAVING... it would be impossible to test for result conditions. SELECT Company, SUM(Amount)
FROM Sales
GROUP BY Company
HAVING SUM(Amount)&gt;10000  Alias SELECT column\_name AS column\_alias FROM table\_name Column name alias SELECT LastName AS Family, FirstName AS Name
FROM Persons SELECT table\_alias.column\_name FROM table\_name AS table\_alias Table name alias SELECT LastName, FirstName
FROM Persons AS Employees  Join SELECT column\_1\_name, column\_2\_name, ...
FROM first\_table\_name
INNER JOIN second\_table\_name
ON first\_table\_name.keyfield = second\_table\_name.foreign\_keyfield        The INNER JOIN returns all rows from both tables where there is a match. If there are rows in first table that do not have matches in second table, those rows will not be listed. SELECT Employees.Name, Orders.Product
FROM Employees
INNER JOIN Orders
ON Employees.Employee\_ID=Orders.Employee\_ID SELECT column\_1\_name, column\_2\_name, ...
FROM first\_table\_name
LEFT JOIN second\_table\_name
ON first\_table\_name.keyfield = second\_table\_name.foreign\_keyfield        The LEFT JOIN returns all the rows from the first table, even if there are no matches in the second table. If there are rows in first table that do not have matches in second table, those rows also will be listed. SELECT Employees.Name, Orders.Product
FROM Employees
LEFT JOIN Orders
ON Employees.Employee\_ID=Orders.Employee\_ID SELECT column\_1\_name, column\_2\_name, ...
FROM first\_table\_name
RIGHT JOIN second\_table\_name
ON first\_table\_name.keyfield = second\_table\_name.foreign\_keyfield        The RIGHT JOIN returns all the rows from the second table, even if there are no matches in the first table. If there had been any rows in second table that did not have matches in first table, those rows also would have been listed. SELECT Employees.Name, Orders.Product
FROM Employees
RIGHT JOIN Orders
ON Employees.Employee\_ID=Orders.Employee\_ID  UNION SQL\_Statement\_1
UNION
SQL\_Statement\_2       Select all different values from SQL\_Statement\_1 and SQL\_Statement\_2 SELECT E\_Name FROM Employees\_Norway
UNION
SELECT E\_Name FROM Employees\_USA SQL\_Statement\_1
UNION ALL
SQL\_Statement\_2       Select all values from SQL\_Statement\_1 and SQL\_Statement\_2 SELECT E\_Name FROM Employees\_Norway
UNION
SELECT E\_Name FROM Employees\_USA  SELECT INTO/IN SELECT column\_name(s)
INTO new\_table\_name
FROM source\_table\_name
WHERE query       Select data from table(S) and insert it into another table. SELECT \* INTO Persons\_backup FROM Persons SELECT column\_name(s)
IN external\_database\_name
FROM source\_table\_name
WHERE query       Select data from table(S) and insert it in another database. SELECT Persons.\* INTO Persons IN &#39;Backup.db&#39; FROM Persons WHERE City=&#39;Sandnes&#39; CREATE VIEW CREATE VIEW view\_name AS
SELECT column\_name(s)
FROM table\_name
WHERE condition       Create a virtual table based on the result-set of a SELECT statement. CREATE VIEW \[Current Product List\] AS
SELECT ProductID, ProductName
FROM Products
WHERE Discontinued=No  OTHER</code></pre>
<p>The process of using SQL takes two steps:</p>
<ol type="1">
<li>Connect to an RDBMS specifying
<ul>
<li>credentials, user name and password</li>
<li>the name of the database that you want to use</li>
</ul></li>
<li>Issue one or more SQL statements to interact with
<ul>
<li>the structure of the database</li>
<li>the data in the database</li>
</ul></li>
</ol>
<figure>
<img src="./../images/d6dd08f78245c1f7457c496ea32e5b77b17fc2a8833ad0e5a1cdfe80b35625cb.png" alt="picture 1" /><figcaption>picture 1</figcaption>
</figure>
<figure>
<img src="./../images/3478b7ec074d124ae526af81d6bd9004aeb327e05cda3109b8e8d2c8898d464b.png" alt="picture 3" /><figcaption>picture 3</figcaption>
</figure>
<figure>
<img src="./../images/b88352a2c178ba56345aa1aa703e8ef4d88c749f5e0cf79637432937d38957ed.png" alt="picture 4" /><figcaption>picture 4</figcaption>
</figure>
<figure>
<img src="./../images/4e8c7f13c392a3da81b27d80c1703a846ea5bb35c9c9902802c8630483173f04.png" alt="picture 5" /><figcaption>picture 5</figcaption>
</figure>
<figure>
<img src="./../images/adac702051e62b3729cfe9869845fb17a1ecc53ce86bf47cca529fc2edd1ebeb.png" alt="picture 6" /><figcaption>picture 6</figcaption>
</figure>
<figure>
<img src="./../images/0ac1ccca984a5620243123d810386a9093e141eeb9a0b65cae1ce27152437f9e.png" alt="picture 7" /><figcaption>picture 7</figcaption>
</figure>
<figure>
<img src="./../images/c754280a7ea24ff9b7fa20c88b4c5c0b0515be3677f0785f400bc190f8953819.png" alt="picture 8" /><figcaption>picture 8</figcaption>
</figure>
<figure>
<img src="./../images/f493a0c7771e6ebb8a53908ee2a9953451d5648e9875af6f650db54b6c91471d.png" alt="picture 9" /><figcaption>picture 9</figcaption>
</figure>
<h2 id="psql">PSQL</h2>
<p>CREATE DATABASE CREATE DATABASE dbName; CREATE TABLE (with auto numbering integer id) CREATE TABLE tableName ( id serial PRIMARY KEY, name varchar(50) UNIQUE NOT NULL, dateCreated timestamp DEFAULT current_timestamp ); Add a primary key ALTER TABLE tableName ADD PRIMARY KEY (id); Create an INDEX CREATE UNIQUE INDEX indexName ON tableName (columnNames); Backup a database (command line) pg_dump dbName &gt; dbName.sql Backup all databases (command line) pg_dumpall &gt; pgbackup.sql Run a SQL script (command line) psql -f script.sql databaseName Search using a regular expression SELECT column FROM table WHERE column ~ ‘foo._’; The first N records SELECT columns FROM table LIMIT 10; Pagination SELECT cols FROM table LIMIT 10 OFFSET 30; Prepared Statements PREPARE preparedInsert (int, varchar) AS INSERT INTO tableName (intColumn, charColumn) VALUES ($1, $2); EXECUTE preparedInsert (1,‘a’); EXECUTE preparedInsert (2,‘b’); DEALLOCATE preparedInsert; Create a Function CREATE OR REPLACE FUNCTION month (timestamp) RETURNS integer AS ‘SELECT date_part(’‘month’‘, $1)::integer;’ LANGUAGE ‘sql’; Table Maintenance VACUUM ANALYZE table; Reindex a database, table or index REINDEX DATABASE dbName; Show query plan EXPLAIN SELECT _ FROM table; Import from a file COPY destTable FROM ‘/tmp/somefile’; Show all runtime parameters SHOW ALL; Grant all permissions to a user GRANT ALL PRIVILEGES ON table TO username; Perform a transaction BEGIN TRANSACTION UPDATE accounts SET balance += 50 WHERE id = 1; COMMIT; Basic SQL</p>
<p>Get all columns and rows from a table SELECT * FROM table; Add a new row INSERT INTO table (column1,column2) VALUES (1, ‘one’); Update a row UPDATE table SET foo = ‘bar’ WHERE id = 1; Delete a row DELETE FROM table WHERE id = 1;</p>
<p>Magic words:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">psql</span> -U postgres</a></code></pre></div>
<p>Some interesting flags (to see all, use <code>-h</code> or <code>--help</code> depending on your psql version):</p>
<ul>
<li><code>-E</code>: will describe the underlaying queries of the <code>\</code> commands (cool for learning!)</li>
<li><code>-l</code>: psql will list all databases and then exit (useful if the user you connect with doesn’t has a default database, like at AWS RDS)</li>
</ul>
<p>Most <code>\d</code> commands support additional param of <code>__schema__.name__</code> and accept wildcards like <code>*.*</code></p>
<ul>
<li><code>\q</code>: Quit/Exit</li>
<li><code>\c __database__</code>: Connect to a database</li>
<li><code>\d __table__</code>: Show table definition (columns, etc.) including triggers</li>
<li><code>\d+ __table__</code>: More detailed table definition including description and physical disk size</li>
<li><code>\l</code>: List databases</li>
<li><code>\dy</code>: List events</li>
<li><code>\df</code>: List functions</li>
<li><code>\di</code>: List indexes</li>
<li><code>\dn</code>: List schemas</li>
<li><code>\dt *.*</code>: List tables from all schemas (if <code>*.*</code> is omitted will only show SEARCH_PATH ones)</li>
<li><code>\dT+</code>: List all data types</li>
<li><code>\dv</code>: List views</li>
<li><code>\dx</code>: List all extensions installed</li>
<li><code>\df+ __function__</code> : Show function SQL code.</li>
<li><code>\x</code>: Pretty-format query results instead of the not-so-useful ASCII tables</li>
<li><code>\copy (SELECT * FROM __table_name__) TO 'file_path_and_name.csv' WITH CSV</code>: Export a table as CSV</li>
<li><code>\des+</code>: List all foreign servers</li>
<li><code>\dE[S+]</code>: List all foreign tables</li>
</ul>
<p>User Related:</p>
<ul>
<li><code>\du</code>: List users</li>
<li><code>\du __username__</code>: List a username if present.</li>
<li><code>create role __test1__</code>: Create a role with an existing username.</li>
<li><code>create role __test2__ noinherit login password __passsword__;</code>: Create a role with username and password.</li>
<li><code>set role __test__;</code>: Change role for current session to <code>__test__</code>.</li>
<li><code>grant __test2__ to __test1__;</code>: Allow <code>__test1__</code> to set its role as <code>__test2__</code>.</li>
<li><code>\deu+</code>: List all user mapping on server</li>
</ul>
<h2 id="configuration">Configuration</h2>
<ul>
<li>Service management commands:</li>
</ul>
<pre><code>sudo service postgresql stop
sudo service postgresql start
sudo service postgresql restart</code></pre>
<ul>
<li>Changing verbosity &amp; querying Postgres log: <br/>1) First edit the config file, set a decent verbosity, save and restart postgres:</li>
</ul>
<pre><code>sudo vim /etc/postgresql/9.3/main/postgresql.conf

# Uncomment/Change inside:
log_min_messages = debug5
log_min_error_statement = debug5
log_min_duration_statement = -1

sudo service postgresql restart</code></pre>
<ol start="2" type="1">
<li>Now you will get tons of details of every statement, error, and even background tasks like VACUUMs</li>
</ol>
<pre><code>tail -f /var/log/postgresql/postgresql-9.3-main.log</code></pre>
<ol start="3" type="1">
<li>How to add user who executed a PG statement to log (editing <code>postgresql.conf</code>):</li>
</ol>
<pre><code>log_line_prefix = &#39;%t %u %d %a &#39;</code></pre>
<h2 id="create-command">Create command</h2>
<p>There are many <code>CREATE</code> choices, like <code>CREATE DATABASE __database_name__</code>, <code>CREATE TABLE __table_name__</code> … Parameters differ but can be checked <a href="https://www.postgresql.org/search/?u=%2Fdocs%2F9.1%2F&amp;q=CREATE">at the official documentation</a>.</p>
<h2 id="handy-queries">Handy queries</h2>
<ul>
<li><code>SELECT * FROM pg_proc WHERE proname='__procedurename__'</code>: List procedure/function</li>
<li><code>SELECT * FROM pg_views WHERE viewname='__viewname__';</code>: List view (including the definition)</li>
<li><code>SELECT pg_size_pretty(pg_total_relation_size('__table_name__'));</code>: Show DB table space in use</li>
<li><code>SELECT pg_size_pretty(pg_database_size('__database_name__'));</code>: Show DB space in use</li>
<li><code>show statement_timeout;</code>: Show current user’s statement timeout</li>
<li><code>SELECT * FROM pg_indexes WHERE tablename='__table_name__' AND schemaname='__schema_name__';</code>: Show table indexes</li>
<li>Get all indexes from all tables of a schema:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">SELECT</span></a>
<a class="sourceLine" id="cb9-2" title="2">   t.relname <span class="kw">AS</span> table_name,</a>
<a class="sourceLine" id="cb9-3" title="3">   i.relname <span class="kw">AS</span> index_name,</a>
<a class="sourceLine" id="cb9-4" title="4">   a.attname <span class="kw">AS</span> column_name</a>
<a class="sourceLine" id="cb9-5" title="5"><span class="kw">FROM</span></a>
<a class="sourceLine" id="cb9-6" title="6">   pg_class t,</a>
<a class="sourceLine" id="cb9-7" title="7">   pg_class i,</a>
<a class="sourceLine" id="cb9-8" title="8">   pg_index ix,</a>
<a class="sourceLine" id="cb9-9" title="9">   pg_attribute a,</a>
<a class="sourceLine" id="cb9-10" title="10">    pg_namespace n</a>
<a class="sourceLine" id="cb9-11" title="11"><span class="kw">WHERE</span></a>
<a class="sourceLine" id="cb9-12" title="12">   t.<span class="kw">oid</span> <span class="op">=</span> ix.indrelid</a>
<a class="sourceLine" id="cb9-13" title="13">   <span class="kw">AND</span> i.<span class="kw">oid</span> <span class="op">=</span> ix.indexrelid</a>
<a class="sourceLine" id="cb9-14" title="14">   <span class="kw">AND</span> a.attrelid <span class="op">=</span> t.<span class="kw">oid</span></a>
<a class="sourceLine" id="cb9-15" title="15">   <span class="kw">AND</span> a.attnum <span class="op">=</span> <span class="kw">ANY</span>(ix.indkey)</a>
<a class="sourceLine" id="cb9-16" title="16">   <span class="kw">AND</span> t.relnamespace <span class="op">=</span> n.<span class="kw">oid</span></a>
<a class="sourceLine" id="cb9-17" title="17">    <span class="kw">AND</span> n.nspname <span class="op">=</span> <span class="st">&#39;kartones&#39;</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="kw">ORDER</span> <span class="kw">BY</span></a>
<a class="sourceLine" id="cb9-19" title="19">   t.relname,</a>
<a class="sourceLine" id="cb9-20" title="20">   i.relname</a></code></pre></div>
<ul>
<li>Execution data:
<ul>
<li>Queries being executed at a certain DB:</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">SELECT</span> datname, application_name, pid, backend_start, query_start, state_change, state, <span class="kw">query</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="kw">FROM</span> pg_stat_activity</a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="kw">WHERE</span> datname<span class="op">=</span><span class="st">&#39;__database_name__&#39;</span>;</a></code></pre></div>
<ul>
<li>Get all queries from all dbs waiting for data (might be hung):</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pg_stat_activity <span class="kw">WHERE</span> waiting<span class="op">=</span><span class="st">&#39;t&#39;</span></a></code></pre></div>
<ul>
<li>Currently running queries with process pid:</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">SELECT</span> pg_stat_get_backend_pid(s.backendid) <span class="kw">AS</span> procpid,</a>
<a class="sourceLine" id="cb12-2" title="2">  pg_stat_get_backend_activity(s.backendid) <span class="kw">AS</span> current_query</a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">FROM</span> (<span class="kw">SELECT</span> pg_stat_get_backend_idset() <span class="kw">AS</span> backendid) <span class="kw">AS</span> s;</a></code></pre></div>
<p>Casting:</p>
<ul>
<li><code>CAST (column AS type)</code> or <code>column::type</code></li>
<li><code>'__table_name__'::regclass::oid</code>: Get oid having a table name</li>
</ul>
<p>Query analysis:</p>
<ul>
<li><code>EXPLAIN __query__</code>: see the query plan for the given query</li>
<li><code>EXPLAIN ANALYZE __query__</code>: see and execute the query plan for the given query</li>
<li><code>ANALYZE [__table__]</code>: collect statistics</li>
</ul>
<p>Generating random data (<a href="https://www.citusdata.com/blog/2019/07/17/postgres-tips-for-average-and-power-user/">source</a>):</p>
<ul>
<li><code>INSERT INTO some_table (a_float_value) SELECT random() * 100000 FROM generate_series(1, 1000000) i;</code></li>
</ul>
<figure>
<img src="./../images/10c39b09e6a7df30eeb73d33c1711ad6884315c7c368b6c74478725ae486a23d.png" alt="picture 1" /><figcaption>picture 1</figcaption>
</figure>
<figure>
<img src="./../images/03ab52c85dfafd6033e75ae6b4c3156403f0e65b997edb00fbe7be4fe61d22fa.png" alt="picture 2" /><figcaption>picture 2</figcaption>
</figure>
<h2 id="forign-keys-are-what-make-databases-relationalthey-reference-atable-and-column-in-another-table.">Forign keys are what make databases relational…they reference atable and column in another table.</h2>
<figure>
<img src="./../images/ddfd524fb7f3da3fc3c44ccbef9a74fa7c5e0e1700ff97e4aaec52beb89ce1df.png" alt="picture 3" /><figcaption>picture 3</figcaption>
</figure>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"></a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="fu">sudo</span> vim /etc/postgresql/12/main/postgresql.conf</a>
<a class="sourceLine" id="cb13-7" title="7">[<span class="ex">sudo</span>] password for bryan:</a>
<a class="sourceLine" id="cb13-8" title="8"></a>
<a class="sourceLine" id="cb13-9" title="9">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb13-11" title="11"></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="fu">sudo</span> service postgresql status</a>
<a class="sourceLine" id="cb13-13" title="13"><span class="ex">12/main</span> (port 5432)<span class="bu">:</span> down</a>
<a class="sourceLine" id="cb13-14" title="14"></a>
<a class="sourceLine" id="cb13-15" title="15">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="ex">bryan_dir</span>:~_exitstatus:3 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb13-17" title="17"></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="fu">sudo</span> service postgresql stop</a>
<a class="sourceLine" id="cb13-19" title="19"><span class="ex">*</span> Stopping PostgreSQL 12 database server                                                                                       [ OK ]</a>
<a class="sourceLine" id="cb13-20" title="20"></a>
<a class="sourceLine" id="cb13-21" title="21">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb13-23" title="23"></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="fu">sudo</span> service postgresql start</a>
<a class="sourceLine" id="cb13-25" title="25"><span class="ex">*</span> Starting PostgreSQL 12 database server                                                                                       [ OK ]</a>
<a class="sourceLine" id="cb13-26" title="26"></a>
<a class="sourceLine" id="cb13-27" title="27">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb13-28" title="28"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb13-29" title="29"></a>
<a class="sourceLine" id="cb13-30" title="30"><span class="fu">sudo</span> -u postgres psql</a>
<a class="sourceLine" id="cb13-31" title="31"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb13-32" title="32"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb13-33" title="33"></a>
<a class="sourceLine" id="cb13-34" title="34"><span class="va">postgres=</span># <span class="ex">ALTER</span> USER bryan SUPERUSER<span class="kw">;</span></a>
<a class="sourceLine" id="cb13-35" title="35"><span class="ex">ERROR</span>:  role <span class="st">&quot;bryan&quot;</span> does not exist</a>
<a class="sourceLine" id="cb13-36" title="36"><span class="va">postgres=</span># <span class="ex">ALTER</span> USER postgres SUPERUSER<span class="kw">;</span></a>
<a class="sourceLine" id="cb13-37" title="37"><span class="ex">ALTER</span> ROLE</a>
<a class="sourceLine" id="cb13-38" title="38"><span class="va">postgres=</span># <span class="ex">ALTER</span> USER postgres WITH ENCRYPTED PASSWORD <span class="st">&#39;password&#39;</span></a>
<a class="sourceLine" id="cb13-39" title="39"><span class="ex">postgres-</span>#</a>
<a class="sourceLine" id="cb13-40" title="40"></a>
<a class="sourceLine" id="cb13-41" title="41"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb13-42" title="42"></a>
<a class="sourceLine" id="cb13-43" title="43"><span class="fu">sudo</span> service postgresql start</a>
<a class="sourceLine" id="cb13-44" title="44"><span class="ex">*</span> Starting PostgreSQL 12 database server                                                                                       [ OK ]</a>
<a class="sourceLine" id="cb13-45" title="45"></a>
<a class="sourceLine" id="cb13-46" title="46">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb13-47" title="47"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb13-48" title="48"></a>
<a class="sourceLine" id="cb13-49" title="49"><span class="fu">sudo</span> -u postgres psql</a>
<a class="sourceLine" id="cb13-50" title="50"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb13-51" title="51"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb13-52" title="52"></a>
<a class="sourceLine" id="cb13-53" title="53"><span class="va">postgres=</span># <span class="ex">CREATE</span> USER test_superuser</a>
<a class="sourceLine" id="cb13-54" title="54"><span class="ex">postgres-</span># WITH</a>
<a class="sourceLine" id="cb13-55" title="55"><span class="ex">postgres-</span># PASSWORD</a>
<a class="sourceLine" id="cb13-56" title="56"><span class="ex">postgres-</span># <span class="st">&#39;test&#39;</span></a>
<a class="sourceLine" id="cb13-57" title="57"><span class="ex">postgres-</span># SUPERUSER<span class="kw">;</span></a>
<a class="sourceLine" id="cb13-58" title="58"><span class="ex">CREATE</span> ROLE</a>
<a class="sourceLine" id="cb13-59" title="59"><span class="va">postgres=</span># <span class="ex">CREATE</span> USER test_superuser</a>
<a class="sourceLine" id="cb13-60" title="60"><span class="ex">postgres-</span># WITH</a>
<a class="sourceLine" id="cb13-61" title="61"><span class="ex">postgres-</span># PASSWORD <span class="st">&#39;test&#39;</span></a>
<a class="sourceLine" id="cb13-62" title="62"><span class="ex">postgres-</span># SUPERUSER<span class="kw">;</span></a>
<a class="sourceLine" id="cb13-63" title="63"><span class="ex">ERROR</span>:  role <span class="st">&quot;test_superuser&quot;</span> already exists</a>
<a class="sourceLine" id="cb13-64" title="64"><span class="va">postgres=</span># \<span class="ex">q</span></a>
<a class="sourceLine" id="cb13-65" title="65"></a>
<a class="sourceLine" id="cb13-66" title="66">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb13-67" title="67"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a></code></pre></div>
<blockquote>
<p>Now type the following command to connect to PostgreSQL with the newly-created user. It instructs the client to connect as the user “test_superuser” (-U test_superuser) to the database named “postgres” (postgres) and prompt for the password (-W) for the user.</p>
</blockquote>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="ex">psql</span> -W -U test_superuser postgres</a>
<a class="sourceLine" id="cb14-4" title="4"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb14-5" title="5"><span class="ex">psql</span>: error: FATAL:  password authentication failed for user <span class="st">&quot;test_superuser&quot;</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="ex">FATAL</span>:  password authentication failed for user <span class="st">&quot;test_superuser&quot;</span></a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="ex">bryan_dir</span>:~_exitstatus:2 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb14-10" title="10"></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="ex">psql</span> -W -U test_superuser postgres</a>
<a class="sourceLine" id="cb14-12" title="12"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb14-13" title="13"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb14-14" title="14"><span class="ex">SSL</span> connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)</a>
<a class="sourceLine" id="cb14-15" title="15"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb14-16" title="16"></a>
<a class="sourceLine" id="cb14-17" title="17"><span class="va">postgres=</span>#</a>
<a class="sourceLine" id="cb14-18" title="18"></a>
<a class="sourceLine" id="cb14-19" title="19"></a>
<a class="sourceLine" id="cb14-20" title="20"><span class="ex">psql</span> -W -U test_superuser postgres</a>
<a class="sourceLine" id="cb14-21" title="21"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb14-22" title="22"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb14-23" title="23"><span class="ex">SSL</span> connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)</a>
<a class="sourceLine" id="cb14-24" title="24"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb14-25" title="25"></a>
<a class="sourceLine" id="cb14-26" title="26"><span class="va">postgres=</span># <span class="ex">SELECT</span> CURRENT_USER<span class="kw">;</span></a>
<a class="sourceLine" id="cb14-27" title="27">  <span class="ex">current_user</span></a>
<a class="sourceLine" id="cb14-28" title="28"><span class="ex">----------------</span></a>
<a class="sourceLine" id="cb14-29" title="29"> <span class="ex">test_superuser</span></a>
<a class="sourceLine" id="cb14-30" title="30"><span class="kw">(</span><span class="ex">1</span> row<span class="kw">)</span></a>
<a class="sourceLine" id="cb14-31" title="31"></a>
<a class="sourceLine" id="cb14-32" title="32"><span class="va">postgres=</span>#</a>
<a class="sourceLine" id="cb14-33" title="33"></a>
<a class="sourceLine" id="cb14-34" title="34"></a>
<a class="sourceLine" id="cb14-35" title="35"> <span class="ex">test_superuser</span></a>
<a class="sourceLine" id="cb14-36" title="36"><span class="kw">(</span><span class="ex">1</span> row<span class="kw">)</span></a>
<a class="sourceLine" id="cb14-37" title="37"></a>
<a class="sourceLine" id="cb14-38" title="38"><span class="va">postgres=</span># <span class="ex">CREATE</span> USER test_normal_user</a>
<a class="sourceLine" id="cb14-39" title="39"><span class="ex">postgres-</span># WITH</a>
<a class="sourceLine" id="cb14-40" title="40"><span class="ex">postgres-</span># PASSWORD <span class="st">&#39;test&#39;</span></a>
<a class="sourceLine" id="cb14-41" title="41"><span class="ex">postgres-</span># <span class="kw">;</span></a>
<a class="sourceLine" id="cb14-42" title="42"><span class="ex">CREATE</span> ROLE</a>
<a class="sourceLine" id="cb14-43" title="43"><span class="va">postgres=</span># \<span class="ex">q</span></a>
<a class="sourceLine" id="cb14-44" title="44"></a>
<a class="sourceLine" id="cb14-45" title="45">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb14-46" title="46"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb14-47" title="47"></a>
<a class="sourceLine" id="cb14-48" title="48"><span class="ex">psql</span> -U test_normal_user -W postgres</a>
<a class="sourceLine" id="cb14-49" title="49"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb14-50" title="50"><span class="ex">psql</span>: error: FATAL:  password authentication failed for user <span class="st">&quot;test_normal_user&quot;</span></a>
<a class="sourceLine" id="cb14-51" title="51"><span class="ex">FATAL</span>:  password authentication failed for user <span class="st">&quot;test_normal_user&quot;</span></a>
<a class="sourceLine" id="cb14-52" title="52"></a>
<a class="sourceLine" id="cb14-53" title="53">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb14-54" title="54"><span class="ex">bryan_dir</span>:~_exitstatus:2 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb14-55" title="55"></a>
<a class="sourceLine" id="cb14-56" title="56"><span class="ex">psql</span> -U test_normal_user -W postgres</a>
<a class="sourceLine" id="cb14-57" title="57"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb14-58" title="58"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb14-59" title="59"><span class="ex">SSL</span> connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)</a>
<a class="sourceLine" id="cb14-60" title="60"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb14-61" title="61"></a>
<a class="sourceLine" id="cb14-62" title="62"><span class="va">postgres=</span><span class="op">&gt;</span> <span class="ex">SELECT</span> CURRENT_USER<span class="kw">;</span></a>
<a class="sourceLine" id="cb14-63" title="63">   <span class="ex">current_user</span></a>
<a class="sourceLine" id="cb14-64" title="64"><span class="ex">------------------</span></a>
<a class="sourceLine" id="cb14-65" title="65"> <span class="ex">test_normal_user</span></a>
<a class="sourceLine" id="cb14-66" title="66"><span class="kw">(</span><span class="ex">1</span> row<span class="kw">)</span></a>
<a class="sourceLine" id="cb14-67" title="67"></a>
<a class="sourceLine" id="cb14-68" title="68"><span class="va">postgres=</span><span class="op">&gt;</span> <span class="ex">CREATE</span> USER hacking_the_planet WITH PASSWORD <span class="st">&#39;pwned&#39;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb14-69" title="69"><span class="ex">ERROR</span>:  permission denied to create role</a>
<a class="sourceLine" id="cb14-70" title="70"><span class="va">postgres=</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb14-71" title="71"></a>
<a class="sourceLine" id="cb14-72" title="72"></a></code></pre></div>
<hr />
<hr />
<h1 id="d2-tuesday">D2 TUESDAY</h1>
<hr />
<hr />
<h1 id="retrieving-rows-from-a-table-using-select">Retrieving Rows From A Table Using SELECT</h1>
<p>In the first reading, we covered SQL and PostgreSQL and how to set up PostgreSQL. In this reading, we’re going to learn how to write a simple SQL query using SELECT.</p>
<h2 id="what-is-a-query">What is a query?</h2>
<p>SQL stands for <em>Structured Query Language</em>, and whenever we write SQL we’re usually querying a database. A query is simply a question we’re asking a database, and we’re aiming to get a response back. The response comes back to us as a list of table rows.</p>
<h2 id="example-table">Example table</h2>
<p>Let’s say we had the following database table called <code>puppies</code>. We’ll use this table to make our queries:</p>
<p><em><strong>puppies table</strong></em></p>
<table>
<thead>
<tr class="header">
<th>name</th>
<th>age_yrs</th>
<th>breed</th>
<th>weight_lbs</th>
<th>microchipped</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cooper</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>18</td>
<td>yes</td>
</tr>
<tr class="even">
<td>Indie</td>
<td>0.5</td>
<td>Yorkshire Terrier</td>
<td>13</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Kota</td>
<td>0.7</td>
<td>Australian Shepherd</td>
<td>26</td>
<td>no</td>
</tr>
<tr class="even">
<td>Zoe</td>
<td>0.8</td>
<td>Korean Jindo</td>
<td>32</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Charley</td>
<td>1.5</td>
<td>Basset Hound</td>
<td>25</td>
<td>no</td>
</tr>
<tr class="even">
<td>Ladybird</td>
<td>0.6</td>
<td>Labradoodle</td>
<td>20</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Callie</td>
<td>0.9</td>
<td>Corgi</td>
<td>16</td>
<td>no</td>
</tr>
<tr class="even">
<td>Jaxson</td>
<td>0.4</td>
<td>Beagle</td>
<td>19</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Leinni</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>25</td>
<td>yes</td>
</tr>
<tr class="even">
<td>Max</td>
<td>1.6</td>
<td>German Shepherd</td>
<td>65</td>
<td>no</td>
</tr>
</tbody>
</table>
<h2 id="using-psql-in-the-terminal">Using psql in the terminal</h2>
<p>As we covered in the first reading, psql allows us to access the PostgreSQL server and make queries via the terminal. Open up the terminal on your machine, and connect to the PostgreSQL server by using the following psql command:</p>
<pre class="shell"><code>psql -U postgres</code></pre>
<p>The above command lets you access the PostgreSQL server as the user ‘postgres’ (<code>-U</code> stands for user). After you enter this command, you’ll be prompted for the password that you set for the ‘postgres’ user during installation. Type it in, and hit Enter. Once you’ve successfully logged in, you should see the following in the terminal:</p>
<pre class="shell"><code>Password for user postgres:
psql (11.5, server 11.6)
Type &quot;help&quot; for help.

postgres=#</code></pre>
<p>You can exit psql at anytime with the command <code>\q</code>, and you can log back in with <code>psql -U postgres</code>. (<em>See this <a href="https://www.postgresql.org/docs/9.2/ddl-constraints.html">Postgres Cheatsheet</a> for a list of more PSQL commands.</em>)</p>
<p>We’ll use the following PostgreSQL to create the <code>puppies</code> table above. After you’ve logged into the psql server, type the following code and hit Enter.</p>
<p><em><strong>puppies.sql</strong></em></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">create</span> <span class="kw">table</span> puppies (</a>
<a class="sourceLine" id="cb17-2" title="2">  name <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</a>
<a class="sourceLine" id="cb17-3" title="3">  age_yrs <span class="dt">NUMERIC</span>(<span class="dv">2</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb17-4" title="4">  breed <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</a>
<a class="sourceLine" id="cb17-5" title="5">  weight_lbs <span class="dt">INT</span>,</a>
<a class="sourceLine" id="cb17-6" title="6">  microchipped <span class="dt">BOOLEAN</span></a>
<a class="sourceLine" id="cb17-7" title="7">);</a>
<a class="sourceLine" id="cb17-8" title="8"></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="kw">insert</span> <span class="kw">into</span> puppies</a>
<a class="sourceLine" id="cb17-10" title="10"><span class="kw">values</span></a>
<a class="sourceLine" id="cb17-11" title="11">(<span class="st">&#39;Cooper&#39;</span>, <span class="dv">1</span>, <span class="st">&#39;Miniature Schnauzer&#39;</span>, <span class="dv">18</span>, <span class="st">&#39;yes&#39;</span>);</a>
<a class="sourceLine" id="cb17-12" title="12"></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="kw">insert</span> <span class="kw">into</span> puppies</a>
<a class="sourceLine" id="cb17-14" title="14"><span class="kw">values</span></a>
<a class="sourceLine" id="cb17-15" title="15">(<span class="st">&#39;Indie&#39;</span>, <span class="fl">0.5</span>, <span class="st">&#39;Yorkshire Terrier&#39;</span>, <span class="dv">13</span>, <span class="st">&#39;yes&#39;</span>),</a>
<a class="sourceLine" id="cb17-16" title="16">(<span class="st">&#39;Kota&#39;</span>, <span class="fl">0.7</span>, <span class="st">&#39;Australian Shepherd&#39;</span>, <span class="dv">26</span>, <span class="st">&#39;no&#39;</span>),</a>
<a class="sourceLine" id="cb17-17" title="17">(<span class="st">&#39;Zoe&#39;</span>, <span class="fl">0.8</span>, <span class="st">&#39;Korean Jindo&#39;</span>, <span class="dv">32</span>, <span class="st">&#39;yes&#39;</span>),</a>
<a class="sourceLine" id="cb17-18" title="18">(<span class="st">&#39;Charley&#39;</span>, <span class="fl">1.5</span>, <span class="st">&#39;Basset Hound&#39;</span>, <span class="dv">25</span>, <span class="st">&#39;no&#39;</span>),</a>
<a class="sourceLine" id="cb17-19" title="19">(<span class="st">&#39;Ladybird&#39;</span>, <span class="fl">0.6</span>, <span class="st">&#39;Labradoodle&#39;</span>, <span class="dv">20</span>, <span class="st">&#39;yes&#39;</span>),</a>
<a class="sourceLine" id="cb17-20" title="20">(<span class="st">&#39;Callie&#39;</span>, <span class="fl">0.9</span>, <span class="st">&#39;Corgi&#39;</span>, <span class="dv">16</span>, <span class="st">&#39;no&#39;</span>),</a>
<a class="sourceLine" id="cb17-21" title="21">(<span class="st">&#39;Jaxson&#39;</span>, <span class="fl">0.4</span>, <span class="st">&#39;Beagle&#39;</span>, <span class="dv">19</span>, <span class="st">&#39;yes&#39;</span>),</a>
<a class="sourceLine" id="cb17-22" title="22">(<span class="st">&#39;Leinni&#39;</span>, <span class="dv">1</span>, <span class="st">&#39;Miniature Schnauzer&#39;</span>, <span class="dv">25</span>, <span class="st">&#39;yes&#39;</span> ),</a>
<a class="sourceLine" id="cb17-23" title="23">(<span class="st">&#39;Max&#39;</span>, <span class="fl">1.6</span>, <span class="st">&#39;German Shepherd&#39;</span>, <span class="dv">65</span>, <span class="st">&#39;no&#39;</span>);</a></code></pre></div>
<p>In the above SQL, we created a new table called <code>puppies</code>, and we gave it the following columns: <code>name</code>, <code>age_yrs</code>, <code>breed</code>, <code>weight_lbs</code>, and <code>microchipped</code>. We filled the table with ten rows containing data for each puppy, by using <code>insert into puppies values ()</code>.</p>
<p>We used the following <a href="https://www.postgresql.org/docs/10/datatype-numeric.html">PostgreSQL data types</a>: <code>VARCHAR</code>, <code>NUMERIC</code>, <code>INT</code>, and <code>BOOLEAN</code>.</p>
<ul>
<li><code>VARCHAR(n)</code> is a variable-length character string that lets you store up to <em>n</em> characters. Here we’ve set the character limit to 100 for the <code>name</code> and <code>breed</code> columns.</li>
<li><code>NUMERIC(p,s)</code> is a floating-point number with <em>p</em> digits and <em>s</em> number of places after the decimal point. Here we’ve set the values for the <code>age_yrs</code> column to up to two digits before the decimal and one place after the decimal.</li>
<li><code>INT</code> is a 4-byte integer, which we’ve set on the <code>weight_lbs</code> column.</li>
<li><code>BOOLEAN</code> is, of course, a Boolean value. We’ve set the <code>microchipped</code> column to accept Boolean values. SQL accepts the standard Boolean values <code>true</code>, <code>false</code>, or <code>null</code>. However, you’ll note that we’ve used <code>yes</code> and <code>no</code> in our <code>microchipped</code> column because <a href="https://www.postgresql.org/docs/8.3/tutorial-join.html">PostgreSQL Booleans</a> can be any of the following values:</li>
</ul>
<table>
<thead>
<tr class="header">
<th>TRUE</th>
<th>FALSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true</td>
<td>false</td>
</tr>
<tr class="even">
<td>‘t’</td>
<td>‘f’</td>
</tr>
<tr class="odd">
<td>‘true’</td>
<td>‘false’</td>
</tr>
<tr class="even">
<td>‘yes’</td>
<td>‘no’</td>
</tr>
<tr class="odd">
<td>‘y’</td>
<td>‘n’</td>
</tr>
<tr class="even">
<td>‘1’</td>
<td>‘0’</td>
</tr>
</tbody>
</table>
<h2 id="simple-select-query">Simple SELECT Query</h2>
<p>We can write a simple <a href="http://www.postgresqltutorial.com/postgresql-joins/">SELECT query</a> to get results back from the table above. The syntax for the SELECT query is <code>SELECT [columns] FROM [table]</code>.</p>
<h3 id="select-all-rows">SELECT all rows</h3>
<p>Using <code>SELECT *</code> is a quick way to get back all the rows in a given table. It is discouraged in queries that you write for your applications. Use it only when playing around with data, not for production code.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">SELECT</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="kw">FROM</span>   puppies;</a></code></pre></div>
<p>Type the query above into your psql terminal, and make sure to add a semicolon at the end, which terminates the statement. <code>SELECT</code> and <code>FROM</code> should be capitalized. The above query should give us back the entire <code>puppies</code> table:</p>
<table>
<thead>
<tr class="header">
<th>name</th>
<th>age_yrs</th>
<th>breed</th>
<th>weight_lbs</th>
<th>microchipped</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cooper</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>18</td>
<td>yes</td>
</tr>
<tr class="even">
<td>Indie</td>
<td>0.5</td>
<td>Yorkshire Terrier</td>
<td>13</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Kota</td>
<td>0.7</td>
<td>Australian Shepherd</td>
<td>26</td>
<td>no</td>
</tr>
<tr class="even">
<td>Zoe</td>
<td>0.8</td>
<td>Korean Jindo</td>
<td>32</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Charley</td>
<td>1.5</td>
<td>Basset Hound</td>
<td>25</td>
<td>no</td>
</tr>
<tr class="even">
<td>Ladybird</td>
<td>0.6</td>
<td>Labradoodle</td>
<td>20</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Callie</td>
<td>0.9</td>
<td>Corgi</td>
<td>16</td>
<td>no</td>
</tr>
<tr class="even">
<td>Jaxson</td>
<td>0.4</td>
<td>Beagle</td>
<td>19</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Leinni</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>25</td>
<td>yes</td>
</tr>
<tr class="even">
<td>Max</td>
<td>1.6</td>
<td>German Shepherd</td>
<td>65</td>
<td>no</td>
</tr>
</tbody>
</table>
<h3 id="select-by-column">SELECT by column</h3>
<p>We can see all the rows in a given column by using <code>SELECT [column name]</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">SELECT</span> name</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">FROM</span>   puppies;</a></code></pre></div>
<p>Type the query above into your psql terminal, and make sure to add a semicolon at the end, which terminates the statement. <code>SELECT</code> and <code>FROM</code> should be capitalized. The above query should give us back the following:</p>
<table>
<thead>
<tr class="header">
<th>name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cooper</td>
</tr>
<tr class="even">
<td>Indie</td>
</tr>
<tr class="odd">
<td>Kota</td>
</tr>
<tr class="even">
<td>Zoe</td>
</tr>
<tr class="odd">
<td>Charley</td>
</tr>
<tr class="even">
<td>Ladybird</td>
</tr>
<tr class="odd">
<td>Callie</td>
</tr>
<tr class="even">
<td>Jaxson</td>
</tr>
<tr class="odd">
<td>Leinni</td>
</tr>
<tr class="even">
<td>Max</td>
</tr>
</tbody>
</table>
<h3 id="select-multiple-columns">SELECT multiple columns</h3>
<p>To see multiple columns, we can concatenate the column names by using commas between column names.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">SELECT</span> name</a>
<a class="sourceLine" id="cb20-2" title="2">     , age_yrs</a>
<a class="sourceLine" id="cb20-3" title="3">     , weight_lbs</a>
<a class="sourceLine" id="cb20-4" title="4"><span class="kw">FROM</span>   puppies;</a></code></pre></div>
<p>Type the query above into your psql terminal, and make sure to add a semicolon at the end, which terminates the statement. <code>SELECT</code> and <code>FROM</code> should be capitalized. The above query should give us back the following:</p>
<table>
<thead>
<tr class="header">
<th>name</th>
<th>age_yrs</th>
<th>weight_lbs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cooper</td>
<td>1</td>
<td>18</td>
</tr>
<tr class="even">
<td>Indie</td>
<td>0.5</td>
<td>13</td>
</tr>
<tr class="odd">
<td>Kota</td>
<td>0.7</td>
<td>26</td>
</tr>
<tr class="even">
<td>Zoe</td>
<td>0.8</td>
<td>32</td>
</tr>
<tr class="odd">
<td>Charley</td>
<td>1.5</td>
<td>25</td>
</tr>
<tr class="even">
<td>Ladybird</td>
<td>0.6</td>
<td>20</td>
</tr>
<tr class="odd">
<td>Callie</td>
<td>0.9</td>
<td>16</td>
</tr>
<tr class="even">
<td>Jaxson</td>
<td>0.4</td>
<td>19</td>
</tr>
<tr class="odd">
<td>Leinni</td>
<td>1</td>
<td>25</td>
</tr>
<tr class="even">
<td>Max</td>
<td>1.6</td>
<td>65</td>
</tr>
</tbody>
</table>
<h2 id="formatting-select-statements">Formatting SELECT statements</h2>
<p>This is another of those hot-button topics with software developers. Some people like to put all the stuff on one line for each SQL keyword.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">SELECT</span> name, age_yrs, weight_lbs</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">FROM</span>   puppies;</a></code></pre></div>
<p>That works for short lists. But some tables have hundreds of columns. That gets long.</p>
<p>Some developers like what you saw earlier, the “each column name on its own line with the comma at the front”.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">SELECT</span> name</a>
<a class="sourceLine" id="cb22-2" title="2">     , age_yrs</a>
<a class="sourceLine" id="cb22-3" title="3">     , weight_lbs</a>
<a class="sourceLine" id="cb22-4" title="4"><span class="kw">FROM</span>   puppies;</a></code></pre></div>
<p>They like this because if they need to comment out a column name, they can just put a couple of dashes at the beginning of the line.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">SELECT</span> name</a>
<a class="sourceLine" id="cb23-2" title="2"><span class="co">--     , age_yrs</span></a>
<a class="sourceLine" id="cb23-3" title="3">     , weight_lbs</a>
<a class="sourceLine" id="cb23-4" title="4"><span class="kw">FROM</span>   puppies;</a></code></pre></div>
<p>Some developers just do a word wrap when lines get too long.</p>
<p>All of these are fine. Just stay consistent within a project how you do them.</p>
<hr />
<h1 id="selecting-table-rows-using-where-and-common-operators">Selecting Table Rows Using WHERE And Common Operators</h1>
<p>In the last reading, we learned how to create a simple SQL query using SELECT. In this reading, we’ll be adding a <a href="https://www.postgresql.org/docs/9.2/ddl-constraints.html">WHERE clause</a> to our SELECT statement to further filter a database table and get specific rows back.</p>
<h2 id="using-select-and-where">Using SELECT and WHERE</h2>
<p>Previously, we covered how to use SELECT queries to fetch all of a table’s rows or specified table rows by column(s). We can filter information returned by our query by using a WHERE clause in our SELECT statement.</p>
<p>Let’s look at some examples of adding a WHERE clause using our <code>puppies</code> table from before:</p>
<table>
<thead>
<tr class="header">
<th>name</th>
<th>age_yrs</th>
<th>breed</th>
<th>weight_lbs</th>
<th>microchipped</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cooper</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>18</td>
<td>yes</td>
</tr>
<tr class="even">
<td>Indie</td>
<td>0.5</td>
<td>Yorkshire Terrier</td>
<td>13</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Kota</td>
<td>0.7</td>
<td>Australian Shepherd</td>
<td>26</td>
<td>no</td>
</tr>
<tr class="even">
<td>Zoe</td>
<td>0.8</td>
<td>Korean Jindo</td>
<td>32</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Charley</td>
<td>1.5</td>
<td>Basset Hound</td>
<td>25</td>
<td>no</td>
</tr>
<tr class="even">
<td>Ladybird</td>
<td>0.6</td>
<td>Labradoodle</td>
<td>20</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Callie</td>
<td>0.9</td>
<td>Corgi</td>
<td>16</td>
<td>no</td>
</tr>
<tr class="even">
<td>Jaxson</td>
<td>0.4</td>
<td>Beagle</td>
<td>19</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>Leinni</td>
<td>1</td>
<td>Miniature Schnauzer</td>
<td>25</td>
<td>yes</td>
</tr>
<tr class="even">
<td>Max</td>
<td>1.6</td>
<td>German Shepherd</td>
<td>65</td>
<td>no</td>
</tr>
</tbody>
</table>
<h3 id="where-clause-for-a-single-value">WHERE clause for a single value</h3>
<p>The simplest WHERE clause finds a row by a single column value. See the example below, which finds the rows where the breed equals ‘Corgi’:</p>
<pre class="shell"><code>SELECT name, breed FROM puppies
  WHERE breed = &#39;Corgi&#39;;</code></pre>
<p><code>SELECT</code>, <code>FROM</code>, and <code>WHERE</code> are capitalized. Notice that the string must use single quotation marks. <em>Note: PostgreSQL converts all names of tables, columns, functions, etc. to lowercase unless they’re double quoted.</em> For example: <code>create table Foo()</code> will create a table called <code>foo</code>, and <code>create table "Bar"()</code> will create a table called <code>Bar</code>. If you use double quotation marks in the query above, you’ll get an error that says <code>column "Corgi" does not exist</code> because it thinks you’re searching for the capitalized column name <code>Corgi</code>.</p>
<p>Use the command <code>psql -U postgres</code> in the terminal, and type in your ‘postgres’ user password to connect to the PostgreSQL server. You should have a puppies table in your postgres database from the last reading. Once you’re in psql, enter the query above into the terminal and press Enter. You should get back one result for Callie the Corgi.</p>
<pre class="shell"><code>  name  | breed
--------+-------
 Callie | Corgi</code></pre>
<h3 id="where-clause-for-a-list-of-values">WHERE clause for a list of values</h3>
<p>We can also add a WHERE clause to check for a list of values. The syntax is <code>WHERE [column] IN ('value1', 'value2', 'value3')</code>. Let’s say we wanted to find the name and breed of the puppies who are Corgis, Beagles, or Yorkshire Terriers. We could do so with the query below:</p>
<pre class="shell"><code>SELECT name, breed FROM puppies
  WHERE breed IN (&#39;Corgi&#39;, &#39;Beagle&#39;, &#39;Yorkshire Terrier&#39;);</code></pre>
<p>Entering this query into psql should yield the following results:</p>
<pre class="shell"><code>  name  |       breed
--------+-------------------
 Indie  | Yorkshire Terrier
 Callie | Corgi
 Jaxson | Beagle</code></pre>
<h3 id="where-clause-for-a-range-of-values">WHERE clause for a range of values</h3>
<p>In addition to checking for string values, we can use the WHERE clause to check for a range of numeric/integer values. This time, let’s find the name, breed, and age of the puppies who are between 0 to 6 months old.</p>
<pre class="shell"><code>SELECT name, breed, age_yrs FROM puppies
  WHERE age_yrs BETWEEN 0 AND 0.6;</code></pre>
<p>Entering this query into psql should yield the following results:</p>
<pre class="shell"><code>   name   |       breed       | age_yrs
----------+-------------------+---------
 Indie    | Yorkshire Terrier |     0.5
 Ladybird | Labradoodle       |     0.6
 Jaxson   | Beagle            |     0.4</code></pre>
<h2 id="order-by">ORDER BY</h2>
<p>Getting the values back from a database in any order it wants to give them to you is ludicrous. Instead, you will often want to specify the order in which you get them back. Say you wanted them in alphabetical order by their name. Then, you would write</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">SELECT</span> name, breed</a>
<a class="sourceLine" id="cb30-2" title="2"><span class="kw">FROM</span> puppies</a>
<a class="sourceLine" id="cb30-3" title="3"><span class="kw">ORDER</span> <span class="kw">BY</span> name;</a></code></pre></div>
<p>Say you wanted that returned from oldest dog to youngest dog. You would write</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">SELECT</span> name, breed</a>
<a class="sourceLine" id="cb31-2" title="2"><span class="kw">FROM</span> puppies</a>
<a class="sourceLine" id="cb31-3" title="3"><span class="kw">ORDER</span> <span class="kw">BY</span> age_yrs <span class="kw">DESC</span>;</a></code></pre></div>
<p>where <code>DESC</code> means in descending order. Note that the column that you order on does not have to appear in the column list of the <code>SELECT</code> statement.</p>
<h2 id="limit-and-offset">LIMIT and OFFSET</h2>
<p>Say your query would return one million rows because you’ve cataloged every puppy in the world. That would be a lot for any application to handle. Instead, you may want to limit the number of rows returned. You can do that with the <code>LIMIT</code> keyword.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb32-1" title="1"><span class="kw">SELECT</span> name, breed</a>
<a class="sourceLine" id="cb32-2" title="2"><span class="kw">FROM</span> puppies</a>
<a class="sourceLine" id="cb32-3" title="3"><span class="kw">ORDER</span> <span class="kw">BY</span> age_yrs</a>
<a class="sourceLine" id="cb32-4" title="4"><span class="kw">LIMIT</span> <span class="dv">100</span>;</a></code></pre></div>
<p>That would return the name and breed of the 100 youngest puppies. (Why?) That is, of the million rows that the statement would find, it <em>limits</em> the number to only 100.</p>
<p>Let’s say you want to see the <em>next</em> 100 puppies after the first hundred. You can do that with the <code>OFFSET</code> keyword which comes after the <code>LIMIT</code> clause.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">SELECT</span> name, breed</a>
<a class="sourceLine" id="cb33-2" title="2"><span class="kw">FROM</span> puppies</a>
<a class="sourceLine" id="cb33-3" title="3"><span class="kw">ORDER</span> <span class="kw">BY</span> age_yrs</a>
<a class="sourceLine" id="cb33-4" title="4"><span class="kw">LIMIT</span> <span class="dv">100</span> OFFSET <span class="dv">100</span>;</a></code></pre></div>
<p>That will return only rows 101 - 200 of the result set. It <em>limits</em> the total number of records to return to 100. Then, it starts at the 100th row and counts 100 records. Those are the records returned.</p>
<h2 id="sql-operators">SQL operators</h2>
<p>A SQL operator is a word or character that is used inside a WHERE clause to perform comparisons or arithmetic operations. In the three examples above, we used SQL operators inside of WHERE clauses to filter table rows – <code>=</code>, <code>IN</code>, <code>BETWEEN</code>, and <code>AND</code>.</p>
<p>The following is a listing of SQL operators. We can combine any of these operators in our query or use a single operator by itself.</p>
<h3 id="logical-operators">Logical operators</h3>
<table>
<thead>
<tr class="header">
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ALL</td>
<td>TRUE if all of the subquery values meet the condition.</td>
</tr>
<tr class="even">
<td>AND</td>
<td>TRUE if all the conditions separated by AND are TRUE.</td>
</tr>
<tr class="odd">
<td>ANY</td>
<td>TRUE if any of the subquery values meet the condition.</td>
</tr>
<tr class="even">
<td>BETWEEN</td>
<td>TRUE if the operand is within the range of comparisons.</td>
</tr>
<tr class="odd">
<td>EXISTS</td>
<td>TRUE if the subquery returns one or more records.</td>
</tr>
<tr class="even">
<td>IN</td>
<td>TRUE if the operand is equal to one of a list of expressions.</td>
</tr>
<tr class="odd">
<td>LIKE</td>
<td>TRUE if the operand matches a pattern (accepts “wildcards”).</td>
</tr>
<tr class="even">
<td>NOT</td>
<td>Displays a record if the condition(s) is NOT TRUE.</td>
</tr>
<tr class="odd">
<td>OR</td>
<td>TRUE if any of the conditions separated by OR is TRUE.</td>
</tr>
<tr class="even">
<td>SOME</td>
<td>TRUE if any of the subquery values meet the condition.</td>
</tr>
</tbody>
</table>
<p>Here is another example query with a WHERE clause using several logical operators: <code>NOT</code>, <code>IN</code>, <code>AND</code>, and <code>LIKE</code>.</p>
<pre class="shell"><code>SELECT name, breed FROM puppies
  WHERE breed NOT IN (&#39;Miniature Schnauzer&#39;, &#39;Basset Hound&#39;, &#39;Labradoodle&#39;)
    AND breed NOT LIKE &#39;%Shepherd&#39;;</code></pre>
<p><strong>Note</strong>: Pay attention to that <code>LIKE</code> operator. You will use it more than you want to. The wildcard it uses is the percent sign. Here’s a table to help you understand.</p>
<table>
<thead>
<tr class="header">
<th><code>LIKE</code></th>
<th>Matches “dog”</th>
<th>Matches “hotdog”</th>
<th>Matches “dog-tired”</th>
<th>Matches “ordogordo”</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>'dog'</code></td>
<td>yes</td>
<td>no</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="even">
<td><code>'%dog'</code></td>
<td>yes</td>
<td>yes</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="odd">
<td><code>'dog%'</code></td>
<td>yes</td>
<td>no</td>
<td>yes</td>
<td>no</td>
</tr>
<tr class="even">
<td><code>'%dog%'</code></td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p>Entering this query into psql should yield the following results:</p>
<pre class="shell"><code>  name  |       breed
--------+-------------------
 Indie  | Yorkshire Terrier
 Zoe    | Korean Jindo
 Callie | Corgi
 Jaxson | Beagle</code></pre>
<p>With the query above, we filtered out six puppies: two Miniature Schnauzers, one Basset Hound, one Labradoodle, and two Shepherds. We started with ten puppies in the table, so we’re left with four table rows. There are two puppies who are Shepherd breeds: an Australian Shepherd and a German Shepherd. We used the <code>LIKE</code> operator to filter these. In <code>'%Shepherd</code>, the <code>%</code> matches any substring value before the substring ‘Shepherd’.</p>
<h3 id="arithmetic-operators">Arithmetic operators</h3>
<table>
<thead>
<tr class="header">
<th>Operator</th>
<th>Meaning</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>+</td>
<td>Addition</td>
<td>a + b</td>
</tr>
<tr class="even">
<td>-</td>
<td>Subtraction</td>
<td>a - b</td>
</tr>
<tr class="odd">
<td>*</td>
<td>Multiplication</td>
<td>a * b</td>
</tr>
<tr class="even">
<td>/</td>
<td>Division</td>
<td>a / b</td>
</tr>
<tr class="odd">
<td>%</td>
<td>Modulus (returns remainder)</td>
<td>a % b</td>
</tr>
</tbody>
</table>
<p>Here is an example query with a WHERE clause using the multiplication operator to find puppies that are 6 months old:</p>
<pre class="shell"><code>SELECT name, breed, age_yrs FROM puppies
  WHERE age_yrs * 10 = 6;</code></pre>
<p>Entering the above query into psql will yield one result:</p>
<pre class="shell"><code>   name   |    breed    | age_yrs
----------+-------------+---------
 Ladybird | Labradoodle |     0.6</code></pre>
<h3 id="comparison-operators">Comparison operators</h3>
<table>
<thead>
<tr class="header">
<th>Operator</th>
<th>Meaning</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>=</td>
<td>Equals</td>
<td>a = b</td>
</tr>
<tr class="even">
<td>!=</td>
<td>Not equal to</td>
<td>a != b</td>
</tr>
<tr class="odd">
<td>&lt;&gt;</td>
<td>Not equal to</td>
<td>a &lt;&gt; b</td>
</tr>
<tr class="even">
<td>&gt;</td>
<td>Greater than</td>
<td>a &gt; b</td>
</tr>
<tr class="odd">
<td>&lt;</td>
<td>Less than</td>
<td>a &lt; b</td>
</tr>
<tr class="even">
<td>&gt;=</td>
<td>Greater than or equal to</td>
<td>a &gt;= b</td>
</tr>
<tr class="odd">
<td>&lt;=</td>
<td>Less than or equal to</td>
<td>a &lt;= b</td>
</tr>
<tr class="even">
<td>!&lt;</td>
<td>Not less than</td>
<td>a !&lt; b</td>
</tr>
<tr class="odd">
<td>!&gt;</td>
<td>Not greater than</td>
<td>a !&gt; b</td>
</tr>
</tbody>
</table>
<p>Here is an example query with a WHERE clause using the <code>&gt;</code> comparison operator:</p>
<pre class="shell"><code>SELECT name, breed, weight_lbs FROM puppies
  WHERE weight_lbs &gt; 50;</code></pre>
<p>Entering the above query into psql will yield one result:</p>
<pre class="shell"><code> name |      breed      | weight_lbs
------+-----------------+------------
 Max  | German Shepherd |         65</code></pre>
<hr />
<h1 id="inserting-data-into-a-table">Inserting Data Into A Table</h1>
<hr />
<p>If you have data, but it’s not in tables, does the data even exist? Not to an app! We often need to create relational databases on the back end of the Web apps we’re building so that we can ultimately display this data on the front end of our application. All relational database data is stored in tables, so it’s important to learn how to create tables and successfully query them.</p>
<p>Of the four data manipulation statements, <code>INSERT</code> is the easiest.</p>
<p>Create a new database named “folks”. Now, create a new table named “friends” with the following column specifications.</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Data type</th>
<th>Constraints</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td><code>SERIAL</code></td>
<td><code>PRIMARY KEY</code></td>
</tr>
<tr class="even">
<td>first_name</td>
<td><code>VARCHAR(255)</code></td>
<td><code>NOT NULL</code></td>
</tr>
<tr class="odd">
<td>last_name</td>
<td><code>VARCHAR(255)</code></td>
<td><code>NOT NULL</code></td>
</tr>
</tbody>
</table>
<p>Now that we have a new table, we need to add table rows with some data. We can insert a new table row using the following syntax:</p>
<pre class="shell"><code>INSERT INTO table_name
VALUES
  (column1_value, colum2_value, column3_value);</code></pre>
<p>Let’s fill out our “friends” table with information about five friends. In psql, enter the following to add new table rows. <em>Note the use of single quotation marks for string values. Also note that, since we used the <a href="https://www.postgresql.org/docs/9.2/ddl-constraints.html"><code>SERIAL</code> pseudo-type</a> to auto-increment the ID values, we can simply write <code>DEFAULT</code> for the ID values when inserting new table rows.</em></p>
<pre class="shell"><code>INSERT INTO friends (id, first_name, last_name)
VALUES
  (DEFAULT, &#39;Amy&#39;, &#39;Pond&#39;);</code></pre>
<p>You can also completely omit the <code>DEFAULT</code> keyword if you specify the names of the columns that you want to insert into.</p>
<p>You can also use the “multiple values” insert. This prevents you from having to write <code>INSERT</code> with every statement. Even better, if one fails, they all fail. That can help protect your data integrity.</p>
<pre><code>INSERT INTO friends (first_name, last_name)
VALUES
(&#39;Rose&#39;, &#39;Tyler&#39;),
(&#39;Martha&#39;, &#39;Jones&#39;),
(&#39;Donna&#39;, &#39;Noble&#39;),
(&#39;River&#39;, &#39;Song&#39;);</code></pre>
<p>Use <code>SELECT * FROM friends;</code> to verify that there are rows in the “friends” table:</p>
<pre class="shell"><code>appacademy=# SELECT * FROM friends;
 id | first_name | last_name
----+------------+-----------
  1 | Amy        | Pond
  2 | Rose       | Tyler
  3 | Martha     | Jones
  4 | Donna      | Noble
  5 | River      | Song</code></pre>
<p>Now let’s try to insert a new row using the ID of 5:</p>
<pre class="shell"><code>INSERT INTO friends (id, first_name, last_name)
VALUES (5, &#39;Jenny&#39;, &#39;Who&#39;);</code></pre>
<p>Because ID is a primary key and that ID is already taken, we should get a message in psql that it already exists:</p>
<pre class="shell"><code>appacademy=# insert into friends values (5, &#39;Jenny&#39;, &#39;Who&#39;);
ERROR:  duplicate key value violates unique constraint &quot;friends_pkey&quot;
DETAIL:  Key (id)=(5) already exists.</code></pre>
<hr />
<h1 id="foreign-keys-and-the-join-operation">Foreign Keys And The JOIN Operation</h1>
<p>In relational databases, <em>relationships</em> are key. We can create relationships, or <em>associations</em>, among tables so that they can access and share data. In a SQL database, we create table associations through <em>foreign keys</em> and <em>primary keys</em>.</p>
<p>You’ve learned about primary and foreign keys. Now, it’s time to put them to use.</p>
<h2 id="setting-up-the-database">Setting up the database</h2>
<p>Create a new database called “learn_joins”. Connect to that database. Run the following SQL statements to create tables and the data in them.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb46-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> breeds (</a>
<a class="sourceLine" id="cb46-2" title="2">  <span class="kw">id</span> SERIAL,</a>
<a class="sourceLine" id="cb46-3" title="3">  name <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb46-4" title="4">  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">id</span>)</a>
<a class="sourceLine" id="cb46-5" title="5">);</a></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb47-1" title="1"><span class="kw">INSERT</span> <span class="kw">INTO</span> breeds (name)</a>
<a class="sourceLine" id="cb47-2" title="2"><span class="kw">VALUES</span></a>
<a class="sourceLine" id="cb47-3" title="3">(<span class="st">&#39;Australian Shepherd&#39;</span>),</a>
<a class="sourceLine" id="cb47-4" title="4">(<span class="st">&#39;Basset Hound&#39;</span>),</a>
<a class="sourceLine" id="cb47-5" title="5">(<span class="st">&#39;Beagle&#39;</span>),</a>
<a class="sourceLine" id="cb47-6" title="6">(<span class="st">&#39;Corgi&#39;</span>),</a>
<a class="sourceLine" id="cb47-7" title="7">(<span class="st">&#39;German Shepherd&#39;</span>),</a>
<a class="sourceLine" id="cb47-8" title="8">(<span class="st">&#39;Korean Jindo&#39;</span>),</a>
<a class="sourceLine" id="cb47-9" title="9">(<span class="st">&#39;Labradoodle&#39;</span>),</a>
<a class="sourceLine" id="cb47-10" title="10">(<span class="st">&#39;Miniature Schnauzer&#39;</span>),</a>
<a class="sourceLine" id="cb47-11" title="11">(<span class="st">&#39;Yorkshire Terrier&#39;</span>);</a></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb48-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> puppies (</a>
<a class="sourceLine" id="cb48-2" title="2">  <span class="kw">id</span> SERIAL,</a>
<a class="sourceLine" id="cb48-3" title="3">  name <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb48-4" title="4">  age_yrs <span class="dt">NUMERIC</span>(<span class="dv">3</span>,<span class="dv">1</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb48-5" title="5">  breed_id <span class="dt">INTEGER</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb48-6" title="6">  weight_lbs <span class="dt">INTEGER</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb48-7" title="7">  microchipped <span class="dt">BOOLEAN</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="kw">FALSE</span>,</a>
<a class="sourceLine" id="cb48-8" title="8">  <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(<span class="kw">id</span>),</a>
<a class="sourceLine" id="cb48-9" title="9">  <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (breed_id) <span class="kw">REFERENCES</span> breeds(<span class="kw">id</span>)</a>
<a class="sourceLine" id="cb48-10" title="10">);</a></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb49-1" title="1"><span class="kw">INSERT</span> <span class="kw">INTO</span> puppies (name, age_yrs, breed_id, weight_lbs, microchipped)</a>
<a class="sourceLine" id="cb49-2" title="2"><span class="kw">VALUES</span></a>
<a class="sourceLine" id="cb49-3" title="3">(<span class="st">&#39;Cooper&#39;</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">18</span>, <span class="kw">true</span>),</a>
<a class="sourceLine" id="cb49-4" title="4">(<span class="st">&#39;Indie&#39;</span>, <span class="fl">0.5</span>, <span class="dv">9</span>, <span class="dv">13</span>, <span class="kw">true</span>),</a>
<a class="sourceLine" id="cb49-5" title="5">(<span class="st">&#39;Kota&#39;</span>, <span class="fl">0.7</span>, <span class="dv">1</span>, <span class="dv">26</span>, <span class="kw">false</span>),</a>
<a class="sourceLine" id="cb49-6" title="6">(<span class="st">&#39;Zoe&#39;</span>, <span class="fl">0.8</span>, <span class="dv">6</span>, <span class="dv">32</span>, <span class="kw">true</span>),</a>
<a class="sourceLine" id="cb49-7" title="7">(<span class="st">&#39;Charley&#39;</span>, <span class="fl">1.5</span>, <span class="dv">2</span>, <span class="dv">25</span>, <span class="kw">false</span>),</a>
<a class="sourceLine" id="cb49-8" title="8">(<span class="st">&#39;Ladybird&#39;</span>, <span class="fl">0.6</span>, <span class="dv">7</span>, <span class="dv">20</span>, <span class="kw">true</span>),</a>
<a class="sourceLine" id="cb49-9" title="9">(<span class="st">&#39;Callie&#39;</span>, <span class="fl">0.9</span>, <span class="dv">4</span>, <span class="dv">16</span>, <span class="kw">false</span>),</a>
<a class="sourceLine" id="cb49-10" title="10">(<span class="st">&#39;Jaxson&#39;</span>, <span class="fl">0.4</span>, <span class="dv">3</span>, <span class="dv">19</span>, <span class="kw">true</span>),</a>
<a class="sourceLine" id="cb49-11" title="11">(<span class="st">&#39;Leinni&#39;</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">25</span>, <span class="kw">true</span>),</a>
<a class="sourceLine" id="cb49-12" title="12">(<span class="st">&#39;Max&#39;</span>, <span class="fl">1.6</span>, <span class="dv">5</span>, <span class="dv">65</span>, <span class="kw">false</span>);</a></code></pre></div>
<h2 id="using-join-to-retrieve-rows-from-multiple-tables">Using JOIN to retrieve rows from multiple tables</h2>
<p>Now that we’ve set up an association between the “puppies” table and the “friends” table, we can access data from both tables. We can do so by using a <a href="https://www.postgresql.org/docs/8.3/tutorial-join.html">JOIN operation</a> in our SELECT query. Type the following into psql:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb50-1" title="1"><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> puppies</a>
<a class="sourceLine" id="cb50-2" title="2"><span class="kw">INNER</span> <span class="kw">JOIN</span> breeds <span class="kw">ON</span> (puppies.breed_id <span class="op">=</span> breeds.<span class="kw">id</span>);</a></code></pre></div>
<p>The <code>JOIN</code> operation above is joining the “puppies” table with the “breeds” table together into a single table using the foreign key/primary key shared between the two tables: <code>breed_id</code>.</p>
<p>You should get all rows back containing all information for the puppies and breeds with matching <code>breed_id</code> values:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb51-1" title="1">postgres<span class="op">=</span># <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> puppies</a>
<a class="sourceLine" id="cb51-2" title="2">postgres<span class="op">-</span># <span class="kw">INNER</span> <span class="kw">JOIN</span> breeds <span class="kw">ON</span> (puppies.breed_id <span class="op">=</span> breeds.<span class="kw">id</span>);</a>
<a class="sourceLine" id="cb51-3" title="3"> <span class="kw">id</span> |   name   | age_yrs | breed_id | weight_lbs | microchipped | <span class="kw">id</span> |        name</a>
<a class="sourceLine" id="cb51-4" title="4"><span class="co">----+----------+---------+----------+------------+--------------+----+---------------------</span></a>
<a class="sourceLine" id="cb51-5" title="5">  <span class="dv">1</span> | Cooper   |     <span class="fl">1.0</span> |        <span class="dv">8</span> |         <span class="dv">18</span> | t            |  <span class="dv">8</span> | Miniature Schnauzer</a>
<a class="sourceLine" id="cb51-6" title="6">  <span class="dv">2</span> | Indie    |     <span class="fl">0.5</span> |        <span class="dv">9</span> |         <span class="dv">13</span> | t            |  <span class="dv">9</span> | Yorkshire Terrier</a>
<a class="sourceLine" id="cb51-7" title="7">  <span class="dv">3</span> | Kota     |     <span class="fl">0.7</span> |        <span class="dv">1</span> |         <span class="dv">26</span> | f            |  <span class="dv">1</span> | Australian Shepherd</a>
<a class="sourceLine" id="cb51-8" title="8">  <span class="dv">4</span> | Zoe      |     <span class="fl">0.8</span> |        <span class="dv">6</span> |         <span class="dv">32</span> | t            |  <span class="dv">6</span> | Korean Jindo</a>
<a class="sourceLine" id="cb51-9" title="9">  <span class="dv">5</span> | Charley  |     <span class="fl">1.5</span> |        <span class="dv">2</span> |         <span class="dv">25</span> | f            |  <span class="dv">2</span> | Basset Hound</a>
<a class="sourceLine" id="cb51-10" title="10">  <span class="dv">6</span> | Ladybird |     <span class="fl">0.6</span> |        <span class="dv">7</span> |         <span class="dv">20</span> | t            |  <span class="dv">7</span> | Labradoodle</a>
<a class="sourceLine" id="cb51-11" title="11">  <span class="dv">7</span> | Callie   |     <span class="fl">0.9</span> |        <span class="dv">4</span> |         <span class="dv">16</span> | f            |  <span class="dv">4</span> | Corgi</a>
<a class="sourceLine" id="cb51-12" title="12">  <span class="dv">8</span> | Jaxson   |     <span class="fl">0.4</span> |        <span class="dv">3</span> |         <span class="dv">19</span> | t            |  <span class="dv">3</span> | Beagle</a>
<a class="sourceLine" id="cb51-13" title="13">  <span class="dv">9</span> | Leinni   |     <span class="fl">1.0</span> |        <span class="dv">8</span> |         <span class="dv">25</span> | t            |  <span class="dv">8</span> | Miniature Schnauzer</a>
<a class="sourceLine" id="cb51-14" title="14"> <span class="dv">10</span> | <span class="fu">Max</span>      |     <span class="fl">1.6</span> |        <span class="dv">5</span> |         <span class="dv">65</span> | f            |  <span class="dv">5</span> | German Shepherd</a>
<a class="sourceLine" id="cb51-15" title="15">(<span class="dv">10</span> <span class="kw">rows</span>)</a></code></pre></div>
<p>We could make our query more specific by selecting specific columns, adding a <code>WHERE</code> clause, or doing any number of operations that we could do in a normal <code>SELECT</code> query. Aside from an <code>INNER JOIN</code>, we could also do different types of <code>JOIN</code> operations. (Refer to this overview on <a href="http://www.postgresqltutorial.com/postgresql-joins/">PostgreSQL JOINS</a> for more information.)</p>
<h2 id="helpful-links">Helpful links:</h2>
<ul>
<li><a href="https://www.postgresql.org/docs/9.2/ddl-constraints.html">PostgreSQL Docs: Constraints</a></li>
<li><a href="https://www.postgresql.org/docs/10/datatype-numeric.html">PostgreSQL Docs: Data Types &gt; Numeric Types</a></li>
<li><a href="https://www.postgresql.org/docs/8.3/tutorial-join.html">PostgreSQL Docs: Joins Between Tables</a></li>
<li><a href="http://www.postgresqltutorial.com/postgresql-joins/">PostgreSQL Tutorial: PostgreSQL Joins</a></li>
</ul>
<hr />
<h1 id="writing-and-running-a-seed-file-in-psql">Writing And Running A Seed File In PSQL</h1>
<p>After a database is created, we need to populate it, or <em>seed</em> it, with data. Until now, we’ve used the command-line psql interface to create tables and insert rows into those tables. While that’s fine for small datasets, it would be cumbersome to add a large dataset using the command line.</p>
<p>In this reading, we’ll learn how to create and run a seed file, which makes the process of populating a database with test data much easier.</p>
<h2 id="creating-a-seed-file">Creating a seed file</h2>
<p>You can create a seed file by opening up VSCode or any text editor and saving a file with the <code>.sql</code> extension.</p>
<p>Let’s create a seed file called <code>seed-data.sql</code> that’s going to create a new table called <code>pies</code> and insert 50 pie rows into the table. Use the code below to create the seed file, and make sure to save your seed file on your machine.</p>
<p><em><strong>seed-data.sql</strong></em></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> pies (</a>
<a class="sourceLine" id="cb52-2" title="2">  flavor <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb52-3" title="3">  price <span class="dt">FLOAT</span></a>
<a class="sourceLine" id="cb52-4" title="4">);</a>
<a class="sourceLine" id="cb52-5" title="5"></a>
<a class="sourceLine" id="cb52-6" title="6"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Apple&#39;</span>, <span class="fl">19.95</span>);</a>
<a class="sourceLine" id="cb52-7" title="7"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Caramel Apple Crumble&#39;</span>, <span class="fl">20.53</span>);</a>
<a class="sourceLine" id="cb52-8" title="8"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Blueberry&#39;</span>, <span class="fl">19.31</span>);</a>
<a class="sourceLine" id="cb52-9" title="9"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Blackberry&#39;</span>, <span class="fl">22.86</span>);</a>
<a class="sourceLine" id="cb52-10" title="10"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Cherry&#39;</span>, <span class="fl">22.32</span>);</a>
<a class="sourceLine" id="cb52-11" title="11"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Peach&#39;</span>, <span class="fl">20.45</span>);</a>
<a class="sourceLine" id="cb52-12" title="12"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Raspberry&#39;</span>, <span class="fl">20.99</span>);</a>
<a class="sourceLine" id="cb52-13" title="13"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Mixed Berry&#39;</span>, <span class="fl">21.45</span>);</a>
<a class="sourceLine" id="cb52-14" title="14"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Strawberry Rhubarb&#39;</span>, <span class="fl">24.81</span>);</a>
<a class="sourceLine" id="cb52-15" title="15"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Banana Cream&#39;</span>, <span class="fl">18.66</span>);</a>
<a class="sourceLine" id="cb52-16" title="16"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Boston Toffee&#39;</span>, <span class="fl">25.00</span>);</a>
<a class="sourceLine" id="cb52-17" title="17"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Banana Nutella&#39;</span>, <span class="fl">22.12</span>);</a>
<a class="sourceLine" id="cb52-18" title="18"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Bananas Foster&#39;</span>, <span class="fl">24.99</span>);</a>
<a class="sourceLine" id="cb52-19" title="19"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Boston Cream&#39;</span>, <span class="fl">23.75</span>);</a>
<a class="sourceLine" id="cb52-20" title="20"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Cookies and Cream&#39;</span>, <span class="fl">18.27</span>);</a>
<a class="sourceLine" id="cb52-21" title="21"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Coconut Cream&#39;</span>, <span class="fl">22.89</span>);</a>
<a class="sourceLine" id="cb52-22" title="22"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Chess&#39;</span>, <span class="fl">25.00</span>);</a>
<a class="sourceLine" id="cb52-23" title="23"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Lemon Chess&#39;</span>, <span class="fl">25.00</span>);</a>
<a class="sourceLine" id="cb52-24" title="24"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Key Lime&#39;</span>, <span class="fl">19.34</span>);</a>
<a class="sourceLine" id="cb52-25" title="25"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Lemon Meringue&#39;</span>, <span class="fl">19.58</span>);</a>
<a class="sourceLine" id="cb52-26" title="26"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Guava&#39;</span>, <span class="fl">18.92</span>);</a>
<a class="sourceLine" id="cb52-27" title="27"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Mango&#39;</span>, <span class="fl">19.55</span>);</a>
<a class="sourceLine" id="cb52-28" title="28"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Plum&#39;</span>, <span class="fl">20.21</span>);</a>
<a class="sourceLine" id="cb52-29" title="29"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Apricot&#39;</span>, <span class="fl">20.55</span>);</a>
<a class="sourceLine" id="cb52-30" title="30"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Gooseberry&#39;</span>, <span class="fl">23.54</span>);</a>
<a class="sourceLine" id="cb52-31" title="31"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Lingonberry&#39;</span>, <span class="fl">24.35</span>);</a>
<a class="sourceLine" id="cb52-32" title="32"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Pear Vanilla Butterscotch&#39;</span>, <span class="fl">25.13</span>);</a>
<a class="sourceLine" id="cb52-33" title="33"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Baked Alaska&#39;</span>, <span class="fl">25.71</span>);</a>
<a class="sourceLine" id="cb52-34" title="34"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Chocolate&#39;</span>, <span class="fl">19.00</span>);</a>
<a class="sourceLine" id="cb52-35" title="35"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Chocolate Mousse&#39;</span>, <span class="fl">21.46</span>);</a>
<a class="sourceLine" id="cb52-36" title="36"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Mexican Chocolate&#39;</span>, <span class="fl">28.33</span>);</a>
<a class="sourceLine" id="cb52-37" title="37"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Chocolate Caramel&#39;</span>, <span class="fl">26.67</span>);</a>
<a class="sourceLine" id="cb52-38" title="38"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Chocolate Chip Cookie Dough&#39;</span>, <span class="fl">18.65</span>);</a>
<a class="sourceLine" id="cb52-39" title="39"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Pecan&#39;</span>, <span class="fl">26.33</span>);</a>
<a class="sourceLine" id="cb52-40" title="40"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Bourbon Caramel Pecan&#39;</span>, <span class="fl">27.88</span>);</a>
<a class="sourceLine" id="cb52-41" title="41"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Chocolate Pecan&#39;</span>, <span class="fl">27.63</span>);</a>
<a class="sourceLine" id="cb52-42" title="42"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Pumpkin&#39;</span>, <span class="fl">20.91</span>);</a>
<a class="sourceLine" id="cb52-43" title="43"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Sweet Potato&#39;</span>, <span class="fl">20.75</span>);</a>
<a class="sourceLine" id="cb52-44" title="44"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Purple Sweet Potato&#39;</span>, <span class="fl">26.34</span>);</a>
<a class="sourceLine" id="cb52-45" title="45"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Cheesecake&#39;</span>, <span class="fl">28.99</span>);</a>
<a class="sourceLine" id="cb52-46" title="46"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Butterscotch Praline&#39;</span>, <span class="fl">29.78</span>);</a>
<a class="sourceLine" id="cb52-47" title="47"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Salted Caramel&#39;</span>, <span class="fl">30.32</span>);</a>
<a class="sourceLine" id="cb52-48" title="48"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Salted Honey&#39;</span>, <span class="fl">59.00</span>);</a>
<a class="sourceLine" id="cb52-49" title="49"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Sugar Cream&#39;</span>, <span class="fl">33.89</span>);</a>
<a class="sourceLine" id="cb52-50" title="50"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Mississippi Mud&#39;</span>, <span class="fl">28.67</span>);</a>
<a class="sourceLine" id="cb52-51" title="51"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Turtle Fudge&#39;</span>, <span class="fl">30.58</span>);</a>
<a class="sourceLine" id="cb52-52" title="52"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Fruit Loops&#39;</span>, <span class="fl">20.45</span>);</a>
<a class="sourceLine" id="cb52-53" title="53"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Black Forest&#39;</span>, <span class="fl">34.99</span>);</a>
<a class="sourceLine" id="cb52-54" title="54"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Maple Cream&#39;</span>, <span class="fl">35.88</span>);</a>
<a class="sourceLine" id="cb52-55" title="55"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Smores&#39;</span>, <span class="fl">26.43</span>);</a>
<a class="sourceLine" id="cb52-56" title="56"><span class="kw">INSERT</span> <span class="kw">INTO</span> pies <span class="kw">VALUES</span>(<span class="st">&#39;Milk Bar&#39;</span>, <span class="fl">46.00</span>);</a>
<a class="sourceLine" id="cb52-57" title="57"></a>
<a class="sourceLine" id="cb52-58" title="58"><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pies;</a></code></pre></div>
<h2 id="populating-a-database-via-left-caret">Populating a database via &lt; (“left caret”)</h2>
<p>Now that you have a seed file, you can insert it into a database with a simple command.</p>
<p>Create a database named “bakery”.</p>
<p>The syntax is <code>psql -d [database] &lt; [path_to_file/file.sql]</code>. The left caret (<code>&lt;</code>) takes the standard input from the file on the right (your seed file) and inputs it into the program on the left (<code>psql</code>).</p>
<p>Open up your terminal, and enter the following command. Make sure to replace <code>path_to_my_file</code> with the actual file path.</p>
<pre class="shell"><code>psql -d bakery &lt; path_to_my_file/seed-data.sql</code></pre>
<p>In the terminal, you should see a bunch of <code>INSERT</code> statements and the entire “pies” table printed out (from the <code>SELECT *</code> query in the seed file).</p>
<p>You can log into psql and use <code>\dt</code> to verify that your new table has been added to the database:</p>
<pre class="shell"><code>postgres=# \dt
List of relations
 Schema |     Name     | Type  |  Owner
 public | breeds       | table | appacademy
 public | pies         | table | appacademy
 public | puppies      | table | appacademy</code></pre>
<h2 id="populating-the-database-via-pipe">Populating the database via | (“pipe”)</h2>
<p>You could also use the “pipe” (<code>|</code>) to populate the database with your seed file.</p>
<p>The syntax is <code>cat [path_to_file/file.sql] | psql -d [database]</code>. ‘cat’ is a standard Unix utility that reads files sequentially, writing them to standard output. The “pipe” (<code>|</code>) takes the standard output of the command on the left and pipes it as standard input to the command on the right.</p>
<p>Try out this method in your terminal. If you have an existing “pies” table, you’ll need to drop this table before you can add it again:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb55-1" title="1"><span class="kw">DROP</span> <span class="kw">TABLE</span> pies;</a></code></pre></div>
<p>Then, enter the following. Make sure to replace <code>path_to_my_file</code> with the actual file path.</p>
<pre class="shell"><code>cat path_to_my_file/seed-data.sql | psql -d postgres</code></pre>
<p>Again, you should see a bunch of <code>INSERT</code> statements and the entire “pies” table printed out (from the <code>SELECT *</code> query in the seed file).</p>
<p>You can log into psql and use <code>\dt</code> to verify that your new table has been added to the database:</p>
<pre class="shell"><code>postgres=# \dt
List of relations
 Schema |     Name     | Type  |  Owner
 public | friends      | table | postgres
 public | pies         | table | postgres
 public | puppies      | table | postgres</code></pre>
<p><img src="./D2/my/postgresql-cheat-sheet.png" /></p>
<figure>
<img src="../images/d27c1165ce9a18c7212e61174c3fbd006e14707443024269dbe80103c601ee5c.png" alt="picture 1" /><figcaption>picture 1</figcaption>
</figure>
<figure>
<img src="../images/d4e79fffbd3f93e4c728b7541fa8cef4c84b43adb012e61fb85abdd4abdbd954.png" alt="picture 1" /><figcaption>picture 1</figcaption>
</figure>
<h2 id="password">–password</h2>
<h4 id="master-password-for-pgadmin">—&gt; master password for pgAdmin</h4>
<figure>
<img src="../images/f6655c62ad8c0047f35a0738707f0e5dee44215cc75abf92cac548c27015cdba.png" alt="picture 2" /><figcaption>picture 2</figcaption>
</figure>
<p>Host name : postgreSQL12 port:5432 :username postgres password: password username:</p>
<figure>
<img src="../images/85dfcbf7bc3a70a1a77e931ec39edc28307d6f9ba629ecedecc178cd32635ff7.png" alt="picture 4" /><figcaption>picture 4</figcaption>
</figure>
<hr />
<hr />
<h1 id="wednesday">Wednesday</h1>
<hr />
<hr />
<ol type="1">
<li>Connect to PostgreSQL database</li>
</ol>
<hr />
<p>The following command <a href="https://www.postgresqltutorial.com/postgresql-jdbc/connecting-to-postgresql-database/">connects to a database</a> under a specific user. After pressing <code>Enter</code> PostgreSQL will ask for the password of the user.</p>
<p><code>psql -d database -U user -W</code></p>
<p>For example, to connect to <code>dvdrental</code> database under <code>postgres</code> user, you use the following command:</p>
<p><code>C:\Program Files\PostgreSQL\9.5\bin&gt;psql -d dvdrental -U postgres -W Password for user postgres: dvdrental=</code></p>
<p>If you want to connect to a database that resides on another host, you add the -h option as follows:</p>
<p><code>psql -h host -d database -U user -W</code></p>
<p>In case you want to use SSL mode for the connection, just specify it as shown in the following command:</p>
<p><code>psql -U user -h host "dbname=db sslmode=require"</code></p>
<ol start="2" type="1">
<li>Switch connection to a new database</li>
</ol>
<hr />
<p>Once you are connected to a database, you can switch the connection to a new database under a user specified by <code>user</code>. The previous connection will be closed. If you omit the <code>user</code> parameter, the current <code>user</code> is assumed.</p>
<p>The following command connects to <code>dvdrental</code> database under <code>postgres</code> user:</p>
<p><code>postgres= You are now connected to database "dvdrental" as user "postgres". dvdrental=</code></p>
<ol start="3" type="1">
<li>List available databases</li>
</ol>
<hr />
<p>To <a href="https://www.postgresqltutorial.com/postgresql-show-databases/">list all databases</a> in the current PostgreSQL database server, you use <code>\l</code> command:</p>
<ol start="4" type="1">
<li>List available tables</li>
</ol>
<hr />
<p>To <a href="https://www.postgresqltutorial.com/postgresql-show-tables/">list all tables</a> in the current database, you use <code>\dt</code> command:</p>
<p>Note that this command shows the only table in the currently connected database.</p>
<ol start="5" type="1">
<li>Describe a table</li>
</ol>
<hr />
<p>To <a href="https://www.postgresqltutorial.com/postgresql-describe-table/">describe a table</a> such as a column, type, modifiers of columns, etc., you use the following command:</p>
<ol start="6" type="1">
<li>List available schema</li>
</ol>
<hr />
<p>To list all <a href="https://www.postgresqltutorial.com/postgresql-schema/">schemas</a> of the currently connected database, you use the <code>\dn</code> command.</p>
<ol start="7" type="1">
<li>List available functions</li>
</ol>
<hr />
<p>To list available functions in the current database, you use the <code>\df</code> command.</p>
<ol start="8" type="1">
<li>List available views</li>
</ol>
<hr />
<p>To list available <a href="https://www.postgresqltutorial.com/postgresql-views/">views</a> in the current database, you use the <code>\dv</code> command.</p>
<ol start="9" type="1">
<li>List users and their roles</li>
</ol>
<hr />
<p>To list all users and their assign roles, you use <code>\du</code> command:</p>
<ol start="10" type="1">
<li>Execute the previous command</li>
</ol>
<hr />
<p>To retrieve the current version of PostgreSQL server, you use the <code>version()</code> function as follows:</p>
<p>Now, you want to save time typing the previous command again, you can use <code>\g</code> command to execute the previous command:</p>
<p>psql executes the previous command again, which is the <a href="https://www.postgresqltutorial.com/postgresql-select/">SELECT statement</a>,.</p>
<ol start="11" type="1">
<li>Command history</li>
</ol>
<hr />
<p>To display command history, you use the <code>\s</code> command.</p>
<p>If you want to save the command history to a file, you need to specify the file name followed the <code>\s</code> command as follows:</p>
<ol start="12" type="1">
<li>Execute psql commands from a file</li>
</ol>
<hr />
<p>In case you want to execute psql commands from a file, you use <code>\i</code> command as follows:</p>
<ol start="13" type="1">
<li>Get help on psql commands</li>
</ol>
<hr />
<p>To know all available psql commands, you use the <code>\?</code> command.</p>
<p>To get help on specific PostgreSQL statement, you use the <code>\h</code> command.</p>
<p>For example, if you want to know detailed information on <a href="https://www.postgresqltutorial.com/postgresql-alter-table/">ALTER TABLE</a> statement, you use the following command:</p>
<ol start="14" type="1">
<li>Turn on query execution time</li>
</ol>
<hr />
<p>To turn on query execution time, you use the <code>\timing</code> command.</p>
<p>`dvdrental= Timing is on. dvdrental= count</p>
<p>1000 (1 row)</p>
<p>Time: 1.495 ms dvdrental=`</p>
<p>You use the same command <code>\timing</code> to turn it off.</p>
<p><code>dvdrental= Timing is off. dvdrental=</code></p>
<ol start="15" type="1">
<li>Edit command in your own editor</li>
</ol>
<hr />
<p>It is very handy if you can type the command in your favorite editor. To do this in psql, you <code>\e</code> command. After issuing the command, psql will open the text editor defined by your EDITOR environment variable and place the most recent command that you entered in psql into the editor.</p>
<figure>
<img src="https://sp.postgresqltutorial.com/wp-content/uploads/2015/07/psql-commands.jpg" alt="psql commands" /><figcaption>psql commands</figcaption>
</figure>
<p>After you type the command in the editor, save it, and close the editor, psql will execute the command and return the result.</p>
<figure>
<img src="https://sp.postgresqltutorial.com/wp-content/uploads/2015/07/psql-command-example.jpg" alt="psql command example" /><figcaption>psql command example</figcaption>
</figure>
<p>It is more useful when you edit a function in the editor.</p>
<figure>
<img src="https://sp.postgresqltutorial.com/wp-content/uploads/2015/07/psql-command-ef-edit-function.jpg" alt="psql commadn ef edit function" /><figcaption>psql commadn ef edit function</figcaption>
</figure>
<ol start="16" type="1">
<li>Switch output options</li>
</ol>
<hr />
<p>psql supports some types of output format and allows you to customize how the output is formatted on the fly.</p>
<ul>
<li><code>\a</code> command switches from aligned to non-aligned column output.</li>
<li><code>\H</code> command formats the output to HTML format.</li>
</ul>
<ol start="17" type="1">
<li>Quit psql</li>
</ol>
<hr />
<p>To quit psql, you use <code>\q</code> command and press <code>enter</code> to exit psql.</p>
<h1 id="learing-objectives">Learing Objectives</h1>
<hr />
<hr />
<h1 id="databases-sql-and-sequelize-week-10---learning-objectives">Databases, SQL, and Sequelize (Week 10) - Learning Objectives</h1>
<h2 id="assessment-structure">Assessment Structure</h2>
<ul>
<li>2 hours, 55 minutes</li>
<li>Mixture of multiple choice (5-10), free response (1-3) and VSCode problems (40ish specs).
<ul>
<li>Free response just requires enough detail to answer the question, 1-3 sentences. As long as you are able to explain the concept and answer all aspects that it asks, you are good.</li>
<li>Coding problems come in two varieties:
<ul>
<li>Writing raw SQL like the projects from Tuesday to create tables, insert values, query for records, join tables for queries, etc.</li>
<li>Using sequelize to perform actions such as creating migrations, models, seeders, and then interacting with those models to query for, create, modify, delete, etc.</li>
<li>Both of these sections have their own practice assessment</li>
</ul></li>
</ul></li>
<li>Standard assessment procedures
<ul>
<li>You will be in an individual breakout room</li>
<li>Use a single monitor and share your screen</li>
<li>Only have open those resources needed to complete the assessment:
<ul>
<li>Zoom</li>
<li>VSCode</li>
<li>Browser with AAO and Progress Tracker (to ask questions)</li>
<li>Approved Resources for this assessment:
<ul>
<li>Postgres Docs: https://www.postgresql.org/docs/</li>
<li>Sequelize Docs: https://sequelize.org/</li>
<li>Sequelize “Cheatsheet”</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<h2 id="portfolio-quality-rdbms-and-database-entitities-w10d1---learning-objectives">Portfolio Quality, RDBMS and Database Entitities (W10D1) - Learning Objectives</h2>
<h3 id="portfolio-quality-not-directly-assessed">Portfolio Quality (Not directly assessed)</h3>
<ol type="1">
<li>Recall the items recruiters are most interested in</li>
</ol>
<ul>
<li>Professionalism and good design (described below)</li>
<li>Would you be able to tell that this wasn’t done by a professional dev?</li>
</ul>
<ol start="2" type="1">
<li>Explain aspects of a good looking Web application</li>
</ol>
<ul>
<li>Padding and Margin
<ul>
<li>Padding on every element allows for content that does not butt up against edges</li>
<li>Margins on every element allow for elements that do not butt up against each other</li>
<li>Balance your whitespace: be consistent and even across your page</li>
</ul></li>
<li>Use a color palette to ensure a consistent theme and avoid clashes.
<ul>
<li>You’ll typicaly want a main and secondary color with an accent color or two used sparingly</li>
<li>There are many sites and applications that can help you in choosing these colors, use those resources if you aren’t as confident in this design aspect! (I like https://coolors.co/ personally!)</li>
</ul></li>
<li>Use fonts that pair well
<ul>
<li>In general, if using multiple fonts, try to keep it to two that pair well. More fonts can look inconsistent and messy.</li>
<li>The <a href="https://fonts.google.com/">Google Fonts page</a> has a section for common pairings which can be helpful to see what other developers and designers have commonly used together.</li>
</ul></li>
<li>Use font size, weight, and spacing to make your page easy for your user to parse
<ul>
<li>Large, bold headers, smaller subheaders, and smaller bodies allow the user to easily scan your pages and pick up the highlights.</li>
<li>With these variances, still try to be consistent. Having ten different font sizes is generally more confusing for a user than having just two or three.</li>
<li>Breaking up large blocks into multiple smaller lines/sections is easier for a user to digest.</li>
</ul></li>
<li>Accessibility should be a goal for any application’s design. One easy check is to see if your color choices pass accessibility <a href="https://webaim.org/resources/contrastchecker/">contrast requirements</a>, allowing users with a variety of visual disabilities to enjoy your product.</li>
<li>Use modern styles and CSS features. These can include things like:
<ul>
<li>Rounding the corners of buttons and modals</li>
<li>Applying CSS transitions when elements appear on or disappear from the page</li>
<li>Using shadows to make elements stand out</li>
<li>Making sure page elements feel interactive, such as changing background colors or cursors on hover</li>
<li>etc.</li>
</ul></li>
</ul>
<ol start="3" type="1">
<li>Identify App Academy’s expectations of your projects for after you graduate</li>
</ol>
<ul>
<li>There are some core features that should be part of each of your projects that you use in your portfolio.</li>
<li>These features allow for recruiters to easily navigate your site and provide a base level of functionality and professionalism.
<ul>
<li>Have plenty of seed data. Make your project look as though it is an actively used application. The barebones functionality is not as impressive if someone looking at it cannot imagine what it would actually look like in practice.</li>
<li>Have a favicon. The little icon in your browser’s tab is an easy way to show your attention to detail and make your page stand out.</li>
<li>Provide a demo login. Recruiters generally will not want to have to use their own credentials to create an account on your site. A button to simulate a demo user logging in is an easy way for them to see the application and gives you an opportunity to seed your site with more content for the user to interact with.</li>
<li>Remove any console output. Logging the internal state of the application may be helpful during your development, but when it is time to showcase your work a clean console free of logs and error messages is a sign of professionalism.</li>
<li>Include personal links. The intent of these projects is for recruiters and other developers to see them, be impressed, and want to have you join their team. Include your personal links such as GitHub, LinkedIn, a personal portfolio site, etc., so that they can take the next step and connect with you!</li>
<li>Include a scorecard! We’ll get more into the specifics of this process as we start producing projects, but scorecards are a way for App Academy to be able to provide you feedback on your projects. It’s an easy format for you to be able to see ways that you could improve the project and for instructors and career coaches to be able to provide that feedback. This will only be seen by you and the a/A team, but it’ll help you get your project in its most presentable form!</li>
</ul></li>
</ul>
<ol start="4" type="1">
<li>Practice good code hygiene when making projects live</li>
</ol>
<ul>
<li>Making your application as polished as possible means developers (and potential future coworkers) will want to take a look at how you got it working. This means we should try to make our code as presentable as our actual applications!</li>
<li>Use comments! Describe what you are actually implementing. Explain what a function does. If a particularly tricky bit of logic is being used, explain what is actually happening. A concise explanation can make complicated code easy to understand.</li>
<li>Use standard naming conventions. A descriptive variable name in an identifiable convention can be extremely helpful in reading code.</li>
<li>Indent your code! Opening up a new block of code should result in an indent.</li>
<li>Break up large chunks of code into smaller functions. Remember that your functions should be performing single tasks. Can you create a couple of helper functions so that your code makes more sense?</li>
</ul>
<h3 id="rdbms-and-database-entities">RDBMS and Database Entities</h3>
<ol type="1">
<li>Define what a relational database management system is</li>
</ol>
<ul>
<li>RDBMS stands for Relational Database Management System</li>
<li>A software application that you run that your programs can connect to so that they can store, modify, and retrieve data.</li>
<li>An RDBMS can track many databases. We will use PostgreSQL, or “postgres”, primarily for our RDBMS and it will be able to create individual databases for each of our projects.</li>
</ul>
<ol start="2" type="1">
<li>Describe what relational data is</li>
</ol>
<ul>
<li>In general, relational data is information that is connected to other pieces of information.</li>
<li>When working with relational databases, we can connect two entries together utilizing foreign keys (explained below).</li>
<li>In a pets database, we could be keeping track of dogs and cats as well as the toys that each of them own. That “ownership” of a cat to a toy is the “relational” aspect of relational data. Two pieces of information that can be connected together to show some sort of meaning.</li>
</ul>
<ol start="3" type="1">
<li>Define what a database is</li>
</ol>
<ul>
<li>The actual location that data is stored.</li>
<li>A database can be made up of many tables that each store specific kinds of information.</li>
<li>We could have a pets database that stores information about many different types of animals. Each animal type could potentially be represented by a different table.</li>
</ul>
<ol start="4" type="1">
<li>Define what a database table is</li>
</ol>
<ul>
<li>Within a database, a table stores one specific kind of information.</li>
<li>The records (entries) on these tables can be connected to records on other tables through the use of foreign keys</li>
<li>In our pets database, we could have a <code>dogs</code> table, with individual records</li>
</ul>
<ol start="5" type="1">
<li>Describe the purpose of a primary key</li>
</ol>
<ul>
<li>A primary key is used in the database as a unique identifier for the table.</li>
<li>We often use an “id” field that simply increments with each entry. The incrementing ensures that each record has a unique identifier, even if their are other fields of the record that are repeated (two people with the same name would still need to have a unique identifier, for example).</li>
<li>With a unique identifier, we can easily connect records within the table to records from other tables.</li>
</ul>
<ol start="6" type="1">
<li>Describe the purpose of a foreign key</li>
</ol>
<ul>
<li>A foreign key is used as the connector from this record to the primary key of another table’s record.</li>
<li>In our pets example, we can imagine two tables to demonstrate: a table to represent cats and a table to represent toys. Each of these tables has a primary key of “id” that is used as the unique identifier. In order to make a connection between a toy and a cat, we can add another field to the cat table called “owner_id”, indicating that it is a foreign key for the cat table. By setting a toy’s “owner_id” to the same value as a particular cat’s “id”, we can indicate that the cat is the owner of that toy.</li>
</ul>
<ol start="7" type="1">
<li>Describe how to properly name things in PostgreSQL</li>
</ol>
<ul>
<li>Names within postgres should generally consist of only lowercase letters, numbers, and underscores.</li>
<li>Tables within a database are plural by convention, so a table for cats would typically be “cats” and office locations would be “office_locations” (all lowercase, underscores to replace spaces, plural)</li>
</ul>
<ol start="8" type="1">
<li>Install and configure PostgreSQL 12, its client tools, and a GUI client for it named Postbird</li>
</ol>
<ul>
<li>macOS: https://open.appacademy.io/learn/js-py—aug-2020-online/week-10-aug-2020-online/installing-postgresql-on-macos</li>
<li>Ubuntu: The section starting with “Installing PostgreSQL Client Tools on Ubuntu”: https://open.appacademy.io/learn/js-py—aug-2020-online/week-10-aug-2020-online/installing-postgresql-on-windows
<ul>
<li>Additional resource: https://help.ubuntu.com/community/PostgreSQL</li>
</ul></li>
<li>WSL2: https://github.com/appacademy-starters/postgres-docker</li>
<li>WSL1: https://open.appacademy.io/learn/js-py—aug-2020-online/week-10-aug-2020-online/installing-postgresql-on-windows</li>
</ul>
<ol start="9" type="1">
<li>Connect to an instance of PostgreSQL with the command line tool psql</li>
</ol>
<ul>
<li>The <code>psql</code> command by default will try to connect to a database and username that matches your system’s username</li>
<li>We connect to a different database by providing an argument to the psql command
<ul>
<li><code>psql pets</code></li>
</ul></li>
<li>To connect with a different username we can use the <code>-U</code> flag followed by the username we would like to use. To connect to the <code>pets</code> database as <code>pets_user</code>
<ul>
<li><code>psql -U pets_user pets</code></li>
</ul></li>
<li>If there is a password for the user, we can tell psql that we would like a prompt for the password to show up by using the <code>-W</code> flag.
<ul>
<li><code>psql -U pets_user -W pets</code> (the order of our flags doesn’t matter, as long as any arguments associated with them are together, such as <code>pets_user</code> directly following <code>-U</code> in this example)</li>
</ul></li>
</ul>
<ol start="10" type="1">
<li>Identify whether a user is a normal user or a superuser by the prompt in the psql shell</li>
</ol>
<ul>
<li>You can tell if you are logged in as a superuser or normal user by the prompt in the terminal.</li>
<li>If the prompt shows <code>=&gt;</code>, the user is a normal user</li>
<li>If the prompt show <code>=#</code>, the user is a superuser</li>
</ul>
<ol start="11" type="1">
<li>Create a user for the relational database management system</li>
</ol>
<ul>
<li>Within psql, we can create a user with the <code>CREATE USER {username} {WITH options}</code> command.</li>
<li>The most common options we’ll want to use are <code>WITH PASSWORD 'mypassword'</code> to provide a password for the user we are creating, <code>CREATEDB</code> to allow the user to create new databases, or <code>SUPERUSER</code> to create a user with all elevated permissions.</li>
</ul>
<ol start="12" type="1">
<li>Create a database in the database management system</li>
</ol>
<ul>
<li>We can use the command <code>CREATE DATABASE {database name} {options}</code> inside psql to create a new database.</li>
<li>A popular option we may utilize is <code>WITH OWNER {owner name}</code> to set another user as the owner of the database we are making.</li>
</ul>
<ol start="13" type="1">
<li>Configure a database so that only the owner (and superusers) can connect to it</li>
</ol>
<ul>
<li>We can <code>GRANT</code> and <code>REVOKE</code> privileges from a database to users or categories of users.</li>
<li>In order to remove connection privileges to a database from the public we can use <code>REVOKE CONNECT ON DATABASE {db_name} FROM PUBLIC;</code>, removing all public connection access.</li>
<li>If we wanted to grant it back, or to a specific user, we could similarly do <code>GRANT CONNECT ON DATABASE {db_name} FROM {specific user, PUBLIC, etc.};</code></li>
</ul>
<ol start="14" type="1">
<li>View a list of databases in an installation of PostgreSQL</li>
</ol>
<ul>
<li>To list all databases we can use the <code>\l</code> or <code>\list</code> command in psql.</li>
</ul>
<ol start="15" type="1">
<li>Create tables in a database</li>
</ol>
<div class="sourceCode" id="cb58"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb58-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> {<span class="kw">table</span> name} (</a>
<a class="sourceLine" id="cb58-2" title="2">  {columnA} {typeA},</a>
<a class="sourceLine" id="cb58-3" title="3">  {columnB} {typeB},</a>
<a class="sourceLine" id="cb58-4" title="4">  etc<span class="op">..</span>.</a>
<a class="sourceLine" id="cb58-5" title="5">);</a></code></pre></div>
<ul>
<li>The whitespace does not matter. Creating the SQL statements on multiple lines is easier to read, but just like JavaScript, they can be presented differently.</li>
<li>One common issue is that SQL does not like trailing commas, so the last column cannot have a comma after its type in this example.</li>
</ul>
<ol start="16" type="1">
<li>View a list of tables in a database</li>
</ol>
<ul>
<li>To list all database tables, use the <code>\dt</code> command.</li>
</ul>
<ol start="17" type="1">
<li>Identify and describe the common data types used in PostgreSQL</li>
</ol>
<ul>
<li>There are many different data types that we can use in our tables, here are some common examples:
<ul>
<li><code>SERIAL</code>: autoincrementing, very useful for IDs</li>
<li><code>VARCHAR(n)</code>: a string with a character limit of <code>n</code></li>
<li><code>TEXT</code>: doesn’t have character limit, but less performant</li>
<li><code>BOOLEAN</code>: true/false</li>
<li><code>SMALLINT</code>: signed two-byte integer (-32768 to 32767)</li>
<li><code>INTEGER</code>: signed four-byte integer (standard)</li>
<li><code>BIGINT</code>: signed eight-byte integer (very large numbers)</li>
<li><code>NUMERIC</code>: or <code>DECIMAL</code>, can store exact decimal values</li>
<li><code>TIMESTAMP</code>: date and time</li>
</ul></li>
</ul>
<ol start="18" type="1">
<li>Describe the purpose of the UNIQUE and NOT NULL constraints, and create columns in database tables that have them</li>
</ol>
<ul>
<li>In addition to the data type, we can provide flags for constraints to place on our column data.</li>
<li>The <code>UNIQUE</code> flag indicates that the data for the column must not be repeated.</li>
<li>By default we can create entries in our tables that are missing data from columns. When creating a pet, maybe we don’t provide an age because we don’t know it, for example. If we want to require that the data be present in order to create a new record, we can indicate that column must be <code>NOT NULL</code>.</li>
<li>In the example below, we are requiring our pets to have unique names and for them to be present (both UNIQUE and NOT NULL). We have no such constraints on the age column, allowing repetition of ages or their complete absence.</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb59-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> pets (</a>
<a class="sourceLine" id="cb59-2" title="2">  <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb59-3" title="3">  name <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb59-4" title="4">  age <span class="dt">SMALLINT</span></a>
<a class="sourceLine" id="cb59-5" title="5">);</a></code></pre></div>
<ol start="19" type="1">
<li>Create a primary key for a table</li>
</ol>
<ul>
<li>When creating a table we can indicate the primary key by passing in the column name to parentheses like so:</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb60-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> people (</a>
<a class="sourceLine" id="cb60-2" title="2">  <span class="kw">id</span> SERIAL,</a>
<a class="sourceLine" id="cb60-3" title="3">  first_name <span class="dt">VARCHAR</span>(<span class="dv">50</span>),</a>
<a class="sourceLine" id="cb60-4" title="4">  last_name <span class="dt">VARCHAR</span>(<span class="dv">50</span>),</a>
<a class="sourceLine" id="cb60-5" title="5">  <span class="kw">PRIMARY</span> <span class="kw">KEY</span> (<span class="kw">id</span>)</a>
<a class="sourceLine" id="cb60-6" title="6">);</a></code></pre></div>
<ul>
<li>We could have also used the <code>PRIMARY KEY</code> flag on the column definition itself:</li>
</ul>
<div class="sourceCode" id="cb61"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb61-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> people (</a>
<a class="sourceLine" id="cb61-2" title="2">  <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb61-3" title="3">  first_name <span class="dt">VARCHAR</span>(<span class="dv">50</span>),</a>
<a class="sourceLine" id="cb61-4" title="4">  last_name <span class="dt">VARCHAR</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb61-5" title="5">);</a></code></pre></div>
<ol start="20" type="1">
<li>Create foreign key constraints to relate tables</li>
</ol>
<ul>
<li>In our table definition, we can use the line <code>FOREIGN KEY (foreign_key_stored_in_this_table) REFERENCE {other table} ({other_tables_key_name})</code> to connect two tables.</li>
<li>This is probably easier to see in an example:</li>
</ul>
<div class="sourceCode" id="cb62"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb62-1" title="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> people (</a>
<a class="sourceLine" id="cb62-2" title="2">  <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb62-3" title="3">  first_name <span class="dt">VARCHAR</span>(<span class="dv">50</span>),</a>
<a class="sourceLine" id="cb62-4" title="4">  last_name <span class="dt">VARCHAR</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb62-5" title="5">);</a>
<a class="sourceLine" id="cb62-6" title="6"></a>
<a class="sourceLine" id="cb62-7" title="7"><span class="kw">CREATE</span> <span class="kw">TABLE</span> pets (</a>
<a class="sourceLine" id="cb62-8" title="8">  <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb62-9" title="9">  name <span class="dt">VARCHAR</span>(<span class="dv">255</span>),</a>
<a class="sourceLine" id="cb62-10" title="10">  age <span class="dt">SMALLINT</span>,</a>
<a class="sourceLine" id="cb62-11" title="11">  person_id <span class="dt">INTEGER</span>,</a>
<a class="sourceLine" id="cb62-12" title="12">  <span class="kw">FOREIGN</span> <span class="kw">KEY</span> (person_id) <span class="kw">REFERENCES</span> people (<span class="kw">id</span>)</a>
<a class="sourceLine" id="cb62-13" title="13">);</a></code></pre></div>
<ol start="21" type="1">
<li>Explain that SQL is not case sensitive for its keywords but is for its entity names</li>
</ol>
<ul>
<li>Exactly as the LO states, <code>CREATE TABLE</code> and <code>create table</code> are interpreted the same way. Using capitalization is a good convention in order to distinguish your keywords.</li>
<li>The entity names that we use ARE case-sensitive, however. So a table named <code>pets</code> is unique from a table named <code>Pets</code>. In general, we prefer to use all lowercase for our entities to avoid any of this confusion.</li>
</ul>
<h2 id="sql-w10d2---learning-objectives">SQL (W10D2) - Learning Objectives</h2>
<h3 id="sql">SQL</h3>
<ol type="1">
<li>How to use the <code>SELECT ... FROM ...</code> statement to select data from a single table</li>
</ol>
<ul>
<li>Supply the column names in the <code>SELECT</code> clause. If we want all columns, we can also use <code>*</code></li>
<li>Supply the table names in the <code>FROM</code> clause</li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb63-1" title="1"><span class="co">-- Selects all columns from the friends table</span></a>
<a class="sourceLine" id="cb63-2" title="2"><span class="kw">SELECT</span></a>
<a class="sourceLine" id="cb63-3" title="3">  <span class="op">*</span></a>
<a class="sourceLine" id="cb63-4" title="4"><span class="kw">FROM</span></a>
<a class="sourceLine" id="cb63-5" title="5">  friends;</a>
<a class="sourceLine" id="cb63-6" title="6"></a>
<a class="sourceLine" id="cb63-7" title="7"><span class="co">-- Selects the first_name column from the friends table (remember whitespace is ignored)</span></a>
<a class="sourceLine" id="cb63-8" title="8"><span class="kw">SELECT</span> name</a>
<a class="sourceLine" id="cb63-9" title="9"><span class="kw">FROM</span> friends;</a></code></pre></div>
<ul>
<li>Sometimes we may need to specify what table we are selecting a column from, particulurly if we had joined multiple tables together.</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb64-1" title="1"><span class="co">-- Notice here we are indicating that we want the &quot;name&quot; field from the &quot;friends&quot; table as well as the &quot;name&quot; field from the &quot;puppies&quot; table. We indicate the table name by table.column</span></a>
<a class="sourceLine" id="cb64-2" title="2"><span class="co">-- We are also aliasing these fields with the AS keyword so that our returned results have friend_name and puppy_name as field headers</span></a>
<a class="sourceLine" id="cb64-3" title="3"><span class="kw">SELECT</span></a>
<a class="sourceLine" id="cb64-4" title="4">  friends.name <span class="kw">AS</span> friend_name , puppies.name <span class="kw">AS</span> puppy_name</a>
<a class="sourceLine" id="cb64-5" title="5"><span class="kw">FROM</span></a>
<a class="sourceLine" id="cb64-6" title="6">  friends</a>
<a class="sourceLine" id="cb64-7" title="7"><span class="kw">JOIN</span></a>
<a class="sourceLine" id="cb64-8" title="8">  puppies <span class="kw">ON</span> friends.puppy_id <span class="op">=</span> puppies.<span class="kw">id</span></a></code></pre></div>
<ol start="2" type="1">
<li>How to use the <code>WHERE</code> clause on <code>SELECT</code>, <code>UPDATE</code>, and <code>DELETE</code> statements to narrow the scope of the command</li>
</ol>
<ul>
<li>The <code>WHERE</code> clause allows us to select or apply actions to records that match specific criteria instead of to a whole table.</li>
<li><p>We can use <code>WHERE</code> with a couple of different operators when making our comparison</p>
<ul>
<li><code>WHERE {column} = {value}</code> provides an exact comparison</li>
<li><code>WHERE {column} IN ({value1}, {value2}, {value3}, etc.)</code> matches any provided value in the <code>IN</code> statement. We can make this more complex by having a subquery inside of the parentheses, having our column match any values within the returned results.</li>
<li><code>WHERE {column} BETWEEN {value1} AND {value2}</code> can check for matches between two values (numeric ranges)</li>
<li><code>WHERE {column} LIKE {pattern}</code> can check for matches to a string. This is most useful when we use the wildcard <code>%</code>, such as <code>WHERE breed LIKE '%Shepherd'</code>, which will match any breed that ends in “Shepherd”</li>
<li>The <code>NOT</code> operator can also be used for negation in the checks.</li>
<li>Mathematical operators can be used when performing calculations or comparisons within a query as well, such as</li>
</ul>
<div class="sourceCode" id="cb65"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb65-1" title="1"><span class="kw">SELECT</span> name, breed, weight_lbs <span class="kw">FROM</span> puppies</a>
<a class="sourceLine" id="cb65-2" title="2"><span class="kw">WHERE</span> weight_lbs <span class="op">&gt;</span> <span class="dv">50</span>;</a>
<a class="sourceLine" id="cb65-3" title="3"></a>
<a class="sourceLine" id="cb65-4" title="4"><span class="co">-- OR</span></a>
<a class="sourceLine" id="cb65-5" title="5"></a>
<a class="sourceLine" id="cb65-6" title="6"><span class="kw">SELECT</span> name, breed, age_yrs <span class="kw">FROM</span> puppies</a>
<a class="sourceLine" id="cb65-7" title="7"><span class="kw">WHERE</span> age_yrs <span class="op">*</span> <span class="dv">10</span> <span class="op">=</span> <span class="dv">5</span>;</a></code></pre></div></li>
</ul>
<ol start="3" type="1">
<li>How to use the <code>JOIN</code> keyword to join two (or more) tables together into a single virtual table</li>
</ol>
<ul>
<li>When we want to get information from a related table or do querying based on related table values, we can join the connected table by comparing the foreign key to where it lines up on the other table:</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb66-1" title="1"><span class="co">-- Here we are joining the puppies table on to the friends table. We are specifying that the comparison we should make is the foreign key puppy_id on the friends table should line up with the primary key id on the puppies table.</span></a>
<a class="sourceLine" id="cb66-2" title="2"><span class="kw">SELECT</span></a>
<a class="sourceLine" id="cb66-3" title="3">  <span class="op">*</span></a>
<a class="sourceLine" id="cb66-4" title="4"><span class="kw">FROM</span></a>
<a class="sourceLine" id="cb66-5" title="5">  friends</a>
<a class="sourceLine" id="cb66-6" title="6"><span class="kw">JOIN</span></a>
<a class="sourceLine" id="cb66-7" title="7">  puppies <span class="kw">ON</span> friends.puppy_id <span class="op">=</span> puppies.<span class="kw">id</span></a></code></pre></div>
<ol start="4" type="1">
<li>How to use the <code>INSERT</code> statement to insert data into a table</li>
</ol>
<ul>
<li>When a table is already created we can then insert records into it using the <code>INSERT INTO</code> keywords.</li>
<li>We provide the name of the table that we would like to add records to, followed by the <code>VALUES</code> keyword and each record we are adding. Here’s an example:</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb67-1" title="1"><span class="co">-- We are providing the table name, then multiple records to insert</span></a>
<a class="sourceLine" id="cb67-2" title="2"><span class="co">-- The values are listed in the order that they are defined on the table</span></a>
<a class="sourceLine" id="cb67-3" title="3"><span class="kw">INSERT</span> <span class="kw">INTO</span> table_name</a>
<a class="sourceLine" id="cb67-4" title="4"><span class="kw">VALUES</span></a>
<a class="sourceLine" id="cb67-5" title="5">  (column1_value, colum2_value, column3_value),</a>
<a class="sourceLine" id="cb67-6" title="6">  (column1_value, colum2_value, column3_value),</a>
<a class="sourceLine" id="cb67-7" title="7">  (column1_value, colum2_value, column3_value);</a></code></pre></div>
<ul>
<li>We can also specify columns when we are inserting data. This makes it clear which fields we are providing data for and allows us to provide them out of order, skip null or default values, etc.</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb68-1" title="1"><span class="co">-- In this example, we want to use the default value for id since it is autoincremented, so we provide DEFAULT for this field</span></a>
<a class="sourceLine" id="cb68-2" title="2"><span class="kw">INSERT</span> <span class="kw">INTO</span> friends (<span class="kw">id</span>, first_name, last_name)</a>
<a class="sourceLine" id="cb68-3" title="3"><span class="kw">VALUES</span></a>
<a class="sourceLine" id="cb68-4" title="4">  (<span class="kw">DEFAULT</span>, <span class="st">&#39;Amy&#39;</span>, <span class="st">&#39;Pond&#39;</span>);</a>
<a class="sourceLine" id="cb68-5" title="5"></a>
<a class="sourceLine" id="cb68-6" title="6"><span class="co">-- Alternatively, we can leave it out completely, since the default value will be used if none is provided</span></a>
<a class="sourceLine" id="cb68-7" title="7"><span class="kw">INSERT</span> <span class="kw">INTO</span> friends (first_name, last_name)</a>
<a class="sourceLine" id="cb68-8" title="8"><span class="kw">VALUES</span></a>
<a class="sourceLine" id="cb68-9" title="9">  (<span class="st">&#39;Rose&#39;</span>, <span class="st">&#39;Tyler&#39;</span>),</a>
<a class="sourceLine" id="cb68-10" title="10">  (<span class="st">&#39;Martha&#39;</span>, <span class="st">&#39;Jones&#39;</span>),</a>
<a class="sourceLine" id="cb68-11" title="11">  (<span class="st">&#39;Donna&#39;</span>, <span class="st">&#39;Noble&#39;</span>),</a>
<a class="sourceLine" id="cb68-12" title="12">  (<span class="st">&#39;River&#39;</span>, <span class="st">&#39;Song&#39;</span>);</a></code></pre></div>
<ol start="5" type="1">
<li>How to use an <code>UPDATE</code> statement to update data in a table</li>
</ol>
<ul>
<li>The <code>UPDATE</code> keyword can be used to find records and change their values in our database.</li>
<li>We generally follow the pattern of <code>UPDATE {table} SET {column} = {new value} WHERE {match condition};</code>.</li>
<li>Without a condition to narrow our records down, we will update every record in the table, so this is an important thing to double check!</li>
<li>We can update multiple fields as well by specifying each column in parentheses and their associated new values: <code>UPDATE {table} SET ({column1}, {column2}) = ({value1}, {value2}) WHERE {match condition};</code></li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb69-1" title="1"><span class="co">-- Updates the pet with id of 4 to change their name and breed</span></a>
<a class="sourceLine" id="cb69-2" title="2"><span class="kw">UPDATE</span></a>
<a class="sourceLine" id="cb69-3" title="3">  pets</a>
<a class="sourceLine" id="cb69-4" title="4"><span class="kw">SET</span></a>
<a class="sourceLine" id="cb69-5" title="5">  (name, breed) <span class="op">=</span> (<span class="st">&#39;Floofy&#39;</span>, <span class="st">&#39;Fluffy Dog Breed&#39;</span>) <span class="kw">WHERE</span> <span class="kw">id</span> <span class="op">=</span> <span class="dv">4</span>;</a></code></pre></div>
<ol start="6" type="1">
<li>How to use a <code>DELETE</code> statement to remove data from a table</li>
</ol>
<ul>
<li>Similar to selecting records, we can delete records from a table by specifying what table we are deleting from and what criteria we would like to match in order to delete.</li>
<li>We follow the general structure <code>DELETE FROM {table} WHERE {condition};</code></li>
<li>The condition here is also very important! Without a condition, all records match and will be deleted.</li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb70-1" title="1"><span class="co">-- Deletes from the pets table any record that either has a name Floofy, a name Doggo, or an id of 3.</span></a>
<a class="sourceLine" id="cb70-2" title="2"><span class="kw">DELETE</span> <span class="kw">FROM</span></a>
<a class="sourceLine" id="cb70-3" title="3">  pets</a>
<a class="sourceLine" id="cb70-4" title="4"><span class="kw">WHERE</span></a>
<a class="sourceLine" id="cb70-5" title="5">  name <span class="kw">IN</span> (<span class="st">&#39;Floofy&#39;</span>, <span class="st">&#39;Doggo&#39;</span>) <span class="kw">OR</span> <span class="kw">id</span> <span class="op">=</span> <span class="dv">3</span>;</a></code></pre></div>
<ol start="7" type="1">
<li>How to use a seed file to populate data in a database</li>
</ol>
<ul>
<li>Seed files are a great way for us to create records that we want to start our database out with.</li>
<li>Instead of having to individually add records to our tables or manually entering them in psql or postbird, we can create a file that has all of these records and then just pass this file to psql to run.</li>
<li>Seed files are also great if we ever need to reset our database. We can clear out any records that we have by dropping all of our tables, then just run our seed files to get it into a predetermined starting point. This is great for our personal projects, testing environments, starting values for new tables we create, etc.</li>
<li>There are two main ways we can use a seed file with psql, the <code>&lt;</code> and the <code>|</code> operators. They perform the same function for us, just in slightly different orders, taking the content of a .sql file and executing in within the psql environment:
<ul>
<li><code>psql -d {database} &lt; {sql filepath}</code></li>
<li><code>cat {sql filepath} | psql -d {database}</code></li>
</ul></li>
</ul>
<h2 id="sql-continued-w10d3---learning-objectives">SQL (continued) (W10D3) - Learning Objectives</h2>
<h3 id="sql-continued">SQL (continued)</h3>
<ol type="1">
<li>How to perform relational database design</li>
</ol>
<ul>
<li>Steps to Designing the Database:
<ul>
<li>Define the entities. What data are are you storing, what are the fields for each entity?
<ul>
<li>You can think of this in similar ways to OOP (object oriented programming).</li>
<li>If you wanted to model this information using classes, what classes would you make? Those are generally going to be the tables that are created in your database.</li>
<li>The attributes of your classes are generally going to be the fields/columns that we need for each table.</li>
</ul></li>
<li>Identify primary keys. Most of the time these will be ids that you can generate as a serial field, incrementing with each addition to the database.</li>
<li>Establish table relationships. Connect related data together with foreign keys. Know how we store these keys in a one-to-one, one-to-many, or many-to-many relationship.
<ul>
<li>With a one-to-one or one-to-many relationship, we are able to use a foreign key on the table to indicate the other specific record that it is connected to.</li>
<li>With a many-to-many relationship, each record could be connected to multiple records, so we have to create a join table to connect these entities. A record on this join table connects a record from one table to a record from another table. <img src="./oto-relationship.svg" alt="one-to-one" /> <img src="./otm-and-mtm-relationships.svg" alt="one-to-many many-to-many" /></li>
</ul></li>
</ul></li>
</ul>
<ol start="2" type="1">
<li>How to use transactions to group multiple SQL commands into one succeed or fail operation</li>
</ol>
<ul>
<li>We can define an explicit transaction using <code>BEGIN</code> and ending with either <code>COMMIT</code> or <code>ROLLBACK</code>.</li>
<li>If any command inside the block fails, everything will be rolled back. We can also specify that we want to roll back at the end of the block instead of committing. We saw that this can be useful when analyzing operations that would manipulate our database.</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb71-1" title="1"><span class="cf">BEGIN</span>;</a>
<a class="sourceLine" id="cb71-2" title="2">  <span class="kw">UPDATE</span> accounts <span class="kw">SET</span> balance <span class="op">=</span> balance <span class="op">-</span> <span class="fl">100.00</span></a>
<a class="sourceLine" id="cb71-3" title="3">      <span class="kw">WHERE</span> name <span class="op">=</span> <span class="st">&#39;Alice&#39;</span>;</a>
<a class="sourceLine" id="cb71-4" title="4">  <span class="kw">UPDATE</span> branches <span class="kw">SET</span> balance <span class="op">=</span> balance <span class="op">-</span> <span class="fl">100.00</span></a>
<a class="sourceLine" id="cb71-5" title="5">      <span class="kw">WHERE</span> name <span class="op">=</span> (<span class="kw">SELECT</span> branch_name <span class="kw">FROM</span> accounts <span class="kw">WHERE</span> name <span class="op">=</span> <span class="st">&#39;Alice&#39;</span>);</a>
<a class="sourceLine" id="cb71-6" title="6">  <span class="kw">UPDATE</span> accounts <span class="kw">SET</span> balance <span class="op">=</span> balance <span class="op">+</span> <span class="fl">100.00</span></a>
<a class="sourceLine" id="cb71-7" title="7">      <span class="kw">WHERE</span> name <span class="op">=</span> <span class="st">&#39;Bob&#39;</span>;</a>
<a class="sourceLine" id="cb71-8" title="8">  <span class="kw">UPDATE</span> branches <span class="kw">SET</span> balance <span class="op">=</span> balance <span class="op">+</span> <span class="fl">100.00</span></a>
<a class="sourceLine" id="cb71-9" title="9">      <span class="kw">WHERE</span> name <span class="op">=</span> (<span class="kw">SELECT</span> branch_name <span class="kw">FROM</span> accounts <span class="kw">WHERE</span> name <span class="op">=</span> <span class="st">&#39;Bob&#39;</span>);</a>
<a class="sourceLine" id="cb71-10" title="10"><span class="kw">COMMIT</span>;</a></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb72-1" title="1"><span class="cf">BEGIN</span>;</a>
<a class="sourceLine" id="cb72-2" title="2">  <span class="kw">EXPLAIN</span> <span class="kw">ANALYZE</span></a>
<a class="sourceLine" id="cb72-3" title="3">  <span class="kw">UPDATE</span> cities</a>
<a class="sourceLine" id="cb72-4" title="4">  <span class="kw">SET</span> city <span class="op">=</span> <span class="st">&#39;New York City&#39;</span></a>
<a class="sourceLine" id="cb72-5" title="5">  <span class="kw">WHERE</span> city <span class="op">=</span> <span class="st">&#39;New York&#39;</span>;</a>
<a class="sourceLine" id="cb72-6" title="6"><span class="kw">ROLLBACK</span>;</a></code></pre></div>
<ol start="3" type="1">
<li>How to apply indexes to tables to improve performance</li>
</ol>
<ul>
<li>An index can help optimize queries that we have to run regularly. If we are constantly looking up records in a table by a particular field (such as username or phone number), we can add an index in order to speed up this process.</li>
<li>An index maintains a sorted version of the field with a reference to the record that it points to in the table (via primary key). If we want to find a record based on a field that we have an index for, we can look through this index in a more efficient manner than having to scan through the entire table (generally O(log n) since the index is sorted, instead of O(n) for a sequential scan).</li>
<li>To add an index to a field we can use the following syntax:</li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb73-1" title="1"><span class="kw">CREATE</span> <span class="kw">INDEX</span> index_name <span class="kw">ON</span> table_name (column_name);</a></code></pre></div>
<ul>
<li>To drop an index we can do the following:</li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb74-1" title="1"><span class="kw">DROP</span> <span class="kw">INDEX</span> index_name</a></code></pre></div>
<ul>
<li>Making an index is not always the best approach. Indices allow for faster lookup, but slow down record insertion and the updating of associated fields, since we not only have to add the information to the table, but also manipulate the index.
<ul>
<li>We generally wouldn’t care about adding an index if:
<ul>
<li>The tables are small</li>
<li>We are updating the table frequently, especially the associated columns</li>
<li>The column has many NULL values</li>
</ul></li>
</ul></li>
</ul>
<ol start="4" type="1">
<li>Explain what and why someone would use EXPLAIN</li>
</ol>
<ul>
<li>EXPLAIN gives us information about how a query will run (the query plan)</li>
<li>It gives us an idea of how our database will search for data as well as a qualitative comparitor for how expensive that operation will be. Comparing the cost of two queries will tell us which one is more efficient (lower cost).</li>
<li>We can also use the ANALYZE command with EXPLAIN, which will actually run the specified query. Doing so gives us more detailed information, such as the milliseconds it took our query to execute as well as specifics like the exact number of rows filtered and returned.</li>
</ul>
<ol start="5" type="1">
<li>Demonstrate how to install and use the node-postgres library and its Pool class to query a PostgreSQL-managed database</li>
</ol>
<ul>
<li>We can add the <code>node-postgres</code> library to our application with <code>npm install pg</code>. From there we will typically use the Pool class associated with this library. That way we can run many SQL queries with one database connection (as opposed to Client, which closes the connection after a query).</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb75-1" title="1"><span class="kw">const</span> <span class="op">{</span> Pool <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;pg&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb75-2" title="2"></a>
<a class="sourceLine" id="cb75-3" title="3"><span class="co">// If we need to specify a username, password, or database, we can do so when we create a Pool instance, otherwise the default values for logging in to psql are used:</span></a>
<a class="sourceLine" id="cb75-4" title="4"><span class="kw">const</span> pool <span class="op">=</span> <span class="kw">new</span> <span class="at">Pool</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb75-5" title="5">  <span class="dt">username</span><span class="op">:</span> <span class="st">&quot;&lt;&lt;username&gt;&gt;&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb75-6" title="6">  <span class="dt">password</span><span class="op">:</span> <span class="st">&quot;&lt;&lt;password&gt;&gt;&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb75-7" title="7">  <span class="dt">database</span><span class="op">:</span> <span class="st">&quot;&lt;&lt;database&gt;&gt;&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb75-8" title="8"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<ul>
<li>The <code>query</code> method on the Pool instance will allow us to execute a SQL query on our database. We can pass in a string that represents the query we want to run</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb76-1" title="1"><span class="kw">const</span> allAirportsSql <span class="op">=</span> <span class="vs">`</span></a>
<a class="sourceLine" id="cb76-2" title="2"><span class="vs">  SELECT id, city_id, faa_id, name</span></a>
<a class="sourceLine" id="cb76-3" title="3"><span class="vs">  FROM airports;</span></a>
<a class="sourceLine" id="cb76-4" title="4"><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb76-5" title="5"></a>
<a class="sourceLine" id="cb76-6" title="6"><span class="kw">async</span> <span class="kw">function</span> <span class="at">selectAllAirports</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb76-7" title="7">  <span class="kw">const</span> results <span class="op">=</span> <span class="cf">await</span> <span class="va">pool</span>.<span class="at">query</span>(allAirportsSql)<span class="op">;</span></a>
<a class="sourceLine" id="cb76-8" title="8">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">results</span>.<span class="at">rows</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb76-9" title="9">  <span class="va">pool</span>.<span class="at">end</span>()<span class="op">;</span> <span class="co">// invoking end() will close our connection to the database</span></a>
<a class="sourceLine" id="cb76-10" title="10"><span class="op">}</span></a>
<a class="sourceLine" id="cb76-11" title="11"></a>
<a class="sourceLine" id="cb76-12" title="12"><span class="at">selectAllAirports</span>()<span class="op">;</span></a></code></pre></div>
<ul>
<li>The return value of this asynchronous function is an object with a <code>rows</code> key that points to an array of objects, each object representing a record with field names as keys.</li>
</ul>
<ol start="6" type="1">
<li>Explain how to write prepared statements with placeholders for parameters of the form “$1”, “$2”, and so on</li>
</ol>
<ul>
<li>The prepared statement (SQL string that we wrote) can also be made more dynamic by allowing for parameters to be passed in.</li>
<li>The Pool instance’s <code>query</code> function allows us to pass a second argument, an array of parameters to be used in the query string. The location of the parameter substitutions are designated with <code>$1</code>, <code>$2</code>, etc., to signify the first, second, etc., arguments.</li>
</ul>
<div class="sourceCode" id="cb77"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb77-1" title="1"><span class="kw">const</span> airportsByNameSql <span class="op">=</span> <span class="vs">`</span></a>
<a class="sourceLine" id="cb77-2" title="2"><span class="vs">  SELECT name, faa_id</span></a>
<a class="sourceLine" id="cb77-3" title="3"><span class="vs">  FROM airports</span></a>
<a class="sourceLine" id="cb77-4" title="4"><span class="vs">  WHERE UPPER(name) LIKE UPPER($1)</span></a>
<a class="sourceLine" id="cb77-5" title="5"><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb77-6" title="6"></a>
<a class="sourceLine" id="cb77-7" title="7"><span class="kw">async</span> <span class="kw">function</span> <span class="at">selectAirportsByName</span>(name) <span class="op">{</span></a>
<a class="sourceLine" id="cb77-8" title="8">  <span class="kw">const</span> results <span class="op">=</span> <span class="cf">await</span> <span class="va">pool</span>.<span class="at">query</span>(airportsByNameSql<span class="op">,</span> [<span class="vs">`%</span><span class="sc">${</span>name<span class="sc">}</span><span class="vs">%`</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb77-9" title="9">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">results</span>.<span class="at">rows</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb77-10" title="10">  <span class="va">pool</span>.<span class="at">end</span>()<span class="op">;</span> <span class="co">// invoking end() will close our connection to the database</span></a>
<a class="sourceLine" id="cb77-11" title="11"><span class="op">}</span></a>
<a class="sourceLine" id="cb77-12" title="12"></a>
<a class="sourceLine" id="cb77-13" title="13"><span class="co">// Get the airport name from the command line and store it</span></a>
<a class="sourceLine" id="cb77-14" title="14"><span class="co">// in the variable &quot;name&quot;. Pass that value to the</span></a>
<a class="sourceLine" id="cb77-15" title="15"><span class="co">// selectAirportsByName function.</span></a>
<a class="sourceLine" id="cb77-16" title="16"><span class="kw">const</span> name <span class="op">=</span> <span class="va">process</span>.<span class="at">argv</span>[<span class="dv">2</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb77-17" title="17"><span class="co">// console.log(name);</span></a>
<a class="sourceLine" id="cb77-18" title="18"><span class="at">selectAirportsByName</span>(name)<span class="op">;</span></a></code></pre></div>
<h2 id="orm-w10d4---learning-objectives">ORM (W10D4) - Learning Objectives</h2>
<h3 id="orm">ORM</h3>
<ol type="1">
<li>How to install, configure, and use Sequelize, an ORM for JavaScript</li>
</ol>
<ul>
<li>To start a new project we use our standard npm initialize statement
<ul>
<li><code>npm init -y</code></li>
</ul></li>
<li>Add in the packages we will need (sequelize, sequelize-cli, and pg)
<ul>
<li><code>npm install sequelize@^5.0.0 sequelize-cli@^5.0.0 pg@^8.0.0</code></li>
</ul></li>
<li>Initialize sequelize in our project
<ul>
<li><code>npx sequelize-cli init</code></li>
</ul></li>
<li>Create a database user with credentials we will use for the project
<ul>
<li><code>psql</code></li>
<li><code>CREATE USER example_user WITH PASSWORD 'badpassword'</code></li>
</ul></li>
<li>Here we can also create databases since we are already in postgres
<ul>
<li><code>CREATE DATABASE example_app_development WITH OWNER example_user</code></li>
<li><code>CREATE DATABASE example_app_test WITH OWNER example_user</code></li>
<li><code>CREATE DATABASE example_app_production WITH OWNER example_user</code></li>
</ul></li>
<li>If we don’t create these databases now, we could also create them after we make our changes to our config file. If we take this approach, we need to make sure our user that we created has the <code>CREATEDB</code> option when we make them, since sequelize will attempt to make the databases with this user. This other approach would look like:
<ul>
<li>In psql: <code>CREATE USER example_user WITH PASSWORD 'badpassword' CREATEDB</code></li>
<li>In terminal: <code>npx sequelize-cli db:create</code></li>
</ul></li>
<li>Double check that our configuration file matches our username, password, database, dialect, and seederStorage (these will be filled out for you in an assessment scenario):</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb78-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb78-2" title="2">  <span class="dt">&quot;development&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb78-3" title="3">    <span class="dt">&quot;username&quot;</span><span class="fu">:</span> <span class="st">&quot;sequelize_recipe_box_app&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-4" title="4">    <span class="dt">&quot;password&quot;</span><span class="fu">:</span> <span class="st">&quot;HfKfK79k&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-5" title="5">    <span class="dt">&quot;database&quot;</span><span class="fu">:</span> <span class="st">&quot;recipe_box_development&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-6" title="6">    <span class="dt">&quot;host&quot;</span><span class="fu">:</span> <span class="st">&quot;127.0.0.1&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-7" title="7">    <span class="dt">&quot;dialect&quot;</span><span class="fu">:</span> <span class="st">&quot;postgres&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-8" title="8">    <span class="dt">&quot;seederStorage&quot;</span><span class="fu">:</span> <span class="st">&quot;sequelize&quot;</span></a>
<a class="sourceLine" id="cb78-9" title="9">  <span class="fu">},</span></a>
<a class="sourceLine" id="cb78-10" title="10">  <span class="dt">&quot;test&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb78-11" title="11">    <span class="dt">&quot;username&quot;</span><span class="fu">:</span> <span class="st">&quot;sequelize_recipe_box_app&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-12" title="12">    <span class="dt">&quot;password&quot;</span><span class="fu">:</span> <span class="st">&quot;HfKfK79k&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-13" title="13">    <span class="dt">&quot;database&quot;</span><span class="fu">:</span> <span class="st">&quot;recipe_box_test&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-14" title="14">    <span class="dt">&quot;host&quot;</span><span class="fu">:</span> <span class="st">&quot;127.0.0.1&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-15" title="15">    <span class="dt">&quot;dialect&quot;</span><span class="fu">:</span> <span class="st">&quot;postgres&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-16" title="16">    <span class="dt">&quot;seederStorage&quot;</span><span class="fu">:</span> <span class="st">&quot;sequelize&quot;</span></a>
<a class="sourceLine" id="cb78-17" title="17">  <span class="fu">},</span></a>
<a class="sourceLine" id="cb78-18" title="18">  <span class="dt">&quot;production&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb78-19" title="19">    <span class="dt">&quot;username&quot;</span><span class="fu">:</span> <span class="st">&quot;sequelize_recipe_box_app&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-20" title="20">    <span class="dt">&quot;password&quot;</span><span class="fu">:</span> <span class="st">&quot;HfKfK79k&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-21" title="21">    <span class="dt">&quot;database&quot;</span><span class="fu">:</span> <span class="st">&quot;recipe_box_production&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-22" title="22">    <span class="dt">&quot;host&quot;</span><span class="fu">:</span> <span class="st">&quot;127.0.0.1&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-23" title="23">    <span class="dt">&quot;dialect&quot;</span><span class="fu">:</span> <span class="st">&quot;postgres&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb78-24" title="24">    <span class="dt">&quot;seederStorage&quot;</span><span class="fu">:</span> <span class="st">&quot;sequelize&quot;</span></a>
<a class="sourceLine" id="cb78-25" title="25">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb78-26" title="26"><span class="fu">}</span></a></code></pre></div>
<ol start="2" type="1">
<li>How to use database migrations to make your database grow with your application in a source-control enabled way</li>
</ol>
<ul>
<li><h4 id="migrations">Migrations</h4>
<ul>
<li>In order to make new database tables and sequelize models that reflect them, we want to generate a migration file and model file using <code>model:generate</code>
<ul>
<li><code>npx sequelize-cli model:generate --name Cat --attributes "firstName:string,specialSkill:string"</code></li>
<li>Here we are creating a migration file and a model file for a Cat. We are specifying that we want this table to have fields for firstName and specialSkill. Sequelize will automatically make fields for an id, createdAt, and updatedAt, as well, so we do not need to specify these.</li>
</ul></li>
<li>Once our migration file is created, we can go in and edit any details that we need to. Most often we will want to add in database constraints such as <code>allowNull: false</code>, adding a uniqueness constraint with <code>unique: true</code>, adding in character limits to fields such as <code>type: Sequelize.STRING(100)</code>, or specifying a foreign key with references to another table <code>references: { model: 'Categories' }</code>.</li>
<li>After we make any necessary changes to our migration file, we need to perform the migration, which will run the SQL commands to actually create the table.
<ul>
<li><code>npx sequelize-cli db:migrate</code></li>
<li>This command runs any migration files that have not been previously run, in the order that they were created (this is why the timestamp in the file name is important)</li>
</ul></li>
<li>If we realize that we made a mistake after migrating, we can undo our previous migration, or all of our migrations. After undoing them, we can make any changes necessary to our migration files (They won’t be deleted from the undo, so we don’t need to generate anything! Just make the necessary changes to the files that already exist and save the files.). Running the migrations again will make the tables with the updates reflected.
<ul>
<li><code>npx sequelize-cli db:migrate:undo</code></li>
<li><code>npx sequelize-cli db:migrate:undo:all</code></li>
</ul></li>
</ul></li>
<li><h4 id="models---validations-and-associations">Models - Validations and Associations</h4>
<ul>
<li>In addition to the migration files, our <code>model:generate</code> command also created a model file for us. This file is what allows sequelize to transform the results of its SQL queries into useful JavaScript objects for us.</li>
<li><p>The model is where we can specify a validation that we want to perform before trying to run a SQL query. If the validation fails, we can respond with a message instead of running the query, which can be an expensive operation that we know won’t work.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb79-1" title="1"><span class="co">// Before we make changes, sequelize generates the type that this field represents</span></a>
<a class="sourceLine" id="cb79-2" title="2">specification<span class="op">:</span> <span class="va">DataTypes</span>.<span class="at">TEXT</span></a>
<a class="sourceLine" id="cb79-3" title="3"></a>
<a class="sourceLine" id="cb79-4" title="4"><span class="co">// We can replace the generated format with an object to specify not only the type, but the validations that we want to implement. The validations can also take in messages the respond with on failure and arguments.</span></a>
<a class="sourceLine" id="cb79-5" title="5">specification<span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb79-6" title="6">  <span class="dt">type</span><span class="op">:</span> <span class="va">DataTypes</span>.<span class="at">TEXT</span><span class="op">,</span></a>
<a class="sourceLine" id="cb79-7" title="7">  <span class="dt">validate</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb79-8" title="8">    <span class="dt">notEmpty</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb79-9" title="9">      <span class="dt">msg</span><span class="op">:</span> <span class="st">&#39;The specification cannot be empty&#39;</span></a>
<a class="sourceLine" id="cb79-10" title="10">    <span class="op">},</span></a>
<a class="sourceLine" id="cb79-11" title="11">    <span class="dt">len</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb79-12" title="12">      <span class="dt">args</span><span class="op">:</span> [<span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>]</a>
<a class="sourceLine" id="cb79-13" title="13">      <span class="dt">msg</span><span class="op">:</span> <span class="st">&#39;The specifcation must be between 10 and 100 characters&#39;</span></a>
<a class="sourceLine" id="cb79-14" title="14">    <span class="op">}</span></a>
<a class="sourceLine" id="cb79-15" title="15">  <span class="op">}</span></a>
<a class="sourceLine" id="cb79-16" title="16"><span class="op">}</span></a></code></pre></div></li>
<li><p>Another key part of the model file is setting up our associations. We can use the <code>belongsTo</code>, <code>hasMany</code>, and <code>belongsToMany</code> methods to set up model-level associations. Doing so is what creates the helpful functionality like <code>addOwner</code> that we saw in the pets example, a function that automatically generates the SQL necessary to create a petOwner record and supplies the appropriate petId and ownerId.</p>
<ul>
<li>In a one-to-many association, we need to have a <code>belongsTo</code> association on the “many” side, and a <code>hasMany</code> association on the “one” side:
<ul>
<li><code>Instruction.belongsTo(models.Recipe, { foreignKey: 'recipeId' });</code></li>
<li><code>Recipe.hasMany(models.Instruction, { foreignKey: 'recipeId' });</code></li>
</ul></li>
<li><p>In a many-to-many association, we need to have a <code>belongsToMany</code> on each side of the association. We generally specify a columnMapping object to show the association more clearly:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb80-1" title="1"><span class="co">// In our Owner model</span></a>
<a class="sourceLine" id="cb80-2" title="2"><span class="co">// To connect this Owner to a Pet through the PetOwner</span></a>
<a class="sourceLine" id="cb80-3" title="3"><span class="kw">const</span> columnMapping <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb80-4" title="4">  <span class="dt">through</span><span class="op">:</span> <span class="st">&quot;PetOwner&quot;</span><span class="op">,</span> <span class="co">// joins table</span></a>
<a class="sourceLine" id="cb80-5" title="5">  <span class="dt">otherKey</span><span class="op">:</span> <span class="st">&quot;petId&quot;</span><span class="op">,</span> <span class="co">// key that connects to other table we have a many association with</span></a>
<a class="sourceLine" id="cb80-6" title="6">  <span class="dt">foreignKey</span><span class="op">:</span> <span class="st">&quot;ownerId&quot;</span><span class="op">,</span> <span class="co">// our foreign key in the joins table</span></a>
<a class="sourceLine" id="cb80-7" title="7"><span class="op">};</span></a>
<a class="sourceLine" id="cb80-8" title="8"><span class="va">Owner</span>.<span class="at">belongsToMany</span>(<span class="va">models</span>.<span class="at">Pet</span><span class="op">,</span> columnMapping)<span class="op">;</span></a>
<a class="sourceLine" id="cb80-9" title="9"></a>
<a class="sourceLine" id="cb80-10" title="10"><span class="co">// In our Pet model</span></a>
<a class="sourceLine" id="cb80-11" title="11"><span class="co">// To connect this Pet to an Owner through the PetOwner</span></a>
<a class="sourceLine" id="cb80-12" title="12"><span class="kw">const</span> columnMapping <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb80-13" title="13">  <span class="dt">through</span><span class="op">:</span> <span class="st">&quot;PetOwner&quot;</span><span class="op">,</span> <span class="co">// joins table</span></a>
<a class="sourceLine" id="cb80-14" title="14">  <span class="dt">otherKey</span><span class="op">:</span> <span class="st">&quot;ownerId&quot;</span><span class="op">,</span> <span class="co">// key that connects to other table we have a many association with</span></a>
<a class="sourceLine" id="cb80-15" title="15">  <span class="dt">foreignKey</span><span class="op">:</span> <span class="st">&quot;petId&quot;</span><span class="op">,</span> <span class="co">// our foreign key in the joins table</span></a>
<a class="sourceLine" id="cb80-16" title="16"><span class="op">};</span></a>
<a class="sourceLine" id="cb80-17" title="17"><span class="va">Pet</span>.<span class="at">belongsToMany</span>(<span class="va">models</span>.<span class="at">Owner</span><span class="op">,</span> columnMapping)<span class="op">;</span></a></code></pre></div></li>
</ul></li>
</ul></li>
</ul>
<ol start="3" type="1">
<li>How to perform CRUD operations with Sequelize</li>
</ol>
<ul>
<li><h4 id="seed-files">Seed Files</h4>
<ul>
<li>Seed files can be used to populate our database with starter data.
<ul>
<li><code>npx sequelize-cli seed:generate --name add-cats</code></li>
<li><code>up</code> indicates what to create when we seed our database, <code>down</code> indicates what to delete if we want to unseed the database.</li>
<li><p>For our up, we use the <code>queryInterface.bulkInsert()</code> method, which takes in the name of the table to seed and an array of objects representing the records we want to create:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb81-1" title="1">up<span class="op">:</span> (queryInterface<span class="op">,</span> Sequelize) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb81-2" title="2">  <span class="cf">return</span> <span class="va">queryInterface</span>.<span class="at">bulkInsert</span>(<span class="st">&quot;&lt;&lt;TableName&gt;&gt;&quot;</span><span class="op">,</span> [</a>
<a class="sourceLine" id="cb81-3" title="3">    <span class="op">{</span> <span class="dt">field1</span><span class="op">:</span> value1a<span class="op">,</span> <span class="dt">field2</span><span class="op">:</span> value2a <span class="op">},</span></a>
<a class="sourceLine" id="cb81-4" title="4">    <span class="op">{</span> <span class="dt">field1</span><span class="op">:</span> value1b<span class="op">,</span> <span class="dt">field2</span><span class="op">:</span> value2b <span class="op">},</span></a>
<a class="sourceLine" id="cb81-5" title="5">    <span class="op">{</span> <span class="dt">field1</span><span class="op">:</span> value1c<span class="op">,</span> <span class="dt">field2</span><span class="op">:</span> value2c <span class="op">},</span></a>
<a class="sourceLine" id="cb81-6" title="6">  ])<span class="op">;</span></a>
<a class="sourceLine" id="cb81-7" title="7"><span class="op">};</span></a></code></pre></div></li>
<li>For our down, we use the <code>queryInterface.bulkDelete()</code> method, which takes in the name of the table and an object representing our WHERE clause. Unseeding will delete all records from the specified table that match the WHERE clause.</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb82-1" title="1"><span class="co">// If we want to specify what to remove:</span></a>
<a class="sourceLine" id="cb82-2" title="2">down<span class="op">:</span> (queryInterface<span class="op">,</span> Sequelize) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb82-3" title="3">  <span class="cf">return</span> <span class="va">queryInterface</span>.<span class="at">bulkDelete</span>(<span class="st">&quot;&lt;&lt;TableName&gt;&gt;&quot;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb82-4" title="4">    <span class="dt">field1</span><span class="op">:</span> [value1a<span class="op">,</span> value1b<span class="op">,</span> value1c]<span class="op">,</span> <span class="co">//...etc.</span></a>
<a class="sourceLine" id="cb82-5" title="5">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb82-6" title="6"><span class="op">};</span></a>
<a class="sourceLine" id="cb82-7" title="7"><span class="co">// If we want to remove everything from the table:</span></a>
<a class="sourceLine" id="cb82-8" title="8">down<span class="op">:</span> (queryInterface<span class="op">,</span> Sequelize) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb82-9" title="9">  <span class="cf">return</span> <span class="va">queryInterface</span>.<span class="at">bulkDelete</span>(<span class="st">&quot;&lt;&lt;TableName&gt;&gt;&quot;</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="op">{}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb82-10" title="10"><span class="op">};</span></a></code></pre></div>
<ul>
<li>Running <code>npx sequelize-cli db:seed:all</code> will run all of our seeder files.</li>
<li><code>npx sequelize-cli db:seed:undo:all</code> will undo all of our seeding.</li>
<li>If we omit the <code>:all</code> we can run specific seed files</li>
</ul></li>
</ul></li>
<li><h4 id="inserting-with-build-and-create">Inserting with Build and Create</h4>
<ul>
<li><p>In addition to seed files, which we generally use for starter data, we can create new records in our database by using <code>build</code> and <code>save</code>, or the combined <code>create</code></p>
<ul>
<li>Use the .build method of the Cat model to create a new Cat instance in index.js</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb83-1" title="1"><span class="co">// Constructs an instance of the JavaScript `Cat` class. **Does not</span></a>
<a class="sourceLine" id="cb83-2" title="2"><span class="co">// save anything to the database yet**. Attributes are passed in as a</span></a>
<a class="sourceLine" id="cb83-3" title="3"><span class="co">// POJO.</span></a>
<a class="sourceLine" id="cb83-4" title="4"><span class="kw">const</span> newCat <span class="op">=</span> <span class="va">Cat</span>.<span class="at">build</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb83-5" title="5">  <span class="dt">firstName</span><span class="op">:</span> <span class="st">&quot;Markov&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb83-6" title="6">  <span class="dt">specialSkill</span><span class="op">:</span> <span class="st">&quot;sleeping&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb83-7" title="7">  <span class="dt">age</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></a>
<a class="sourceLine" id="cb83-8" title="8"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb83-9" title="9"></a>
<a class="sourceLine" id="cb83-10" title="10"><span class="co">// This actually creates a new `Cats` record in the database. We must</span></a>
<a class="sourceLine" id="cb83-11" title="11"><span class="co">// wait for this asynchronous operation to succeed.</span></a>
<a class="sourceLine" id="cb83-12" title="12"><span class="cf">await</span> <span class="va">newCat</span>.<span class="at">save</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb83-13" title="13"></a>
<a class="sourceLine" id="cb83-14" title="14"><span class="co">// This builds and saves all in one step. If we don&#39;t need to perform any operations on the instance before saving it, this can optimize our code.</span></a>
<a class="sourceLine" id="cb83-15" title="15"><span class="kw">const</span> newerCat <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">create</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb83-16" title="16">  <span class="dt">firstName</span><span class="op">:</span> <span class="st">&quot;Whiskers&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb83-17" title="17">  <span class="dt">specialSkill</span><span class="op">:</span> <span class="st">&quot;sleeping&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb83-18" title="18">  <span class="dt">age</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb83-19" title="19"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div></li>
</ul></li>
<li><h4 id="updating-records">Updating Records</h4>
<ul>
<li>When we have a reference to an instance of a model (i.e. after we have queried for it or created it), we can update values by simply reassigning those fields and using the <code>save</code> method</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb84-1" title="1"><span class="co">// Get a reference to the cat record that we want to update (here just the cat with primary key of 1)</span></a>
<a class="sourceLine" id="cb84-2" title="2"><span class="kw">const</span> cat <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findByPk</span>(<span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb84-3" title="3"></a>
<a class="sourceLine" id="cb84-4" title="4"><span class="co">// Change cat&#39;s attributes.</span></a>
<a class="sourceLine" id="cb84-5" title="5"><span class="va">cat</span>.<span class="at">firstName</span> <span class="op">=</span> <span class="st">&quot;Curie&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb84-6" title="6"><span class="va">cat</span>.<span class="at">specialSkill</span> <span class="op">=</span> <span class="st">&quot;jumping&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb84-7" title="7"><span class="va">cat</span>.<span class="at">age</span> <span class="op">=</span> <span class="dv">123</span><span class="op">;</span></a>
<a class="sourceLine" id="cb84-8" title="8"></a>
<a class="sourceLine" id="cb84-9" title="9"><span class="co">// Save the new name to the database.</span></a>
<a class="sourceLine" id="cb84-10" title="10"><span class="cf">await</span> <span class="va">cat</span>.<span class="at">save</span>()<span class="op">;</span></a></code></pre></div></li>
<li><h4 id="deleting-records">Deleting Records</h4>
<ul>
<li>When we have a reference to an instance of a model, we can delete that record by using <code>destroy</code></li>
</ul>
<div class="sourceCode" id="cb85"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb85-1" title="1"><span class="kw">const</span> cat <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findByPk</span>(<span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb85-2" title="2"><span class="co">// Remove the Markov record.</span></a>
<a class="sourceLine" id="cb85-3" title="3"><span class="cf">await</span> <span class="va">cat</span>.<span class="at">destroy</span>()<span class="op">;</span></a></code></pre></div>
<ul>
<li>We can also call <code>destroy</code> on the model itself. By passing in an object that specifies a where clause, we can destroy all records that match that query</li>
</ul>
<div class="sourceCode" id="cb86"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb86-1" title="1"><span class="cf">await</span> <span class="va">Cat</span>.<span class="at">destroy</span>(<span class="op">{</span> <span class="dt">where</span><span class="op">:</span> <span class="op">{</span> <span class="dt">specialSkill</span><span class="op">:</span> <span class="st">&quot;jumping&quot;</span> <span class="op">}</span> <span class="op">}</span>)<span class="op">;</span></a></code></pre></div></li>
</ul>
<ol start="4" type="1">
<li>How to query using Sequelize</li>
</ol>
<ul>
<li><h4 id="findall">findAll</h4>
<div class="sourceCode" id="cb87"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb87-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb87-2" title="2"><span class="co">// Log the fetched cats.</span></a>
<a class="sourceLine" id="cb87-3" title="3"><span class="co">// The extra arguments to stringify are a replacer and a space respectively</span></a>
<a class="sourceLine" id="cb87-4" title="4"><span class="co">// Here we&#39;re specifying a space of 2 in order to print more legibly</span></a>
<a class="sourceLine" id="cb87-5" title="5"><span class="co">// We don&#39;t want a replacer, so we pass null just so that we can pass a 3rd argument</span></a>
<a class="sourceLine" id="cb87-6" title="6"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><h4 id="where-clause">WHERE clause</h4>
<ul>
<li>Passing an object to findAll can add on clauses to our query</li>
<li>The <code>where</code> key takes an object as a value to indicate what we are filtering by</li>
<li>{ where: { field: value } } =&gt; WHERE field = value</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb88-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb88-2" title="2">  <span class="dt">where</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb88-3" title="3">    <span class="dt">firstName</span><span class="op">:</span> <span class="st">&quot;Markov&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb88-4" title="4">  <span class="op">},</span></a>
<a class="sourceLine" id="cb88-5" title="5"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb88-6" title="6"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><h4 id="or-in-the-where-clause">OR in the WHERE clause</h4>
<ul>
<li>Using an array for the value tells sequelize we want to match any of these values</li>
<li>{ where: { field: [value1, value2] } =&gt; WHERE field IN (value1, value2)</li>
</ul>
<div class="sourceCode" id="cb89"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb89-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb89-2" title="2">  <span class="dt">where</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb89-3" title="3">    <span class="dt">firstName</span><span class="op">:</span> [<span class="st">&quot;Markov&quot;</span><span class="op">,</span> <span class="st">&quot;Curie&quot;</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb89-4" title="4">  <span class="op">},</span></a>
<a class="sourceLine" id="cb89-5" title="5"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb89-6" title="6"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><h4 id="and-in-the-where-clause">AND in the WHERE clause</h4>
<ul>
<li>Providing additional key/value pairs to the where object indicates all filters must match</li>
<li>{ where: { field1: value1, field2: value2 } } =&gt; WHERE field1 = value1 AND field2 = value2</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb90-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb90-2" title="2">  <span class="dt">where</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb90-3" title="3">    <span class="dt">firstName</span><span class="op">:</span> <span class="st">&quot;Markov&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb90-4" title="4">    <span class="dt">age</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></a>
<a class="sourceLine" id="cb90-5" title="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb90-6" title="6"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb90-7" title="7"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><h4 id="sequelize-op-operator">Sequelize Op operator</h4>
<ul>
<li>By requiring Op from the sequelize library we can provide more advanced comparison operators</li>
<li><code>const { Op } = require("sequelize");</code></li>
<li><p>Op.ne: Not equal operator</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb91-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb91-2" title="2">  <span class="dt">where</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb91-3" title="3">    <span class="dt">firstName</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb91-4" title="4">      <span class="co">// All cats where the name is not equal to &quot;Markov&quot;</span></a>
<a class="sourceLine" id="cb91-5" title="5">      <span class="co">// We use brackets in order to evaluate Op.ne and use the value as the key</span></a>
<a class="sourceLine" id="cb91-6" title="6">      [<span class="va">Op</span>.<span class="at">ne</span>]<span class="op">:</span> <span class="st">&quot;Markov&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb91-7" title="7">    <span class="op">},</span></a>
<a class="sourceLine" id="cb91-8" title="8">  <span class="op">},</span></a>
<a class="sourceLine" id="cb91-9" title="9"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb91-10" title="10"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><p>Op.and: and operator</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb92-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb92-2" title="2">  <span class="dt">where</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb92-3" title="3">    <span class="co">// The array that Op.and points to must all be true</span></a>
<a class="sourceLine" id="cb92-4" title="4">    <span class="co">// Here, we find cats where the name is not &quot;Markov&quot; and the age is 4</span></a>
<a class="sourceLine" id="cb92-5" title="5">    [<span class="va">Op</span>.<span class="at">and</span>]<span class="op">:</span> [<span class="op">{</span> <span class="dt">firstName</span><span class="op">:</span> <span class="op">{</span> [<span class="va">Op</span>.<span class="at">ne</span>]<span class="op">:</span> <span class="st">&quot;Markov&quot;</span> <span class="op">}</span> <span class="op">},</span> <span class="op">{</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">4</span> <span class="op">}</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb92-6" title="6">  <span class="op">},</span></a>
<a class="sourceLine" id="cb92-7" title="7"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb92-8" title="8"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><p>Op.or: or operator</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb93-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb93-2" title="2">  <span class="dt">where</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb93-3" title="3">    <span class="co">// One condition in the array that Op.or points to must be true</span></a>
<a class="sourceLine" id="cb93-4" title="4">    <span class="co">// Here, we find cats where the name is &quot;Markov&quot; or where the age is 4</span></a>
<a class="sourceLine" id="cb93-5" title="5">    [<span class="va">Op</span>.<span class="at">or</span>]<span class="op">:</span> [<span class="op">{</span> <span class="dt">firstName</span><span class="op">:</span> <span class="st">&quot;Markov&quot;</span> <span class="op">},</span> <span class="op">{</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">4</span> <span class="op">}</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb93-6" title="6">  <span class="op">},</span></a>
<a class="sourceLine" id="cb93-7" title="7"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb93-8" title="8"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><p>Op.gt and Op.lt: greater than and less than operators</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb94-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb94-2" title="2">  <span class="dt">where</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb94-3" title="3">    <span class="co">// Find all cats where the age is greater than 4</span></a>
<a class="sourceLine" id="cb94-4" title="4">    <span class="dt">age</span><span class="op">:</span> <span class="op">{</span> [<span class="va">Op</span>.<span class="at">gt</span>]<span class="op">:</span> <span class="dv">4</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb94-5" title="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb94-6" title="6">  <span class="op">},</span></a>
<a class="sourceLine" id="cb94-7" title="7">})<span class="op">;</span></a>
<a class="sourceLine" id="cb94-8" title="8"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
</ul></li>
<li><h4 id="ordering-results">Ordering results</h4>
<ul>
<li>Just like the where clause, we can pass an order key to specify we want our results ordered</li>
<li>The key <code>order</code> points to an array with the fields that we want to order by</li>
<li>By default, the order is ascending, just like standard SQL. If we want to specify descending, we can instead use a nested array with the field name as the first element and “DESC” as the second element. (We could also specify “ASC” as a second element in a nested array, but it is unnecessary as it is default)</li>
</ul>
<div class="sourceCode" id="cb95"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb95-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb95-2" title="2">  <span class="co">// Order by age descending, then by firstName ascending if cats have the same age</span></a>
<a class="sourceLine" id="cb95-3" title="3">  <span class="dt">order</span><span class="op">:</span> [[<span class="st">&quot;age&quot;</span><span class="op">,</span> <span class="st">&quot;DESC&quot;</span>]<span class="op">,</span> <span class="st">&quot;firstName&quot;</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb95-4" title="4"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb95-5" title="5"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><h4 id="limiting-results">Limiting results</h4>
<ul>
<li>We can provide a <code>limit</code> key in order to limit our results to a specified number</li>
</ul>
<div class="sourceCode" id="cb96"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb96-1" title="1"><span class="kw">const</span> cats <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findAll</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb96-2" title="2">  <span class="dt">order</span><span class="op">:</span> [[<span class="st">&quot;age&quot;</span><span class="op">,</span> <span class="st">&quot;DESC&quot;</span>]]<span class="op">,</span></a>
<a class="sourceLine" id="cb96-3" title="3">  <span class="co">// Here we are limiting our results to one record. It will still return an array, just with one object inside. We could have said any number here, the result is always an array.</span></a>
<a class="sourceLine" id="cb96-4" title="4">  <span class="dt">limit</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb96-5" title="5"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb96-6" title="6"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cats<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><h4 id="findone">findOne</h4>
<ul>
<li>If we only want one record to be returned we can use findOne instead of findAll</li>
<li>If multiple records would have matched our findOne query, it will return the first record</li>
<li>Unlike findAll, findOne will return the object directly instead of an array. If no records matched the query it will return null.</li>
</ul>
<div class="sourceCode" id="cb97"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb97-1" title="1"><span class="co">// finds the oldest cat</span></a>
<a class="sourceLine" id="cb97-2" title="2"><span class="kw">const</span> cat <span class="op">=</span> <span class="cf">await</span> <span class="va">Cat</span>.<span class="at">findOne</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb97-3" title="3">  <span class="dt">order</span><span class="op">:</span> [[<span class="st">&quot;age&quot;</span><span class="op">,</span> <span class="st">&quot;DESC&quot;</span>]]<span class="op">,</span></a>
<a class="sourceLine" id="cb97-4" title="4"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb97-5" title="5"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(cat<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></a></code></pre></div></li>
<li><h4 id="querying-with-associations">Querying with Associations</h4>
<ul>
<li>We can include associated data by adding an <code>include</code> key to our options object</li>
</ul>
<div class="sourceCode" id="cb98"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb98-1" title="1"><span class="kw">const</span> pet <span class="op">=</span> <span class="va">Pet</span>.<span class="at">findByPk</span>(<span class="dv">1</span><span class="op">,</span> <span class="op">{</span> <span class="dt">include</span><span class="op">:</span> [PetType<span class="op">,</span> Owner] <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb98-2" title="2"><span class="va">console</span>.<span class="at">log</span>(</a>
<a class="sourceLine" id="cb98-3" title="3">  <span class="va">pet</span>.<span class="at">id</span><span class="op">,</span></a>
<a class="sourceLine" id="cb98-4" title="4">  <span class="va">pet</span>.<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb98-5" title="5">  <span class="va">pet</span>.<span class="at">age</span><span class="op">,</span></a>
<a class="sourceLine" id="cb98-6" title="6">  <span class="va">pet</span>.<span class="at">petTypeId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb98-7" title="7">  <span class="va">pet</span>.<span class="va">PetType</span>.<span class="at">type</span><span class="op">,</span></a>
<a class="sourceLine" id="cb98-8" title="8">  <span class="va">pet</span>.<span class="at">Owners</span></a>
<a class="sourceLine" id="cb98-9" title="9">)<span class="op">;</span></a></code></pre></div>
<ul>
<li>We can get nested associations by having <code>include</code> point to an object that specifies which <code>model</code> we have an association with, then chaining an association on with another <code>include</code></li>
</ul>
<div class="sourceCode" id="cb99"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb99-1" title="1"><span class="kw">const</span> owner <span class="op">=</span> <span class="va">Owner</span>.<span class="at">findByPk</span>(<span class="dv">1</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb99-2" title="2">  <span class="dt">include</span><span class="op">:</span> <span class="op">{</span> <span class="dt">model</span><span class="op">:</span> Pet<span class="op">,</span> <span class="dt">include</span><span class="op">:</span> PetType <span class="op">},</span></a>
<a class="sourceLine" id="cb99-3" title="3"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb99-4" title="4"><span class="va">console</span>.<span class="at">log</span>(</a>
<a class="sourceLine" id="cb99-5" title="5">  <span class="va">pet</span>.<span class="at">id</span><span class="op">,</span></a>
<a class="sourceLine" id="cb99-6" title="6">  <span class="va">pet</span>.<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb99-7" title="7">  <span class="va">pet</span>.<span class="at">age</span><span class="op">,</span></a>
<a class="sourceLine" id="cb99-8" title="8">  <span class="va">pet</span>.<span class="at">petTypeId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb99-9" title="9">  <span class="va">pet</span>.<span class="va">PetType</span>.<span class="at">type</span><span class="op">,</span></a>
<a class="sourceLine" id="cb99-10" title="10">  <span class="va">pet</span>.<span class="at">Owners</span></a>
<a class="sourceLine" id="cb99-11" title="11">)<span class="op">;</span></a></code></pre></div></li>
</ul>
<ol start="5" type="1">
<li>How to perform data validations with Sequelize</li>
</ol>
<ul>
<li>See the database migrations section above.</li>
<li>In general, we add in a validate key to each field that we want validations for. This key points to an object that specifies all of the validations we want to make on that field, such as <code>notEmpty</code>, <code>notNull</code>, <code>len</code>, <code>isIn</code>, etc.</li>
</ul>
<div class="sourceCode" id="cb100"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb100-1" title="1">specification<span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb100-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="va">DataTypes</span>.<span class="at">TEXT</span><span class="op">,</span></a>
<a class="sourceLine" id="cb100-3" title="3">  <span class="dt">validate</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb100-4" title="4">    <span class="dt">notEmpty</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb100-5" title="5">      <span class="dt">msg</span><span class="op">:</span> <span class="st">&#39;The specification cannot be empty&#39;</span></a>
<a class="sourceLine" id="cb100-6" title="6">    <span class="op">},</span></a>
<a class="sourceLine" id="cb100-7" title="7">    <span class="dt">len</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb100-8" title="8">      <span class="dt">args</span><span class="op">:</span> [<span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>]</a>
<a class="sourceLine" id="cb100-9" title="9">      <span class="dt">msg</span><span class="op">:</span> <span class="st">&#39;The specifcation must be between 10 and 100 characters&#39;</span></a>
<a class="sourceLine" id="cb100-10" title="10">    <span class="op">}</span></a>
<a class="sourceLine" id="cb100-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb100-12" title="12"><span class="op">}</span></a></code></pre></div>
<ol start="6" type="1">
<li>How to use transactions with Sequelize</li>
</ol>
<ul>
<li>We can create a transaction block in order to make sure either all operations are performed or none of them are</li>
<li>We use the <code>.transaction</code> method in order to create our block. The method takes in a callback with an argument to track our transaction id (typically just a simple <code>tx</code> variable).</li>
<li>All of our sequelize operations can be passed a <code>transaction</code> key on their options argument which points to our transaction id. This indicates that this operation is part of the transaction block and should only be executed in the database when the whole block executes without error.</li>
</ul>
<div class="sourceCode" id="cb101"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb101-1" title="1"><span class="kw">async</span> <span class="kw">function</span> <span class="at">main</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb101-2" title="2">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb101-3" title="3">    <span class="co">// Do all database access within the transaction.</span></a>
<a class="sourceLine" id="cb101-4" title="4">    <span class="cf">await</span> <span class="va">sequelize</span>.<span class="at">transaction</span>(<span class="kw">async</span> (tx) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb101-5" title="5">      <span class="co">// Fetch Markov and Curie&#39;s accounts.</span></a>
<a class="sourceLine" id="cb101-6" title="6">      <span class="kw">const</span> markovAccount <span class="op">=</span> <span class="cf">await</span> <span class="va">BankAccount</span>.<span class="at">findByPk</span>(<span class="dv">1</span><span class="op">,</span> <span class="op">{</span> <span class="dt">transaction</span><span class="op">:</span> tx <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-7" title="7">      <span class="kw">const</span> curieAccount <span class="op">=</span> <span class="cf">await</span> <span class="va">BankAccount</span>.<span class="at">findByPk</span>(<span class="dv">2</span><span class="op">,</span> <span class="op">{</span> <span class="dt">transaction</span><span class="op">:</span> tx <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-8" title="8"></a>
<a class="sourceLine" id="cb101-9" title="9">      <span class="co">// No one can mess with Markov or Curie&#39;s accounts until the</span></a>
<a class="sourceLine" id="cb101-10" title="10">      <span class="co">// transaction completes! The account data has been locked!</span></a>
<a class="sourceLine" id="cb101-11" title="11"></a>
<a class="sourceLine" id="cb101-12" title="12">      <span class="co">// Increment Curie&#39;s balance by $5,000.</span></a>
<a class="sourceLine" id="cb101-13" title="13">      <span class="va">curieAccount</span>.<span class="at">balance</span> <span class="op">+=</span> <span class="dv">5000</span><span class="op">;</span></a>
<a class="sourceLine" id="cb101-14" title="14">      <span class="cf">await</span> <span class="va">curieAccount</span>.<span class="at">save</span>(<span class="op">{</span> <span class="dt">transaction</span><span class="op">:</span> tx <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-15" title="15"></a>
<a class="sourceLine" id="cb101-16" title="16">      <span class="co">// Decrement Markov&#39;s balance by $5,000.</span></a>
<a class="sourceLine" id="cb101-17" title="17">      <span class="va">markovAccount</span>.<span class="at">balance</span> <span class="op">-=</span> <span class="dv">5000</span><span class="op">;</span></a>
<a class="sourceLine" id="cb101-18" title="18">      <span class="cf">await</span> <span class="va">markovAccount</span>.<span class="at">save</span>(<span class="op">{</span> <span class="dt">transaction</span><span class="op">:</span> tx <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-19" title="19">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-20" title="20">  <span class="op">}</span> <span class="cf">catch</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb101-21" title="21">    <span class="co">// Report if anything goes wrong.</span></a>
<a class="sourceLine" id="cb101-22" title="22">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Error!&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-23" title="23"></a>
<a class="sourceLine" id="cb101-24" title="24">    <span class="cf">for</span> (<span class="kw">const</span> e <span class="kw">of</span> <span class="va">err</span>.<span class="at">errors</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb101-25" title="25">      <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`</span><span class="sc">${</span><span class="va">e</span>.<span class="va">instance</span>.<span class="at">clientName</span><span class="sc">}</span><span class="vs">: </span><span class="sc">${</span><span class="va">e</span>.<span class="at">message</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-26" title="26">    <span class="op">}</span></a>
<a class="sourceLine" id="cb101-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb101-28" title="28"></a>
<a class="sourceLine" id="cb101-29" title="29">  <span class="cf">await</span> <span class="va">sequelize</span>.<span class="at">close</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb101-30" title="30"><span class="op">}</span></a>
<a class="sourceLine" id="cb101-31" title="31"></a>
<a class="sourceLine" id="cb101-32" title="32"><span class="at">main</span>()<span class="op">;</span></a></code></pre></div>
</body>
</html>
