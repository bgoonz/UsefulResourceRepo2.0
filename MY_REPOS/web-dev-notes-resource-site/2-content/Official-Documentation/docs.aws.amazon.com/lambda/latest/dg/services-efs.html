<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/services-efs.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:02:53 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Using Amazon EFS with Lambda - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="services-efs" />
      <meta name="default_state" content="services-efs" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="services-efs.html" />
      <meta name="description" content="Lambda integrates with Amazon Elastic File System (Amazon EFS) to support secure, shared file system access for Lambda applications. You can configure functions to mount a file system during initialization with the NFS protocol over the local network within a VPC. Lambda manages the connection and encrypts all traffic to and from the file system." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Using Amazon EFS with Lambda - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#services-efs" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/services-efs.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/services-efs.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/services-efs.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/services-efs.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="lambda-dg.pdf#services-efs" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/services-efs.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#services-efs-connections">Connections</a><a href="#services-efs-throughput">Throughput</a><a href="#services-efs-iops">IOPS</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="services-efs">Using Amazon EFS with Lambda</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>Lambda integrates with Amazon Elastic File System (Amazon EFS) to support secure,
                                    shared file system access for Lambda applications. You
                                    can configure functions to mount a file system during initialization with the NFS
                                    protocol over the local network
                                    within a VPC. Lambda manages the connection and encrypts all traffic to and from the
                                    file system. 
                                 </p>
                                 <p>The file system and the Lambda function must be in the same region. A Lambda function
                                    in one account can mount a file system
                                    in a different account. For this scenario, you configure VPC peering between the function
                                    VPC and the file system
                                    VPC. 
                                 </p>
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>To configure a function to connect to a file system, see <a href="configuration-filesystem.html">Configuring file system access for Lambda functions</a>.
                                       </p>
                                    </div>
                                 </div>
                                 <p>Amazon EFS supports <a href="https://docs.aws.amazon.com/efs/latest/ug/how-it-works.html#consistency">file locking</a> to prevent corruption
                                    if multiple functions try to write to the same file system at the same time. Locking
                                    in Amazon EFS follows the NFS
                                    v4.1 protocol for advisory locking, and enables your applications to use both whole
                                    file and byte range
                                    locks.
                                 </p>
                                 <p>Amazon EFS provides options to customize your file system based on your application's
                                    need to maintain high
                                    performance at scale. There are three primary factors to consider: the number of connections,
                                    throughput (in MiB per
                                    second), and IOPS.
                                 </p>
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Quotas</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>For detail on file system quotas and limits, see <a href="https://docs.aws.amazon.com/efs/latest/ug/limits.html#limits-fs-specific">Quotas for
                                             Amazon EFS file systems</a> in the <em>Amazon Elastic File System User Guide</em>.
                                       </p>
                                    </div>
                                 </div>
                                 <p>To avoid issues with scaling, throughput, and IOPS, monitor the <a href="https://docs.aws.amazon.com/efs/latest/ug/monitoring-cloudwatch.html">metrics</a> that Amazon EFS sends to Amazon CloudWatch. For an overview of
                                    monitoring in Amazon EFS, see <a href="https://docs.aws.amazon.com/efs/latest/ug/monitoring_overview.html">Monitoring Amazon EFS</a> in the
                                    <em>Amazon Elastic File System User Guide</em>.
                                 </p>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Sections</strong></p>
                                    <ul>
                                       <li><a href="#services-efs-connections">Connections</a></li>
                                       <li><a href="#services-efs-throughput">Throughput</a></li>
                                       <li><a href="#services-efs-iops">IOPS</a></li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="services-efs-connections">Connections</h2>
                                 
                                 
                                 <p>Amazon EFS supports up to 25,000 connections per file system. During initialization,
                                    each instance of
                                    a function creates a single connection to its file system that persists across invocations.
                                    This means that you
                                    can reach 25,000 concurrency across one or more functions connected to a file system.
                                    To limit the
                                    number of connections a function creates, use <a href="configuration-concurrency.html">reserved
                                       concurrency</a>.
                                 </p>
                                 
                                 
                                 <p>However, when you make changes to your function's code or configuration at scale,
                                    there is a temporary
                                    increase in the number of function instances beyond the current concurrency. Lambda
                                    provisions new instances to
                                    handle new requests and there is some delay before old instances close their connections
                                    to the file system. To
                                    avoid hitting the maximum connections limit during a deployment, use <a href="lambda-rolling-deployments.html">rolling deployments</a>. With rolling deployments, you gradually shift traffic to the new version each time
                                    you make a change.
                                 </p>
                                 
                                 
                                 <p>If you connect to the same file system from other services such as Amazon EC2, you
                                    should also be aware of the
                                    scaling behavior of connections in Amazon EFS. A file system supports the creation
                                    of up to 3,000 connections in a
                                    burst, after which it supports 500 new connections per minute. This matches <a href="invocation-scaling.html">burst scaling</a> behavior in Lambda, which applies across all functions in a Region. But if you are
                                    creating
                                    connections outside of Lambda, your functions may not be able to scale at full speed.
                                 </p>
                                 
                                 
                                 <p>To monitor and trigger an alarm on connections, use the <code class="code">ClientConnections</code> metric.
                                 </p>
                                  
                                 
                                 <h2 id="services-efs-throughput">Throughput</h2>
                                 
                                 
                                 <p>At scale, it is also possible to exceed the maximum <em>throughput</em> for a file system. In
                                    <em>bursting mode</em> (the default), a file system has a low baseline throughput that scales
                                    linearly with its size. To allow for bursts of activity, the file system is granted
                                    burst credits that allow it to
                                    use 100 MiB/s or more of throughput. Credits accumulate continually and are expended
                                    with every read and write
                                    operation. If the file system runs out of credits, it throttles read and write operations
                                    beyond the baseline
                                    throughput, which can cause invocations to time out.
                                 </p>
                                 
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>If you use <a href="configuration-concurrency.html">provisioned concurrency</a>, your function can
                                          consume burst credits even when idle. With provisioned concurrency, Lambda initializes
                                          instances of your function
                                          before it is invoked, and recycles instances every few hours. If you use files on
                                          an attached file system during
                                          initialization, this activity can use all of your burst credits.
                                       </p>
                                    </div>
                                 </div>
                                 
                                 
                                 <p>To monitor and trigger an alarm on throughput, use the <code class="code">BurstCreditBalance</code> metric. It should
                                    increase when your function's concurrency is low and decrease when it is high. If
                                    it always decreases or does not
                                    accumulate enough during low activity to cover peak traffic, you may need to limit
                                    your function's concurrency or
                                    enable <a href="https://docs.aws.amazon.com/efs/latest/ug/performance.html#throughput-modes">provisioned throughput</a>.
                                 </p>
                                  
                                 
                                 <h2 id="services-efs-iops">IOPS</h2>
                                 
                                 
                                 <p>Input/output operations per second (IOPS) is a measurement of the number of read and
                                    write operations
                                    processed by the file system. In general purpose mode, IOPS is limited in favor of
                                    lower latency, which is
                                    beneficial for most applications.
                                 </p>
                                 
                                 
                                 <p>To monitor and alarm on IOPS in general purpose mode, use the <code class="code">PercentIOLimit</code> metric. If this
                                    metric reaches 100%, your function can time out waiting for read and write operations
                                    to complete.
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="services-alb.html">Elastic Load Balancing</div>
                                    <div id="next" class="next-link" accesskey="n" href="services-iot.html">IoT</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/services-efs.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/services-efs.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/services-efs.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:02:54 GMT -->
</html>