<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<link rel="stylesheet" href="./prism.css">
<script async defer src="./prism.js"></script>
</head>
<body>;
<h1 id="week-15-front-end-state-management" data-ignore="true">WEEK 15<br><em>Front-End State Management</em></h1>
<hr />
<!-- code_chunk_output -->
<p><a href="#redux-learning-objectives-part-1"><strong>Redux Learning Objectives: Part 1</strong></a> - <a href="#redux-explained"><strong>Redux Explained</strong></a> - <a href="#where-did-redux-come-from">Where did Redux come from?</a> - <a href="#when-is-it-appropriate-to-use-redux">When is it appropriate to use Redux?</a> - <a href="#vocabulary">Vocabulary</a> - <a href="#flux-and-redux"><strong>Flux and Redux</strong></a> - <a href="#what-is-flux">What is Flux?</a> - <a href="#redux">Redux</a> - <a href="#store-2"><strong>Store</strong></a> - <a href="#creating-the-store">Creating the store</a> - <a href="#store-api">Store API</a> - <a href="#updating-the-store">Updating the store</a> - <a href="#subscribing-to-the-store">Subscribing to the store</a> - <a href="#reviewing-a-simple-example">Reviewing a simple example</a> - <a href="#reducers"><strong>Reducers</strong></a> - <a href="#updating-the-reducer-to-handle-additional-action-types">Updating the reducer to handle additional action types</a> - <a href="#avoiding-state-mutations">Avoiding state mutations</a> - <a href="#actions-2"><strong>Actions</strong></a> - <a href="#using-action-creators">Using action creators</a> - <a href="#preventing-typos-in-action-type-string-literals">Preventing typos in action type string literals</a> - <a href="#reviewing-a-completed-fruit-stand-example">Reviewing a completed Fruit Stand example</a> - <a href="#debugging-arrow-functions"><strong>Debugging Arrow Functions</strong></a> - <a href="#understanding-the-limitations-of-implicit-return-values">Understanding the limitations of implicit return values</a> - <a href="#rewriting-an-arrow-function-to-use-an-explicit-return-statement">Rewriting an arrow function to use an explicit return statement</a> - <a href="#redux-to-do-list-project"><em>Redux To-do List Project</em></a></p>
<p><a href="#redux-learning-objectives-part-2"><strong>Redux Learning Objectives: Part 2</strong></a> - <a href="#using-redux-with-react"><strong>Using Redux with React</strong></a> - <a href="#integrating-redux-into-a-react-application">Integrating Redux into a React application</a> - <a href="#organizing-your-redux-code">Organizing your Redux code</a> - <a href="#writing-redux-aware-react-components">Writing Redux aware React components</a> - <a href="#reviewing-a-completed-fruit-stand-example-1">Reviewing a completed Fruit Stand example</a> - <a href="#splitting-and-combining-reducers"><strong>Splitting and Combining Reducers</strong></a> - <a href="#splitting-reducers">Splitting reducers</a> - <a href="#combining-reducers">Combining reducers</a> - <a href="#delegating-to-reducers">Delegating to reducers</a> - <a href="#destructuring-state-in-your-component">Destructuring State in your component</a> - <a href="#reviewing-a-completed-fruit-stand-example-2">Reviewing a completed Fruit Stand example</a> - <a href="#container-components"><strong>Container Components</strong></a> - <a href="#comparing-presentational-and-container-components">Comparing presentational and container components</a> - <a href="#determining-where-to-create-containers">Determining where to create containers</a> - <a href="#writing-a-container-component">Writing a container component</a> - <a href="#reviewing-a-completed-fruit-stand-example-3">Reviewing a completed Fruit Stand example</a> - <a href="#freezing-objects"><strong>Freezing Objects</strong></a> - <a href="#using-objectfreeze-to-prevent-state-mutations">Using <code>Object.freeze</code> to prevent state mutations</a> - <a href="#preloaded-state"><strong>Preloaded State</strong></a> - <a href="#creating-a-store-with-preloaded-state">Creating a store with preloaded state</a> - <a href="#creating-local-storage-helper-functions">Creating local storage helper functions</a> - <a href="#saving-state-to-local-storage">Saving state to local storage</a> - <a href="#loading-state-from-local-storage">Loading state from local storage</a> - <a href="#react-and-redux-to-do-list-project"><em>React and Redux To-Do List Project</em></a></p>
<p><a href="#redux-learning-objectives-part-3"><strong>Redux Learning Objectives: Part 3</strong></a> - <a href="#higher-order-components"><strong>Higher-Order Components</strong></a> - <a href="#reviewing-higher-order-functions">Reviewing higher-order functions</a> - <a href="#leveraging-higher-order-components-hocs">Leveraging higher-order components (HOCs)</a> - <a href="#using-hocs-to-keep-code-dry">Using HOCs to keep code DRY</a> - <a href="#reviewing-a-completed-fruit-stand-example-4">Reviewing a completed Fruit Stand example</a> - <a href="#react-redux-provider"><strong>React-Redux: <code>&lt;Provider/&gt;</code></strong></a> - <a href="#understanding-the-advantages-of-the-provider-component">Understanding the advantages of the <code>&lt;Provider /&gt;</code> component</a> - <a href="#adding-provider">Adding <code>&lt;Provider /&gt;</code></a> - <a href="#understanding-how-provider-relates-to-the-react-context-api">Understanding how <code>&lt;Provider /&gt;</code> relates to the React Context API</a> - <a href="#react-redux-connect-1"><strong>React-Redux: <code>connect()</code></strong></a> - <a href="#calling-connect">Calling <code>connect</code></a> - <a href="#defining-mapstatetopropsstate-ownprops">Defining <code>mapStateToProps(state, [ownProps])</code></a> - <a href="#defining-mapdispatchtoprops">Defining <code>mapDispatchToProps</code></a> - <a href="#putting-it-all-together">Putting it all together</a> - <a href="#reviewing-a-completed-fruit-stand-example-5">Reviewing a completed Fruit Stand example</a> - <a href="#selectors"><strong>Selectors</strong></a> - <a href="#writing-a-selector">Writing a selector</a> - <a href="#selector-examples">Selector examples</a> - <a href="#middleware-1"><strong>Middleware</strong></a> - <a href="#applying-middleware-to-a-redux-store">Applying middleware to a Redux store</a> - <a href="#reviewing-the-signature-of-middleware-functions">Reviewing the signature of middleware functions</a> - <a href="#creating-your-own-logger-middleware">Creating your own <code>logger</code> middleware</a> - <a href="#installing-and-applying-the-redux-logger-middleware">Installing and applying the <code>redux-logger</code> middleware</a> - <a href="#thunks-1"><strong>Thunks</strong></a> - <a href="#looking-at-how-thunks-work">Looking at how thunks work</a> - <a href="#reviewing-a-concrete-example">Reviewing a concrete example</a> - <a href="#reviewing-a-completed-fruit-stand-example-6">Reviewing a completed Fruit Stand example</a> - <a href="#advanced-containers"><strong>Advanced Containers</strong></a> - <a href="#knowing-when-to-break-the-rules">Knowing when to break the rules</a> - <a href="#redux-developer-tools"><strong>Redux Developer Tools</strong></a> - <a href="#instructions">Instructions</a> - <a href="#use">Use</a> - <a href="#resources">Resources</a> - <a href="#redux-based-pokedex-project"><em>Redux-Based Pokedex Project</em></a> - <a href="#giphy-search-project"><em>Giphy Search Project</em></a></p>
<p><a href="#hooks-objectives"><strong>Hooks Objectives</strong></a> - <a href="#intro-to-react-hooks"><strong>Intro to React Hooks</strong></a> - <a href="#usestate">useState</a> - <a href="#useeffect">useEffect</a> - <a href="#usecontext">useContext</a> - <a href="#introduction-to-hooks-in-redux"><strong>Introduction to Hooks in Redux</strong></a> - <a href="#using-hooks-with-redux">Using hooks with Redux</a> - <a href="#getting-started-1">Getting Started</a> - <a href="#useselector"><code>useSelector</code></a> - <a href="#usedispatch"><code>useDispatch</code></a> - <a href="#refactoring-an-existing-component">Refactoring an existing component</a> - <a href="#additional-resources">Additional resources</a> - <a href="#starting-point-for-ip-address-project">Starting point for IP address project</a> - <a href="#react-router-hooks"><strong>React Router Hooks</strong></a> - <a href="#useparams"><code>useParams</code></a> - <a href="#usehistory"><code>useHistory</code></a> - <a href="#uselocation"><code>useLocation</code></a> - <a href="#useroutematch"><code>useRouteMatch</code></a> - <a href="#bring-it-together">Bring it together</a> - <a href="#react-hooks-documentation"><strong>React Hooks Documentation</strong></a> - <a href="#why-hooks">Why hooks?</a> - <a href="#hook-basics">Hook basics</a> - <a href="#more-about-hooks">More about hooks</a> - <a href="#pokedex-hooks-project-phase-1"><em>Pokedex Hooks Project: Phase 1</em></a> - <a href="#pokedex-hooks-project-phase-2"><em>Pokedex Hooks Project: Phase 2</em></a> - <a href="#pokedex-hooks-project-phase-3"><em>Pokedex Hooks Project: Phase 3</em></a></p>
<p><a href="#websockets-learning-objectives"><strong>WebSockets Learning Objectives</strong></a> - <a href="#websockets-overview"><strong>WebSockets Overview</strong></a> - <a href="#key-points-about-web-sockets">Key points about Web sockets</a> - <a href="#client-side-code">Client-side code</a> - <a href="#server-side-code">Server-side code</a> - <a href="#websocket-server-applications"><strong>WebSocket Server Applications</strong></a> - <a href="#websocket-client-applications"><strong>WebSocket Client Applications</strong></a> - <a href="#tic-tac-toe-online-project"><em>Tic-Tac-Toe Online Project</em></a></p>
<p><a href="#react-solo-project-expectations"><strong>React Solo Project Expectations</strong></a> - <a href="#react-project"><em>React Project</em></a> - <a href="#homework">Homework</a> - <a href="#planning-day">Planning Day</a> - <a href="#project-ideas">Project ideas</a></p>
<!-- /code_chunk_output -->
<hr />
<hr />
<h1 id="week-15-day-1-redux" data-ignore="true">WEEK-15 DAY-1<br><em>Redux</em></h1>
<hr />
<h1 id="redux-learning-objectives-part-1">Redux Learning Objectives: Part 1</h1>
<p>You’ve been using React’s Context API to manage global state to share the same information across multiple components. Redux, like Context, gives you a way to store and manage global state in your React applications. Even though Context has become a popular option since its introduction, Redux remains a popular option for projects with sophisticated global state requirements.</p>
<p>After reading and practicing how to use Redux, you should be able to:</p>
<ul>
<li>Describe the Redux data cycle</li>
<li>Describe the role of the store in the Redux architecture</li>
<li>Explain what a <em>reducer</em> is</li>
<li>Use the <code>createStore</code> method to create an instance of a Redux store</li>
<li>Use the <code>store.dispatch</code> method to dispatch an action to trigger a state update</li>
<li>Use the <code>store.subscribe</code> method to listen for state updates</li>
<li>Use the <code>store.getState</code> method to get the current state</li>
<li>Use a <code>switch</code> statement within a reducer function to handle multiple action types</li>
<li>Describe why it’s important for a reducer to avoid mutating the current state when creating the next state</li>
<li>Write an action creator function to facilitate in the creation of action objects</li>
<li>Use constants to define action types to prevent simple typos in action type string literals</li>
</ul>
<hr />
<h1 id="redux-explained">Redux Explained</h1>
<p>Redux is a JavaScript framework for managing the frontend state of a web application. It allows us to store information in an organized manner in a web app and to quickly retrieve that information from anywhere in the app. Redux is modeled on a few previous web technologies including <a href="http://elm-lang.org/docs">Elm</a> and <a href="images/redux-flux.pngimages/redux-flux.png">Flux</a>.</p>
<p>Advantages of Redux include:</p>
<ul>
<li>It simplifies some of the more cumbersome aspects of Flux</li>
<li>It is very lightweight; the library only takes up 2 kbs</li>
<li>It is very fast (the time to insert or retrieve data is low)</li>
<li>It is predictable (interacting with the data store in the same way repeatedly will produce the same effect)</li>
</ul>
<h2 id="where-did-redux-come-from">Where did Redux come from?</h2>
<p>Redux was created by Dan Abramov in 2015. It was initially intended as an experiment to create a simplified version of Flux. Abramov wanted to remove some of what he saw as the unnecessary boilerplate code that was required to create a Flux app.</p>
<p>Abramov also wanted to eliminate some of the aspects of development he found frustrating. When trying to debug a web app, one must often go through the series of steps that cause the bug to occur each time the code is changed. This quickly becomes repetitive and frustrating. Abramov envisioned dev tools that would allow one to undo or replay a series of actions at the click of a button. This idea became the Redux DevTools.</p>
<p>The reason this works is that Redux updates the state using pure functions called reducers (see below for definitions), so one can simply replay a series of actions and be guaranteed to arrive at the same final state. As Redux was developed it also became more convenient to use a single object to store the state, as opposed to traditional Flux which uses multiple stores.</p>
<p>These design choices allowed for the creation of an ecosystem of powerful Redux tools and extensions. Over time three principles were recognized as central to the philosophy of Redux. They are:</p>
<ul>
<li><p><strong>A Single Source of Truth</strong> The state for an entire Redux app is stored in a single, plain JavaScript object.</p></li>
<li><p><strong>State is Read Only</strong> The state object cannot be directly modified. Instead it is modified by dispatching actions.</p></li>
<li><p><strong>Changes Are Made with Pure Functions</strong> The reducers that receive the actions and return updated state are pure functions of the old state and the action.</p></li>
</ul>
<p>Beyond this, a guiding meta-philosophy of Redux is the idea that in a software library restrictions can be just as important as features. Redux deliberately places significant restrictions on the way state can be stored and updated, but in return it allows easy implementation of a number of powerful features that would be extremely difficult to write using a less restrictive framework.</p>
<h2 id="when-is-it-appropriate-to-use-redux">When is it appropriate to use Redux?</h2>
<p>Initially, Redux grew in popularity, quickly moving beyond its initial plan as an experiment. As of early 2016 it had over 3,000,000 downloads. The Redux repository on GitHub has over 50,000 stars, and Redux is now used by a number of companies including Exana, Patreon, and ClassPass.</p>
<p>Since the introduction of Redux, Context has been added to React. Context, like Redux, gives you a way to store and manage global state in your React applications. For projects with simpler global state requirements, Context has become a popular alternative to using Redux.</p>
<p>Context is built into React so there’s no need to install an additional library as a dependency. Context is also simpler overall and generally requires less work to get up and running. All that being said, for projects with more sophisticated global state requirements, Redux remains a popular option. Redux offers greater flexibility with support for middleware and richer developer tools in the form of the Redux DevTools.</p>
<h2 id="vocabulary">Vocabulary</h2>
<p>Learning how to use Redux requires you to understand a fair amount of terminology. For now, don’t worry about memorizing all of the following terms; it’s good enough to just have a general awareness. You’ll revisit each of these terms as you work your way through this lesson.</p>
<h3 id="state">State</h3>
<p>Ex: "<em>Redux is a state manager.</em>"</p>
<p>The <em>state</em> of a program means all the information stored by that program at a particular point in time. It is generally used to refer to the data stored by the program at a particular instance in time, as opposed to the logic of the program, which doesn’t change over time. The job of Redux is to store the state of your app and make it available to entire app.</p>
<h3 id="store">Store</h3>
<p>Ex: "<em>Redux stores state in a single store.</em>"</p>
<p>The Redux store is a single JavaScript object with a few methods, including <code>getState</code>, <code>dispatch(action)</code>, and <code>subscribe(listener)</code>. Any state you want Redux to handle is held in the store.</p>
<h3 id="actions">Actions</h3>
<p>Ex: "<em>The Redux store is updated by dispatching actions.</em>"</p>
<p>An action is a POJO (plain old JavaScript object) with a <code>type</code> property. Actions contain information that can be used to update the store. They can be <em>dispatched</em>, i.e. sent to the store, in response to user actions or AJAX requests. Typically Redux apps use functions called <em>action creators</em> that return actions. Action creators can take arguments which allow them to customize the data contained in the actions they generate.</p>
<h3 id="pure-functions">Pure functions</h3>
<p>Ex: "<em>Redux reducers are pure functions.</em>"</p>
<p>A function is pure if its behavior depends only its arguments and it has no side effects. This means the function can’t depend on the value of any variables that aren’t passed to it as arguments, and it can’t alter the state of the program or any variable existing outside itself. It simply takes in arguments and returns a value.</p>
<h3 id="reducer">Reducer</h3>
<p>Ex: "<em>Redux handles actions using reducers.</em>"</p>
<p>A reducer is a function that is called each time an action is dispatched. The reducer receives an action and the current state as arguments and returns an updated state.</p>
<p>Redux reducers are required to be pure functions of the dispatched action and the current state. This makes their behavior very predictable and allows their effects to potentially be reversed.</p>
<h3 id="middleware">Middleware</h3>
<p>Ex: "<em>You can customize your response to dispatched actions using middleware.</em>"</p>
<p>Middleware is an optional component of Redux that allows custom responses to dispatched actions. When an action is dispatched, it passes through each middleware that has been added to the state. The middleware can take some action in response and chose whether or not to pass the action on down the chain. Behind the scenes, the middleware actually replaces the dispatch method of the store with a customized version. There is a large ecosystem of existing middleware ready to be plugged into any Redux projects. One example is a logger that records each action before passing it on to the reducer. Perhaps the most common use for middleware is to dispatch asynchronous requests to a server.</p>
<h3 id="time-traveling-dev-tools">Time traveling dev tools</h3>
<p>Ex: "<em>Redux has time traveling dev tools.</em>"</p>
<p>Redux reducers are pure functions of the dispatched action and the current state. This means that if one were to store a list of the previous states over time and the actions that had been dispatched, one could retroactively cancel an action and recalculate the state as if that action had never been dispatched. This is precisely the functionality that the Redux DevTools provide. The dev tools can be added as middleware to any Redux project. They allow you to look back through the history of the state and toggle past actions on and off to see a live recalculation of the state. This ability to revert to a previous state is what is meant by time travel.</p>
<h3 id="thunks">Thunks</h3>
<p>Ex: "<em>Thunks are a convenient format for taking asynchronous actions in Redux.</em>"</p>
<p>The traditional approach to middleware closely parallels the format of reducers. The actions being dispatched are POJOs with types and various middleware files are waiting to receive them. These files check the type of the action using a case statement just like reducers.</p>
<p>Thunks are an alternative approach. A thunk is a general concept in computer science referring to a function whose primary purpose is simply to call another function. In Redux a thunk action creator returns a function rather than an object. When they are dispatched, thunk actions are intercepted by a piece of middleware that simply checks if each action is a function. If it is, that function is called with the state and dispatch as arguments, otherwise it is passed on down the chain. Thunks are most commonly used to make asynchronous API requests.</p>
<h2 id="what-you-learned">What you learned</h2>
<p>In this article, you learned what Redux is and where it came from. You also learned when it’s appropriate to use Redux and some of the vocabulary terms used by Redux.</p>
<h2 id="see-also">See also…</h2>
<p>The <a href="http://redux.js.org/">official Redux documentation</a> is a great resource for learning more about Redux. To see who’s using Redux, see this page on <a href="https://stackshare.io/reduxjs">StackShare</a>.</p>
<hr />
<h1 id="flux-and-redux">Flux and Redux</h1>
<p>Redux is an evolution of the concepts introduced by Flux. Having a general understanding of Flux will assist you in learning Redux.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Describe the relationship between Redux and Flux</li>
<li>Describe the three principles that Redux abides by</li>
<li>Describe the Redux data cycle</li>
</ul>
<h2 id="what-is-flux">What is Flux?</h2>
<p>Flux is a front-end application architecture Facebook developed to use with React. Flux is not a library or framework. Flux is simply a pattern in which to structure one’s application. It doesn’t even need to be used with React! Flux provides unidirectional data flow, which affords more predictability than one might encounter when using other application design patterns.</p>
<figure>
<img src="images/redux-flux.pngimages/redux-flux.png" alt="flux" /><figcaption>flux</figcaption>
</figure>
<h3 id="actions-1">Actions</h3>
<p>An action begins the flow of data in Flux. An action is a simple object that at a minimum contains a <code>type</code>. An action’s <code>type</code> indicates the type of change to be performed on the application’s state. An action may contain additional data (the "payload") that’s necessary for changing the application’s former state to its next one.</p>
<h3 id="dispatcher">Dispatcher</h3>
<p>The dispatcher is a mechanism for distributing (or "dispatching") actions to a Flux application’s store. The dispatcher is little more than a registry of callback functions into the store. Redux (the implementation of Flux we’ll use at ) consolidates the dispatcher into a single <code>dispatch()</code> function.</p>
<h3 id="store-1">Store</h3>
<p>The store represents the entire state of the application. It’s also responsible for updating the state of the application appropriately whenever it receives an action. It does so by registering with the dispatcher a callback function that receives an action. This callback function uses the action’s type to invoke the proper function to change the application’s state. After the store has changed state, it "emits a change," i.e. the store passes the new state to any views (explanation incoming) that have registered listeners (callbacks) to it.</p>
<h3 id="view">View</h3>
<p>A view is a unit of code that’s responsible for rendering the user interface. To complete the Flux pattern, a view listens to change events emitted by the store. When a change to the application’s data layer occurs, a view can respond appropriately, such as by updating its internal state and triggering a re-render.</p>
<p>A view can create actions itself, e.g. in user-triggered events. If a user marks a todo as complete, a view might call a function that would dispatch an action to toggle the todo’s state. Creating an action from the view turns our Flux pattern into a unidirectional loop.</p>
<figure>
<img src="https://-open-assets.s3-us-west-1.amazonaws.com/fullstack/react/assets/flux-loop.png" alt="flux-loop" /><figcaption>flux-loop</figcaption>
</figure>
<p>Here the original action might (for example) result from an asynchronous request to fetch todos from the database with a success callback to dispatch our action to receive those todos and update the application’s state accordingly. It’s a common pattern in Flux to dispatch an action that populates the initial state of the application, with further modifications coming from the client.</p>
<h2 id="redux">Redux</h2>
<p>Redux is a library (distributed as an npm package) that facilitates a particular implementation of Flux. A Redux loop behaves slightly differently than a vanilla Flux loop, but the general concepts remain the same. Redux abides by three principles:</p>
<ol type="1">
<li><strong>Single Source of Truth</strong>: The entire state of the application is stored in a single JavaScript object in a single store. This object is commonly referred to as a "state tree" because its values often contain or are objects themselves.</li>
<li><strong>State is Read-Only</strong>: The only way to change the state is to dispatch an action. This principle ensures that our Redux loop is never short-circuited and change of state remains single-threaded.</li>
<li><strong>Only Pure Functions Change State</strong>: Pure functions known as "reducers" receive the previous state and an action and return the next state. They return new state objects instead of mutating previous state. Read <a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-pure-function-d1c076bec976#.lfv7bgqco">more</a> about what makes a function pure.</li>
</ol>
<figure>
<img src="https://assets.aaonline.io/fullstack/react/assets/redux.gif" alt="redux-loop" /><figcaption>redux-loop</figcaption>
</figure>
<p>As you’ve probably already surmised, <code>React</code> will be our view layer.</p>
<blockquote>
<p><strong>Note:</strong> Middleware is an ecosystem of utilities that augments the functionality of <code>dispatch()</code>. Among other things, it allows for asynchronous requests in a Redux application.</p>
</blockquote>
<p>You’ll learn more about each part in the Redux loop in this lesson.</p>
<h2 id="what-you-learned-1">What you learned</h2>
<p>In this article, you learned about the relationship between Redux and Flux. You also learned about the three principles that Redux abides by and the Redux data cycle.</p>
<hr />
<h1 id="store-2">Store</h1>
<p>The <strong>store</strong> is the central element of Redux’s architecture. It holds the global <strong>state</strong> of an application. The store is responsible for updating the global state via its <strong>reducer</strong>, broadcasting state updates via <strong>subscription</strong>, and listening for <strong>actions</strong> that tell it when to update the state.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Describe the role of the store in the Redux architecture</li>
<li>Use the <code>createStore</code> method to create an instance of the Redux store</li>
<li>Use the <code>store.dispatch</code> method to dispatch an action to trigger a state update</li>
<li>Use the <code>store.subscribe</code> method to listen for state updates</li>
<li>Use the <code>store.getState</code> method to get the current state</li>
</ul>
<h2 id="creating-the-store">Creating the store</h2>
<p>The <code>redux</code> library provides us with a <code>createStore()</code> method, which takes up to three arguments and returns a Redux store.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="at">createStore</span>(reducer<span class="op">,</span> [preloadedState]<span class="op">,</span> [enhancer])<span class="op">;</span></a></code></pre></div>
<ul>
<li><code>reducer</code> (required) - A reducing function that receives the store’s current state and incoming action, determines how to update the store’s state, and returns the next state (more on this in a moment).</li>
<li><code>preloadedState</code> (optional) - An <code>object</code> representing any application state that existed before the store was created.</li>
<li><code>enhancer</code> (optional) - A <code>function</code> that adds extra functionality to the store.</li>
</ul>
<blockquote>
<p>You’ll learn more about how to use the <code>preloadedState</code> and <code>enhancer</code> parameters later in this lesson. For now you’ll focus on creating a store with just the single required <code>reducer</code> parameter.</p>
</blockquote>
<p>Here is an example of how to create a store for a Fruit Stand application:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="co">// </span><span class="al">TODO</span><span class="co"> implement reducer</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(fruitReducer)<span class="op">;</span></a></code></pre></div>
<p>A Redux application will typically only have a single store. You’ll implement the <code>reducer</code> function in just a bit.</p>
<h2 id="store-api">Store API</h2>
<p>A Redux store is just an object that holds the application state, wrapped in a minimalist API. The store has three methods: <code>getState()</code>, <code>dispatch(action)</code>, and <code>subscribe(callback)</code>.</p>
<h3 id="store-methods">Store methods</h3>
<ul>
<li><code>getState()</code> - Returns the store’s current state.</li>
<li><code>dispatch(action)</code> - Passes an <code>action</code> into the store’s <code>reducer</code> telling it what information to update.</li>
<li><code>subscribe(callback)</code> - Registers a callback to be triggered whenever the store updates. Returns a function, which when invoked, unsubscribes the callback function from the store.</li>
</ul>
<h2 id="updating-the-store">Updating the store</h2>
<p>Store updates can only be triggered by dispatching <strong>actions</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="va">store</span>.<span class="at">dispatch</span>(action)<span class="op">;</span></a></code></pre></div>
<p>An <code>action</code> in Redux is just a plain object with:</p>
<ul>
<li>a <code>type</code> key indicating the action being performed, and</li>
<li>optional payload keys containing any new information.</li>
</ul>
<p>For example, the store for your Fruit Stand application would handle the inventory. You would use the following <code>addOrange</code> action to add an orange to the store’s state. Notice how it has a <code>type</code> of ‘ADD_FRUIT’ and a <code>fruit</code> payload of ‘orange’:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> addOrange <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="dt">fruit</span><span class="op">:</span> <span class="st">&#39;orange&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="op">};</span></a></code></pre></div>
<p>When <code>store.dispatch()</code> is called, the store passes its current <code>state</code>, along with the <code>action</code> being dispatched, to the <code>reducer</code>. The <code>reducer</code> function takes the two arguments (<code>state</code> and <code>action</code>) and returns the next <code>state</code>. You’ll read more about the <code>reducer</code> in just a bit, but for now, think of it as a Redux app’s traffic cop, routing new information to its rightful place in the state.</p>
<p>A <code>reducer</code> for the Fruit Stand application looks like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="cf">case</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb5-4" title="4">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> <span class="va">action</span>.<span class="at">fruit</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb5-6" title="6">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="op">};</span></a></code></pre></div>
<p>The reducer’s <code>state</code> parameter provides a default value; this is the <strong>initial state</strong> of our store prior to any actions. In this case, it’s an empty array. In Redux, <a href="https://github.com/reactjs/redux/issues/758"><strong>the state is immutable</strong></a>, so the reducer must return a <strong>new array or object</strong> whenever the state changes.</p>
<p>Now that you’ve defined your app’s reducing function, you can now <code>dispatch</code> the <code>addOrange</code> action to the store:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span> <span class="co">// []</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="va">store</span>.<span class="at">dispatch</span>(addOrange)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span> <span class="co">// [ &#39;orange&#39; ]</span></a></code></pre></div>
<h2 id="subscribing-to-the-store">Subscribing to the store</h2>
<p>Once the store has processed a <code>dispatch()</code>, it triggers all its subscribers. Subscribers are callbacks that can be added to the store via <code>subscribe()</code>.</p>
<p>You can define a callback <code>display</code> and subscribe it to the store:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> display <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">const</span> unsubscribeDisplay <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(display)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="va">store</span>.<span class="at">dispatch</span>(addOrange)<span class="op">;</span> <span class="co">// [ &#39;orange&#39;, &#39;orange&#39; ]</span></a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">// display will no longer be invoked after store.dispatch()</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="at">unsubscribeDisplay</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-11" title="11"></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="va">store</span>.<span class="at">dispatch</span>(addOrange)<span class="op">;</span> <span class="co">// no output</span></a></code></pre></div>
<p>In the example above, the store processed the dispatched action and then called all of its subscribers in response. The only subscriber is your <code>display</code> callback which logs the current state when called.</p>
<blockquote>
<p>Later in this lesson, you’ll learn how to use the <code>store.subscribe()</code> method to connect a React component to the store so that it can listen for global state updates.</p>
</blockquote>
<h2 id="reviewing-a-simple-example">Reviewing a simple example</h2>
<p>Later in this lesson, you’ll see how to use Redux with React and how to organize your Redux code into separate modules, but for now to keep things as simple as possible, you’ll put everything into a single file and use Node.js to run your application.</p>
<p>Here’s an <code>app.js</code> file that brings together all of the above code snippets into a single example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="co">// app.js</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">const</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;redux&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">// Define the store&#39;s reducer.</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-8" title="8">    <span class="cf">case</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb8-9" title="9">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> <span class="va">action</span>.<span class="at">fruit</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb8-10" title="10">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb8-11" title="11">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb8-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="op">};</span></a>
<a class="sourceLine" id="cb8-14" title="14"></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="co">// Create the store.</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(fruitReducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-17" title="17"></a>
<a class="sourceLine" id="cb8-18" title="18"><span class="co">// Define an &#39;ADD_FRUIT&#39; action for adding an orange to the store.</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="kw">const</span> addOrange <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-20" title="20">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-21" title="21">  <span class="dt">fruit</span><span class="op">:</span> <span class="st">&#39;orange&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-22" title="22"><span class="op">};</span></a>
<a class="sourceLine" id="cb8-23" title="23"></a>
<a class="sourceLine" id="cb8-24" title="24"><span class="co">// Log to the console the store&#39;s state before and after</span></a>
<a class="sourceLine" id="cb8-25" title="25"><span class="co">// dispatching the &#39;ADD_FRUIT&#39; action.</span></a>
<a class="sourceLine" id="cb8-26" title="26"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span> <span class="co">// []</span></a>
<a class="sourceLine" id="cb8-27" title="27"><span class="va">store</span>.<span class="at">dispatch</span>(addOrange)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-28" title="28"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span> <span class="co">// [ &#39;orange&#39; ]</span></a>
<a class="sourceLine" id="cb8-29" title="29"></a>
<a class="sourceLine" id="cb8-30" title="30"><span class="co">// Define and register a callback to listen for store updates</span></a>
<a class="sourceLine" id="cb8-31" title="31"><span class="co">// and console log the store&#39;s state.</span></a>
<a class="sourceLine" id="cb8-32" title="32"><span class="kw">const</span> display <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-33" title="33">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb8-34" title="34"><span class="op">};</span></a>
<a class="sourceLine" id="cb8-35" title="35"><span class="kw">const</span> unsubscribeDisplay <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(display)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-36" title="36"></a>
<a class="sourceLine" id="cb8-37" title="37"><span class="co">// Dispatch the &#39;ADD_FRUIT&#39; action. This time the `display` callback</span></a>
<a class="sourceLine" id="cb8-38" title="38"><span class="co">// will be called by the store when its state is updated.</span></a>
<a class="sourceLine" id="cb8-39" title="39"><span class="va">store</span>.<span class="at">dispatch</span>(addOrange)<span class="op">;</span> <span class="co">// [ &#39;orange&#39;, &#39;orange&#39; ]</span></a>
<a class="sourceLine" id="cb8-40" title="40"></a>
<a class="sourceLine" id="cb8-41" title="41"><span class="co">// Unsubscribe the `display` callback to stop listening for store updates.</span></a>
<a class="sourceLine" id="cb8-42" title="42"><span class="at">unsubscribeDisplay</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-43" title="43"></a>
<a class="sourceLine" id="cb8-44" title="44"><span class="co">// Dispatch the &#39;ADD_FRUIT&#39; action one more time</span></a>
<a class="sourceLine" id="cb8-45" title="45"><span class="co">// to confirm that the `display` method won&#39;t be called</span></a>
<a class="sourceLine" id="cb8-46" title="46"><span class="co">// when the store state is updated.</span></a>
<a class="sourceLine" id="cb8-47" title="47"><span class="va">store</span>.<span class="at">dispatch</span>(addOrange)<span class="op">;</span> <span class="co">// no output</span></a></code></pre></div>
<p>To run the above example, use npm to initialize the project (<code>npm init -y</code>) and to install Redux (<code>npm install redux</code>). Then use the command <code>node app.js</code> to run the example. You should see the following output:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1">[]</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="bu">[</span> <span class="st">&#39;orange&#39;</span><span class="bu"> ]</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="bu">[</span> <span class="st">&#39;orange&#39;</span>, <span class="st">&#39;orange&#39;</span><span class="bu"> ]</span></a></code></pre></div>
<h2 id="what-you-learned-2">What you learned</h2>
<p>In this article, you learned about the role of the store in the Redux architecture. You saw how to use the <code>createStore</code> method to create a store instance, the <code>store.dispatch</code> method to dispatch an action to trigger a state update, the <code>store.subscribe</code> method to listen for state updates, and <code>store.getState</code> method to get the current state.</p>
<h2 id="see-also-1">See also…</h2>
<p>To learn more about the store, see the official <a href="http://redux.js.org/docs/basics/Store.html">Redux documentation</a>.</p>
<hr />
<h1 id="reducers">Reducers</h1>
<p>As you saw in an earlier article, the Redux store has a <strong>reducer</strong> function for updating its state. The reducer function receives the current <code>state</code> and an <code>action</code>, updates the state appropriately based on the <code>action.type</code>, and returns the next state.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Explain what a <em>reducer</em> is</li>
<li>Use a <code>switch</code> statement within a reducer function to handle multiple action types</li>
<li>Describe why it’s important for a reducer to avoid mutating the current state when creating the next state</li>
</ul>
<h2 id="updating-the-reducer-to-handle-additional-action-types">Updating the reducer to handle additional action types</h2>
<p>Recall the reducer from the Fruit Stand application:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">    <span class="cf">case</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb10-4" title="4">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> <span class="va">action</span>.<span class="at">fruit</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb10-6" title="6">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="op">};</span></a></code></pre></div>
<p>When the store initializes, it calls its reducer with an <code>undefined</code> <code>state</code>, allowing the reducer to dictate the store’s initial state via the <code>state</code> parameter’s default value.</p>
<p>The bulk of the reducer function then implements updates to the state. First, the reducer decides what logic to implement based on the <code>action.type</code> <code>switch</code>. Then, it creates and returns a new object representing the next state (after processing the action) if any of the information needs to be changed. The <code>state</code> is returned unchanged if no cases match the <code>action.type</code>, meaning that the reducer doesn’t <em>care</em> about that action (e.g. <code>{type: 'NEW_TRANSFORMERS_SEQUEL'}</code>).</p>
<p>In the above example, the reducer’s initial state is set to an empty array (i.e. <code>[]</code>). The reducer returns a new array with <code>action.fruit</code> appended to the previous <code>state</code> if <code>action.type</code> is <code>'ADD_FRUIT'</code>. Otherwise, it returns the <code>state</code> unchanged.</p>
<p>Additional <code>case</code> clauses can be added to update the reducer to handle the following action types:</p>
<ul>
<li><code>'ADD_FRUITS'</code> - Add an array of fruits to the inventory of fruits</li>
<li><code>'SELL_FRUIT'</code> - Remove the first instance of a fruit if available</li>
<li><code>'SELL_OUT'</code> - Someone bought the whole inventory of fruit! Return an empty array</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-3" title="3">    <span class="cf">case</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-4" title="4">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> <span class="va">action</span>.<span class="at">fruit</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="cf">case</span> <span class="st">&#39;ADD_FRUITS&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-6" title="6">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> ...<span class="va">action</span>.<span class="at">fruits</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7">    <span class="cf">case</span> <span class="st">&#39;SELL_FRUIT&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-8" title="8">      <span class="kw">const</span> index <span class="op">=</span> <span class="va">state</span>.<span class="at">indexOf</span>(<span class="va">action</span>.<span class="at">fruit</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-9" title="9">      <span class="cf">if</span> (index <span class="op">!==</span> <span class="dv">-1</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-10" title="10">        <span class="co">// remove first instance of action.fruit</span></a>
<a class="sourceLine" id="cb11-11" title="11">        <span class="cf">return</span> [...<span class="va">state</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> index)<span class="op">,</span> ...<span class="va">state</span>.<span class="at">slice</span>(index <span class="op">+</span> <span class="dv">1</span>)]<span class="op">;</span></a>
<a class="sourceLine" id="cb11-12" title="12">      <span class="op">}</span></a>
<a class="sourceLine" id="cb11-13" title="13">      <span class="cf">return</span> state<span class="op">;</span> <span class="co">// if action.fruit is not in state, return previous state</span></a>
<a class="sourceLine" id="cb11-14" title="14">    <span class="cf">case</span> <span class="st">&#39;SELL_OUT&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-15" title="15">      <span class="cf">return</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb11-16" title="16">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-17" title="17">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb11-18" title="18">  <span class="op">}</span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="op">};</span></a></code></pre></div>
<h3 id="reviewing-how-arrayslice-works">Reviewing how <code>Array#slice</code> works</h3>
<p>If you don’t regularly use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice"><code>Array#slice</code></a> method, the following expression might look odd at first glance:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1">[...<span class="va">state</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> index)<span class="op">,</span> ...<span class="va">state</span>.<span class="at">slice</span>(index <span class="op">+</span> <span class="dv">1</span>)]</a></code></pre></div>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice"><code>Array#slice</code></a> method returns a new array containing a shallow copy of the array elements indicated by the <code>start</code> and <code>end</code> arguments. The <code>start</code> argument is the index of the first element to include and the <code>end</code> argument is the index of the element to include up to (but not including). If the <code>end</code> argument isn’t provided, all of the array elements up to the end of the array will be included. The original array will not be modified.</p>
<p>By combining two calls to the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice"><code>Array#slice</code></a> method into a new array, a copy of an array can be created that omits an element at a specific index (<code>index</code>):</p>
<ul>
<li><code>state.slice(0, index)</code> - Returns a new array containing the elements starting from index <code>0</code> up to <code>index</code></li>
<li><code>state.slice(index + 1)</code> - Returns a new array containing the elements starting from <code>index + 1</code> (one past the index to omit the element at <code>index</code>) up through the last element in the array</li>
</ul>
<p>Then the spread syntax is used to spread the elements in the slices into a new array.</p>
<p>Here’s a complete example:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">const</span> fruits <span class="op">=</span> [<span class="st">&#39;apple&#39;</span><span class="op">,</span> <span class="st">&#39;apple&#39;</span><span class="op">,</span> <span class="st">&#39;orange&#39;</span><span class="op">,</span> <span class="st">&#39;banana&#39;</span><span class="op">,</span> <span class="st">&#39;watermelon&#39;</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">// The index of the &#39;orange&#39; element is 2.</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">const</span> index <span class="op">=</span> <span class="va">fruits</span>.<span class="at">indexOf</span>(<span class="st">&#39;orange&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">// `...fruits.slice(0, index)` returns the array [&#39;apple&#39;, &#39;apple&#39;]</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">// `...fruits.slice(index + 1)` returns the array [&#39;banana&#39;, &#39;watermelon&#39;]</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">// The spread syntax combines the two array slices into the array</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">// [&#39;apple&#39;, &#39;apple&#39;, &#39;banana&#39;, &#39;watermelon&#39;]</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="kw">const</span> newFruits <span class="op">=</span> [...<span class="va">fruits</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> index)<span class="op">,</span> ...<span class="va">fruits</span>.<span class="at">slice</span>(index <span class="op">+</span> <span class="dv">1</span>)]<span class="op">;</span></a></code></pre></div>
<p>This approach to removing an element from an array is just one way to complete the operation without modifying or mutating the original array.</p>
<h2 id="avoiding-state-mutations">Avoiding state mutations</h2>
<p>Inside a Redux reducer, you must never mutate its arguments (i.e. <code>state</code> and <code>action</code>). <strong>Your reducer must return a new object if the state changes</strong>. <a href="https://github.com/reactjs/redux/issues/758">Here’s why</a>.</p>
<p>Here’s an example of a <em>bad</em> reducer which mutates the previous state.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">const</span> badReducer <span class="op">=</span> (state <span class="op">=</span> <span class="op">{</span> <span class="dt">count</span><span class="op">:</span> <span class="dv">0</span> <span class="op">},</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-3" title="3">    <span class="cf">case</span> <span class="st">&#39;INCREMENT_COUNTER&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb14-4" title="4">      <span class="va">state</span>.<span class="at">count</span><span class="op">++;</span></a>
<a class="sourceLine" id="cb14-5" title="5">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb14-6" title="6">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb14-7" title="7">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb14-8" title="8">  <span class="op">}</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="op">};</span></a></code></pre></div>
<p>And here’s an example of a good reducer which uses <code>Object.assign</code> to create a shallow duplicate of the previous <code>state</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">const</span> goodReducer <span class="op">=</span> (state <span class="op">=</span> <span class="op">{</span> <span class="dt">count</span><span class="op">:</span> <span class="dv">0</span> <span class="op">},</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="cf">case</span> <span class="st">&#39;INCREMENT_COUNTER&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb15-4" title="4">      <span class="kw">const</span> nextState <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> state)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-5" title="5">      <span class="va">nextState</span>.<span class="at">count</span><span class="op">++;</span></a>
<a class="sourceLine" id="cb15-6" title="6">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb15-7" title="7">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb15-8" title="8">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb15-9" title="9">  <span class="op">}</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="op">};</span></a></code></pre></div>
<h2 id="what-you-learned-3">What you learned</h2>
<p>In this article, you learned about reducers and how to use a <code>switch</code> statement within a reducer function to handle multiple action types. You also learned why it’s important for a reducer to avoid mutating the current state when creating the next state.</p>
<h2 id="see-also-2">See also…</h2>
<p>To learn more about reducers, see the official <a href="https://redux.js.org/basics/reducers">Redux documentation</a>.</p>
<hr />
<h1 id="actions-2">Actions</h1>
<p>As you’ve already learned from an earlier article, <strong>actions</strong> are the only way to trigger changes to the store’s state. Remember, actions are simple POJOs with a mandatory <code>type</code> key and optional payload keys containing new information. They get sent using <code>store.dispatch()</code> and are the primary drivers of the Redux loop.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Write an action creator function to facilitate in the creation of action objects</li>
<li>Use constants to define action types to prevent simple typos in action type string literals</li>
</ul>
<h2 id="using-action-creators">Using action creators</h2>
<p>When an action is dispatched, any new state data must be passed along as the <strong>payload</strong>. The example below passes a payload key of <code>fruit</code> with the new state data, ‘orange’:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">const</span> addOrange <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="dt">fruit</span><span class="op">:</span> <span class="st">&#39;orange&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb16-5" title="5"></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="va">store</span>.<span class="at">dispatch</span>(addOrange)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span> <span class="co">// [ &#39;orange&#39; ]</span></a></code></pre></div>
<p>However, when these action payloads are generated dynamically, it becomes necessary to extrapolate the creation of the action object into a function. These functions are called <strong>action creators</strong>. The JavaScript objects they return are the <strong>actions</strong>. To initiate a dispatch, you pass the result of calling an action creator to <code>store.dispatch()</code>.</p>
<p>For example, an action creator function to create ‘ADD_FRUIT’ actions looks like this:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">const</span> addFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-3" title="3">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb17-4" title="4">    fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="op">};</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="op">};</span></a></code></pre></div>
<p>You can also rewrite the above arrow function to use an implicit return value:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">const</span> addFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-3" title="3">  fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<blockquote>
<p>While either approach for defining action creators using arrow functions works, the latter approach of using an implicit return value makes it more difficult to debug the Redux cycle (you’ll see why later in this lesson).</p>
</blockquote>
<p>Now we can add any <code>fruit</code> to the store using our action creator <code>addFruit(fruit)</code>, instead of having to define an action object for each fruit:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruit</span>(<span class="st">&#39;apple&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruit</span>(<span class="st">&#39;strawberry&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruit</span>(<span class="st">&#39;lychee&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span> <span class="co">// [ &#39;orange&#39;, &#39;apple&#39;, &#39;strawberry&#39;, &#39;lychee&#39; ]</span></a></code></pre></div>
<h2 id="preventing-typos-in-action-type-string-literals">Preventing typos in action type string literals</h2>
<p>Update your actions to include <code>'ADD_FRUIT'</code>, <code>'ADD_FRUITS'</code>, <code>'SELL_FRUIT'</code>, and <code>'SELL_OUT'</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">const</span> ADD_FRUIT <span class="op">=</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw">const</span> ADD_FRUITS <span class="op">=</span> <span class="st">&#39;ADD_FRUITS&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="kw">const</span> SELL_FRUIT <span class="op">=</span> <span class="st">&#39;SELL_FRUIT&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="kw">const</span> SELL_OUT <span class="op">=</span> <span class="st">&#39;SELL_OUT&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb20-5" title="5"></a>
<a class="sourceLine" id="cb20-6" title="6"><span class="kw">const</span> addFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb20-7" title="7">  <span class="dt">type</span><span class="op">:</span> ADD_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb20-8" title="8">  fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-10" title="10"></a>
<a class="sourceLine" id="cb20-11" title="11"><span class="kw">const</span> addFruits <span class="op">=</span> (fruits) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb20-12" title="12">  <span class="dt">type</span><span class="op">:</span> ADD_FRUITS<span class="op">,</span></a>
<a class="sourceLine" id="cb20-13" title="13">  fruits<span class="op">,</span></a>
<a class="sourceLine" id="cb20-14" title="14"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-15" title="15"></a>
<a class="sourceLine" id="cb20-16" title="16"><span class="kw">const</span> sellFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb20-17" title="17">  <span class="dt">type</span><span class="op">:</span> SELL_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb20-18" title="18">  fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb20-19" title="19"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-20" title="20"></a>
<a class="sourceLine" id="cb20-21" title="21"><span class="kw">const</span> sellOut <span class="op">=</span> () <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb20-22" title="22">  <span class="dt">type</span><span class="op">:</span> SELL_OUT<span class="op">,</span></a>
<a class="sourceLine" id="cb20-23" title="23"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Notice that constants were used for all of the fruit action types. This prevents simple typos in the reducer’s case clauses (i.e. <code>'ADD_FRIUT'</code>) from unexpectedly not matching the appropriate action type (i.e. <code>'ADD_FRUIT'</code>). Creating constants for the action type string literals ensures that an error is thrown if the constant name is mistyped.</p>
<h2 id="reviewing-a-completed-fruit-stand-example">Reviewing a completed Fruit Stand example</h2>
<p>To review and run a completed Fruit Stand example application, clone the <a href="https://github.com/-starters/redux-fruit-stand-examples">redux-fruit-stand-examples</a> repo.</p>
<p>After cloning the repo, open a terminal and browse to the <code>fruit-stand-redux</code> folder. Run the command <code>npm install</code> to install the project’s dependencies. Then use the command <code>node app.js</code> to run the Fruit Stand application. You should see the following output:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" title="1"><span class="ex">Default</span> Redux Store (empty fruit list)<span class="bu">:</span></a>
<a class="sourceLine" id="cb21-2" title="2">[]</a>
<a class="sourceLine" id="cb21-3" title="3"><span class="ex">Redux</span> Store:</a>
<a class="sourceLine" id="cb21-4" title="4"><span class="bu">[</span> <span class="st">&#39;orange&#39;</span>, <span class="st">&#39;apple&#39;</span><span class="bu"> ]</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="ex">Redux</span> Store:</a>
<a class="sourceLine" id="cb21-6" title="6"><span class="bu">[</span> <span class="st">&#39;orange&#39;</span>, <span class="st">&#39;apple&#39;</span>, <span class="st">&#39;orange&#39;</span>, <span class="st">&#39;lychee&#39;</span>, <span class="st">&#39;grapefruit&#39;</span><span class="bu"> ]</span></a>
<a class="sourceLine" id="cb21-7" title="7"><span class="ex">Updated</span> Redux Store:</a>
<a class="sourceLine" id="cb21-8" title="8"><span class="bu">[</span> <span class="st">&#39;orange&#39;</span>, <span class="st">&#39;orange&#39;</span>, <span class="st">&#39;lychee&#39;</span>, <span class="st">&#39;grapefruit&#39;</span><span class="bu"> ]</span></a>
<a class="sourceLine" id="cb21-9" title="9"><span class="ex">Reset</span> Redux Store (empty fruit list)<span class="bu">:</span></a>
<a class="sourceLine" id="cb21-10" title="10">[]</a></code></pre></div>
<p>The <code>reduxSAR.js</code> file contains the action types, reducer, store, and action creator functions. The <code>app.js</code> file contains the code that interacts with the Redux store. The <code>appWithSubscription.js</code> file also contains code that interacts with the store but subscribes a callback function (using the <code>store.subscribe</code> method) to listen for and log state updates to the console.</p>
<h2 id="what-you-learned-4">What you learned</h2>
<p>In this article, you learned how to write an action creator function to facilitate in the creation of action objects. You also learned how to use constants to define action types to prevent simple typos in action type string literals.</p>
<h2 id="see-also-3">See also…</h2>
<p>To learn more about actions, see the official <a href="http://redux.js.org/docs/basics/Actions.html">Redux documentation</a>.</p>
<hr />
<h1 id="debugging-arrow-functions">Debugging Arrow Functions</h1>
<p>Arrow functions are ubiquitous in React and Redux. Understanding how to use <code>debugger</code> statements with arrow functions is necessary to be able to effectively debug the Redux cycle.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Describe why <code>debugger</code> statements can’t be used with arrow functions that have an implicit return value</li>
<li>Rewrite an arrow function with an implicit return value to use an explicit return statement so that a <code>debugger</code> statement can be added</li>
</ul>
<h2 id="understanding-the-limitations-of-implicit-return-values">Understanding the limitations of implicit return values</h2>
<p>Here’s an example of a Redux action creator that’s defined using an arrow function with an implicit return value:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">const</span> addFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb22-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb22-3" title="3">  fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb22-4" title="4"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>While using an arrow function with an implicit return value allows you to concisely define <code>addFruit</code>, it’s difficult to debug. Suppose you want to use a <code>debugger</code> statement to stop execution within <code>addFruit</code> to inspect the value of the <code>fruit</code> parameter. You <strong>can’t</strong> do this:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">const</span> addFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb23-2" title="2">  <span class="cf">debugger</span></a>
<a class="sourceLine" id="cb23-3" title="3">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb23-4" title="4">  fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><code>{ type: 'ADD_FRUIT', fruit }</code> is an object, and you can’t put a <code>debugger</code> statement inside of an object. But you also <strong>can’t</strong> do this:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">const</span> addFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb24-2" title="2">  <span class="cf">debugger</span></a>
<a class="sourceLine" id="cb24-3" title="3">  <span class="op">{</span></a>
<a class="sourceLine" id="cb24-4" title="4">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb24-5" title="5">    fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb24-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb24-7" title="7">)<span class="op">;</span></a></code></pre></div>
<p>The parentheses after the fat arrow (<code>=&gt;</code>) are used to indicate that the object <code>{ type: 'ADD_FRUIT', fruit }</code> should be implicitly returned. As a result, the above won’t work, because we can’t put a debugger inside of a return statement.</p>
<h2 id="rewriting-an-arrow-function-to-use-an-explicit-return-statement">Rewriting an arrow function to use an explicit return statement</h2>
<p>To put a <code>debugger</code> statement inside of the <code>addFruit</code> action creator function, you first need to convert it into an arrow function with an explicit return statement:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">const</span> addFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-3" title="3">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb25-4" title="4">    fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb25-5" title="5">  <span class="op">};</span></a>
<a class="sourceLine" id="cb25-6" title="6"><span class="op">};</span></a></code></pre></div>
<p>Now, finally, you can put the <code>debugger</code> statement before the <code>return</code> statement:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb26-1" title="1"><span class="kw">const</span> addFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb26-2" title="2">  <span class="cf">debugger</span><span class="op">;</span></a>
<a class="sourceLine" id="cb26-3" title="3">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb26-4" title="4">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb26-5" title="5">    fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb26-6" title="6">  <span class="op">};</span></a>
<a class="sourceLine" id="cb26-7" title="7"><span class="op">};</span></a></code></pre></div>
<p>If you want to avoid having to do this over and over again as you’re debugging your arrow functions, you can make it a habit to write all of your arrow functions with explicit return statements. Do be aware, however, that writing arrow functions with implicit return values is a common convention in Redux and you will see it often out in the wild.</p>
<h2 id="what-you-learned-5">What you learned</h2>
<p>In this article, you learned why <code>debugger</code> statements can’t be used with arrow functions that have an implicit return value. You also learned how to rewrite an arrow function with an implicit return value to use an explicit return statement so that a <code>debugger</code> statement can be added.</p>
<hr />
<h1 id="redux-to-do-list-project">Redux To-do List Project</h1>
<p>At this point, you understand how to perform CRUD operations with a backend API. You also know how to perform CRUD operations by creating a user interface with React, managing state with React Context, and storing persistent data in local storage. It’s time to create a simple Node to-do list application that utilizes the Redux library and runs in your terminal! This project is intended as a way to practice the basics of Redux before learning how to use Redux within a React application.</p>
<p>In today’s project, you will:</p>
<ul>
<li>Generate a Redux <strong>store</strong> by using the <code>createStore</code> method from the Redux library</li>
<li>Set up a <strong>reducer</strong> to direct different action types to interact with the Redux store in different ways</li>
<li>Set up <strong>actions</strong> to create a task, delete a task, and reset the task list</li>
<li>Use the <code>store.getState</code> method to access the data stored in the Redux store</li>
<li>Use the <code>store.dispatch</code> method to <strong>dispatch</strong> actions to the Redux store</li>
<li>Use the <code>store.subscribe</code> method to subscribe to Redux store changes</li>
<li>Use the VS Code debugger to follow the Redux cycle</li>
</ul>
<h2 id="phase-1-create-redux-store-actions-and-reducer">Phase 1: Create Redux store, actions, and reducer</h2>
<p>Run the following commands in your terminal to create a new project directory, generate a <code>package.json</code> file, and install <code>redux</code> as a dependency:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb27-1" title="1"><span class="fu">mkdir</span> redux-todos <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> redux-todos</a>
<a class="sourceLine" id="cb27-2" title="2"><span class="ex">npm</span> init -y <span class="kw">&amp;&amp;</span> <span class="ex">npm</span> install redux</a></code></pre></div>
<p>Now it’s time to create your first Redux project! Create a <code>reduxStoreActionReducer.js</code> file and import the <code>createStore</code> method from Redux. You’ll need to use CommonJS module syntax (<code>module.exports</code> and <code>require</code>) to be able to run the project within the Node environment:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">const</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;redux&#39;</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="store-3">Store</h3>
<p>You’ll use the <code>createStore</code> method to generate your Redux store by invoking it with a reducer. As a reminder, each application should only have one Redux store where all of an application’s state is managed. This is unlike using React Context, where a single React application can utilize multiple contexts.</p>
<p>Conceptually speaking, you can think of the reducer as a function that helps manage the Redux store by routing actions based on their <code>type</code> attribute. Based on the official Redux documentation on the <a href="https://redux.js.org/api/createstore/">createStore</a> method and its parameters, a reducer is a "reducing function that returns the next state tree, given the current state tree and an action to handle."</p>
<p>Now that we’ve gone over a conceptual overview of reducers, let’s create a <code>tasksReducer</code> to manage the to-do list tasks in your Redux store!</p>
<p>Define the <code>tasksReducer</code> function and have it take in the Redux store’s <code>state</code> and an <code>action</code> as parameters. You’ll want the <code>state</code> to default to an empty (<code>[]</code>) if the <code>tasksReducer</code> is invoked without a state. Since you invoke the <code>createStore</code> method with the <code>tasksReducer</code>, you’ll need to define the <code>tasksReducer</code> before invoking the <code>createStore</code> method to generate the Redux store.</p>
<blockquote>
<p><strong>Note:</strong> this project uses an array to store the tasks instead of an object to make it easier to delete a positional task, since there is no user interface that will expose the task ID needed to dispatch task deletion. In the case of this project, a <code>taskId</code> will refer to the index of a task in the array.</p>
</blockquote>
<div class="sourceCode" id="cb29"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">const</span> tasksReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb29-2" title="2">  <span class="co">// </span><span class="al">TODO</span><span class="co">: Set up switch statement to manage actions based on type</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb29-4" title="4"></a>
<a class="sourceLine" id="cb29-5" title="5"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(tasksReducer)<span class="op">;</span></a></code></pre></div>
<p>The underlying code in the store returned by the <code>createStore</code> method will automatically invoke the <code>tasksReducer</code> function whenever an action is dispatched. Speaking of actions, let’s set up the <code>createTask</code>, <code>deleteTask</code>, and <code>resetTaskList</code> actions before finishing the <code>tasksReducer</code> function that conceptually <em>routes</em> action objects (think of how it makes more sense to create a component before setting up a <code>&lt;Route&gt;</code> for it).</p>
<p>You’ll finish defining the <code>tasksReducer</code> function after creating the <code>createTask</code>, <code>deleteTask</code>, and <code>resetTaskList</code> actions that the reducer manages. You’ll set up your actions below the line of code that sets up the Redux <code>store</code>.</p>
<h3 id="actions-3">Actions</h3>
<p>Let’s set up the <code>createTask</code> action creator! You’ll want your <code>createTask</code> action creator to return an action with the following shape:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb30-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb30-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;CREATE_TASK&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-3" title="3">  <span class="dt">taskMessage</span><span class="op">:</span> <span class="st">&#39;walk dog&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>As a reminder, an <strong>action creator</strong> is simply a function that returns an <strong>action</strong> which is a POJO (plain old JavaScript object) that defines a <code>type</code> key and optional payload keys. Have your <code>createTask</code> function take in a <code>taskMessage</code> as a parameter:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">const</span> createTask <span class="op">=</span> (taskMessage) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb31-2" title="2">  <span class="co">// </span><span class="al">TODO</span><span class="co">: Return POJO with `type` property and function&#39;s argument (`taskMessage`)</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="op">};</span></a></code></pre></div>
<p>Now you’ll want to set up the function’s return statement to return the action POJO. The POJO should have a <code>type</code> property. The <code>type</code> property will be how the <code>tasksReducer</code> will decipher different types of actions to update the Redux store’s state in different ways. The action will also have a payload key set to the function’s argument (<code>taskMessage</code>).</p>
<p>In this case, the <code>createTask</code> function has a <code>taskMessage</code> parameter, so the action POJO will have a <code>type</code> property set to the string <code>CREATE_TASK</code>, as well as a <code>taskMessage</code> property set to the <code>taskMessage</code> parameter value.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb32-1" title="1"><span class="kw">const</span> createTask <span class="op">=</span> (taskMessage) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb32-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb32-3" title="3">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;CREATE_TASK&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb32-4" title="4">    <span class="dt">taskMessage</span><span class="op">:</span> taskMessage<span class="op">,</span></a>
<a class="sourceLine" id="cb32-5" title="5">  <span class="op">};</span></a>
<a class="sourceLine" id="cb32-6" title="6"><span class="op">};</span></a></code></pre></div>
<p>It is best practice to use constants for action types, instead of string literals. Since the reducer depends on the action’s <code>type</code> to decipher different types of actions, a typo in the reducer or action specifying the type will go unseen. For example, imagine if the reducer needs an action with the type <code>CREATE_TASK</code> to perform the create operation, but there is a typo making the reducer listen for the type <code>'CREATE_TSAK'</code> instead. When an action of type <code>CREATE_TASK</code> is dispatched, it will never be evaluated by the reducer listening for an action of type <code>'CREATE_TSAK'</code>. Creating constants for string literals ensures that an error will be thrown for action type typos.</p>
<p>Define a constant for the <code>CREATE_TASK</code> string. Make sure to define the constant before defining your <code>tasksReducer</code>, otherwise you’ll receive <code>ReferenceError: CREATE_TASK is not defined</code> when you dispatch an action. At this point, your file should look something like this:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">const</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;redux&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb33-2" title="2"></a>
<a class="sourceLine" id="cb33-3" title="3"><span class="kw">const</span> CREATE_TASK <span class="op">=</span> <span class="st">&#39;CREATE_TASK&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb33-4" title="4"></a>
<a class="sourceLine" id="cb33-5" title="5"><span class="kw">const</span> tasksReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb33-6" title="6">  <span class="co">// </span><span class="al">TODO</span><span class="co">: Set up switch statement to manage actions based on type</span></a>
<a class="sourceLine" id="cb33-7" title="7"><span class="op">};</span></a>
<a class="sourceLine" id="cb33-8" title="8"></a>
<a class="sourceLine" id="cb33-9" title="9"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(tasksReducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb33-10" title="10"></a>
<a class="sourceLine" id="cb33-11" title="11"><span class="kw">const</span> createTask <span class="op">=</span> (taskMessage) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb33-12" title="12">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb33-13" title="13">    <span class="dt">type</span><span class="op">:</span> CREATE_TASK<span class="op">,</span></a>
<a class="sourceLine" id="cb33-14" title="14">    <span class="dt">taskMessage</span><span class="op">:</span> taskMessage<span class="op">,</span></a>
<a class="sourceLine" id="cb33-15" title="15">  <span class="op">};</span></a>
<a class="sourceLine" id="cb33-16" title="16"><span class="op">};</span></a></code></pre></div>
<p>You can also have the function implicitly return by removing the function’s curly braces and wrapping the action object’s curly braces with parentheses. The <code>createTask</code> code below has the exact same functionality as the code above:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb34-1" title="1"><span class="kw">const</span> createTask <span class="op">=</span> (taskMessage) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb34-2" title="2">  <span class="dt">type</span><span class="op">:</span> CREATE_TASK<span class="op">,</span></a>
<a class="sourceLine" id="cb34-3" title="3">  taskMessage<span class="op">,</span></a>
<a class="sourceLine" id="cb34-4" title="4"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Although the code looks shorter and cleaner, note that you are unable to use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/debugger">debugger statement</a> to debug a function when it is implicitly returning. You can use the VS Code debugger to set a breakpoint, but you won’t be able to set a breakpoint with the <code>debugger</code> statement.</p>
<p>When working on your React-Redux projects in the future, it’ll be helpful to keep the <code>return</code> statement so you can easily place a breakpoint with the <code>debugger</code> statement to debug the action creator function and make sure a specific action is actually being dispatched.</p>
<p>Now that you have set up a <code>createTask</code> action creator, follow the same pattern to set up a <code>deleteTask</code> action creator that takes in a <code>taskId</code>. The <code>resetTaskList</code> action creator will be a little different. You’ll still follow the pattern of setting a <code>type</code> for the action, but the <code>resetTaskList</code> function will not take any parameters. The action will simply have a <code>type</code> property and a <code>emptyTaskList</code> property set to an empty array:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">const</span> resetTaskList <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb35-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb35-3" title="3">    <span class="dt">type</span><span class="op">:</span> RESET_TASK_LIST<span class="op">,</span></a>
<a class="sourceLine" id="cb35-4" title="4">    <span class="dt">emptyTaskList</span><span class="op">:</span> []<span class="op">,</span></a>
<a class="sourceLine" id="cb35-5" title="5">  <span class="op">};</span></a>
<a class="sourceLine" id="cb35-6" title="6"><span class="op">};</span></a></code></pre></div>
<h3 id="reducer-1">Reducer</h3>
<p>It’s time to circle back and finish implementing the <code>tasksReducer</code>! Begin by setting up a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/switch">switch</a> statement that evaluates a case statement based on the <code>action.type</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">const</span> tasksReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb36-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb36-3" title="3">    <span class="co">// </span><span class="al">TODO</span><span class="co">: Set up switch case for `createTask` action</span></a>
<a class="sourceLine" id="cb36-4" title="4">    <span class="co">// </span><span class="al">TODO</span><span class="co">: Set up switch case for `deleteTask` action</span></a>
<a class="sourceLine" id="cb36-5" title="5">    <span class="co">// </span><span class="al">TODO</span><span class="co">: Set up switch case for `resetTaskList` action</span></a>
<a class="sourceLine" id="cb36-6" title="6">    <span class="co">// </span><span class="al">TODO</span><span class="co">: Set up default switch case</span></a>
<a class="sourceLine" id="cb36-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb36-8" title="8"><span class="op">};</span></a></code></pre></div>
<p>Let’s begin by setting up the default switch case. By default, you always want to return the default <code>state</code> argument passed into the reducer:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">const</span> tasksReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb37-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb37-3" title="3">    <span class="co">// </span><span class="al">TODO</span><span class="co">: Set up switch case for `createTask` action</span></a>
<a class="sourceLine" id="cb37-4" title="4">    <span class="co">// </span><span class="al">TODO</span><span class="co">: Set up switch case for `deleteTask` action</span></a>
<a class="sourceLine" id="cb37-5" title="5">    <span class="co">// </span><span class="al">TODO</span><span class="co">: Set up switch case for `resetTaskList` action</span></a>
<a class="sourceLine" id="cb37-6" title="6">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb37-7" title="7">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb37-8" title="8">  <span class="op">}</span></a>
<a class="sourceLine" id="cb37-9" title="9"><span class="op">};</span></a></code></pre></div>
<p>Now let’s set up the <code>case</code> statements for each action type. You have three task actions, so you’ll set up three case statements. As a reminder, you set up the action types with constants to make sure typos in the reducer’s <code>case</code> statements throw an error. Use the constants in the switch statement:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">const</span> tasksReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb38-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb38-3" title="3">    <span class="cf">case</span> <span class="dt">CREATE_TASK</span><span class="op">:</span></a>
<a class="sourceLine" id="cb38-4" title="4">      <span class="co">// </span><span class="al">TODO</span><span class="co">: Define what happens when a `createTask` action is dispatched</span></a>
<a class="sourceLine" id="cb38-5" title="5">    <span class="cf">case</span> <span class="dt">DELETE_TASK</span><span class="op">:</span></a>
<a class="sourceLine" id="cb38-6" title="6">      <span class="co">// </span><span class="al">TODO</span><span class="co">: Define what happens when a `deleteTask` action is dispatched</span></a>
<a class="sourceLine" id="cb38-7" title="7">    <span class="cf">case</span> <span class="dt">RESET_TASK_LIST</span><span class="op">:</span></a>
<a class="sourceLine" id="cb38-8" title="8">      <span class="co">// </span><span class="al">TODO</span><span class="co">: Define what happens when a `resetTaskList` action is dispatched</span></a>
<a class="sourceLine" id="cb38-9" title="9">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb38-10" title="10">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb38-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb38-12" title="12"><span class="op">};</span></a></code></pre></div>
<p>As a reminder, the reducer function is called every time an action is dispatched. This means that the <code>tasksReducer</code> function will be invoked whenever an action is dispatched. It’s now time to write code to handle each specific action type and define what happens when actions of different types are dispatched!</p>
<h4 id="create_task-case-statement"><code>CREATE_TASK</code> case statement</h4>
<p>Under the case statement for <code>CREATE_TASK</code>, you’ll want to return an updated version of the reducer’s state tree, with the new task. As a reminder, the Redux store’s state should be immutable - this means you should never mutate the <code>state</code> array directly.</p>
<p>Begin by generating a <code>newTask</code> object based on the action’s <code>taskMessage</code> property:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb39-1" title="1"><span class="kw">const</span> newTask <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb39-2" title="2">  <span class="dt">message</span><span class="op">:</span> <span class="va">action</span>.<span class="at">taskMessage</span><span class="op">,</span></a>
<a class="sourceLine" id="cb39-3" title="3"><span class="op">};</span></a></code></pre></div>
<p>Since you don’t want to directly mutate the <code>state</code> array, you don’t want to <code>push</code> the <code>newTask</code> directly into the <code>state</code> array. Instead, you can use spread syntax to return an updated state with <code>newTask</code> set as the last array element in a new array:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb40-1" title="1"><span class="cf">case</span> CREATE_TASK<span class="op">:</span></a>
<a class="sourceLine" id="cb40-2" title="2">  <span class="kw">const</span> newTask <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb40-3" title="3">    <span class="dt">message</span><span class="op">:</span> <span class="va">action</span>.<span class="at">taskMessage</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-4" title="4">  <span class="op">};</span></a>
<a class="sourceLine" id="cb40-5" title="5">  <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> newTask]<span class="op">;</span></a></code></pre></div>
<h4 id="delete_task-case-statement"><code>DELETE_TASK</code> case statement</h4>
<p>Now let’s define what happens when a <code>DELETE_TASK</code> action is dispatched. As a reminder, the <code>deleteTask</code> action creator function takes in a <code>taskId</code> that actually references a task element’s index in the <code>state</code> array. In the <code>DELETE_TASK</code> case statement, you’ll use the index (the action’s <code>taskId</code> property) and the native <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">Array.slice</a> method to return a copy of the state that excludes the task to delete:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb41-1" title="1"><span class="cf">case</span> DELETE_TASK<span class="op">:</span></a>
<a class="sourceLine" id="cb41-2" title="2">  <span class="kw">const</span> idx <span class="op">=</span> <span class="va">action</span>.<span class="at">taskId</span><span class="op">;</span></a>
<a class="sourceLine" id="cb41-3" title="3">  <span class="cf">return</span> [...<span class="va">state</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> idx)<span class="op">,</span> ...<span class="va">state</span>.<span class="at">slice</span>(idx <span class="op">+</span> <span class="dv">1</span>)]<span class="op">;</span></a></code></pre></div>
<p>Using spread syntax and non-mutative methods are one of the many immutable update patterns you can use to update state without directly mutating it. Feel free to visit the official Redux documentation to view more <a href="https://redux.js.org/recipes/structuring-reducers/immutable-update-patterns#inserting-and-removing-items-in-arrays">immutable update patterns</a>.</p>
<h4 id="reset_task_list-case-statement"><code>RESET_TASK_LIST</code> case statement</h4>
<p>Now let’s define what happens when a <code>RESET_TASK_LIST</code> action is dispatched. As a reminder, the action has an <code>emptyTaskList</code> property that is an empty array, similar to the default state set by the reducer. You can simply return the <code>emptyTaskList</code> array to update the Redux store’s state. The <code>emptyTaskList</code> will replace the <code>state</code> array entirely.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb42-1" title="1"><span class="cf">case</span> RESET_TASK_LIST<span class="op">:</span></a>
<a class="sourceLine" id="cb42-2" title="2">  <span class="cf">return</span> <span class="va">action</span>.<span class="at">emptyTaskList</span><span class="op">;</span></a></code></pre></div>
<h2 id="phase-2-testing">Phase 2: Testing</h2>
<p>Start by creating an <code>app.js</code> file and importing <code>store</code>, <code>createTask</code>, <code>deleteTask</code>, and <code>resetTaskList</code> from the <code>reduxStoreActionReducer.js</code> file. Since this project is running within the native Node environment, you’ll need to use CommonJS module syntax (<code>require</code> and <code>module.exports</code>) to manage imports and exports within the project:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">const</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb43-2" title="2">  store<span class="op">,</span></a>
<a class="sourceLine" id="cb43-3" title="3">  createTask<span class="op">,</span></a>
<a class="sourceLine" id="cb43-4" title="4">  deleteTask<span class="op">,</span></a>
<a class="sourceLine" id="cb43-5" title="5">  resetTaskList<span class="op">,</span></a>
<a class="sourceLine" id="cb43-6" title="6"><span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./reduxStoreActionReducer&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Before you begin dispatching actions to test the actions and reducer you have created, you’ll need to set up a way to log the Redux store and view its current state. You can use the <code>store.getState</code> method to access the Redux store’s current state and simply console log the Redux store’s state that was retrieved. To make your logging more clear, you can even add a message labeling the status of the store logged. After the imports at the top of your <code>app.js</code> file, log the initial state of the Redux store (an empty task list) with the following <code>console.log</code> statements:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb44-1" title="1"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Default Redux Store (empty task list):&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb44-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a></code></pre></div>
<p>At this point, take a moment to run your Node application by running the follow terminal statement from the root of the project directory:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb45-1" title="1"><span class="ex">node</span> app.js</a></code></pre></div>
<p>You should see the following output in your terminal:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb46-1" title="1"><span class="ex">Default</span> Redux Store (empty task list)<span class="bu">:</span></a>
<a class="sourceLine" id="cb46-2" title="2">[]</a></code></pre></div>
<blockquote>
<p>Notice how you are currently using <code>console.log</code> statements to test and debug your code. Later in the project, you’ll get a chance to investigate your code with the VS Code debugger to gain more context and insight about your code and its variable values.</p>
</blockquote>
<h3 id="dispatch-the-create_task-action">Dispatch the <code>CREATE_TASK</code> action</h3>
<p>Now you can test whether you can actually create a task by using the <code>store.dispatch</code> method to dispatch the <code>CREATE_TASK</code> action. Invoke the <code>createTask</code> action creator function with a task message, and then dispatch the invoked action. As a reminder, dispatching the action will "send" it through the reducer (in this case, the <code>tasksReducer</code>) and determine what operation to perform based on the action’s <code>type</code> property.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb47-1" title="1"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">createTask</span>(<span class="st">&#39;walk dog&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb47-2" title="2"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">createTask</span>(<span class="st">&#39;feed cat&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb47-3" title="3"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">createTask</span>(<span class="st">&#39;talk to bird&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb47-4" title="4"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">createTask</span>(<span class="st">&#39;watch goldfish&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb47-5" title="5"></a>
<a class="sourceLine" id="cb47-6" title="6"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Redux Store:&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb47-7" title="7"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a></code></pre></div>
<p>Now run your application with <code>node app.js</code> and you should see the following output in your terminal:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb48-1" title="1"><span class="ex">Default</span> Redux Store (empty task list)<span class="bu">:</span></a>
<a class="sourceLine" id="cb48-2" title="2">[]</a>
<a class="sourceLine" id="cb48-3" title="3"><span class="ex">Redux</span> Store:</a>
<a class="sourceLine" id="cb48-4" title="4"><span class="bu">[</span> { message: <span class="st">&#39;walk dog&#39;</span> },</a>
<a class="sourceLine" id="cb48-5" title="5">  { message: <span class="st">&#39;feed cat&#39;</span> },</a>
<a class="sourceLine" id="cb48-6" title="6">  { message: <span class="st">&#39;talk to bird&#39;</span> },</a>
<a class="sourceLine" id="cb48-7" title="7">  { message: <span class="st">&#39;watch goldfish&#39;</span> }<span class="bu"> ]</span></a></code></pre></div>
<p>That may have seemed like magic for now, but at the end of the project, you’ll walk-through your project’s code step-by-step to view what is really happening with the Redux cycle. For now, focus on understanding the idea of <em>dispatching an action</em>.</p>
<h3 id="dispatch-the-delete_task-action">Dispatch the <code>DELETE_TASK</code> action</h3>
<p>Now you can add the following code after your <code>CREATE_TASK</code> dispatch calls to dispatch a <code>DELETE_TASK</code> action and log the Redux store’s updated state:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb49-1" title="1"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">deleteTask</span>(<span class="dv">0</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">deleteTask</span>(<span class="dv">1</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb49-3" title="3"></a>
<a class="sourceLine" id="cb49-4" title="4"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Updated Redux Store:&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb49-5" title="5"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a></code></pre></div>
<p>Run your application with <code>node app.js</code> and you should see the following output in your terminal:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb50-1" title="1"><span class="ex">Default</span> Redux Store (empty task list)<span class="bu">:</span></a>
<a class="sourceLine" id="cb50-2" title="2">[]</a>
<a class="sourceLine" id="cb50-3" title="3"><span class="ex">Redux</span> Store:</a>
<a class="sourceLine" id="cb50-4" title="4"><span class="bu">[</span> { message: <span class="st">&#39;walk dog&#39;</span> },</a>
<a class="sourceLine" id="cb50-5" title="5">  { message: <span class="st">&#39;feed cat&#39;</span> },</a>
<a class="sourceLine" id="cb50-6" title="6">  { message: <span class="st">&#39;talk to bird&#39;</span> },</a>
<a class="sourceLine" id="cb50-7" title="7">  { message: <span class="st">&#39;watch goldfish&#39;</span> }<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb50-8" title="8"><span class="ex">Updated</span> Redux Store:</a>
<a class="sourceLine" id="cb50-9" title="9"><span class="bu">[</span> { message: <span class="st">&#39;feed cat&#39;</span> }, { message: <span class="st">&#39;watch goldfish&#39;</span> }<span class="bu"> ]</span></a></code></pre></div>
<h3 id="dispatch-the-reset_task_list-action">Dispatch the <code>RESET_TASK_LIST</code> action</h3>
<p>Lastly, take a moment to test the dispatching of the <code>RESET_TASK_LIST</code> action and log the updated state by adding the following code after the <code>DELETE_TASK</code> dispatch calls:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb51-1" title="1"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">resetTaskList</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb51-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Reset Redux Store (empty task list):&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb51-3" title="3"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a></code></pre></div>
<p>If you run your application with <code>node app.js</code> and you should see the following output in your terminal:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb52-1" title="1"><span class="ex">Default</span> Redux Store (empty task list)<span class="bu">:</span></a>
<a class="sourceLine" id="cb52-2" title="2">[]</a>
<a class="sourceLine" id="cb52-3" title="3"><span class="ex">Redux</span> Store:</a>
<a class="sourceLine" id="cb52-4" title="4"><span class="bu">[</span> { message: <span class="st">&#39;walk dog&#39;</span> },</a>
<a class="sourceLine" id="cb52-5" title="5">  { message: <span class="st">&#39;feed cat&#39;</span> },</a>
<a class="sourceLine" id="cb52-6" title="6">  { message: <span class="st">&#39;talk to bird&#39;</span> },</a>
<a class="sourceLine" id="cb52-7" title="7">  { message: <span class="st">&#39;watch goldfish&#39;</span> }<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb52-8" title="8"><span class="ex">Updated</span> Redux Store:</a>
<a class="sourceLine" id="cb52-9" title="9"><span class="bu">[</span> { message: <span class="st">&#39;feed cat&#39;</span> }, { message: <span class="st">&#39;watch goldfish&#39;</span> }<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb52-10" title="10"><span class="ex">Reset</span> Redux Store (empty task list)<span class="bu">:</span></a>
<a class="sourceLine" id="cb52-11" title="11">[]</a></code></pre></div>
<h3 id="subscribe-to-redux-store-updates">Subscribe to Redux store updates</h3>
<p>Instead of having multiple console log statements to log <code>store.getState()</code>, you can have your store subscribe to changes in the state with the <code>store.subscribe</code> method. Create a new <code>appWithSubscription.js</code> file with the following code to view how you can invoke <code>store.subscribe</code> so that the state is logged anytime the store is updated (i.e. anytime an action is dispatched).</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb53-1" title="1"><span class="co">// ./appWithSubscription.js</span></a>
<a class="sourceLine" id="cb53-2" title="2"></a>
<a class="sourceLine" id="cb53-3" title="3"><span class="kw">const</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb53-4" title="4">  store<span class="op">,</span></a>
<a class="sourceLine" id="cb53-5" title="5">  createTask<span class="op">,</span></a>
<a class="sourceLine" id="cb53-6" title="6">  deleteTask<span class="op">,</span></a>
<a class="sourceLine" id="cb53-7" title="7">  resetTaskList<span class="op">,</span></a>
<a class="sourceLine" id="cb53-8" title="8"><span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./reduxStoreActionReducer&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb53-9" title="9"></a>
<a class="sourceLine" id="cb53-10" title="10"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Default Redux Store (empty task list):&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb53-11" title="11"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb53-12" title="12"></a>
<a class="sourceLine" id="cb53-13" title="13"><span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>()))<span class="op">;</span></a>
<a class="sourceLine" id="cb53-14" title="14"></a>
<a class="sourceLine" id="cb53-15" title="15"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Task creation actions&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb53-16" title="16"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">createTask</span>(<span class="st">&#39;walk dog&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb53-17" title="17"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">createTask</span>(<span class="st">&#39;feed cat&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb53-18" title="18"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">createTask</span>(<span class="st">&#39;talk to bird&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb53-19" title="19"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">createTask</span>(<span class="st">&#39;watch goldfish&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb53-20" title="20"></a>
<a class="sourceLine" id="cb53-21" title="21"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Task deletion actions&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb53-22" title="22"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">deleteTask</span>(<span class="dv">0</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb53-23" title="23"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">deleteTask</span>(<span class="dv">1</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb53-24" title="24"></a>
<a class="sourceLine" id="cb53-25" title="25"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Task reset action&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb53-26" title="26"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">resetTaskList</span>())<span class="op">;</span></a></code></pre></div>
<p>Run your application with <code>node appWithSubscription.js</code> and you should see the following output. Notice how the state was logged four times under "Task creation actions" because of how four actions were dispatched, and the state was logged twice after "Task deletion actions" because of how two actions were dispatched.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb54-1" title="1"><span class="ex">Default</span> Redux Store (empty task list)<span class="bu">:</span></a>
<a class="sourceLine" id="cb54-2" title="2">[]</a>
<a class="sourceLine" id="cb54-3" title="3"><span class="ex">Task</span> creation actions:</a>
<a class="sourceLine" id="cb54-4" title="4"><span class="bu">[</span> { message: <span class="st">&#39;walk dog&#39;</span> }<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb54-5" title="5"><span class="bu">[</span> { message: <span class="st">&#39;walk dog&#39;</span> }, { message: <span class="st">&#39;feed cat&#39;</span> }<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb54-6" title="6"><span class="bu">[</span> { message: <span class="st">&#39;walk dog&#39;</span> },</a>
<a class="sourceLine" id="cb54-7" title="7">  { message: <span class="st">&#39;feed cat&#39;</span> },</a>
<a class="sourceLine" id="cb54-8" title="8">  { message: <span class="st">&#39;talk to bird&#39;</span> }<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb54-9" title="9"><span class="bu">[</span> { message: <span class="st">&#39;walk dog&#39;</span> },</a>
<a class="sourceLine" id="cb54-10" title="10">  { message: <span class="st">&#39;feed cat&#39;</span> },</a>
<a class="sourceLine" id="cb54-11" title="11">  { message: <span class="st">&#39;talk to bird&#39;</span> },</a>
<a class="sourceLine" id="cb54-12" title="12">  { message: <span class="st">&#39;watch goldfish&#39;</span> }<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb54-13" title="13"><span class="ex">Task</span> deletion actions:</a>
<a class="sourceLine" id="cb54-14" title="14"><span class="bu">[</span> { message: <span class="st">&#39;feed cat&#39;</span> },</a>
<a class="sourceLine" id="cb54-15" title="15">  { message: <span class="st">&#39;talk to bird&#39;</span> },</a>
<a class="sourceLine" id="cb54-16" title="16">  { message: <span class="st">&#39;watch goldfish&#39;</span> }<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb54-17" title="17"><span class="bu">[</span> { message: <span class="st">&#39;feed cat&#39;</span> }, { message: <span class="st">&#39;watch goldfish&#39;</span> }<span class="bu"> ]</span></a>
<a class="sourceLine" id="cb54-18" title="18"><span class="ex">Task</span> reset action:</a>
<a class="sourceLine" id="cb54-19" title="19">[]</a></code></pre></div>
<h3 id="debug-to-follow-the-redux-cycle">Debug to follow the Redux cycle</h3>
<p>Now that you’ve used <code>console.log</code> statements to thoroughly investigate your project, you can set up the VS Code debugger and add some breakpoints to follow the Redux cycle. You’ll use the breakpoints to investigate how invoking <code>store.dispatch</code> with the result from an action creator function directs the action to a specific switch case in the <code>tasksReducer</code> function. Start by creating a <code>.vscode</code> directory and a <code>launch.json</code> file to configure the VS Code debugger:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb55-1" title="1"><span class="fu">mkdir</span> .vscode <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> .vscode</a>
<a class="sourceLine" id="cb55-2" title="2"><span class="fu">touch</span> launch.json</a></code></pre></div>
<p>Paste the following configuration into your <code>launch.json</code> file:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb56-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb56-2" title="2">  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;0.2.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb56-3" title="3">  <span class="dt">&quot;configurations&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb56-4" title="4">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb56-5" title="5">      <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;node&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb56-6" title="6">      <span class="dt">&quot;request&quot;</span><span class="fu">:</span> <span class="st">&quot;launch&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb56-7" title="7">      <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Launch Program&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb56-8" title="8">      <span class="dt">&quot;skipFiles&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb56-9" title="9">        <span class="st">&quot;&lt;node_internals&gt;/**&quot;</span></a>
<a class="sourceLine" id="cb56-10" title="10">      <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb56-11" title="11">      <span class="dt">&quot;program&quot;</span><span class="fu">:</span> <span class="st">&quot;${workspaceFolder}/app.js&quot;</span></a>
<a class="sourceLine" id="cb56-12" title="12">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb56-13" title="13">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb56-14" title="14"><span class="fu">}</span></a></code></pre></div>
<blockquote>
<p>As a reminder, VS Code can also auto-generate the <code>.vscode</code> directory and the <code>launch.json</code> for you. Feel free to visit the VS Code documentation for more on <a href="https://code.visualstudio.com/Docs/editor/debugging">debugging with VS Code</a>.</p>
</blockquote>
<p>You can follow your code when an action object is dispatched by setting breakpoints. You can also examine the action’s attributes by setting a breakpoint in the reducer. In the reducer, make sure to set the breakpoint within a <code>case</code> statement. For example, if you set a breakpoint in the <code>switch</code> statement, but <em>outside</em> of a <code>case</code> statement, you won’t ever hit the breakpoint set.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb57-1" title="1"><span class="co">// Example of bad `debugger` placement that will not work!</span></a>
<a class="sourceLine" id="cb57-2" title="2"></a>
<a class="sourceLine" id="cb57-3" title="3"><span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb57-4" title="4">  <span class="cf">debugger</span><span class="op">;</span></a>
<a class="sourceLine" id="cb57-5" title="5">  <span class="cf">case</span> <span class="dt">CREATE_TASK</span><span class="op">:</span></a>
<a class="sourceLine" id="cb57-6" title="6">    <span class="kw">const</span> newTask <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb57-7" title="7">      <span class="dt">message</span><span class="op">:</span> <span class="va">action</span>.<span class="at">taskMessage</span><span class="op">,</span></a>
<a class="sourceLine" id="cb57-8" title="8">    <span class="op">};</span></a>
<a class="sourceLine" id="cb57-9" title="9">    <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> newTask]<span class="op">;</span></a></code></pre></div>
<p>Take a moment to use the <code>debugger</code> keyword to set breakpoints in the <code>createTask</code> action creator and <code>CREATE_TASK</code> case statement in your <code>reduxStoreActionReducer.js</code> file:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb58-1" title="1"><span class="kw">const</span> tasksReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb58-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb58-3" title="3">    <span class="cf">case</span> <span class="dt">CREATE_TASK</span><span class="op">:</span></a>
<a class="sourceLine" id="cb58-4" title="4">      <span class="cf">debugger</span></a>
<a class="sourceLine" id="cb58-5" title="5">      <span class="kw">const</span> newTask <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb58-6" title="6">        <span class="dt">message</span><span class="op">:</span> <span class="va">action</span>.<span class="at">taskMessage</span><span class="op">,</span></a>
<a class="sourceLine" id="cb58-7" title="7">      <span class="op">};</span></a>
<a class="sourceLine" id="cb58-8" title="8">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> newTask]<span class="op">;</span></a>
<a class="sourceLine" id="cb58-9" title="9">    <span class="cf">case</span> <span class="dt">DELETE_TASK</span><span class="op">:</span></a>
<a class="sourceLine" id="cb58-10" title="10">      <span class="kw">const</span> idx <span class="op">=</span> <span class="va">action</span>.<span class="at">taskId</span><span class="op">;</span></a>
<a class="sourceLine" id="cb58-11" title="11">      <span class="cf">return</span> [...<span class="va">state</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> idx)<span class="op">,</span> ...<span class="va">state</span>.<span class="at">slice</span>(idx <span class="op">+</span> <span class="dv">1</span>)]<span class="op">;</span></a>
<a class="sourceLine" id="cb58-12" title="12">    <span class="cf">case</span> <span class="dt">RESET_TASK_LIST</span><span class="op">:</span></a>
<a class="sourceLine" id="cb58-13" title="13">      <span class="cf">return</span> <span class="va">action</span>.<span class="at">emptyTaskList</span><span class="op">;</span></a>
<a class="sourceLine" id="cb58-14" title="14">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb58-15" title="15">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb58-16" title="16">  <span class="op">}</span></a>
<a class="sourceLine" id="cb58-17" title="17"><span class="op">};</span></a></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb59-1" title="1"><span class="kw">const</span> createTask <span class="op">=</span> (taskMessage) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb59-2" title="2">  <span class="cf">debugger</span></a>
<a class="sourceLine" id="cb59-3" title="3">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb59-4" title="4">    <span class="dt">type</span><span class="op">:</span> CREATE_TASK<span class="op">,</span></a>
<a class="sourceLine" id="cb59-5" title="5">    taskMessage<span class="op">,</span></a>
<a class="sourceLine" id="cb59-6" title="6">  <span class="op">};</span></a>
<a class="sourceLine" id="cb59-7" title="7"><span class="op">};</span></a></code></pre></div>
<p>Now you’ll be able to pause the running of your code to examine variables in the environment and view step-by-step updates to the Redux store’s <code>state</code> as your code is evaluated.</p>
<p>Open <code>app.js</code> as the active file in your VS Code workspace. Press <code>F5</code> and select <code>Node.js</code> as your environment - VS Code will try to run your currently active file in debug mode. This will allow you to follow each dispatched action and watch how each dispatched action updates the Redux store’s state.</p>
<p>As you step through each dispatched action, you’ll notice that there really is a <em>cycle</em>: an action is generated, then the action is dispatched to go through a reducer, and then the store is updated.</p>
<p>Here is a quick breakdown of what happens with the <code>CREATE_TASK</code> action is dispatched, to guide the navigation of using VS Code debugger to investigate the Redux cycle:</p>
<ol type="1">
<li>The <code>createTask</code> action creator function is invoked with the string <code>'walk dog'</code>.</li>
<li>The <code>createTask</code> function returns a POJO (known as an "action") with a <code>type</code> attribute and <code>taskMessage</code> properties. The POJO is structured like this:</li>
</ol>
<div class="sourceCode" id="cb60"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb60-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb60-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;CREATE_TASK&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb60-3" title="3">  <span class="dt">taskMessage</span><span class="op">:</span> <span class="st">&#39;walk dog&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb60-4" title="4"><span class="op">}</span></a></code></pre></div>
<ol start="3" type="1">
<li>The <code>store.dispatch</code> method is invoked to dispatch the action POJO and invoke the <code>tasksReducer</code> function. Since the POJO has a type of <code>CREATE_TASK</code>, the case statement for <code>CREATE_TASK</code> will be evaluated:</li>
</ol>
<div class="sourceCode" id="cb61"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb61-1" title="1"><span class="cf">case</span> CREATE_TASK<span class="op">:</span></a>
<a class="sourceLine" id="cb61-2" title="2">  <span class="kw">const</span> newTask <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb61-3" title="3">    <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;walk dog&#39;</span><span class="op">,</span> <span class="co">// This is `action.taskMessage`</span></a>
<a class="sourceLine" id="cb61-4" title="4">  <span class="op">};</span></a>
<a class="sourceLine" id="cb61-5" title="5">  <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> newTask]<span class="op">;</span></a></code></pre></div>
<ol start="4" type="1">
<li>The store’s state is updated to be the new state returned by the reducer (<code>[...state, newTask]</code>).</li>
</ol>
<p>Congratulations! You have just created your first Redux store, reducer, and actions. You also learned more about what a reducer is doing by investigating with console log statements and debugging the project with the VS Code debugger.</p>
<hr />
<h1 id="week-15-day-2-react-redux" data-ignore="true">WEEK-15 DAY-2<br><em>React + Redux</em></h1>
<hr />
<h1 id="redux-learning-objectives-part-2">Redux Learning Objectives: Part 2</h1>
<p>To keep things as simple as possible when initially learning Redux, you started with using Redux independent of React. Now it’s time to learn how to use Redux within a React application!</p>
<p>After reading and practicing how to use Redux with React, you should be able to:</p>
<ul>
<li>Add Redux actions, reducer(s), and a store to a React project</li>
<li>Update a React class component to subscribe to a Redux store to listen for state changes</li>
<li>Update a React component to dispatch actions to a Redux store</li>
<li>Define multiple reducers to manage individual slices of state</li>
<li>Use the Redux <code>combineReducers</code> method to combine multiple reducers into a single root reducer</li>
<li>Update a reducer to delegate a state update to a subordinate reducer</li>
<li>Describe how container components differ from presentational components</li>
<li>Write a container component to handle all of the Redux store interaction for one or more presentational components</li>
<li>Use <code>Object.freeze</code> to prevent the current state within a reducer from being mutated</li>
<li>Create a Redux store with preloaded state</li>
</ul>
<hr />
<h1 id="using-redux-with-react">Using Redux with React</h1>
<p>To keep things as simple as possible when initially learning Redux, you started with using Redux independent of React. Now it’s time to learn how to use Redux within a React application!</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Add Redux actions, reducer(s), and a store to a React project</li>
<li>Update a React class component to subscribe to a Redux store to listen for state changes</li>
<li>Update a React component to dispatch actions to a Redux store</li>
</ul>
<h2 id="integrating-redux-into-a-react-application">Integrating Redux into a React application</h2>
<p>The techniques shown in this article for integrating Redux into a React application, is just one step in your journey to learn Redux. As you work your way through this lesson, you’ll learn how to improve upon these techniques to improve the organization or your code, the design of your components, and the overall performance of your application.</p>
<p>In general, the steps to integrate Redux into an existing React application are:</p>
<ul>
<li>Set up Redux
<ul>
<li>Install the <code>redux</code> npm package</li>
<li>Define your actions</li>
<li>Define your reducer(s)</li>
<li>Create your store</li>
</ul></li>
<li>Update components
<ul>
<li>Use <code>store.subscribe</code> to listen for state updates</li>
<li>Call <code>store.getState</code> to retrieve state for rendering</li>
<li>Call <code>store.dispatch</code> to dispatch actions to the store</li>
</ul></li>
</ul>
<blockquote>
<p><strong>Note:</strong> You’ll start with writing all of the code to interact with the store within each component that needs to render state from the store or to dispatch actions. Later on, you’ll learn how to improve the overall design of your application by using container components. Eventually, you’ll learn how to use the <a href="https://react-redux.js.org/">React-Redux</a> library’s <code>connect</code> method to avoid writing container components by hand.</p>
</blockquote>
<h2 id="organizing-your-redux-code">Organizing your Redux code</h2>
<p>Instead of placing all of your Redux related code into a single file, you’ll separate your store, reducer, and actions into their own files.</p>
<p>There are a variety of acceptable ways to organize your Redux code within a React project. When starting out with using Redux, organizing your code by type (i.e. separate files or folders for the store, reducers, and actions) often feels natural and makes it easy to find the file that you need to make a change to. As your projects increase in size and complexity, you might find that organizing your files by feature (i.e. locating all the files related to a feature inside of a single folder) will keep you from searching and jumping around a project that contains hundreds of files.</p>
<blockquote>
<p><strong>Note:</strong> How a project is organized is highly dependent upon who is working on the project. It’s also not unusual for the organization of a project to evolve and change throughout its lifetime. Don’t struggle too much with deciding on an approach when getting starting a new project. Pick an approach and move on to getting work done!</p>
</blockquote>
<h3 id="following-along">Following along</h3>
<p>If you’d like to follow along, clone the <a href="https://github.com/-starters/redux-fruit-stand-with-react-starter">react-fruit-stand-with-react-starter</a> repo.</p>
<p>After cloning the repo, open a terminal and browse to the <code>starter</code> folder within the repo. Run the command <code>npm install</code> to install the project’s dependencies (the <code>redux</code> package is already listed as a dependency). Then use the command <code>npm start</code> to run the Fruit Stand application.</p>
<p>This Fruit Stand example application is a React application created by the Create React App tooling. When running the application using <code>npm start</code>, the application should automatically open in your default browser. If it doesn’t, you can manually browse to <code>http://localhost:3000/</code> to view the application.</p>
<h3 id="adding-the-actions">Adding the actions</h3>
<p>Within the React project’s <code>src</code> folder, add a folder named <code>actions</code>. Within that folder, add a file named <code>fruitActions.js</code> containing the following code:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb62-1" title="1"><span class="co">// ./src/actions/fruitActions.js</span></a>
<a class="sourceLine" id="cb62-2" title="2"></a>
<a class="sourceLine" id="cb62-3" title="3"><span class="im">export</span> <span class="kw">const</span> ADD_FRUIT <span class="op">=</span> <span class="st">&#39;ADD_FRUIT&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb62-4" title="4"><span class="im">export</span> <span class="kw">const</span> ADD_FRUITS <span class="op">=</span> <span class="st">&#39;ADD_FRUITS&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb62-5" title="5"><span class="im">export</span> <span class="kw">const</span> SELL_FRUIT <span class="op">=</span> <span class="st">&#39;SELL_FRUIT&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb62-6" title="6"><span class="im">export</span> <span class="kw">const</span> SELL_OUT <span class="op">=</span> <span class="st">&#39;SELL_OUT&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb62-7" title="7"></a>
<a class="sourceLine" id="cb62-8" title="8"><span class="im">export</span> <span class="kw">const</span> addFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb62-9" title="9">  <span class="dt">type</span><span class="op">:</span> ADD_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb62-10" title="10">  fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb62-11" title="11"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb62-12" title="12"></a>
<a class="sourceLine" id="cb62-13" title="13"><span class="im">export</span> <span class="kw">const</span> addFruits <span class="op">=</span> (fruits) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb62-14" title="14">  <span class="dt">type</span><span class="op">:</span> ADD_FRUITS<span class="op">,</span></a>
<a class="sourceLine" id="cb62-15" title="15">  fruits<span class="op">,</span></a>
<a class="sourceLine" id="cb62-16" title="16"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb62-17" title="17"></a>
<a class="sourceLine" id="cb62-18" title="18"><span class="im">export</span> <span class="kw">const</span> sellFruit <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb62-19" title="19">  <span class="dt">type</span><span class="op">:</span> SELL_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb62-20" title="20">  fruit<span class="op">,</span></a>
<a class="sourceLine" id="cb62-21" title="21"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb62-22" title="22"></a>
<a class="sourceLine" id="cb62-23" title="23"><span class="im">export</span> <span class="kw">const</span> sellOut <span class="op">=</span> () <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb62-24" title="24">  <span class="dt">type</span><span class="op">:</span> SELL_OUT<span class="op">,</span></a>
<a class="sourceLine" id="cb62-25" title="25"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="adding-the-reducer">Adding the reducer</h3>
<p>Within the React project’s <code>src</code> folder, add a folder named <code>reducers</code>. Within that folder, add a file named <code>fruitReducer.js</code> containing the following code:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb63-1" title="1"><span class="co">// ./src/components/fruitReducer.js</span></a>
<a class="sourceLine" id="cb63-2" title="2"></a>
<a class="sourceLine" id="cb63-3" title="3"><span class="im">import</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-4" title="4">  ADD_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb63-5" title="5">  ADD_FRUITS<span class="op">,</span></a>
<a class="sourceLine" id="cb63-6" title="6">  SELL_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb63-7" title="7">  SELL_OUT<span class="op">,</span></a>
<a class="sourceLine" id="cb63-8" title="8"><span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb63-9" title="9"></a>
<a class="sourceLine" id="cb63-10" title="10"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-11" title="11">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb63-12" title="12">    <span class="cf">case</span> <span class="dt">ADD_FRUIT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb63-13" title="13">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> <span class="va">action</span>.<span class="at">fruit</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb63-14" title="14">    <span class="cf">case</span> <span class="dt">ADD_FRUITS</span><span class="op">:</span></a>
<a class="sourceLine" id="cb63-15" title="15">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> ...<span class="va">action</span>.<span class="at">fruits</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb63-16" title="16">    <span class="cf">case</span> <span class="dt">SELL_FRUIT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb63-17" title="17">      <span class="kw">const</span> index <span class="op">=</span> <span class="va">state</span>.<span class="at">indexOf</span>(<span class="va">action</span>.<span class="at">fruit</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb63-18" title="18">      <span class="cf">if</span> (index <span class="op">!==</span> <span class="dv">-1</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb63-19" title="19">        <span class="co">// remove first instance of action.fruit</span></a>
<a class="sourceLine" id="cb63-20" title="20">        <span class="cf">return</span> [...<span class="va">state</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> index)<span class="op">,</span> ...<span class="va">state</span>.<span class="at">slice</span>(index <span class="op">+</span> <span class="dv">1</span>)]<span class="op">;</span></a>
<a class="sourceLine" id="cb63-21" title="21">      <span class="op">}</span></a>
<a class="sourceLine" id="cb63-22" title="22">      <span class="cf">return</span> state<span class="op">;</span> <span class="co">// if action.fruit is not in state, return previous state</span></a>
<a class="sourceLine" id="cb63-23" title="23">    <span class="cf">case</span> <span class="dt">SELL_OUT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb63-24" title="24">      <span class="cf">return</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb63-25" title="25">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb63-26" title="26">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb63-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb63-28" title="28"><span class="op">};</span></a>
<a class="sourceLine" id="cb63-29" title="29"></a>
<a class="sourceLine" id="cb63-30" title="30"><span class="im">export</span> <span class="im">default</span> fruitReducer<span class="op">;</span></a></code></pre></div>
<h3 id="adding-the-store">Adding the store</h3>
<p>Within the React project’s <code>src</code> folder, add a file named <code>store.js</code> containing the following code:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb64-1" title="1"><span class="co">// ./src/store.js</span></a>
<a class="sourceLine" id="cb64-2" title="2"></a>
<a class="sourceLine" id="cb64-3" title="3"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb64-4" title="4"><span class="im">import</span> fruitReducer <span class="im">from</span> <span class="st">&#39;./reducers/fruitReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb64-5" title="5"></a>
<a class="sourceLine" id="cb64-6" title="6"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(fruitReducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb64-7" title="7"></a>
<a class="sourceLine" id="cb64-8" title="8"><span class="im">export</span> <span class="im">default</span> store<span class="op">;</span></a></code></pre></div>
<h2 id="writing-redux-aware-react-components">Writing Redux aware React components</h2>
<p><strong>Remember that the integration techniques shown in this article are just a starting point with using Redux with React components.</strong> As you work your way through this lesson, you’ll learn how to improve upon these techniques.</p>
<h3 id="listening-for-state-changes">Listening for state changes</h3>
<p>Components that need to render state from the store can use the <code>store.subscribe</code> method to subscribe to listen for state updates. When a state update occurs, the <a href="https://facebook.github.io/react/docs/component-api.html#forceupdate"><code>forceUpdate</code></a> method is called to render the component. Within the component’s <code>render</code> method, the <code>store.getState</code> method is called to retrieve the current state. This approach ensures that whenever state is updated in the store (after the reducer has processed a dispatched action), the component will retrieve and render the updated state.</p>
<blockquote>
<p><strong>Note:</strong> Calling <code>forceUpdate</code> causes <code>render</code> to be called without first calling <code>shouldComponentUpdate</code>. Child components will go through their normal lifecycle, including calling <code>shouldComponentUpdate</code> to determine if the child component should render. While this pattern works, it’s a rather blunt instrument for complex components, since re-rendering a parent causes re-rendering of all its children. Later in this lesson, you’ll learn how the <a href="https://react-redux.js.org/">React-Redux</a> library solves this problem.</p>
</blockquote>
<p>The <code>componentDidMount</code> and <code>componentWillUnmount</code> class component lifecycle methods can be used to ensure that the component <em>subscribes</em> to the store when it’s mounted and <em>unsubscribes</em> from the store when the component is about to be unmounted:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb65-1" title="1"><span class="co">// ./src/components/FruitList.js</span></a>
<a class="sourceLine" id="cb65-2" title="2"></a>
<a class="sourceLine" id="cb65-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb65-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb65-5" title="5"></a>
<a class="sourceLine" id="cb65-6" title="6"><span class="kw">class</span> FruitList <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb65-7" title="7">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb65-8" title="8">    <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb65-9" title="9">      <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb65-10" title="10">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb65-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb65-12" title="12"></a>
<a class="sourceLine" id="cb65-13" title="13">  <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb65-14" title="14">    <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb65-15" title="15">      <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb65-16" title="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb65-17" title="17">  <span class="op">}</span></a>
<a class="sourceLine" id="cb65-18" title="18"></a>
<a class="sourceLine" id="cb65-19" title="19">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb65-20" title="20">    <span class="kw">const</span> fruit <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb65-21" title="21"></a>
<a class="sourceLine" id="cb65-22" title="22">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb65-23" title="23">      <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb65-24" title="24">        <span class="op">{</span><span class="va">fruit</span>.<span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb65-25" title="25">          <span class="op">?</span> <span class="op">&lt;</span>ul<span class="op">&gt;{</span><span class="va">fruit</span>.<span class="at">map</span>((fruitName<span class="op">,</span> index) <span class="kw">=&gt;</span> <span class="op">&lt;</span>li key<span class="op">={</span>index<span class="op">}&gt;{</span>fruitName<span class="op">}</span>&lt;/li<span class="op">&gt;</span>)<span class="op">}</span>&lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb65-26" title="26">          : <span class="op">&lt;</span>span<span class="op">&gt;</span>No fruit currently <span class="kw">in</span> stock<span class="op">!</span>&lt;/span<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb65-27" title="27">        <span class="op">}</span></a>
<a class="sourceLine" id="cb65-28" title="28">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb65-29" title="29">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb65-30" title="30">  <span class="op">}</span></a>
<a class="sourceLine" id="cb65-31" title="31"><span class="op">}</span></a>
<a class="sourceLine" id="cb65-32" title="32"></a>
<a class="sourceLine" id="cb65-33" title="33"><span class="im">export</span> <span class="im">default</span> FruitList<span class="op">;</span></a></code></pre></div>
<h3 id="dispatching-actions">Dispatching actions</h3>
<p>Updating a component to dispatch an action to the store is a bit simpler overall than listening for and rendering state updates. You just need to import the appropriate action creator function and use the <code>store.dispatch</code> method within a event handler to dispatch the action:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb66-1" title="1"><span class="co">// ./src/components/FruitQuickAdd.js</span></a>
<a class="sourceLine" id="cb66-2" title="2"></a>
<a class="sourceLine" id="cb66-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb66-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb66-5" title="5"><span class="im">import</span> <span class="op">{</span> addFruit <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb66-6" title="6"></a>
<a class="sourceLine" id="cb66-7" title="7"><span class="kw">class</span> FruitQuickAdd <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb66-8" title="8">  addFruitClick <span class="op">=</span> (event) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb66-9" title="9">    <span class="kw">const</span> fruit <span class="op">=</span> <span class="va">event</span>.<span class="va">target</span>.<span class="at">innerText</span><span class="op">;</span></a>
<a class="sourceLine" id="cb66-10" title="10">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruit</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb66-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb66-12" title="12"></a>
<a class="sourceLine" id="cb66-13" title="13">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb66-14" title="14">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb66-15" title="15">      <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb66-16" title="16">        <span class="op">&lt;</span>h3<span class="op">&gt;</span>Quick Add&lt;/h3<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb66-17" title="17">        <span class="op">&lt;</span>button onClick<span class="op">={</span><span class="kw">this</span>.<span class="at">addFruitClick</span><span class="op">}&gt;</span>APPLE&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb66-18" title="18">        <span class="op">&lt;</span>button onClick<span class="op">={</span><span class="kw">this</span>.<span class="at">addFruitClick</span><span class="op">}&gt;</span>ORANGE&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb66-19" title="19">      &lt;/div<span class="op">&gt;</span>  </a>
<a class="sourceLine" id="cb66-20" title="20">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb66-21" title="21">  <span class="op">}</span></a>
<a class="sourceLine" id="cb66-22" title="22"><span class="op">}</span></a>
<a class="sourceLine" id="cb66-23" title="23"></a>
<a class="sourceLine" id="cb66-24" title="24"><span class="im">export</span> <span class="im">default</span> FruitQuickAdd<span class="op">;</span></a></code></pre></div>
<h3 id="listening-for-state-changes-and-dispatching-actions">Listening for state changes and dispatching actions</h3>
<p>Sometimes components need to listen for and render state updates <em>and</em> dispatch actions to the store. The <code>FruitSeller</code> component listens for state updates so that it can render a collection of buttons–one for each distinct fruit available in the fruit stand. The component also handles button clicks to dispatch an action to sell a fruit or to sell out all of the fruits.</p>
<p>Here’s what the component looks like:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb67-1" title="1"><span class="co">// ./src/components/FruitSeller.js</span></a>
<a class="sourceLine" id="cb67-2" title="2"></a>
<a class="sourceLine" id="cb67-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb67-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb67-5" title="5"><span class="im">import</span> <span class="op">{</span> sellFruit<span class="op">,</span> sellOut <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb67-6" title="6"></a>
<a class="sourceLine" id="cb67-7" title="7"><span class="kw">class</span> FruitSeller <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb67-8" title="8">  sellFruitClick <span class="op">=</span> (event) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb67-9" title="9">    <span class="kw">const</span> fruit <span class="op">=</span> <span class="va">event</span>.<span class="va">target</span>.<span class="at">innerText</span><span class="op">;</span></a>
<a class="sourceLine" id="cb67-10" title="10">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">sellFruit</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb67-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb67-12" title="12"></a>
<a class="sourceLine" id="cb67-13" title="13">  sellOutClick <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb67-14" title="14">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">sellOut</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb67-15" title="15">  <span class="op">}</span></a>
<a class="sourceLine" id="cb67-16" title="16"></a>
<a class="sourceLine" id="cb67-17" title="17">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb67-18" title="18">    <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb67-19" title="19">      <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb67-20" title="20">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb67-21" title="21">  <span class="op">}</span></a>
<a class="sourceLine" id="cb67-22" title="22"></a>
<a class="sourceLine" id="cb67-23" title="23">  <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb67-24" title="24">    <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb67-25" title="25">      <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb67-26" title="26">    <span class="op">}</span></a>
<a class="sourceLine" id="cb67-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb67-28" title="28"></a>
<a class="sourceLine" id="cb67-29" title="29">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb67-30" title="30">    <span class="kw">const</span> fruit <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb67-31" title="31">    <span class="kw">const</span> distinctFruit <span class="op">=</span> <span class="va">Array</span>.<span class="at">from</span>(<span class="kw">new</span> <span class="at">Set</span>(fruit)).<span class="at">sort</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb67-32" title="32"></a>
<a class="sourceLine" id="cb67-33" title="33">    <span class="cf">if</span> (<span class="va">distinctFruit</span>.<span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb67-34" title="34">      <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb67-35" title="35">    <span class="op">}</span></a>
<a class="sourceLine" id="cb67-36" title="36"></a>
<a class="sourceLine" id="cb67-37" title="37">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb67-38" title="38">      <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb67-39" title="39">        <span class="op">&lt;</span>h3<span class="op">&gt;</span>Sell&lt;/h3<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb67-40" title="40">        <span class="op">{</span><span class="va">distinctFruit</span>.<span class="at">map</span>((fruitName<span class="op">,</span> index) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb67-41" title="41">          <span class="op">&lt;</span>button key<span class="op">={</span>index<span class="op">}</span> onClick<span class="op">={</span><span class="kw">this</span>.<span class="at">sellFruitClick</span><span class="op">}&gt;{</span>fruitName<span class="op">}</span>&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb67-42" title="42">        ))<span class="op">}</span></a>
<a class="sourceLine" id="cb67-43" title="43">        <span class="op">&lt;</span>button onClick<span class="op">={</span><span class="kw">this</span>.<span class="at">sellOutClick</span><span class="op">}&gt;</span>SELL OUT&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb67-44" title="44">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb67-45" title="45">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb67-46" title="46">  <span class="op">}</span></a>
<a class="sourceLine" id="cb67-47" title="47"><span class="op">}</span></a>
<a class="sourceLine" id="cb67-48" title="48"></a>
<a class="sourceLine" id="cb67-49" title="49"><span class="im">export</span> <span class="im">default</span> FruitSeller<span class="op">;</span></a></code></pre></div>
<p>The <code>FruitSeller</code> component is sort of a mash up of the <code>FruitList</code> and <code>FruitQuickAdd</code> components!</p>
<h3 id="practicing-on-your-own">Practicing on your own</h3>
<p>There’s just one component left to implement: <code>BulkAdd</code>. This is the perfect chance to get a bit of practice on your own to help you cement what you’re learned in this article.</p>
<h2 id="reviewing-a-completed-fruit-stand-example-1">Reviewing a completed Fruit Stand example</h2>
<p>To review and run a completed Fruit Stand example application that uses React with Redux, clone the <a href="https://github.com/-starters/redux-fruit-stand-examples">redux-fruit-stand-examples</a> repo.</p>
<p>After cloning the repo, open a terminal and browse to the <code>fruit-stand-redux-with-react</code> folder. Run the command <code>npm install</code> to install the project’s dependencies. Then use the command <code>npm start</code> to run the Fruit Stand application.</p>
<p>This Fruit Stand example application is a React application created by the Create React App tooling. When running the application using <code>npm start</code>, the application should automatically open in your default browser. If it doesn’t, you can manually browse to <code>http://localhost:3000/</code> to view the application.</p>
<h2 id="what-you-learned-6">What you learned</h2>
<p>In this article, you learned how to add Redux actions, reducer(s), and a store to a React project. You also learned how to update a React class component to subscribe to a Redux store to listen for state changes and to dispatch actions to a Redux store.</p>
<hr />
<h1 id="splitting-and-combining-reducers">Splitting and Combining Reducers</h1>
<p>So far, you’ve been using a single reducer to manage state in your Redux store. As your applications increase in size and complexity, it’ll become necessary to use multiple reducers, each managing a slice of state.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Define multiple reducers to manage individual slices of state</li>
<li>Use the Redux <code>combineReducers</code> method to combine multiple reducers into a single root reducer</li>
<li>Update a reducer to delegate a state update to a subordinate reducer</li>
</ul>
<h2 id="splitting-reducers">Splitting reducers</h2>
<p>Imagine that your fruit stand is extremely successful and it grows so much that you need multiple farmers helping you to keep your stand stocked with fruit. Your application’s state will need to grow to store not only an array of <code>fruit</code> but also a <code>farmers</code> object that keeps track of your farmers.</p>
<p>Here’s a sample state tree of your updated application:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb68-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb68-2" title="2">  <span class="dt">fruit</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb68-3" title="3">    <span class="st">&#39;APPLE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-4" title="4">    <span class="st">&#39;APPLE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-5" title="5">    <span class="st">&#39;ORANGE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-6" title="6">    <span class="st">&#39;GRAPEFRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-7" title="7">    <span class="st">&#39;WATERMELON&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-8" title="8">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb68-9" title="9">  <span class="dt">farmers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb68-10" title="10">    <span class="dv">1</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb68-11" title="11">      <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-12" title="12">      <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;John Smith&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-13" title="13">      <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-14" title="14">    <span class="op">},</span></a>
<a class="sourceLine" id="cb68-15" title="15">    <span class="dv">2</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb68-16" title="16">      <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-17" title="17">      <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Sally Jones&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-18" title="18">      <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-19" title="19">    <span class="op">},</span></a>
<a class="sourceLine" id="cb68-20" title="20">  <span class="op">}</span></a>
<a class="sourceLine" id="cb68-21" title="21"><span class="op">}</span></a></code></pre></div>
<p>The store now needs to handle new action types like <code>'HIRE_FARMER'</code> and <code>'PAY_FARMER'</code> by updating the <code>farmers</code> slice of state. You could add more cases to your existing reducer, but eventually the existing reducer would become too large and difficult to manage. The solution is to split the reducer into separate <code>fruit</code> and <code>farmers</code> reducers.</p>
<p>Splitting up the reducer into multiple reducers handling separate, independent <em>slices</em> of state is called <strong>reducer composition</strong>, and it’s the fundamental pattern of building Redux apps. Because each reducer only handles a single <em>slice</em> of state, its <code>state</code> parameter corresponds only to the part of the state that it manages and it only responds to actions that concern that slice of state.</p>
<p>Split up your popular Fruit Stand application’s reducer into two reducers:</p>
<ul>
<li><code>fruitReducer</code> - A reducing function that handles actions updating the <code>fruits</code> slice of state</li>
<li><code>farmersReducer</code> - A reducing function that handles actions updating the new <code>farmers</code> slice of state</li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb69-1" title="1"><span class="co">// ./src/reducers/fruitReducer.js</span></a>
<a class="sourceLine" id="cb69-2" title="2"></a>
<a class="sourceLine" id="cb69-3" title="3"><span class="im">import</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb69-4" title="4">  ADD_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb69-5" title="5">  ADD_FRUITS<span class="op">,</span></a>
<a class="sourceLine" id="cb69-6" title="6">  SELL_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb69-7" title="7">  SELL_OUT<span class="op">,</span></a>
<a class="sourceLine" id="cb69-8" title="8"><span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb69-9" title="9"></a>
<a class="sourceLine" id="cb69-10" title="10"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb69-11" title="11">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb69-12" title="12">    <span class="cf">case</span> <span class="dt">ADD_FRUIT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb69-13" title="13">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> <span class="va">action</span>.<span class="at">fruit</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb69-14" title="14">    <span class="cf">case</span> <span class="dt">ADD_FRUITS</span><span class="op">:</span></a>
<a class="sourceLine" id="cb69-15" title="15">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> ...<span class="va">action</span>.<span class="at">fruits</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb69-16" title="16">    <span class="cf">case</span> <span class="dt">SELL_FRUIT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb69-17" title="17">      <span class="kw">const</span> index <span class="op">=</span> <span class="va">state</span>.<span class="at">indexOf</span>(<span class="va">action</span>.<span class="at">fruit</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb69-18" title="18">      <span class="cf">if</span> (index) <span class="op">!==</span> <span class="dv">-1</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb69-19" title="19">        <span class="co">// remove first instance of action.fruit</span></a>
<a class="sourceLine" id="cb69-20" title="20">        <span class="cf">return</span> [...<span class="va">state</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> index)<span class="op">,</span> ...<span class="va">state</span>.<span class="at">slice</span>(index <span class="op">+</span> <span class="dv">1</span>)]<span class="op">;</span></a>
<a class="sourceLine" id="cb69-21" title="21">      <span class="op">}</span></a>
<a class="sourceLine" id="cb69-22" title="22">      <span class="cf">return</span> state<span class="op">;</span> <span class="co">// if action.fruit is not in state, return previous state</span></a>
<a class="sourceLine" id="cb69-23" title="23">    <span class="cf">case</span> <span class="dt">SELL_OUT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb69-24" title="24">      <span class="cf">return</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb69-25" title="25">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb69-26" title="26">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb69-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb69-28" title="28"><span class="op">};</span></a>
<a class="sourceLine" id="cb69-29" title="29"></a>
<a class="sourceLine" id="cb69-30" title="30"><span class="im">export</span> <span class="im">default</span> fruitReducer<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb70-1" title="1"><span class="co">// ./src/reducers/farmersReducer.js</span></a>
<a class="sourceLine" id="cb70-2" title="2"></a>
<a class="sourceLine" id="cb70-3" title="3"><span class="im">import</span> <span class="op">{</span> HIRE_FARMER<span class="op">,</span> PAY_FARMER <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/farmersActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb70-4" title="4"></a>
<a class="sourceLine" id="cb70-5" title="5"><span class="kw">const</span> farmersReducer <span class="op">=</span> (state <span class="op">=</span> <span class="op">{},</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb70-6" title="6">  <span class="kw">let</span> nextState <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> state)<span class="op">;</span></a>
<a class="sourceLine" id="cb70-7" title="7">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb70-8" title="8">    <span class="cf">case</span> <span class="dt">HIRE_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb70-9" title="9">      <span class="kw">const</span> farmerToHire <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb70-10" title="10">        <span class="dt">id</span><span class="op">:</span> <span class="va">action</span>.<span class="at">id</span><span class="op">,</span></a>
<a class="sourceLine" id="cb70-11" title="11">        <span class="dt">name</span><span class="op">:</span> <span class="va">action</span>.<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb70-12" title="12">        <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb70-13" title="13">      <span class="op">};</span></a>
<a class="sourceLine" id="cb70-14" title="14">      nextState[<span class="va">action</span>.<span class="at">id</span>] <span class="op">=</span> farmerToHire<span class="op">;</span></a>
<a class="sourceLine" id="cb70-15" title="15">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb70-16" title="16">    <span class="cf">case</span> <span class="dt">PAY_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb70-17" title="17">      <span class="kw">const</span> farmerToPay <span class="op">=</span> nextState[<span class="va">action</span>.<span class="at">id</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb70-18" title="18">      <span class="va">farmerToPay</span>.<span class="at">paid</span> <span class="op">=</span> <span class="op">!</span><span class="va">farmerToPay</span>.<span class="at">paid</span><span class="op">;</span></a>
<a class="sourceLine" id="cb70-19" title="19">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb70-20" title="20">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb70-21" title="21">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb70-22" title="22">  <span class="op">}</span></a>
<a class="sourceLine" id="cb70-23" title="23"><span class="op">};</span></a>
<a class="sourceLine" id="cb70-24" title="24"></a>
<a class="sourceLine" id="cb70-25" title="25"><span class="im">export</span> <span class="im">default</span> farmersReducer<span class="op">;</span></a></code></pre></div>
<p>You’ll also need to define a module containing the <code>'HIRE_FARMER'</code> and <code>'PAY_FARMER'</code> actions:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb71-1" title="1"><span class="co">// ./src/actions/farmersActions.js</span></a>
<a class="sourceLine" id="cb71-2" title="2"></a>
<a class="sourceLine" id="cb71-3" title="3"><span class="im">export</span> <span class="kw">const</span> HIRE_FARMER <span class="op">=</span> <span class="st">&#39;HIRE_FARMER&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb71-4" title="4"><span class="im">export</span> <span class="kw">const</span> PAY_FARMER <span class="op">=</span> <span class="st">&#39;PAY_FARMER&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb71-5" title="5"></a>
<a class="sourceLine" id="cb71-6" title="6"><span class="im">export</span> <span class="kw">const</span> hireFarmer <span class="op">=</span> (name) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb71-7" title="7">  <span class="dt">type</span><span class="op">:</span> HIRE_FARMER<span class="op">,</span></a>
<a class="sourceLine" id="cb71-8" title="8">  <span class="dt">id</span><span class="op">:</span> <span class="kw">new</span> <span class="at">Date</span>().<span class="at">getTime</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb71-9" title="9">  name<span class="op">,</span></a>
<a class="sourceLine" id="cb71-10" title="10"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb71-11" title="11"></a>
<a class="sourceLine" id="cb71-12" title="12"><span class="im">export</span> <span class="kw">const</span> payFarmer <span class="op">=</span> (id) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb71-13" title="13">  <span class="dt">type</span><span class="op">:</span> PAY_FARMER<span class="op">,</span></a>
<a class="sourceLine" id="cb71-14" title="14">  id<span class="op">,</span></a>
<a class="sourceLine" id="cb71-15" title="15"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="combining-reducers">Combining reducers</h2>
<p>Your reducer setup is now much more modular. However, <code>createStore</code> only takes one <code>reducer</code> argument, so you must combine your reducers back into a single reducer to pass to the store. To do this you’ll use the <code>combineReducers</code> method from the <code>redux</code> package and pass it an object that maps state keys to the reducers that handle those slices of state. Below, the <code>combineReducers</code> maps the <code>fruitReducer</code> for the <code>fruit</code> slice of state and the <code>farmersReducer</code> for the <code>farmers</code> slice of state. Invoking the <code>combineReducers</code> function returns a single <code>rootReducer</code> that you can use to create your Redux store.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb72-1" title="1"><span class="co">// ./src/reducers/rootReducer.js</span></a>
<a class="sourceLine" id="cb72-2" title="2"></a>
<a class="sourceLine" id="cb72-3" title="3"><span class="im">import</span> <span class="op">{</span> combineReducers <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb72-4" title="4"><span class="im">import</span> fruitReducer <span class="im">from</span> <span class="st">&#39;./fruitReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb72-5" title="5"><span class="im">import</span> farmersReducer <span class="im">from</span> <span class="st">&#39;./farmersReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb72-6" title="6"></a>
<a class="sourceLine" id="cb72-7" title="7"><span class="kw">const</span> rootReducer <span class="op">=</span> <span class="at">combineReducers</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb72-8" title="8">  <span class="dt">fruit</span><span class="op">:</span> fruitReducer<span class="op">,</span></a>
<a class="sourceLine" id="cb72-9" title="9">  <span class="dt">farmers</span><span class="op">:</span> farmersReducer</a>
<a class="sourceLine" id="cb72-10" title="10"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb72-11" title="11"></a>
<a class="sourceLine" id="cb72-12" title="12"><span class="im">export</span> <span class="im">default</span> rootReducer<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb73-1" title="1"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb73-2" title="2"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb73-3" title="3"></a>
<a class="sourceLine" id="cb73-4" title="4"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(rootReducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb73-5" title="5"></a>
<a class="sourceLine" id="cb73-6" title="6"><span class="im">export</span> <span class="im">default</span> store<span class="op">;</span></a></code></pre></div>
<h2 id="delegating-to-reducers">Delegating to reducers</h2>
<p>Another aspect of reducer composition involves delegating state updates to subordinate reducers. Consider the farmers reducer. You can modify it so that the <code>farmers</code> (plural) reducer delegates to a <code>farmer</code> (singular) reducer whenever a single farmer’s attributes need to be modified (in this case whenever a farmer has been hired or paid):</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb74-1" title="1"><span class="co">// ./src/reducers/farmersReducer.js</span></a>
<a class="sourceLine" id="cb74-2" title="2"></a>
<a class="sourceLine" id="cb74-3" title="3"><span class="im">import</span> <span class="op">{</span> HIRE_FARMER<span class="op">,</span> PAY_FARMER <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/farmersActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb74-4" title="4"></a>
<a class="sourceLine" id="cb74-5" title="5"><span class="kw">const</span> farmerReducer <span class="op">=</span> (state<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb74-6" title="6">  <span class="co">// State is a farmer object.</span></a>
<a class="sourceLine" id="cb74-7" title="7">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb74-8" title="8">    <span class="cf">case</span> <span class="dt">HIRE_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb74-9" title="9">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb74-10" title="10">        <span class="dt">id</span><span class="op">:</span> <span class="va">action</span>.<span class="at">id</span><span class="op">,</span></a>
<a class="sourceLine" id="cb74-11" title="11">        <span class="dt">name</span><span class="op">:</span> <span class="va">action</span>.<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb74-12" title="12">        <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb74-13" title="13">      <span class="op">};</span></a>
<a class="sourceLine" id="cb74-14" title="14">    <span class="cf">case</span> <span class="dt">PAY_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb74-15" title="15">      <span class="cf">return</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> state<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb74-16" title="16">        <span class="dt">paid</span><span class="op">:</span> <span class="op">!</span><span class="va">state</span>.<span class="at">paid</span></a>
<a class="sourceLine" id="cb74-17" title="17">      <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb74-18" title="18">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb74-19" title="19">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb74-20" title="20">  <span class="op">}</span></a>
<a class="sourceLine" id="cb74-21" title="21"><span class="op">};</span></a>
<a class="sourceLine" id="cb74-22" title="22"></a>
<a class="sourceLine" id="cb74-23" title="23"><span class="kw">const</span> farmersReducer <span class="op">=</span> (state <span class="op">=</span> <span class="op">{},</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb74-24" title="24">  <span class="kw">let</span> nextState <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> state)<span class="op">;</span></a>
<a class="sourceLine" id="cb74-25" title="25">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb74-26" title="26">    <span class="cf">case</span> <span class="dt">HIRE_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb74-27" title="27">      nextState[<span class="va">action</span>.<span class="at">id</span>] <span class="op">=</span> <span class="at">farmerReducer</span>(<span class="kw">undefined</span><span class="op">,</span> action)<span class="op">;</span></a>
<a class="sourceLine" id="cb74-28" title="28">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb74-29" title="29">    <span class="cf">case</span> <span class="dt">PAY_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb74-30" title="30">      nextState[<span class="va">action</span>.<span class="at">id</span>] <span class="op">=</span> <span class="at">farmerReducer</span>(nextState[<span class="va">action</span>.<span class="at">id</span>]<span class="op">,</span> action)<span class="op">;</span></a>
<a class="sourceLine" id="cb74-31" title="31">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb74-32" title="32">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb74-33" title="33">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb74-34" title="34">  <span class="op">}</span></a>
<a class="sourceLine" id="cb74-35" title="35"><span class="op">};</span></a>
<a class="sourceLine" id="cb74-36" title="36"></a>
<a class="sourceLine" id="cb74-37" title="37"><span class="im">export</span> <span class="im">default</span> farmersReducer<span class="op">;</span></a></code></pre></div>
<h3 id="catching-and-preventing-state-mutation-bugs">Catching and preventing state mutation bugs</h3>
<p>Updating the <code>farmersReducer</code> to delegate farmer state updates to the <code>farmerReducer</code> resolved a subtle state mutation bug. Take another look at the original implementation of the <code>farmersReducer</code> function:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb75-1" title="1"><span class="kw">const</span> farmersReducer <span class="op">=</span> (state <span class="op">=</span> <span class="op">{},</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb75-2" title="2">  <span class="kw">let</span> nextState <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> state)<span class="op">;</span></a>
<a class="sourceLine" id="cb75-3" title="3">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb75-4" title="4">    <span class="cf">case</span> <span class="dt">HIRE_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb75-5" title="5">      <span class="kw">const</span> farmerToHire <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb75-6" title="6">        <span class="dt">id</span><span class="op">:</span> <span class="va">action</span>.<span class="at">id</span><span class="op">,</span></a>
<a class="sourceLine" id="cb75-7" title="7">        <span class="dt">name</span><span class="op">:</span> <span class="va">action</span>.<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb75-8" title="8">        <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb75-9" title="9">      <span class="op">};</span></a>
<a class="sourceLine" id="cb75-10" title="10">      nextState[<span class="va">action</span>.<span class="at">id</span>] <span class="op">=</span> farmerToHire<span class="op">;</span></a>
<a class="sourceLine" id="cb75-11" title="11">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb75-12" title="12">    <span class="cf">case</span> <span class="dt">PAY_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb75-13" title="13">      <span class="kw">const</span> farmerToPay <span class="op">=</span> nextState[<span class="va">action</span>.<span class="at">id</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb75-14" title="14">      <span class="va">farmerToPay</span>.<span class="at">paid</span> <span class="op">=</span> <span class="op">!</span><span class="va">farmerToPay</span>.<span class="at">paid</span><span class="op">;</span></a>
<a class="sourceLine" id="cb75-15" title="15">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb75-16" title="16">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb75-17" title="17">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb75-18" title="18">  <span class="op">}</span></a>
<a class="sourceLine" id="cb75-19" title="19"><span class="op">};</span></a></code></pre></div>
<p>Notice that the <code>state</code> parameter is duplicated to the <code>nextState</code> variable using the <code>Object.assign</code> method:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb76-1" title="1"><span class="kw">let</span> nextState <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> state)<span class="op">;</span></a></code></pre></div>
<p>While this code correctly creates a duplicate of the <code>state</code> object, <code>nextState</code> is only a shallow duplicate as only the top-level object is duplicated. Each "farmer" object that the <code>state</code> object refers to are still the <em>same</em> objects.</p>
<p>In the <code>PAY_FARMER</code> case clause, the farmer object is mutated by setting the <code>paid</code> property to a new value:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb77-1" title="1"><span class="cf">case</span> PAY_FARMER<span class="op">:</span></a>
<a class="sourceLine" id="cb77-2" title="2">  <span class="kw">const</span> farmerToPay <span class="op">=</span> nextState[<span class="va">action</span>.<span class="at">id</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb77-3" title="3">  <span class="va">farmerToPay</span>.<span class="at">paid</span> <span class="op">=</span> <span class="op">!</span><span class="va">farmerToPay</span>.<span class="at">paid</span><span class="op">;</span></a>
<a class="sourceLine" id="cb77-4" title="4">  <span class="cf">return</span> nextState<span class="op">;</span></a></code></pre></div>
<p>Now look again at the <code>PAY_FARMER</code> case clause in the version of the <code>farmersReducer</code> that delegates farmer state updates to the <code>farmerReducer</code>:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb78-1" title="1"><span class="cf">case</span> PAY_FARMER<span class="op">:</span></a>
<a class="sourceLine" id="cb78-2" title="2">  nextState[<span class="va">action</span>.<span class="at">id</span>] <span class="op">=</span> <span class="at">farmerReducer</span>(nextState[<span class="va">action</span>.<span class="at">id</span>]<span class="op">,</span> action)<span class="op">;</span></a>
<a class="sourceLine" id="cb78-3" title="3">  <span class="cf">return</span> nextState<span class="op">;</span></a></code></pre></div>
<p>This code calls the <code>farmerReducer</code> by passing in the farmer object for the <code>action.id</code> property value (i.e. <code>nextState[action.id]</code>) and the <code>action</code> parameter. The <code>farmerReducer</code> has a <code>PAY_FARMER</code> case clause that correctly uses the <code>Object.assign</code> method to duplicate the farmer object with the new <code>paid</code> property value (i.e. <code>Object.assign({}, state, { paid: !state.paid })</code>):</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb79-1" title="1"><span class="kw">const</span> farmerReducer <span class="op">=</span> (state<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb79-2" title="2">  <span class="co">// State is a farmer object.</span></a>
<a class="sourceLine" id="cb79-3" title="3">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb79-4" title="4">    <span class="cf">case</span> <span class="dt">HIRE_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb79-5" title="5">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb79-6" title="6">        <span class="dt">id</span><span class="op">:</span> <span class="va">action</span>.<span class="at">id</span><span class="op">,</span></a>
<a class="sourceLine" id="cb79-7" title="7">        <span class="dt">name</span><span class="op">:</span> <span class="va">action</span>.<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb79-8" title="8">        <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb79-9" title="9">      <span class="op">};</span></a>
<a class="sourceLine" id="cb79-10" title="10">    <span class="cf">case</span> <span class="dt">PAY_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb79-11" title="11">      <span class="cf">return</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> state<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb79-12" title="12">        <span class="dt">paid</span><span class="op">:</span> <span class="op">!</span><span class="va">state</span>.<span class="at">paid</span></a>
<a class="sourceLine" id="cb79-13" title="13">      <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb79-14" title="14">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb79-15" title="15">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb79-16" title="16">  <span class="op">}</span></a>
<a class="sourceLine" id="cb79-17" title="17"><span class="op">};</span></a></code></pre></div>
<p><strong>Catching state mutation bugs is difficult to do.</strong> Leveraging patterns like reducer composition can help you from introducing these kinds of bugs in the first place.</p>
<h2 id="destructuring-state-in-your-component">Destructuring State in your component</h2>
<p>If you try to start your Fruit Stand app now, you will probably get an error that looks something like:</p>
<pre><code>TypeError: object is not iterable (cannot read property Symbol(Symbol.iterator))</code></pre>
<p>That is because there is one last thing that you need to do in order prepare your fruitstand to use these split reducers: make sure that your component is accessing the right slice of state. Back in your <code>FruitList.js</code> <code>render</code> method, you are currently assigning the return value of your <code>getState()</code> call to ‘fruit’.</p>
<pre><code>const fruit = store.getState();</code></pre>
<p>If you <code>console.log</code> or insert a debugger just after this line to see what fruit has been assigned, you will see:</p>
<pre><code>fruit = {
  fruit: [],
  farmers: {}
}</code></pre>
<p>Your state shape changed when you created these reducers! You component is trying to iterate over your new state shape, instead of the fruit slice of that state. To give the component access to the array of fruit, destructure this assignment:</p>
<pre><code>const { fruit } = store.getState();</code></pre>
<h2 id="reviewing-a-completed-fruit-stand-example-2">Reviewing a completed Fruit Stand example</h2>
<p>To review and run a completed Fruit Stand example application that contains multiple reducers, clone the <a href="https://github.com/-starters/redux-fruit-stand-examples">redux-fruit-stand-examples</a> repo.</p>
<p>After cloning the repo, open a terminal and browse to the <code>fruit-stand-redux-with-react-multiple-reducers</code> folder. Run the command <code>npm install</code> to install the project’s dependencies. Then use the command <code>npm start</code> to run the Fruit Stand application.</p>
<p>This Fruit Stand example application is a React application created by the Create React App tooling. When running the application using <code>npm start</code>, the application should automatically open in your default browser. If it doesn’t, you can manually browse to <code>http://localhost:3000/</code> to view the application.</p>
<h2 id="what-you-learned-7">What you learned</h2>
<p>In this article, you learned how to define multiple reducers to manage individual slices of state. You also learned how to use the Redux <code>combineReducers</code> method to combine multiple reducers into a single root reducer and how to update a reducer to delegate a state update to a subordinate reducer.</p>
<hr />
<h1 id="container-components">Container Components</h1>
<p>As you saw in an earlier article, there can be quite a bit of code involved in connecting a component to the store. Putting all this code into the component with heavy rendering logic tends to cause bloated components and violates the principle of <a href="https://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a>. Therefore, it’s a common pattern in Redux code to separate <strong>presentational components</strong> from their connected counterparts, called <strong>containers</strong>.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Describe how container components differ from presentational components</li>
<li>Write a container component to handle all of the Redux store interaction for one or more presentational components</li>
</ul>
<h2 id="comparing-presentational-and-container-components">Comparing presentational and container components</h2>
<p>The distinction between presentational components and containers is not technical but rather functional. Presentational components are concerned with how things look and container components are concerned with how things work.</p>
<p>Here’s a table outlining the differences:</p>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 34%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Presentational</th>
<th>Container</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Purpose</td>
<td>How things look (markup, styles)</td>
<td>How things work (data fetching, state updates)</td>
</tr>
<tr class="even">
<td>Aware of Redux</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>To Read Data</td>
<td>Read data from <code>props</code></td>
<td>Subscribe to Redux state</td>
</tr>
<tr class="even">
<td>To Change Data</td>
<td>Invoke callbacks from <code>props</code></td>
<td>Dispatch Redux actions</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> You’ll start with writing all of the code for your container components by hand. Later in this lesson, you’ll learn how to create container components using the <a href="https://react-redux.js.org/">React-Redux</a> library’s <code>connect</code> method.</p>
</blockquote>
<h2 id="determining-where-to-create-containers">Determining where to create containers</h2>
<p>Not every component needs to be connected to the store. Generally, you’ll only want to create containers for the ‘big’ components in your app that represent sections of a page and contain smaller purely functional presentational components. These larger container components are responsible for interacting with the store and passing state and dispatch props down to all their presentational children.</p>
<p>For the Fruit Stand application, a good starting point would be to create two container components, <code>FruitManagerContainer</code> and <code>FarmerManagerContainer</code>, to respectively render the presentational components for the "Fruit" and "Farmers" sections of the page. Here’s a visual representation of that component hierarchy:</p>
<pre><code>App
├── FruitManagerContainer
│   └── FruitManager
│       ├── FruitList
│       ├── FruitSeller
│       ├── FruitQuickAdd
│       └── FruitBulkAdd
└── FarmerManagerContainer
    └── FarmerManager
        ├── FarmerList
        │   └── Farmer
        └── FarmerHire</code></pre>
<p>Notice that the container component names are a combination of the name of the presentational component that they wrap and the suffix "Container".</p>
<p>In general, aim to have fewer containers rather than more. Most of the components you’ll write will be presentational, but you’ll need to generate a few containers to connect presentational components to the Redux store.</p>
<h2 id="writing-a-container-component">Writing a container component</h2>
<p>While you can write a container component from scratch, you can also refactor an existing React component that interacts with a Redux store into separate container and presentational components.</p>
<h3 id="using-a-container-component-to-retrieve-state">Using a container component to retrieve state</h3>
<p>Here’s the current version of the <code>FruitList</code> component that subscribes to the store (using <code>store.subscribe</code>) to know when state has been updated and calls <code>store.getState</code> to retrieve and render the <code>fruit</code> state slice:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb85-1" title="1"><span class="co">// ./src/components/FruitList.js</span></a>
<a class="sourceLine" id="cb85-2" title="2"></a>
<a class="sourceLine" id="cb85-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb85-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb85-5" title="5"></a>
<a class="sourceLine" id="cb85-6" title="6"><span class="kw">class</span> FruitList <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb85-7" title="7">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb85-8" title="8">    <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb85-9" title="9">      <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb85-10" title="10">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb85-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb85-12" title="12"></a>
<a class="sourceLine" id="cb85-13" title="13">  <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb85-14" title="14">    <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb85-15" title="15">      <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb85-16" title="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb85-17" title="17">  <span class="op">}</span></a>
<a class="sourceLine" id="cb85-18" title="18"></a>
<a class="sourceLine" id="cb85-19" title="19">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb85-20" title="20">    <span class="kw">const</span> <span class="op">{</span> fruit <span class="op">}</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb85-21" title="21"></a>
<a class="sourceLine" id="cb85-22" title="22">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb85-23" title="23">      <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb85-24" title="24">        <span class="op">{</span><span class="va">fruit</span>.<span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb85-25" title="25">          <span class="op">?</span> <span class="op">&lt;</span>ul<span class="op">&gt;{</span><span class="va">fruit</span>.<span class="at">map</span>((fruitName<span class="op">,</span> index) <span class="kw">=&gt;</span> <span class="op">&lt;</span>li key<span class="op">={</span>index<span class="op">}&gt;{</span>fruitName<span class="op">}</span>&lt;/li<span class="op">&gt;</span>)<span class="op">}</span>&lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb85-26" title="26">          : <span class="op">&lt;</span>span<span class="op">&gt;</span>No fruit currently <span class="kw">in</span> stock<span class="op">!</span>&lt;/span<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb85-27" title="27">        <span class="op">}</span></a>
<a class="sourceLine" id="cb85-28" title="28">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb85-29" title="29">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb85-30" title="30">  <span class="op">}</span></a>
<a class="sourceLine" id="cb85-31" title="31"><span class="op">}</span></a>
<a class="sourceLine" id="cb85-32" title="32"></a>
<a class="sourceLine" id="cb85-33" title="33"><span class="im">export</span> <span class="im">default</span> FruitList<span class="op">;</span></a></code></pre></div>
<p>The <code>FruitManager</code> component is responsible for rendering each of the fruit-related components (i.e. <code>FruitList</code>, <code>FruitSeller</code>, <code>FruitQuickAdd</code>, and <code>FruitBulkAdd</code>), so create a container component named <code>FruitManagerContainer</code> to handle all of the store interaction for the "Fruit" section of the page.</p>
<p>To review, here’s what the component hierarchy will look like:</p>
<pre><code>FruitManagerContainer
└── FruitManager
    ├── FruitList
    ├── FruitSeller
    ├── FruitQuickAdd
    └── FruitBulkAdd</code></pre>
<p>As a starting point, here’s the code for the <code>FruitManagerContainer</code> component:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb87-1" title="1"><span class="co">// ./src/components/FruitManagerContainer.js</span></a>
<a class="sourceLine" id="cb87-2" title="2"></a>
<a class="sourceLine" id="cb87-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb87-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb87-5" title="5"><span class="im">import</span> FruitManager <span class="im">from</span> <span class="st">&#39;./FruitManager&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb87-6" title="6"></a>
<a class="sourceLine" id="cb87-7" title="7"><span class="kw">class</span> FruitManagerContainer <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb87-8" title="8">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb87-9" title="9">    <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb87-10" title="10">      <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb87-11" title="11">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb87-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb87-13" title="13"></a>
<a class="sourceLine" id="cb87-14" title="14">  <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb87-15" title="15">    <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb87-16" title="16">      <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb87-17" title="17">    <span class="op">}</span></a>
<a class="sourceLine" id="cb87-18" title="18">  <span class="op">}</span></a>
<a class="sourceLine" id="cb87-19" title="19"></a>
<a class="sourceLine" id="cb87-20" title="20">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb87-21" title="21">    <span class="kw">const</span> <span class="op">{</span> fruit <span class="op">}</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb87-22" title="22"></a>
<a class="sourceLine" id="cb87-23" title="23">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb87-24" title="24">      <span class="op">&lt;</span>FruitManager fruit<span class="op">={</span>fruit<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb87-25" title="25">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb87-26" title="26">  <span class="op">}</span></a>
<a class="sourceLine" id="cb87-27" title="27"><span class="op">}</span></a>
<a class="sourceLine" id="cb87-28" title="28"></a>
<a class="sourceLine" id="cb87-29" title="29"><span class="im">export</span> <span class="im">default</span> FruitManagerContainer<span class="op">;</span></a></code></pre></div>
<p>Notice that the container component, just like the original version of the <code>FruitList</code> component, subscribes to the store (using <code>store.subscribe</code>) to know when state has been updated and calls <code>store.getState</code> to retrieve the <code>fruit</code> state slice. But instead of directly rendering the <code>fruit</code> state, it sets a prop on the <code>FruitManager</code> component to pass the state down the component hierarchy.</p>
<p>The <code>FruitManager</code> component receives the <code>fruit</code> prop and in turn uses a prop to pass it down to the <code>FruitList</code> component:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb88-1" title="1"><span class="co">// ./src/components/FruitManager.js</span></a>
<a class="sourceLine" id="cb88-2" title="2"></a>
<a class="sourceLine" id="cb88-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb88-4" title="4"><span class="im">import</span> FruitList <span class="im">from</span> <span class="st">&#39;./FruitList&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb88-5" title="5"><span class="im">import</span> FruitSeller <span class="im">from</span> <span class="st">&#39;./FruitSeller&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb88-6" title="6"><span class="im">import</span> FruitQuickAdd <span class="im">from</span> <span class="st">&#39;./FruitQuickAdd&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb88-7" title="7"><span class="im">import</span> FruitBulkAdd <span class="im">from</span> <span class="st">&#39;./FruitBulkAdd&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb88-8" title="8"></a>
<a class="sourceLine" id="cb88-9" title="9"><span class="kw">const</span> FruitManager <span class="op">=</span> (<span class="op">{</span> fruit <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb88-10" title="10">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb88-11" title="11">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb88-12" title="12">      <span class="op">&lt;</span>h2<span class="op">&gt;</span>Available Fruit&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb88-13" title="13">      <span class="op">&lt;</span>FruitList fruit<span class="op">={</span>fruit<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb88-14" title="14">      <span class="op">&lt;</span>h2<span class="op">&gt;</span>Fruit Inventory Manager&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb88-15" title="15">      <span class="op">&lt;</span>FruitSeller /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb88-16" title="16">      <span class="op">&lt;</span>FruitQuickAdd /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb88-17" title="17">      <span class="op">&lt;</span>FruitBulkAdd /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb88-18" title="18">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb88-19" title="19">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb88-20" title="20"><span class="op">};</span></a>
<a class="sourceLine" id="cb88-21" title="21"></a>
<a class="sourceLine" id="cb88-22" title="22"><span class="im">export</span> <span class="im">default</span> FruitManager<span class="op">;</span></a></code></pre></div>
<p>And finally, the <code>FruitList</code> component receives the <code>fruit</code> prop and renders it into an unordered list:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb89-1" title="1"><span class="co">// ./src/components/FruitList.js</span></a>
<a class="sourceLine" id="cb89-2" title="2"></a>
<a class="sourceLine" id="cb89-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb89-4" title="4"></a>
<a class="sourceLine" id="cb89-5" title="5"><span class="kw">const</span> FruitList <span class="op">=</span> (<span class="op">{</span> fruit <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb89-6" title="6">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb89-7" title="7">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb89-8" title="8">      <span class="op">{</span><span class="va">fruit</span>.<span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb89-9" title="9">        <span class="op">?</span> <span class="op">&lt;</span>ul<span class="op">&gt;{</span><span class="va">fruit</span>.<span class="at">map</span>((fruitName<span class="op">,</span> index) <span class="kw">=&gt;</span> <span class="op">&lt;</span>li key<span class="op">={</span>index<span class="op">}&gt;{</span>fruitName<span class="op">}</span>&lt;/li<span class="op">&gt;</span>)<span class="op">}</span>&lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb89-10" title="10">        : <span class="op">&lt;</span>span<span class="op">&gt;</span>No fruit currently <span class="kw">in</span> stock<span class="op">!</span>&lt;/span<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb89-11" title="11">      <span class="op">}</span></a>
<a class="sourceLine" id="cb89-12" title="12">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb89-13" title="13">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb89-14" title="14"><span class="op">};</span></a>
<a class="sourceLine" id="cb89-15" title="15"></a>
<a class="sourceLine" id="cb89-16" title="16"><span class="im">export</span> <span class="im">default</span> FruitList<span class="op">;</span></a></code></pre></div>
<blockquote>
<p><strong>Reminder:</strong> Using component props to pass a value down the component hierarchy is known as <em>prop threading</em>.</p>
</blockquote>
<p>Notice that the <code>FruitList</code> <em>presentational</em> component, which no longer needs to use the <code>componentDidMount</code> and <code>componentWillUnmount</code> lifecycle methods to subscribe and unsubscribe to the store, can be refactored into a function component. Additionally, the <code>store</code> is no longer imported in the <code>FruitList</code> module, as the <code>FruitList</code> component simply receives and renders the <code>fruit</code> state via a prop without any knowledge of or direct interaction with the store.</p>
<h3 id="using-a-container-component-to-dispatch-actions">Using a container component to dispatch actions</h3>
<p>Here’s the current version of the <code>FruitQuickAdd</code> component that dispatches the <code>ADD_FRUIT</code> action to add a fruit to the fruit stand:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb90-1" title="1"><span class="co">// ./src/components/FruitQuickAdd.js</span></a>
<a class="sourceLine" id="cb90-2" title="2"></a>
<a class="sourceLine" id="cb90-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb90-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb90-5" title="5"><span class="im">import</span> <span class="op">{</span> addFruit <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb90-6" title="6"></a>
<a class="sourceLine" id="cb90-7" title="7"><span class="kw">class</span> FruitQuickAdd <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb90-8" title="8">  addFruitClick <span class="op">=</span> (event) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb90-9" title="9">    <span class="kw">const</span> fruit <span class="op">=</span> <span class="va">event</span>.<span class="va">target</span>.<span class="at">innerText</span><span class="op">;</span></a>
<a class="sourceLine" id="cb90-10" title="10">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruit</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb90-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb90-12" title="12"></a>
<a class="sourceLine" id="cb90-13" title="13">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb90-14" title="14">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb90-15" title="15">      <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb90-16" title="16">        <span class="op">&lt;</span>h3<span class="op">&gt;</span>Quick Add&lt;/h3<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb90-17" title="17">        <span class="op">&lt;</span>button onClick<span class="op">={</span><span class="kw">this</span>.<span class="at">addFruitClick</span><span class="op">}&gt;</span>APPLE&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb90-18" title="18">        <span class="op">&lt;</span>button onClick<span class="op">={</span><span class="kw">this</span>.<span class="at">addFruitClick</span><span class="op">}&gt;</span>ORANGE&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb90-19" title="19">      &lt;/div<span class="op">&gt;</span>  </a>
<a class="sourceLine" id="cb90-20" title="20">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb90-21" title="21">  <span class="op">}</span></a>
<a class="sourceLine" id="cb90-22" title="22"><span class="op">}</span></a>
<a class="sourceLine" id="cb90-23" title="23"></a>
<a class="sourceLine" id="cb90-24" title="24"><span class="im">export</span> <span class="im">default</span> FruitQuickAdd<span class="op">;</span></a></code></pre></div>
<p>To prepare to refactor the <code>FruitQuickAdd</code> component into a <em>presentational</em> component, update the <code>FruitManagerContainer</code> component to the following code:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb91-1" title="1"><span class="co">// ./src/components/FruitManagerContainer.js</span></a>
<a class="sourceLine" id="cb91-2" title="2"></a>
<a class="sourceLine" id="cb91-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb91-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb91-5" title="5"><span class="im">import</span> <span class="op">{</span> addFruit <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb91-6" title="6"><span class="im">import</span> FruitManager <span class="im">from</span> <span class="st">&#39;./FruitManager&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb91-7" title="7"></a>
<a class="sourceLine" id="cb91-8" title="8"><span class="kw">class</span> FruitManagerContainer <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb91-9" title="9">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb91-10" title="10">    <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb91-11" title="11">      <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb91-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb91-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb91-14" title="14"></a>
<a class="sourceLine" id="cb91-15" title="15">  <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb91-16" title="16">    <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb91-17" title="17">      <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb91-18" title="18">    <span class="op">}</span></a>
<a class="sourceLine" id="cb91-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb91-20" title="20"></a>
<a class="sourceLine" id="cb91-21" title="21">  add <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb91-22" title="22">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruit</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb91-23" title="23">  <span class="op">}</span></a>
<a class="sourceLine" id="cb91-24" title="24"></a>
<a class="sourceLine" id="cb91-25" title="25">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb91-26" title="26">    <span class="kw">const</span> <span class="op">{</span> fruit <span class="op">}</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb91-27" title="27"></a>
<a class="sourceLine" id="cb91-28" title="28">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb91-29" title="29">      <span class="op">&lt;</span>FruitManager</a>
<a class="sourceLine" id="cb91-30" title="30">        fruit<span class="op">={</span>fruit<span class="op">}</span></a>
<a class="sourceLine" id="cb91-31" title="31">        add<span class="op">={</span><span class="kw">this</span>.<span class="at">add</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb91-32" title="32">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb91-33" title="33">  <span class="op">}</span></a>
<a class="sourceLine" id="cb91-34" title="34"><span class="op">}</span></a>
<a class="sourceLine" id="cb91-35" title="35"></a>
<a class="sourceLine" id="cb91-36" title="36"><span class="im">export</span> <span class="im">default</span> FruitManagerContainer<span class="op">;</span></a></code></pre></div>
<p>Notice that the <code>addFruit</code> action creator is imported (at the top of the file) and a new component method named <code>add</code> receives a <code>fruit</code> parameter value and calls <code>store.dispatch</code> to dispatch a <code>ADD_FRUIT</code> action. The <code>render</code> method sets a prop on the <code>FruitManager</code> component to pass the <code>add</code> method down the component hierarchy.</p>
<p>The <code>FruitManager</code> component receives the <code>add</code> prop and in turn uses a prop to pass it down to the <code>FruitQuickAdd</code> component:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb92-1" title="1"><span class="co">// ./src/components/FruitManager.js</span></a>
<a class="sourceLine" id="cb92-2" title="2"></a>
<a class="sourceLine" id="cb92-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb92-4" title="4"><span class="im">import</span> FruitList <span class="im">from</span> <span class="st">&#39;./FruitList&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb92-5" title="5"><span class="im">import</span> FruitSeller <span class="im">from</span> <span class="st">&#39;./FruitSeller&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb92-6" title="6"><span class="im">import</span> FruitQuickAdd <span class="im">from</span> <span class="st">&#39;./FruitQuickAdd&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb92-7" title="7"><span class="im">import</span> FruitBulkAdd <span class="im">from</span> <span class="st">&#39;./FruitBulkAdd&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb92-8" title="8"></a>
<a class="sourceLine" id="cb92-9" title="9"><span class="kw">const</span> FruitManager <span class="op">=</span> (<span class="op">{</span> fruit<span class="op">,</span> add <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb92-10" title="10">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb92-11" title="11">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb92-12" title="12">      <span class="op">&lt;</span>h2<span class="op">&gt;</span>Available Fruit&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb92-13" title="13">      <span class="op">&lt;</span>FruitList fruit<span class="op">={</span>fruit<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb92-14" title="14">      <span class="op">&lt;</span>h2<span class="op">&gt;</span>Fruit Inventory Manager&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb92-15" title="15">      <span class="op">&lt;</span>FruitSeller /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb92-16" title="16">      <span class="op">&lt;</span>FruitQuickAdd add<span class="op">={</span>add<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb92-17" title="17">      <span class="op">&lt;</span>FruitBulkAdd /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb92-18" title="18">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb92-19" title="19">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb92-20" title="20"><span class="op">};</span></a>
<a class="sourceLine" id="cb92-21" title="21"></a>
<a class="sourceLine" id="cb92-22" title="22"><span class="im">export</span> <span class="im">default</span> FruitManager<span class="op">;</span></a></code></pre></div>
<p>And finally, the <code>FruitQuickAdd</code> component receives the <code>add</code> callback function via a prop and calls it within a <code>handleClick</code> event handler, passing in the target button’s inner text:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb93-1" title="1"><span class="co">// ./src/components/FruitQuickAdd.js</span></a>
<a class="sourceLine" id="cb93-2" title="2"></a>
<a class="sourceLine" id="cb93-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb93-4" title="4"></a>
<a class="sourceLine" id="cb93-5" title="5"><span class="kw">const</span> FruitQuickAdd <span class="op">=</span> (<span class="op">{</span> add <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb93-6" title="6">  <span class="kw">const</span> handleClick <span class="op">=</span> (event) <span class="kw">=&gt;</span> <span class="at">add</span>(<span class="va">event</span>.<span class="va">target</span>.<span class="at">innerText</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb93-7" title="7"></a>
<a class="sourceLine" id="cb93-8" title="8">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb93-9" title="9">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb93-10" title="10">      <span class="op">&lt;</span>h3<span class="op">&gt;</span>Quick Add&lt;/h3<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb93-11" title="11">      <span class="op">&lt;</span>button onClick<span class="op">={</span>handleClick<span class="op">}&gt;</span>APPLE&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb93-12" title="12">      <span class="op">&lt;</span>button onClick<span class="op">={</span>handleClick<span class="op">}&gt;</span>ORANGE&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb93-13" title="13">    &lt;/div<span class="op">&gt;</span>  </a>
<a class="sourceLine" id="cb93-14" title="14">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb93-15" title="15"><span class="op">};</span></a>
<a class="sourceLine" id="cb93-16" title="16"></a>
<a class="sourceLine" id="cb93-17" title="17"><span class="im">export</span> <span class="im">default</span> FruitQuickAdd<span class="op">;</span></a></code></pre></div>
<p>The change between the original and refactored <code>FruitQuickAdd</code> component isn’t as dramatic as the <code>FruitList</code> component example, but it’s still a significant improvement to the overall separation of concerns. The <code>FruitQuickAdd</code> component is now strictly concerned with rendering the UI and handling user generated events (i.e. button clicks) and the <code>FruitManagerContainer</code> component is now strictly concerned with interacting with the Redux store.</p>
<h3 id="reviewing-the-completed-container-component">Reviewing the completed container component</h3>
<p>The <code>FruitManagerContainer</code> <em>container</em> component can continue to be expanded until each of its child <em>presentational</em> components no longer interact directly with the store. Here’s a look at the completed <code>FruitManagerContainer</code> component:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb94-1" title="1"><span class="co">// ./src/components/FruitManagerContainer.js</span></a>
<a class="sourceLine" id="cb94-2" title="2"></a>
<a class="sourceLine" id="cb94-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-5" title="5"><span class="im">import</span> <span class="op">{</span> addFruit<span class="op">,</span> addFruits<span class="op">,</span> sellFruit<span class="op">,</span> sellOut <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-6" title="6"><span class="im">import</span> FruitManager <span class="im">from</span> <span class="st">&#39;./FruitManager&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-7" title="7"></a>
<a class="sourceLine" id="cb94-8" title="8"><span class="kw">class</span> FruitManagerContainer <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb94-9" title="9">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb94-10" title="10">    <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb94-11" title="11">      <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb94-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb94-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb94-14" title="14"></a>
<a class="sourceLine" id="cb94-15" title="15">  <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb94-16" title="16">    <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb94-17" title="17">      <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb94-18" title="18">    <span class="op">}</span></a>
<a class="sourceLine" id="cb94-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb94-20" title="20"></a>
<a class="sourceLine" id="cb94-21" title="21">  add <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb94-22" title="22">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruit</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb94-23" title="23">  <span class="op">}</span></a>
<a class="sourceLine" id="cb94-24" title="24"></a>
<a class="sourceLine" id="cb94-25" title="25">  addBulk <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb94-26" title="26">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruits</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb94-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb94-28" title="28"></a>
<a class="sourceLine" id="cb94-29" title="29">  sell <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb94-30" title="30">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">sellFruit</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb94-31" title="31">  <span class="op">}</span></a>
<a class="sourceLine" id="cb94-32" title="32"></a>
<a class="sourceLine" id="cb94-33" title="33">  sellAll <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb94-34" title="34">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">sellOut</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb94-35" title="35">  <span class="op">}</span></a>
<a class="sourceLine" id="cb94-36" title="36"></a>
<a class="sourceLine" id="cb94-37" title="37">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb94-38" title="38">    <span class="kw">const</span> <span class="op">{</span> fruit <span class="op">}</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb94-39" title="39">    <span class="kw">const</span> distinctFruit <span class="op">=</span> <span class="va">Array</span>.<span class="at">from</span>(<span class="kw">new</span> <span class="at">Set</span>(fruit)).<span class="at">sort</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb94-40" title="40"></a>
<a class="sourceLine" id="cb94-41" title="41">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb94-42" title="42">      <span class="op">&lt;</span>FruitManager</a>
<a class="sourceLine" id="cb94-43" title="43">        fruit<span class="op">={</span>fruit<span class="op">}</span></a>
<a class="sourceLine" id="cb94-44" title="44">        distinctFruit<span class="op">={</span>distinctFruit<span class="op">}</span></a>
<a class="sourceLine" id="cb94-45" title="45">        add<span class="op">={</span><span class="kw">this</span>.<span class="at">add</span><span class="op">}</span></a>
<a class="sourceLine" id="cb94-46" title="46">        addBulk<span class="op">={</span><span class="kw">this</span>.<span class="at">addBulk</span><span class="op">}</span></a>
<a class="sourceLine" id="cb94-47" title="47">        sell<span class="op">={</span><span class="kw">this</span>.<span class="at">sell</span><span class="op">}</span></a>
<a class="sourceLine" id="cb94-48" title="48">        sellAll<span class="op">={</span><span class="kw">this</span>.<span class="at">sellAll</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb94-49" title="49">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb94-50" title="50">  <span class="op">}</span></a>
<a class="sourceLine" id="cb94-51" title="51"><span class="op">}</span></a>
<a class="sourceLine" id="cb94-52" title="52"></a>
<a class="sourceLine" id="cb94-53" title="53"><span class="im">export</span> <span class="im">default</span> FruitManagerContainer<span class="op">;</span></a></code></pre></div>
<h2 id="reviewing-a-completed-fruit-stand-example-3">Reviewing a completed Fruit Stand example</h2>
<p>To review and run a completed Fruit Stand example application that utilizes containers, clone the <a href="https://github.com/-starters/redux-fruit-stand-examples">redux-fruit-stand-examples</a> repo.</p>
<p>After cloning the repo, open a terminal and browse to the <code>fruit-stand-redux-with-react-containers</code> folder. Run the command <code>npm install</code> to install the project’s dependencies. Then use the command <code>npm start</code> to run the Fruit Stand application.</p>
<p>This Fruit Stand example application is a React application created by the Create React App tooling. When running the application using <code>npm start</code>, the application should automatically open in your default browser. If it doesn’t, you can manually browse to <code>http://localhost:3000/</code> to view the application.</p>
<h2 id="what-you-learned-8">What you learned</h2>
<p>In this article, you learned how container components differ from presentational components. You also learned how to write a container component to handle all of the Redux store interaction for one or more presentational components.</p>
<hr />
<h1 id="freezing-objects">Freezing Objects</h1>
<p>As you learned earlier in this lesson, a reducer must never mutate its arguments. If the state changes, the reducer must return a new object.</p>
<p>JavaScript provides us with an easy way to enforce this. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze"><code>Object.freeze</code></a> prevents new properties from being added to an object, and also prevents properties currently on an object from being altered or deleted. Essentially, it renders an object immutable, which is exactly what you want.</p>
<p>When you finish this article, you should be able to use <code>Object.freeze</code> to prevent the current state within a reducer from being mutated.</p>
<h2 id="using-object.freeze-to-prevent-state-mutations">Using <code>Object.freeze</code> to prevent state mutations</h2>
<p>By calling <code>Object.freeze(state)</code> at the top of every reducer, you can ensure that the state is never accidentally mutated. For example, this is what your farmer reducer from the Fruit Stand application would look like:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb95-1" title="1"><span class="kw">const</span> farmersReducer <span class="op">=</span> (state <span class="op">=</span> <span class="op">{},</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb95-2" title="2">  <span class="va">Object</span>.<span class="at">freeze</span>(state)<span class="op">;</span></a>
<a class="sourceLine" id="cb95-3" title="3">  <span class="kw">let</span> nextState <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> state)<span class="op">;</span></a>
<a class="sourceLine" id="cb95-4" title="4">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb95-5" title="5">    <span class="cf">case</span> <span class="dt">HIRE_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb95-6" title="6">      <span class="kw">const</span> farmerToHire <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb95-7" title="7">        <span class="dt">id</span><span class="op">:</span> <span class="va">action</span>.<span class="at">id</span><span class="op">,</span></a>
<a class="sourceLine" id="cb95-8" title="8">        <span class="dt">name</span><span class="op">:</span> <span class="va">action</span>.<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb95-9" title="9">        <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb95-10" title="10">      <span class="op">};</span></a>
<a class="sourceLine" id="cb95-11" title="11">      nextState[<span class="va">action</span>.<span class="at">id</span>] <span class="op">=</span> farmerToHire<span class="op">;</span></a>
<a class="sourceLine" id="cb95-12" title="12">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb95-13" title="13">    <span class="cf">case</span> <span class="dt">PAY_FARMER</span><span class="op">:</span></a>
<a class="sourceLine" id="cb95-14" title="14">      <span class="kw">const</span> farmerToPay <span class="op">=</span> nextState[<span class="va">action</span>.<span class="at">id</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb95-15" title="15">      <span class="va">farmerToPay</span>.<span class="at">paid</span> <span class="op">=</span> <span class="op">!</span><span class="va">farmerToPay</span>.<span class="at">paid</span><span class="op">;</span></a>
<a class="sourceLine" id="cb95-16" title="16">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb95-17" title="17">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb95-18" title="18">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb95-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb95-20" title="20"><span class="op">};</span></a></code></pre></div>
<p>Now you can be certain that you won’t accidentally mutate the state within the reducer.</p>
<h3 id="understanding-the-difference-between-deep-and-shallow-freezes">Understanding the difference between deep and shallow freezes</h3>
<p>Here’s another example:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb96-1" title="1"><span class="kw">const</span> people <span class="op">=</span> <span class="op">{</span> <span class="dt">farmers</span><span class="op">:</span> <span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Old MacDonald&#39;</span> <span class="op">}</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb96-2" title="2"><span class="va">Object</span>.<span class="at">freeze</span>(people)<span class="op">;</span></a></code></pre></div>
<p>When you try to mutate an object that you <em>froze</em> by modifying a property, it will be prevented:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb97-1" title="1"><span class="va">people</span>.<span class="at">farmers</span> <span class="op">=</span> <span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Young MacDonald&#39;</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb97-2" title="2">people<span class="op">;</span> <span class="co">// { farmers: { name: &#39;Old MacDonald&#39; } }</span></a></code></pre></div>
<p><strong>Note: This is not a <em>deep freeze</em>.</strong> <code>Object.freeze</code> performs a <em>shallow freeze</em> as it only applies to the immediate properties of the object itself. Nested objects can still be mutated, so be careful. Here’s an example of this:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb98-1" title="1"><span class="va">people</span>.<span class="va">farmers</span>.<span class="at">name</span> <span class="op">=</span> <span class="st">&#39;Young MacDonald&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb98-2" title="2">people<span class="op">;</span> <span class="co">// { farmers: { name: &#39;Young MacDonald&#39; } }</span></a></code></pre></div>
<h3 id="object.freeze-and-arrays"><code>Object.freeze</code> and arrays</h3>
<p>You can also use <code>Object.freeze</code> to freeze an array, so if a reducer’s <code>state</code> parameter is an array, you can still prevent accidental state mutations:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb99-1" title="1"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb99-2" title="2">  <span class="va">Object</span>.<span class="at">freeze</span>(state)<span class="op">;</span></a>
<a class="sourceLine" id="cb99-3" title="3">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb99-4" title="4">    <span class="cf">case</span> <span class="dt">ADD_FRUIT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb99-5" title="5">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> <span class="va">action</span>.<span class="at">fruit</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb99-6" title="6">    <span class="cf">case</span> <span class="dt">ADD_FRUITS</span><span class="op">:</span></a>
<a class="sourceLine" id="cb99-7" title="7">      <span class="cf">return</span> [...<span class="at">state</span><span class="op">,</span> ...<span class="va">action</span>.<span class="at">fruits</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb99-8" title="8">    <span class="cf">case</span> <span class="dt">SELL_FRUIT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb99-9" title="9">      <span class="kw">const</span> index <span class="op">=</span> <span class="va">state</span>.<span class="at">indexOf</span>(<span class="va">action</span>.<span class="at">fruit</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb99-10" title="10">      <span class="cf">if</span> (index <span class="op">!==</span> <span class="dv">-1</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb99-11" title="11">        <span class="co">// remove first instance of action.fruit</span></a>
<a class="sourceLine" id="cb99-12" title="12">        <span class="cf">return</span> [...<span class="va">state</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> index)<span class="op">,</span> ...<span class="va">state</span>.<span class="at">slice</span>(index <span class="op">+</span> <span class="dv">1</span>)]<span class="op">;</span></a>
<a class="sourceLine" id="cb99-13" title="13">      <span class="op">}</span></a>
<a class="sourceLine" id="cb99-14" title="14">      <span class="cf">return</span> state<span class="op">;</span> <span class="co">// if action.fruit is not in state, return previous state</span></a>
<a class="sourceLine" id="cb99-15" title="15">    <span class="cf">case</span> <span class="dt">SELL_OUT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb99-16" title="16">      <span class="cf">return</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb99-17" title="17">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb99-18" title="18">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb99-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb99-20" title="20"><span class="op">};</span></a></code></pre></div>
<p>When an array is frozen with <code>Object.freeze</code>, its elements cannot be altered and no elements can be added to or removed from the array. Just like with objects, freezing arrays has limitations. If the array’s elements containing objects, properties on those objects can still be mutated.</p>
<h2 id="what-you-learned-9">What you learned</h2>
<p>In this article, you learned how to use <code>Object.freeze</code> to prevent the current state within a reducer from being mutated.</p>
<hr />
<h1 id="preloaded-state">Preloaded State</h1>
<p>Currently, when the page in the browser is reloaded, any state data stored in the Redux store is lost. Later in this lesson, you’ll learn how to use Redux to interact with an API to persist state data. Until then (or if your React application doesn’t use an API), you can use the combination of Redux’s ability to create a store with <em>preloaded state</em> with the browser’s local storage to persist store state across page reloads.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Create a Redux store with preloaded state</li>
<li>Use the browser’s local storage to persist a Redux store’s state across page reloads</li>
</ul>
<h2 id="creating-a-store-with-preloaded-state">Creating a store with preloaded state</h2>
<p>So far, your Redux stores have initialized with no initial state. Sometimes, though, you may want to take pre-existing data and pass it into the store upon initialization. Such data can be passed to the <code>createStore</code> method using the <code>preloadedState</code> argument:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb100-1" title="1"><span class="kw">const</span> preloadedState <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb100-2" title="2">  <span class="dt">fruit</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb100-3" title="3">    <span class="st">&#39;APPLE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb100-4" title="4">    <span class="st">&#39;ORANGE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb100-5" title="5">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb100-6" title="6">  <span class="dt">farmers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb100-7" title="7">    <span class="dv">1</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb100-8" title="8">      <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb100-9" title="9">      <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;John Smith&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb100-10" title="10">      <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb100-11" title="11">    <span class="op">},</span></a>
<a class="sourceLine" id="cb100-12" title="12">    <span class="dv">2</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb100-13" title="13">      <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb100-14" title="14">      <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Sally Jones&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb100-15" title="15">      <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb100-16" title="16">    <span class="op">},</span></a>
<a class="sourceLine" id="cb100-17" title="17">  <span class="op">}</span></a>
<a class="sourceLine" id="cb100-18" title="18"><span class="op">};</span></a>
<a class="sourceLine" id="cb100-19" title="19"></a>
<a class="sourceLine" id="cb100-20" title="20"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(rootReducer<span class="op">,</span> preloadedState)<span class="op">;</span></a></code></pre></div>
<p>A couple of things to note about preloading state:</p>
<ul>
<li>The <code>preloadedState</code> must match the state shape (as produced by the reducers).</li>
<li><code>preloadedState</code> is not the same as default state. Default state should always be set in your reducers themselves.</li>
</ul>
<h2 id="creating-local-storage-helper-functions">Creating local storage helper functions</h2>
<p>To assist with using the browser’s local storage to persist a Redux store’s state across page reloads, start with creating a set of helper functions:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb101-1" title="1"><span class="co">// localStorage.js</span></a>
<a class="sourceLine" id="cb101-2" title="2"></a>
<a class="sourceLine" id="cb101-3" title="3"><span class="kw">const</span> STATE_KEY <span class="op">=</span> <span class="st">&#39;fruitstand&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb101-4" title="4"></a>
<a class="sourceLine" id="cb101-5" title="5"><span class="im">export</span> <span class="kw">const</span> loadState <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb101-6" title="6">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb101-7" title="7">    <span class="kw">const</span> stateJSON <span class="op">=</span> <span class="va">localStorage</span>.<span class="at">getItem</span>(STATE_KEY)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-8" title="8">    <span class="cf">if</span> (stateJSON <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb101-9" title="9">      <span class="cf">return</span> <span class="kw">undefined</span><span class="op">;</span></a>
<a class="sourceLine" id="cb101-10" title="10">    <span class="op">}</span></a>
<a class="sourceLine" id="cb101-11" title="11">    <span class="cf">return</span> <span class="va">JSON</span>.<span class="at">parse</span>(stateJSON)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-12" title="12">  <span class="op">}</span> <span class="cf">catch</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb101-13" title="13">    <span class="va">console</span>.<span class="at">warn</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-14" title="14">    <span class="cf">return</span> <span class="kw">undefined</span><span class="op">;</span></a>
<a class="sourceLine" id="cb101-15" title="15">  <span class="op">}</span></a>
<a class="sourceLine" id="cb101-16" title="16"><span class="op">};</span></a>
<a class="sourceLine" id="cb101-17" title="17"></a>
<a class="sourceLine" id="cb101-18" title="18"><span class="im">export</span> <span class="kw">const</span> saveState <span class="op">=</span> (state) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb101-19" title="19">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb101-20" title="20">    <span class="kw">const</span> stateJSON <span class="op">=</span> <span class="va">JSON</span>.<span class="at">stringify</span>(state)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-21" title="21">    <span class="va">localStorage</span>.<span class="at">setItem</span>(STATE_KEY<span class="op">,</span> stateJSON)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-22" title="22">  <span class="op">}</span> <span class="cf">catch</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb101-23" title="23">    <span class="va">console</span>.<span class="at">warn</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-24" title="24">  <span class="op">}</span></a>
<a class="sourceLine" id="cb101-25" title="25"><span class="op">};</span></a></code></pre></div>
<p>The <code>saveState</code> function is responsible for converting the <code>state</code> parameter value into JSON (using the <code>JSON.stringify</code> method) and saving the state JSON string to the browser’s local storage (using the <code>localStorage.setItem</code> method). A <code>try...catch</code> statement is used to catch and log any errors.</p>
<p>The <code>loadState</code> function is responsible for loading the state JSON from the browser’s local storage (using the <code>localStorage.getItem</code> method). If the state JSON isn’t stored in local storage, <code>undefined</code> is returned so the store’s reducer function can initialize the state to its default value. If the state JSON is successfully retrieved from local storage, it’s parsed into JavaScript objects (using the <code>JSON.parse</code> method) and returned to the caller. A <code>try...catch</code> statement is used to catch and log any errors.</p>
<h2 id="saving-state-to-local-storage">Saving state to local storage</h2>
<p>To ensure that the persisted state in local storage doesn’t get out of sync with the store, you want to persist the state whenever it’s updated. Knowing that the store’s reducer is called whenever there’s an action dispatched to update the state, you might be tempted to update your reducer like this:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb102-1" title="1"><span class="im">import</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb102-2" title="2">  ADD_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb102-3" title="3">  ADD_FRUITS<span class="op">,</span></a>
<a class="sourceLine" id="cb102-4" title="4">  SELL_FRUIT<span class="op">,</span></a>
<a class="sourceLine" id="cb102-5" title="5">  SELL_OUT<span class="op">,</span></a>
<a class="sourceLine" id="cb102-6" title="6"><span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb102-7" title="7"><span class="im">import</span> <span class="op">{</span> saveState <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../localStorage&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb102-8" title="8"></a>
<a class="sourceLine" id="cb102-9" title="9"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb102-10" title="10">  <span class="va">Object</span>.<span class="at">freeze</span>(state)<span class="op">;</span></a>
<a class="sourceLine" id="cb102-11" title="11">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb102-12" title="12">    <span class="cf">case</span> <span class="dt">ADD_FRUIT</span><span class="op">:</span></a>
<a class="sourceLine" id="cb102-13" title="13">      <span class="kw">const</span> nextState <span class="op">=</span> [...<span class="at">state</span><span class="op">,</span> <span class="va">action</span>.<span class="at">fruit</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb102-14" title="14">      <span class="at">saveState</span>(nextState)<span class="op">;</span>  <span class="co">// Persist state data to local storage</span></a>
<a class="sourceLine" id="cb102-15" title="15">      <span class="cf">return</span> nextState<span class="op">;</span></a>
<a class="sourceLine" id="cb102-16" title="16"></a>
<a class="sourceLine" id="cb102-17" title="17">    <span class="co">// Case clauses removed for brevity.</span></a>
<a class="sourceLine" id="cb102-18" title="18"></a>
<a class="sourceLine" id="cb102-19" title="19">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb102-20" title="20">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb102-21" title="21">  <span class="op">}</span></a>
<a class="sourceLine" id="cb102-22" title="22"><span class="op">};</span></a>
<a class="sourceLine" id="cb102-23" title="23"></a>
<a class="sourceLine" id="cb102-24" title="24"><span class="im">export</span> <span class="im">default</span> fruitReducer<span class="op">;</span></a></code></pre></div>
<p><strong>But don’t do this!</strong> Per the <a href="https://redux.js.org/basics/reducers#handling-actions">official Redux docs on reducers</a>, reducers should stay <em>pure</em> and not cause <em>side effects</em> (like calling APIs or persisting data to local storage).</p>
<p>To keep your reducers pure, handle persisting state to local storage in the module where you create your store (<code>store.js</code>) by subscribing to listen for state changes:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb103-1" title="1"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb103-2" title="2"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb103-3" title="3"><span class="im">import</span> <span class="op">{</span> saveState <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./localStorage&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb103-4" title="4"></a>
<a class="sourceLine" id="cb103-5" title="5"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(rootReducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb103-6" title="6"></a>
<a class="sourceLine" id="cb103-7" title="7"><span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb103-8" title="8">  <span class="at">saveState</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb103-9" title="9"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb103-10" title="10"></a>
<a class="sourceLine" id="cb103-11" title="11"><span class="im">export</span> <span class="im">default</span> store<span class="op">;</span></a></code></pre></div>
<p>Now whenever the store’s state is updated, the <code>store.getState</code> method is called to get and pass the current state to the <code>saveState</code> method.</p>
<h2 id="loading-state-from-local-storage">Loading state from local storage</h2>
<p>Now that you’re persisting state to local storage, you can load state from local storage and pass it to the <code>createStore</code> method as preloaded state:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb104-1" title="1"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb104-2" title="2"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb104-3" title="3"><span class="im">import</span> <span class="op">{</span> loadState<span class="op">,</span> saveState <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./localStorage&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb104-4" title="4"></a>
<a class="sourceLine" id="cb104-5" title="5"><span class="kw">const</span> preloadedState <span class="op">=</span> <span class="at">loadState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb104-6" title="6"></a>
<a class="sourceLine" id="cb104-7" title="7"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(rootReducer<span class="op">,</span> preloadedState)<span class="op">;</span></a>
<a class="sourceLine" id="cb104-8" title="8"></a>
<a class="sourceLine" id="cb104-9" title="9"><span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb104-10" title="10">  <span class="at">saveState</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb104-11" title="11"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb104-12" title="12"></a>
<a class="sourceLine" id="cb104-13" title="13"><span class="im">export</span> <span class="im">default</span> store<span class="op">;</span></a></code></pre></div>
<p>With these updates in place, your Redux store’s state will persist across page reloads.</p>
<h2 id="what-you-learned-10">What you learned</h2>
<p>In this article, you learned how to create a Redux store with preloaded state. You also learned how to use the browser’s local storage to persist a Redux store’s state across page reloads.</p>
<hr />
<h1 id="react-and-redux-to-do-list-project">React and Redux To-Do List Project</h1>
<p>Today you’ll be building a to-do list application with React and local storage. Instead of using Context to manage and update your application’s state, you’ll set up a Redux store and interact with it using the store’s <code>getState</code>, <code>dispatch</code>, and <code>subscribe</code> methods.</p>
<p>This project will also give you a better understanding of how to share and update "global" data across a React application by using Redux. You’ll use Redux to dispatch action POJOs through a reducer function, and have your component access an updated version of the Redux store’s state.</p>
<p>In this project, you will:</p>
<ul>
<li>Generate a Redux store to manage your application’s global information</li>
<li>Define functions to save and load the Redux store’s state with local storage</li>
<li>Generate a Redux <strong>store</strong> with a preloaded state from local storage by using the <code>createStore</code> method from the Redux library</li>
<li>Set up a <strong>reducer</strong> to direct different action types to interact with the Redux store in different ways</li>
<li>Set up <strong>actions</strong> to create a task and delete a task</li>
<li>Use a <code>debugger</code> to investigate the state from within a component</li>
</ul>
<h2 id="phase-1-set-up-project-and-redux-store">Phase 1: Set up project and Redux store</h2>
<p>Begin by cloning the starter project from https://github.com/-starters/react-redux-todo-list-starter.</p>
<p>Take a moment to examine the project’s file tree below. In the next few phases, you’ll follow the <code>TODO</code> notes in each file to implement Redux into your React project.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb105-1" title="1">├── <span class="ex">package-lock.json</span></a>
<a class="sourceLine" id="cb105-2" title="2">├── <span class="ex">package.json</span></a>
<a class="sourceLine" id="cb105-3" title="3">├── <span class="ex">public</span></a>
<a class="sourceLine" id="cb105-4" title="4">│   └── <span class="ex">index.html</span></a>
<a class="sourceLine" id="cb105-5" title="5">└── <span class="ex">src</span></a>
<a class="sourceLine" id="cb105-6" title="6">    ├── <span class="ex">App.js</span></a>
<a class="sourceLine" id="cb105-7" title="7">    ├── <span class="ex">actions</span></a>
<a class="sourceLine" id="cb105-8" title="8">    │   └── <span class="ex">taskActions.js</span></a>
<a class="sourceLine" id="cb105-9" title="9">    ├── <span class="ex">components</span></a>
<a class="sourceLine" id="cb105-10" title="10">    │   ├── <span class="ex">Task.js</span></a>
<a class="sourceLine" id="cb105-11" title="11">    │   ├── <span class="ex">TodoForm.js</span></a>
<a class="sourceLine" id="cb105-12" title="12">    │   └── <span class="ex">TodoList.js</span></a>
<a class="sourceLine" id="cb105-13" title="13">    ├── <span class="ex">index.js</span></a>
<a class="sourceLine" id="cb105-14" title="14">    ├── <span class="ex">localStorage.js</span></a>
<a class="sourceLine" id="cb105-15" title="15">    ├── <span class="ex">reducers</span></a>
<a class="sourceLine" id="cb105-16" title="16">    │   └── <span class="ex">tasksReducer.js</span></a>
<a class="sourceLine" id="cb105-17" title="17">    └── <span class="ex">store.js</span></a></code></pre></div>
<h3 id="local-storage">Local storage</h3>
<p>Let’s start by setting up some functions in the <code>localStorage.js</code> file to save and load the Redux store’s state with local storage!</p>
<p>In the <code>loadState</code> function, you’ll want to access the stored tasks state from local storage by using the <code>localStorage.getItem</code> method. If there is no state found, return <code>undefined</code>. However, if the state was found, parse the state from JSON into JavaScript and return the parsed state. If any errors were caught, log the errors with a <code>console.warn</code> statement and have the function return <code>undefined</code>.</p>
<p>In the <code>saveState</code> function, you’ll want to parse the <code>state</code> input from JavaScript into a JSON string. When you call the <code>saveState</code> function, you’ll invoke the function with the Redux store’s state accessed with the <code>store.getState</code> method. After parsing the state from JavaScript into a JSON string, set the string into local storage. Lastly, you’ll want to catch any errors with a <code>console.warn</code> statement.</p>
<h3 id="generate-applications-redux-store">Generate application’s Redux store</h3>
<p>Now that you’ve set up some functions to handle accessing and storing the data with local storage, you’ll want to use those functions in the <code>store.js</code> file. In this file, you’ll use Redux’s <code>createStore</code> function to set up your application’s Redux <code>store</code>. As a reminder, the <code>createStore</code> function takes in a reducer as its first argument, and an optional preloaded state, also referred to as <em>initial</em> state, as its second argument.</p>
<p>Use the <code>loadState</code> function you just defined to access the <code>preloadedState</code>. Now you’ll invoke the <code>createStore</code> function with the <code>tasksReducer</code> and the <code>preloadedState</code> to generate the application’s Redux store.</p>
<p>You’ll want your application to update local storage and log the state whenever there an update to the store - this means you’ll want your application to listen for changes to the store with the <code>store.subscribe</code> method and then update local storage with the <code>saveState</code> function and <code>console.log</code> the state upon any change.</p>
<h2 id="phase-2-actions-and-reducers">Phase 2: Actions and reducers</h2>
<p>Now that you have your application’s Redux store set up, it’s time to define some action creator functions and reducers! You’ll define action creator functions in the <code>taskActions.js</code> file and set up corresponding case statements for each action type in the <code>tasksReducer.js</code> file.</p>
<h3 id="define-action-creator-functions">Define action creator functions</h3>
<p>As a reminder, it is best practice to use constants for action types, instead of string literals, to ensure that errors will be thrown for typos. Start by defining constants for your action types: <code>CREATE_TASK</code> and <code>DELETE_TASK</code>.</p>
<p>Once you have the constants set up, it’s time to define an action creator function for each action type! Start by thinking of what payload information you want your action POJOs to pass into the reducer function.</p>
<p>Define a <code>createTask</code> action creator function that returns actions of type <code>CREATE_TASK</code>. You’ll want <code>type</code>, <code>taskId</code>, and <code>taskMessage</code> payload keys for each <code>CREATE_TASK</code> action POJO. Have the action creator function take in a <code>taskMessage</code> and auto-generate the <code>taskId</code>. You can set the <code>taskId</code> to a time-string that is set when the action creator function is invoked. Generate a new <code>Date</code> object and get its time-string with <code>new Date().getTime()</code>. Set the time-string to the <code>taskId</code> payload key and the <code>taskMessage</code> input to the <code>taskMessage</code> payload key.</p>
<p>Now you’ll want to define the <code>deleteTask</code> action creator function to return actions of type <code>DELETE_TASK</code>. You’ll want the action creator function to take in a <code>taskId</code>. Each <code>DELETE_TASK</code> action POJO should have a <code>type</code> property and a <code>taskId</code> payload key.</p>
<h3 id="define-tasks-reducer-function">Define tasks reducer function</h3>
<p>The next step is to finish implementing the <code>tasksReducer</code>! Begin by freezing the <code>state</code> with <code>Object.freeze(state);</code> so that you won’t accidentally mutate the state. As a reminder, Redux follows the immutable state pattern, meaning that a reducer function should never directly mutate state. After freezing the state, import <code>CREATE_TASK</code> and <code>DELETE_TASK</code> string literal constants and set up a switch statement to evaluate a case statement based on each <code>action.type</code>.</p>
<p>In the <code>CREATE_TASK</code> case, you’ll want to make a copy of the state, structure a <code>newTask</code> POJO, and add the <code>newTask</code> into the copy of the state before returning the copy. Define a <code>nextState</code> variable and use spread syntax (<code>...</code>) to make a copy of the state (<code>{ ...state }</code>). Next, you’ll want to structure the <code>newTask</code> POJO to have an <code>id</code> property set to the action’s <code>taskId</code> payload and a <code>message</code> property set to the action’s <code>taskMessage</code> payload.</p>
<p>Once you have finished structuring the <code>newTask</code> POJO, key into the <code>nextState</code> with the new task ID and set the value of <code>nextState[newTask.id]</code> to the <code>newTask</code>. Alternatively, you could use the <code>taskId</code> payload and set the value of <code>nextState[action.taskId]</code> to the <code>newTask</code> (this will also accomplish what we want, which is to set up a <code>nextState</code> with keys that are task IDs and values that are task POJOs). At the end of the <code>CREATE_TASK</code> case statement, return the updated <code>nextState</code>.</p>
<p>In the <code>DELETE_TASK</code> case, you’ll also want to make a copy of the state (<code>{...state }</code>). Set the copy of the state to a <code>stateWithDeletion</code> variable. Since your <code>DELETE_TASK</code> actions have a <code>taskId</code> payload, you can use JavaScript’s <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/delete">delete</a> operator to delete a specific key-value pair from the <code>stateWithDeletion</code> object, based on the <code>taskId</code> payload:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb106-1" title="1"><span class="kw">delete</span> stateWithDeletion[<span class="va">action</span>.<span class="at">taskId</span>]<span class="op">;</span></a></code></pre></div>
<p>The last thing left in your <code>DELETE_TASK</code> statement is to return the updated <code>stateWithDeletion</code>! If you compare your initial definition of the <code>nextState</code> and <code>stateWithDeletion</code> variables, you’ll see that they are both copies of the <code>state</code> made with spread syntax. Move the <code>nextState</code> variable outside of the <code>switch</code> statement so that both <code>case</code> statements can reference and update the <code>nextState</code>, instead of the <code>DELETE_TASK</code> case statement creating a new copy of the state and updating it.</p>
<h2 id="phase-3-dispatch-actions-from-the-devtools-console">Phase 3: Dispatch actions from the DevTools console</h2>
<p>Now you can test whether you can actually create a task by using the <code>store.dispatch</code> method to dispatch the <code>CREATE_TASK</code> action. As a reminder, dispatching the action will "send" it through the reducer to determine what operation to perform based on the action’s <code>type</code> property. Take a moment to go into your <code>index.js</code> file and import your application’s Redux <code>store</code> and action creator functions:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb107-1" title="1"><span class="im">import</span> <span class="op">{</span> store <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb107-2" title="2"><span class="im">import</span> <span class="op">{</span> createTask<span class="op">,</span> deleteTask <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./actions/taskActions&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Now that you’ve had the store and actions imported into the file, you can set them as properties to the <code>window</code> object, so that you can access the <code>store</code> and actions from the developer tools console.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb108-1" title="1"><span class="va">window</span>.<span class="at">store</span> <span class="op">=</span> store<span class="op">;</span></a>
<a class="sourceLine" id="cb108-2" title="2"><span class="va">window</span>.<span class="at">createTask</span> <span class="op">=</span> createTask<span class="op">;</span></a>
<a class="sourceLine" id="cb108-3" title="3"><span class="va">window</span>.<span class="at">deleteTask</span> <span class="op">=</span> deleteTask<span class="op">;</span></a></code></pre></div>
<p>At this point, your <code>index.js</code> file should look something like this:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb109-1" title="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb109-2" title="2"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb109-3" title="3"><span class="im">import</span> App <span class="im">from</span> <span class="st">&#39;./App&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb109-4" title="4"><span class="im">import</span> <span class="op">{</span> store <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb109-5" title="5"><span class="im">import</span> <span class="op">{</span> createTask<span class="op">,</span> deleteTask <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./actions/taskActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb109-6" title="6"></a>
<a class="sourceLine" id="cb109-7" title="7"><span class="va">window</span>.<span class="at">store</span> <span class="op">=</span> store<span class="op">;</span></a>
<a class="sourceLine" id="cb109-8" title="8"><span class="va">window</span>.<span class="at">createTask</span> <span class="op">=</span> createTask<span class="op">;</span></a>
<a class="sourceLine" id="cb109-9" title="9"><span class="va">window</span>.<span class="at">deleteTask</span> <span class="op">=</span> deleteTask<span class="op">;</span></a>
<a class="sourceLine" id="cb109-10" title="10"></a>
<a class="sourceLine" id="cb109-11" title="11"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb109-12" title="12">  <span class="op">&lt;</span><span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb109-13" title="13">    <span class="op">&lt;</span>App /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb109-14" title="14">  &lt;/<span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb109-15" title="15">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;root&#39;</span>)</a>
<a class="sourceLine" id="cb109-16" title="16">)<span class="op">;</span></a></code></pre></div>
<p>Open up your browser’s DevTools console and type <code>window.store</code>. Now you should see the <code>store</code> object and its methods: <code>{dispatch: ƒ, subscribe: ƒ, getState: ƒ, replaceReducer: ƒ, Symbol(observable): ƒ}</code>,</p>
<p>Now type <code>window.store.getState()</code>. You should see an empty object - this is the default state (<code>state = {}</code>) that you set up in the <code>tasksReducer</code>.</p>
<p>Since you can access your application’s state from the DevTools console, that means you can also dispatch actions by invoking the <code>window.store.dispatch</code> method with an action:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb110-1" title="1"><span class="va">window</span>.<span class="va">store</span>.<span class="at">dispatch</span>(<span class="va">window</span>.<span class="at">createTask</span>(<span class="st">&#39;learn redux&#39;</span>))<span class="op">;</span></a></code></pre></div>
<p>You just dispatched a <code>CREATE_TASK</code> action! You’ll see that your updated state was logged - this is because of the <code>console.log</code> statement in the <code>store.subscribe</code> invocation in your <code>index.js</code> file (as you might remember, the <code>store.subscribe</code> method listens for any updates to the store, i.e. dispatch calls). Dispatch another <code>CREATE_TASK</code> action:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb111-1" title="1"><span class="va">window</span>.<span class="va">store</span>.<span class="at">dispatch</span>(<span class="va">window</span>.<span class="at">createTask</span>(<span class="st">&#39;learn react hooks&#39;</span>))<span class="op">;</span></a></code></pre></div>
<p>Now if you type <code>window.store.getState()</code> again, you’ll see that the state return from the <code>store.getState</code> method is the same plain old JavaScript object as the state that was logged within the <code>store.subscribe</code> invocation.</p>
<p>Now let’s place some <code>debugger</code> statements in the <code>tasksReducer</code> and <code>createTask</code> action creator function! Remember to make sure the <code>debugger</code> statement in your <code>tasksReducer</code> is <strong>inside</strong> a case statement. If the <code>debugger</code> is between the switch statement and a case statement, you will never hit that breakpoint!</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb112-1" title="1"><span class="kw">const</span> tasksReducer <span class="op">=</span> (state <span class="op">=</span> <span class="op">{},</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb112-2" title="2">  <span class="va">Object</span>.<span class="at">freeze</span>(state)<span class="op">;</span></a>
<a class="sourceLine" id="cb112-3" title="3">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb112-4" title="4">    <span class="cf">case</span> <span class="dt">CREATE_TASK</span><span class="op">:</span></a>
<a class="sourceLine" id="cb112-5" title="5">      <span class="cf">debugger</span><span class="op">;</span></a>
<a class="sourceLine" id="cb112-6" title="6">    <span class="co">// CODE SHORTENED FOR BREVITY</span></a></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb113-1" title="1"><span class="im">export</span> <span class="kw">const</span> createTask <span class="op">=</span> (taskMessage) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb113-2" title="2">  <span class="cf">debugger</span><span class="op">;</span></a>
<a class="sourceLine" id="cb113-3" title="3">  <span class="cf">return</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb113-4" title="4">    <span class="dt">type</span><span class="op">:</span> CREATE_TASK<span class="op">,</span></a>
<a class="sourceLine" id="cb113-5" title="5">    <span class="dt">taskId</span><span class="op">:</span> <span class="kw">new</span> <span class="at">Date</span>().<span class="at">getTime</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb113-6" title="6">    taskMessage<span class="op">,</span></a>
<a class="sourceLine" id="cb113-7" title="7">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb113-8" title="8"><span class="op">};</span></a></code></pre></div>
<p>Now dispatch another <code>CREATE_TASK</code> action to hit the two <code>debugger</code> statements you just set:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb114-1" title="1"><span class="va">window</span>.<span class="va">store</span>.<span class="at">dispatch</span>(<span class="va">window</span>.<span class="at">createTask</span>(<span class="st">&#39;work on self-care&#39;</span>))<span class="op">;</span></a></code></pre></div>
<p>Notice how you are now in the <code>Sources</code> tab of your DevTools looking at the <code>taskActions.js</code> file in your project. You can view the value of the <code>taskMessage</code> argument by hovering over the variable or looking at the local scope variables in the DevTools’ right window.</p>
<figure>
<img src="https://-open-assets.s3-us-west-1.amazonaws.com/Modular-Curriculum/content/react-redux/topics/redux/assets/react-redux-to-do-list-devtools-1.png" alt="devtools-taskActions" /><figcaption>devtools-taskActions</figcaption>
</figure>
<p>If you click the blue play button to continue to the next <code>debugger</code> statement, you’ll land in your <code>tasksReducer.js</code> file and be able to hover over the <code>state</code> to view the value of the Redux store’s previous state <strong>before</strong> the dispatching of the <code>CREATE_TASK</code> action.</p>
<figure>
<img src="https://-open-assets.s3-us-west-1.amazonaws.com/Modular-Curriculum/content/react-redux/topics/redux/assets/react-redux-to-do-list-devtools-2.png" alt="devtools-tasksReducer" /><figcaption>devtools-tasksReducer</figcaption>
</figure>
<p>Now if you click the blue play button to continue, you’ll exit out of debug mode and your updated state will be logged in the console.</p>
<p>Congratulations! You just used a <code>debugger</code> to follow the Redux flow of dispatching a <code>CREATE_TASK</code> action! Comment out your <code>debugger</code> statements for now. In the next phase, you’ll work on dispatching actions through a user interface.</p>
<h2 id="phase-4-dispatch-actions-from-components">Phase 4: Dispatch actions from components</h2>
<p>Now it’s time to set up a user interface that allows for intuitive dispatching of actions. In the <code>TodoForm</code> component, you’ll set up a button that invokes the <code>createTask</code> action creator function with the <code>inputValue</code> state to dispatch a <code>CREATE_TASK</code> action based on the form input! For each <code>Task</code> component, you’ll set up a button to dispatch a <code>DELETE_TASK</code> action for that task.</p>
<h3 id="todoform">TodoForm</h3>
<p>In the <code>TodoForm.js</code> file, import your application’s Redux <code>store</code> instance and the <code>createTask</code> action creator function. Now you’ll want to finish the <code>handleSubmit</code> method so that it dispatches a <code>CREATE_TASK</code> action. Invoke the <code>createTask</code> action creator function with the <code>inputValue</code> state and the <code>store.dispatch</code> method with the invoked action creator function.</p>
<p>Take a moment to test out the dispatch call generated by your form submission. Type a task in the input field - when you submit, you should see an updated state logged in the DevTools console with your new task!</p>
<h3 id="todolist">TodoList</h3>
<p>In the <code>TodoList.js</code> file, import the application’s Redux <code>store</code> instance and the <code>deleteTask</code> action creator function. Now you’ll set up the component’s <code>componentDidMount</code> and <code>componentDidUnmount</code> life-cycle methods.</p>
<p>In the <code>componentDidMount</code> method, use the store’s <code>subscribe</code> method to force a component to update whenever the state changes:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb115-1" title="1"><span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb115-2" title="2">  <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb115-3" title="3">    <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb115-4" title="4">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb115-5" title="5"><span class="op">}</span></a></code></pre></div>
<p>You want to name the subscription as <code>this.unsubscribe</code>, so that you can unsubscribe upon the unmounting of a component. When the <code>componentDidMount</code> life-cycle method is invoked upon the mounting of a component, it will invoke the <code>store.subscribe</code> method to force the component to update whenever the store’s state changes. It will also set a <code>this.unsubscribe</code> variable to the <code>TodoList</code> class, so that <code>this.unsubscribe</code> is accessible from other parts of the component’s code.</p>
<p>In the <code>componentDidUnmount</code> method, you’ll want to check if the component has mounted by checking if <code>this.unsubscribe</code> has been defined. Whenever a component mounts, the <code>this.unsubscribe</code> variable set in the <code>componentDidMount</code> method will become initialize. If <code>this.unsubscribe</code> is undefined, that means that the component has not invoked the <code>componentDidMount</code> method and has therefore not been mounted yet. If <code>this.unsubscribe</code> is defined, you’ll want to invoke <code>this.unsubscribe</code> to have the component unsubscribe from changes once component unmounts:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb116-1" title="1"><span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb116-2" title="2">  <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb116-3" title="3">    <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb116-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb116-5" title="5"><span class="op">}</span></a></code></pre></div>
<p>In the <code>deleteTask</code> method, you’ll want to wrap the invocation of the <code>deleteTask</code> action creator function with the <code>store.dispatch</code> method. The <code>deleteTask</code> action creator function will be invoked based on the <code>this.deleteTask</code> method’s <code>id</code> input. Later in this phase, you’ll pass the <code>TodoList</code> component’s <code>this.deleteTask</code> method as a <code>deleteTask</code> prop into each <code>Task</code> component. Then, whenever the <code>deleteTask</code> prop is invoked from within a <code>Task</code> component, it can simply be invoked with a task ID to dispatch a <code>DELETE_TASK</code> action without needing to import the <code>store</code> into each <code>Task</code> component to invoke <code>store.dispatch</code></p>
<p>In the component’s <code>render</code> method, access the tasks stored in the Redux store’s state by invoking the <code>store.getState</code> method and saving its return value to a <code>tasksState</code> variable. Now that you can use a <code>debugger</code> statement to view the state and check out what data you are working with!</p>
<p>If there are no tasks stored in state, you’ll want to have the <code>TodoList</code> component return <code>null</code>. Otherwise if there are tasks stored in state, render a <code>Task</code> component for each of the tasks. For each <code>Task</code> component, you’ll want to use the task’s ID as the <code>key</code> and pass two props: the <code>task</code> object and the <code>this.deleteTask</code> method as a <code>deleteTask</code> prop.</p>
<h3 id="task">Task</h3>
<p>Have the <code>Task</code> function component destructure and take in the <code>deleteTask</code> method and <code>task</code> object props. Invoke the <code>deleteTask</code> function passed as a prop in the <code>Task</code> component’s <code>handleClick</code> method and replace the <code>Hi, I'm a task in your to-do list!</code> placeholder text with the <code>task.message</code>.</p>
<p>As a reminder, the <code>deleteTask</code> action creator function was already wrapped with a <code>store.dispatch</code> call in the <code>TodoList</code> component - this is why the <code>handleClick</code> function in the <code>Task</code> component does not include a <code>store.dispatch</code> invocation. The <code>TodoList</code> component passed the wrapped function as a prop named <code>deleteTask</code> to each <code>Task</code> component. The <code>deleteTask</code> function invoked in the <code>Task</code> component’s <code>handleClick</code> function is the <code>TodoList</code> component’s <code>deleteTask</code> <strong>method</strong>, not the <code>deleteTask</code> <strong>action creator function</strong>.</p>
<h2 id="phase-5-implement-a-full-redux-cycle">Phase 5: Implement a full Redux cycle</h2>
<p>In this phase, you’ll implement a full Redux cycle without the guidance of <code>TODO</code> notes or specific, written instructions. Remember, the <code>debugger</code> statement is your friend! If you get stuck, think of where you can place <code>debugger</code> statements to gain more context about your code. As a general guideline, feel free to follow the steps below:</p>
<ul>
<li>Set up an action creator function for a <code>RESET_TASK_LIST</code> action</li>
<li>Set up a reducer case statement for the <code>RESET_TASK_LIST</code> action type</li>
<li>Create a user interface (button) to dispatch the <code>RESET_TASK_LIST</code> action</li>
</ul>
<p>Congratulations! You have just created an application that uses Redux to manage the application’s information. Give yourself a pat on the back! As a reminder, the Redux library is a highly conceptual library to pick up, and when learning anything new practice always makes perfect! If the implementation of Redux feels confusing, always feel free to step back and use a <code>debugger</code> statement to follow the Redux flow: an action is generated, then the action is dispatched to go through a reducer, and then the store is updated.</p>
<hr />
<h1 id="week-15-day-3-react-redux" data-ignore="true">WEEK-15 DAY-3<br><em>React + Redux</em></h1>
<hr />
<h1 id="redux-learning-objectives-part-3">Redux Learning Objectives: Part 3</h1>
<p>Just like Luke Skywalker returning to Dagobah to complete his Jedi training with Yoda, it’s time for you to return to learning Redux one more time. In this final section on Redux, you’ll learn how to use the React-Redux library to connect components to a Redux store and how to use middleware and thunks to interact with an API.</p>
<p>After completing this final section on Redux, you should be able to:</p>
<ul>
<li>Describe what a higher-order component (HOC) is</li>
<li>Write a higher-order component (HOC) that accepts a component as an argument and returns a new component</li>
<li>Use the React-Redux library’s <code>&lt;Provider /&gt;</code> component to make your Redux store available to any nested components that have been wrapped in the <code>connect</code> function</li>
<li>Use the React-Redux library’s <code>connect</code> function to give a component access to a Redux store</li>
<li>Write a selector to extract and format information from state stored in a Redux store</li>
<li>Use the React-Redux library’s <code>applyMiddleware</code> function to configure one or more middleware when creating a store</li>
<li>Write a thunk action creator to make an asynchronous request to an API and dispatch an action when the response is received</li>
<li>Describe a situation where defining multiple containers for a single component is advantageous</li>
<li>Configure a React application to use the Redux development tools</li>
</ul>
<hr />
<h1 id="higher-order-components">Higher-Order Components</h1>
<p>In React, <a href="https://reactjs.org/docs/higher-order-components.html">higher-order components (HOCs)</a> are a pattern for reusing component logic. Ultimately, higher order components allow you to dynamically generate wrapper components.</p>
<p>Before React existed, developers leveraged JavaScript’s support for functions as first-class objects, meaning that functions can be treated just like any other data type (i.e. stored in a variable, object, or array, passed as an argument to a function, or returned from a function). Understanding what higher-order functions are and how they work will help you to understand and use higher-order components in React.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Describe what a higher-order component (HOC) is</li>
<li>Write a higher-order component (HOC) that accepts a component as an argument and returns a new component</li>
</ul>
<h2 id="reviewing-higher-order-functions">Reviewing higher-order functions</h2>
<p>Functions that operate on other functions, either by receiving them as arguments or returning them, are called <strong>higher-order functions</strong>. Said differently, higher-order functions are functions that:</p>
<ul>
<li>Define and return functions;</li>
<li>Accept callbacks as arguments;</li>
<li>Or do both.</li>
</ul>
<h3 id="using-closures-with-higher-order-functions">Using closures with higher-order functions</h3>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures"><strong>closure</strong></a>, also known as <em>lexical scoping</em>, is a function that uses <strong>free variables</strong>, variables defined outside of its scope. Closures come in handy when writing higher-order functions. Consider the following code:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb117-1" title="1"><span class="kw">const</span> calculator <span class="op">=</span> <span class="kw">function</span> (operationCb) <span class="op">{</span> <span class="co">// high-order function</span></a>
<a class="sourceLine" id="cb117-2" title="2">  <span class="cf">return</span> <span class="kw">function</span> (op1<span class="op">,</span> op2) <span class="op">{</span> <span class="co">// closure</span></a>
<a class="sourceLine" id="cb117-3" title="3">    <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`calling with </span><span class="sc">${</span>op1<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>op2<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb117-4" title="4">    <span class="kw">const</span> result <span class="op">=</span> <span class="at">operationCb</span>(op1<span class="op">,</span> op2)<span class="op">;</span></a>
<a class="sourceLine" id="cb117-5" title="5">    <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`equals </span><span class="sc">${</span>result<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb117-6" title="6">  <span class="op">};</span></a>
<a class="sourceLine" id="cb117-7" title="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb117-8" title="8"></a>
<a class="sourceLine" id="cb117-9" title="9"><span class="kw">const</span> addition <span class="op">=</span> <span class="kw">function</span> (n1<span class="op">,</span> n2) <span class="op">{</span> <span class="co">// callback</span></a>
<a class="sourceLine" id="cb117-10" title="10">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`</span><span class="sc">${</span>n1<span class="sc">}</span><span class="vs"> + </span><span class="sc">${</span>n2<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb117-11" title="11">  <span class="cf">return</span> n1 <span class="op">+</span> n2<span class="op">;</span></a>
<a class="sourceLine" id="cb117-12" title="12"><span class="op">}</span></a>
<a class="sourceLine" id="cb117-13" title="13"></a>
<a class="sourceLine" id="cb117-14" title="14"><span class="kw">const</span> adder <span class="op">=</span> <span class="at">calculator</span>(addition)<span class="op">;</span></a>
<a class="sourceLine" id="cb117-15" title="15"><span class="at">adder</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb117-16" title="16"><span class="co">// calling with 1 2</span></a>
<a class="sourceLine" id="cb117-17" title="17"><span class="co">// 1 + 2</span></a>
<a class="sourceLine" id="cb117-18" title="18"><span class="co">// equals 3</span></a></code></pre></div>
<p>The <code>calculator</code> function receives a callback as an argument (<code>operationCb</code>) which is called in the anonymous function <code>calculator</code> returns. This return value would not work if the inner function could not close over <code>operationCb</code>, a variable defined outside of its scope.</p>
<h3 id="defining-higher-order-functions-with-arrow-functions">Defining higher-order functions with arrow functions</h3>
<p>Arrow functions make it easy to write higher-order functions. The two examples below illustrate the same function:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb118-1" title="1"><span class="co">// Without arrow functions (ES5):</span></a>
<a class="sourceLine" id="cb118-2" title="2"><span class="kw">function</span> <span class="at">foo</span>(arg1) <span class="op">{</span></a>
<a class="sourceLine" id="cb118-3" title="3">  <span class="cf">return</span> <span class="kw">function</span>(arg2) <span class="op">{</span></a>
<a class="sourceLine" id="cb118-4" title="4">    <span class="cf">return</span> <span class="kw">function</span>(arg3) <span class="op">{</span></a>
<a class="sourceLine" id="cb118-5" title="5">      <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`</span><span class="sc">${</span>arg1<span class="sc">}</span><span class="vs"> came before </span><span class="sc">${</span>arg2<span class="sc">}</span><span class="vs"> and </span><span class="sc">${</span>arg3<span class="sc">}</span><span class="vs"> came last`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb118-6" title="6">    <span class="op">};</span></a>
<a class="sourceLine" id="cb118-7" title="7">  <span class="op">};</span></a>
<a class="sourceLine" id="cb118-8" title="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb118-9" title="9"></a>
<a class="sourceLine" id="cb118-10" title="10"><span class="co">// With arrow functions (ES6):</span></a>
<a class="sourceLine" id="cb118-11" title="11"><span class="kw">const</span> foo <span class="op">=</span> arg1 <span class="kw">=&gt;</span> arg2 <span class="kw">=&gt;</span> arg3 <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb118-12" title="12">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`</span><span class="sc">${</span>arg1<span class="sc">}</span><span class="vs"> came before </span><span class="sc">${</span>arg2<span class="sc">}</span><span class="vs"> and </span><span class="sc">${</span>arg3<span class="sc">}</span><span class="vs"> came last`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb118-13" title="13"><span class="op">};</span></a></code></pre></div>
<p>Here’s the earlier <code>calculator</code> function rewritten using arrow functions:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb119-1" title="1"><span class="kw">const</span> calculator <span class="op">=</span> (operationCb) <span class="kw">=&gt;</span> (op1<span class="op">,</span> op2) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb119-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`calling with </span><span class="sc">${</span>op1<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>op2<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb119-3" title="3">  <span class="kw">const</span> result <span class="op">=</span> <span class="at">operationCb</span>(op1<span class="op">,</span> op2)<span class="op">;</span></a>
<a class="sourceLine" id="cb119-4" title="4">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`equals </span><span class="sc">${</span>result<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb119-5" title="5"><span class="op">};</span></a></code></pre></div>
<blockquote>
<p><strong>Note:</strong> Remember, ES6 arrow functions, unlike normal JavaScript functions, are automatically bound to the context (<code>this</code>) that existed when they were defined. In other words, <code>this</code> means the same thing inside an arrow function that it does outside of it.</p>
</blockquote>
<h2 id="leveraging-higher-order-components-hocs">Leveraging higher-order components (HOCs)</h2>
<p>In the same way that higher-order functions can receive a function as an argument and return a new function, <a href="https://reactjs.org/docs/higher-order-components.html"><strong>higher-order components</strong> or <strong>HOC</strong>s</a> receive a React component as an argument and return a new component.</p>
<h3 id="protectedroute-and-authroute"><code>ProtectedRoute</code> and <code>AuthRoute</code></h3>
<p>In the <strong>React Twitter Lite</strong> project, you created two HOCs to control what pages users could see based upon their authentication status. The <code>ProtectedRoute</code> HOC ensured that only logged users could view the Profile and Home pages while the <code>AuthRoute</code> HOC prevented logged in users from viewing the <code>Login</code> or <code>Registration</code> pages:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb120-1" title="1"><span class="im">export</span> <span class="kw">const</span> ProtectedRoute <span class="op">=</span> (<span class="op">{</span> <span class="dt">component</span><span class="op">:</span> Component<span class="op">,</span> path<span class="op">,</span> currentUserId<span class="op">,</span> exact <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb120-2" title="2">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb120-3" title="3">    <span class="op">&lt;</span>Route</a>
<a class="sourceLine" id="cb120-4" title="4">      path<span class="op">={</span>path<span class="op">}</span></a>
<a class="sourceLine" id="cb120-5" title="5">      exact<span class="op">={</span>exact<span class="op">}</span></a>
<a class="sourceLine" id="cb120-6" title="6">      render<span class="op">={</span>(props) <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb120-7" title="7">        currentUserId <span class="op">?</span> <span class="op">&lt;</span>Component <span class="op">{</span>...<span class="at">props</span><span class="op">}</span> /&gt; : <span class="op">&lt;</span>Redirect to<span class="op">=</span><span class="st">&quot;/login&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb120-8" title="8">      <span class="op">}</span></a>
<a class="sourceLine" id="cb120-9" title="9">    /&gt;</a>
<a class="sourceLine" id="cb120-10" title="10">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb120-11" title="11"><span class="op">};</span></a></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb121-1" title="1"><span class="im">export</span> <span class="kw">const</span> AuthRoute <span class="op">=</span> (<span class="op">{</span> <span class="dt">component</span><span class="op">:</span> Component<span class="op">,</span> path<span class="op">,</span> currentUserId<span class="op">,</span> exact <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb121-2" title="2">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb121-3" title="3">    <span class="op">&lt;</span>Route</a>
<a class="sourceLine" id="cb121-4" title="4">      path<span class="op">={</span>path<span class="op">}</span></a>
<a class="sourceLine" id="cb121-5" title="5">      exact<span class="op">={</span>exact<span class="op">}</span></a>
<a class="sourceLine" id="cb121-6" title="6">      render<span class="op">={</span>(props) <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb121-7" title="7">        currentUserId <span class="op">?</span> <span class="op">&lt;</span>Redirect to<span class="op">=</span><span class="st">&quot;/&quot;</span> /&gt; : <span class="op">&lt;</span>Component <span class="op">{</span>...<span class="at">props</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb121-8" title="8">      <span class="op">}</span></a>
<a class="sourceLine" id="cb121-9" title="9">    /&gt;</a>
<a class="sourceLine" id="cb121-10" title="10">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb121-11" title="11"><span class="op">};</span></a></code></pre></div>
<p>Notice how both components accept a component via the <code>component</code> parameter and return a <code>Route</code> component (that renders the passed component via a <code>render</code> prop).</p>
<h2 id="using-hocs-to-keep-code-dry">Using HOCs to keep code DRY</h2>
<p>HOCs give React developers a powerful way to reuse component logic so that they can keep their code DRY.</p>
<p>When learning about Redux container components, you might have noticed that the <code>FruitManagerContainer</code> and <code>FarmerManagerContainer</code> components in the Fruit Stand application contain the same <code>componentDidMount</code> and <code>componentWillUnmount</code> lifecycle method implementations:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb122-1" title="1"><span class="co">// ./src/components/FruitManagerContainer.js</span></a>
<a class="sourceLine" id="cb122-2" title="2"></a>
<a class="sourceLine" id="cb122-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb122-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb122-5" title="5"><span class="im">import</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb122-6" title="6">  addFruit<span class="op">,</span></a>
<a class="sourceLine" id="cb122-7" title="7">  addFruits<span class="op">,</span></a>
<a class="sourceLine" id="cb122-8" title="8">  sellFruit<span class="op">,</span></a>
<a class="sourceLine" id="cb122-9" title="9">  sellOut<span class="op">,</span></a>
<a class="sourceLine" id="cb122-10" title="10"><span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb122-11" title="11"><span class="im">import</span> FruitManager <span class="im">from</span> <span class="st">&#39;./FruitManager&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb122-12" title="12"></a>
<a class="sourceLine" id="cb122-13" title="13"><span class="kw">class</span> FruitManagerContainer <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb122-14" title="14">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb122-15" title="15">    <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb122-16" title="16">      <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb122-17" title="17">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb122-18" title="18">  <span class="op">}</span></a>
<a class="sourceLine" id="cb122-19" title="19"></a>
<a class="sourceLine" id="cb122-20" title="20">  <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb122-21" title="21">    <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb122-22" title="22">      <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb122-23" title="23">    <span class="op">}</span></a>
<a class="sourceLine" id="cb122-24" title="24">  <span class="op">}</span></a>
<a class="sourceLine" id="cb122-25" title="25"></a>
<a class="sourceLine" id="cb122-26" title="26">  add <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb122-27" title="27">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruit</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb122-28" title="28">  <span class="op">}</span></a>
<a class="sourceLine" id="cb122-29" title="29"></a>
<a class="sourceLine" id="cb122-30" title="30">  addBulk <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb122-31" title="31">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addFruits</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb122-32" title="32">  <span class="op">}</span></a>
<a class="sourceLine" id="cb122-33" title="33"></a>
<a class="sourceLine" id="cb122-34" title="34">  sell <span class="op">=</span> (fruit) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb122-35" title="35">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">sellFruit</span>(fruit))<span class="op">;</span></a>
<a class="sourceLine" id="cb122-36" title="36">  <span class="op">}</span></a>
<a class="sourceLine" id="cb122-37" title="37"></a>
<a class="sourceLine" id="cb122-38" title="38">  sellAll <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb122-39" title="39">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">sellOut</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb122-40" title="40">  <span class="op">}</span></a>
<a class="sourceLine" id="cb122-41" title="41"></a>
<a class="sourceLine" id="cb122-42" title="42">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb122-43" title="43">    <span class="kw">const</span> <span class="op">{</span> fruit <span class="op">}</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb122-44" title="44">    <span class="kw">const</span> distinctFruit <span class="op">=</span> <span class="va">Array</span>.<span class="at">from</span>(<span class="kw">new</span> <span class="at">Set</span>(fruit)).<span class="at">sort</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb122-45" title="45"></a>
<a class="sourceLine" id="cb122-46" title="46">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb122-47" title="47">      <span class="op">&lt;</span>FruitManager</a>
<a class="sourceLine" id="cb122-48" title="48">        fruit<span class="op">={</span>fruit<span class="op">}</span></a>
<a class="sourceLine" id="cb122-49" title="49">        distinctFruit<span class="op">={</span>distinctFruit<span class="op">}</span></a>
<a class="sourceLine" id="cb122-50" title="50">        add<span class="op">={</span><span class="kw">this</span>.<span class="at">add</span><span class="op">}</span></a>
<a class="sourceLine" id="cb122-51" title="51">        addBulk<span class="op">={</span><span class="kw">this</span>.<span class="at">addBulk</span><span class="op">}</span></a>
<a class="sourceLine" id="cb122-52" title="52">        sell<span class="op">={</span><span class="kw">this</span>.<span class="at">sell</span><span class="op">}</span></a>
<a class="sourceLine" id="cb122-53" title="53">        sellAll<span class="op">={</span><span class="kw">this</span>.<span class="at">sellAll</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb122-54" title="54">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb122-55" title="55">  <span class="op">}</span></a>
<a class="sourceLine" id="cb122-56" title="56"><span class="op">}</span></a>
<a class="sourceLine" id="cb122-57" title="57"></a>
<a class="sourceLine" id="cb122-58" title="58"><span class="im">export</span> <span class="im">default</span> FruitManagerContainer<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb123"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb123-1" title="1"><span class="co">// ./src/components/FarmerManagerContainer.js</span></a>
<a class="sourceLine" id="cb123-2" title="2"></a>
<a class="sourceLine" id="cb123-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb123-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;../store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb123-5" title="5"><span class="im">import</span> <span class="op">{</span> hireFarmer<span class="op">,</span> payFarmer <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/farmersActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb123-6" title="6"><span class="im">import</span> FarmerManager <span class="im">from</span> <span class="st">&#39;./FarmerManager&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb123-7" title="7"></a>
<a class="sourceLine" id="cb123-8" title="8"><span class="kw">class</span> FarmerManagerContainer <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb123-9" title="9">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb123-10" title="10">    <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb123-11" title="11">      <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb123-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb123-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb123-14" title="14"></a>
<a class="sourceLine" id="cb123-15" title="15">  <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb123-16" title="16">    <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb123-17" title="17">      <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb123-18" title="18">    <span class="op">}</span></a>
<a class="sourceLine" id="cb123-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb123-20" title="20"></a>
<a class="sourceLine" id="cb123-21" title="21">  pay <span class="op">=</span> (id) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb123-22" title="22">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">payFarmer</span>(id))<span class="op">;</span></a>
<a class="sourceLine" id="cb123-23" title="23">  <span class="op">}</span></a>
<a class="sourceLine" id="cb123-24" title="24"></a>
<a class="sourceLine" id="cb123-25" title="25">  hire <span class="op">=</span> (name) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb123-26" title="26">    <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">hireFarmer</span>(name))<span class="op">;</span></a>
<a class="sourceLine" id="cb123-27" title="27">  <span class="op">}</span></a>
<a class="sourceLine" id="cb123-28" title="28"></a>
<a class="sourceLine" id="cb123-29" title="29">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb123-30" title="30">    <span class="kw">const</span> <span class="op">{</span> <span class="dt">farmers</span><span class="op">:</span> farmersState <span class="op">}</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb123-31" title="31">    <span class="kw">const</span> farmers <span class="op">=</span> <span class="va">Object</span>.<span class="at">values</span>(farmersState)<span class="op">;</span></a>
<a class="sourceLine" id="cb123-32" title="32"></a>
<a class="sourceLine" id="cb123-33" title="33">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb123-34" title="34">      <span class="op">&lt;</span>FarmerManager</a>
<a class="sourceLine" id="cb123-35" title="35">        farmers<span class="op">={</span>farmers<span class="op">}</span></a>
<a class="sourceLine" id="cb123-36" title="36">        pay<span class="op">={</span><span class="kw">this</span>.<span class="at">pay</span><span class="op">}</span></a>
<a class="sourceLine" id="cb123-37" title="37">        hire<span class="op">={</span><span class="kw">this</span>.<span class="at">hire</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb123-38" title="38">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb123-39" title="39">  <span class="op">}</span></a>
<a class="sourceLine" id="cb123-40" title="40"><span class="op">}</span></a>
<a class="sourceLine" id="cb123-41" title="41"></a>
<a class="sourceLine" id="cb123-42" title="42"><span class="im">export</span> <span class="im">default</span> FarmerManagerContainer<span class="op">;</span></a></code></pre></div>
<p>While the amount of duplicated code is currently relatively small, keep in mind that <strong>the approach of using the <code>forceUpdate</code> method to render the component whenever state is updated in the store isn’t optimal</strong>. Calling <code>forceUpdate</code> causes <code>render</code> to be called without first calling <code>shouldComponentUpdate</code>.</p>
<p>Ideally, each container component should contain logic to determine if the state that it retrieves from the store has <em>actually changed</em> before continuing with rendering. Adding the code for this logic would increase the amount of code duplicated in each container component.</p>
<h3 id="react-redux-connect">React-Redux <code>connect</code></h3>
<p><a href="https://react-redux.js.org/">React-Redux</a>, a library from the creators of <a href="https://redux.js.org/">Redux</a>, includes a higher-order component named <code>connect</code> that you can use to create container components. Using <code>connect</code> frees you from having to manually create the <code>FruitManagerContainer</code> and <code>FarmerManagerContainer</code> container components. Using <code>connect</code> also eliminates boilerplate code so you can focus on what makes each container unique: selecting specific slices of state from the store and writing functions to dispatch specific actions. Even better, <code>connect</code> includes the logic that’s needed to optimize the rendering performance, only rendering when the state retrieved from the store has <em>actually changed</em>.</p>
<blockquote>
<p>Over the next couple of articles, you’ll learn how to use <code>connect</code> and the <a href="https://react-redux.js.org/">React-Redux</a> library.</p>
</blockquote>
<h3 id="writing-a-hoc-for-creating-container-components">Writing a HOC for creating container components</h3>
<p>Higher-order components like <a href="https://react-redux.js.org/">React-Redux</a> <code>connect</code>, while extremely useful, can be confusing to understand. To help give you some insight into the underlying implementation of the <code>connect</code> function, you can build a your own <em>custom version</em> of <code>connect</code> (albeit without the logic that’s needed to optimize rendering performance).</p>
<blockquote>
<p>Don’t worry if you struggle to fully understand the following custom version of <code>connect</code>. It takes time and practice to get comfortable with the techniques that are used to create higher-order components. And remember, <strong>you don’t have to build your <code>connect</code> function!</strong> Going forward, you’ll use the well-maintained, highly optimized <code>connect</code> function provided by the <a href="https://react-redux.js.org/">React-Redux</a> library.</p>
</blockquote>
<p>Consider the following <em>custom</em> <code>connect</code> function:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb124-1" title="1"><span class="co">// ./src/connect.js</span></a>
<a class="sourceLine" id="cb124-2" title="2"></a>
<a class="sourceLine" id="cb124-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb124-4" title="4"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;./store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb124-5" title="5"></a>
<a class="sourceLine" id="cb124-6" title="6"><span class="kw">const</span> connect <span class="op">=</span> (mapStateToProps<span class="op">,</span> mapDispatchToProps) <span class="kw">=&gt;</span> (WrappedComponent) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb124-7" title="7">  <span class="kw">class</span> <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb124-8" title="8">    <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb124-9" title="9">      <span class="kw">let</span> stateProps <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb124-10" title="10">      <span class="cf">if</span> (mapStateToProps) <span class="op">{</span></a>
<a class="sourceLine" id="cb124-11" title="11">        stateProps <span class="op">=</span> <span class="at">mapStateToProps</span>(<span class="va">store</span>.<span class="at">getState</span>()<span class="op">,</span> <span class="kw">this</span>.<span class="at">props</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb124-12" title="12">      <span class="op">}</span></a>
<a class="sourceLine" id="cb124-13" title="13"></a>
<a class="sourceLine" id="cb124-14" title="14">      <span class="kw">let</span> dispatchProps <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb124-15" title="15">      <span class="cf">if</span> (mapDispatchToProps) <span class="op">{</span></a>
<a class="sourceLine" id="cb124-16" title="16">        dispatchProps <span class="op">=</span> <span class="at">mapDispatchToProps</span>(<span class="va">store</span>.<span class="at">dispatch</span><span class="op">,</span> <span class="kw">this</span>.<span class="at">props</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb124-17" title="17">      <span class="op">}</span></a>
<a class="sourceLine" id="cb124-18" title="18"></a>
<a class="sourceLine" id="cb124-19" title="19">      <span class="kw">const</span> propsToSpread <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> <span class="kw">this</span>.<span class="at">props</span><span class="op">,</span> stateProps<span class="op">,</span> dispatchProps)<span class="op">;</span></a>
<a class="sourceLine" id="cb124-20" title="20"></a>
<a class="sourceLine" id="cb124-21" title="21">      <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb124-22" title="22">        <span class="op">&lt;</span>WrappedComponent <span class="op">{</span>...<span class="at">propsToSpread</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb124-23" title="23">      )<span class="op">;</span></a>
<a class="sourceLine" id="cb124-24" title="24">    <span class="op">}</span></a>
<a class="sourceLine" id="cb124-25" title="25"></a>
<a class="sourceLine" id="cb124-26" title="26">    <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb124-27" title="27">      <span class="kw">this</span>.<span class="at">unsubscribe</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb124-28" title="28">        <span class="kw">this</span>.<span class="at">forceUpdate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb124-29" title="29">      <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb124-30" title="30">    <span class="op">}</span></a>
<a class="sourceLine" id="cb124-31" title="31">  </a>
<a class="sourceLine" id="cb124-32" title="32">    <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb124-33" title="33">      <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">unsubscribe</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb124-34" title="34">        <span class="kw">this</span>.<span class="at">unsubscribe</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb124-35" title="35">      <span class="op">}</span></a>
<a class="sourceLine" id="cb124-36" title="36">    <span class="op">}</span></a>
<a class="sourceLine" id="cb124-37" title="37">  <span class="op">}</span></a>
<a class="sourceLine" id="cb124-38" title="38">)<span class="op">;</span></a>
<a class="sourceLine" id="cb124-39" title="39"></a>
<a class="sourceLine" id="cb124-40" title="40"><span class="im">export</span> <span class="im">default</span> connect<span class="op">;</span></a></code></pre></div>
<p>The <code>connect</code> function is a higher-order component that returns a function. That function returns an anonymous class component that wraps the component passed in via the <code>WrappedComponent</code> parameter.</p>
<p>The anonymous class component is a "generic" container component that <em>connects</em> <code>WrappedComponent</code> to the Redux store by:</p>
<ul>
<li>Defining the <code>componentDidMount</code> and <code>componentWillUnmount</code> lifecycle method implementations necessary for managing the subscription to the store to render <code>WrappedComponent</code> when state is updated; and</li>
<li>Passing slices of state and functions to dispatch actions down to <code>WrappedComponent</code> using props.</li>
</ul>
<h3 id="comparing-nested-arrow-functions-to-regular-functions">Comparing nested arrow functions to regular functions</h3>
<p>As you saw earlier in this article, higher-order functions can be written using arrow functions or regular functions. The <code>connect</code> higher-order function can be written using arrow functions and implicit return statements:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb125-1" title="1"><span class="kw">const</span> connect <span class="op">=</span> (mapStateToProps<span class="op">,</span> mapDispatchToProps) <span class="kw">=&gt;</span> (WrappedComponent) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb125-2" title="2">  <span class="kw">class</span> <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb125-3" title="3">    <span class="co">// Code removed for brevity.</span></a>
<a class="sourceLine" id="cb125-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb125-5" title="5">)<span class="op">;</span></a></code></pre></div>
<p>Or can be rewritten using regular functions and explicit return statements:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb126-1" title="1"><span class="kw">function</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps) <span class="op">{</span></a>
<a class="sourceLine" id="cb126-2" title="2">  <span class="cf">return</span> <span class="kw">function</span>(WrappedComponent) <span class="op">{</span></a>
<a class="sourceLine" id="cb126-3" title="3">    <span class="cf">return</span> <span class="kw">class</span> <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb126-4" title="4">      <span class="co">// Code removed for brevity.</span></a>
<a class="sourceLine" id="cb126-5" title="5">    <span class="op">};</span></a>
<a class="sourceLine" id="cb126-6" title="6">  <span class="op">};</span></a>
<a class="sourceLine" id="cb126-7" title="7"><span class="op">};</span></a></code></pre></div>
<p>The arrow function syntax, while concise, can be confusing to read.</p>
<h3 id="dynamically-setting-component-attributes">Dynamically setting component attributes</h3>
<p>The <code>connect</code> function’s <code>mapStateToProps</code> and <code>mapDispatchToProps</code> parameters are both functions that are called within the anonymous class’ <code>render</code> method:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb127-1" title="1"><span class="kw">const</span> connect <span class="op">=</span> (mapStateToProps<span class="op">,</span> mapDispatchToProps) <span class="kw">=&gt;</span> (WrappedComponent) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb127-2" title="2">  <span class="kw">class</span> <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb127-3" title="3">    <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb127-4" title="4">      <span class="kw">let</span> stateProps <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb127-5" title="5">      <span class="cf">if</span> (mapStateToProps) <span class="op">{</span></a>
<a class="sourceLine" id="cb127-6" title="6">        stateProps <span class="op">=</span> <span class="at">mapStateToProps</span>(<span class="va">store</span>.<span class="at">getState</span>()<span class="op">,</span> <span class="kw">this</span>.<span class="at">props</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb127-7" title="7">      <span class="op">}</span></a>
<a class="sourceLine" id="cb127-8" title="8"></a>
<a class="sourceLine" id="cb127-9" title="9">      <span class="kw">let</span> dispatchProps <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb127-10" title="10">      <span class="cf">if</span> (mapDispatchToProps) <span class="op">{</span></a>
<a class="sourceLine" id="cb127-11" title="11">        dispatchProps <span class="op">=</span> <span class="at">mapDispatchToProps</span>(<span class="va">store</span>.<span class="at">dispatch</span><span class="op">,</span> <span class="kw">this</span>.<span class="at">props</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb127-12" title="12">      <span class="op">}</span></a>
<a class="sourceLine" id="cb127-13" title="13"></a>
<a class="sourceLine" id="cb127-14" title="14">      <span class="co">// Code removed for brevity.</span></a>
<a class="sourceLine" id="cb127-15" title="15">    <span class="op">}</span></a>
<a class="sourceLine" id="cb127-16" title="16"></a>
<a class="sourceLine" id="cb127-17" title="17">    <span class="co">// Code removed for brevity.</span></a>
<a class="sourceLine" id="cb127-18" title="18">  <span class="op">}</span></a>
<a class="sourceLine" id="cb127-19" title="19">)<span class="op">;</span></a></code></pre></div>
<p>The Redux store’s current state, retrieved using <code>store.getState</code>, is passed to the <code>mapStateToProps</code> function and the store’s <code>dispatch</code> method is passed to the <code>mapDispatchToProps</code> function. The <code>mapStateToProps</code> and <code>mapDispatchToProps</code> functions also receive the anonymous class component’s props (via <code>this.props</code>).</p>
<p>But what are the <code>mapStateToProps</code> and <code>mapDispatchToProps</code> functions exactly? To answer that question, take a look at an example of using the <code>connect</code> function to define the <code>FruitManagerContainer</code> component:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb128-1" title="1"><span class="co">// ./src/components/FruitManagerContainer.js</span></a>
<a class="sourceLine" id="cb128-2" title="2"></a>
<a class="sourceLine" id="cb128-3" title="3"><span class="im">import</span> connect <span class="im">from</span> <span class="st">&#39;../connect&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb128-4" title="4"><span class="im">import</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb128-5" title="5">  addFruit<span class="op">,</span></a>
<a class="sourceLine" id="cb128-6" title="6">  addFruits<span class="op">,</span></a>
<a class="sourceLine" id="cb128-7" title="7">  sellFruit<span class="op">,</span></a>
<a class="sourceLine" id="cb128-8" title="8">  sellOut<span class="op">,</span></a>
<a class="sourceLine" id="cb128-9" title="9"><span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb128-10" title="10"><span class="im">import</span> FruitManager <span class="im">from</span> <span class="st">&#39;./FruitManager&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb128-11" title="11"></a>
<a class="sourceLine" id="cb128-12" title="12"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb128-13" title="13">  <span class="dt">fruit</span><span class="op">:</span> <span class="va">state</span>.<span class="at">fruit</span><span class="op">,</span></a>
<a class="sourceLine" id="cb128-14" title="14">  <span class="dt">distinctFruit</span><span class="op">:</span> <span class="va">Array</span>.<span class="at">from</span>(<span class="kw">new</span> <span class="at">Set</span>(<span class="va">state</span>.<span class="at">fruit</span>)).<span class="at">sort</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb128-15" title="15"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb128-16" title="16"></a>
<a class="sourceLine" id="cb128-17" title="17"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> (dispatch) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb128-18" title="18">  <span class="dt">add</span><span class="op">:</span> (fruit) <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">addFruit</span>(fruit))<span class="op">,</span></a>
<a class="sourceLine" id="cb128-19" title="19">  <span class="dt">addBulk</span><span class="op">:</span> (fruit) <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">addFruits</span>(fruit))<span class="op">,</span></a>
<a class="sourceLine" id="cb128-20" title="20">  <span class="dt">sell</span><span class="op">:</span> (fruit) <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">sellFruit</span>(fruit))<span class="op">,</span></a>
<a class="sourceLine" id="cb128-21" title="21">  <span class="dt">sellAll</span><span class="op">:</span> () <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">sellOut</span>())<span class="op">,</span></a>
<a class="sourceLine" id="cb128-22" title="22"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb128-23" title="23"></a>
<a class="sourceLine" id="cb128-24" title="24"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb128-25" title="25">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb128-26" title="26">  mapDispatchToProps</a>
<a class="sourceLine" id="cb128-27" title="27">)(FruitManager)<span class="op">;</span></a></code></pre></div>
<p><code>mapStateToProps</code> is a function that accepts store’s current state and returns an object that maps state data to one or more properties. <code>mapDispatchToProps</code> is also a function, but it accepts the store’s <code>dispatch</code> method and returns an object whose properties are set to functions that can be called dispatch actions to the store.</p>
<p>In the <code>connect</code> function, <code>Object.assign</code> is then used to combine the <code>stateProps</code> and <code>dispatchProps</code> objects with <code>this.props</code> (the anonymous class component’s props):</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb129-1" title="1"><span class="kw">const</span> propsToSpread <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> <span class="kw">this</span>.<span class="at">props</span><span class="op">,</span> stateProps<span class="op">,</span> dispatchProps)<span class="op">;</span></a></code></pre></div>
<p>Then the properties defined on the <code>propsToSpread</code> object become props on <code>WrappedComponent</code> using JSX spread attribute syntax (<code>...</code>):</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb130-1" title="1"><span class="cf">return</span> (</a>
<a class="sourceLine" id="cb130-2" title="2">  <span class="op">&lt;</span>WrappedComponent <span class="op">{</span>...<span class="at">propsToSpread</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb130-3" title="3">)<span class="op">;</span></a></code></pre></div>
<p>Within the <code>FruitManager</code> component (the component that the <code>connect</code> function’s <code>WrappedComponent</code> is wrapping), parameter destructuring is used to reference the props provided by the <code>mapStateToProps</code> and <code>mapDispatchToProps</code> functions. These props are then passed as props to the appropriate child presentational component:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb131-1" title="1"><span class="co">// ./src/components/FruitManager.js</span></a>
<a class="sourceLine" id="cb131-2" title="2"></a>
<a class="sourceLine" id="cb131-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb131-4" title="4"><span class="im">import</span> FruitList <span class="im">from</span> <span class="st">&#39;./FruitList&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb131-5" title="5"><span class="im">import</span> FruitSeller <span class="im">from</span> <span class="st">&#39;./FruitSeller&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb131-6" title="6"><span class="im">import</span> FruitQuickAdd <span class="im">from</span> <span class="st">&#39;./FruitQuickAdd&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb131-7" title="7"><span class="im">import</span> FruitBulkAdd <span class="im">from</span> <span class="st">&#39;./FruitBulkAdd&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb131-8" title="8"></a>
<a class="sourceLine" id="cb131-9" title="9"><span class="kw">const</span> FruitManager <span class="op">=</span> (<span class="op">{</span> fruit<span class="op">,</span> distinctFruit<span class="op">,</span> add<span class="op">,</span> addBulk<span class="op">,</span> sell<span class="op">,</span> sellAll <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb131-10" title="10">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb131-11" title="11">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb131-12" title="12">      <span class="op">&lt;</span>h2<span class="op">&gt;</span>Available Fruit&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb131-13" title="13">      <span class="op">&lt;</span>FruitList fruit<span class="op">={</span>fruit<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb131-14" title="14">      <span class="op">&lt;</span>h2<span class="op">&gt;</span>Fruit Inventory Manager&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb131-15" title="15">      <span class="op">&lt;</span>FruitSeller distinctFruit<span class="op">={</span>distinctFruit<span class="op">}</span> sell<span class="op">={</span>sell<span class="op">}</span> sellAll<span class="op">={</span>sellAll<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb131-16" title="16">      <span class="op">&lt;</span>FruitQuickAdd add<span class="op">={</span>add<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb131-17" title="17">      <span class="op">&lt;</span>FruitBulkAdd addBulk<span class="op">={</span>addBulk<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb131-18" title="18">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb131-19" title="19">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb131-20" title="20"><span class="op">};</span></a>
<a class="sourceLine" id="cb131-21" title="21"></a>
<a class="sourceLine" id="cb131-22" title="22"><span class="im">export</span> <span class="im">default</span> FruitManager<span class="op">;</span></a></code></pre></div>
<p>Visualizing the flow of data all the from the <code>mapStateToProps</code> and <code>mapDispatchToProps</code> function definitions within the <code>FruitManagerContainer.js</code> file through the <code>connect</code> higher-order component down to the <code>FruitManager</code> wrapped component is <strong>difficult to do</strong>. Understanding how to use React’s ability to dynamically set component attributes using JSX spread attribute syntax is <strong>one of the more challenging aspects of writing higher-order components</strong>.</p>
<p><strong>Just remember that you don’t need to fully understand the above example to use the <code>connect</code> function provided by the <a href="https://react-redux.js.org/">React-Redux</a> library.</strong></p>
<h2 id="reviewing-a-completed-fruit-stand-example-4">Reviewing a completed Fruit Stand example</h2>
<p>To review and run a completed Fruit Stand example application that utilizes the above <em>custom</em> <code>connect</code> higher-order component to create container components, clone the <a href="https://github.com/-starters/redux-fruit-stand-examples">redux-fruit-stand-examples</a> repo.</p>
<p>After cloning the repo, open a terminal and browse to the <code>fruit-stand-redux-with-react-generic-container</code> folder. Run the command <code>npm install</code> to install the project’s dependencies. Then use the command <code>npm start</code> to run the Fruit Stand application.</p>
<p>This Fruit Stand example application is a React application created by the Create React App tooling. When running the application using <code>npm start</code>, the application should automatically open in your default browser. If it doesn’t, you can manually browse to <code>http://localhost:3000/</code> to view the application.</p>
<h2 id="what-you-learned-11">What you learned</h2>
<p>In this article, you learned about higher-order components (HOCs) including how to write a higher-order component that accepts a component as an argument and returns a new component.</p>
<hr />
<h1 id="react-redux-provider">React-Redux: <code>&lt;Provider/&gt;</code></h1>
<p>As you learned in earlier articles, the integration techniques that you were initially shown were just a starting point with using Redux with React. Now that you’ve learned the basics of how React components interact with a Redux store, it’s time to learn how you can use <a href="https://react-redux.js.org/">React-Redux</a>, a library from the creators of <a href="https://redux.js.org/">Redux</a>, to improve upon those techniques.</p>
<p>To prepare to use the <code>connect</code> function from the <a href="https://react-redux.js.org/">React-Redux library</a>, you need to first add a <code>&lt;Provider /&gt;</code> component to your React application. When you finish this article, you should be able to use the <code>&lt;Provider /&gt;</code> component to make your Redux store available to any nested components that have been wrapped in the <code>connect</code> function.</p>
<h2 id="understanding-the-advantages-of-the-provider-component">Understanding the advantages of the <code>&lt;Provider /&gt;</code> component</h2>
<p>Oftentimes, a deeply nested component will need access to the store, while its parents do not. Using vanilla React, these parents would have to receive the <code>store</code> prop in order to pass it down to its child.</p>
<p>Consider the example below:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb132-1" title="1"><span class="co">// App.js</span></a>
<a class="sourceLine" id="cb132-2" title="2"></a>
<a class="sourceLine" id="cb132-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb132-4" title="4"></a>
<a class="sourceLine" id="cb132-5" title="5"><span class="kw">const</span> UserInfo <span class="op">=</span> (<span class="op">{</span> store <span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb132-6" title="6">  <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb132-7" title="7">    <span class="op">{</span><span class="va">store</span>.<span class="at">getState</span>().<span class="at">username</span><span class="op">}</span></a>
<a class="sourceLine" id="cb132-8" title="8">  &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb132-9" title="9">)<span class="op">;</span></a>
<a class="sourceLine" id="cb132-10" title="10"></a>
<a class="sourceLine" id="cb132-11" title="11"><span class="kw">const</span> Header <span class="op">=</span> (<span class="op">{</span> store <span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb132-12" title="12">  <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb132-13" title="13">    <span class="op">&lt;</span>UserInfo store<span class="op">={</span>store<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb132-14" title="14">  &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb132-15" title="15">)<span class="op">;</span></a>
<a class="sourceLine" id="cb132-16" title="16"></a>
<a class="sourceLine" id="cb132-17" title="17"><span class="kw">const</span> App <span class="op">=</span> (<span class="op">{</span> store <span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb132-18" title="18">  <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb132-19" title="19">    <span class="op">&lt;</span>Header store<span class="op">={</span>store<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb132-20" title="20">  &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb132-21" title="21">)<span class="op">;</span></a>
<a class="sourceLine" id="cb132-22" title="22"></a>
<a class="sourceLine" id="cb132-23" title="23"><span class="im">export</span> <span class="im">default</span> App<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb133-1" title="1"><span class="co">// index.js</span></a>
<a class="sourceLine" id="cb133-2" title="2"></a>
<a class="sourceLine" id="cb133-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb133-4" title="4"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb133-5" title="5"></a>
<a class="sourceLine" id="cb133-6" title="6"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb133-7" title="7"><span class="im">import</span> reducer <span class="im">from</span> <span class="st">&#39;./reducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb133-8" title="8"><span class="im">import</span> App <span class="im">from</span> <span class="st">&#39;./App&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb133-9" title="9"></a>
<a class="sourceLine" id="cb133-10" title="10"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(reducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb133-11" title="11"></a>
<a class="sourceLine" id="cb133-12" title="12"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb133-13" title="13">  <span class="op">&lt;</span><span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb133-14" title="14">    <span class="op">&lt;</span>App store<span class="op">={</span>store<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb133-15" title="15">  &lt;/<span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb133-16" title="16">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;root&#39;</span>)</a>
<a class="sourceLine" id="cb133-17" title="17">)<span class="op">;</span></a></code></pre></div>
<p>The <code>store</code> is created in the <code>index.js</code> file, but the <code>UserInfo</code> component that needs to access it is deeply nested. Thus, the store must be passed as a prop down the entire component tree, even though components such as the <code>Header</code> do not need to access the store.</p>
<p>This pattern, called <strong>prop threading</strong>, is tedious and error-prone. You can avoid it by using the <code>&lt;Provider /&gt;</code>/<code>connect</code> API provided by React-Redux.</p>
<h3 id="preparing-your-react-application-for-server-side-rendering">Preparing your React application for server-side rendering</h3>
<p>Using <code>&lt;Provider /&gt;</code> also helps to prepare your React/Redux application to utilize server-side rendering. Server-side rendering allows you to render components to static markup, which can help to reduce the initial loading time of your application.</p>
<blockquote>
<p>React server-side rendering is an advanced topic that won’t be covered in this course. For more information, see the official <a href="https://reactjs.org/docs/react-dom-server.html">React</a> and <a href="https://redux.js.org/recipes/server-rendering">Redux</a> docs.</p>
</blockquote>
<h2 id="adding-provider">Adding <code>&lt;Provider /&gt;</code></h2>
<p>Before adding <code>&lt;Provider /&gt;</code> to your React application, use npm to install the <code>react-redux</code> package:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb134-1" title="1"><span class="ex">npm</span> install react-redux</a></code></pre></div>
<p>Then, in the entry point for your application (typically the <code>index.js</code> file), import the <code>Provider</code> component and your Redux <code>store</code>:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb135-1" title="1"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb135-2" title="2"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;./store&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Then use the <code>Provider</code> component to wrap your <code>App</code> component and set its <code>store</code> prop to your Redux <code>store</code>:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb136-1" title="1"><span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb136-2" title="2">  <span class="op">&lt;</span>App /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb136-3" title="3">&lt;/Provider<span class="op">&gt;</span></a></code></pre></div>
<p>Here’s what your completed <code>index.js</code> file will look like:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb137-1" title="1"><span class="co">// ./src/index.js</span></a>
<a class="sourceLine" id="cb137-2" title="2"></a>
<a class="sourceLine" id="cb137-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb137-4" title="4"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb137-5" title="5"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb137-6" title="6"><span class="im">import</span> <span class="st">&#39;./index.css&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb137-7" title="7"><span class="im">import</span> App <span class="im">from</span> <span class="st">&#39;./App&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb137-8" title="8"><span class="im">import</span> store <span class="im">from</span> <span class="st">&#39;./store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb137-9" title="9"></a>
<a class="sourceLine" id="cb137-10" title="10"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb137-11" title="11">  <span class="op">&lt;</span><span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb137-12" title="12">    <span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb137-13" title="13">      <span class="op">&lt;</span>App /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb137-14" title="14">    &lt;/Provider<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb137-15" title="15">  &lt;/<span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb137-16" title="16">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;root&#39;</span>)</a>
<a class="sourceLine" id="cb137-17" title="17">)<span class="op">;</span></a></code></pre></div>
<p><code>&lt;Provider /&gt;</code> is simply a React component in which you wrap the rest of the application. The <code>Provider</code> component receives the <code>store</code> as a <code>prop</code> and sets a store <code>context</code>. Because you wrapped the entire <code>App</code> in the <code>Provider</code> component, all your components can access the store <code>context</code>.</p>
<p>Components that need to access the store <code>context</code> have to be wrapped in a container component created by the <code>connect</code> function, which converts the store <code>context</code> into a <code>store</code> prop. You’ll learn how to use the <code>connect</code> function in the next article.</p>
<h2 id="understanding-how-provider-relates-to-the-react-context-api">Understanding how <code>&lt;Provider /&gt;</code> relates to the React Context API</h2>
<p>The store <code>context</code> set by <code>&lt;Provider /&gt;</code> is the <em>same</em> React Context that you used in an earlier lesson to manage global state within a React application. You can see this in action by reviewing the <code>react-redux</code> source code on GitHub:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb138-1" title="1"><span class="co">// https://github.com/reduxjs/react-redux/blob/master/src/components/Context.js</span></a>
<a class="sourceLine" id="cb138-2" title="2"></a>
<a class="sourceLine" id="cb138-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span></a>
<a class="sourceLine" id="cb138-4" title="4"></a>
<a class="sourceLine" id="cb138-5" title="5"><span class="im">export</span> <span class="kw">const</span> ReactReduxContext <span class="op">=</span> <span class="co">/*#__PURE__*/</span> <span class="va">React</span>.<span class="at">createContext</span>(<span class="kw">null</span>)</a>
<a class="sourceLine" id="cb138-6" title="6"></a>
<a class="sourceLine" id="cb138-7" title="7"><span class="cf">if</span> (<span class="va">process</span>.<span class="va">env</span>.<span class="at">NODE_ENV</span> <span class="op">!==</span> <span class="st">&#39;production&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb138-8" title="8">  <span class="va">ReactReduxContext</span>.<span class="at">displayName</span> <span class="op">=</span> <span class="st">&#39;ReactRedux&#39;</span></a>
<a class="sourceLine" id="cb138-9" title="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb138-10" title="10"></a>
<a class="sourceLine" id="cb138-11" title="11"><span class="im">export</span> <span class="im">default</span> ReactReduxContext</a></code></pre></div>
<p>And while it’s rarely used, it’s possible to import the context from React-Redux and use the <code>&lt;Consumer /&gt;</code> to access the <code>store</code>:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb139-1" title="1"><span class="im">import</span> <span class="op">{</span> ReactReduxContext <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb139-2" title="2"></a>
<a class="sourceLine" id="cb139-3" title="3"><span class="co">// in your connected component</span></a>
<a class="sourceLine" id="cb139-4" title="4"><span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb139-5" title="5">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb139-6" title="6">    <span class="op">&lt;</span><span class="va">ReactReduxContext</span>.<span class="at">Consumer</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb139-7" title="7">      <span class="op">{</span>(<span class="op">{</span> store <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb139-8" title="8">        <span class="co">// do something with the store here</span></a>
<a class="sourceLine" id="cb139-9" title="9">      <span class="op">}}</span></a>
<a class="sourceLine" id="cb139-10" title="10">    &lt;/<span class="va">ReactReduxContext</span>.<span class="at">Consumer</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb139-11" title="11">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb139-12" title="12"><span class="op">}</span></a></code></pre></div>
<p>You can also connect the Redux <code>&lt;Provider /&gt;</code> component to the <code>&lt;Context.Provider /&gt;</code> component that passes the <code>value</code> of a context object to all child components. Redux’s <code>&lt;Provider /&gt;</code> component simply passes the Redux <code>store</code>, instead of a context <code>value</code>.</p>
<h2 id="what-you-learned-12">What you learned</h2>
<p>In this article, you learned how to use the <code>&lt;Provider /&gt;</code> component to make your Redux store available to any nested components that have been wrapped in the <code>connect</code> function.</p>
<hr />
<h1 id="react-redux-connect-1">React-Redux: <code>connect()</code></h1>
<p>The React-Redux library allows you to access the store <code>context</code> set by the <code>&lt;Provider /&gt;</code> in a powerful and convenient way via the <code>connect</code> function. Using <code>connect</code>, you can pass specific slices of the store’s state and specific action-dispatches to a React component as <code>props</code>. A component’s <code>props</code> then serve as its API to the store, making the component more modular and less burdened by Redux boilerplate.</p>
<p>When you finish this article, you should be able to use the <code>connect</code> function to give a component access to a Redux store.</p>
<h2 id="calling-connect">Calling <code>connect</code></h2>
<p>The React-Redux <code>connect</code> function is a <em>higher-order function</em>. It takes two arguments (plus a couple optional arguments you can read more about in the <a href="https://react-redux.js.org/using-react-redux/connect-mapstate#ownprops-optional">docs</a>) and returns a function:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb140-1" title="1"><span class="kw">const</span> createConnectedComponent <span class="op">=</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb140-2" title="2">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb140-3" title="3">  mapDispatchToProps</a>
<a class="sourceLine" id="cb140-4" title="4">)<span class="op">;</span></a></code></pre></div>
<p>The returned function (<code>createConnectedComponent</code>) then takes the React component that needs access to the Redux store and returns a new React component:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb141-1" title="1"><span class="kw">const</span> ConnectedComponent <span class="op">=</span> <span class="at">createConnectedComponent</span>(MyComponent)<span class="op">;</span></a>
<a class="sourceLine" id="cb141-2" title="2"></a>
<a class="sourceLine" id="cb141-3" title="3"><span class="im">export</span> <span class="im">default</span> ConnectedComponent<span class="op">;</span></a></code></pre></div>
<p><code>ConnectedComponent</code> will render <code>MyComponent</code>, passing along <code>props</code> as determined by the <code>mapStateToProps</code> and <code>mapDispatchToProps</code> arguments.</p>
<p>You can combine these function calls into a single statement by immediately calling the function returned by the <code>connect</code> method (similarly to how you immediately call a function expression when defining an <a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE">IIFE</a>):</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb142-1" title="1"><span class="kw">const</span> ConnectedComponent <span class="op">=</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps)(MyComponent)<span class="op">;</span></a>
<a class="sourceLine" id="cb142-2" title="2"></a>
<a class="sourceLine" id="cb142-3" title="3"><span class="im">export</span> <span class="im">default</span> ConnectedComponent<span class="op">;</span></a></code></pre></div>
<p>Typically, to keep things as concise as possible, the <code>ConnectedComponent</code> variable is omitted:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb143-1" title="1"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps)(MyComponent)<span class="op">;</span></a></code></pre></div>
<h2 id="defining-mapstatetopropsstate-ownprops">Defining <code>mapStateToProps(state, [ownProps])</code></h2>
<p>This first argument to <code>connect</code> is a function, <code>mapStateToProps</code>. It tells <code>connect</code> how to map the <code>state</code> into your component’s <code>props</code>.</p>
<p>It must take as an argument the store’s <code>state</code> (supplied by the <code>Provider</code>’s store <code>context</code>) and return an object containing the relevant <code>props</code> for your component.</p>
<pre class="jsx"><code>const MyComponent = ({ name }) =&gt; (
  &lt;div&gt;{name}&lt;/div&gt;
);

const mapStateToProps = (state) =&gt; ({
  name: state.name;
});

const ConnectedComponent = connect(mapStateToProps)(MyComponent);</code></pre>
<p>In the example above, <code>ConnectedComponent</code> will render <code>MyComponent</code>, passing <code>name</code> as a prop.</p>
<h3 id="ownprops-optional"><code>ownProps</code> (optional)</h3>
<p>A component with explicit <code>props</code> passed down from its parent (e.g. <code>&lt;ConnectedComponent lastName={'Wozniak'}/&gt;</code>) can merge those <code>props</code> with slices of <code>state</code> via <code>ownProps</code>, a optional second argument to <code>mapStateToProps</code>:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb145-1" title="1"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state<span class="op">,</span> ownProps) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb145-2" title="2">  <span class="dt">firstName</span><span class="op">:</span> <span class="va">state</span>.<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb145-3" title="3">  <span class="dt">initials</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span><span class="va">state</span>.<span class="at">name</span>[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">. </span><span class="sc">${</span><span class="va">ownProps</span>.<span class="at">lastName</span>[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">.`</span></a>
<a class="sourceLine" id="cb145-4" title="4"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb145-5" title="5"></a>
<a class="sourceLine" id="cb145-6" title="6"><span class="kw">const</span> ConnectedComponent <span class="op">=</span> <span class="at">connect</span>(mapStateToProps)(MyComponent)<span class="op">;</span></a></code></pre></div>
<p>You can also access React Router props, such <code>match</code> and <code>history</code> through <code>ownProps</code>. Imagine you have a <code>users</code> slice of state, and you want to pass a specific user’s <code>name</code> based on a <code>:userId</code> parameter. You can access the parameter from within the <code>mapStateToProps</code> function with <code>ownProps.match.params.userId</code>:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb146-1" title="1"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state<span class="op">,</span> ownProps) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb146-2" title="2">  <span class="dt">name</span><span class="op">:</span> <span class="va">state</span>.<span class="at">users</span>[<span class="va">ownProps</span>.<span class="va">match</span>.<span class="va">params</span>.<span class="at">userId</span>].<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb146-3" title="3"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb146-4" title="4"></a>
<a class="sourceLine" id="cb146-5" title="5"><span class="kw">const</span> ConnectedComponent <span class="op">=</span> <span class="at">connect</span>(mapStateToProps)(MyComponent)<span class="op">;</span></a></code></pre></div>
<h2 id="defining-mapdispatchtoprops">Defining <code>mapDispatchToProps</code></h2>
<p><code>mapDispatchToProps</code> is the second argument to <code>connect</code>. It’s a function that accepts the store’s <code>dispatch</code> method and returns an object containing functions that can be called to dispatch actions to the store. These action dispatchers are then passed as <code>props</code> to the component.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb147-1" title="1"><span class="kw">const</span> deleteTodo <span class="op">=</span> (id) <span class="kw">=&gt;</span> (<span class="op">{</span> <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;DELETE_TODO&#39;</span><span class="op">,</span> id <span class="op">}</span>)<span class="op">;</span> <span class="co">// action creators</span></a>
<a class="sourceLine" id="cb147-2" title="2"><span class="kw">const</span> addTodo <span class="op">=</span> (msg) <span class="kw">=&gt;</span> (<span class="op">{</span> <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;ADD_TODO&#39;</span><span class="op">,</span> msg <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb147-3" title="3"></a>
<a class="sourceLine" id="cb147-4" title="4"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> (dispatch) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb147-5" title="5">  <span class="dt">handleDelete</span><span class="op">:</span> (id) <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">deleteTodo</span>(id))<span class="op">,</span></a>
<a class="sourceLine" id="cb147-6" title="6">  <span class="dt">handleAdd</span><span class="op">:</span> (msg) <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">addTodo</span>(msg))</a>
<a class="sourceLine" id="cb147-7" title="7"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb147-8" title="8"></a>
<a class="sourceLine" id="cb147-9" title="9"><span class="kw">const</span> ConnectedComponent <span class="op">=</span> <span class="at">connect</span>(<span class="kw">null</span><span class="op">,</span> mapDispatchToProps)(MyComponent)<span class="op">;</span></a></code></pre></div>
<p>Notice that in the example above, the <code>connect</code> function is invoked with <code>null</code> as a placeholder for the <code>mapStateToProps</code> function. The <code>connect</code> function expects <code>mapStateToProps</code> as its first argument and <code>mapDispatchToProps</code> as its second argument.</p>
<h2 id="putting-it-all-together">Putting it all together</h2>
<div class="sourceCode" id="cb148"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb148-1" title="1"><span class="kw">const</span> MyComponent <span class="op">=</span> (<span class="op">{</span> firstName<span class="op">,</span> initials<span class="op">,</span> handleAdd<span class="op">,</span> handleDelete <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb148-2" title="2">  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>...&lt;/div<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb148-3" title="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb148-4" title="4"></a>
<a class="sourceLine" id="cb148-5" title="5"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state<span class="op">,</span> ownProps) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb148-6" title="6">  <span class="dt">firstName</span><span class="op">:</span> <span class="va">state</span>.<span class="at">name</span><span class="op">,</span></a>
<a class="sourceLine" id="cb148-7" title="7">  <span class="dt">initials</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span><span class="va">state</span>.<span class="at">name</span>[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">. </span><span class="sc">${</span><span class="va">ownProps</span>.<span class="at">lastName</span>[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">.`</span></a>
<a class="sourceLine" id="cb148-8" title="8"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb148-9" title="9"></a>
<a class="sourceLine" id="cb148-10" title="10"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> (dispatch) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb148-11" title="11">  <span class="dt">handleDelete</span><span class="op">:</span> (id) <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">deleteTodo</span>(id))<span class="op">,</span></a>
<a class="sourceLine" id="cb148-12" title="12">  <span class="dt">handleAdd</span><span class="op">:</span> (msg) <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">addTodo</span>(msg))</a>
<a class="sourceLine" id="cb148-13" title="13"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb148-14" title="14"></a>
<a class="sourceLine" id="cb148-15" title="15"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb148-16" title="16">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb148-17" title="17">  mapDispatchToProps</a>
<a class="sourceLine" id="cb148-18" title="18">)(MyComponent)<span class="op">;</span></a></code></pre></div>
<p><code>MyComponent</code> will receive <code>firstName</code>, <code>initials</code>, <code>handleDelete</code>, and <code>handleAdd</code> as <code>props</code>.</p>
<p>And remember, unlike the earlier attempt at writing a custom <code>connect</code> higher-order component, the React-Redux library’s <code>connect</code> function <strong>contains logic to optimize the rendering of your connected components</strong>.</p>
<h2 id="reviewing-a-completed-fruit-stand-example-5">Reviewing a completed Fruit Stand example</h2>
<p>To review and run a completed Fruit Stand example application that utilizes the React-Redux library, clone the <a href="https://github.com/-starters/redux-fruit-stand-examples">redux-fruit-stand-examples</a> repo.</p>
<p>After cloning the repo, open a terminal and browse to the <code>fruit-stand-redux-with-react-official-bindings</code> folder. Run the command <code>npm install</code> to install the project’s dependencies. Then use the command <code>npm start</code> to run the Fruit Stand application.</p>
<p>This Fruit Stand example application is a React application created by the Create React App tooling. When running the application using <code>npm start</code>, the application should automatically open in your default browser. If it doesn’t, you can manually browse to <code>http://localhost:3000/</code> to view the application.</p>
<h2 id="what-you-learned-13">What you learned</h2>
<p>In this article, you learned how to use the React-Redux library’s <code>connect</code> function to give a component access to a Redux store.</p>
<hr />
<h1 id="selectors">Selectors</h1>
<p>Selectors are functions used to extract and format information from the application state in different forms. When you finish this article, you should be able to write a selector to extract and format information from state stored in a Redux store.</p>
<h2 id="writing-a-selector">Writing a selector</h2>
<p>Here’s a sample state tree from the Fruit Stand React/Redux application:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb149-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb149-2" title="2">  <span class="dt">fruit</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb149-3" title="3">    <span class="st">&#39;APPLE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-4" title="4">    <span class="st">&#39;APPLE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-5" title="5">    <span class="st">&#39;ORANGE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-6" title="6">    <span class="st">&#39;GRAPEFRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-7" title="7">    <span class="st">&#39;WATERMELON&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-8" title="8">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb149-9" title="9">  <span class="dt">farmers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb149-10" title="10">    <span class="dv">1</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb149-11" title="11">      <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-12" title="12">      <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;John Smith&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-13" title="13">      <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-14" title="14">    <span class="op">},</span></a>
<a class="sourceLine" id="cb149-15" title="15">    <span class="dv">2</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb149-16" title="16">      <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-17" title="17">      <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Sally Jones&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-18" title="18">      <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb149-19" title="19">    <span class="op">},</span></a>
<a class="sourceLine" id="cb149-20" title="20">  <span class="op">}</span></a>
<a class="sourceLine" id="cb149-21" title="21"><span class="op">}</span></a></code></pre></div>
<p>The state’s <code>farmers</code> are stored as an object. Keys correspond to <code>farmer.id</code>s and values correspond to <code>farmer</code> objects. This yields O(1) for the lookup of a single farmer. However, storing all the farmers as values of an object makes it slightly inconvenient to obtain and render them all at once. To solve this inconvenience, we use selectors.</p>
<p>Selectors are typically defined in a file that sits next to the reducer for its slice of state. For example, if the <code>farmers</code> state slice is managed by the reducer defined in <code>./src/reducers/farmersReducer.js</code>, then the farmers selectors would be stored in a file at <code>./src/reducers/farmersSelectors.js</code>.</p>
<p>Selectors are passed the application’s <code>state</code> and return information from the state in a specified form (e.g. an array). You can use selectors to format different slice(s) of the state by calling them in a container’s <code>mapStateToProps</code>.</p>
<p>For example, <code>getAllFarmers</code> returns all the farmers stored in the state as an array of <code>farmer</code> objects, making it easier to iterate over and render each one.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb150-1" title="1"><span class="co">// ./src/reducers/farmersSelectors.js</span></a>
<a class="sourceLine" id="cb150-2" title="2"></a>
<a class="sourceLine" id="cb150-3" title="3"><span class="im">export</span> <span class="kw">const</span> getAllFarmers <span class="op">=</span> (<span class="op">{</span> farmers <span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb150-4" title="4">  <span class="va">Object</span>.<span class="at">values</span>(farmers)</a>
<a class="sourceLine" id="cb150-5" title="5">)<span class="op">;</span></a></code></pre></div>
<p>A selector can be used in multiple components’ <code>mapStateToProps</code>. For example:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb151-1" title="1"><span class="co">// ./src/components/FarmerManagerContainer.js</span></a>
<a class="sourceLine" id="cb151-2" title="2"></a>
<a class="sourceLine" id="cb151-3" title="3"><span class="im">import</span> <span class="op">{</span> getAllFarmers <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../reducers/farmersSelectors&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb151-4" title="4"></a>
<a class="sourceLine" id="cb151-5" title="5"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb151-6" title="6">  <span class="dt">farmers</span><span class="op">:</span> <span class="at">getAllFarmers</span>(state)<span class="op">,</span></a>
<a class="sourceLine" id="cb151-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Selectors are passed the entire application <code>state</code> so they can utilize multiple slices of the application state to assemble data. For example, if the Fruit Stand application’s state tree included a <code>filter</code> state slice:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb152-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb152-2" title="2">  <span class="dt">fruit</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb152-3" title="3">    <span class="st">&#39;APPLE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-4" title="4">    <span class="st">&#39;APPLE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-5" title="5">    <span class="st">&#39;ORANGE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-6" title="6">    <span class="st">&#39;GRAPEFRUIT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-7" title="7">    <span class="st">&#39;WATERMELON&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-8" title="8">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb152-9" title="9">  <span class="dt">farmers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb152-10" title="10">    <span class="dv">1</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb152-11" title="11">      <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-12" title="12">      <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;John Smith&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-13" title="13">      <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-14" title="14">    <span class="op">},</span></a>
<a class="sourceLine" id="cb152-15" title="15">    <span class="dv">2</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb152-16" title="16">      <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-17" title="17">      <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Sally Jones&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-18" title="18">      <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb152-19" title="19">    <span class="op">},</span></a>
<a class="sourceLine" id="cb152-20" title="20">  <span class="op">},</span></a>
<a class="sourceLine" id="cb152-21" title="21">  <span class="dt">filter</span><span class="op">:</span> <span class="st">&#39;&#39;</span></a>
<a class="sourceLine" id="cb152-22" title="22"><span class="op">}</span></a></code></pre></div>
<p>Then you could write a selector to extract a filtered list of <code>farmer</code> objects:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb153-1" title="1"><span class="co">// ./src/reducers/farmersSelectors.js</span></a>
<a class="sourceLine" id="cb153-2" title="2"></a>
<a class="sourceLine" id="cb153-3" title="3"><span class="im">export</span> <span class="kw">const</span> getAllFarmers <span class="op">=</span> (<span class="op">{</span> farmers <span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb153-4" title="4">  <span class="va">Object</span>.<span class="at">values</span>(farmers)</a>
<a class="sourceLine" id="cb153-5" title="5">)<span class="op">;</span></a>
<a class="sourceLine" id="cb153-6" title="6"></a>
<a class="sourceLine" id="cb153-7" title="7"><span class="im">export</span> <span class="kw">const</span> getFilteredFarmers <span class="op">=</span> (<span class="op">{</span> farmers<span class="op">,</span> filter <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb153-8" title="8">  <span class="kw">const</span> lowerCaseFilter <span class="op">=</span> <span class="va">filter</span>.<span class="at">toLowerCase</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb153-9" title="9">  <span class="cf">return</span> <span class="va">Object</span>.<span class="at">values</span>(farmers).<span class="at">filter</span>(</a>
<a class="sourceLine" id="cb153-10" title="10">    (farmer) <span class="kw">=&gt;</span> <span class="va">farmer</span>.<span class="va">name</span>.<span class="at">toLowerCase</span>().<span class="at">includes</span>(lowerCaseFilter)</a>
<a class="sourceLine" id="cb153-11" title="11">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb153-12" title="12"><span class="op">};</span></a></code></pre></div>
<div class="sourceCode" id="cb154"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb154-1" title="1"><span class="co">// ./src/components/FarmerManagerContainer.js</span></a>
<a class="sourceLine" id="cb154-2" title="2"></a>
<a class="sourceLine" id="cb154-3" title="3"><span class="im">import</span> <span class="op">{</span> getAllFarmers<span class="op">,</span> getFilteredFarmers <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../reducers/farmersSelectors&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb154-4" title="4"></a>
<a class="sourceLine" id="cb154-5" title="5"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb154-6" title="6">  <span class="dt">farmers</span><span class="op">:</span> <span class="at">getAllFarmers</span>(state)<span class="op">,</span></a>
<a class="sourceLine" id="cb154-7" title="7">  <span class="dt">filteredFarmers</span><span class="op">:</span> <span class="at">getFilteredFarmers</span>(state)<span class="op">,</span></a>
<a class="sourceLine" id="cb154-8" title="8"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="selector-examples">Selector examples</h2>
<div class="sourceCode" id="cb155"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb155-1" title="1"><span class="co">// ./src/reducers/farmersSelectors.js</span></a>
<a class="sourceLine" id="cb155-2" title="2"></a>
<a class="sourceLine" id="cb155-3" title="3"><span class="co">// Returns the state&#39;s farmers as an array of farmer objects.</span></a>
<a class="sourceLine" id="cb155-4" title="4"><span class="im">export</span> <span class="kw">const</span> getAllFarmers <span class="op">=</span> (<span class="op">{</span> farmers <span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb155-5" title="5">  <span class="va">Object</span>.<span class="at">values</span>(farmers)</a>
<a class="sourceLine" id="cb155-6" title="6">)<span class="op">;</span></a>
<a class="sourceLine" id="cb155-7" title="7"></a>
<a class="sourceLine" id="cb155-8" title="8"><span class="co">// Returns the state&#39;s farmers as an array of farmer objects,</span></a>
<a class="sourceLine" id="cb155-9" title="9"><span class="co">// filtered by their name.</span></a>
<a class="sourceLine" id="cb155-10" title="10"><span class="im">export</span> <span class="kw">const</span> getFilteredFarmers <span class="op">=</span> (<span class="op">{</span> farmers<span class="op">,</span> filter <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb155-11" title="11">  <span class="kw">const</span> lowerCaseFilter <span class="op">=</span> <span class="va">filter</span>.<span class="at">toLowerCase</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb155-12" title="12">  <span class="cf">return</span> <span class="va">Object</span>.<span class="at">values</span>(farmers).<span class="at">filter</span>(</a>
<a class="sourceLine" id="cb155-13" title="13">    (farmer) <span class="kw">=&gt;</span> <span class="va">farmer</span>.<span class="va">name</span>.<span class="at">toLowerCase</span>().<span class="at">includes</span>(lowerCaseFilter)</a>
<a class="sourceLine" id="cb155-14" title="14">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb155-15" title="15"><span class="op">};</span></a>
<a class="sourceLine" id="cb155-16" title="16"></a>
<a class="sourceLine" id="cb155-17" title="17"><span class="co">// Returns the selected farmer object or an empty farmer object</span></a>
<a class="sourceLine" id="cb155-18" title="18"><span class="co">// if no farmer exists with given id.</span></a>
<a class="sourceLine" id="cb155-19" title="19"><span class="im">export</span> <span class="kw">const</span> selectFarmer <span class="op">=</span> (<span class="op">{</span> farmers <span class="op">},</span> id) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb155-20" title="20">  <span class="kw">const</span> nullFarmer <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb155-21" title="21">    <span class="dt">id</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></a>
<a class="sourceLine" id="cb155-22" title="22">    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb155-23" title="23">    <span class="dt">paid</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb155-24" title="24">  <span class="op">};</span></a>
<a class="sourceLine" id="cb155-25" title="25">  <span class="cf">return</span> farmers[id] <span class="op">||</span> nullFarmer<span class="op">;</span></a>
<a class="sourceLine" id="cb155-26" title="26"><span class="op">};</span></a></code></pre></div>
<h2 id="what-you-learned-14">What you learned</h2>
<p>In this article, you learned how to write a selector to extract and format information from state stored in a Redux store.</p>
<hr />
<h1 id="middleware-1">Middleware</h1>
<p>In Redux, middleware specifically refers to an <code>enhancer</code> passed to the store via <code>createStore</code>. When a <code>dispatch</code> is made, the middleware intercepts the <code>action</code> before it reaches the <code>reducer</code>. The middleware can then:</p>
<ul>
<li><strong>resolve the action itself</strong> (for example, by making an AJAX request),</li>
<li><strong>pass along the action</strong> (if the middleware isn’t concerned with it),</li>
<li><strong>generate a side effect</strong> (such as logging debugging information),</li>
<li><strong>send another dispatch</strong> (if the action triggers other actions),</li>
<li>or some combination thereof.</li>
</ul>
<p>You’ll use Redux middleware for logging information about the store and making asynchronous API requests, but you can also use it for crash reporting, routing, and many other applications.</p>
<p>When you finish this article, you should be able to use the React-Redux library’s <code>applyMiddleware</code> function to configure one or more middleware when creating a store.</p>
<h2 id="applying-middleware-to-a-redux-store">Applying middleware to a Redux store</h2>
<p>Recall the <code>redux</code> library’s <code>createStore</code> function used to instantiate a store. <code>createStore</code> accepts three arguments (<code>reducer, preloadedState, enhancer</code>); middleware is given to the store via the optional <code>enhancer</code> argument.</p>
<p>Consider the following example, where you import a third-party <code>logger</code> middleware:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb156-1" title="1"><span class="co">// ./src/store.js</span></a>
<a class="sourceLine" id="cb156-2" title="2"></a>
<a class="sourceLine" id="cb156-3" title="3"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb156-4" title="4"><span class="im">import</span> logger <span class="im">from</span> <span class="st">&#39;redux-logger&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb156-5" title="5"></a>
<a class="sourceLine" id="cb156-6" title="6"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb156-7" title="7"></a>
<a class="sourceLine" id="cb156-8" title="8"><span class="kw">const</span> configureStore <span class="op">=</span> (preloadedState <span class="op">=</span> <span class="op">{}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb156-9" title="9">  <span class="cf">return</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb156-10" title="10">    rootReducer<span class="op">,</span></a>
<a class="sourceLine" id="cb156-11" title="11">    preloadedState<span class="op">,</span></a>
<a class="sourceLine" id="cb156-12" title="12">    <span class="at">applyMiddleware</span>(logger)<span class="op">,</span></a>
<a class="sourceLine" id="cb156-13" title="13">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb156-14" title="14"><span class="op">};</span></a>
<a class="sourceLine" id="cb156-15" title="15"></a>
<a class="sourceLine" id="cb156-16" title="16"><span class="im">export</span> <span class="im">default</span> configureStore<span class="op">;</span></a></code></pre></div>
<p>Any actions dispatched to the <code>store</code> pass through the <code>logger</code> middleware, which prints the store’s state before and after the <code>action</code> is processed.</p>
<blockquote>
<p><strong>Note:</strong> <code>applyMiddleware()</code> accepts multiple arguments, so you can also apply more middleware if necessary.</p>
</blockquote>
<h2 id="reviewing-the-signature-of-middleware-functions">Reviewing the signature of middleware functions</h2>
<p>In addition to importing third-party middlewares such as the above <code>logger</code>, you’ll sometimes need to roll your own. All middleware functions need to conform to the same signature in order to be compatible with the store and other middlewares.</p>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Glossary/Signature/Function"><strong>function signature</strong></a> is the set of inputs and output of a function. A Redux middleware must always have the following signature:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb157-1" title="1"><span class="kw">const</span> middleware <span class="op">=</span> store <span class="kw">=&gt;</span> next <span class="kw">=&gt;</span> action <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb157-2" title="2"> <span class="co">// side effects, if any</span></a>
<a class="sourceLine" id="cb157-3" title="3"> <span class="cf">return</span> <span class="at">next</span>(action)<span class="op">;</span></a>
<a class="sourceLine" id="cb157-4" title="4"><span class="op">};</span></a></code></pre></div>
<p>Every middleware receives the <code>store</code> as an argument and returns a function that takes the <code>next</code> link in the middleware chain as an argument. That function returns <em>another</em> function that receives the <code>action</code> and then triggers any side effects before returning the result of <code>next(action)</code>. Side effects can include triggering AJAX requests, logging to the console, and more. Side effects can also happen after <code>next(action)</code> is called, like so:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb158-1" title="1"><span class="kw">const</span> middleware <span class="op">=</span> store <span class="kw">=&gt;</span> next <span class="kw">=&gt;</span> action <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb158-2" title="2"> <span class="kw">const</span> result <span class="op">=</span> <span class="at">next</span>(action)<span class="op">;</span></a>
<a class="sourceLine" id="cb158-3" title="3"> <span class="co">// side effect using `result`</span></a>
<a class="sourceLine" id="cb158-4" title="4"> <span class="cf">return</span> result<span class="op">;</span></a>
<a class="sourceLine" id="cb158-5" title="5"><span class="op">};</span></a></code></pre></div>
<h2 id="creating-your-own-logger-middleware">Creating your own <code>logger</code> middleware</h2>
<p>You can hand-roll the <code>logger</code> middleware you imported above. It should print out the state before and after each dispatch, allowing you to check if your reducers are working as expected. This middleware should:</p>
<ul>
<li>receive the store as its only argument,</li>
<li>return a function that receives the <code>next</code> middleware,</li>
<li>which should itself return a function receiving the <code>action</code>.</li>
</ul>
<p>The body of the innermost function is where you want to do your logging. That function should:</p>
<ul>
<li><code>console.log</code> the <code>action</code></li>
<li><code>console.log</code> the result of <code>store.getState()</code> (pre-dispatch)</li>
<li>call <code>next(action)</code> to pass the action on to the rest of the middlewares, and eventually, the reducer</li>
<li>save the <code>result</code> of the <code>next(action)</code> variable, to be returned later</li>
<li><code>console.log</code> the new <code>store.getState()</code></li>
<li>return the saved <code>result</code></li>
</ul>
<div class="sourceCode" id="cb159"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb159-1" title="1"><span class="kw">const</span> logger <span class="op">=</span> store <span class="kw">=&gt;</span> next <span class="kw">=&gt;</span> action <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb159-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Action received:&#39;</span><span class="op">,</span> action)<span class="op">;</span></a>
<a class="sourceLine" id="cb159-3" title="3">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;State pre-dispatch:&#39;</span><span class="op">,</span> <span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb159-4" title="4"></a>
<a class="sourceLine" id="cb159-5" title="5">  <span class="kw">let</span> result <span class="op">=</span> <span class="at">next</span>(action)<span class="op">;</span></a>
<a class="sourceLine" id="cb159-6" title="6"></a>
<a class="sourceLine" id="cb159-7" title="7">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;State post-dispatch:&#39;</span><span class="op">,</span> <span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb159-8" title="8"></a>
<a class="sourceLine" id="cb159-9" title="9">  <span class="cf">return</span> result<span class="op">;</span></a>
<a class="sourceLine" id="cb159-10" title="10"><span class="op">};</span></a></code></pre></div>
<p>Now, whenever you dispatch an action, you’ll see its effect on the store.</p>
<h2 id="installing-and-applying-the-redux-logger-middleware">Installing and applying the <code>redux-logger</code> middleware</h2>
<p>As you move forward with Redux, you’ll want to have access to your store’s state for debugging purposes. Including the <code>redux-logger</code> npm package and adding it as a middleware gives you access (through the console) to the previous state, action, and next state with each dispatch. This is incredibly convenient for debugging purposes and avoids such unpleasantness as attaching the <code>store</code> to the <code>window</code>.</p>
<figure>
<img src="images/react-redux-logger.png" alt="react-redux-logger" /><figcaption>react-redux-logger</figcaption>
</figure>
<p>Follow the example below to include it in your projects:</p>
<ul>
<li>Include the <code>redux-logger</code> package:</li>
</ul>
<div class="sourceCode" id="cb160"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb160-1" title="1"><span class="ex">npm</span> install redux-logger</a></code></pre></div>
<ul>
<li>Pass an instance of <code>redux-logger</code> to <code>applyMiddleware</code> when creating your store:</li>
</ul>
<p><strong>Note: <code>logger</code> must be the last middleware passed into <code>applyMiddleware</code></strong>, otherwise it will log the thunk and any involved promises. You’ll learn about thunks and <code>react-thunk</code> in the next article.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb161-1" title="1"><span class="co">// ./src/store.js</span></a>
<a class="sourceLine" id="cb161-2" title="2"></a>
<a class="sourceLine" id="cb161-3" title="3"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb161-4" title="4"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">&#39;redux-thunk&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb161-5" title="5"><span class="im">import</span> logger <span class="im">from</span> <span class="st">&#39;redux-logger&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb161-6" title="6"></a>
<a class="sourceLine" id="cb161-7" title="7"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb161-8" title="8"></a>
<a class="sourceLine" id="cb161-9" title="9"><span class="kw">const</span> configureStore <span class="op">=</span> (preloadedState <span class="op">=</span> <span class="op">{}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb161-10" title="10">  <span class="cf">return</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb161-11" title="11">    rootReducer<span class="op">,</span></a>
<a class="sourceLine" id="cb161-12" title="12">    preloadedState<span class="op">,</span></a>
<a class="sourceLine" id="cb161-13" title="13">    <span class="at">applyMiddleware</span>(thunk<span class="op">,</span> logger)<span class="op">,</span></a>
<a class="sourceLine" id="cb161-14" title="14">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb161-15" title="15"><span class="op">};</span></a>
<a class="sourceLine" id="cb161-16" title="16"></a>
<a class="sourceLine" id="cb161-17" title="17"><span class="im">export</span> <span class="im">default</span> configureStore<span class="op">;</span></a></code></pre></div>
<h2 id="what-you-learned-15">What you learned</h2>
<p>In this article, you learned how to use the React-Redux library’s <code>applyMiddleware</code> function to configure one or more middleware when creating a store.</p>
<hr />
<h1 id="thunks-1">Thunks</h1>
<p>One of the most common problems you need middleware to solve is asynchronicity. When building web applications that interact with a server, you’ll need to request resources and then dispatch the response to your store when it eventually gets back.</p>
<p>While it’s possible to make these API calls from your components and dispatch synchronously on success, for consistency and reusability it’s preferable to have the source of every change to our application state be an action creator. Thunks are a new kind of action creator that will allow you to do that.</p>
<p>When you finish this article, you should be able to write a thunk action creator to make an asynchronous request to an API and dispatch an action when the response is received.</p>
<h2 id="looking-at-how-thunks-work">Looking at how thunks work</h2>
<p>Rather than returning a plain object, a thunk action creator returns a function. This function, when called with an argument of <code>dispatch</code>, can then dispatch one or more actions, immediately, or later. Here’s an example:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb162-1" title="1"><span class="kw">const</span> thunkActionCreator <span class="op">=</span> () <span class="kw">=&gt;</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb162-2" title="2">  <span class="at">dispatch</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb162-3" title="3">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;RECEIVE_MESSAGE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb162-4" title="4">    <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;This will be dispatched immediately.&#39;</span></a>
<a class="sourceLine" id="cb162-5" title="5">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb162-6" title="6"></a>
<a class="sourceLine" id="cb162-7" title="7">  <span class="at">setTimeout</span>(() <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb162-8" title="8">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;RECEIVE_MESSAGE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb162-9" title="9">    <span class="dt">message</span><span class="op">:</span> <span class="st">&#39;This will be dispatched 1 second later.&#39;</span></a>
<a class="sourceLine" id="cb162-10" title="10">  <span class="op">},</span> <span class="dv">1000</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb162-11" title="11"><span class="op">}</span></a></code></pre></div>
<p>This is great, but without custom middleware it will break as soon as the function action hits your reducer. You need middleware to intercept all actions of type <code>function</code> and then trigger the dispatch:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb163-1" title="1"><span class="co">// ./src/middleware/thunkMiddleware.js</span></a>
<a class="sourceLine" id="cb163-2" title="2"></a>
<a class="sourceLine" id="cb163-3" title="3"><span class="kw">const</span> thunk <span class="op">=</span> (<span class="op">{</span> dispatch<span class="op">,</span> getState <span class="op">}</span>) <span class="kw">=&gt;</span> next <span class="kw">=&gt;</span> action <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb163-4" title="4">  <span class="cf">if</span> (<span class="kw">typeof</span> action <span class="op">===</span> <span class="st">&#39;function&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb163-5" title="5">    <span class="cf">return</span> <span class="at">action</span>(dispatch<span class="op">,</span> getState)<span class="op">;</span></a>
<a class="sourceLine" id="cb163-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb163-7" title="7">  <span class="cf">return</span> <span class="at">next</span>(action)<span class="op">;</span></a>
<a class="sourceLine" id="cb163-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb163-9" title="9"></a>
<a class="sourceLine" id="cb163-10" title="10"><span class="im">export</span> <span class="im">default</span> thunk<span class="op">;</span></a></code></pre></div>
<p>Notice how the <code>getState</code> function is passed into the <code>action</code> in case your asynchronous action creators need access to your application state.</p>
<p>Then you’d apply your custom middleware to your store:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb164-1" title="1"><span class="co">// ./src/store.js</span></a>
<a class="sourceLine" id="cb164-2" title="2"></a>
<a class="sourceLine" id="cb164-3" title="3"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb164-4" title="4"><span class="im">import</span> logger <span class="im">from</span> <span class="st">&#39;redux-logger&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb164-5" title="5"></a>
<a class="sourceLine" id="cb164-6" title="6"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb164-7" title="7"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">&#39;./middleware/thunkMiddleware&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb164-8" title="8"></a>
<a class="sourceLine" id="cb164-9" title="9"><span class="kw">const</span> configureStore <span class="op">=</span> (preloadedState <span class="op">=</span> <span class="op">{}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb164-10" title="10">  <span class="cf">return</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb164-11" title="11">    rootReducer<span class="op">,</span></a>
<a class="sourceLine" id="cb164-12" title="12">    preloadedState<span class="op">,</span></a>
<a class="sourceLine" id="cb164-13" title="13">    <span class="at">applyMiddleware</span>(thunk<span class="op">,</span> logger)<span class="op">,</span></a>
<a class="sourceLine" id="cb164-14" title="14">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb164-15" title="15"><span class="op">};</span></a>
<a class="sourceLine" id="cb164-16" title="16"></a>
<a class="sourceLine" id="cb164-17" title="17"><span class="im">export</span> <span class="im">default</span> configureStore<span class="op">;</span></a></code></pre></div>
<p>That’s it! Now that you have all the pieces, you’re ready to review a more concrete example.</p>
<h2 id="reviewing-a-concrete-example">Reviewing a concrete example</h2>
<p>Much like the logger from the previous article, thunk middleware is available as the <code>redux-thunk</code> library.</p>
<blockquote>
<p>The middleware you just wrote is almost the entire original library! (<a href="https://github.com/gaearon/redux-thunk/blob/master/src/index.js">Check out the source code</a>). For more on thunks and handling asynchronicity in Redux, you can take a look at <a href="http://stackoverflow.com/questions/35411423/how-to-dispatch-a-redux-action-with-a-timeout/35415559#35415559">this interesting SO post from the creator</a>.</p>
</blockquote>
<p>Start by using npm to install the <code>redux-thunk</code> package:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb165-1" title="1"><span class="ex">npm</span> install redux-thunk</a></code></pre></div>
<p>Then apply the middleware to your store:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb166-1" title="1"><span class="co">// ./src/store.js</span></a>
<a class="sourceLine" id="cb166-2" title="2"></a>
<a class="sourceLine" id="cb166-3" title="3"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb166-4" title="4"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">&#39;redux-thunk&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb166-5" title="5"><span class="im">import</span> logger <span class="im">from</span> <span class="st">&#39;redux-logger&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb166-6" title="6"></a>
<a class="sourceLine" id="cb166-7" title="7"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb166-8" title="8"></a>
<a class="sourceLine" id="cb166-9" title="9"><span class="kw">const</span> configureStore <span class="op">=</span> (preloadedState <span class="op">=</span> <span class="op">{}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb166-10" title="10">  <span class="cf">return</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb166-11" title="11">    rootReducer<span class="op">,</span></a>
<a class="sourceLine" id="cb166-12" title="12">    preloadedState<span class="op">,</span></a>
<a class="sourceLine" id="cb166-13" title="13">    <span class="at">applyMiddleware</span>(thunk<span class="op">,</span> logger)<span class="op">,</span></a>
<a class="sourceLine" id="cb166-14" title="14">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb166-15" title="15"><span class="op">};</span></a>
<a class="sourceLine" id="cb166-16" title="16"></a>
<a class="sourceLine" id="cb166-17" title="17"><span class="im">export</span> <span class="im">default</span> configureStore<span class="op">;</span></a></code></pre></div>
<p>Imagine that you’re updating the Fruit Stand application to use a Node/Express API for data persistence. You would use a <code>fetchFruits</code> thunk action creator to retrieve the list of fruits from the API:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb167-1" title="1"><span class="co">// ./src/actions/fruitActions.js</span></a>
<a class="sourceLine" id="cb167-2" title="2"></a>
<a class="sourceLine" id="cb167-3" title="3"><span class="im">import</span> <span class="op">{</span> FRUIT_STAND_API_BASE_URL <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../config&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb167-4" title="4"></a>
<a class="sourceLine" id="cb167-5" title="5"><span class="im">export</span> <span class="kw">const</span> RECEIVE_FRUITS <span class="op">=</span> <span class="st">&#39;RECEIVE_FRUITS&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb167-6" title="6"></a>
<a class="sourceLine" id="cb167-7" title="7"><span class="im">export</span> <span class="kw">const</span> fetchFruits <span class="op">=</span> () <span class="kw">=&gt;</span> (dispatch) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb167-8" title="8">  <span class="at">fetch</span>(<span class="vs">`</span><span class="sc">${</span>FRUIT_STAND_API_BASE_URL<span class="sc">}</span><span class="vs">/fruits`</span>)</a>
<a class="sourceLine" id="cb167-9" title="9">    .<span class="at">then</span>((res) <span class="kw">=&gt;</span> <span class="va">res</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb167-10" title="10">    .<span class="at">then</span>((data) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb167-11" title="11">      <span class="at">dispatch</span>(<span class="at">receiveFruits</span>(<span class="va">data</span>.<span class="at">fruits</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb167-12" title="12">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb167-13" title="13">)<span class="op">;</span></a>
<a class="sourceLine" id="cb167-14" title="14"></a>
<a class="sourceLine" id="cb167-15" title="15"><span class="kw">const</span> receiveFruits <span class="op">=</span> (fruits) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb167-16" title="16">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb167-17" title="17">    <span class="dt">type</span><span class="op">:</span> RECEIVE_FRUITS<span class="op">,</span></a>
<a class="sourceLine" id="cb167-18" title="18">    fruits<span class="op">,</span></a>
<a class="sourceLine" id="cb167-19" title="19">  <span class="op">};</span></a>
<a class="sourceLine" id="cb167-20" title="20"><span class="op">};</span></a></code></pre></div>
<p>Notice that the Fetch API is used to make an HTTP request to the <code>/fruits</code> API endpoint. When the promise returned from the <code>fetch</code> method call resolves, the <code>res.json</code> method is called to parse the JSON into JavaScript objects, which in turn is dispatched to the store using the <code>receiveFruits</code> action creator. The <code>receiveFruits</code> action creator returns an action of type <code>RECEIVE_FRUITS</code> that includes the <code>fruit</code> payload.</p>
<p>In the <code>fruitReducer</code>, the <code>RECEIVE_FRUITS</code> case clause simply returns the <code>action.fruits</code> payload as the new state:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb168-1" title="1"><span class="co">// ./src/reducers/fruitReducer.js</span></a>
<a class="sourceLine" id="cb168-2" title="2"></a>
<a class="sourceLine" id="cb168-3" title="3"><span class="im">import</span> <span class="op">{</span> RECEIVE_FRUITS <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb168-4" title="4"></a>
<a class="sourceLine" id="cb168-5" title="5"><span class="kw">const</span> fruitReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb168-6" title="6">  <span class="va">Object</span>.<span class="at">freeze</span>(state)<span class="op">;</span></a>
<a class="sourceLine" id="cb168-7" title="7">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb168-8" title="8">    <span class="cf">case</span> <span class="dt">RECEIVE_FRUITS</span><span class="op">:</span></a>
<a class="sourceLine" id="cb168-9" title="9">      <span class="cf">return</span> <span class="va">action</span>.<span class="at">fruits</span><span class="op">;</span></a>
<a class="sourceLine" id="cb168-10" title="10">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb168-11" title="11">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb168-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb168-13" title="13"><span class="op">};</span></a>
<a class="sourceLine" id="cb168-14" title="14"></a>
<a class="sourceLine" id="cb168-15" title="15"><span class="im">export</span> <span class="im">default</span> fruitReducer<span class="op">;</span></a></code></pre></div>
<p>To load the fruits from the API when the React application starts up, you can update the <code>index.js</code> file to dispatch the <code>fetchFruits</code> thunk action creator after creating the store:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb169-1" title="1"><span class="co">// ./src/index.js</span></a>
<a class="sourceLine" id="cb169-2" title="2"></a>
<a class="sourceLine" id="cb169-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb169-4" title="4"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb169-5" title="5"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb169-6" title="6"></a>
<a class="sourceLine" id="cb169-7" title="7"><span class="im">import</span> <span class="st">&#39;./index.css&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb169-8" title="8"><span class="im">import</span> App <span class="im">from</span> <span class="st">&#39;./App&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb169-9" title="9"><span class="im">import</span> configureStore <span class="im">from</span> <span class="st">&#39;./store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb169-10" title="10"><span class="im">import</span> <span class="op">{</span> fetchFruits <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./actions/fruitActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb169-11" title="11"></a>
<a class="sourceLine" id="cb169-12" title="12"><span class="kw">const</span> store <span class="op">=</span> <span class="at">configureStore</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb169-13" title="13"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">fetchFruits</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb169-14" title="14"></a>
<a class="sourceLine" id="cb169-15" title="15"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb169-16" title="16">  <span class="op">&lt;</span><span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb169-17" title="17">    <span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb169-18" title="18">      <span class="op">&lt;</span>App /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb169-19" title="19">    &lt;/Provider<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb169-20" title="20">  &lt;/<span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb169-21" title="21">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;root&#39;</span>)</a>
<a class="sourceLine" id="cb169-22" title="22">)<span class="op">;</span></a></code></pre></div>
<h3 id="adding-configuration-for-the-api-base-url">Adding configuration for the API base URL</h3>
<p>The <code>FRUIT_STAND_API_BASE_URL</code> variable (imported at the top of the <code>fruitActions.js</code> file) is defined in the <code>config.js</code> file:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb170-1" title="1"><span class="im">export</span> <span class="kw">const</span> FRUIT_STAND_API_BASE_URL <span class="op">=</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">REACT_APP_FRUIT_STAND_API_BASE_URL</span><span class="op">;</span></a></code></pre></div>
<p>And the <code>REACT_APP_FRUIT_STAND_API_BASE_URL</code> environment variable is defined in an <code>.env</code> file (located in the root of the React project):</p>
<pre><code>REACT_APP_FRUIT_STAND_API_BASE_URL=http://localhost:8080</code></pre>
<p>Adding configuration for the API base URL keeps you from having to hard-code a value that’ll change between environments.</p>
<h2 id="reviewing-a-completed-fruit-stand-example-6">Reviewing a completed Fruit Stand example</h2>
<p>To review and run a completed Fruit Stand example application that utilizes middleware and thunks to support asynchronous interaction with a backend API, clone the <a href="https://github.com/-starters/redux-fruit-stand-examples">redux-fruit-stand-examples</a> repo.</p>
<p>After cloning the repo, open a terminal and browse to the <code>fruit-stand-redux-with-react-middleware-thunks</code> folder.</p>
<h3 id="running-the-api">Running the API</h3>
<p>To run the Node/Express API application, complete the following steps:</p>
<ol type="1">
<li><p>Within the <code>backend</code> folder, add an <code>.env</code> file based upon the <code>.env.example</code> file.</p></li>
<li><p>Use the following SQL statements to create a PostgreSQL database and user:</p></li>
</ol>
<div class="sourceCode" id="cb172"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb172-1" title="1"><span class="kw">create</span> <span class="kw">database</span> fruit_stand;</a>
<a class="sourceLine" id="cb172-2" title="2"><span class="kw">create</span> <span class="fu">user</span> fruit_stand_app <span class="kw">with</span> encrypted <span class="kw">password</span> <span class="st">&#39;«a strong password for the fruit_stand_app user»&#39;</span>;</a>
<a class="sourceLine" id="cb172-3" title="3"><span class="kw">grant</span> <span class="kw">all</span> <span class="kw">privileges</span> <span class="kw">on</span> <span class="kw">database</span> fruit_stand <span class="kw">to</span> fruit_stand_app;</a></code></pre></div>
<ol start="3" type="1">
<li>From a terminal, browse to the <code>backend</code> folder and run the following commands to apply the Sequelize migrations and seed data:</li>
</ol>
<div class="sourceCode" id="cb173"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb173-1" title="1"><span class="ex">npx</span> dotenv sequelize db:migrate</a>
<a class="sourceLine" id="cb173-2" title="2"><span class="ex">npx</span> dotenv sequelize db:seed:all</a></code></pre></div>
<ol start="4" type="1">
<li>Start the application using <code>npm start</code>.</li>
</ol>
<h3 id="running-the-react-application">Running the React application</h3>
<p>From the <code>frontend</code> folder, run the command <code>npm install</code> to install the project’s dependencies. Then use the command <code>npm start</code> to run the Fruit Stand application.</p>
<p>This Fruit Stand example application is a React application created by the Create React App tooling. When running the application using <code>npm start</code>, the application should automatically open in your default browser. If it doesn’t, you can manually browse to <code>http://localhost:3000/</code> to view the application.</p>
<h2 id="what-you-learned-16">What you learned</h2>
<p>In this article, you learned how to write a thunk action creator to make an asynchronous request to an API and dispatch an action when the response is received.</p>
<hr />
<h1 id="advanced-containers">Advanced Containers</h1>
<p>While you learned in an earlier article that you should aim to have very few containers, there are exceptions. When you finish this article, you should be able to describe a situation where defining multiple containers for a single component is advantageous.</p>
<h2 id="knowing-when-to-break-the-rules">Knowing when to break the rules</h2>
<p>Separating your concerns with presentational and container components allows you to reuse presentational components where it makes sense, rather than duplicating code. If a presentational component needs different data in each situation, though, you may need more containers. By creating more container components, you can render the same presentational component with each of those containers to suit different needs.</p>
<p>Consider a form component that may either <em>create</em> or <em>edit</em> a post. The form itself looks and works the same in both cases; it has a few inputs and a submit button. The use cases differ, though, in that the edit form needs to map state from the store to its props, while the create form does not. Furthermore, the edit form will need to dispatch a different action when the form submits than the create form will, as well as request the object from our backend.</p>
<p><strong>As you go through the code snippets below, read the comments carefully.</strong></p>
<p>Here’s the presentational component, <code>PostForm</code>:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb174-1" title="1"><span class="co">// PostForm.js</span></a>
<a class="sourceLine" id="cb174-2" title="2"></a>
<a class="sourceLine" id="cb174-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb174-4" title="4"></a>
<a class="sourceLine" id="cb174-5" title="5"><span class="kw">class</span> PostForm <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb174-6" title="6">  <span class="at">constructor</span>(props) <span class="op">{</span></a>
<a class="sourceLine" id="cb174-7" title="7">    <span class="kw">super</span>(props)<span class="op">;</span></a>
<a class="sourceLine" id="cb174-8" title="8">    <span class="co">// set up initial state</span></a>
<a class="sourceLine" id="cb174-9" title="9">    <span class="kw">this</span>.<span class="at">state</span> <span class="op">=</span> <span class="kw">this</span>.<span class="va">props</span>.<span class="at">post</span><span class="op">;</span> <span class="co">// a Post object has a title and a body</span></a>
<a class="sourceLine" id="cb174-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb174-11" title="11"></a>
<a class="sourceLine" id="cb174-12" title="12">  <span class="kw">static</span> <span class="at">getDerivedStateFromProps</span>(props<span class="op">,</span> state) <span class="op">{</span></a>
<a class="sourceLine" id="cb174-13" title="13">    <span class="co">// if we get a different post in props, we&#39;ll need to set state</span></a>
<a class="sourceLine" id="cb174-14" title="14">    <span class="cf">if</span> (<span class="va">props</span>.<span class="va">post</span>.<span class="at">id</span> <span class="op">!==</span> <span class="va">state</span>.<span class="at">id</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb174-15" title="15">      <span class="cf">return</span> <span class="va">props</span>.<span class="at">post</span><span class="op">;</span></a>
<a class="sourceLine" id="cb174-16" title="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb174-17" title="17">  <span class="op">}</span></a>
<a class="sourceLine" id="cb174-18" title="18"></a>
<a class="sourceLine" id="cb174-19" title="19">  update <span class="op">=</span> (field) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb174-20" title="20">    <span class="cf">return</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb174-21" title="21">      <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span> [field]<span class="op">:</span> <span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb174-22" title="22">    <span class="op">};</span></a>
<a class="sourceLine" id="cb174-23" title="23">  <span class="op">}</span></a>
<a class="sourceLine" id="cb174-24" title="24"></a>
<a class="sourceLine" id="cb174-25" title="25">  handleSubmit <span class="op">=</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb174-26" title="26">    <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb174-27" title="27">    <span class="co">// `submit` will be a thunk action that presumably creates or edits a post</span></a>
<a class="sourceLine" id="cb174-28" title="28">    <span class="kw">this</span>.<span class="va">props</span>.<span class="at">submit</span>(<span class="kw">this</span>.<span class="at">state</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb174-29" title="29">  <span class="op">}</span></a>
<a class="sourceLine" id="cb174-30" title="30"></a>
<a class="sourceLine" id="cb174-31" title="31">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb174-32" title="32">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb174-33" title="33">      <span class="op">&lt;</span>form onSubmit<span class="op">={</span><span class="kw">this</span>.<span class="at">handleSubmit</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb174-34" title="34">        <span class="op">&lt;</span>label<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb174-35" title="35">          Title</a>
<a class="sourceLine" id="cb174-36" title="36">          <span class="op">&lt;</span>input</a>
<a class="sourceLine" id="cb174-37" title="37">            type<span class="op">=</span><span class="st">&quot;text&quot;</span></a>
<a class="sourceLine" id="cb174-38" title="38">            onChange<span class="op">={</span><span class="kw">this</span>.<span class="at">update</span>(<span class="st">&quot;title&quot;</span>)<span class="op">}</span></a>
<a class="sourceLine" id="cb174-39" title="39">            value<span class="op">={</span><span class="kw">this</span>.<span class="va">state</span>.<span class="at">title</span><span class="op">}</span></a>
<a class="sourceLine" id="cb174-40" title="40">          /&gt;</a>
<a class="sourceLine" id="cb174-41" title="41">        &lt;/label<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb174-42" title="42"></a>
<a class="sourceLine" id="cb174-43" title="43">        <span class="op">&lt;</span>label<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb174-44" title="44">          Body</a>
<a class="sourceLine" id="cb174-45" title="45">          <span class="op">&lt;</span>input</a>
<a class="sourceLine" id="cb174-46" title="46">            type<span class="op">=</span><span class="st">&quot;text&quot;</span></a>
<a class="sourceLine" id="cb174-47" title="47">            onChange<span class="op">={</span><span class="kw">this</span>.<span class="at">update</span>(<span class="st">&quot;body&quot;</span>)<span class="op">}</span></a>
<a class="sourceLine" id="cb174-48" title="48">            value<span class="op">={</span><span class="kw">this</span>.<span class="va">state</span>.<span class="at">body</span><span class="op">}</span></a>
<a class="sourceLine" id="cb174-49" title="49">          /&gt;</a>
<a class="sourceLine" id="cb174-50" title="50">        &lt;/label<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb174-51" title="51"></a>
<a class="sourceLine" id="cb174-52" title="52">        <span class="op">&lt;</span>button<span class="op">&gt;</span>Submit Post&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb174-53" title="53">      &lt;/form<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb174-54" title="54">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb174-55" title="55">  <span class="op">}</span></a>
<a class="sourceLine" id="cb174-56" title="56"><span class="op">}</span></a>
<a class="sourceLine" id="cb174-57" title="57"></a>
<a class="sourceLine" id="cb174-58" title="58"><span class="im">export</span> <span class="im">default</span> PostForm<span class="op">;</span></a></code></pre></div>
<p>You can see that <code>PostForm</code> is expecting two things in props: a <code>post</code> object and a <code>submit</code> function. The container will have to define these, since right now, this form can’t actually do anything. Give it the ability to create a post:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb175-1" title="1"><span class="co">// CreatePostFormContainer.js</span></a>
<a class="sourceLine" id="cb175-2" title="2"></a>
<a class="sourceLine" id="cb175-3" title="3"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb175-4" title="4"><span class="im">import</span> PostForm <span class="im">from</span> <span class="st">&#39;./PostForm&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb175-5" title="5"><span class="im">import</span> <span class="op">{</span> createPost <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/postActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb175-6" title="6"></a>
<a class="sourceLine" id="cb175-7" title="7"><span class="kw">const</span> mapStateToProps <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb175-8" title="8">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb175-9" title="9">    <span class="dt">post</span><span class="op">:</span> <span class="op">{</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="dt">body</span><span class="op">:</span> <span class="st">&#39;&#39;</span> <span class="op">}</span> <span class="co">// a default blank object</span></a>
<a class="sourceLine" id="cb175-10" title="10">  <span class="op">};</span></a>
<a class="sourceLine" id="cb175-11" title="11"><span class="op">};</span></a>
<a class="sourceLine" id="cb175-12" title="12"></a>
<a class="sourceLine" id="cb175-13" title="13"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb175-14" title="14">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb175-15" title="15">    <span class="dt">submit</span><span class="op">:</span> post <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">createPost</span>(post))</a>
<a class="sourceLine" id="cb175-16" title="16">  <span class="op">};</span></a>
<a class="sourceLine" id="cb175-17" title="17"><span class="op">};</span></a>
<a class="sourceLine" id="cb175-18" title="18"></a>
<a class="sourceLine" id="cb175-19" title="19"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb175-20" title="20">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb175-21" title="21">  mapDispatchToProps</a>
<a class="sourceLine" id="cb175-22" title="22">)(PostForm)<span class="op">;</span></a></code></pre></div>
<p>So far, this is nothing new. Now, wherever you need a form to create a post, you can render <code>CreatePostFormContainer</code> by importing from the above file.</p>
<p>But what about editing? This is a little trickier, because you need more information from the store - so you’ll need a <a href="https://spin.atomicobject.com/2017/03/02/higher-order-components-in-react/">higher-order component</a> to help you out. Higher-order components are a useful React pattern that essentially uses a component to render another component, usually to handle some sort of work and pass in data. This pattern allows us to keep your components small and modular. Here, you’ll use a higher-order component to fetch the post you want to edit and pass it into the <code>PostForm</code>:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb176-1" title="1"><span class="co">// EditPostFormContainer.js</span></a>
<a class="sourceLine" id="cb176-2" title="2"></a>
<a class="sourceLine" id="cb176-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb176-4" title="4"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb176-5" title="5"><span class="im">import</span> PostForm <span class="im">from</span> <span class="st">&#39;./PostForm&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb176-6" title="6"><span class="im">import</span> <span class="op">{</span> fetchPost<span class="op">,</span> updatePost <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/postActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb176-7" title="7"><span class="im">import</span> <span class="op">{</span> selectPost <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../reducers/postSelectors&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb176-8" title="8"></a>
<a class="sourceLine" id="cb176-9" title="9"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state<span class="op">,</span> ownProps) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb176-10" title="10">  <span class="kw">const</span> defaultPost <span class="op">=</span> <span class="op">{</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="dt">body</span><span class="op">:</span> <span class="st">&#39;&#39;</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb176-11" title="11">  <span class="kw">const</span> post <span class="op">=</span> <span class="at">selectPost</span>(<span class="va">ownProps</span>.<span class="va">match</span>.<span class="va">params</span>.<span class="at">postId</span>) <span class="op">||</span> defaultPost<span class="op">;</span></a>
<a class="sourceLine" id="cb176-12" title="12">  <span class="co">// get the post this route is asking for</span></a>
<a class="sourceLine" id="cb176-13" title="13">  <span class="co">// (assuming here that this component is being rendered by a route)</span></a>
<a class="sourceLine" id="cb176-14" title="14">  <span class="co">// if you don&#39;t have the post in state yet, return a blank post so PostForm doesn&#39;t break</span></a>
<a class="sourceLine" id="cb176-15" title="15">  <span class="cf">return</span> <span class="op">{</span> post <span class="op">};</span></a>
<a class="sourceLine" id="cb176-16" title="16"><span class="op">};</span></a>
<a class="sourceLine" id="cb176-17" title="17"></a>
<a class="sourceLine" id="cb176-18" title="18"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb176-19" title="19">  <span class="co">// an edit form will need to fetch the relevant post, but the PostForm shouldn&#39;t handle that</span></a>
<a class="sourceLine" id="cb176-20" title="20">  <span class="co">// you&#39;ll handle this problem with a higher-order component, EditPostFormContainer</span></a>
<a class="sourceLine" id="cb176-21" title="21">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb176-22" title="22">    <span class="dt">fetchPost</span><span class="op">:</span> id <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">fetchPost</span>(id))<span class="op">,</span></a>
<a class="sourceLine" id="cb176-23" title="23">    <span class="dt">submit</span><span class="op">:</span> post <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">updatePost</span>(post))</a>
<a class="sourceLine" id="cb176-24" title="24">  <span class="op">};</span></a>
<a class="sourceLine" id="cb176-25" title="25"><span class="op">};</span></a>
<a class="sourceLine" id="cb176-26" title="26"></a>
<a class="sourceLine" id="cb176-27" title="27"><span class="kw">class</span> EditPostForm <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb176-28" title="28">  <span class="co">// this is the higher-order component made to handle the fetch</span></a>
<a class="sourceLine" id="cb176-29" title="29"></a>
<a class="sourceLine" id="cb176-30" title="30">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb176-31" title="31">    <span class="co">// do the fetching here so that PostForm doesn&#39;t have to</span></a>
<a class="sourceLine" id="cb176-32" title="32">    <span class="kw">this</span>.<span class="va">props</span>.<span class="at">fetchPost</span>(<span class="kw">this</span>.<span class="va">props</span>.<span class="va">match</span>.<span class="va">params</span>.<span class="at">postId</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb176-33" title="33">  <span class="op">}</span></a>
<a class="sourceLine" id="cb176-34" title="34"></a>
<a class="sourceLine" id="cb176-35" title="35">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb176-36" title="36">    <span class="co">// destructure the props so you can easily pass them down to PostForm</span></a>
<a class="sourceLine" id="cb176-37" title="37">    <span class="kw">const</span> <span class="op">{</span> post<span class="op">,</span> submit <span class="op">}</span> <span class="op">=</span> <span class="kw">this</span>.<span class="at">props</span><span class="op">;</span></a>
<a class="sourceLine" id="cb176-38" title="38">    <span class="cf">return</span> <span class="op">&lt;</span>PostForm post<span class="op">={</span>post<span class="op">}</span> submit<span class="op">={</span>submit<span class="op">}</span> /&gt;<span class="op">;</span></a>
<a class="sourceLine" id="cb176-39" title="39">  <span class="op">}</span></a>
<a class="sourceLine" id="cb176-40" title="40"><span class="op">}</span></a>
<a class="sourceLine" id="cb176-41" title="41"></a>
<a class="sourceLine" id="cb176-42" title="42"><span class="co">// now `connect` it to the Redux store</span></a>
<a class="sourceLine" id="cb176-43" title="43"></a>
<a class="sourceLine" id="cb176-44" title="44"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb176-45" title="45">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb176-46" title="46">  mapDispatchToProps</a>
<a class="sourceLine" id="cb176-47" title="47">)(EditPostForm)<span class="op">;</span></a></code></pre></div>
<p>The result here is that we can render a <code>CreatePostFormContainer</code> wherever you want a form to create a post, and an <code>EditPostFormContainer</code> wherever you want to edit a post. Both components will render a <code>PostForm</code>, but each will have different functions. The <code>PostForm</code> also gets to be very simple and make almost no decisions. This helps keep your code DRY and modular.</p>
<p>You can use this pattern with any presentational component that needs to be connected to the store, but may need entirely different data to perform different functions.</p>
<h2 id="what-you-learned-17">What you learned</h2>
<p>In this article, you learned about a situation where defining multiple containers for a single component is advantageous.</p>
<hr />
<h1 id="redux-developer-tools">Redux Developer Tools</h1>
<p>Redux has its own special set of developer tools. They allow you to do things like inspect your application state in real time as you use your app, or cancel an action to see a live recalculation of the state as if that action had never been dispatched. They require only a few minutes of setup, and can be well worth the effort.</p>
<h2 id="instructions">Instructions</h2>
<ol type="1">
<li><p>Install the <a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd">chrome extension</a>.</p></li>
<li><p>Install the npm package into your project:</p></li>
</ol>
<div class="sourceCode" id="cb177"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb177-1" title="1"><span class="ex">npm</span> install redux-devtools-extension</a></code></pre></div>
<ol start="3" type="1">
<li>Make the following changes to your <code>./src/store.js</code> file.</li>
</ol>
<p><strong>If you’re <em>not</em> using middleware:</strong></p>
<div class="sourceCode" id="cb178"><pre class="sourceCode diff"><code class="sourceCode diff"><a class="sourceLine" id="cb178-1" title="1">  // ./src/store.js</a>
<a class="sourceLine" id="cb178-2" title="2"></a>
<a class="sourceLine" id="cb178-3" title="3">  import { createStore } from &#39;redux&#39;;</a>
<a class="sourceLine" id="cb178-4" title="4"><span class="va">+ import { devToolsEnhancer } from &#39;redux-devtools-extension&#39;;</span></a>
<a class="sourceLine" id="cb178-5" title="5"></a>
<a class="sourceLine" id="cb178-6" title="6">  import rootReducer from &#39;./reducers/rootReducer&#39;;</a>
<a class="sourceLine" id="cb178-7" title="7"></a>
<a class="sourceLine" id="cb178-8" title="8">  const configureStore = () =&gt; {</a>
<a class="sourceLine" id="cb178-9" title="9">    return createStore(</a>
<a class="sourceLine" id="cb178-10" title="10">      rootReducer,</a>
<a class="sourceLine" id="cb178-11" title="11"><span class="va">+     devToolsEnhancer()</span></a>
<a class="sourceLine" id="cb178-12" title="12">    );</a>
<a class="sourceLine" id="cb178-13" title="13">  };</a>
<a class="sourceLine" id="cb178-14" title="14"></a>
<a class="sourceLine" id="cb178-15" title="15">  export default configureStore;</a></code></pre></div>
<p><strong>Or if you’re using middleware:</strong></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode diff"><code class="sourceCode diff"><a class="sourceLine" id="cb179-1" title="1">  // ./src/store.js</a>
<a class="sourceLine" id="cb179-2" title="2"></a>
<a class="sourceLine" id="cb179-3" title="3">  import { createStore, applyMiddleware } from &#39;redux&#39;;</a>
<a class="sourceLine" id="cb179-4" title="4">  import thunk from &#39;redux-thunk&#39;;</a>
<a class="sourceLine" id="cb179-5" title="5">  import logger from &#39;redux-logger&#39;;</a>
<a class="sourceLine" id="cb179-6" title="6"><span class="va">+ import { composeWithDevTools } from &#39;redux-devtools-extension&#39;;</span></a>
<a class="sourceLine" id="cb179-7" title="7"></a>
<a class="sourceLine" id="cb179-8" title="8">  import rootReducer from &#39;./reducers/rootReducer&#39;;</a>
<a class="sourceLine" id="cb179-9" title="9"></a>
<a class="sourceLine" id="cb179-10" title="10">  const configureStore = () =&gt; {</a>
<a class="sourceLine" id="cb179-11" title="11">    return createStore(</a>
<a class="sourceLine" id="cb179-12" title="12">      rootReducer,</a>
<a class="sourceLine" id="cb179-13" title="13"><span class="va">+     composeWithDevTools(applyMiddleware(thunk, logger))</span></a>
<a class="sourceLine" id="cb179-14" title="14"><span class="st">-     applyMiddleware(thunk, logger)</span></a>
<a class="sourceLine" id="cb179-15" title="15">    );</a>
<a class="sourceLine" id="cb179-16" title="16">  };</a>
<a class="sourceLine" id="cb179-17" title="17"></a>
<a class="sourceLine" id="cb179-18" title="18">  export default configureStore;</a></code></pre></div>
<h2 id="use">Use</h2>
<p>Now that you’ve set up the Redux dev tools, you can try them out. You’ll use one of the Fruit Stand application examples. If you haven’t already, clone the <a href="https://github.com/-starters/redux-fruit-stand-examples">redux-fruit-stand-examples</a> repo.</p>
<p>After cloning the repo, open a terminal and browse to the <code>fruit-stand-redux-with-react-official-bindings</code> folder. Run the command <code>npm install</code> to install the project’s dependencies. Then use the command <code>npm start</code> to run the Fruit Stand application.</p>
<p>This Fruit Stand example application is a React application created by the Create React App tooling. When running the application using <code>npm start</code>, the application should automatically open in your default browser. If it doesn’t, you can manually browse to <code>http://localhost:3000/</code> to view the application.</p>
<p><strong>Open the project into your code editor and complete the above set up steps.</strong></p>
<p>You should see an atom (a nucleus with electrons) icon on your Chrome toolbar, and if you’ve set up the Redux dev tools correctly it should now be green. Click on it. When the Redux dev tools open, click one of the buttons on the very bottom left to open them in a new window.</p>
<p>Now try adding some fruit. This will cause actions to be dispatched. You should see those actions popping up in the Redux dev tools. You can click on them to cancel them and you should see the state recalculated in real time.</p>
<p>The Redux dev tools have some other handy features, so click around and explore!</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd">Redux Dev Tools - Chrome Extension</a></li>
<li><a href="https://github.com/gaearon/redux-devtools">Redux Dev Tools - Github Page</a></li>
<li><a href="http://extension.remotedev.io/#demo">Redux Dev Tools - Demo</a></li>
</ul>
<hr />
<h1 id="redux-based-pokedex-project">Redux-Based Pokedex Project</h1>
<p>Instead of building a new application, you will spend time refactoring an existing application, one that is not yours. Navigating around someone else’s code is an interesting way to learn what to do and what <em>not</em> to do. The starter application is in a little bit of a mess and needs your help to get unmessed.</p>
<p>By the end of this walk-through, you will be able to:</p>
<ul>
<li>Describe the Redux data cycle</li>
<li>Explain a <em>reducer</em></li>
<li>Configure a React application to use Redux</li>
<li>Use connected components to access Redux state</li>
<li>Use composed reducers to simplify state management</li>
<li>Configure a React application to use the Redux development tools</li>
</ul>
<h2 id="getting-started">Getting started</h2>
<p>You’ll need the backend of the application.</p>
<p>If you have <em>not</em> cloned it, please clone the repository from https://github.com/-starters/pokedex-backend.</p>
<p>If you have cloned it, please get the latest (things sometimes change) by going to the repository in your Terminal and typing <code>git pull origin master</code>. This will get the latest code for you.</p>
<p>You’ll need the starter application. Please clone the repository from https://github.com/-starters/redux-pokedex-starter.</p>
<h2 id="tour-the-application">Tour the application</h2>
<p>This application is a Heroku-deployable React application. Here are the files that are in it. Hopefully, you find nothing surprising about the file layout or the intent of each file. Take a moment to look in each file to get the lay of the land. (Really, take a look in each file. You may feel like jumping right into it, but looking at other people’s code is helpful. This is one of the benefits to the pair-programming learning style at .)</p>
<pre><code>.
├── package-lock.json        - The NPM lock file
├── package.json             - The NPM file
├── public
│   └── index.html           - The page that gets served to the browser
├── server.js                - A very light-weight server for Heroku
└── src
    ├── App.js               - The main application component
    ├── Fab.js               - A floating action button component
    ├── LoginPanel.js        - The form that shows the login
    ├── LogoutButton.js      - A component for logging out
    ├── PokemonBrowser.js    - The component that shows the list and detail
    ├── PokemonDetail.js     - The component that shows the detail of a Pokemon
    ├── PokemonForm.js       - The form to create a new Pokemon
    ├── config.js            - Configuration variables
    ├── index.css            - Styling for the application
    └── index.js             - The main entry point for Webpack</code></pre>
<p>Start the backend with <code>npm run dev</code>. Start the React application with <code>npm run dev</code>. Make sure it runs. It looks for a local backend at <code>http://localhost:8000</code>, so make sure that’s where the backend is running.</p>
<h2 id="install-redux-and-devtools">Install Redux and DevTools</h2>
<p>If you haven’t already, install <a href="https://www.programmableweb.com/">Redux DevTools</a>. During development, you can watch the Redux store handle actions and change state in the timeline.</p>
<p>To use Redux in this application, you need to install it and the connector between Redux and React. You will also want to use asynchronous actions with the Redux store, so you’ll want a middleware, one like <a href="https://react-bootstrap.github.io/">Redux Thunk</a>.</p>
<pre><code>npm install react-redux redux redux-thunk</code></pre>
<p>There are more than one asynchronous action-handling middleware out there in the world. Redux Thunk happens to be one of the oldest and widely used.</p>
<p>Whenever you consider installing a library or framework, you should make sure that your existing application meets the expectations. For example, as of the time of this writing, to <a href="https://material-ui.com/">install "react-redux"</a>, your application needs to support <strong>React 16.8.3</strong> or later. Take a look in the <strong>package.json</strong> file to make sure that an acceptable version of React is listed in there. If not, you will need to upgrade the version of React used by this project by running something like <code>npm upgrade</code>.</p>
<h2 id="setting-up-the-store">Setting up the store</h2>
<p>The <em>store</em> is the object (and supporting objects and functions) that will contain the state of the application. This centralizes the state so that, presumably, you can better reason about it.</p>
<p>There are a couple of ways to organize your state management code, each with their own benefits. Redux has a list of different articles about <a href="https://v2.grommet.io/">this very topic</a>. You should choose to organize your code in a way that makes sense to your team (or follow any conventions that already exist). This walk-through will follow the <a href="https://react.semantic-ui.com/">Ducks</a> approach of layout.</p>
<p>In the <strong>src</strong> directory, create a new directory named <strong>store</strong>. In that new directory, create a new file named <strong>configureStore.js</strong>. In that file, put this code. This is boilerplate code and will appear in nearly every application that you have that uses Redux. A description of the contents follows the code block.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb182-1" title="1"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware<span class="op">,</span> combineReducers<span class="op">,</span> compose <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb182-2" title="2"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">&#39;redux-thunk&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb182-3" title="3"></a>
<a class="sourceLine" id="cb182-4" title="4"><span class="kw">const</span> composeEnhancers <span class="op">=</span> <span class="va">window</span>.<span class="at">__REDUX_DEVTOOLS_EXTENSION_COMPOSE__</span> <span class="op">||</span> compose<span class="op">;</span></a>
<a class="sourceLine" id="cb182-5" title="5"></a>
<a class="sourceLine" id="cb182-6" title="6"><span class="kw">const</span> reducer <span class="op">=</span> <span class="at">combineReducers</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb182-7" title="7"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb182-8" title="8"></a>
<a class="sourceLine" id="cb182-9" title="9"><span class="kw">const</span> configureStore <span class="op">=</span> initialState <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb182-10" title="10">  <span class="cf">return</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb182-11" title="11">    reducer<span class="op">,</span></a>
<a class="sourceLine" id="cb182-12" title="12">    initialState<span class="op">,</span></a>
<a class="sourceLine" id="cb182-13" title="13">    <span class="at">composeEnhancers</span>(<span class="at">applyMiddleware</span>(thunk))<span class="op">,</span></a>
<a class="sourceLine" id="cb182-14" title="14">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb182-15" title="15"><span class="op">};</span></a>
<a class="sourceLine" id="cb182-16" title="16"></a>
<a class="sourceLine" id="cb182-17" title="17"><span class="im">export</span> <span class="im">default</span> configureStore<span class="op">;</span></a></code></pre></div>
<p>(If you’re looking in your console after putting this code in there, you’ll see an error about not having any valid reducers. That’s true, there are no valid reducers. You’ll fix that in just a moment.)</p>
<p>On those first two lines, the code imports the stuff it will need to create and configure a store.</p>
<ul>
<li><code>createStore</code> is the function from Redux that creates the state-management object</li>
<li><code>applyMiddleware</code> allows you to plug in extra functionality into the state-management workflow (in this case, Redux Thunk)</li>
<li><code>combineReducers</code> takes many reducers and combines them into a single one</li>
<li><code>compose</code> is a function that <em>composes</em> functions from right-to-left, that is, it puts them together, the return value of the right-most getting passed to the second right-most, return values getting passed from that to the third right-most, and so on, until the first function in the list returns its final value to the store (<a href="https://redux.js.org/api/compose">documentation</a> for compose)</li>
<li><code>thunk</code> is the middleware that will allow you to make asynchronous calls because you can’t do that in Redux actions</li>
</ul>
<p>The fourth line creates a new <code>composeEnhancers</code> variable that will be either the Redux DevTools special compose function, or the one from Redux, if DevTools is not installed. This allows browsers that have the DevTools installed to take advantage of watching the changes in the store.</p>
<p>The sixth and seventh lines is just the thing that combines the reducers for the store into a single reducer. More about that later.</p>
<p>The ninth line declares a function that gets exported at the end of the file that creates and configures the store with the <code>reducer</code>, the <code>initialState</code> passed into the function, and composes the React Thunk middleware and the Redux DevTools, if they exist.</p>
<p>To use this functionality, open <strong>src/index.js</strong> and add two imports to the top of the file.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb183-1" title="1"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb183-2" title="2"><span class="im">import</span> configureStore <span class="im">from</span> <span class="st">&#39;./store/configureStore&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Those two lines import a Context Provider from React Redux and the function you just created above. Now, under those lines and before the <code>ReactDOM.render</code> statement, create a store.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb184-1" title="1"><span class="kw">const</span> store <span class="op">=</span> <span class="at">configureStore</span>()<span class="op">;</span></a></code></pre></div>
<p>Finally, wrap the <code>App</code> component in a <code>Provider</code> component that has a "store" property assigned the value of <code>store</code> that you created in the previous code snippet, just as you saw in the <em>Passing the Store</em> section of the <em>Usage with React</em> article you read in the homework preparing you for these topics.</p>
<p>If everything works, you should be able to view the Redux DevTools in your browser’s DevTools environment as a new tab. You should see the "@<span class="citation" data-cites="INIT">@INIT</span>" action that was run and an empty state.</p>
<figure>
<img src="https://socket.io" alt="Redux DevTools initialization" /><figcaption>Redux DevTools initialization</figcaption>
</figure>
<h2 id="your-first-action-workflow">Your first action workflow</h2>
<p>Now, you will refactor the <code>LoginPanel</code> component to put the token it receives from the AJAX call into the Redux store. The rest of the application will remain the same, for now.</p>
<p>Open <code>LoginPanel</code> and review it. There are two "interesting" portions of this code, the <code>render</code> function which will redirect to the path "/" when a token exists (and show the login form if it does not), and the <code>handleSubmit</code> method that makes the actual AJAX call to get the token. These are the things that you will modify to make this work. It’s going to seem like a lot of code replacing just a few lines, but this will make your application easier to understand because all of the state changes will be encapsulated in their own area under the <strong>store</strong> directory. You won’t have to search through a bunch of components to figure out why the application as a whole is not working.</p>
<p>The first step is to make <code>LoginPanel</code> a <em>connected component</em>, that is, connect it to the Redux store’s pipeline. To do this, follow these steps:</p>
<ol type="1">
<li>Import <code>connect</code> from <code>react-redux</code> in the import section of the <code>LoginPanel</code>.</li>
<li><p>Remove the <code>export</code> line at the bottom and replace it with this.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb185-1" title="1"><span class="kw">const</span> mapStateToProps <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb185-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb185-3" title="3">  <span class="op">};</span></a>
<a class="sourceLine" id="cb185-4" title="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb185-5" title="5"></a>
<a class="sourceLine" id="cb185-6" title="6"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb185-7" title="7">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb185-8" title="8">  <span class="op">};</span></a>
<a class="sourceLine" id="cb185-9" title="9"><span class="op">};</span></a>
<a class="sourceLine" id="cb185-10" title="10"></a>
<a class="sourceLine" id="cb185-11" title="11"><span class="co">// Yes, this looks funny, but you will often</span></a>
<a class="sourceLine" id="cb185-12" title="12"><span class="co">// see this kind of indentation in others&#39;</span></a>
<a class="sourceLine" id="cb185-13" title="13"><span class="co">// code when using React and Redux.</span></a>
<a class="sourceLine" id="cb185-14" title="14"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb185-15" title="15">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb185-16" title="16">  mapDispatchToProps</a>
<a class="sourceLine" id="cb185-17" title="17">)(</a>
<a class="sourceLine" id="cb185-18" title="18">  LoginPanel</a>
<a class="sourceLine" id="cb185-19" title="19">)<span class="op">;</span></a></code></pre></div></li>
</ol>
<p>The last line of the code <em>connects</em> the <code>LoginPanel</code> to the Redux store. The two functions that you created above it, <code>mapStateToProps</code> and <code>mapDispatchToProps</code> are functions that you will write to help in translating state and actions for use in your component. The <code>mapStateToProps</code> function maps the state of the Redux store to the values that you want to show up in the <code>props</code> of the connected component. The <code>mapDispatchToProps</code> function maps complicated action calls to simple ones that your component can use.</p>
<p>The first thing you’ll need is one of those actions. This is going to be something to let your authentication run to get that token. In the <strong>src/store</strong> directory, create a new file named <strong>authentication.js</strong> which will contain all of the Redux-related stuff to handle authentication:</p>
<ul>
<li>the actions,</li>
<li>the action types,</li>
<li>the thunks (which are just actions that are allowed to perform calls that have use resources <em>outside</em> the function, like AJAX calls or putting something into local storage), and,</li>
<li>the reducers.</li>
</ul>
<p>The steps that you want the application to go through are:</p>
<ul>
<li>Make an AJAX call to sign in (that’s a <em>thunk</em>)</li>
<li>When the token returns, create an <em>action</em> that will send the token to the store</li>
<li>Create a reducer to put the token in the store</li>
</ul>
<p>Most of these steps will need something more, so if you see something not defined in one of these steps, you will get to it in a later step.</p>
<h3 id="the-thunk">The thunk</h3>
<p>In case you lost track, this goes in <strong>src/store/authentication.js</strong>.</p>
<p>First up, <em>thunks</em> are functions that return another function that takes a single function as its argument. The argument is the <code>dispatch</code> method used to dispatch actions to Redux. So, for example, the <code>login</code> thunk could have this form.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb186-1" title="1"><span class="im">export</span> <span class="kw">const</span> login <span class="op">=</span> (email<span class="op">,</span> password) <span class="kw">=&gt;</span> <span class="kw">async</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb186-2" title="2">  <span class="co">// Dispatch an action, here</span></a>
<a class="sourceLine" id="cb186-3" title="3"><span class="op">}</span></a></code></pre></div>
<p>That’s pretty weird, if you’ve never seen that syntax before, those double <code>=&gt;</code> signs in there. It’s a shortcut to write a function that returns a function. You could also write it like this:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb187-1" title="1"><span class="im">export</span> <span class="kw">const</span> login <span class="op">=</span> (email<span class="op">,</span> password) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb187-2" title="2">  <span class="cf">return</span> <span class="kw">async</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb187-3" title="3">    <span class="co">// Dispatch an action, here</span></a>
<a class="sourceLine" id="cb187-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb187-5" title="5"><span class="op">}</span></a></code></pre></div>
<p>Once you get used to the double (or triple) <code>=&gt;</code> signs, it becomes second nature to write functions that return functions, that way.</p>
<p>Inside the login method, make a <code>fetch</code> call to the API using the same <code>fetch</code> call found in <code>LoginPanel</code>’s <code>handleSubmit</code> method. You’ll need to import <code>baseUrl</code> from the <strong>src/config.js</strong> module. You don’t have access to the state of the object, just the <code>email</code> and <code>password</code> that they’re passing in through your method call, so change the "body" parameter of the <code>fetch</code> from <code>JSON.stringify(this.state),</code> to <code>JSON.stringify({ email, password }),</code>.</p>
<p>For now, if the response from the fetch is ok, just get the token out of the response object and log it to the console.</p>
<p>Now, to hook up this thunk to your component, open <strong>src/LoginPanel.js</strong> and import the <code>login</code> thunk that you just created. At the bottom in the <code>mapDispatchToProps</code> function, add a "login" key that is a function that takes an email and password, and then dispatches the <code>login</code> thunk with those values.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb188-1" title="1"><span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb188-2" title="2">  <span class="dt">login</span><span class="op">:</span> (email<span class="op">,</span> password) <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">login</span>(email<span class="op">,</span> password))</a>
<a class="sourceLine" id="cb188-3" title="3"><span class="op">};</span></a></code></pre></div>
<p>Now, there’s a "login" property on the <code>props</code> handed to the <code>LoginPanel</code> component. The value of the "login" property is a function that takes an <em>email</em> and a <em>password</em>. Those then get handed to the <code>login</code> thunk which returns a function to the <code>dispatch</code> function of Redux. It’s functions all the way down.</p>
<p>Now, delete everything from the <code>handleSubmit</code> method <em>except</em> the line that prevents the default action. Replace it with a call to the function in the "login" property of the <code>props</code> like this.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb189-1" title="1"><span class="kw">this</span>.<span class="va">props</span>.<span class="at">login</span>(<span class="kw">this</span>.<span class="va">state</span>.<span class="at">email</span><span class="op">,</span> <span class="kw">this</span>.<span class="va">state</span>.<span class="at">password</span>)<span class="op">;</span></a></code></pre></div>
<p>After the application refreshes, you should be able to click the <em>Login</em> button on the screen and see token appear after the AJAX call completes.</p>
<p>Now that you have the token, you need to dispatch another action, one that isn’t created yet, to set the token in the state so it can be used elsewhere. Remove the <code>console.log</code> statement in your <code>login</code> thunk and replace it with an invocation of the <code>dispatch</code> method that your thunk gets, dispatching an action creator named <code>setToken</code> with the token as its argument.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb190-1" title="1"><span class="at">dispatch</span>(<span class="at">setToken</span>(token))</a></code></pre></div>
<p>Now, it’s time to create that action.</p>
<h3 id="the-action">The action</h3>
<p>Actions are just plain objects that have, at a minimum, a "type" property. Action creators are just plain functions that return actions.</p>
<p>Below your import section and above the <code>login</code> thunk of your code in <strong>src/store/authentication.js</strong>, create a constant named <code>SET_TOKEN</code> and set it equal to the string <code>'pokedex/authentication/SET_TOKEN'</code>. You could make this string <em>anything</em>, it just needs to be unique within your application. This is merely the <a href="https://react.semantic-ui.com/">Ducks</a> convention.</p>
<p>Now, create a function <code>setToken</code> that takes a token as its one parameter, and returns an object that has a "type" property set to the <code>SET_TOKEN</code> constant and a "token" property set to the value passed into the parameter. Export the <code>setToken</code> function.</p>
<p>If you’ve done everything correctly to this point, when you click the <em>Login</em> button, you should now see an action appear in the Redux DevTools with the string that you set the <code>SET_TOKEN</code> constant to.</p>
<figure>
<img src="images/redux-set-token-action-devtools.png" alt="Redux DevTools with SET_TOKEN action" /><figcaption>Redux DevTools with SET_TOKEN action</figcaption>
</figure>
<p>Now, you need to tell Redux how to handle that action with a reducer.</p>
<h2 id="the-reducer">The reducer</h2>
<p>Somewhere in the <strong>src/store/authentication.js</strong> file, export a <code>reducer</code> function as the default value of the module. The <code>state</code> parameter gets a default value of an empty object because Redux does not like <code>undefined</code> values returned from reducers. Redux <em>will</em> call your reducer when it creates the store with <code>undefined</code> just to mess with you.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb191-1" title="1"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">reducer</span>(state <span class="op">=</span> <span class="op">{},</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb191-2" title="2">  <span class="co">// Your code in here.</span></a>
<a class="sourceLine" id="cb191-3" title="3"><span class="op">}</span></a></code></pre></div>
<p>In that reducer, you want to check if the "type" property of <code>action</code> is equal to the <code>SET_TOKEN</code> constant. Every reducer is called with every action, so you have to do this check. If it is, then you should return an object with the token in it. If it doesn’t, then just return the state unaltered. Idiomatic Redux usually uses a <code>switch</code> statement to do this with each <code>case</code> statement handling a different action type.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb192-1" title="1"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">reducer</span>(state <span class="op">=</span> <span class="op">{},</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb192-2" title="2">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb192-3" title="3">    <span class="cf">case</span> <span class="dt">SET_TOKEN</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb192-4" title="4">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb192-5" title="5">        ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb192-6" title="6">        <span class="dt">token</span><span class="op">:</span> <span class="va">action</span>.<span class="at">token</span><span class="op">,</span></a>
<a class="sourceLine" id="cb192-7" title="7">      <span class="op">};</span></a>
<a class="sourceLine" id="cb192-8" title="8">    <span class="op">}</span></a>
<a class="sourceLine" id="cb192-9" title="9"></a>
<a class="sourceLine" id="cb192-10" title="10">    <span class="cf">default</span><span class="op">:</span> <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb192-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb192-12" title="12"><span class="op">}</span></a></code></pre></div>
<h3 id="adding-the-reducer-to-the-store">Adding the reducer to the store</h3>
<p>Now that you have the reducer handling the action, you must add it to the reducer in <strong>src/store/configureStore.js</strong>. Open up that file and import the default value as <code>authentication</code> from the <strong>src/store/authentication.js</strong> module.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb193-1" title="1"><span class="im">import</span> authentication <span class="im">from</span> <span class="st">&#39;./authentication&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Then, in the <code>combineReducers</code> invocation, add <code>authentication</code> as a key and value.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb194-1" title="1"><span class="kw">const</span> reducer <span class="op">=</span> <span class="at">combineReducers</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb194-2" title="2">  authentication</a>
<a class="sourceLine" id="cb194-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>After the page reloads, when you click the <em>Login</em> button, you should now see the authentication and token appear in the right pane of the Redux DevTools. (You may need to select the action in the left pane.)</p>
<h2 id="using-the-token">Using the token</h2>
<p>Now, you’ve come full circle. You’re going to use the token in the store to inform the <code>LoginPanel</code> that it needs to close. In the <code>render</code> function, the code uses <code>this.state.token</code> to determine whether or not to redirect. You want that to use <code>this.props.token</code>, now, so change it to that.</p>
<p>To get the token value from the state of the Redux store into the <code>props</code>, you use <code>mapStateToProps</code> function that you created below. Change it to read like this, now, which takes the value of the token stored in the state and puts it into the "token" property of what will be passed to <code>LoginPanel</code> in its <code>props</code>.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb195-1" title="1"><span class="kw">const</span> mapStateToProps <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb195-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb195-3" title="3">    <span class="dt">token</span><span class="op">:</span> <span class="va">state</span>.<span class="va">authentication</span>.<span class="at">token</span><span class="op">,</span></a>
<a class="sourceLine" id="cb195-4" title="4">  <span class="op">};</span></a>
<a class="sourceLine" id="cb195-5" title="5"><span class="op">};</span></a></code></pre></div>
<p>Now, when you click the <em>Login</em> button, it redirects the application back to "/". However, because <code>App</code> relies on its own state to get updated from a call to its <code>updateToken</code> method, it goes into an recursive loop of redirecting back and forth between the <code>App</code> component and the <code>LoginPanel</code>. You’ll fix that in the next section.</p>
<hr />
<h1 id="more-state-moving">More State Moving</h1>
<p>The application is cleaner, but now has that bug of infinite redirecting. You will first fix that.</p>
<h2 id="fixing-the-loop">Fixing the loop</h2>
<p>In the <code>App</code> component, it would change state in response to the <code>LoginPanel</code> calling the <code>updateToken</code> method. The <code>LoginPanel</code> no longer does that because it dispatches its information to a thunk that makes the AJAX call and, in turns, dispatches an action that updates the Redux store. Then, <code>LoginPanel</code> uses the value from the store to no that something good has happened. You need to have <code>App</code> do the same.</p>
<p>Since <code>updateToken</code> is no longer used, remove the method and all of its uses from the <code>App</code> component.</p>
<p>When you have that done, you may notice that the route that shows the <code>LoginPanel</code> looks like this.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb196-1" title="1"><span class="op">&lt;</span>Route path<span class="op">=</span><span class="st">&quot;/login&quot;</span></a>
<a class="sourceLine" id="cb196-2" title="2">  render<span class="op">={</span>props <span class="kw">=&gt;</span> <span class="op">&lt;</span>LoginPanel <span class="op">{</span>...<span class="at">props</span><span class="op">}</span> /&gt;<span class="op">}</span> /&gt;</a></code></pre></div>
<p>That is rendering <code>LoginPanel</code> and passing its props to it. That’s just like using the "component" property of the <code>Route</code> component, so change it to use that instead of the more expensive "render" property.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb197-1" title="1"><span class="op">&lt;</span>Route path<span class="op">=</span><span class="st">&quot;/login&quot;</span> component<span class="op">={</span>LoginPanel<span class="op">}</span> /&gt;</a></code></pre></div>
<p>You’re still in a render loop, so that hasn’t fixed it. Time to connect <code>App</code> to the Redux store.</p>
<ol type="1">
<li>Like you did in <code>LoginPanel</code>, import the <code>connect</code> function from the "react-redux" module.</li>
<li>Then, just like you did in <code>LoginPanel</code>, declare <code>mapStateToProps</code> and <code>mapDispatchToProps</code> functions after the component.</li>
</ol>
<ul>
<li>In the <code>mapStateToProps</code> function, map the token to a property named "token" identically to the way it is done in <code>LoginPanel</code>.</li>
<li>You have no actions, right now, so leave <code>mapDispatchToProps</code> just returning an empty object.</li>
</ul>
<ol start="3" type="1">
<li>Finally, connect <code>App</code> to the Redux store using those functions.</li>
</ol>
<p>That puts the value of the token into the props. In the actual <code>App</code> component, now find everywhere that uses <code>this.state.token</code> and replace it with <code>this.props.token</code>.</p>
<p>Try logging in, again. Still doesn’t work. That’s because <code>App</code> relies on another setting in its state named "needLogin" which is just a Boolean value that is basically the opposite of whether the token has a value. If there is a token, there is no need to login. If there is no token, there is a need to login. You can figure that out in the <code>mapStateToProps</code> function! Create another property, one named "needLogin", in the object returned from the function. If there <em>is</em> a value in <code>state.authentication.token</code>, then set it to <code>false</code>. If there is <em>no</em> value (or an empty string) in <code>state.authentication.token</code>, then set "needLogin" to <code>true</code>. Once you have that, find every use of <code>this.state.needLogin</code> and replace it with <code>this.props.needLogin</code>.</p>
<p>You have now fixed the problem with the infinite redirects! And, once you log into the application, you can check that the <code>App</code> component <em>is</em> rendering the <code>PokemonBrowser</code> component. However, it is not showing anything. That’s because the <code>App</code> component calls its <code>loadPokemon</code> method in the <code>componentDidMount</code> method. There’s no token at that time in its state because the token now comes from Redux.</p>
<p>What would be great is if, after logging in, the <code>login</code> action loaded the Pokemon for you, put them in the store, and <code>PokemonBrowser</code> could just use them directly.</p>
<p>Oh, that’s what you’ll do next.</p>
<h2 id="getting-the-list-of-pokemon">Getting the list of Pokemon</h2>
<p>Now, you need some actions, thunks, and reducers for Pokemon, not authentication. Create a new file <strong>src/store/pokemon.js</strong>. In there, create the following items.</p>
<ul>
<li>An action type named <code>LOAD</code> with a value of ‘pokedex/pokemon/LOAD’</li>
<li>An action creator named <code>load</code> that takes in a list of Pokemon and creates an action with the type of <code>LOAD</code> and the list of Pokemon in it</li>
<li>A reducer that checks for the "LOAD" action and adds the list of Pokemon to the state (and returns just the state if the action is not "LOAD")</li>
<li>Make sure the reducer has a default value for its <code>state</code> parameter</li>
</ul>
<p>Now, you need to make a thunk that will make the AJAX call. Call your think "getPokemon". The thunk needs the token from the state to make its API call. The function that gets the "dispatch" parameter can also get a second parameter, a function conventionally called "getState". Your thunk could look like this.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb198-1" title="1"><span class="im">export</span> <span class="kw">const</span> getPokemon <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="kw">async</span> (dispatch<span class="op">,</span> getState) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb198-2" title="2">  <span class="kw">const</span> <span class="op">{</span> <span class="dt">authentication</span><span class="op">:</span> <span class="op">{</span> token <span class="op">}</span> <span class="op">}</span> <span class="op">=</span> <span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb198-3" title="3">  <span class="co">// AJAX call</span></a>
<a class="sourceLine" id="cb198-4" title="4">  <span class="co">// Handle response</span></a>
<a class="sourceLine" id="cb198-5" title="5"><span class="op">};</span></a></code></pre></div>
<p>Then, in <strong>configureStore.js</strong>, import the default reducer and add it to the <code>combineReducers</code> argument as the "pokemon" property next to "authentication".</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb199-1" title="1"><span class="kw">const</span> reducer <span class="op">=</span> <span class="at">combineReducers</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb199-2" title="2">  authentication<span class="op">,</span></a>
<a class="sourceLine" id="cb199-3" title="3">  pokemon<span class="op">,</span></a>
<a class="sourceLine" id="cb199-4" title="4"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Now, you just need to kick off that AJAX call. It seems only reasonable that the component that actually needs it kicks it off, the <code>PokemonBrowser</code> component. In <code>PokemonBrowser</code>, do the following:</p>
<ul>
<li>Import the <code>connect</code> function from "react-redux"</li>
<li>Import the <code>getPokemon</code> thunk you just created</li>
<li>Create a <code>mapStateToProps</code> function that maps the list of Pokemon from <code>state.pokemon.list</code> (or whatever you called your property in the reducer) to a property named "pokemon"</li>
<li>Create a <code>mapDispatchToProps</code> function that returns an object with a property named "getPokemon" that dispatches the <code>getPokemon</code> thunk you imported</li>
<li>Connect your component to the Redux store using <code>connect</code>, <code>mapStateToProps</code>, and <code>mapDispatchToProps</code></li>
<li>Add a <code>componentDidMount</code> method to the <code>PokemonBrowser</code> component and call <code>this.props.getPokemon()</code> from it</li>
</ul>
<p>Now, when you log into the application, you should see two actions in your Redux store!</p>
<figure>
<img src="https://www.programmableweb.com/" alt="Pokemon LOAD action in Redux DevTools" /><figcaption>Pokemon LOAD action in Redux DevTools</figcaption>
</figure>
<p>More importantly, you should see the list of Pokemon in the <code>PokemonBrowser</code> actually appear in the browser.</p>
<h2 id="clean-up-the-app-component">Clean up the App component</h2>
<p>Previously, all of the fetching logic for the list of Pokemon was handled by the <code>App</code> component. You can now get rid of the <code>loadPokemon</code> method and clean up any calls to it. Also, anywhere that refers to <code>this.state.pokemon</code> or using <code>setState</code> to update the "pokemon" property, you should get rid of all of that. This makes the <code>handleCreated</code> method empty, so get rid of that and all references to it, too, in the <code>App</code> component.</p>
<p>Because the <code>App</code> component doesn’t make any AJAX calls, anymore, it doesn’t need the token from the state. Remove the "token" property in <code>mapStateToProps</code> and everywhere <code>token</code> is used in the <code>App</code> component. Include the call to local storage, too, in the deleting of things. You can remove the import of <code>baseUrl</code>, too, because there are no AJAX calls in the file.</p>
<p>Now, because <code>cProps</code> in the <code>render</code> method is empty, delete it and its uses in the <code>PrivateRoute</code> components below it. Now that the code is not using <code>cProps</code>, you can delete the parameter and its use from the <code>PrivateRoute</code> component on line 8 (or so) of the <strong>src/App.js</strong> file.</p>
<h2 id="storing-the-token-in-local-storage">Storing the token in local storage</h2>
<p>Actions that use outside resources like AJAX calls and local storage <em>must</em> be created in thunks. Back in the <strong>src/store/authentication.js</strong> module, do two things:</p>
<ul>
<li>Create a constant named <code>TOKEN_KEY</code> and set it equal to some non-empty string</li>
<li>In the <code>login</code> thunk, between getting the token from the response and dispatching the <code>setToken</code> action, write the token to local storage using the constant <code>TOKEN_KEY</code></li>
</ul>
<h2 id="reading-the-token-out-of-local-storage">Reading the token out of local storage</h2>
<p>You need a new thunk to do this. Create a thunk named <code>loadToken</code> that takes no parameters, and returns a function that accepts a "dispatch" parameter. Then, implement it to read the value from local storage using the <code>TOKEN_KEY</code> constant. If a value comes back, have it dispatch the <code>setToken</code> action.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb200-1" title="1"><span class="im">export</span> <span class="kw">const</span> loadToken <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="kw">async</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb200-2" title="2">  <span class="co">// Read the token from local</span></a>
<a class="sourceLine" id="cb200-3" title="3"><span class="op">};</span></a></code></pre></div>
<p>In the <code>App</code> component, import the <code>loadToken</code> thunk. Use it in the <code>mapDispatchToProps</code> by mapping the dispatch of the <code>loadToken</code> thunk to a property of the same name.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb201-1" title="1"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb201-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb201-3" title="3">    <span class="dt">loadToken</span><span class="op">:</span> () <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">loadToken</span>())<span class="op">,</span></a>
<a class="sourceLine" id="cb201-4" title="4">  <span class="op">};</span></a>
<a class="sourceLine" id="cb201-5" title="5"><span class="op">};</span></a></code></pre></div>
<p>Invoke that <code>loadToken</code> method in the <code>componentDidMount</code> method of the <code>App</code> component.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb202-1" title="1"><span class="kw">async</span> <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb202-2" title="2">  <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span> <span class="dt">loaded</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb202-3" title="3">  <span class="kw">this</span>.<span class="va">props</span>.<span class="at">loadToken</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb202-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>The moment you do that, the page should refresh and you should see the Pokemon browser rather than the login form.</p>
<p>You’re halfway home!</p>
<hr />
<h1 id="making-decisions-about-state">Making Decisions About State</h1>
<p>Now, it’s time to log out of the application. Do that with the following steps.</p>
<p>The steps that the application will take are these:</p>
<ol type="1">
<li>Someone clicks the logout button</li>
<li>The <code>LogoutButton</code> component dispatches a thunk</li>
<li>The thunk makes the AJAX call to logout</li>
<li>If that AJAX call succeeds, remove the token from local storage and dispatch an action to remove the token from the store</li>
<li>Redux will invoke a reducer that removes the token from the store</li>
<li>The <code>LogoutButton</code> will redirect the application back to "/login"</li>
</ol>
<p>In <strong>src/store/authentication.js</strong>:</p>
<ul>
<li>Create a new action type named <code>REMOVE_TOKEN</code></li>
<li>Create a new action creator that returns an action with just the "type" property set to the value of <code>REMOVE_TOKEN</code></li>
<li>Create a thunk named <code>logout</code> that
<ul>
<li>makes an AJAX call to the API to <code>DELETE /api/session</code> (using the token in the state)</li>
<li>if the response is ok, then
<ul>
<li>removes the item from local storage with the key <code>TOKEN_KEY</code></li>
<li>dispatches the <code>removeToken</code> action</li>
</ul></li>
</ul></li>
<li><p>Handles the <code>REMOVE_TOKEN</code> action type in the reducer by creating a new object that does <em>not</em> have the "token" key in it and returning that.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb203-1" title="1"><span class="cf">case</span> REMOVE_TOKEN<span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb203-2" title="2">  <span class="kw">const</span> newState <span class="op">=</span> <span class="op">{</span> ...<span class="at">state</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb203-3" title="3">  <span class="kw">delete</span> <span class="va">newState</span>.<span class="at">token</span><span class="op">;</span></a>
<a class="sourceLine" id="cb203-4" title="4">  <span class="cf">return</span> newState<span class="op">;</span></a>
<a class="sourceLine" id="cb203-5" title="5"><span class="op">}</span></a></code></pre></div>
<p>Remember that handlers in reducers <em>must</em> return new objects if they want to modify the state.</p></li>
</ul>
<p>In <strong>src/LogoutButton.js</strong>:</p>
<p>(If you make a mistake with this and get into an inconsistent state, just delete all of the contents of your local storage and refresh your browser.)</p>
<ul>
<li>Import <code>connect</code> from "react-redux"</li>
<li>Import the <code>logout</code> thunk you just created</li>
<li>Create the <code>mapStateToProps</code> and set a property named <code>loggedOut</code> to <code>true</code> if the token in the state is empty, and <code>false</code> if there is a value for the token in the state</li>
<li>Create the <code>mapDispatchToProps</code> and set the "logout" property equal to a function that dispatches the result of the <code>logout</code> thunk you imported</li>
<li>In the <code>LogoutButton</code>’s method named "logout", instead of making an AJAX call, have it call <code>this.props.logout()</code>, instead</li>
<li>Get rid of the</li>
<li>Get rid of initializing the state in the constructor</li>
<li>Change the use of <code>this.state.loggedOut</code> to <code>this.props.loggedOut</code></li>
<li>Remove any unused imports</li>
</ul>
<p>If you check the console, now, you’ll see that Babel is reporting a "useless" constructor. Sure enough, it is. <code>LogoutButton</code> no longer has any state, so there’s no reason to leave it as a class-based component. Convert it to a function-based component. If you’ve followed these instructions, your <code>LogoutButton</code> should end up looking something like this.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb204-1" title="1"><span class="kw">const</span> LogoutButton <span class="op">=</span> props <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb204-2" title="2">  <span class="va">props</span>.<span class="at">loggedOut</span> <span class="op">?</span></a>
<a class="sourceLine" id="cb204-3" title="3">    <span class="op">&lt;</span>Redirect to<span class="op">=</span><span class="st">&quot;/login&quot;</span> /&gt; :</a>
<a class="sourceLine" id="cb204-4" title="4">    <span class="op">&lt;</span>div id<span class="op">=</span><span class="st">&quot;logout-button-holder&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb204-5" title="5">      <span class="op">&lt;</span>button onClick<span class="op">={</span><span class="va">props</span>.<span class="at">logout</span><span class="op">}&gt;</span>Logout&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb204-6" title="6">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb204-7" title="7"><span class="op">;</span></a></code></pre></div>
<hr />
<h1 id="the-rest-of-it">The Rest Of It</h1>
<p>You have now been given instructions on how to refactor components from managing global application state to putting it in Redux. There are two more pieces left, the "select the current Pokemon" functionality and the "create a new Pokemon" functionality. Refactor the application so those are Redux-supported, as well.</p>
<h2 id="select-the-current-pokemon">Select the current Pokemon</h2>
<p>The place to start, here, is to determine how the click of the navigation item on the left gets handled. It’s a <code>NavLink</code>, so the <code>BrowserRouter</code> in the <code>App</code> component handles that by routing to the <code>PokemonBrowser</code> with the route parameters. The <code>PokemonBrowser</code> then routes to the <code>PokemonDetail</code> with a <code>Route</code> component. In the <code>PokemonDetail</code> component, if the value of the <code>this.props.match.params.id</code> changes, then the <code>loadPokemon</code> method is called which, in turn, makes an AJAX call. And, there it is! The AJAX call.</p>
<p>This is like everything else, create a thunk, an action type, yada yada yada.</p>
<ul>
<li>Create a thunk (similar to what you did for logging in) to load the current Pokemon that
<ul>
<li>accepts an id</li>
<li>loads the Pokemon from an AJAX call</li>
<li>dispatches a "set current Pokemon" action</li>
</ul></li>
<li>Create a reducer that handles the "set current Pokemon" action by adding it to the state</li>
<li>Connect the <code>PokemonDetail</code> to the Redux store by
<ul>
<li>mapping the current Pokemon information in the state to its props, and</li>
<li>mapping the "load the current Pokemon" thunk to its props with a <code>dispatch</code> call (don’t forget the id parameter)</li>
</ul></li>
</ul>
<h2 id="creating-a-new-pokemon">Creating a new Pokemon</h2>
<p>This is very similar to the login stuff you did with <code>LoginPanel</code>. In the <code>PokemonForm</code>, have</p>
<ul>
<li>the <code>componentDidMount</code> method call a thunk to load the Pokemon types</li>
<li>the <code>handleSubmit</code> method call a thunk to post the form information to the API</li>
</ul>
<p>In moving the Pokemon type fetching from the state to the props, you may end up getting an error that there is no method "map" of undefined. If that’s the case, in the reducer in your <strong>src/store/pokemon.js</strong> file, have the default state include an array for the "types" property.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb205-1" title="1"><span class="co">// CODE SNIPPET</span></a>
<a class="sourceLine" id="cb205-2" title="2"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">reducer</span>(state <span class="op">=</span> <span class="op">{</span> <span class="dt">types</span><span class="op">:</span> [] <span class="op">},</span> action) <span class="op">{</span></a></code></pre></div>
<p>That’s the power of default parameters and initial state!</p>
<p>The action types, action creators, and thunk created to do this should go into the <strong>src/store/pokemon.js</strong> module. When the AJAX call succeeds to create the new Pokemon, have it <em>then</em> dispatch the <code>getPokemon</code> thunk to get a new list of Pokemon. Redux and React will add a new Pokemon to the end of the list. That’s why you have to provide the "key" property in lists of things, so that React will efficiently determine if something in the list needs to get changed, added, or deleted.</p>
<p>The only "new" part, here, is the coordination between <code>PokemonForm</code> and <code>PokemonBrowser</code> to determine if it should show a form. This is up to you to decide, if showing the create form is part of the global application state (and should exist in the Redux store), or if it is part of the "local" state between the two components and be managed by <code>PokemonForm</code> invoking a function passed to it by <code>PokemonBrowser</code>. The solution choose the former solution.</p>
<h2 id="bonus-extend-the-functionality">Bonus: Extend the functionality</h2>
<p>Think about adding</p>
<ul>
<li>A <em>Cancel</em> button on the form that hides it</li>
<li>Error messages for the forms when something bad happens</li>
</ul>
<h2 id="bonus-connected-react-router">Bonus: Connected React Router</h2>
<p>Rather than relying on <code>Redirect</code> routes in your application, you can use actions to manage the URL of your application. Install <a href="https://www.programmableweb.com/">Connected React Router</a> and remove all <code>Redirect</code> components from the application, replacing them with dispatched <code>push</code> actions. Check out the <a href="https://material-ui.com/">How to navigation with Redux action</a> article in the Connected React Router documentation.</p>
<hr />
<h1 id="giphy-search-project">Giphy Search Project</h1>
<p>Today’s project will help you become more comfortable with the full Redux cycle! You will build out a single Redux cycle for a Giphy search tool.</p>
<p>When a user enters a search query, a fetch action will use the search endpoint from the Giphy API to return the fetch response. The action will then be dispatched to update the application’s global state provided by the Redux store. Your application will then use a slice of state to render an index of GIF results.</p>
<p>Your completed project will look something like this:</p>
<figure>
<img src="https://-open-assets.s3-us-west-1.amazonaws.com/Modular-Curriculum/content/react-redux/topics/react-hooks/assets/giphy-search.gif" alt="giphy-search" /><figcaption>giphy-search</figcaption>
</figure>
<h2 id="phase-0-set-up-the-project">Phase 0: Set up the project</h2>
<p>You’ll begin by cloning this repository containing basic skeleton files and the conventional frontend folders (<code>actions</code>, <code>components</code>, <code>reducers</code>, and <code>util</code>).</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb206-1" title="1"><span class="fu">git</span> clone https://github.com/-starters/react-redux-giphy-starter.git</a></code></pre></div>
<p>Take a moment to familiarize yourself with the file structure. Look inside all the frontend files and note the <code>TODO</code> notes in each file skeleton. Throughout the next phases of the project, you’ll finish all the tasks listed in the <code>TODO</code> notes to create your very own Giphy search app!</p>
<p>After you have reviewed the <code>TODO</code> notes, run <code>npm install</code> to install your application’s packages. Note that you have <code>redux</code>, <code>react-redux</code>, <code>redux-thunk</code>, and <code>redux-logger</code> already listed as dependencies in your project’s <code>package.json</code> file. You’ll use Redux <code>thunk</code> as middleware to connect (or <em>dispatch</em>) your fetch results into the Redux store. You’ll use Redux <code>logger</code> as middleware to automatically console log your dispatched actions.</p>
<h3 id="component-overview">Component overview</h3>
<p>Now that you’re acquainted with the file structure, let’s map out an overview of the component hierarchy:</p>
<pre><code>Root
  AppContainer
    App
      SearchBar
      Gifs</code></pre>
<ul>
<li>The <code>Root</code> component is responsible for providing the component tree with the Redux <code>store</code>. It renders the <code>AppContainer</code>.</li>
<li>The <code>AppContainer</code> passes the <code>gifs</code> slice of state and the dispatched <code>fetchGifs</code> action creator as props to the <code>App</code> component. It wraps the <code>App</code> component to connect the component to the Redux store.</li>
<li>The <code>App</code> component renders the <code>GifsList</code> and the <code>SearchBar</code>. It uses its <code>gifs</code> prop (passed into <code>App</code> through <code>mapStateToProps</code>) to create and pass a <code>gifUrls</code> array as a prop to the <code>GifsList</code>. It also uses its <code>fetchGifs</code> prop (passed into <code>App</code> through <code>mapDispatchToProps</code>) as a prop to the <code>SearchBar</code> component.</li>
<li>The <code>SearchBar</code> component handles all of the search logic (keeping track of the query and triggering the fetch request on submit).</li>
<li>The <code>GifsList</code> component iterates over its <code>gifUrls</code> prop, to render an image for each one.</li>
</ul>
<h3 id="giphy-api-key">Giphy API key</h3>
<p>Before you start, let’s create a Giphy API Key to use in your fetch requests to the Giphy API. Get started by <a href="https://giphy.com/join">creating a Giphy account</a>. Then navigate to the <a href="https://developers.giphy.com/docs/api/#quick-start-guide">Giphy API Quick Start Guide</a> and click <code>Create an App</code>.</p>
<p>Fill out the form for creating a new app, and only check the option for <code>I only want to use the GIPHY API</code>.</p>
<figure>
<img src="https://assets.aaonline.io/fullstack/react/assets/giphy_api_key.png" alt="Giphy Example" /><figcaption>Giphy Example</figcaption>
</figure>
<p>Once you’ve submitted the form, you’ll be taken to a dashboard, and under the <code>Your Apps</code> section, you should see your newly created app with an API Key that you will use for this project. As a reminder, API keys normally shouldn’t be stored in client-side JavaScript. You would normally want to store the keys in your server-side code. To keep this project a simple, front-end only project, you’ll store the API key in a front-end environment variable for convenience. Take a moment to create an <code>.env</code> file in the root of your project and set an environment variable with your API key, like so:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb208-1" title="1">REACT_APP_GIPHY_API_KEY<span class="op">=&lt;&lt;</span>YOUR API KEY<span class="op">&gt;&gt;</span></a></code></pre></div>
<p>Notice that your <code>config.js</code> file is already exporting your <code>REACT_APP_GIPHY_API_KEY</code> environment variable as <code>apiKey</code>:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb209-1" title="1"><span class="im">export</span> <span class="kw">const</span> apiKey <span class="op">=</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">REACT_APP_GIPHY_API_KEY</span></a></code></pre></div>
<p>This means that you can import the API key from any of your frontend components with the following import statement:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb210-1" title="1"><span class="im">import</span> <span class="op">{</span> apiKey <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../config&#39;</span><span class="op">;</span></a></code></pre></div>
<h2 id="phase-1-fetch-data-in-the-redux-cycle">Phase 1: Fetch data in the Redux cycle</h2>
<p>Before you begin to build the project, it’s important to think about the state shape. You know that you want to display GIF results returned by a fetch request. This means you’ll probably want a <code>gifs</code> slice of the state that holds a collection of <code>gif</code> objects.</p>
<h3 id="state-shape">State shape</h3>
<div class="sourceCode" id="cb211"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb211-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb211-2" title="2">  <span class="dt">gifs</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb211-3" title="3">    <span class="co">// gif objects  </span></a>
<a class="sourceLine" id="cb211-4" title="4">  ]</a>
<a class="sourceLine" id="cb211-5" title="5"><span class="op">}</span></a></code></pre></div>
<p>As a reminder, you pass the <code>gifs</code> slice of state as a prop to the <code>App</code> component in the <code>AppContainer</code> through the <code>mapStateToProps</code> function.</p>
<h3 id="api-util">API util</h3>
<p>The first part of creating your Redux cycle for fetching GIFs is creating a fetch request that will be connected to a <em>thunk action creator</em>. Define and export a <code>fetchGifs</code> function in the <code>apiUtil.js</code> file. This function will make a fetch call to the Giphy API’s search endpoint.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb212-1" title="1"><span class="co">// apiUtil.js</span></a>
<a class="sourceLine" id="cb212-2" title="2"><span class="im">import</span> <span class="op">{</span> apiKey <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../config&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb212-3" title="3"></a>
<a class="sourceLine" id="cb212-4" title="4"><span class="im">export</span> <span class="kw">const</span> fetchGifs <span class="op">=</span> searchTerm <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb212-5" title="5">  <span class="co">// </span><span class="al">TODO</span><span class="co">: Write a fetch call to the Giphy API&#39;s search endpoint</span></a>
<a class="sourceLine" id="cb212-6" title="6">)</a></code></pre></div>
<p>It will take a single argument, the <code>searchQuery</code> entered by a user. You can check out the <a href="https://github.com/Giphy/GiphyAPI">Giphy API docs</a> for more details, but in short, you want to make a fetch request to the following endpoint:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb213-1" title="1"><span class="vs">`http://api.giphy.com/v1/gifs/search?api_key=</span><span class="sc">${</span>apiKey<span class="sc">}</span><span class="vs">&amp;q=</span><span class="sc">${</span>searchTerm<span class="sc">}</span><span class="vs">&amp;limit=3`</span></a></code></pre></div>
<p>The <code>searchQuery</code> will be replaced with your user’s actual query. You should tag <code>&amp;limit=3</code> onto the end of your query string to tell Giphy you only want three GIF responses. The Giphy API is relatively slow, so keeping the response size down helps optimize your application’s performance.</p>
<p>Remember, it’s best to test small pieces as we go. Let’s test out that fetch request from your developer tools console to make sure it’s doing what you’re intending.</p>
<p>You may need to restart your server to have your application process the environment variables set in your <code>.env</code> file.</p>
<p>Import your <code>fetchGifs</code> function to the entry <code>index.js</code> file, then go ahead and put it on the window so we have access to it in the console:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb214-1" title="1"><span class="co">// index.js</span></a>
<a class="sourceLine" id="cb214-2" title="2"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb214-3" title="3"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb214-4" title="4"><span class="im">import</span> Root <span class="im">from</span> <span class="st">&#39;./components/Root&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb214-5" title="5"><span class="im">import</span> <span class="op">{</span> fetchGifs <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./util/apiUtil&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb214-6" title="6"></a>
<a class="sourceLine" id="cb214-7" title="7"><span class="va">window</span>.<span class="at">fetchGifs</span> <span class="op">=</span> fetchGifs<span class="op">;</span></a>
<a class="sourceLine" id="cb214-8" title="8"></a>
<a class="sourceLine" id="cb214-9" title="9"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb214-10" title="10">  <span class="op">&lt;</span><span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb214-11" title="11">    <span class="op">&lt;</span>Root /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb214-12" title="12">  &lt;/<span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb214-13" title="13">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;root&quot;</span>)</a>
<a class="sourceLine" id="cb214-14" title="14">)<span class="op">;</span></a></code></pre></div>
<p>Try running this test code:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb215-1" title="1"><span class="at">fetchGifs</span>(<span class="st">&#39;puppy&#39;</span>).<span class="at">then</span>(res <span class="kw">=&gt;</span> <span class="va">res</span>.<span class="at">json</span>()).<span class="at">then</span>(res <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(<span class="va">res</span>.<span class="at">data</span>))<span class="op">;</span></a></code></pre></div>
<p>This will make the fetch request, which will return a promise. You’ll chain on a <code>.then</code> to parse the response and log the parsed response data. You should see an array of three objects. Those are your gif objects fetched from the Giphy API! Make sure you get this working before moving on, and don’t forget to remove <code>fetchGifs</code> from the window once you’re done testing.</p>
<h2 id="phase-2-redux-actions">Phase 2: Redux actions</h2>
<p>Next, you’ll set up an <a href="https://redux.js.org/basics/actions">action</a> to properly receive GIF payload information (your fetch responses). As always, you want to export constants for your action types set to strings of your action types. As a reminder, this is to prevent bugs from mistyping your action types.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb216-1" title="1"><span class="im">export</span> <span class="kw">const</span> RECEIVE_GIFS <span class="op">=</span> <span class="st">&#39;RECEIVE_GIFS&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Now it’s time to write a function that returns your <code>action</code>, an object literal. Write <code>receiveGifs</code> as a function that takes in <code>gifs</code> data as a parameter and returns an action object. The object should have two keys: one for the <code>type</code> and another for the <code>gifs</code> data. Your function should look like the following:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb217-1" title="1"><span class="kw">const</span> receiveGifs <span class="op">=</span> gifs <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb217-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb217-3" title="3">    <span class="dt">type</span><span class="op">:</span> RECEIVE_GIFS<span class="op">,</span></a>
<a class="sourceLine" id="cb217-4" title="4">    gifs</a>
<a class="sourceLine" id="cb217-5" title="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb217-6" title="6"><span class="op">};</span></a></code></pre></div>
<p>Before testing this action creator, you’ll need a reducer.</p>
<h3 id="gifsreducer">gifsReducer</h3>
<p>Let’s write a switch case and default switch return in your <code>gifsReducer.js</code> file. Note that the <code>gifsReducer</code> function receives the previous <code>state</code> and an <code>action</code>. Recall that a reducer describes how a slice of state should change based on a dispatched action. It should always return the new state without mutating the previous state. If the action dispatched to the reducer should not change the state, the reducer should return the previous <code>state</code> by default. You will need to import the <code>RECEIVE_GIFS</code> constant from your <code>gifActions.js</code> file.</p>
<p>Your reducer should look similar to the this one:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb218-1" title="1"><span class="co">// </span><span class="al">TODO</span><span class="co">: Import the `RECEIVE_GIFS` constant</span></a>
<a class="sourceLine" id="cb218-2" title="2"></a>
<a class="sourceLine" id="cb218-3" title="3"><span class="kw">const</span> gifsReducer <span class="op">=</span> (state <span class="op">=</span> []<span class="op">,</span> action) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb218-4" title="4">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb218-5" title="5">    <span class="co">// </span><span class="al">TODO</span><span class="co">: Return the GIFs from the action object if the action type is `RECEIVE_GIFS`</span></a>
<a class="sourceLine" id="cb218-6" title="6">    <span class="co">// </span><span class="al">TODO</span><span class="co">: Return the previous state by default</span></a>
<a class="sourceLine" id="cb218-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb218-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb218-9" title="9"></a>
<a class="sourceLine" id="cb218-10" title="10"><span class="im">export</span> <span class="im">default</span> gifsReducer<span class="op">;</span></a></code></pre></div>
<h3 id="rootreducer">rootReducer</h3>
<p>Recall the state shape you saw earlier in the project instructions. The <code>gifsReducer</code> above should control the <code>gifs</code> slice of the application state. You’ll create and export a <code>rootReducer</code> with Redux’s <code>combineReducers</code> function to assign control of different slices of state to their prospective reducer functions to create the application state structure.</p>
<p>This project only needs one reducer, but using <code>combineReducers</code> would allow you to easily add more state slices in the future.</p>
<p>The <code>combineReducers</code> function has already been imported for you. Take a moment to import your <code>gifsReducer</code> and set the <code>gifs</code> slice of state to its reducer, like so:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb219-1" title="1">gifs<span class="op">:</span> gifsReducer<span class="op">,</span></a></code></pre></div>
<p>Now that you have your reducers set up to structure your application’s global state, you’ll need to set up the Redux store to hold that global state.</p>
<h2 id="phase-3-the-redux-store">Phase 3: The Redux store</h2>
<p>The store holds the global state of an application, so you’ll need to create it before you can test your reducer. Remember that Redux provides a <code>createStore</code> function that receives a <code>reducer</code>, optional <code>preloadedState</code>, and an optional <code>enhancer</code>. Begin by writing a <code>configureStore</code> function that passes your <code>rootReducer</code> to <code>createStore</code>.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb220-1" title="1"><span class="co">// store.js</span></a>
<a class="sourceLine" id="cb220-2" title="2"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb220-3" title="3"><span class="co">// </span><span class="al">TODO</span><span class="co">: Import middleware</span></a>
<a class="sourceLine" id="cb220-4" title="4"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb220-5" title="5"></a>
<a class="sourceLine" id="cb220-6" title="6"><span class="kw">const</span> configureStore <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb220-7" title="7">  <span class="cf">return</span> <span class="at">createStore</span>(rootReducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb220-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb220-9" title="9"></a>
<a class="sourceLine" id="cb220-10" title="10"><span class="im">export</span> <span class="im">default</span> configureStore<span class="op">;</span></a></code></pre></div>
<p>Import <code>configureStore</code> into your entry <code>index.js</code> file, then use the function to generate the Redux store.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb221-1" title="1"><span class="kw">const</span> store <span class="op">=</span> <span class="at">configureStore</span>()<span class="op">;</span></a></code></pre></div>
<p>Now you’ll work on providing the store you have generated to your application’s components! Begin by passing the <code>store</code> you’ve generated as a prop to the <code>Root</code> component. Your <code>index.js</code> file should look something like this:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb222-1" title="1"><span class="co">// index.js</span></a>
<a class="sourceLine" id="cb222-2" title="2"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb222-3" title="3"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb222-4" title="4"><span class="im">import</span> Root <span class="im">from</span> <span class="st">&#39;./components/Root&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb222-5" title="5"><span class="im">import</span> configureStore <span class="im">from</span> <span class="st">&#39;./store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb222-6" title="6"><span class="im">import</span> <span class="op">{</span> fetchGifs <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./util/apiUtil&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb222-7" title="7"></a>
<a class="sourceLine" id="cb222-8" title="8"><span class="va">window</span>.<span class="at">fetchGifs</span> <span class="op">=</span> fetchGifs<span class="op">;</span></a>
<a class="sourceLine" id="cb222-9" title="9"><span class="kw">const</span> store <span class="op">=</span> <span class="at">configureStore</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb222-10" title="10"></a>
<a class="sourceLine" id="cb222-11" title="11"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb222-12" title="12">  <span class="op">&lt;</span><span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb222-13" title="13">    <span class="op">&lt;</span>Root store<span class="op">={</span>store<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb222-14" title="14">  &lt;/<span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb222-15" title="15">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;root&#39;</span>)</a>
<a class="sourceLine" id="cb222-16" title="16">)<span class="op">;</span></a></code></pre></div>
<p>Now go into your <code>Root.js</code> file and import <code>Provider</code> from <code>react-redux</code>. Use the <code>Provider</code> component to set the Redux store through the <code>Provider</code> component’s expected <code>store</code> prop. Remember how you have just configured and passed a <code>store</code> as a prop to the <code>Root</code> component in your entry file (<code>index.js</code>). Use the <code>Root</code> component’s <code>store</code> prop to set the <code>store</code> prop of the <code>Provider</code>:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb223-1" title="1"><span class="co">// Root.js</span></a>
<a class="sourceLine" id="cb223-2" title="2"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb223-3" title="3"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb223-4" title="4"><span class="im">import</span> App <span class="im">from</span> <span class="st">&#39;./App&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb223-5" title="5"></a>
<a class="sourceLine" id="cb223-6" title="6"><span class="kw">const</span> Root <span class="op">=</span> (<span class="op">{</span> store <span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb223-7" title="7">  <span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb223-8" title="8">    <span class="op">&lt;</span>App /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb223-9" title="9">  &lt;/Provider<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb223-10" title="10">)<span class="op">;</span></a>
<a class="sourceLine" id="cb223-11" title="11"></a>
<a class="sourceLine" id="cb223-12" title="12"><span class="im">export</span> <span class="im">default</span> Root<span class="op">;</span></a></code></pre></div>
<p>Now that you have configured your Redux store and tested your <code>fetchGifs</code> function, let’s connect the function to the store to implement a full Redux cycle. In the next phase, you’ll define a <em>thunk action creator</em> function and use the <code>thunk</code> middleware so that each fetch response is dispatched as a change to the global application <code>state</code>.</p>
<h2 id="phase-4-thunk-middleware">Phase 4: Thunk middleware</h2>
<p>Let’s refactor how you fetch GIFs by using a thunk action creator. Recall that we use a <em>thunk action creator</em> to return a function. When that function is called with an argument of <code>dispatch</code>, the function can dispatch additional actions.</p>
<p>Begin by refactoring your <code>configureStore</code> function in the <code>store.js</code> file to incorporate your thunk middleware. Remember that Redux provides <code>thunk</code> middleware from the <code>redux-thunk</code> module. Import the <code>thunk</code> middleware and <code>applyMiddleware</code> function from Redux. You’ll use the <code>applyMiddleware</code> function, with your <code>thunk</code> middleware as an argument, to set the optional <code>enhancer</code> argument in the <code>createStore</code> function:</p>
<p>Your <code>store.js</code> file should now include the following:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb224-1" title="1"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb224-2" title="2"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">&#39;redux-thunk&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb224-3" title="3"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb224-4" title="4"></a>
<a class="sourceLine" id="cb224-5" title="5"><span class="kw">const</span> configureStore <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb224-6" title="6">  <span class="cf">return</span> <span class="at">createStore</span>(rootReducer<span class="op">,</span> <span class="at">applyMiddleware</span>(thunk))<span class="op">;</span></a>
<a class="sourceLine" id="cb224-7" title="7"><span class="op">};</span></a>
<a class="sourceLine" id="cb224-8" title="8"></a>
<a class="sourceLine" id="cb224-9" title="9"><span class="im">export</span> <span class="im">default</span> configureStore<span class="op">;</span></a></code></pre></div>
<p>Now your Redux cycle is almost good to go! To summarize your progress to this point, you have configured your Redux store, provided the store to your application, written a fetch function in a util file, defined an action type, and defined an action creator.</p>
<p>The last step is to define a <em>thunk action creator</em> that will dispatch the <code>receiveGifs</code> action after the Giphy API call is successful!</p>
<p>Begin by importing your API util function into your <code>gifActions.js</code> file. Since you want to easily associate your <em>thunk action creators</em> with a specific action, and you’ll often have more than one function exported from your util file, use a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import#Description">namespace</a> to import your fetch function:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb225-1" title="1"><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> APIUtil <span class="im">from</span> <span class="st">&#39;../util/apiUtil&#39;</span><span class="op">;</span></a></code></pre></div>
<p>You would then invoke your <code>fetchGifs</code> function in your <code>apiUtil.js</code> file like so:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb226-1" title="1"><span class="va">APIUtil</span>.<span class="at">fetchGifs</span>(searchQuery)<span class="op">;</span></a></code></pre></div>
<p>Now it’s time to write your <em>thunk action creator</em>! Define and export a function named <code>fetchGifs</code> that receives a search term and returns a function that can be called with <code>dispatch</code>. Your function will use a promise to parse the fetch response to JSON and dispatch the <code>receiveGifs</code> action with the fetch response data after the <code>APIUtil.fetchGifs</code> call is successful.</p>
<p>Your <em>thunk action creator</em> should look like the following:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb227-1" title="1"><span class="im">export</span> <span class="kw">const</span> fetchGifs <span class="op">=</span> searchTerm <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb227-2" title="2">  <span class="cf">return</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb227-3" title="3">    <span class="cf">return</span> <span class="va">APIUtil</span>.<span class="at">fetchGifs</span>(searchTerm)</a>
<a class="sourceLine" id="cb227-4" title="4">      .<span class="at">then</span>(res <span class="kw">=&gt;</span> <span class="va">res</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb227-5" title="5">      .<span class="at">then</span>(res <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">receiveGifs</span>(<span class="va">res</span>.<span class="at">data</span>)))<span class="op">;</span></a>
<a class="sourceLine" id="cb227-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb227-7" title="7"><span class="op">};</span></a></code></pre></div>
<p>Or you can clean up the function by using implicit returns with ES6 arrow functions:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb228-1" title="1"><span class="im">export</span> <span class="kw">const</span> fetchGifs <span class="op">=</span> searchTerm <span class="kw">=&gt;</span> dispatch <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb228-2" title="2">  <span class="va">APIUtil</span>.<span class="at">fetchGifs</span>(searchTerm)</a>
<a class="sourceLine" id="cb228-3" title="3">    .<span class="at">then</span>(res <span class="kw">=&gt;</span> <span class="va">res</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb228-4" title="4">    .<span class="at">then</span>(res <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">receiveGifs</span>(<span class="va">res</span>.<span class="at">data</span>)))</a>
<a class="sourceLine" id="cb228-5" title="5">)<span class="op">;</span></a></code></pre></div>
<h2 id="phase-5-test-your-thunk-action-creator">Phase 5: Test your thunk action creator</h2>
<p>Let’s take a moment to test your the <code>fetchGifs</code> <em>thunk action creator</em> you just defined.</p>
<p>Import <code>fetchGifs</code> from your <code>gifActions.js</code> file to your entry <code>index.js</code> file. You’ll hit the error <code>Parsing error: Identifier 'fetchGifs' has already been declared</code> since have already imported the <code>fetchGifs</code> function from your <code>apiUtil.js</code> file. Note that this is why using a namespace to <code>import * as APIUtil</code> from your <code>apiUtil.js</code> file is important.</p>
<p>Update the import statement from your <code>./util/apiUtil.js</code> file with a namespace:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb229-1" title="1"><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> APIUtil <span class="im">from</span> <span class="st">&#39;./util/apiUtil&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Now you’ll want to put your fetch function, thunk action creator, and Redux store on the window. This way you can view your application’s global state and compare the result of your fetch function and the dispatched thunk action creator:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb230-1" title="1"><span class="co">// index.js</span></a>
<a class="sourceLine" id="cb230-2" title="2"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb230-3" title="3"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb230-4" title="4"><span class="im">import</span> Root <span class="im">from</span> <span class="st">&#39;./components/Root&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb230-5" title="5"><span class="im">import</span> configureStore <span class="im">from</span> <span class="st">&#39;./store&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb230-6" title="6"><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> APIUtil <span class="im">from</span> <span class="st">&#39;./util/apiUtil&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb230-7" title="7"><span class="im">import</span> <span class="op">{</span> fetchGifs <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./actions/gifActions&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb230-8" title="8"></a>
<a class="sourceLine" id="cb230-9" title="9"><span class="kw">const</span> store <span class="op">=</span> <span class="at">configureStore</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb230-10" title="10"><span class="va">window</span>.<span class="at">apiFetchGifs</span> <span class="op">=</span> <span class="va">APIUtil</span>.<span class="at">fetchGifs</span><span class="op">;</span></a>
<a class="sourceLine" id="cb230-11" title="11"><span class="va">window</span>.<span class="at">fetchGifs</span> <span class="op">=</span> fetchGifs<span class="op">;</span></a>
<a class="sourceLine" id="cb230-12" title="12"><span class="va">window</span>.<span class="at">store</span> <span class="op">=</span> store<span class="op">;</span></a>
<a class="sourceLine" id="cb230-13" title="13"></a>
<a class="sourceLine" id="cb230-14" title="14"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb230-15" title="15">  <span class="op">&lt;</span><span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb230-16" title="16">    <span class="op">&lt;</span>Root store<span class="op">={</span>store<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb230-17" title="17">  &lt;/<span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb230-18" title="18">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;root&#39;</span>)</a>
<a class="sourceLine" id="cb230-19" title="19">)<span class="op">;</span></a></code></pre></div>
<p>Now you’ll use the <code>getState()</code> and <code>dispatch(action)</code> <a href="https://redux.js.org/api/store">store methods</a> to view and update your application’s global state. Try the following code in the browser’s console before continuing to the next phase:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb231-1" title="1"> <span class="co">// Return the initial application state</span></a>
<a class="sourceLine" id="cb231-2" title="2"><span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb231-3" title="3"></a>
<a class="sourceLine" id="cb231-4" title="4"><span class="co">// Use the thunk action creator to dispatch the fetch response and populate state</span></a>
<a class="sourceLine" id="cb231-5" title="5"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">fetchGifs</span>(<span class="st">&#39;puppy&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb231-6" title="6"></a>
<a class="sourceLine" id="cb231-7" title="7"><span class="co">// Return the application state populated with GIFs</span></a>
<a class="sourceLine" id="cb231-8" title="8"><span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a></code></pre></div>
<p>Congratulations! You just wrote a Redux cycle to populate your application’s global state with a response from the Giphy API.</p>
<p>Notice how your application’s global state changed after invoking the <code>dispatch(fetchGifs('puppy))</code> method. Now you can pass the <code>fetchGifs</code> <em>thunk action creator</em> through a Redux container so that a fetch call can be dispatched from your component to update the global state in the same way!</p>
<h2 id="phase-6-logger-middleware">Phase 6: Logger middleware</h2>
<p>Now instead of manually logging the status of your global state and the response of your dispatch call, you can use the Redux <code>logger</code> middleware to automatically do so. Import <code>logger</code> from <code>redux-logger</code> into your <code>store.js</code> file:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb232-1" title="1"><span class="im">import</span> logger <span class="im">from</span> <span class="st">&#39;redux-logger&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Just like how you applied your <code>thunk</code> middleware to your configured store, you’ll invoke the <code>applyMiddleware()</code> function with your <code>logger</code> middleware. Your updated <code>store.js</code> file should look something like this:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb233-1" title="1"><span class="co">// store.js</span></a>
<a class="sourceLine" id="cb233-2" title="2"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb233-3" title="3"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">&#39;redux-thunk&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb233-4" title="4"><span class="im">import</span> logger <span class="im">from</span> <span class="st">&#39;redux-logger&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb233-5" title="5"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/rootReducer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb233-6" title="6"></a>
<a class="sourceLine" id="cb233-7" title="7"><span class="kw">const</span> configureStore <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb233-8" title="8">  <span class="cf">return</span> <span class="at">createStore</span>(rootReducer<span class="op">,</span> <span class="at">applyMiddleware</span>(thunk<span class="op">,</span> logger))<span class="op">;</span></a>
<a class="sourceLine" id="cb233-9" title="9"><span class="op">};</span></a>
<a class="sourceLine" id="cb233-10" title="10"></a>
<a class="sourceLine" id="cb233-11" title="11"><span class="im">export</span> <span class="im">default</span> configureStore<span class="op">;</span></a></code></pre></div>
<p>Now go back to your browser’s console and dispatch a fetch request:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb234-1" title="1"><span class="ex">store.dispatch</span>(fetchGifs(<span class="st">&#39;puppy&#39;</span>))</a></code></pre></div>
<p>Upon a successful fetch, you should have received a helpful log with your application’s <code>prev state</code>, the dispatched <code>action</code> object, and your application’s <code>next state</code> from the <code>logger</code> middleware you just utilized!</p>
<h2 id="phase-7-container-component">Phase 7: Container component</h2>
<p>Now that you’ve set up the global state of your application, it’s time to connect your React components to the global state! Remember how you used the <code>Provider</code> component in your <code>Root.js</code> file to pass the configured <code>store</code> as a prop to the <code>Provider</code> component.</p>
<p>Just like how a <code>Context.Provider</code> component expects <code>value</code> as a prop to set the context object, the Redux <code>Provider</code> component expects <code>store</code> as a prop to share the store’s global state with nested components. Instead of rendering your <code>App</code> component as the child of the <code>Provider</code>, you’ll render an <code>AppContainer</code>.</p>
<h3 id="appcontainer">AppContainer</h3>
<p>In your <code>AppContainer.js</code> file, you will define a <code>mapStateToProps</code> function and a <code>mapDispatchToProps</code> function and invoke the <code>connect()</code> function from Redux. Invoking the <code>connect()</code> function will connect the <code>App</code> component with the Redux store. Within the container, you will pass slices of <code>state</code> and dispatched <em>thunk action creators</em> as props to the <code>App</code> component.</p>
<p>Note that the skeleton has already imported the <code>connect</code> function from <code>react-redux</code>, your <code>fetchGifs</code> thunk action creator from the <code>gifAction.js</code> file, and the <code>App</code> component.</p>
<p>Take a look at the code skeletons of the <code>mapStateToProps</code> and <code>mapDispatchToProps</code> functions. Think of these functions as functions that take in <code>state</code> or <code>dispatch</code> as arguments to return object literals that represent the props that your <code>App</code> component will receive.</p>
<p>Have your <code>mapStateToProps</code> function return an object with a <code>gifs</code> property set to the <code>state.gifs</code> slice of state. Doing this will pass a <code>gifs</code> prop into your <code>App</code> component.</p>
<p>Next, have your <code>mapDispatchToProps</code> function return an object with a <code>fetchGifs</code> property set to an arrow function that accepts a <code>searchQuery</code> value and dispatches a call to the <code>fetchGifs(searchQuery)</code> function. Remember how you tested the <code>store.dispatch(fetchGifs(searchQuery))</code> function in the browser console. Think of how you would use an arrow function to almost wait for a <code>searchQuery</code> input from the user before firing the dispatch call.</p>
<p>Lastly, take a moment to examine how your <code>AppContainer.js</code> file is simply exporting the <code>connect()</code> invocation:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb235-1" title="1"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps)(App)<span class="op">;</span></a></code></pre></div>
<p>Now you can render your <code>AppContainer</code> instead of your <code>App</code> component so that the <code>connect()</code> method is invoked to pass a <code>gifs</code> prop and a <code>fetchGifs</code> props to <code>App</code>!</p>
<p>Take a moment to refactor your <code>Root.js</code> file to do so:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb236-1" title="1"><span class="co">// Root.js</span></a>
<a class="sourceLine" id="cb236-2" title="2"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb236-3" title="3"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb236-4" title="4"><span class="im">import</span> AppContainer <span class="im">from</span> <span class="st">&#39;./AppContainer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb236-5" title="5"></a>
<a class="sourceLine" id="cb236-6" title="6"><span class="kw">const</span> Root <span class="op">=</span> (<span class="op">{</span> store <span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb236-7" title="7">  <span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb236-8" title="8">    <span class="op">&lt;</span>AppContainer /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb236-9" title="9">  &lt;/Provider<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb236-10" title="10">)<span class="op">;</span></a>
<a class="sourceLine" id="cb236-11" title="11"></a>
<a class="sourceLine" id="cb236-12" title="12"><span class="im">export</span> <span class="im">default</span> Root<span class="op">;</span></a></code></pre></div>
<h2 id="phase-8-presentational-components">Phase 8: Presentational components</h2>
<p>Now that you’ve created a container to pass (or <em>map</em>) slices of the global state and dispatched actions as props, it’s time to render and update the <code>gifs</code> from the global state!</p>
<h3 id="app">App</h3>
<p>Have your <code>App</code> component take in and destructure your <code>gifs</code> and <code>fetchGifs</code> props. Notice how your component is rendering a <code>SearchBar</code> component and a <code>GifsList</code> component. You’ll want to pass in the <code>fetchGifs</code> function as a prop to the <code>SearchBar</code> component.</p>
<p>Instead of directly passing all of the <code>gifs</code> as a prop to the <code>GifsList</code> component, you’ll refactor your <code>mapStateToProps</code> function and use a selector to map the array of <code>gifs</code> into an array of GIF urls.</p>
<p>Currently, your <code>mapStateToProps</code> function should look something like this:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb237-1" title="1"><span class="kw">const</span> mapStateToProps <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb237-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb237-3" title="3">    <span class="dt">gifs</span><span class="op">:</span> <span class="va">state</span>.<span class="at">gifs</span><span class="op">,</span></a>
<a class="sourceLine" id="cb237-4" title="4">  <span class="op">};</span></a>
<a class="sourceLine" id="cb237-5" title="5"><span class="op">};</span></a></code></pre></div>
<p>Define a <code>getGifUrls</code> selector that takes in the <code>state</code> and uses parameter destructuring to map over each gif in the <code>gifs</code> slice of state to pluck the image URL from the JSON data, like so:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb238-1" title="1"><span class="kw">const</span> getGifUrls <span class="op">=</span> (<span class="op">{</span> gifs <span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb238-2" title="2">  <span class="va">gifs</span>.<span class="at">map</span>(gif <span class="kw">=&gt;</span> <span class="va">gif</span>.<span class="va">images</span>.<span class="va">fixed_height</span>.<span class="at">url</span>)</a>
<a class="sourceLine" id="cb238-3" title="3">)<span class="op">;</span></a>
<a class="sourceLine" id="cb238-4" title="4"></a>
<a class="sourceLine" id="cb238-5" title="5"><span class="kw">const</span> mapStateToProps <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb238-6" title="6">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb238-7" title="7">    <span class="dt">gifUrls</span><span class="op">:</span> <span class="at">getGifUrls</span>(state)<span class="op">,</span></a>
<a class="sourceLine" id="cb238-8" title="8">  <span class="op">};</span></a>
<a class="sourceLine" id="cb238-9" title="9"><span class="op">};</span></a></code></pre></div>
<p>Now you can pass in the <code>gifUrls</code> for your <code>GifsList</code> component to render GIF images without passing unnecessary data as props!</p>
<h3 id="searchbar">SearchBar</h3>
<p>In your <code>SearchBar</code> component, you already have a search form, an <code>inputValue</code> state, and an <code>onChange</code> handler for the form’s input field set up. Right now, your component has several <code>TODO</code> notes to guide your creation of an <code>onSubmit</code> handler for your search form. The <code>onSubmit</code> handler will dispatch the <code>fetchGifs</code> action creator function (don’t forget to prevent the default action of a submit event).</p>
<p>After finishing your <code>SearchBar</code> component, test out your submit event handler and check your <code>logger</code> response to see if your <code>fetchGifs</code> action creator is actually being dispatched to update the application’s global state! Once you see that your fetched <code>gifs</code> have been dispatched to the <code>gifs</code> slice of state, it’s time to render your list of GIFs!</p>
<h3 id="gifslist">GifsList</h3>
<p>Right now, your component has several <code>TODO</code> notes:</p>
<ul>
<li>Take in and destructure the <code>gifUrls</code> prop.</li>
<li>Render a <code>&lt;div&gt;</code> as the parent element of your <code>GifsList</code> component.</li>
<li>Map over your <code>gifUrls</code> array to render an <code>&lt;img&gt;</code> for each <code>url</code>.</li>
</ul>
<h3 id="debugging">Debugging</h3>
<p>If you’re having issues rendering a GIF in your project, that means it’s a great time to practice using <code>debugger</code> statements to debug your Redux cycle code! For example, you could set a <code>debugger</code> in the:</p>
<ul>
<li><code>handleSubmit</code> method to check out the submitted search <code>inputValue</code></li>
<li><code>receiveGifs</code> action creator function to check out the value of the <code>gifs</code> payload</li>
<li><code>RECEIVE_GIFS</code> case statement in the <code>gifsReducer</code> to check out the value of the dispatch <code>action</code> object</li>
</ul>
<p>If you didn’t hit any issues, congratulations - you have implemented Redux with the Giphy API to create a search API that renders a list of GIFs! Before moving forward to the next project, you should still use <code>debugger</code> statements to step through this project’s Redux cycle.</p>
<hr />
<h1 id="week-15-day-4-hooks" data-ignore="true">WEEK-15 DAY-4<br><em>Hooks</em></h1>
<hr />
<h1 id="hooks-objectives">Hooks Objectives</h1>
<p>Now that you’ve learned the basic objectives of using React, you should be able to gain a fundamental understanding of the React, Redux, and React-Router hooks. In your software engineering career, official documentation will be your friend! It’s important to learn how to navigate through official documentation. At the end of the readings, you should use your new fundamental understanding of hooks to go through the official React Hooks documentation. At the end of this topic’s articles and lectures you should be able to create function components that use state and other React features.</p>
<p>You should be able to use React’s:</p>
<ul>
<li><code>useState</code> hook to manage a component’s state.</li>
<li><code>useState</code> hook to set a default state, instead of setting the default state in a <code>constructor()</code> method.</li>
<li><code>useState</code> hook to update state, instead of the <code>setState()</code> method.</li>
<li><code>useEffect</code> hook to manage <em>side effect</em> operations (i.e. data fetching).</li>
<li><code>useEffect</code> hook in replacement of commonly used component lifecycle methods (<code>componentDidMount</code>, <code>componentDidUpdate</code>, and <code>componentWillUnmount</code>).</li>
<li><code>useEffect</code> (and the hook’s <em>dependency array</em>) to optimize an application’s performance by skipping <code>useEffect</code> calls.</li>
<li><code>useContext</code> hook to access a context object, instead of a <code>Context.Consumer</code> or the <code>static contentType</code> property.</li>
</ul>
<p>You should be able to use Redux’s:</p>
<ul>
<li><code>useSelector</code> hook to access the Redux store’s state from within a component (instead of passing a part of state as a prop with the <code>mapStateToProps</code> function).</li>
<li><code>useDispatch</code> hook to dispatch an action from within a component (instead of passing an thunk action creator function through the <code>mapDispatchToProps</code> function).</li>
</ul>
<p>You should be able to use React Router’s:</p>
<ul>
<li><code>useParams</code> hook to match parameters in the current route (instead of accessing the <code>match.params</code> prop).</li>
<li><code>useHistory</code> hook to navigation from within code (without <code>&lt;Link&gt;</code>, <code>&lt;NavLink&gt;</code>, or the <code>history</code> prop).</li>
<li><code>useLocation</code> hook to track url changes.</li>
<li><code>useRouteMatch</code> hook to check if the current url matches a path format.</li>
</ul>
<hr />
<h1 id="intro-to-react-hooks">Intro to React Hooks</h1>
<p>React Hooks are a way for function components to have the same functionality as class components that make use of component lifecycle methods. Hooks are simply functions that allow components to utilize React features without explicitly using the lifecycle methods.</p>
<p>Before React Hooks, the only way to use lifecycle methods were through class components. Hooks allow you to manage a component’s state and lifecycle within function components. They are helpful in extracting stateful logic from a component to be independently tested and reused - it’s much more complicated to test the functionality of logic in a component’s lifecycle methods. After reading this article, you will:</p>
<ul>
<li>Have a general understanding of the features of basic React hooks</li>
<li>Understand how the basic Hooks connect to features of React class components (i.e. lifecycle methods)</li>
<li>Create function components that use state and other React features</li>
<li>Use the <code>useState</code> hook to manage a component’s state</li>
<li>Use the <code>useEffect</code> hook to manage <em>side effect</em> operations (i.e. data fetching)</li>
<li>Use the <code>useContext</code> hook to access a context object</li>
</ul>
<h2 id="usestate">useState</h2>
<p>Up to this point, you have set a component’s default state within a component’s <code>constructor</code> method. The <code>useState</code> hook replaces the need to use a constructor to declare a default state with <code>this.state</code>. You can use the <code>useState</code> hook to set and name a default slice of state without a <code>constructor()</code> method. You can set a default state simply by invoking the <code>useState</code> hook. The <strong>with hooks</strong> example below sets the default <code>inputValue</code> state to be <code>'Default input value here!'</code> by invoking the <code>useState</code> hook with the string <code>'Default input value here!'</code>.</p>
<p><strong>with hooks</strong></p>
<div class="sourceCode" id="cb239"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb239-1" title="1"><span class="kw">const</span> FormWithHooks <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb239-2" title="2">  <span class="kw">const</span> [inputValue<span class="op">,</span> setInputValue] <span class="op">=</span> <span class="at">useState</span>(<span class="st">&#39;Default input value here!&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb239-3" title="3"><span class="op">};</span></a></code></pre></div>
<p><strong>without hooks</strong></p>
<div class="sourceCode" id="cb240"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb240-1" title="1"><span class="kw">class</span> FormWithoutHooks <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span>  </a>
<a class="sourceLine" id="cb240-2" title="2">  <span class="at">constructor</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb240-3" title="3">    <span class="kw">super</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb240-4" title="4">    <span class="kw">this</span>.<span class="at">state</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb240-5" title="5">      <span class="dt">inputValue</span><span class="op">:</span> <span class="st">&#39;Default input value here!&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb240-6" title="6">    <span class="op">};</span></a>
<a class="sourceLine" id="cb240-7" title="7">  <span class="op">};</span></a>
<a class="sourceLine" id="cb240-8" title="8"><span class="op">}</span></a></code></pre></div>
<p>When you use the <code>useState</code> hook to set up a slice of state, you also set up a prospective function to update that slice of state. In this example, you can update a slice of state by invoking <code>setInputValue</code>, instead of invoking the <code>this.setState()</code> method.</p>
<p><strong>with hooks</strong></p>
<div class="sourceCode" id="cb241"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb241-1" title="1"><span class="kw">const</span> updateInputVal <span class="op">=</span> e <span class="kw">=&gt;</span> <span class="at">setInputValue</span>(<span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>without hooks</strong></p>
<div class="sourceCode" id="cb242"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb242-1" title="1">updateInputVal <span class="op">=</span> e <span class="kw">=&gt;</span> <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span> <span class="dt">inputValue</span><span class="op">:</span> <span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span> <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>In general, React Hooks help clean up your code <strong>a lot</strong>! For example, when using the <code>useState</code> hook, you can also simply reference <code>inputValue</code> throughout the component, instead of <code>this.state.inputValue</code>. Compare the difference between the code for the <code>FormWithHooks</code> and <code>FormWithoutHooks</code> components below.</p>
<p><strong>with hooks</strong></p>
<div class="sourceCode" id="cb243"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb243-1" title="1"><span class="kw">const</span> FormWithHooks <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb243-2" title="2">  <span class="kw">const</span> [inputValue<span class="op">,</span> setInputValue] <span class="op">=</span> <span class="at">useState</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb243-3" title="3">  <span class="kw">const</span> updateInputVal <span class="op">=</span> e <span class="kw">=&gt;</span> <span class="at">setInputValue</span>(<span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb243-4" title="4"></a>
<a class="sourceLine" id="cb243-5" title="5">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb243-6" title="6">    <span class="op">&lt;</span>form<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb243-7" title="7">      <span class="op">&lt;</span>input</a>
<a class="sourceLine" id="cb243-8" title="8">        type<span class="op">=</span><span class="st">&quot;text&quot;</span></a>
<a class="sourceLine" id="cb243-9" title="9">        value<span class="op">={</span>inputValue<span class="op">}</span></a>
<a class="sourceLine" id="cb243-10" title="10">        onChange<span class="op">={</span>updateInputVal<span class="op">}</span></a>
<a class="sourceLine" id="cb243-11" title="11">        placeholder<span class="op">=</span><span class="st">&quot;Type something!&quot;</span></a>
<a class="sourceLine" id="cb243-12" title="12">      /&gt;</a>
<a class="sourceLine" id="cb243-13" title="13">    &lt;/form<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb243-14" title="14">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb243-15" title="15"><span class="op">};</span></a></code></pre></div>
<p><strong>without hooks</strong></p>
<div class="sourceCode" id="cb244"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb244-1" title="1"><span class="kw">class</span> FormWithoutHooks <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span>  </a>
<a class="sourceLine" id="cb244-2" title="2">  <span class="at">constructor</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb244-3" title="3">    <span class="kw">super</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb244-4" title="4">    <span class="kw">this</span>.<span class="at">state</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb244-5" title="5">      <span class="dt">inputValue</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb244-6" title="6">    <span class="op">};</span></a>
<a class="sourceLine" id="cb244-7" title="7">  <span class="op">};</span></a>
<a class="sourceLine" id="cb244-8" title="8"></a>
<a class="sourceLine" id="cb244-9" title="9">  updateInputVal <span class="op">=</span> e <span class="kw">=&gt;</span> <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span> <span class="dt">inputValue</span><span class="op">:</span> <span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb244-10" title="10">  </a>
<a class="sourceLine" id="cb244-11" title="11">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb244-12" title="12">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb244-13" title="13">      <span class="op">&lt;</span>form<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb244-14" title="14">        <span class="op">&lt;</span>input</a>
<a class="sourceLine" id="cb244-15" title="15">          type<span class="op">=</span><span class="st">&quot;text&quot;</span></a>
<a class="sourceLine" id="cb244-16" title="16">          value<span class="op">={</span><span class="kw">this</span>.<span class="va">state</span>.<span class="at">inputValue</span><span class="op">}</span></a>
<a class="sourceLine" id="cb244-17" title="17">          onChange<span class="op">={</span><span class="kw">this</span>.<span class="at">updateInputVal</span><span class="op">}</span></a>
<a class="sourceLine" id="cb244-18" title="18">          placeholder<span class="op">=</span><span class="st">&quot;Type something!&quot;</span></a>
<a class="sourceLine" id="cb244-19" title="19">        /&gt;</a>
<a class="sourceLine" id="cb244-20" title="20">      &lt;/form<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb244-21" title="21">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb244-22" title="22">  <span class="op">}</span></a>
<a class="sourceLine" id="cb244-23" title="23"><span class="op">}</span></a></code></pre></div>
<p>When refactoring your projects to implement React Hooks, you can always refactor component by component, starting out with refactoring the component’s state management.</p>
<h2 id="useeffect">useEffect</h2>
<p>The <code>useEffect</code> hook is used to manage side effect operations. An example of a side effect operation you are familiar with is data fetching. Similarly to the <code>componentDidMount</code> or <code>componentDidUpdate</code> lifecycle methods, the <code>useEffect</code> hook will automatically run.</p>
<p>Take a moment to notice how using the <code>useEffect</code> hook simply means invoking the <code>useEffect</code> function. You can invoke the function with one or two arguments, with the first argument always being a function, and then second argument being an optional <em>dependency array</em>.</p>
<p>When the <code>useEffect</code> hook is invoked <strong>without</strong> a second argument, the function will be invoked after every render:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb245-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb245-2" title="2">  <span class="co">// Side effect logic invoked after every render</span></a>
<a class="sourceLine" id="cb245-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>When the <code>useEffect</code> hook is invoked <strong>with an empty array</strong>, the function is only invoked once, when a component mounts (think of <code>componentDidMount</code>):</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb246-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb246-2" title="2">  <span class="co">// Side effect logic invoked once, when a component mounts</span></a>
<a class="sourceLine" id="cb246-3" title="3"><span class="op">},</span> [])<span class="op">;</span></a></code></pre></div>
<p>When the <code>useEffect</code> hook is invoked <strong>with an array of dependencies</strong>, the function is invoked whenever a dependency changes (think of <code>componentDidUpdate</code>):</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb247-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb247-2" title="2">  <span class="co">// Side effect logic invoked every time the `dependentVariable` changes</span></a>
<a class="sourceLine" id="cb247-3" title="3"><span class="op">},</span> [dependentVariable])<span class="op">;</span></a></code></pre></div>
<h3 id="skipping-effects-with-the-dependency-array">Skipping effects with the dependency array</h3>
<p>This second argument of the <code>useEffect</code> hook is known as the <em>dependency array</em>. You can optimize the performance for your component by using the dependency array to skip effects. The dependency array is a collection of dependent variables. Similarly to how the <code>componentDidUpdate</code> lifecycle method listens for a change in the component, the <code>useEffect</code> hook listen for changes to variables in the dependency array to determine whether or not to run the <em>effect</em> again.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb248-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb248-2" title="2">  <span class="co">// Side effect logic</span></a>
<a class="sourceLine" id="cb248-3" title="3"><span class="op">},</span> [<span class="co">/* Dependency array */</span>])<span class="op">;</span></a></code></pre></div>
<h3 id="asynchronous-effects">Asynchronous effects</h3>
<p>You are familiar with using <code>async/await</code> to await a database fetch. If you’d like to make an asynchronous fetch within a <code>useEffect</code> hook, you would declare an asynchronous function within the hook. Then, you would invoke the asynchronous functions from within the hook.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb249-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb249-2" title="2">  <span class="kw">const</span> fetchSomething <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb249-3" title="3">    <span class="co">// Fetch call</span></a>
<a class="sourceLine" id="cb249-4" title="4">  <span class="op">};</span></a>
<a class="sourceLine" id="cb249-5" title="5"></a>
<a class="sourceLine" id="cb249-6" title="6">  <span class="at">fetchSomething</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb249-7" title="7"><span class="op">},</span> [<span class="co">/* Dependency array */</span>])<span class="op">;</span></a></code></pre></div>
<p>The function passed in as the <code>useEffect</code> hook’s first argument <strong>cannot</strong> be an asynchronous function - this is why you need to define and invoke the asynchronous function from within the hook’s first function argument.</p>
<p>In the example below, the <code>useEffect</code> hooks runs an asynchronous fetch of a puppy, based on a <code>puppyId</code> input. The hook’s dependency array references <code>props.match.params.puppyId</code>. Since the <code>useEffect</code> hook’s dependency array references the <code>puppyId</code> parameter, the application will only fetch whenever the <code>puppyId</code> parameter changes. This optimizes the code, because now the effect is only run upon the change of a specific variable - <code>puppyId</code>!</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb250-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb250-2" title="2">  <span class="kw">const</span> fetchPuppy <span class="op">=</span> <span class="kw">async</span> (puppyId) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb250-3" title="3">    <span class="kw">const</span> puppy <span class="op">=</span> <span class="cf">await</span> <span class="at">fetch</span>(<span class="vs">`https://api.puppies.example/</span><span class="sc">${</span>puppyId<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb250-4" title="4">    <span class="kw">const</span> puppyJSON <span class="op">=</span> <span class="cf">await</span> <span class="va">res</span>.<span class="at">json</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb250-5" title="5">    <span class="cf">return</span> puppyJSON<span class="op">;</span></a>
<a class="sourceLine" id="cb250-6" title="6">  <span class="op">};</span></a>
<a class="sourceLine" id="cb250-7" title="7"></a>
<a class="sourceLine" id="cb250-8" title="8">  <span class="at">fetchData</span>(<span class="va">props</span>.<span class="va">match</span>.<span class="va">params</span>.<span class="at">puppyId</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb250-9" title="9"><span class="op">},</span> [<span class="va">props</span>.<span class="va">match</span>.<span class="va">params</span>.<span class="at">puppyId</span>])<span class="op">;</span></a></code></pre></div>
<p>Using a dependency array also prevents endless loops. Without the dependency array, a fetch call invoked within a <code>useEffect</code> hook would constantly run and your code would error out.</p>
<p>Alternatively, you can invoke the asynchronous effect with an <a href="https://en.wikipedia.org/wiki/Immediately_invoked_function_expression">IIFE</a> (immediately invoked function expression). Take the example syntax below:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb251-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb251-2" title="2">  (<span class="kw">async</span> <span class="kw">function</span> <span class="at">fetchSomething</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb251-3" title="3">    <span class="co">// Fetch call</span></a>
<a class="sourceLine" id="cb251-4" title="4">  <span class="op">}</span>)()<span class="op">;</span></a>
<a class="sourceLine" id="cb251-5" title="5"><span class="op">},</span> [<span class="co">/* Dependency array */</span>])<span class="op">;</span></a></code></pre></div>
<h3 id="effect-cleanup">Effect cleanup</h3>
<p>In a class component, you might use the <code>componentWillUnmount</code> lifecycle method to handle <em>cleanup</em>. In order to <em>cleanup</em> an effect, you would need to return a function from within the <code>useEffect</code> hook. Having the <code>useEffect</code> hook’s callback return another function results in the cleanup behavior of <code>componentWillUnmount</code>.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb252-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb252-2" title="2">  <span class="cf">return</span> <span class="kw">function</span> <span class="at">cleanup</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb252-3" title="3">    <span class="co">// Cleanup logic</span></a>
<a class="sourceLine" id="cb252-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb252-5" title="5"><span class="op">},</span> [<span class="co">/* Dependency array */</span>])<span class="op">;</span></a></code></pre></div>
<p>In a later lesson, you will learn about how to use WebSockets. When you use a WebSocket, you create a connection. What if you want to close that connection? Closing a connection sounds like a <em>cleanup</em> task! It is common to invoke the WebSocket’s <code>close</code> method in a <em>cleanup</em> function. The example below makes use of the <em>dependency array</em> and a <em>cleanup</em> function.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb253-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb253-2" title="2">  <span class="cf">if</span> (<span class="op">!</span>username) <span class="op">{</span></a>
<a class="sourceLine" id="cb253-3" title="3">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb253-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb253-5" title="5"></a>
<a class="sourceLine" id="cb253-6" title="6">  <span class="kw">const</span> ws <span class="op">=</span> <span class="kw">new</span> <span class="at">WebSocket</span>(<span class="st">&#39;ws://localhost:8080&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb253-7" title="7">  <span class="va">webSocket</span>.<span class="at">current</span> <span class="op">=</span> ws<span class="op">;</span></a>
<a class="sourceLine" id="cb253-8" title="8">  </a>
<a class="sourceLine" id="cb253-9" title="9">  <span class="cf">return</span> <span class="kw">function</span> <span class="at">cleanup</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb253-10" title="10">    <span class="cf">if</span> (<span class="va">webSocket</span>.<span class="at">current</span> <span class="op">!==</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb253-11" title="11">      <span class="va">webSocket</span>.<span class="va">current</span>.<span class="at">close</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb253-12" title="12">    <span class="op">}</span></a>
<a class="sourceLine" id="cb253-13" title="13">  <span class="op">};</span></a>
<a class="sourceLine" id="cb253-14" title="14"><span class="op">},</span> [username])<span class="op">;</span></a></code></pre></div>
<p>Similar to the behavior of <code>componentDidUpdate</code>, the effect is re-run whenever the <code>username</code> changes. The <code>useEffect</code> hook below takes care of setting up a new WebSocket connection. The hook’s <em>cleanup</em> function will be run whenever the component unmounts. Replacing the <code>componentWillUnmount</code> lifecycle method, the <em>cleanup</em> function will take care of closing the WebSocket connection when the component unmounts.</p>
<h2 id="usecontext">useContext</h2>
<p>You can use the <code>useContext</code> hook to access a context object to read and subscribe to context changes. The <code>useContext</code> hooks replaces the <code>static contextType</code> property in class components. Whenever you used the <code>static contextType</code> property in a class component, you were able to access a context object via referencing <code>this.context</code>. When you use the <code>useContext</code> hook, you can access a context object via whatever you name the context! In the example below, the <code>useContext</code> hook is invoked and its return value (the <code>MyContext</code> object) is named <code>context</code> - this means you can access the <code>MyContext</code> object anywhere within the component via referencing <code>context</code>.</p>
<p><strong>with hooks</strong></p>
<div class="sourceCode" id="cb254"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb254-1" title="1"><span class="kw">const</span> context <span class="op">=</span> <span class="at">useContext</span>(MyContext)<span class="op">;</span>    <span class="co">// Makes `MyContext` available as `context`</span></a>
<a class="sourceLine" id="cb254-2" title="2"><span class="kw">const</span> banana <span class="op">=</span> <span class="at">useContext</span>(BananaContext)<span class="op">;</span> <span class="co">// Makes `BananaContext` available as `banana`</span></a>
<a class="sourceLine" id="cb254-3" title="3"><span class="kw">const</span> puppy <span class="op">=</span> <span class="at">useContext</span>(PuppyContext)<span class="op">;</span>   <span class="co">// Makes `PuppyContext` available as `puppy`</span></a></code></pre></div>
<p><strong>without hooks</strong></p>
<div class="sourceCode" id="cb255"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb255-1" title="1"><span class="kw">static</span> contextType <span class="op">=</span> MyContext<span class="op">;</span> <span class="co">// Makes `MyContext` available as `this.context`</span></a></code></pre></div>
<p>When using the <code>useContext</code> hook to access a context object, you would still use a <code>&lt;Context.Provider&gt;</code> to set the context’s <code>value</code>.</p>
<h2 id="what-you-have-learned">What you have learned</h2>
<p>In this article, you have learned about the general features of the basic React hooks (<code>useState</code>, <code>useEffect</code>, and <code>useContext</code>). You should now understand the functionality of how the basic Hooks connect to the features of React class components. You should be able to use the:</p>
<ul>
<li><code>useState</code> hook to manage a function component’s state</li>
<li><code>useEffect</code> hook to manage running, skipping, and cleaning up effects</li>
<li><code>useContext</code> hook to access a context object</li>
</ul>
<hr />
<h1 id="introduction-to-hooks-in-redux">Introduction to Hooks in Redux</h1>
<p>In previous lessons and projects, you have learned to build <strong>React</strong> components using <strong>Redux</strong>. Now it’s time to explore ways to modify your approach using hooks.</p>
<p>When you complete this lesson, you will be able to</p>
<ul>
<li>Use Redux in a function component with the <code>useSelector</code> and <code>useDispatch</code> hooks</li>
</ul>
<h2 id="using-hooks-with-redux">Using hooks with Redux</h2>
<p>In order to use hooks in Redux, your application will need to utilize the <code>react-redux</code> package. If you need a refresher on what this kind of application looks like, see the <a href="#starting-point-for-ip-address-project">Starting Point</a> section at the end of this reading or clone the <a href="https://github.com/-starters/intro-to-redux-hooks">intro-to-redux-hooks</a> repository from GitHub and look at the <strong>starter</strong> folder.</p>
<h2 id="getting-started-1">Getting Started</h2>
<p>Consider a simple application that displays the user’s current IP Address with a button to start the lookup. You many even include a loading message which shows while the server call is running.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb256-1" title="1"><span class="co">// ./src/App.js</span></a>
<a class="sourceLine" id="cb256-2" title="2"></a>
<a class="sourceLine" id="cb256-3" title="3"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span> useEffect<span class="op">,</span> useState <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb256-4" title="4"></a>
<a class="sourceLine" id="cb256-5" title="5"><span class="kw">const</span> App <span class="op">=</span> props <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb256-6" title="6">  <span class="kw">const</span> [ip<span class="op">,</span> setIP] <span class="op">=</span> <span class="at">useState</span>(<span class="kw">null</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb256-7" title="7">  <span class="kw">const</span> [loading<span class="op">,</span> setLoading] <span class="op">=</span> <span class="at">useState</span>(<span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb256-8" title="8"></a>
<a class="sourceLine" id="cb256-9" title="9">  <span class="kw">const</span> getMyIP <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb256-10" title="10">    <span class="at">setIP</span>(<span class="st">&#39;(coming soon)&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb256-11" title="11">  <span class="op">};</span></a>
<a class="sourceLine" id="cb256-12" title="12"></a>
<a class="sourceLine" id="cb256-13" title="13">  <span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb256-14" title="14">    <span class="at">setLoading</span>(ip <span class="op">===</span> <span class="st">&quot;&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb256-15" title="15">  <span class="op">},</span> [ip])<span class="op">;</span></a>
<a class="sourceLine" id="cb256-16" title="16"></a>
<a class="sourceLine" id="cb256-17" title="17">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb256-18" title="18">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb256-19" title="19">      <span class="op">&lt;</span>h1<span class="op">&gt;</span>Get My IP&lt;/h1<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb256-20" title="20"></a>
<a class="sourceLine" id="cb256-21" title="21">      <span class="op">{</span>loading</a>
<a class="sourceLine" id="cb256-22" title="22">        <span class="op">?</span> <span class="op">&lt;</span>p<span class="op">&gt;</span><span class="va">Loading</span>...&lt;/p<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb256-23" title="23">        : <span class="op">&lt;</span>p<span class="op">&gt;{</span>ip<span class="op">}</span>&lt;/p<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb256-24" title="24">      <span class="op">}</span></a>
<a class="sourceLine" id="cb256-25" title="25">      <span class="op">&lt;</span>button </a>
<a class="sourceLine" id="cb256-26" title="26">        onClick<span class="op">={</span>getMyIP<span class="op">}</span> </a>
<a class="sourceLine" id="cb256-27" title="27">        disabled<span class="op">={</span>loading<span class="op">}</span></a>
<a class="sourceLine" id="cb256-28" title="28">      <span class="op">&gt;{</span>ip <span class="op">?</span> <span class="st">&#39;Again&#39;</span> : <span class="st">&#39;Go&#39;</span><span class="op">}</span>&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb256-29" title="29">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb256-30" title="30">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb256-31" title="31"><span class="op">};</span></a>
<a class="sourceLine" id="cb256-32" title="32"></a>
<a class="sourceLine" id="cb256-33" title="33"><span class="im">export</span> <span class="im">default</span> App<span class="op">;</span></a></code></pre></div>
<p>Notice that this framework uses your knowledge of the <code>useState</code> hook to simulate the server call and the <code>useEffect</code> hook to cause the loading indicator to show at the appropriate times.</p>
<p>Now you can update this example to use Redux hooks to replace the fake loading of <code>ip</code>.</p>
<h2 id="useselector"><code>useSelector</code></h2>
<p>Begin by importing <code>useSelector</code> from the <em>React Redux</em> package.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb257-1" title="1"><span class="im">import</span> <span class="op">{</span> useSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Assuming you have a reducer with the property <code>ipAddress</code>, then you can use the <code>useSelector</code> hook to access the <code>ipAddress</code> from your Redux store’s state.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb258-1" title="1"><span class="kw">const</span> ip <span class="op">=</span> <span class="at">useSelector</span>(state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">ipAddress</span>)<span class="op">;</span></a></code></pre></div>
<p>In the sample <em>App.js</em> above, using the <code>useSelector</code> hook would replace <code>const [ip, setIP] = useState('')</code>. Your component would receive the <code>ip</code> via your Redux store’s <code>state.ipAddress</code>, instead of the component’s <code>ip</code> state.</p>
<blockquote>
<p>As a reminder, the <code>useState</code> hook in this example is simply mimicking a fetch response. Upon clicking the button with the <code>getMyIP</code> click handler, a fetch call is mimicked with the <code>setIP('(coming soon)')</code> method. You will need to remove this line as well. Don’t worry you’ll replace it momentarily using another Redux hook.</p>
</blockquote>
<p>You can access any available property this way and even call <code>useSelector()</code> multiple times within a single function component. You can even use props or route parameters to determine what to extract from the store.</p>
<p>Here is an example using props. Assume you have a store with a <code>users</code> object in its state. Furthermore, you want to get just <code>user</code> based on the <code>id</code> provided in a prop to a function component.</p>
<p>Here is the component’s code. See if you can spot where the "magic" happens.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb259-1" title="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">&quot;react&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb259-2" title="2"><span class="im">import</span> <span class="op">{</span> useSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;react-redux&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb259-3" title="3"></a>
<a class="sourceLine" id="cb259-4" title="4"><span class="kw">const</span> UserCard <span class="op">=</span> props <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb259-5" title="5">  <span class="kw">const</span> user <span class="op">=</span> <span class="at">useSelector</span>(state <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">users</span>[<span class="va">props</span>.<span class="at">id</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb259-6" title="6">  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;{</span><span class="va">todo</span>.<span class="at">text</span><span class="op">}</span>&lt;/div<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb259-7" title="7"><span class="op">};</span></a>
<a class="sourceLine" id="cb259-8" title="8"></a>
<a class="sourceLine" id="cb259-9" title="9"><span class="im">export</span> <span class="im">default</span> UserCard<span class="op">;</span></a></code></pre></div>
<p>If you said the magic happens in the function passed to the <code>useSelector</code> hook, then you would be correct. Specifically the square bracket notation is used to get just a part of the <code>users</code> object. Remember, you’re passing a function as the argument to <code>useSelector</code>; therefore you can use all your skills to determine the right object or value to <code>return</code>.</p>
<h2 id="usedispatch"><code>useDispatch</code></h2>
<p>In order to trigger an action in <strong>Redux</strong>, you will need to utilize a different hook; specifically, <code>useDispatch()</code>. This hook returns a function which you can call to dispatch the action.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb260-1" title="1"><span class="kw">const</span> dispatch <span class="op">=</span> <span class="at">useDispatch</span>()<span class="op">;</span></a></code></pre></div>
<p>Exactly how you use dispatch depends on your Redux setup. There are some minor differences based on whether you decided to use <code>redux-thunk</code> in your project. The configuration of Redux is beyond the scope of this reading and is something you saw in previous activities. Two solutions are provided in the sample, so you can make the choice which works best for your project. Here’s a quick look at these two options.</p>
<h3 id="option-a-generic-redux-no-thunk">Option A: Generic Redux (no thunk)</h3>
<p>In this configuration, you will need to dispatch actions created in your Redux component (e.g. <em>src/store/ipAddress.js</em>). For example, one possible action creator function might look like <code>export const setIP = ip =&gt; ({ type: SET_IP, ip });</code>.</p>
<p>Any functions which perform loading operations will need to be asynchronous and return the value or object retrieved; perhaps in a scenario like this…</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb261-1" title="1"><span class="co">// relevant snippet from of src/store/ipAddress.js</span></a>
<a class="sourceLine" id="cb261-2" title="2"></a>
<a class="sourceLine" id="cb261-3" title="3"><span class="im">export</span> <span class="kw">const</span> loadIP <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb261-4" title="4">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb261-5" title="5">  <span class="co">// do stuff here like a fetch with await</span></a>
<a class="sourceLine" id="cb261-6" title="6">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb261-7" title="7">  <span class="co">// return the result</span></a>
<a class="sourceLine" id="cb261-8" title="8">  <span class="cf">return</span> origin</a>
<a class="sourceLine" id="cb261-9" title="9"><span class="op">};</span></a></code></pre></div>
<p>Back in the component with the UI (e.g. <em>src/App.js</em>), you’ll need to start by importing these functions as well as adding <code>useDispatch</code> to the import for <strong>Redux</strong>.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb262-1" title="1"><span class="im">import</span> <span class="op">{</span> useDispatch<span class="op">,</span> useSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;react-redux&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb262-2" title="2"><span class="im">import</span> <span class="op">{</span> loadIP<span class="op">,</span> setIP <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./store/ipAddress&quot;</span><span class="op">;</span></a></code></pre></div>
<p>Then use these with your button click handler. Notice you dispatch is using the action to set the value of the ip variable that you just got with <code>useSelector</code>.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb263-1" title="1"><span class="co">// relevant snippet from src/App.js</span></a>
<a class="sourceLine" id="cb263-2" title="2"></a>
<a class="sourceLine" id="cb263-3" title="3">  <span class="kw">const</span> dispatch <span class="op">=</span> <span class="at">useDispatch</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb263-4" title="4"></a>
<a class="sourceLine" id="cb263-5" title="5">  <span class="kw">const</span> getMyIP <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb263-6" title="6">    <span class="at">dispatch</span>(<span class="at">setIP</span>(<span class="st">&quot;&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb263-7" title="7"></a>
<a class="sourceLine" id="cb263-8" title="8">    <span class="kw">const</span> origin <span class="op">=</span> <span class="cf">await</span> <span class="at">loadIP</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb263-9" title="9">    <span class="at">dispatch</span>(<span class="at">setIP</span>(origin))<span class="op">;</span></a>
<a class="sourceLine" id="cb263-10" title="10">  <span class="op">};</span></a></code></pre></div>
<p>The example dispatches two values for the IP Address. The first dispatch call sets the IP address to an empty string (so that the old value no longer shows in the UI while the newer value is loading). The second, of course, is the result of the fetch (or any other kind of service call, of course).</p>
<p>One advantage of this approach is that you will not need to install <code>redux-thunk</code> or add it to the <strong>Redux</strong> configuration. However, this comes with the trade-off that actions will be dispatched throughout the application, including in UI components.</p>
<h3 id="option-b-using-redux-thunk">Option B: Using Redux Thunk</h3>
<p>Now consider the difference using <code>redux-thunk</code>. The action function remains unchanged (<code>export const setIP = ip =&gt; ({ type: SET_IP, ip });</code>). The <code>loadIP</code> function will do its own dispatching (this means a double function in the declaration that results in the code below).</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb264-1" title="1"><span class="co">// relevant snippet from ./src/App.js</span></a>
<a class="sourceLine" id="cb264-2" title="2"></a>
<a class="sourceLine" id="cb264-3" title="3"><span class="im">export</span> <span class="kw">const</span> loadIP <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="kw">async</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb264-4" title="4">  <span class="at">dispatch</span>(<span class="at">setIP</span>(<span class="st">&quot;&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb264-5" title="5"></a>
<a class="sourceLine" id="cb264-6" title="6">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb264-7" title="7">  <span class="co">// do stuff here like a fetch with await</span></a>
<a class="sourceLine" id="cb264-8" title="8">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb264-9" title="9">  <span class="co">// dispatch the result</span></a>
<a class="sourceLine" id="cb264-10" title="10">  <span class="at">dispatch</span>(<span class="at">setIP</span>(origin))<span class="op">;</span></a>
<a class="sourceLine" id="cb264-11" title="11"><span class="op">};</span></a></code></pre></div>
<p>In the component (e.g. _src/App.js), you’ll need to import only the <code>loadIP()</code> function (and not the <code>setIP</code> action creator function) (while still importing <code>useDispatch</code>, of course).</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb265-1" title="1"><span class="im">import</span> <span class="op">{</span> useDispatch<span class="op">,</span> useSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;react-redux&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb265-2" title="2"><span class="im">import</span> <span class="op">{</span> loadIP <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./store/ipAddress&quot;</span><span class="op">;</span></a></code></pre></div>
<p>Then the click handler for the button simplifies to</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb266-1" title="1"><span class="co">// relevant snippet from ./src/App.js</span></a>
<a class="sourceLine" id="cb266-2" title="2"></a>
<a class="sourceLine" id="cb266-3" title="3">  <span class="kw">const</span> getMyIP <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb266-4" title="4">    <span class="at">dispatch</span>(<span class="at">loadIP</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb266-5" title="5">  <span class="op">};</span></a></code></pre></div>
<p>The advantages of this approach using <strong>Redux Thunk</strong> is the separation of responsibilities where the load and action dispatches are all together resulting in simplified handling within the UI components.</p>
<p>The trade-off is double functions in your Redux (like <code>export const loadIP = () =&gt; async dispatch =&gt; {</code>) and the one-time install and setup of <code>redux-thunk</code>.</p>
<p>Ultimately the decision on the approach is made by each development team based on their personal preference.</p>
<h2 id="refactoring-an-existing-component">Refactoring an existing component</h2>
<p>In order to refactor an existing class component from the classic approach to using hooks, there are several steps that need to be taken:</p>
<ul>
<li>Change component definition from class to function
<ul>
<li>Switch state handling to the <code>useState</code> hook</li>
<li>Use the <code>useEffect</code> hook for side-effect management, instead of the <code>componentDidMount</code> and <code>componentDidUpdate</code> methods</li>
<li>Create or move event handlers to constant functions</li>
</ul></li>
<li>Use one or multiple <code>useSelector</code> hooks to replace the <code>mapStateToProps</code> function</li>
<li>Invoke the <code>useDispatch</code> hook to use <code>dispatch</code> and replace the <code>mapDispatchToProps</code> function</li>
<li>Simplify the <code>export</code> to just the component name by removing <code>connect</code></li>
<li>Delete any imports that are no longer in use</li>
</ul>
<p>The best way to understand exactly what to do is to see an example. This will be provided in an upcoming video lesson.</p>
<h2 id="what-you-have-learned-1">What you have learned</h2>
<p>The <code>react-redux</code> package comes with several hooks which can be used to replace <code>mapStateToProps</code>, <code>mapDispatchToProps</code> and <code>connect</code>. Hooks are used with function components, so remember to start with one if you intend to use hooks; otherwise you’ll need to convert your class component to a function component.</p>
<p>The <code>useSelector</code> hook give you access to any and all props that are exposed through the state in a Redux store by passing in a function to resolve the state property you want (e.g. <code>useSelector(state =&gt; state.theProp)</code>). The <code>useDispatch</code> hook allows you to trigger an action directly or by calling a function that uses <code>redux-thunk</code> to dispatch the action.</p>
<p>Using hooks with <strong>React Redux</strong> can improve the readability and maintainability of a <strong>React</strong> project.</p>
<h2 id="additional-resources">Additional resources</h2>
<p>For future reference, there are a few additional (advanced and rarely used) features in the <a href="https://react-redux.js.org/next/api/hooks">official documentation on hooks in React Redux</a>.</p>
<h2 id="starting-point-for-ip-address-project">Starting point for IP address project</h2>
<p>As promised, here is an example of setting up the framework with Redux for the "Get My IP" application discussed throughout this reading. This version includes <strong>Redux Thunk</strong>.</p>
<p>You may access the starter project, the solution project with Redux Thunk, and the solution project without Redux Thunk by cloning the <a href="https://github.com/-starters/intro-to-redux-hooks">intro-to-redux-hooks</a> repository.</p>
<p>Start with <code>create-react-app</code> and install <code>react-redux</code>, <code>redux-thunk</code> and their dependencies (e.g. <code>redux</code>) as you’ve done previously.</p>
<p>Wrap your application in the <strong>Redux Provider</strong> …</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb267-1" title="1"><span class="co">// ./src/index.js</span></a>
<a class="sourceLine" id="cb267-2" title="2"></a>
<a class="sourceLine" id="cb267-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb267-4" title="4"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb267-5" title="5"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb267-6" title="6"><span class="im">import</span> App <span class="im">from</span> <span class="st">&#39;./App&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb267-7" title="7"><span class="im">import</span> configureStore <span class="im">from</span> <span class="st">&#39;./store/configureStore&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb267-8" title="8"></a>
<a class="sourceLine" id="cb267-9" title="9"><span class="kw">const</span> store <span class="op">=</span> <span class="at">configureStore</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb267-10" title="10"></a>
<a class="sourceLine" id="cb267-11" title="11"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb267-12" title="12">  <span class="op">&lt;</span><span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb267-13" title="13">    <span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb267-14" title="14">      <span class="op">&lt;</span>App /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb267-15" title="15">    &lt;/Provider<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb267-16" title="16">  &lt;/<span class="va">React</span>.<span class="at">StrictMode</span><span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb267-17" title="17">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;root&#39;</span>)</a>
<a class="sourceLine" id="cb267-18" title="18">)<span class="op">;</span></a></code></pre></div>
<p>… and configure a <strong>Redux</strong> store …</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb268-1" title="1"><span class="co">// ./src/store/configureStore.js</span></a>
<a class="sourceLine" id="cb268-2" title="2"></a>
<a class="sourceLine" id="cb268-3" title="3"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware<span class="op">,</span> combineReducers<span class="op">,</span> compose <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb268-4" title="4"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">&#39;redux-thunk&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb268-5" title="5"><span class="im">import</span> ipAddress <span class="im">from</span> <span class="st">&#39;./ipAddress&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb268-6" title="6"></a>
<a class="sourceLine" id="cb268-7" title="7"><span class="kw">const</span> composeEnhancers <span class="op">=</span> <span class="va">window</span>.<span class="at">__REDUX_DEVTOOLS_EXTENSION_COMPOSE__</span> <span class="op">||</span> compose<span class="op">;</span></a>
<a class="sourceLine" id="cb268-8" title="8"></a>
<a class="sourceLine" id="cb268-9" title="9"><span class="kw">const</span> reducer <span class="op">=</span> <span class="at">combineReducers</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb268-10" title="10">  ipAddress<span class="op">,</span></a>
<a class="sourceLine" id="cb268-11" title="11"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb268-12" title="12"></a>
<a class="sourceLine" id="cb268-13" title="13"><span class="kw">const</span> configureStore <span class="op">=</span> initialState <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb268-14" title="14">  <span class="cf">return</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb268-15" title="15">    reducer<span class="op">,</span></a>
<a class="sourceLine" id="cb268-16" title="16">    initialState<span class="op">,</span></a>
<a class="sourceLine" id="cb268-17" title="17">    <span class="at">composeEnhancers</span>(<span class="at">applyMiddleware</span>(thunk))<span class="op">,</span></a>
<a class="sourceLine" id="cb268-18" title="18">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb268-19" title="19"><span class="op">};</span></a>
<a class="sourceLine" id="cb268-20" title="20"></a>
<a class="sourceLine" id="cb268-21" title="21"><span class="im">export</span> <span class="im">default</span> configureStore<span class="op">;</span></a></code></pre></div>
<p>… which includes a <strong>reducer</strong>, an <strong>action creator</strong> function, and a <strong>thunk action creator</strong> function …</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb269-1" title="1"><span class="co">// ./src/store/ipAddress.js</span></a>
<a class="sourceLine" id="cb269-2" title="2"></a>
<a class="sourceLine" id="cb269-3" title="3"><span class="im">import</span> <span class="op">{</span> ipUrl <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../config&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb269-4" title="4"></a>
<a class="sourceLine" id="cb269-5" title="5"><span class="kw">const</span> SET_IP <span class="op">=</span> <span class="st">&#39;ipAddress/SET_IP&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb269-6" title="6"></a>
<a class="sourceLine" id="cb269-7" title="7"><span class="im">export</span> <span class="kw">const</span> setIP <span class="op">=</span> ip <span class="kw">=&gt;</span> (<span class="op">{</span> <span class="dt">type</span><span class="op">:</span> SET_IP<span class="op">,</span> ip <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb269-8" title="8"></a>
<a class="sourceLine" id="cb269-9" title="9"><span class="im">export</span> <span class="kw">const</span> loadIP <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="kw">async</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb269-10" title="10">  <span class="at">dispatch</span>(<span class="at">setIP</span>(<span class="st">&quot;&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb269-11" title="11"></a>
<a class="sourceLine" id="cb269-12" title="12">  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="at">fetch</span>(<span class="vs">`</span><span class="sc">${</span>ipUrl<span class="sc">}</span><span class="vs">/ip`</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb269-13" title="13">    <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;get&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb269-14" title="14">    <span class="dt">headers</span><span class="op">:</span> <span class="op">{</span> <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb269-15" title="15">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb269-16" title="16"></a>
<a class="sourceLine" id="cb269-17" title="17">  <span class="cf">if</span> (<span class="va">response</span>.<span class="at">ok</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb269-18" title="18">    <span class="kw">let</span> <span class="op">{</span> origin <span class="op">}</span> <span class="op">=</span> <span class="cf">await</span> <span class="va">response</span>.<span class="at">json</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb269-19" title="19">    <span class="co">// obscure last segment for privacy purposes</span></a>
<a class="sourceLine" id="cb269-20" title="20">    origin <span class="op">=</span> <span class="va">origin</span>.<span class="at">split</span>(<span class="st">&#39;.&#39;</span><span class="op">,</span> <span class="dv">3</span>).<span class="at">join</span>(<span class="st">&#39;.&#39;</span>) <span class="op">+</span> <span class="st">&quot;.xxx&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb269-21" title="21">    <span class="co">// dispatch the result</span></a>
<a class="sourceLine" id="cb269-22" title="22">    <span class="at">dispatch</span>(<span class="at">setIP</span>(origin))<span class="op">;</span></a>
<a class="sourceLine" id="cb269-23" title="23">  <span class="op">}</span></a>
<a class="sourceLine" id="cb269-24" title="24"></a>
<a class="sourceLine" id="cb269-25" title="25"><span class="op">};</span></a>
<a class="sourceLine" id="cb269-26" title="26"></a>
<a class="sourceLine" id="cb269-27" title="27"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">reducer</span>(state <span class="op">=</span> <span class="op">{},</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb269-28" title="28">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb269-29" title="29">    <span class="cf">case</span> <span class="dt">SET_IP</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb269-30" title="30">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb269-31" title="31">        ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb269-32" title="32">        <span class="dt">ip</span><span class="op">:</span> <span class="va">action</span>.<span class="at">ip</span><span class="op">,</span></a>
<a class="sourceLine" id="cb269-33" title="33">      <span class="op">};</span></a>
<a class="sourceLine" id="cb269-34" title="34">    <span class="op">}</span></a>
<a class="sourceLine" id="cb269-35" title="35"></a>
<a class="sourceLine" id="cb269-36" title="36">    <span class="cf">default</span><span class="op">:</span> <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb269-37" title="37">  <span class="op">}</span></a>
<a class="sourceLine" id="cb269-38" title="38"><span class="op">}</span></a></code></pre></div>
<p>… that relies on the application configuration …</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb270-1" title="1"><span class="co">// ./src/config.js</span></a>
<a class="sourceLine" id="cb270-2" title="2"></a>
<a class="sourceLine" id="cb270-3" title="3"><span class="im">export</span> <span class="kw">const</span> ipUrl <span class="op">=</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">REACT_APP_BASEURL</span> <span class="op">||</span> <span class="vs">`https://httpbin.org`</span><span class="op">;</span></a></code></pre></div>
<p>… to fetch the IP Address using the <a href="https://httpbin.org/ip">ip query at httpbin.org</a>.</p>
<hr />
<h1 id="react-router-hooks">React Router Hooks</h1>
<p>Now it’s time to dig into the specifics of how hooks can simplify <strong>React</strong> code when working with React Router, specifically <code>react-router-dom</code>.</p>
<p>When you complete this lesson, you should be able to use the hooks that are built into the <code>react-router-dom</code> package:</p>
<ul>
<li><code>useParams</code> for matching parameters in the current route</li>
<li><code>useHistory</code> for navigation from code (without <code>Link</code> or <code>NavLink</code>)</li>
<li><code>useLocation</code> for tracking url changes</li>
<li><code>useRouteMatch</code> for checking if the current url matches a path format</li>
</ul>
<h2 id="useparams"><code>useParams</code></h2>
<p>The most common usage of hooks with <code>react-router-dom</code> is the case where a RESTful path has one or more parameters, such as an <code>id</code>.</p>
<p>For example, the <code>id</code> in a path like <code>/user/:id</code> may be accessed as the property of an object returned by <code>useParams()</code>.</p>
<p>Option 1</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb271-1" title="1"><span class="kw">const</span> params <span class="op">=</span> <span class="at">useParams</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb271-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;User id is&#39;</span><span class="op">,</span> <span class="va">params</span>.<span class="at">id</span>)<span class="op">;</span></a></code></pre></div>
<p>Option 2 (more common)</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb272-1" title="1"><span class="kw">const</span> <span class="op">{</span> id <span class="op">}</span> <span class="op">=</span> <span class="at">useParams</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb272-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;User id is&#39;</span><span class="op">,</span> id)<span class="op">;</span></a></code></pre></div>
<p>Now, consider this path <code>/user/:userId/doc/:docId</code>. It has two parameters, <code>userId</code> and <code>docId</code>; therefore, they would be accessed using <code>const { userId, docId } = useParams()</code>. Notice how the variables in the path match the properties on the objects returned by <code>useParams()</code>.</p>
<p>Here’s an expanded example showing a basic function component.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb273-1" title="1"><span class="co">// ./src/components/Document.js</span></a>
<a class="sourceLine" id="cb273-2" title="2"></a>
<a class="sourceLine" id="cb273-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb273-4" title="4"><span class="im">import</span> <span class="op">{</span> useParams <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb273-5" title="5"></a>
<a class="sourceLine" id="cb273-6" title="6"><span class="kw">const</span> Document <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb273-7" title="7">    <span class="kw">const</span> <span class="op">{</span> userId<span class="op">,</span> docId <span class="op">}</span> <span class="op">=</span> <span class="at">useParams</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb273-8" title="8"></a>
<a class="sourceLine" id="cb273-9" title="9">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb273-10" title="10">        <span class="op">&lt;&gt;</span></a>
<a class="sourceLine" id="cb273-11" title="11">            <span class="op">&lt;</span>h2<span class="op">&gt;</span>Document <span class="op">{</span>docId<span class="op">}</span>&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb273-12" title="12">            <span class="op">&lt;</span>p<span class="op">&gt;</span>Created by User <span class="op">{</span>userId<span class="op">}</span>&lt;/p<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb273-13" title="13">        &lt;/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb273-14" title="14">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb273-15" title="15"><span class="op">};</span></a>
<a class="sourceLine" id="cb273-16" title="16"></a>
<a class="sourceLine" id="cb273-17" title="17"><span class="im">export</span> <span class="im">default</span> Document<span class="op">;</span></a></code></pre></div>
<p>As a reminder, you’ll need to wrap your components within a <code>&lt;Router&gt;</code> in order to use the hooks built into the <code>react-router-dom</code> package. Perhaps like this…</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb274-1" title="1"><span class="co">// ./src/index.js</span></a>
<a class="sourceLine" id="cb274-2" title="2"></a>
<a class="sourceLine" id="cb274-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb274-4" title="4"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb274-5" title="5"><span class="im">import</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb274-6" title="6">    BrowserRouter <span class="im">as</span> Router<span class="op">,</span></a>
<a class="sourceLine" id="cb274-7" title="7">    Switch<span class="op">,</span></a>
<a class="sourceLine" id="cb274-8" title="8">    Route<span class="op">,</span></a>
<a class="sourceLine" id="cb274-9" title="9"><span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb274-10" title="10"><span class="im">import</span> Document <span class="im">from</span> <span class="st">&#39;./components/Document&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb274-11" title="11"></a>
<a class="sourceLine" id="cb274-12" title="12"><span class="co">// For simplicity, Router and Switch are here instead of the traditional App.js</span></a>
<a class="sourceLine" id="cb274-13" title="13"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb274-14" title="14">    <span class="op">&lt;</span>Router<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb274-15" title="15">        <span class="op">&lt;</span>Switch<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb274-16" title="16">            <span class="op">&lt;</span>Route path<span class="op">=</span><span class="st">&#39;/user/:userId/doc/:docId&#39;</span> component<span class="op">={</span>Document<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb274-17" title="17">            <span class="op">{</span><span class="co">/* Other routes also */</span><span class="op">}</span></a>
<a class="sourceLine" id="cb274-18" title="18">        &lt;/Switch<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb274-19" title="19">    &lt;/Router<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb274-20" title="20">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;root&#39;</span>)</a>
<a class="sourceLine" id="cb274-21" title="21">)<span class="op">;</span></a></code></pre></div>
<h2 id="usehistory"><code>useHistory</code></h2>
<p>The <code>useHistory()</code> hook gives you access to the <strong>history</strong> object, which is a record of paths visited on the current browser tab.</p>
<p>While there are a number of possibilities for what you can do with <code>history</code>, some are more useful than others. Here are the top methods and property.</p>
<ul>
<li><code>push(path, [state])</code>
<ul>
<li>Adds a new path to the history and navigates there</li>
<li><code>state</code> object is optional</li>
</ul></li>
<li><code>replace(path, [state])</code>
<ul>
<li>Removes the current path from history before adding the new path and navigating there</li>
<li><code>state</code> object is optional</li>
<li>When the user goes back from the next path, they will skip the replaced path (either with the browser’s BACK button or the <code>goBack()</code> function)</li>
</ul></li>
<li><code>goBack()</code>
<ul>
<li>Returns to the previous path in the history</li>
</ul></li>
<li><code>location</code> - the current location
<ul>
<li><code>pathname</code> - the path</li>
<li><code>search</code> - query params (following a <code>?</code> in the url), if any</li>
<li><code>hash</code> - value following a <code>#</code> in the url, if any</li>
<li><code>state</code> - object provided with <code>push()</code> or <code>replace()</code></li>
</ul></li>
</ul>
<p>The <code>state</code> object is a way for you to pass one or more data values between routes. The sender creates the object and passes it as the second argument to <code>history.push</code> or <code>history.replace</code>; the receiver accesses the object using <code>history.location.state</code>.</p>
<p>For more capabilities, you can read the <a href="https://reactrouter.com/web/api/history">documentation on History</a>, if you so desire.</p>
<p>Here’s an example of a function component using history for custom navigation.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb275-1" title="1"><span class="co">// ./src/components/ComingSoon.js</span></a>
<a class="sourceLine" id="cb275-2" title="2"></a>
<a class="sourceLine" id="cb275-3" title="3"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span> useEffect <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span></a>
<a class="sourceLine" id="cb275-4" title="4"><span class="im">import</span> <span class="op">{</span> useHistory <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span></a>
<a class="sourceLine" id="cb275-5" title="5"></a>
<a class="sourceLine" id="cb275-6" title="6"><span class="kw">const</span> ComingSoon <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb275-7" title="7">    <span class="kw">const</span> history <span class="op">=</span> <span class="at">useHistory</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb275-8" title="8"></a>
<a class="sourceLine" id="cb275-9" title="9">    <span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb275-10" title="10">        <span class="kw">const</span> tid <span class="op">=</span> <span class="at">setTimeout</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb275-11" title="11">            <span class="va">history</span>.<span class="at">replace</span>(<span class="st">&#39;/&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb275-12" title="12">        <span class="op">},</span> <span class="dv">2000</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb275-13" title="13">        <span class="cf">return</span> () <span class="kw">=&gt;</span> <span class="at">clearTimeout</span>(tid)<span class="op">;</span></a>
<a class="sourceLine" id="cb275-14" title="14">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb275-15" title="15"></a>
<a class="sourceLine" id="cb275-16" title="16">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb275-17" title="17">        <span class="op">&lt;</span>h2<span class="op">&gt;</span>Coming Soon&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb275-18" title="18">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb275-19" title="19"><span class="op">};</span></a>
<a class="sourceLine" id="cb275-20" title="20"></a>
<a class="sourceLine" id="cb275-21" title="21"><span class="im">export</span> <span class="im">default</span> ComingSoon<span class="op">;</span></a></code></pre></div>
<blockquote>
<p>ASIDE: This example also makes use of the <code>useEffect</code> hook discussed in other lessons in order to automatically redirect the user after a timeout period. In particular, notice how <code>return</code> is used to prevent warnings in React if the user chooses to leave the page before the timeout period ends.</p>
</blockquote>
<h2 id="uselocation"><code>useLocation</code></h2>
<p>The preferred approach to accessing the location from within a component is through the history object. However, there is a special case where the <code>useLocation</code> hook is useful - connecting to a service which tracks page loads.</p>
<p>One example is <strong>Google Analytics</strong>.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb276-1" title="1"><span class="co">// ./src/index.js</span></a>
<a class="sourceLine" id="cb276-2" title="2"></a>
<a class="sourceLine" id="cb276-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb276-4" title="4"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb276-5" title="5"><span class="im">import</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb276-6" title="6">    BrowserRouter <span class="im">as</span> Router<span class="op">,</span></a>
<a class="sourceLine" id="cb276-7" title="7">    Switch<span class="op">,</span></a>
<a class="sourceLine" id="cb276-8" title="8">    useLocation</a>
<a class="sourceLine" id="cb276-9" title="9"><span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb276-10" title="10"><span class="im">import</span> ga <span class="im">from</span> <span class="st">&#39;react-ga&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb276-11" title="11"></a>
<a class="sourceLine" id="cb276-12" title="12"><span class="kw">const</span> TrackingWrapper <span class="op">=</span> (<span class="op">{</span> children <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb276-13" title="13">    <span class="kw">const</span> location <span class="op">=</span> <span class="at">useLocation</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb276-14" title="14">    <span class="va">React</span>.<span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb276-15" title="15">        <span class="va">ga</span>.<span class="at">send</span>([<span class="st">&#39;pageview&#39;</span><span class="op">,</span> <span class="va">location</span>.<span class="at">pathname</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb276-16" title="16">    <span class="op">},</span> [location])<span class="op">;</span></a>
<a class="sourceLine" id="cb276-17" title="17">    <span class="cf">return</span> children<span class="op">;</span></a>
<a class="sourceLine" id="cb276-18" title="18"><span class="op">}</span></a>
<a class="sourceLine" id="cb276-19" title="19"></a>
<a class="sourceLine" id="cb276-20" title="20"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb276-21" title="21">    <span class="op">&lt;</span>Router<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb276-22" title="22">        <span class="op">&lt;</span>TrackingWrapper<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb276-23" title="23">            <span class="op">&lt;</span>Switch<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb276-24" title="24">                <span class="op">{</span><span class="co">/* App and/or Routes, etc. */</span><span class="op">}</span></a>
<a class="sourceLine" id="cb276-25" title="25">            &lt;/Switch<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb276-26" title="26">        &lt;/TrackingWrapper<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb276-27" title="27">    &lt;/Router<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb276-28" title="28">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;root&#39;</span>)</a>
<a class="sourceLine" id="cb276-29" title="29">)<span class="op">;</span></a></code></pre></div>
<p>The setup and usage of Google Analytics is beyond the scope of this lesson. However, if you’d like to learn more you can search online for examples, such as <a href="https://levelup.gitconnected.com/using-google-analytics-with-react-3d98d709399b">Google Analytics with React</a>. In short, the call to <code>ga.send()</code> logs whatever event you pass it into your GA account. Then you can sign in to GA to view and analyze the recorded data including days and times when users are most active, what country your visitors are coming from, and much more.</p>
<h2 id="useroutematch"><code>useRouteMatch</code></h2>
<p>If you’d like to check for a matching path before rendering a route, then turn to <code>useRouteMatch</code>. This hook accepts an argument which is compared to the current path in the same fashion as <code>Route</code> and returns a boolean (<code>true</code> or <code>false</code>).</p>
<p>For example, <code>useRouteMatch('/report/advanced')</code> could be used to show (or hide, when not matching) an advanced user interface for modifying a report on the fly.</p>
<h2 id="bring-it-together">Bring it together</h2>
<p>Here is an example of a component which lays the framework for a thorough usage of React Router hooks (except <code>location</code> which is better used elsewhere). Use your detective skills to figure out as much as you can. A thorough explanation is provided in one of the video lessons.</p>
<p>Imagine the following <code>Report</code> component is placed in a router with <code>&lt;Route path={['/report/:date', '/report']} component={Report}/&gt;</code>.</p>
<blockquote>
<p>BONUS: In case you didn’t know already, a router can use an array to specify multiple paths to match with the provided component.</p>
</blockquote>
<div class="sourceCode" id="cb277"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb277-1" title="1"><span class="co">// ./src/components/Report.js</span></a>
<a class="sourceLine" id="cb277-2" title="2"></a>
<a class="sourceLine" id="cb277-3" title="3"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span>useEffect<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb277-4" title="4"><span class="im">import</span> <span class="op">{</span> useRouteMatch<span class="op">,</span> useHistory<span class="op">,</span> useParams <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb277-5" title="5"></a>
<a class="sourceLine" id="cb277-6" title="6"><span class="kw">const</span> Report <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb277-7" title="7">    <span class="kw">const</span> matchUC <span class="op">=</span> <span class="at">useRouteMatch</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb277-8" title="8">        <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/REPORT*&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb277-9" title="9">        <span class="dt">strict</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb277-10" title="10">        <span class="dt">sensitive</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb277-11" title="11">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb277-12" title="12">    <span class="kw">const</span> matchAdvanced <span class="op">=</span> <span class="at">useRouteMatch</span>([</a>
<a class="sourceLine" id="cb277-13" title="13">        <span class="st">&#39;/report/advanced&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb277-14" title="14">        <span class="st">&#39;/report/*/advanced&#39;</span></a>
<a class="sourceLine" id="cb277-15" title="15">    ])<span class="op">;</span></a>
<a class="sourceLine" id="cb277-16" title="16">    <span class="kw">const</span> matchAll <span class="op">=</span> <span class="at">useRouteMatch</span>(<span class="st">&#39;/report/all&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb277-17" title="17">    <span class="kw">const</span> <span class="op">{</span> date <span class="op">}</span> <span class="op">=</span> <span class="at">useParams</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb277-18" title="18">    <span class="kw">const</span> history <span class="op">=</span> <span class="at">useHistory</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb277-19" title="19"></a>
<a class="sourceLine" id="cb277-20" title="20">    <span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb277-21" title="21">        <span class="cf">if</span> (matchUC)</a>
<a class="sourceLine" id="cb277-22" title="22">            <span class="va">history</span>.<span class="at">replace</span>(<span class="va">history</span>.<span class="va">location</span>.<span class="va">pathname</span>.<span class="at">toLowerCase</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb277-23" title="23">    <span class="op">},</span> [matchUC<span class="op">,</span> history])</a>
<a class="sourceLine" id="cb277-24" title="24"></a>
<a class="sourceLine" id="cb277-25" title="25">    <span class="cf">if</span> (matchUC)</a>
<a class="sourceLine" id="cb277-26" title="26">        <span class="cf">return</span> <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb277-27" title="27"></a>
<a class="sourceLine" id="cb277-28" title="28">    <span class="cf">if</span> (<span class="op">!</span>date) <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb277-29" title="29">        <span class="op">&lt;</span>p<span class="op">&gt;</span>Select Report</a>
<a class="sourceLine" id="cb277-30" title="30">            <span class="op">&lt;</span>br/<span class="op">&gt;&lt;</span>button onClick<span class="op">={</span>() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb277-31" title="31">                <span class="va">history</span>.<span class="at">push</span>(<span class="st">&#39;/report/last-week&#39;</span>)</a>
<a class="sourceLine" id="cb277-32" title="32">            <span class="op">}&gt;</span>Last Week&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-33" title="33">            <span class="op">&lt;</span>br/<span class="op">&gt;&lt;</span>button onClick<span class="op">={</span>() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb277-34" title="34">                <span class="va">history</span>.<span class="at">push</span>(<span class="st">&#39;/report/last-month&#39;</span>)</a>
<a class="sourceLine" id="cb277-35" title="35">            <span class="op">}&gt;</span>Last Month&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-36" title="36">            <span class="op">&lt;</span>br/<span class="op">&gt;&lt;</span>button onClick<span class="op">={</span>() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb277-37" title="37">                <span class="va">history</span>.<span class="at">push</span>(<span class="st">&#39;/report/all&#39;</span>)</a>
<a class="sourceLine" id="cb277-38" title="38">            <span class="op">}&gt;</span>View All&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-39" title="39">        &lt;/p<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-40" title="40">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb277-41" title="41"></a>
<a class="sourceLine" id="cb277-42" title="42">    <span class="cf">if</span> (date <span class="op">===</span> <span class="st">&#39;advanced&#39;</span>) <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb277-43" title="43">        <span class="op">&lt;</span>p<span class="op">&gt;</span>Select Report</a>
<a class="sourceLine" id="cb277-44" title="44">            <span class="op">&lt;</span>br/<span class="op">&gt;&lt;</span>button onClick<span class="op">={</span>() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb277-45" title="45">                <span class="va">history</span>.<span class="at">push</span>(<span class="st">&#39;/report/last-week/&#39;</span><span class="op">+</span>date)</a>
<a class="sourceLine" id="cb277-46" title="46">            <span class="op">}&gt;</span>Last Week&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-47" title="47">            <span class="op">&lt;</span>br/<span class="op">&gt;&lt;</span>button onClick<span class="op">={</span>() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb277-48" title="48">                <span class="va">history</span>.<span class="at">push</span>(<span class="st">&#39;/report/last-month/&#39;</span><span class="op">+</span>date)</a>
<a class="sourceLine" id="cb277-49" title="49">            <span class="op">}&gt;</span>Last Month&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-50" title="50">            <span class="op">&lt;</span>br/<span class="op">&gt;&lt;</span>button onClick<span class="op">={</span>() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb277-51" title="51">                <span class="va">history</span>.<span class="at">push</span>(<span class="st">&#39;/report/all/&#39;</span><span class="op">+</span>date)</a>
<a class="sourceLine" id="cb277-52" title="52">            <span class="op">}&gt;</span>View All&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-53" title="53">        &lt;/p<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-54" title="54">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb277-55" title="55"></a>
<a class="sourceLine" id="cb277-56" title="56">    <span class="cf">if</span> (matchAll) <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb277-57" title="57">        <span class="op">&lt;&gt;</span></a>
<a class="sourceLine" id="cb277-58" title="58">            <span class="op">&lt;</span>h2<span class="op">&gt;</span>Complete Report <span class="kw">of</span> Everything&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-59" title="59">            <span class="op">{</span>matchAdvanced <span class="op">&amp;&amp;</span> <span class="op">&lt;</span>p<span class="op">&gt;</span>... <span class="at">Alternate</span> Advanced <span class="va">Controls</span> ...&lt;/p<span class="op">&gt;}</span></a>
<a class="sourceLine" id="cb277-60" title="60">        &lt;/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-61" title="61">    )</a>
<a class="sourceLine" id="cb277-62" title="62"></a>
<a class="sourceLine" id="cb277-63" title="63">    <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb277-64" title="64">        <span class="op">&lt;&gt;</span></a>
<a class="sourceLine" id="cb277-65" title="65">            <span class="op">&lt;</span>h2<span class="op">&gt;</span>Report For <span class="op">{</span>date<span class="op">}</span>&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-66" title="66">            <span class="op">{</span>matchAdvanced <span class="op">&amp;&amp;</span> <span class="op">&lt;</span>p<span class="op">&gt;</span>... <span class="at">Advanced</span> <span class="va">Controls</span> ...&lt;/p<span class="op">&gt;}</span></a>
<a class="sourceLine" id="cb277-67" title="67">        &lt;/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb277-68" title="68">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb277-69" title="69"><span class="op">};</span></a>
<a class="sourceLine" id="cb277-70" title="70"></a>
<a class="sourceLine" id="cb277-71" title="71"><span class="im">export</span> <span class="im">default</span> Report<span class="op">;</span></a></code></pre></div>
<p>The various routes to explore include</p>
<ul>
<li><code>/REPORT</code> or <code>/REPORT/SOMETHING/ADVANCED</code> or any other variation starting with REPORT in all caps will redirect to the same url in lowercase</li>
<li><code>/report</code> or <code>/report/advanced</code> will show a few buttons</li>
<li><code>/report/all</code> will show a different title than <code>/report/something-else</code> (with or without the next option)</li>
<li>any url ending in <code>/advanced</code> will show "Advanced Controls"</li>
</ul>
<h2 id="what-youve-learned">What you’ve learned</h2>
<p>The <code>react-router-dom</code> package comes with hooks you can use to simplify the code in your <strong>React</strong> applications. For example, utilizing <code>const { id } = useParams()</code> within a component displayed in the path <code>/user/:id</code> give you access to the value that replaces the <code>:id</code> parameter. Navigating can be accomplished with <code>const history = useHistory()</code> followed by <code>history.push('/a/new/path')</code>, and you can even include a <code>state</code> object as a second parameter. Additionally, <code>useLocation</code> can help you connect to tracking services, and <code>useRouteMatch</code> might come in handy once in while for pattern matching on the path itself. In short, the handling of RESTful paths in React is enhanced when you embrace the hooks available in React Router.</p>
<p>For future reference, you may want to bookmark the <a href="https://reactrouter.com/web/api/Hooks">official documentation on React Router Hooks</a>.</p>
<hr />
<h1 id="react-hooks-documentation">React Hooks Documentation</h1>
<p>You now know how to manage information in a React application through <code>state</code>, <code>props</code>, <code>context</code>, and a <code>Redux</code> store. Take a moment to read through the official React Hooks documentation. Now that you’ve been working with React for almost two weeks now, you should have a base level understanding of React and the component lifecycle. Congratulations on learning such a concept heavy library!</p>
<p>As you move forward in your development careers, you’ll need to lean more on official documentation - React’s official documentation is a great place to start! Review the following articles about from the official React Hooks documentation and try to be aware of how you navigate the documentation to aid your own learning.</p>
<h2 id="why-hooks">Why hooks?</h2>
<ul>
<li><a href="https://reactjs.org/docs/hooks-intro.html#motivation">The Motivation Behind Hooks</a></li>
<li><a href="https://reactjs.org/docs/hooks-overview.html">Hooks at a Glance</a></li>
</ul>
<h2 id="hook-basics">Hook basics</h2>
<ul>
<li><a href="https://reactjs.org/docs/hooks-rules.html">Rules of Hooks</a></li>
<li><a href="https://reactjs.org/docs/hooks-reference.html">Hooks API Reference</a></li>
<li><a href="https://reactjs.org/docs/hooks-state.html">useState</a></li>
<li><a href="https://reactjs.org/docs/hooks-effect.html">useEffect</a></li>
<li><a href="https://reactjs.org/docs/hooks-reference.html#usecontext">useContext</a></li>
<li><a href="https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects">Optimizing Performance by Skipping Effects</a></li>
</ul>
<h2 id="more-about-hooks">More about hooks</h2>
<ul>
<li><a href="https://reactjs.org/docs/hooks-custom.html">Custom Hooks</a></li>
<li><a href="https://reactjs.org/docs/hooks-faq.html">Hooks FAQ</a></li>
</ul>
<hr />
<h1 id="pokedex-hooks-project-phase-1">Pokedex Hooks Project: Phase 1</h1>
<p>In today’s project you will refactor class-based components that make use of lifecycle methods to function components that make use of React Hooks! At this point, you have already built an application with class components and context to manage application state. You’ve also built the same application to learn about how to use Redux instead of React Context for state-management.</p>
<p>In this project, you’ll build your application with React and Redux hooks! You will implement the:</p>
<ul>
<li><code>useState</code> hook to manage a component’s state</li>
<li><code>useEffect</code> hook to manage a component’s side effect operations</li>
<li><code>useDispatch</code> hook to dispatch actions from with a component file</li>
<li><code>useSelector</code> hook access slices of state from the Redux store</li>
<li><code>useContext</code> hook to manage your application with Context instead of Redux</li>
</ul>
<h2 id="phase-1-state-based-hooks-application">Phase 1: State-based hooks application</h2>
<p>You’ll need the backend for the Pokedex application. Take a moment to clone it from https://github.com/-starters/pokedex-backend and get it set up.</p>
<p>The API for the backend is also documented in repository’s README.</p>
<p>Once you have that up and running, you’ll begin working out of the solution for the state-based class components project. Begin by cloning the state-based application from https://github.com/-starters/react-hooks-pokedex-starter.git.</p>
<p>Throughout today, you’ll work on refactoring each class component in the application to be a function component that makes use of React Hooks!</p>
<h3 id="explore-the-reference-application">Explore the reference application</h3>
<p>As you might remember, your current application comprises of the following components:</p>
<ul>
<li><code>App</code>: Does the browser routing and top-level fetches of data to draw the data</li>
<li><code>LoginPanel</code>: Shows the login panel</li>
<li><code>PokemonBrowser</code>: The browser that draws the list on the left after logging in and has a route to the <code>PokemonDetail</code> when the route matches "/pokemon/:id"</li>
<li><code>PokemonDetail</code>: Makes a fetch to the API on mount and update to load the details of the selected Pokemon</li>
</ul>
<h3 id="refactor-components">Refactor components</h3>
<p>As you’re refactoring your application’s components, you’ll most likely hit bugs and break your application. While you’re refactoring each component, make sure to test that your refactored code is working before moving on to refactor the next component. As a general guideline, you should refactor each component from the lowest, most nested component up to the top-most parent:</p>
<ol type="1">
<li><code>PokemonDetail</code></li>
<li><code>PokemonBrowser</code></li>
<li><code>LoginPanel</code></li>
<li><code>App</code></li>
</ol>
<p>You’ll update how each component sets its default state by using the <code>useState</code> hook. You’ll also refactor the lifecycle methods of each component into side effect operations managed by the <code>useEffect</code> hook. At the end of this exercise, you should have a good understanding of how to use the basic <code>useState</code> and <code>useEffect</code> hooks to write function components with side effect operations.</p>
<p>Take this project as a way to practice learning new technologies by referencing official documentation:</p>
<ul>
<li><a href="https://reactjs.org/docs/hooks-state.html">Using the State Hook</a></li>
<li><a href="https://reactjs.org/docs/hooks-effect.html">Using the Effect Hook</a></li>
<li><a href="https://reactjs.org/docs/hooks-reference.html">Hooks API Reference</a></li>
</ul>
<p>Remember, Create React App will let your React application use environment variables that start with <code>REACT_APP_</code>. Just like with your state-based application built with class components, you can import environment variables from the <code>config.js</code> file to clean up your code for specifying the URL of the backend.</p>
<p>Once you have finished refactoring, take a moment to commit your changes to the main branch of your <code>react-hooks-pokedex-starter</code> project:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb278-1" title="1"><span class="fu">git</span> add .</a>
<a class="sourceLine" id="cb278-2" title="2"><span class="fu">git</span> commit -m <span class="st">&quot;Refactor app to implement hooks&quot;</span></a></code></pre></div>
<p>In the next two phases, you’ll create two different projects in two different branches that use this commit as a starting point. You’ll branch off from this point to create a Redux-based project and a Context-based project (both utilizing hooks).</p>
<hr />
<h1 id="pokedex-hooks-project-phase-2">Pokedex Hooks Project: Phase 2</h1>
<p>As you might remember from the Redux-based Pokedex project, implementing Redux results in a lot of boilerplate code. Using Redux hooks can help clean up and get rid of a lot of boilerplate code. In this phase you will refactor the Redux-based project to use React hooks and implement Redux hooks!</p>
<p>Begin by creating a new branch for your Redux-based application:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb279-1" title="1"><span class="fu">git</span> checkout -b redux-hooks-app</a></code></pre></div>
<p>Take a moment to download the <a href="https://-open-assets.s3-us-west-1.amazonaws.com/Modular-Curriculum/content/react-redux/topics/react-hooks/projects/pokedex-hooks/starter-redux-based-hooks.zip">Redux-based Pokedex hooks starter project</a>. Make sure you are in your new <code>redux-hooks-app</code> branch:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb280-1" title="1"><span class="fu">git</span> branch</a></code></pre></div>
<p>Delete all of your project’s current code and move the files of <code>redux-based-pokedex-solution</code> into your current directory (<code>react-hooks-pokedex-starter</code>). For example, if both project directories are within the same directory, you can use the <code>mv</code> command from the two project folders’ parent directory.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb281-1" title="1"><span class="fu">mv</span> -v redux-based-pokedex-solution/* react-hooks-pokedex-starter</a></code></pre></div>
<p>Now take a moment to commit the start of your Redux-based project:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb282-1" title="1"><span class="fu">git</span> add .</a>
<a class="sourceLine" id="cb282-2" title="2"><span class="fu">git</span> commit -m <span class="st">&quot;Initialize redux hooks starter project&quot;</span></a></code></pre></div>
<h2 id="using-redux-hooks-to-manage-application-state">Using Redux hooks to manage application state</h2>
<p>In this phase, you’ll be refactoring all your component files to use Redux hooks instead of the <code>mapStateToProps</code>, <code>mapDispatchToProps</code>, and Redux <code>connect</code> functions. Just like in phase 1, you might hit bugs and break your application while refactoring your application’s components. Make sure to test that your refactored code is working before moving on to refactor the next component. As a general overview, you’ll be refactoring the code for the following components:</p>
<ol type="1">
<li><code>LogoutButton</code></li>
<li><code>LoginPanel</code></li>
<li><code>PokemonDetail</code></li>
<li><code>PokemonForm</code></li>
<li><code>PokemonBrowser</code></li>
</ol>
<p>There are two ways you can refactor your project:</p>
<ol type="1">
<li>You can refactor your project to use the <code>useDispatch</code> and <code>useSelector</code> hooks in a <em>container</em> component.</li>
<li>You can refactor your project to use the <code>useDispatch</code> and <code>useSelector</code> hooks within the component itself.</li>
</ol>
<p>You can choose either method to refactor your project. At this point, you are a full-fledged React developer - it’s time for you to start planning your own React code! Talk things through with your partner and decide which way you would like to begin refactoring your project. Remember, as you are using this project as practice for implementing Redux hooks, you can always implement Redux hooks into a container component for one component, and then implement Redux hooks directly in another component for the next component. Just make sure to choose one method to stick with for your personal React projects!</p>
<h3 id="version-1-using-redux-hooks-in-a-container-component">Version 1: Using Redux hooks in a container component</h3>
<p>If you chose to use the <code>useDispatch</code> and <code>useSelector</code> hooks in a <em>container</em> component, this means you should use a namespace to import actions into each component file. For example, in the <code>LogoutButton.js</code> file, you currently have the following import statement that imports the <code>logout</code> action creator function:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb283-1" title="1"><span class="im">import</span> <span class="op">{</span> logout <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../actions/authentication&#39;</span><span class="op">;</span></a></code></pre></div>
<p>In order to remove confusion about whether an invocation of <code>logout()</code> is invoking the <code>logout</code> prop or the <code>logout</code> action creator function, you can update the import statement for your logout action to use an <code>AuthAction</code> namespace:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb284-1" title="1"><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> AuthAction <span class="im">from</span> <span class="st">&#39;../actions/authentication&#39;</span><span class="op">;</span></a></code></pre></div>
<p>This way, you can create a container component to replace what is happening under the hood with the <code>mapStateToProps</code>, <code>mapDispatchToProps</code>, and <code>connect</code> functions. You can reference the logout action with the <code>AuthAction</code> namepsace, like so: <code>AuthAction.logout</code>.</p>
<p>Based on the <code>mapStateToProps</code> and <code>mapDispatchToProps</code> functions in the <code>LogoutButton.js</code> file, you can tell that the component is accessing Redux by receiving <code>loggedOut</code> and <code>logout</code> props:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb285-1" title="1"><span class="kw">const</span> mapStateToProps <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb285-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb285-3" title="3">    <span class="dt">loggedOut</span><span class="op">:</span> <span class="op">!</span><span class="va">state</span>.<span class="va">authentication</span>.<span class="at">token</span><span class="op">,</span></a>
<a class="sourceLine" id="cb285-4" title="4">  <span class="op">};</span></a>
<a class="sourceLine" id="cb285-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb285-6" title="6"></a>
<a class="sourceLine" id="cb285-7" title="7"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb285-8" title="8">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb285-9" title="9">    <span class="dt">logout</span><span class="op">:</span> () <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">logout</span>())<span class="op">,</span></a>
<a class="sourceLine" id="cb285-10" title="10">  <span class="op">};</span></a>
<a class="sourceLine" id="cb285-11" title="11"><span class="op">};</span></a>
<a class="sourceLine" id="cb285-12" title="12"></a>
<a class="sourceLine" id="cb285-13" title="13"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps)(LogoutButton)<span class="op">;</span></a></code></pre></div>
<p>Take a moment to import the <code>useSelector</code> and <code>useDispatch</code> from the Redux library into the file:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb286-1" title="1"><span class="im">import</span> <span class="op">{</span> useDispatch<span class="op">,</span> useSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Now you’ll write a container component that will replace the <code>mapStateToProps</code>, <code>mapDispatchToProps</code>, and <code>connect</code> functions! Start by setting up the container component that returns the <code>LogoutButton</code> component to use the <code>useDispatch</code> prop. You’ll also want to have the <code>LogoutButton.js</code> file export the <code>LogoutButtonContainer</code> component (instead of the higher-order component returned by the <code>connect</code> function):</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb287-1" title="1"><span class="kw">const</span> LogoutButtonContainer <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb287-2" title="2">  <span class="kw">const</span> dispatch <span class="op">=</span> <span class="at">useDispatch</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb287-3" title="3"></a>
<a class="sourceLine" id="cb287-4" title="4">  <span class="cf">return</span> <span class="op">&lt;</span>LogoutButton /<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb287-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb287-6" title="6"></a>
<a class="sourceLine" id="cb287-7" title="7"><span class="im">export</span> <span class="im">default</span> LogoutButtonContainer<span class="op">;</span></a></code></pre></div>
<blockquote>
<p>Feel free to visit the Redux Hooks documentation to view <a href="https://react-redux.js.org/next/api/hooks#examples"><code>useDispatch</code> examples</a>.</p>
</blockquote>
<p>Now that you have the container component and <code>dispatch</code> set up, you can pass dispatched version of the <code>logout</code> action as a prop into the <code>LogoutButton</code> component:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb288-1" title="1"><span class="kw">const</span> LogoutButtonContainer <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb288-2" title="2">  <span class="kw">const</span> dispatch <span class="op">=</span> <span class="at">useDispatch</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb288-3" title="3">  <span class="kw">const</span> logout <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="va">AuthAction</span>.<span class="at">logout</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb288-4" title="4"></a>
<a class="sourceLine" id="cb288-5" title="5">  <span class="cf">return</span> <span class="op">&lt;</span>LogoutButton logout<span class="op">={</span>logout<span class="op">}</span> /&gt;<span class="op">;</span></a>
<a class="sourceLine" id="cb288-6" title="6"><span class="op">};</span></a></code></pre></div>
<p>At this point, the container component is taking care of what the <code>mapDispatchToProps</code> function took care of! Now let’s use the <code>useSelector</code> hook to take care of what the <code>mapStateToProps</code> function took care of:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb289-1" title="1"><span class="kw">const</span> LogoutButtonContainer <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb289-2" title="2">  <span class="kw">const</span> dispatch <span class="op">=</span> <span class="at">useDispatch</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb289-3" title="3">  <span class="kw">const</span> logout <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="va">AuthAction</span>.<span class="at">logout</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb289-4" title="4">  <span class="kw">const</span> loggedOut <span class="op">=</span> <span class="at">useSelector</span>(state <span class="kw">=&gt;</span> <span class="op">!</span><span class="va">state</span>.<span class="va">authentication</span>.<span class="at">token</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb289-5" title="5"></a>
<a class="sourceLine" id="cb289-6" title="6">  <span class="cf">return</span> <span class="op">&lt;</span>LogoutButton logout<span class="op">={</span>logout<span class="op">}</span> /&gt;<span class="op">;</span></a>
<a class="sourceLine" id="cb289-7" title="7"><span class="op">};</span></a></code></pre></div>
<blockquote>
<p>Feel free to visit the Redux Hooks documentation to view <a href="https://react-redux.js.org/next/api/hooks#useselector-examples"><code>useSelector</code> examples</a>.</p>
</blockquote>
<p>Now that you’ve gone over how to create a container component that implements Redux Hooks for the <code>LogoutButton</code> component, follow the same pattern to implement Redux hooks into container components for your <code>LoginPanel</code>, <code>PokemonDetail</code>, <code>PokemonForm</code>, and <code>PokemonBrowser</code> components. Feel free to practice implementing Redux hooks directly within a component instead!</p>
<h3 id="version-2-using-redux-hooks-from-within-a-component">Version 2: Using Redux hooks from within a component</h3>
<p>If you chose to use the <code>useDispatch</code> and <code>useSelector</code> hooks within the component itself, you’ll need to do some refactoring so that your component doesn’t receive any props. Instead of receiving slices of state and dispatchable action functions as props, you will use the <code>useSelector</code> hook to access a slice a state from within the component and the <code>useDispatch</code> hook to dispatch actions from within the component.</p>
<p>Based on the <code>mapStateToProps</code> and <code>mapDispatchToProps</code> functions in the <code>LogoutButton.js</code> file, you can tell that the component is accessing Redux by receiving <code>loggedOut</code> and <code>logout</code> props.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb290-1" title="1"><span class="kw">const</span> mapStateToProps <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb290-2" title="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb290-3" title="3">    <span class="dt">loggedOut</span><span class="op">:</span> <span class="op">!</span><span class="va">state</span>.<span class="va">authentication</span>.<span class="at">token</span><span class="op">,</span></a>
<a class="sourceLine" id="cb290-4" title="4">  <span class="op">};</span></a>
<a class="sourceLine" id="cb290-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb290-6" title="6"></a>
<a class="sourceLine" id="cb290-7" title="7"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb290-8" title="8">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb290-9" title="9">    <span class="dt">logout</span><span class="op">:</span> () <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">logout</span>())<span class="op">,</span></a>
<a class="sourceLine" id="cb290-10" title="10">  <span class="op">};</span></a>
<a class="sourceLine" id="cb290-11" title="11"><span class="op">};</span></a>
<a class="sourceLine" id="cb290-12" title="12"></a>
<a class="sourceLine" id="cb290-13" title="13"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps)(LogoutButton)<span class="op">;</span></a></code></pre></div>
<p>Take a moment to import the <code>useSelector</code> and <code>useDispatch</code> from the Redux library into the file.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb291-1" title="1"><span class="im">import</span> <span class="op">{</span> useDispatch<span class="op">,</span> useSelector <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Now you’ll want to remove all the props that the <code>LogoutButton</code> receives. Instead of receiving props to access the <code>loggedOut</code> state and dispatched <code>logout</code> function, you’ll use the <code>useSelector</code> and <code>useDispatch</code> hook you just imported into the file. At this point, your <code>LogoutButton</code> component should look something like this:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb292-1" title="1"><span class="kw">const</span> LogoutButton <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb292-2" title="2">  <span class="cf">if</span> (loggedOut) <span class="op">{</span></a>
<a class="sourceLine" id="cb292-3" title="3">    <span class="cf">return</span> <span class="op">&lt;</span>Redirect to<span class="op">=</span><span class="st">&quot;/login&quot;</span> /&gt;<span class="op">;</span></a>
<a class="sourceLine" id="cb292-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb292-5" title="5"></a>
<a class="sourceLine" id="cb292-6" title="6">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb292-7" title="7">    <span class="op">&lt;</span>div id<span class="op">=</span><span class="st">&quot;logout-button-holder&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb292-8" title="8">      <span class="op">&lt;</span>button onClick<span class="op">={</span>handleClick<span class="op">}&gt;</span>Logout&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb292-9" title="9">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb292-10" title="10">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb292-11" title="11"><span class="op">};</span></a></code></pre></div>
<p>Now you’ll use Redux hooks within the <code>LoginButton</code> component so that you can remove the <code>mapStateToProps</code>, <code>mapDispatchToProps</code>, and <code>connect</code> functions! Instead of receiving a <code>loggedOut</code> prop, you’ll use the <code>useSelector</code> hook to access the state’s <code>authentication.token</code>.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb293-1" title="1"><span class="kw">const</span> LogoutButton <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb293-2" title="2">  <span class="kw">const</span> loggedOut <span class="op">=</span> <span class="at">useSelector</span>(state <span class="kw">=&gt;</span> <span class="op">!</span><span class="va">state</span>.<span class="va">authentication</span>.<span class="at">token</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb293-3" title="3">  </a>
<a class="sourceLine" id="cb293-4" title="4">  <span class="co">// CODE SHORTENED FOR BREVITY</span></a>
<a class="sourceLine" id="cb293-5" title="5"><span class="op">};</span></a></code></pre></div>
<blockquote>
<p>Feel free to visit the Redux Hooks documentation to view <a href="https://react-redux.js.org/next/api/hooks#useselector-examples"><code>useSelector</code> examples</a>.</p>
</blockquote>
<p>Notice how the <code>logout</code> thunk action creator function has already been imported into your <code>LogoutButton.js</code> file. You’ll use <code>useDispatch</code> hook to return a reference to the <code>dispatch</code> function from the Redux store:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb294-1" title="1"><span class="kw">const</span> dispatch <span class="op">=</span> <span class="at">useDispatch</span>()<span class="op">;</span></a></code></pre></div>
<p>Then you can use the <code>dispatch</code> function to dispatch the <code>logout</code> function:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb295-1" title="1"><span class="kw">const</span> LogoutButton <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb295-2" title="2">  <span class="kw">const</span> loggedOut <span class="op">=</span> <span class="at">useSelector</span>(state <span class="kw">=&gt;</span> <span class="op">!</span><span class="va">state</span>.<span class="va">authentication</span>.<span class="at">token</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb295-3" title="3">  <span class="kw">const</span> dispatch <span class="op">=</span> <span class="at">useDispatch</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb295-4" title="4">  <span class="kw">const</span> handleClick <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">logout</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb295-5" title="5"></a>
<a class="sourceLine" id="cb295-6" title="6">  <span class="co">// CODE SHORTENED FOR BREVITY</span></a>
<a class="sourceLine" id="cb295-7" title="7"><span class="op">};</span></a></code></pre></div>
<blockquote>
<p>Feel free to visit the Redux Hooks documentation to view <a href="https://react-redux.js.org/next/api/hooks#examples"><code>useDispatch</code> examples</a>.</p>
</blockquote>
<p>Lastly, you’ll want to remove the <code>mapStateToProps</code> and <code>mapDispatchToProps</code> functions from the file, and replace the <code>connect</code> function to an export statement that exports the <code>LoginButton</code> component by default:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb296-1" title="1"><span class="im">export</span> <span class="im">default</span> LoginButton<span class="op">;</span></a></code></pre></div>
<p>Now that you’ve gone over how to refactor your <code>LogoutButton</code> component, follow the same pattern to implement Redux hooks into your <code>LoginPanel</code>, <code>PokemonDetail</code>, <code>PokemonForm</code>, and <code>PokemonBrowser</code> components. Feel free to practice creating a container component that utilizes Redux hooks instead!</p>
<h3 id="router-hooks-useparams">Router hooks: <code>useParams</code></h3>
<p>Notice the references to the React Router <code>match</code> prop accessed in your <code>PokemonBrowser</code> and <code>PokemonDetail</code> components. Instead of having your component take in a <code>match</code> prop to access the route parameters, you’ll implement the <code>useParams</code> prop and use object destructuring to access the <code>pokemonId</code> parameter in the <code>PokemonBrowser</code> component and the <code>id</code> parameter in the <code>PokemonDetail</code> component. Feel free to visit React Router documentation to view examples of using the <a href="https://reactrouter.com/web/api/Hooks/useparams"><code>useParams</code> hook</a>.</p>
<p>Once you have finished refactoring, take a moment to commit your changes to your <code>redux-hooks-app</code> branch:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb297-1" title="1"><span class="fu">git</span> add .</a>
<a class="sourceLine" id="cb297-2" title="2"><span class="fu">git</span> commit -m <span class="st">&quot;Refactor app to implement redux hooks&quot;</span></a></code></pre></div>
<p>Now that you have practiced refactoring your application to implement Redux hooks, it’s time to work on a Context-based project utilizing React’s <code>useContext</code> hook! In the next phase, you’ll branch off from your application’s main branch to create a new <code>context-hooks-app</code> branch for the project.</p>
<hr />
<h1 id="pokedex-hooks-project-phase-3">Pokedex Hooks Project: Phase 3</h1>
<p>At this point, you’ve managed a state-based project with the <code>useState</code> and <code>useEffect</code> hooks and a Redux-based project with the <code>useSelector</code> and <code>useDispatch</code> hooks. Now you’ll work off of the state-based project you built in Phase 2 to manage your application’s state with the <code>useContext</code> hook!</p>
<p>Begin by creating a new branch for your Context-based application off of your main branch:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb298-1" title="1"><span class="fu">git</span> checkout master</a>
<a class="sourceLine" id="cb298-2" title="2"><span class="fu">git</span> checkout -b context-hooks-app</a></code></pre></div>
<h2 id="using-the-usecontext-hook-to-manage-application-state">Using the <code>useContext</code> hook to manage application state</h2>
<p>Think of how you created a Redux cycle to pass Pokedex information through your components. Now you’ll manage your application’s global information by using React Context instead! Remember that you still generate context with the <code>createContext</code> function, just as you would for class components. You also still use <code>&lt;Context.Provider&gt;</code> components to set the <code>value</code> of your context object.</p>
<p>Think of how you would make use of the <code>useContext</code> hook instead of Redux’s <code>connect()</code> function to pass slices of state as well as functions to update the global state. As you use the <code>useEffect</code> hook for side effect operations, think of conditions where you would want to prevent the effect from running. Remember to set the variables that determine these conditions in the <code>useEffect</code> hook’s dependency array.</p>
<h3 id="providing-context">Providing context</h3>
<p>Begin by creating a <code>PokemonContext</code> with the <code>createContext</code> function from React. Then you’ll need to set the context value with a <code>&lt;Context.Provider&gt;</code> component by making a wrapper Provider component for the <code>App</code> component. Create an <code>AppWithContext</code> component as the wrapper component for <code>App</code>.The wrapper component will have the following slices of state:</p>
<ul>
<li><code>pokemon</code> - defaults to an empty array.</li>
<li><code>singlePokemon</code> - defaults to <code>null</code>.</li>
<li><code>authToken</code> - defaults to the <code>state-pokedex-token</code> item stored in <code>localStorage</code>.</li>
<li><code>needLogin</code> - defaults to the <em>truthyness</em> of the <code>state-pokedex-token</code> item stored in <code>localStorage</code> (hint: you can use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_Operators#Double_NOT_!!">double not</a> <code>!!</code> notation).</li>
</ul>
<p>The wrapper component will also pass the following functions as the context <code>value</code>:</p>
<ul>
<li><code>login(token)</code> - to set the <code>state-pokedex-token</code> item in <code>localStorage</code>, update the <code>authToken</code> state, and update the <code>needLogin</code> state to <code>false</code>.</li>
<li><code>loadPokemon()</code> - to fetch all pokemon and update the <code>pokemon</code> state.</li>
<li><code>getOnePokemon(id)</code> - to fetch one pokemon and update the <code>singlePokemon</code> state.</li>
</ul>
<p>After you have set up the wrapper component, make sure to replace the <code>App</code> that is rendered in your <code>index.js</code> file with your new <code>AppWithContext</code> wrapper component. Now it’s time to change your application from being a state-based application to a context-based application.</p>
<p>Begin by removing all props that are passed between components. You’ll use the hooks and the <code>PokemonContext</code> value to manage the global state of your application instead. Make sure to even remove the <code>match</code> prop you access in the <code>PokemonDetail</code> component. You’ll use the <a href="https://reacttraining.com/blog/react-router-v5-1/#useparams">useParams</a> hook from <a href="https://reacttraining.com/blog/react-router-v5-1/">React Router v5.1</a> instead of the <code>match</code> prop.</p>
<h3 id="consuming-context-with-the-usecontext-hook">Consuming context with the useContext hook</h3>
<p>Your application’s consuming components should access the <code>PokemonContext</code> through using the <code>useContext</code> hook. Feel free to reference the <a href="https://reactjs.org/docs/hooks-reference.html">Hooks API Reference</a> to revisit the documentation on the <code>useContext</code> hook. As a reminder, the <code>useContext</code> hook replaces the <code>static contextType</code> property of class components:</p>
<h3 id="static-contexttype">static contextType</h3>
<div class="sourceCode" id="cb299"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb299-1" title="1"><span class="co">// Receive access to context in class components:</span></a>
<a class="sourceLine" id="cb299-2" title="2"><span class="kw">static</span> contextType <span class="op">=</span> PokemonContext<span class="op">;</span></a>
<a class="sourceLine" id="cb299-3" title="3"></a>
<a class="sourceLine" id="cb299-4" title="4"><span class="co">// Access context with the `contextType` property:</span></a>
<a class="sourceLine" id="cb299-5" title="5"><span class="kw">this</span>.<span class="at">context</span></a></code></pre></div>
<h3 id="usecontext-1">useContext</h3>
<div class="sourceCode" id="cb300"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb300-1" title="1"><span class="co">// Receive access to context with React Hooks in function components:</span></a>
<a class="sourceLine" id="cb300-2" title="2"><span class="kw">const</span> context <span class="op">=</span> <span class="at">useContext</span>(PokemonContext)<span class="op">;</span></a>
<a class="sourceLine" id="cb300-3" title="3"></a>
<a class="sourceLine" id="cb300-4" title="4"><span class="co">// Access context with the `useContext` hook:</span></a>
<a class="sourceLine" id="cb300-5" title="5">context</a></code></pre></div>
<p>Now it’s time to set up how your application components <em>consume</em> the <code>PokemonContext</code>!</p>
<p>Feel free to console log the <code>context</code> in any component you are accessing the <code>PokemonContext</code>. It could be helpful to create an application state logging system like so:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb301-1" title="1"><span class="kw">const</span> context <span class="op">=</span> <span class="at">useContext</span>(PokemonContext)<span class="op">;</span></a>
<a class="sourceLine" id="cb301-2" title="2"><span class="va">console</span>.<span class="at">log</span>(context)<span class="op">;</span></a></code></pre></div>
<p>This way upon the mounting of a component, you have a general sense of the <code>context</code> object the component is receiving. Since you’ll be using Hooks and Context to manage your user authentication, you may need to clear your <code>localStorage</code> items to reset your application to allow for future testing and debugging. As a reminder, you can go to the <code>Application</code> tab of your developer tools to find a <code>Storage</code> section with your <code>Local Storage</code> items. There you can right click to delete all items stored in <code>localStorage</code>.</p>
<h3 id="app-1">App</h3>
<p>Take a moment to compare the code that currently lives in your <code>AppWithContext</code> with the code that lives in you <code>App</code> component. Notice how there is a lot of duplicated logic. This is because you <code>App</code> was the main component managing your application’s state-based information. Now that you have moved all the logic to your <code>AppWithContext</code> component, you can refactor your <code>App</code> component to simply use the <code>useContext</code> hook to pass the <code>needLogin</code> value to the <code>&lt;PrivateRoute&gt;</code> it renders. You can also remove all other props passed through the routes. Your refactored <code>App</code> component should look something like this:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb302-1" title="1"><span class="co">// App.js</span></a>
<a class="sourceLine" id="cb302-2" title="2"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span> useContext <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb302-3" title="3"><span class="im">import</span> <span class="op">{</span> BrowserRouter<span class="op">,</span> Route<span class="op">,</span> Switch <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb302-4" title="4"></a>
<a class="sourceLine" id="cb302-5" title="5"><span class="im">import</span> <span class="op">{</span> PrivateRoute <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./routesUtil&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb302-6" title="6"><span class="im">import</span> LoginPanel <span class="im">from</span> <span class="st">&#39;./LoginPanel&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb302-7" title="7"><span class="im">import</span> PokemonBrowser <span class="im">from</span> <span class="st">&#39;./PokemonBrowser&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb302-8" title="8"><span class="im">import</span> <span class="op">{</span> PokemonContext <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./PokemonContext&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb302-9" title="9"></a>
<a class="sourceLine" id="cb302-10" title="10"><span class="kw">const</span> App <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb302-11" title="11">  <span class="kw">const</span> <span class="op">{</span> needLogin <span class="op">}</span> <span class="op">=</span> <span class="at">useContext</span>(PokemonContext)<span class="op">;</span></a>
<a class="sourceLine" id="cb302-12" title="12"></a>
<a class="sourceLine" id="cb302-13" title="13">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb302-14" title="14">    <span class="op">&lt;</span>BrowserRouter<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb302-15" title="15">      <span class="op">&lt;</span>Switch<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb302-16" title="16">        <span class="op">&lt;</span>Route path<span class="op">=</span><span class="st">&quot;/login&quot;</span> component<span class="op">={</span>LoginPanel<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb302-17" title="17">        <span class="op">&lt;</span>PrivateRoute</a>
<a class="sourceLine" id="cb302-18" title="18">          path<span class="op">=</span><span class="st">&quot;/&quot;</span></a>
<a class="sourceLine" id="cb302-19" title="19">          component<span class="op">={</span>PokemonBrowser<span class="op">}</span></a>
<a class="sourceLine" id="cb302-20" title="20">          needLogin<span class="op">={</span>needLogin<span class="op">}</span></a>
<a class="sourceLine" id="cb302-21" title="21">        /&gt;</a>
<a class="sourceLine" id="cb302-22" title="22">      &lt;/Switch<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb302-23" title="23">    &lt;/BrowserRouter<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb302-24" title="24">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb302-25" title="25"><span class="op">}</span></a>
<a class="sourceLine" id="cb302-26" title="26"></a>
<a class="sourceLine" id="cb302-27" title="27"><span class="im">export</span> <span class="im">default</span> App<span class="op">;</span></a></code></pre></div>
<h3 id="loginpanel">LoginPanel</h3>
<p>Let’s begin by refactoring your <code>LoginPanel</code> component! The <code>LoginPanel</code> should access the context’s <code>login</code> function. Feel free to also access the <code>authToken</code> value for testing purposes. Note that you can also destructure the context object, like so:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb303-1" title="1"><span class="kw">const</span> <span class="op">{</span> login<span class="op">,</span> authToken <span class="op">}</span> <span class="op">=</span> <span class="at">useContext</span>(PokemonContext)<span class="op">;</span></a>
<a class="sourceLine" id="cb303-2" title="2"><span class="va">console</span>.<span class="at">log</span>(authToken)<span class="op">;</span></a></code></pre></div>
<p>You’ll want to make sure that your <code>LoginPanel</code> has the following slices of state:</p>
<ul>
<li><code>loggedIn</code> - defaults to <code>false</code>.</li>
<li><code>email</code> - defaults to <code>'demo@example.com'</code>.</li>
<li><code>password</code> - defaults to <code>'password'</code>.</li>
</ul>
<p>Your <code>LoginPanel</code> component should also hold the following three functions:</p>
<ul>
<li><code>handleSubmit</code> - to make a fetch request to your API, update the <code>loggedIn</code> state, and invoke the context’s <code>login</code> function with the <code>token</code> from the fetch response.</li>
<li><code>updateEmail</code> - to update the <code>email</code> slice of state.</li>
<li><code>updatePassword</code> - to update the <code>password</code> slice of state.</li>
</ul>
<p>Lastly, your <code>LoginPanel</code> should redirect logged in users to the home page, based on the <code>loggedIn</code> slice of state:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb304-1" title="1"><span class="cf">if</span> (loggedIn) <span class="cf">return</span> <span class="op">&lt;</span>Redirect to<span class="op">=</span><span class="st">&quot;/&quot;</span> /&gt;<span class="op">;</span></a></code></pre></div>
<p>Now you’ll want to set up your <code>PokemonBrowser</code> component before testing the login flow and home page redirection - you’ll hit a lot of errors if you don’t refactor your <code>PokemonBrowser</code> correctly first.</p>
<h3 id="pokemonbrowser">PokemonBrowser</h3>
<p>At this point, your <code>PokemonBrowser</code> component should look something like this:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb305-1" title="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">&quot;react&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb305-2" title="2"><span class="im">import</span> <span class="op">{</span> NavLink<span class="op">,</span> Route <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;react-router-dom&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb305-3" title="3"><span class="im">import</span> <span class="op">{</span> imageUrl <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;./config&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb305-4" title="4"><span class="im">import</span> PokemonDetail <span class="im">from</span> <span class="st">&quot;./PokemonDetail&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb305-5" title="5"></a>
<a class="sourceLine" id="cb305-6" title="6"><span class="kw">const</span> PokemonBrowser <span class="op">=</span> (<span class="op">{</span> pokemon<span class="op">,</span> token <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb305-7" title="7">  <span class="cf">if</span> (<span class="op">!</span>pokemon) <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb305-8" title="8"></a>
<a class="sourceLine" id="cb305-9" title="9">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb305-10" title="10">    <span class="op">&lt;</span>main<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb305-11" title="11">      <span class="op">&lt;</span>nav<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb305-12" title="12">        <span class="op">{</span><span class="va">pokemon</span>.<span class="at">map</span>((poke) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb305-13" title="13">          <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb305-14" title="14">            <span class="op">&lt;</span>NavLink key<span class="op">={</span><span class="va">poke</span>.<span class="at">name</span><span class="op">}</span> to<span class="op">={</span><span class="vs">`/pokemon/</span><span class="sc">${</span><span class="va">poke</span>.<span class="at">id</span><span class="sc">}</span><span class="vs">`</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb305-15" title="15">              <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;nav-entry&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb305-16" title="16">                <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;nav-entry-image&quot;</span></a>
<a class="sourceLine" id="cb305-17" title="17">                  style<span class="op">={{</span></a>
<a class="sourceLine" id="cb305-18" title="18">                    <span class="dt">backgroundImage</span><span class="op">:</span> <span class="vs">`url(&#39;</span><span class="sc">${</span>imageUrl<span class="sc">}${</span><span class="va">poke</span>.<span class="at">imageUrl</span><span class="sc">}</span><span class="vs">&#39;)`</span></a>
<a class="sourceLine" id="cb305-19" title="19">                  <span class="op">}}</span> /&gt;</a>
<a class="sourceLine" id="cb305-20" title="20">                <span class="op">&lt;</span>h1<span class="op">&gt;{</span><span class="va">poke</span>.<span class="at">name</span><span class="op">}</span>&lt;/h1<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb305-21" title="21">              &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb305-22" title="22">            &lt;/NavLink<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb305-23" title="23">          )<span class="op">;</span></a>
<a class="sourceLine" id="cb305-24" title="24">        <span class="op">}</span>)<span class="op">}</span></a>
<a class="sourceLine" id="cb305-25" title="25">      &lt;/nav<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb305-26" title="26">      <span class="op">&lt;</span>Route</a>
<a class="sourceLine" id="cb305-27" title="27">        path<span class="op">=</span><span class="st">&quot;/pokemon/:id&quot;</span></a>
<a class="sourceLine" id="cb305-28" title="28">        render<span class="op">={</span>(props) <span class="kw">=&gt;</span> <span class="op">&lt;</span>PokemonDetail <span class="op">{</span>...<span class="at">props</span><span class="op">}</span> token<span class="op">={</span>token<span class="op">}</span> /&gt;<span class="op">}</span></a>
<a class="sourceLine" id="cb305-29" title="29">      /&gt;</a>
<a class="sourceLine" id="cb305-30" title="30">    &lt;/main<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb305-31" title="31">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb305-32" title="32"><span class="op">};</span></a>
<a class="sourceLine" id="cb305-33" title="33"></a>
<a class="sourceLine" id="cb305-34" title="34"><span class="im">export</span> <span class="im">default</span> PokemonBrowser<span class="op">;</span></a></code></pre></div>
<p>You won’t need to refactor any existing code within component, except removing the props it receives. You’ll simply use the <code>useContext</code> hook to access the <code>PokemonContext</code> and use the <code>useEffect</code> hook to update the context’s <code>pokemon</code>.</p>
<p>Begin by having your <code>PokemonBrowser</code> component access the context’s <code>pokemon</code> and <code>loadPokemon</code> function:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb306-1" title="1"><span class="kw">const</span> <span class="op">{</span> pokemon<span class="op">,</span> loadPokemon <span class="op">}</span> <span class="op">=</span> <span class="at">useContext</span>(PokemonContext)<span class="op">;</span></a>
<a class="sourceLine" id="cb306-2" title="2"><span class="va">console</span>.<span class="at">log</span>(pokemon)<span class="op">;</span></a></code></pre></div>
<p>You’ll want to update the global state by invoking <code>loadPokemon</code> upon load. Since data fetch is considered a <em>side effect operation</em>, you’ll invoke the <code>loadPokemon</code> function within a <code>useEffect</code> hook:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb307-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb307-2" title="2">  <span class="at">loadPokemon</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb307-3" title="3"><span class="op">},</span> [])<span class="op">;</span></a></code></pre></div>
<p>Note that the hook’s <em>dependency array</em> is empty. If you start your server, you’ll notice that your application will be stuck in an infinite loop to fetch pokemon! Think of what conditions you want your <code>loadPokemon</code> function to be invoked (hint: think of how to use the length of the <code>pokemon</code> array).</p>
<p>Take a moment to test the user login flow. You want to be redirected to view the <code>PokemonBrowser</code> component. You also want to keep an eye on your backend database logs. Make sure that you are setting correct variables to optimize the fetch calls made from the <code>useEffect</code> hook from your <code>PokemonBrowser</code>!</p>
<h3 id="pokemondetail">PokemonDetail</h3>
<p>Instead of using the <code>match.params.id</code> prop, your <code>PokemonDetail</code> component will make use of the <a href="https://reacttraining.com/blog/react-router-v5-1/#useparams">useParams</a> hook from <a href="https://reacttraining.com/blog/react-router-v5-1/">React Router v5.1</a>! Begin by using the <code>useContext</code> hook to give the component access to the context’s <code>singlePokemon</code> and <code>getOnePokemon</code> function.</p>
<p>Note that you can also rename the object keys to prevent the need to refactor your rendered JSX. In the snippet below, the context’s <code>singlePokemon</code> is renamed to be <code>pokemon</code>.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb308-1" title="1"><span class="kw">const</span> <span class="op">{</span> <span class="dt">singlePokemon</span><span class="op">:</span> pokemon<span class="op">,</span> getOnePokemon <span class="op">}</span> <span class="op">=</span> <span class="at">useContext</span>(PokemonContext)<span class="op">;</span></a>
<a class="sourceLine" id="cb308-2" title="2"><span class="va">console</span>.<span class="at">log</span>(pokemon)<span class="op">;</span></a></code></pre></div>
<p>This way, you won’t need to refactor any of the render code to render the <code>pokemon</code> in the <code>PokemonContext</code>!</p>
<p>Have your <code>PokemonDetail</code> component update the global state by invoking the <code>getOnePokemon</code> function with the <code>id</code> from the route parameters upon load. Import the <a href="https://reacttraining.com/blog/react-router-v5-1/#useparams">useParams</a> hook from the <code>react-router-dom</code> package:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb309-1" title="1"><span class="im">import</span> <span class="op">{</span> useParams <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Now you can simply invoke the function and destructure the <code>params</code> object it receives!</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb310-1" title="1"><span class="kw">const</span> <span class="op">{</span> id <span class="op">}</span> <span class="op">=</span> <span class="at">useParams</span>()<span class="op">;</span></a></code></pre></div>
<p>You’ll need to use a <code>useEffect</code> hook to fetch a pokemon based on the <code>id</code> from the route parameters. Just like in your <code>PokemonBrowser</code> component, you need to determine what variables to place in the dependency array so that your application is not stuck in an infinite fetch loop!</p>
<p>In your <code>useEffect</code> hook, you’ll need to check two conditions. If the single <code>pokemon</code> is <em>falsey</em>, have your component invoke the <code>getOnePokemon</code> function with the <code>id</code> parameter. If the pokemon’s ID is not equal to the route parameter <code>id</code>, also have your component invoke the <code>getOnePokemon</code> function to fetch a specific pokemon! Remember that the <code>id</code> from your route parameters is currently a string, so you’ll need to parse the <code>id</code> in order to make a valid comparison to the pokemon’s ID.</p>
<p>After you have finished refactoring your state-based React application built with class components to a context-based React application built with function components and React Hooks, compare your context-based application to the redux-based solution. Using Redux instead of Context results in a lot of boilerplate code in your application. React 16 revamped the Context API and deemed the <code>useContext</code> hook as a basic hook to improve React’s built-in state management.</p>
<p>Redux is a large library with a lot of conceptual knowledge involved. In the next project, you will dive deeper and have more practice with implementing the Redux library for state management. Although you are free to use either Context or Redux to manage the application state of your project next week, you can take today’s bonus project as a chance to dive in deeper and truly learn Redux. Understanding all the conceptual knowledge behind the library will help you architect your own React project and plan your application’s state management.</p>
<hr />
<h1 id="week-15-day-5-websockets-and-project-planning" data-ignore="true">WEEK-15 DAY-5<br><em>WebSockets and Project Planning</em></h1>
<hr />
<hr />
<h1 id="websockets-learning-objectives">WebSockets Learning Objectives</h1>
<p>WebSockets enable two-way communication between the user’s browser (the client) and a server. They can be used to enable dynamic, interactive web experiences. After reading and practicing, you should be able to:</p>
<ul>
<li>Use the WebSockets API to create a new WebSocket connection to a server</li>
<li>Create a WebSocket <code>onopen</code> event handler function to detect when the connection has been opened</li>
<li>Create a WebSocket <code>onmessage</code> event handler function to detect and process messages sent by the server</li>
<li>Create a WebSocket <code>onerror</code> event handler function to detect when an error has occurred</li>
<li>Use the WebSocket <code>send()</code> method to send messages to the server</li>
<li>Recall that WebSocket message data can be sent as JSON formatted string</li>
<li>Recall that WebSocket messages usually have a "type" associated with them so the client can determine how to process them</li>
<li>Use the WebSocket <code>close()</code> method to close the connection to the server</li>
<li>Create a WebSocket <code>onclose</code> event handler function to detect when the connection to the server has been closed</li>
<li>Use the <code>ws</code> package to create a standalone WebSocket server</li>
<li>Use the <code>ws</code> package to create a WebSocket server that shares a Node.js <code>http</code> server with an Express application</li>
<li>Create an <code>connection</code> event handler listener method to detect when a client has connected to the WebSocket server</li>
<li>Create an <code>close</code> event handler listener method to detect when a client has closed the connection to the WebSocket server</li>
<li>Use the WebSocket <code>send()</code> method to send a message to a client</li>
</ul>
<hr />
<h1 id="websockets-overview">WebSockets Overview</h1>
<p>Up until now, you’ve seen communication between the Web browser and your backend server occur in the <em>request/response cycle</em> of HTTP 1.1.</p>
<figure>
<img src="https://www.programmableweb.com/" alt="HTTP Exchange" /><figcaption>HTTP Exchange</figcaption>
</figure>
<p>The <em>Client</em> makes an HTTP request, like <strong>GET /home HTTP/1.1</strong>. The <em>Server</em> receives that request, translates it, and returns an HTTP response, like <strong>HTTP/1.1 200 OK</strong>. One request, one response. That is great for getting data and asking the server to create new resources, but it does not support the demands of Web applications that need "real-time communication" or to receive messages from the server <em>without</em> an HTTP request. The <a href="https://material-ui.com/">WebSockets</a> standard fills that hole. (That’s a link to the RFC. It’s … dense.)</p>
<p>Check out this <a href="https://react-bootstrap.github.io/">link to caniuse.com</a> that tracks the support of WebSockets (and a whole bunch of other things) in browsers for the desktop and mobile. You can see that <em>everything</em> supports WebSockets (except Opera Mini which fails to support pretty much anything, stupid Opera Mini).</p>
<p>Since the technology is now well-supported, it makes sense to learn it so that you can do <em>amazing</em> things in your Web application.</p>
<p>In this article, you will learn about how WebSockets work from the perspectives of the communication between the client and the server.</p>
<p><strong>Just one thing</strong>: there are <em>lots</em> of libraries out there for you to use that make this WebSocket thing "easy". In the same way that this curriculum challenges you to use <code>fetch</code> rather than some other AJAX library like <code>axios</code>, learning WebSockets teaches you about the <em>technology</em> and how it works. Once you know that, then you can use <em>any</em> library (like socket.io) to ease your development. But, giving you the deeper knowledge is what this is providing for you.</p>
<h2 id="key-points-about-web-sockets">Key points about Web sockets</h2>
<h3 id="persistent-connections">Persistent Connections</h3>
<p>In the traditional model of request/response, the client makes a connection to the server, makes the request, the server responds on the same connection, then the connection can be closed. The next time your browser wants to make a request to the Web server, it may need to establish that connection, again.</p>
<p>WebSockets create a <em>persistent connection</em>, one that doesn’t close unless it doesn’t get used. This means that the TCP/IP handshake that needs to occur between the browser and server does not need to happen with every single request. This has two benefits:</p>
<ol type="1">
<li>Your front-end application does not need to establish that connection <em>every single time</em>. This makes the application feel snappier.</li>
<li>The connection is <em>two-way</em>! While it’s open, the server can send messages to the client <em>whenever it wants to</em>! That is mind-blowing because HTTP 1.1 cannot support that without jumping through crazy hoops that can cause your server to crash.</li>
</ol>
<p>The way it happens is an extra HTTP header in the HTTP request. Here’s an example.</p>
<pre><code>GET ws://WebSocket.example.com/ HTTP/1.1
Origin: http://example.com
Connection: Upgrade
Host: WebSocket.example.com
Upgrade: WebSocket</code></pre>
<p>So, checkout two things about this:</p>
<ol type="1">
<li>The protocol is "ws" which, you can probably guess, means "WebSocket". (There’s also a "wss" which is like "HTTPS" but for WebSockets Secure.)</li>
<li>The "Connection" header tells the server that the browser is requesting an upgrade for the normal HTTP 1.1 connection</li>
<li>The "Upgrade" header tells the server that the browser specifically wants a WebSocket</li>
</ol>
<p>If the server supports WebSockets, it says "COOL!" and returns something like the following headers in the response.</p>
<pre><code>HTTP/1.1 101 WebSocket Protocol Handshake
Date: Thu, 7 May 2020 17:07:34 GMT
Connection: Upgrade
Upgrade: WebSocket</code></pre>
<p>This confirms that the server is good with upgrading the connection. When both the client and server agree, they just don’t close the connection.</p>
<p>Boom! Persistent!</p>
<h3 id="messages-not-requests-and-responses">Messages, not requests and responses</h3>
<p>Once the connection exists between the browser and the server, either of the two can send a <em>message</em> over the connection. It’s a <em>message</em> with a sender and a receiver. It is <em>not</em> a request/response. There is no request. There is no response. There are just two actors sending messages back and forth, like two kids in school passing notes back and forth in class. The server doesn’t have to wait for a request to send a message. The client can sends a message <em>without</em> the expectation of a response.</p>
<p>Just like in TCP/IP, when data gets chopped up into packets and datagrams, messages over WebSockets get chopped up into <em>frames</em>. Each frame contains extra information to help ensure the integrity of the message as it traverses between sender and recipient. It’s not super important to know what those parts are because you’re not writing code to implement the standard; instead, the browser will do it for you automatically, just like using <code>fetch</code> means you don’t have to format the HTTP request.</p>
<h2 id="client-side-code">Client-side code</h2>
<p>Just like the browser has the <code>fetch</code> method to easily make HTTP 1.1 requests, it provides a <code>WebSocket</code> class for you to create objects that manage the connection between the browser and the server. You just give the constructor the WebSocket URL that you want your browser to connect to.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb313-1" title="1"><span class="co">// This is EXAMPLE CODE ONLY!</span></a>
<a class="sourceLine" id="cb313-2" title="2"><span class="co">// There is no sockets.example.com!</span></a>
<a class="sourceLine" id="cb313-3" title="3"><span class="kw">const</span> socket <span class="op">=</span> <span class="kw">new</span> <span class="at">WebSocket</span>(<span class="st">&#39;wss://sockets.example.com&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Now, with <code>fetch</code>, that <em>sends</em> a request and, when a response comes back, the <code>Promise</code> gets fulfilled and you do stuff with it. That’s not how <code>WebSocket</code> objects work. They <em>can’t</em> work that way.</p>
<p>Instead of a <code>Promise</code>, you add event listeners to the <code>WebSocket</code> object in the same way that you add event listeners to <code>input</code> or <code>button</code> elements to capture specific kinds of events. For the WebSocket, the events are</p>
<ul>
<li><strong>message</strong> fired when a message fully arrived over the WebSocket from the server</li>
<li><strong>close</strong> fired when the WebSocket closes for some reason, the status code being in the "code" property of the event and the reason in the "reason" property of the event object</li>
<li><strong>error</strong> fired when the WebSocket can’t even connect</li>
<li><strong>open</strong> fired when the WebSocket opens</li>
</ul>
<p>Then, the <code>WebSocket</code> object has two methods for you to use, <code>send</code> to send a message to the server, and <code>close</code> to close the connection. Here’s what some code could look like that uses that <code>socket</code> opened above.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb314-1" title="1"><span class="co">// This is EXAMPLE CODE ONLY!</span></a>
<a class="sourceLine" id="cb314-2" title="2"></a>
<a class="sourceLine" id="cb314-3" title="3"><span class="co">// When the socket is open, send a message!</span></a>
<a class="sourceLine" id="cb314-4" title="4"><span class="va">socket</span>.<span class="at">addEventListener</span>(<span class="st">&#39;open&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="va">socket</span>.<span class="at">send</span>(<span class="st">&#39;I am LEGENDARY!&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb314-5" title="5"></a>
<a class="sourceLine" id="cb314-6" title="6"><span class="co">// When you get a message, add it to your state store.</span></a>
<a class="sourceLine" id="cb314-7" title="7"><span class="va">socket</span>.<span class="at">addEventListener</span>(<span class="st">&#39;message&#39;</span><span class="op">,</span> event <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb314-8" title="8">  <span class="at">dispatch</span>(<span class="at">gotMessage</span>(<span class="va">event</span>.<span class="at">data</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb314-9" title="9"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb314-10" title="10"></a>
<a class="sourceLine" id="cb314-11" title="11"><span class="co">// Print out that something bad happened</span></a>
<a class="sourceLine" id="cb314-12" title="12"><span class="va">socket</span>.<span class="at">addEventListener</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb314-13" title="13">  <span class="va">console</span>.<span class="at">error</span>(<span class="st">&#39;Something bad happened... :-(&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb314-14" title="14"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb314-15" title="15"></a>
<a class="sourceLine" id="cb314-16" title="16"><span class="co">// When the socket closes, update the state</span></a>
<a class="sourceLine" id="cb314-17" title="17"><span class="co">// of the application!</span></a>
<a class="sourceLine" id="cb314-18" title="18"><span class="va">socket</span>.<span class="at">addEventListener</span>(<span class="st">&#39;close&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb314-19" title="19">  <span class="at">dispatch</span>(<span class="at">justDisconnected</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb314-20" title="20"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Note</strong>: just like with DOM elements where you could use <code>el.onclick = () =&gt; {...}</code> to add an event handler. You can do something like <code>socket.onmessage = () =&gt; {...}</code>, too. But, that’s just not nice because you can’t add more than one listener. So, if you see that in the documentation, somewhere, remember that you can always use <code>addEventListener</code> rather than the <code>on«event»</code> properties.</p>
<p>All of that is just provided for you in the browser! There’s a lot of code under all of that to allow your JavaScript that easy-to-use API! Thanks, browser makers!</p>
<p>You can give it a shot yourself. Create a new HTML 5 file with all of the normal stuff and add this code in there.</p>
<p>In the body of the document, put this.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb315-1" title="1"><span class="kw">&lt;div&gt;</span></a>
<a class="sourceLine" id="cb315-2" title="2">  <span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&quot;connect&quot;</span><span class="kw">&gt;</span>Connect<span class="kw">&lt;/button&gt;</span></a>
<a class="sourceLine" id="cb315-3" title="3">  <span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&quot;send-message&quot;</span><span class="kw">&gt;</span>Send<span class="kw">&lt;/button&gt;</span></a>
<a class="sourceLine" id="cb315-4" title="4">  <span class="kw">&lt;button</span><span class="ot"> id=</span><span class="st">&quot;disconnect&quot;</span><span class="kw">&gt;</span>Disconnect<span class="kw">&lt;/button&gt;</span></a>
<a class="sourceLine" id="cb315-5" title="5"><span class="kw">&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb315-6" title="6"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;messages&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></a></code></pre></div>
<p>Now, create a <code>script</code> element <em>after</em> the content you just added (so you don’t have to wait for "DOMContentLoaded"). This is just regular-old DOM code with the socket message stuff in there, too. Have a look and try it out! Change the code so that you can see how changes affect it!</p>
<p>This code uses a <em>real</em> WebSocket server, wss://echo.websocket.org!</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb316-1" title="1"><span class="kw">const</span> connect <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;connect&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-2" title="2"><span class="kw">const</span> disconnect <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;disconnect&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-3" title="3"><span class="kw">const</span> sendMessage <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;send-message&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-4" title="4"><span class="kw">const</span> messages <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;messages&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-5" title="5"></a>
<a class="sourceLine" id="cb316-6" title="6"><span class="kw">let</span> socket <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-7" title="7"></a>
<a class="sourceLine" id="cb316-8" title="8"><span class="va">connect</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb316-9" title="9">  <span class="va">messages</span>.<span class="at">innerHTML</span> <span class="op">+=</span> <span class="vs">`&lt;p&gt;Opening WebSocket...&lt;/p&gt;`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-10" title="10">  socket <span class="op">=</span> <span class="kw">new</span> <span class="at">WebSocket</span>(<span class="st">&quot;wss://echo.websocket.org/&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-11" title="11"></a>
<a class="sourceLine" id="cb316-12" title="12">  <span class="va">socket</span>.<span class="at">addEventListener</span>(<span class="st">&#39;open&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb316-13" title="13">    <span class="va">messages</span>.<span class="at">innerHTML</span> <span class="op">+=</span> <span class="vs">`&lt;p&gt;CONNECTED!&lt;/p&gt;`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-14" title="14">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-15" title="15"></a>
<a class="sourceLine" id="cb316-16" title="16">  <span class="va">socket</span>.<span class="at">addEventListener</span>(<span class="st">&#39;message&#39;</span><span class="op">,</span> event <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb316-17" title="17">    <span class="va">messages</span>.<span class="at">innerHTML</span> <span class="op">+=</span> <span class="vs">`&lt;p&gt;Received &quot;</span><span class="sc">${</span><span class="va">event</span>.<span class="at">data</span><span class="sc">}</span><span class="vs">&quot;&lt;/p&gt;`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-18" title="18">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-19" title="19"></a>
<a class="sourceLine" id="cb316-20" title="20">  <span class="va">socket</span>.<span class="at">addEventListener</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb316-21" title="21">    <span class="va">messages</span>.<span class="at">innerHTML</span> <span class="op">+=</span> <span class="vs">`&lt;p&gt;ERROR&lt;/p&gt;`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-22" title="22">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-23" title="23"></a>
<a class="sourceLine" id="cb316-24" title="24">  <span class="va">socket</span>.<span class="at">addEventListener</span>(<span class="st">&#39;close&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb316-25" title="25">    <span class="va">messages</span>.<span class="at">innerHTML</span> <span class="op">+=</span> <span class="vs">`&lt;p&gt;Socket closed&lt;/p&gt;`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-26" title="26">    socket <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-27" title="27">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-28" title="28"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-29" title="29"></a>
<a class="sourceLine" id="cb316-30" title="30"><span class="va">disconnect</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb316-31" title="31">  <span class="cf">if</span> (<span class="op">!</span>socket) <span class="op">{</span></a>
<a class="sourceLine" id="cb316-32" title="32">    <span class="va">messages</span>.<span class="at">innerHTML</span> <span class="op">+=</span> <span class="vs">`&lt;p&gt;Socket not open.&lt;/p&gt;`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-33" title="33">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-34" title="34">  <span class="op">}</span></a>
<a class="sourceLine" id="cb316-35" title="35"></a>
<a class="sourceLine" id="cb316-36" title="36">  <span class="va">socket</span>.<span class="at">close</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb316-37" title="37"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-38" title="38"></a>
<a class="sourceLine" id="cb316-39" title="39"><span class="va">sendMessage</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb316-40" title="40">  <span class="cf">if</span> (<span class="op">!</span>socket) <span class="op">{</span></a>
<a class="sourceLine" id="cb316-41" title="41">    <span class="va">messages</span>.<span class="at">innerHTML</span> <span class="op">+=</span> <span class="vs">`&lt;p&gt;Socket not open.&lt;/p&gt;`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-42" title="42">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-43" title="43">  <span class="op">}</span></a>
<a class="sourceLine" id="cb316-44" title="44">  <span class="va">messages</span>.<span class="at">innerHTML</span> <span class="op">+=</span> <span class="vs">`&lt;p&gt;Sending &quot;WebSockets are cool!&quot;&lt;/p&gt;`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb316-45" title="45">  <span class="va">socket</span>.<span class="at">send</span>(<span class="st">&#39;WebSockets are cool!&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb316-46" title="46"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Here’s an interesting thing. After you play around with the code, refresh the page and connect to the server. Then, just wait. Likely, eventually, the socket will close due to disuse. Many libraries (like socket.io) keep the connection "warm" by sending little <em>ping</em> methods to the server to let the server know that it really does want to keep that connection open. If it doesn’t close, then you have a <em>really</em> good and stable Internet connection!</p>
<h2 id="server-side-code">Server-side code</h2>
<p>If that’s the client-side code above, the question that might be bothering you is "How hard is the server-side code?" Well, luckily, it’s just about the same level of ease with the <a href="https://v2.grommet.io/">ws</a> package for Node.js.</p>
<p>Because WebSockets are a browser-based technology, the implementations that you will find on the server can vary widely. Luckily, the <strong>ws</strong> API is an event-driven API, too. It provides these events for you to use to build a WebSocket server using the <code>Server</code> object.</p>
<ul>
<li>The <strong>connection</strong> event occurs when the HTTP handshake completes but the connection has <em>not</em> upgraded. It’s callback receives a <code>WebSocket</code> that allows you to communicate with the client.</li>
<li>The <strong>headers</strong> event which allows you to inspect and modify headers before they are sent back to the client.</li>
<li>The <strong>listening</strong> event which fires when the underlying server is bound to a <em>network socket</em>, not a Web socket.</li>
</ul>
<p>Then, the server has a <code>close</code> method which lets it shut down. It’s got some other methods, too, about handling upgrades and stuff, which are outside the scope of this article. You are encouraged to go check out the API docs in a later article.</p>
<p>Those last two are some pretty low-level events that you won’t necessarily have to pay attention to unless you’re doing some <em>really</em> advanced stuff. However, you <em>will</em> want to pay attention to the <strong>connection</strong> property because that is how you know a client is connected. Then, when the connection gets upgraded, the callback gets a <code>WebSocket</code> object so that your server can send messages to the browser.</p>
<p>Here’s the code to write an "echo" server like you just used in the client-side stuff above. Put this in a file, install "ws" using <code>npm install ws</code>, and run it with <code>node «filename»</code>. Then, change the URL in the HTML file that you created from wss://echo.websocket.org/ to ws://localhost:8080. Everything still works!</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb317-1" title="1"><span class="kw">const</span> WebSocket <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;ws&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-2" title="2"></a>
<a class="sourceLine" id="cb317-3" title="3"><span class="kw">const</span> server <span class="op">=</span> <span class="kw">new</span> <span class="va">WebSocket</span>.<span class="at">Server</span>(<span class="op">{</span> <span class="dt">port</span><span class="op">:</span> <span class="dv">8080</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-4" title="4"></a>
<a class="sourceLine" id="cb317-5" title="5"><span class="va">server</span>.<span class="at">on</span>(<span class="st">&#39;connection&#39;</span><span class="op">,</span> webSocket <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb317-6" title="6">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;client connecting...&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-7" title="7"></a>
<a class="sourceLine" id="cb317-8" title="8">  <span class="kw">let</span> interval <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb317-9" title="9">  <span class="at">setInterval</span>(() <span class="kw">=&gt;</span> <span class="va">webSocket</span>.<span class="at">send</span>(<span class="st">&#39;Hello?&#39;</span>)<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-10" title="10"></a>
<a class="sourceLine" id="cb317-11" title="11">  <span class="va">webSocket</span>.<span class="at">on</span>(<span class="st">&#39;message&#39;</span><span class="op">,</span> message <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb317-12" title="12">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;received: %s&#39;</span><span class="op">,</span> message)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-13" title="13">    <span class="va">webSocket</span>.<span class="at">send</span>(message)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-14" title="14">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-15" title="15"></a>
<a class="sourceLine" id="cb317-16" title="16">  <span class="va">webSocket</span>.<span class="at">on</span>(<span class="st">&#39;close&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb317-17" title="17">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Connection closed.&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-18" title="18">    <span class="at">clearInterval</span>(interval)</a>
<a class="sourceLine" id="cb317-19" title="19">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb317-20" title="20"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>You can see that a server gets created using port 8080. That server then waits for connections with <code>server.on('connection', ...)</code>. When the connection occurs, the callback gets called and <code>webSocket</code> gets set to the actual <code>WebSocket</code> instance that you can use to send (and receive) messages to (and from) the client. Then, it creates an interval that sends a "Hello?" message to the client every second or so.</p>
<p>You subscribe to messages using <code>webSocket.on('message', ...)</code>. When a message arrives from the browser, the callback gets called with the content of the data in the <code>message</code> variable. Normally, that’ll be a JSON-formatted string that you can use to do things with your code.</p>
<p>Finally, when the <code>WebSocket</code> object closes, it prints a message to the console and clears that interval.</p>
<p>That’s how nice <strong>ws</strong> makes it to write WebSocket-enabled. Thank you, <strong>ws</strong>!</p>
<p>A really cool thing about <strong>ws</strong> is that it can track clients for you when you create the <code>Server</code> object by passing in the <a href="https://react.semantic-ui.com/"><code>clientTracking</code> option</a> when you construct it. Then, the <code>clients</code> property on the <code>Server</code> object will have all of the clients on it so you can broadcast messages to <em>everyone</em>!</p>
<h2 id="what-youve-learned-1">What you’ve learned</h2>
<ol type="1">
<li>WebSockets are a persistent connection between the browser and server</li>
<li>It’s a two-way connection, messages can flow in both directions</li>
<li>The "Connection" header is used to request an upgrade. The "Upgrade" header specifically requests a WebSocket.</li>
<li>Client-side code is an event-driven model with <strong>open</strong>, <strong>close</strong>, <strong>message</strong>, and <strong>error</strong> events</li>
<li>Server-side code is an event-driven model that waits for <strong>connection</strong> events on a <code>Server</code> object which, then, provides a <code>WebSocket</code> object nearly identical to the <code>WebSocket</code> used on the client side.</li>
</ol>
<hr />
<h1 id="websocket-server-applications">WebSocket Server Applications</h1>
<p>Now that you know how to use WebSockets on the client, it’s time to learn how to use WebSockets on the server. To enable support for WebSockets on the server, you’ll use the <a href="https://www.npmjs.com/package/ws"><code>ws</code> npm package</a>, a WebSocket server implementation for use with Node.js applications.</p>
<p>The <code>ws</code> package provides both a <em>server</em> and a <em>client</em> implementation. The client implementation is only intended for use on Node.js, to enable <em>server</em> to <em>server</em> WebSocket connections. When reading <a href="https://www.npmjs.com/package/ws">the documentation for the <code>ws</code> package</a>, focus on the following <em>server</em> examples:</p>
<ul>
<li><a href="https://www.npmjs.com/package/ws#simple-server">Simple Server</a></li>
<li><a href="https://www.npmjs.com/package/ws#server-broadcast">Server Broadcast</a></li>
<li><a href="https://github.com/websockets/ws/tree/master/examples/server-stats">Example Application: Server Stats</a></li>
<li><a href="https://github.com/websockets/ws/tree/master/examples/express-session-parse">Example Application: Express Session Parse</a></li>
</ul>
<p>After reading <a href="https://www.npmjs.com/package/ws">the documentation for the <code>ws</code> package</a>, you should be able to:</p>
<ul>
<li>Use the <code>ws</code> package to create a standalone WebSocket server;</li>
<li>Use the <code>ws</code> package to create a WebSocket server that shares a Node.js <code>http</code> server with an Express application;</li>
<li>Create an <code>connection</code> event handler listener method to detect when a client has connected to the WebSocket server;</li>
<li>Create an <code>close</code> event handler listener method to detect when a client has closed the connection to the WebSocket server; and</li>
<li>Use the WebSocket <code>send()</code> method to send a message to a client.</li>
</ul>
<hr />
<h1 id="websocket-client-applications">WebSocket Client Applications</h1>
<p>WebSockets enable two-way communication between the user’s browser (the client) and a server. Normally, the server only responds to client requests. When using WebSockets, once the client has opened a connection with the server, the server can send messages to the client.</p>
<p>A good place to start learning about Websockets on the Web is with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications">Writing WebSocket client applications</a> article on MDN web docs.</p>
<p>After reading this article, you should be able to:</p>
<ul>
<li>Use the WebSockets API to create a new WebSocket connection to a server;</li>
<li>Create a WebSocket <code>onopen</code> event handler function to detect when the connection has been opened;</li>
<li>Create a WebSocket <code>onmessage</code> event handler function to detect and process messages sent by the server;</li>
<li>Create a WebSocket <code>onerror</code> event handler function to detect when an error has occurred;</li>
<li>Use the WebSocket <code>send()</code> method to send messages to the server;</li>
<li>Recall that WebSocket message data can be sent as JSON formatted string;</li>
<li>Recall that WebSocket messages usually have a "type" associated with them so the client can determine how to process them;</li>
<li>Use the WebSocket <code>close()</code> method to close the connection to the server; and</li>
<li>Create a WebSocket <code>onclose</code> event handler function to detect when the connection to the server has been closed.</li>
</ul>
<hr />
<h1 id="tic-tac-toe-online-project">Tic-Tac-Toe Online Project</h1>
<p>In this project, you’ll get a chance to practice your newly acquired WebSockets skills by building an interactive game! Earlier, you built a Tic-Tac-Toe game that could be played locally, within a single browser session. Now you’ll extend the game to use WebSockets so that it can be played online, across two different browser sessions. You’ll also convert the client-side code to use React components.</p>
<h2 id="phase-0-reviewing-the-application-design-and-architecture">Phase 0: Reviewing the application design and architecture</h2>
<p>Here’s a high level description of the design and architecture of the application:</p>
<ul>
<li>Node.js and Express will be used to create a simple web application.
<ul>
<li>The server will serve static files from a <code>public</code> directory. In production the <code>public</code> directory would contain a production build of the React client application.</li>
</ul></li>
<li>The <a href="https://www.npmjs.com/package/ws"><code>ws</code> npm package</a> will be used to create a WebSocket server.
<ul>
<li>The WebSocket server will enable two-way communication between two users as they play a game of tic-tac-toe.</li>
<li>All game state will live on the server. As players take turns, the game state will be updated on the server and the WebSocket server will be used to broadcast state updates to the clients to keep their game boards in sync.</li>
</ul></li>
<li>The client application will be built using React web components.
<ul>
<li>Some components will require state, but you’re welcome to use either class or function components with Hooks.</li>
<li>Global state requirements in the client application will be relatively simple, so while you could use a Context or Redux to maintain your application’s state, neither one is really a requirement to use.</li>
</ul></li>
<li>Players will be prompted for their "player name" when they first browse to the web application.
<ul>
<li>To keep things simple, the server will start a new game as soon as two players have connected to the server.</li>
<li>If a player unexpectedly quits the game (i.e. closes their browser) then the game will abort for the remaining player.</li>
</ul></li>
</ul>
<p>The initial version of this project will be fun and challenging, giving you ample opportunity to practice your WebSocket skills. There’s also lots of interesting ways that this project can be extended beyond the initial requirements.</p>
<p>Ready to get started building your online tic-tac-toe game? <strong>Let’s go!</strong></p>
<h2 id="phase-1-setting-up-the-client-and-server-projects">Phase 1: Setting up the client and server projects</h2>
<p>This project will actually be split into two projects: a Node.js project for the Express server application and a Create React App project for the client application.</p>
<h3 id="stubbing-out-the-server-project">Stubbing out the server project</h3>
<p>To save you a bit of time, we’ve provided you with a repo of starter files for the server project. Create a top level folder for your project; name it something like <code>tic-tac-toe-online</code>. Browse into that folder and clone this repository:</p>
<p><a href="https://github.com/-starters/tic-tac-toe-online-starter.git">https://github.com/-starters/tic-tac-toe-online-starter.git</a></p>
<p>Once the repo has finished cloning, you can browse into the <code>server</code> folder and install the server project’s dependencies by running the command <code>npm install</code>. Once the dependencies have finished installing, test the application by running <code>npm start</code> and browsing to <code>http://localhost:8080/</code>. You should see a very simple web page displaying the heading "Tic-Tac-Toe Online".</p>
<p>Take a moment to review the <code>app.js</code> file’s contents:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb318-1" title="1"><span class="co">// ./app.js</span></a>
<a class="sourceLine" id="cb318-2" title="2"></a>
<a class="sourceLine" id="cb318-3" title="3"><span class="kw">const</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-4" title="4"><span class="kw">const</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-5" title="5"><span class="kw">const</span> <span class="op">{</span> createServer <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-6" title="6"><span class="kw">const</span> morgan <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-7" title="7"></a>
<a class="sourceLine" id="cb318-8" title="8"><span class="kw">const</span> <span class="op">{</span> port <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./config&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-9" title="9"></a>
<a class="sourceLine" id="cb318-10" title="10"><span class="kw">const</span> app <span class="op">=</span> <span class="at">express</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb318-11" title="11"></a>
<a class="sourceLine" id="cb318-12" title="12"><span class="va">app</span>.<span class="at">use</span>(<span class="at">morgan</span>(<span class="st">&#39;dev&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb318-13" title="13"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">static</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;/public&#39;</span>)))<span class="op">;</span></a>
<a class="sourceLine" id="cb318-14" title="14"></a>
<a class="sourceLine" id="cb318-15" title="15"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;*&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb318-16" title="16">  <span class="va">res</span>.<span class="at">sendFile</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;public&#39;</span><span class="op">,</span> <span class="st">&#39;index.html&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb318-17" title="17"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-18" title="18"></a>
<a class="sourceLine" id="cb318-19" title="19"><span class="kw">const</span> server <span class="op">=</span> <span class="at">createServer</span>(app)<span class="op">;</span></a>
<a class="sourceLine" id="cb318-20" title="20"></a>
<a class="sourceLine" id="cb318-21" title="21"><span class="va">server</span>.<span class="at">listen</span>(port<span class="op">,</span> () <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Listening on http://localhost:</span><span class="sc">${</span>port<span class="sc">}</span><span class="vs">`</span>))<span class="op">;</span></a></code></pre></div>
<p>This simple Express application will:</p>
<ul>
<li>Attempt to match incoming requests to static files located in the <code>public</code> folder; and</li>
<li>If a matching static file isn’t found, then the <code>./public/index.html</code> file will be served for all other requests.</li>
</ul>
<p>In the next section, you’ll use Create React App to create a client project. Once you’ve built your React client application, you can create and copy the production build into the <code>public</code> folder. This allows the one Express application to serve both the client and server parts of the application.</p>
<blockquote>
<p>Remember that configuring Express to serve the <code>./public/index.html</code> file for any request that doesn’t match a static file, allows you to "deep link" to any of your React application’s routes (if you use routing in your client application).</p>
</blockquote>
<p>One thing to note about the above <code>app</code> module, is that the <code>http.createServer</code> method is being used to create the HTTP server instead of calling the <code>listen</code> method on the Express Application (<code>app</code>) object. In a bit, you’ll see how using this approach will allow you to use the same server for both HTTP and WebSocket requests.</p>
<h3 id="stubbing-out-the-client-project">Stubbing out the client project</h3>
<p>After stubbing out the server project, browse back up to the top level project folder and use Create React App to create your client project:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb319-1" title="1"><span class="ex">npx</span> create-react-app client --template @/simple</a></code></pre></div>
<p>When the command completes, browse into the <code>client</code> and run <code>npm start</code>. The Create React App development server should start and open your client application into your default browser. If it doesn’t automatically happen, you can manually open a browser and browse to <code>http://localhost:3000/</code>. When the page loads, you should see a heading displaying the text "Hello world!"</p>
<h2 id="phase-2-stubbing-out-the-react-components">Phase 2: Stubbing out the React components</h2>
<p>The React client application will be relatively simple: it’ll contain just three components (at least initially):</p>
<ul>
<li>An <code>App</code> component (this is already in your project);</li>
<li>A <code>Home</code> component; and</li>
<li>A <code>Game</code> component.</li>
</ul>
<p>Go ahead and stub out the <code>Home</code> and <code>Game</code> components within a <code>components</code> folder. The <code>Home</code> component will require state so use a class component or a function component with the <code>useState</code> Hook (we’ll be using Hooks in the instructions). The <code>Game</code> component doesn’t require any state, so a function component will work fine.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb320-1" title="1"><span class="co">// ./src/components/Home.js</span></a>
<a class="sourceLine" id="cb320-2" title="2"></a>
<a class="sourceLine" id="cb320-3" title="3"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span> useState <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb320-4" title="4"></a>
<a class="sourceLine" id="cb320-5" title="5"><span class="kw">const</span> Home <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb320-6" title="6">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb320-7" title="7">    <span class="op">&lt;</span>h2<span class="op">&gt;</span>Home&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb320-8" title="8">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb320-9" title="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb320-10" title="10"></a>
<a class="sourceLine" id="cb320-11" title="11"><span class="im">export</span> <span class="im">default</span> Home<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb321"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb321-1" title="1"><span class="co">// ./src/components/Game.js</span></a>
<a class="sourceLine" id="cb321-2" title="2"></a>
<a class="sourceLine" id="cb321-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb321-4" title="4"></a>
<a class="sourceLine" id="cb321-5" title="5"><span class="kw">const</span> Game <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb321-6" title="6">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb321-7" title="7">    <span class="op">&lt;</span>h2<span class="op">&gt;</span>Game&lt;/h2<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb321-8" title="8">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb321-9" title="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb321-10" title="10"></a>
<a class="sourceLine" id="cb321-11" title="11"><span class="im">export</span> <span class="im">default</span> Game<span class="op">;</span></a></code></pre></div>
<p>Import the <code>useState</code> Hook into the <code>App</code> module and refactor the <code>App</code> component from a function declaration to an arrow function expression. Then update the <code>App</code> component to import and render the <code>Home</code> and <code>Game</code> components:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb322-1" title="1"><span class="co">// ./src/App.js</span></a>
<a class="sourceLine" id="cb322-2" title="2"></a>
<a class="sourceLine" id="cb322-3" title="3"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span> useState <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb322-4" title="4"></a>
<a class="sourceLine" id="cb322-5" title="5"><span class="im">import</span> Home <span class="im">from</span> <span class="st">&#39;./components/Home&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb322-6" title="6"><span class="im">import</span> Game <span class="im">from</span> <span class="st">&#39;./components/Game&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb322-7" title="7"></a>
<a class="sourceLine" id="cb322-8" title="8"><span class="kw">const</span> App <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb322-9" title="9">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb322-10" title="10">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb322-11" title="11">      <span class="op">&lt;</span>h1<span class="op">&gt;</span>Tic<span class="op">-</span>Tac<span class="op">-</span>Toe Online&lt;/h1<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb322-12" title="12">      <span class="op">&lt;</span>Home /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb322-13" title="13">      <span class="op">&lt;</span>Game /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb322-14" title="14">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb322-15" title="15">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb322-16" title="16"><span class="op">}</span></a>
<a class="sourceLine" id="cb322-17" title="17"></a>
<a class="sourceLine" id="cb322-18" title="18"><span class="im">export</span> <span class="im">default</span> App<span class="op">;</span></a></code></pre></div>
<p>Also notice that application heading was updated to "Tic-Tac-Toe Online". Do the same for the title in the <code>./public/index.html</code> file:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb323-1" title="1"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb323-2" title="2"><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb323-3" title="3">  <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb323-4" title="4">    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb323-5" title="5">    <span class="kw">&lt;title&gt;</span>Tic-Tac-Toe Online<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb323-6" title="6">  <span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb323-7" title="7">  <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb323-8" title="8">    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;root&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb323-9" title="9">  <span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb323-10" title="10"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<p>Go ahead and run your client application again (<code>npm start</code>) to ensure that the <code>Home</code> and <code>Game</code> components render as expected. Don’t worry that they’re both displaying at the same time; we’ll fix that in a bit.</p>
<h2 id="phase-3-rendering-the-game-board">Phase 3: Rendering the game board</h2>
<p>Before turning our attention to using WebSockets to implement the interaction between the client and server, let’s update the <code>Game</code> component to render the game board.</p>
<h3 id="adding-the-styles">Adding the styles</h3>
<p>To start, add a CSS module file named <code>Game.module.css</code> to the <code>./src/components</code> folder containing the following:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb324-1" title="1"><span class="co">/* ./src/components/Game.module.css */</span></a>
<a class="sourceLine" id="cb324-2" title="2"></a>
<a class="sourceLine" id="cb324-3" title="3"><span class="fu">.game</span> {</a>
<a class="sourceLine" id="cb324-4" title="4">  <span class="kw">margin</span>: <span class="bu">auto</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-5" title="5">  <span class="kw">width</span>: <span class="dv">402</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-6" title="6">}</a>
<a class="sourceLine" id="cb324-7" title="7"></a>
<a class="sourceLine" id="cb324-8" title="8"><span class="fu">.players</span> {</a>
<a class="sourceLine" id="cb324-9" title="9">  <span class="kw">display</span>: grid<span class="op">;</span></a>
<a class="sourceLine" id="cb324-10" title="10">  <span class="kw">height</span>: <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-11" title="11">  <span class="kw">width</span>: <span class="dv">400</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-12" title="12">  <span class="kw">grid-template-columns</span>: <span class="dv">1</span>fr <span class="dv">1</span>fr<span class="op">;</span></a>
<a class="sourceLine" id="cb324-13" title="13">  <span class="kw">grid-template-rows</span>: <span class="dv">1</span>fr<span class="op">;</span></a>
<a class="sourceLine" id="cb324-14" title="14">}</a>
<a class="sourceLine" id="cb324-15" title="15"></a>
<a class="sourceLine" id="cb324-16" title="16"><span class="fu">.tic_tac_toe_board</span> {</a>
<a class="sourceLine" id="cb324-17" title="17">  <span class="kw">display</span>: grid<span class="op">;</span></a>
<a class="sourceLine" id="cb324-18" title="18">  <span class="kw">height</span>: <span class="dv">400</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-19" title="19">  <span class="kw">width</span>: <span class="dv">400</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-20" title="20">  <span class="kw">grid-template-columns</span>: <span class="dv">1</span>fr <span class="dv">1</span>fr <span class="dv">1</span>fr<span class="op">;</span></a>
<a class="sourceLine" id="cb324-21" title="21">  <span class="kw">grid-template-rows</span>: <span class="dv">1</span>fr <span class="dv">1</span>fr <span class="dv">1</span>fr<span class="op">;</span></a>
<a class="sourceLine" id="cb324-22" title="22">  <span class="kw">background-color</span>: <span class="cn">black</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-23" title="23">  <span class="kw">margin</span>: <span class="dv">32</span><span class="dt">px</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-24" title="24">}</a>
<a class="sourceLine" id="cb324-25" title="25"></a>
<a class="sourceLine" id="cb324-26" title="26"><span class="fu">.actions</span> {</a>
<a class="sourceLine" id="cb324-27" title="27">  <span class="kw">display</span>: flex<span class="op">;</span></a>
<a class="sourceLine" id="cb324-28" title="28">}</a>
<a class="sourceLine" id="cb324-29" title="29"></a>
<a class="sourceLine" id="cb324-30" title="30"><span class="fu">.announcement</span> {</a>
<a class="sourceLine" id="cb324-31" title="31">  <span class="kw">font-size</span>: <span class="dv">1.4</span><span class="dt">em</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-32" title="32">  <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-33" title="33">}</a>
<a class="sourceLine" id="cb324-34" title="34"></a>
<a class="sourceLine" id="cb324-35" title="35"><span class="fu">.col_1</span> {</a>
<a class="sourceLine" id="cb324-36" title="36">  <span class="kw">justify-self</span>: start<span class="op">;</span></a>
<a class="sourceLine" id="cb324-37" title="37">}</a>
<a class="sourceLine" id="cb324-38" title="38"></a>
<a class="sourceLine" id="cb324-39" title="39"><span class="fu">.col_2</span> {</a>
<a class="sourceLine" id="cb324-40" title="40">  <span class="kw">justify-self</span>: <span class="dv">center</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-41" title="41">}</a>
<a class="sourceLine" id="cb324-42" title="42"></a>
<a class="sourceLine" id="cb324-43" title="43"><span class="fu">.col_3</span> {</a>
<a class="sourceLine" id="cb324-44" title="44">  <span class="kw">justify-self</span>: end<span class="op">;</span></a>
<a class="sourceLine" id="cb324-45" title="45">}</a>
<a class="sourceLine" id="cb324-46" title="46"></a>
<a class="sourceLine" id="cb324-47" title="47"><span class="fu">.row_1</span> {</a>
<a class="sourceLine" id="cb324-48" title="48">  <span class="kw">align-self</span>: start<span class="op">;</span></a>
<a class="sourceLine" id="cb324-49" title="49">}</a>
<a class="sourceLine" id="cb324-50" title="50"></a>
<a class="sourceLine" id="cb324-51" title="51"><span class="fu">.row_2</span> {</a>
<a class="sourceLine" id="cb324-52" title="52">  <span class="kw">align-self</span>: <span class="dv">center</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-53" title="53">}</a>
<a class="sourceLine" id="cb324-54" title="54"></a>
<a class="sourceLine" id="cb324-55" title="55"><span class="fu">.row_3</span> {</a>
<a class="sourceLine" id="cb324-56" title="56">  <span class="kw">align-self</span>: end<span class="op">;</span></a>
<a class="sourceLine" id="cb324-57" title="57">}</a>
<a class="sourceLine" id="cb324-58" title="58"></a>
<a class="sourceLine" id="cb324-59" title="59"><span class="fu">.spacer</span> {</a>
<a class="sourceLine" id="cb324-60" title="60">  <span class="kw">flex</span>: <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-61" title="61">}</a>
<a class="sourceLine" id="cb324-62" title="62"></a>
<a class="sourceLine" id="cb324-63" title="63"><span class="fu">.square</span> {</a>
<a class="sourceLine" id="cb324-64" title="64">  <span class="kw">background-color</span>: <span class="cn">white</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-65" title="65">  <span class="kw">height</span>: <span class="dv">130</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-66" title="66">  <span class="kw">width</span>: <span class="dv">130</span><span class="dt">px</span><span class="op">;</span></a>
<a class="sourceLine" id="cb324-67" title="67">}</a></code></pre></div>
<p>Then add the following global styles to the <code>index.css</code> file:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb325-1" title="1"><span class="co">/* ./src/index.css */</span></a>
<a class="sourceLine" id="cb325-2" title="2"></a>
<a class="sourceLine" id="cb325-3" title="3">body<span class="op">,</span> button<span class="op">,</span> input {</a>
<a class="sourceLine" id="cb325-4" title="4">  <span class="kw">font-family</span>: Arial<span class="op">,</span> Helvetica<span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></a>
<a class="sourceLine" id="cb325-5" title="5">}</a>
<a class="sourceLine" id="cb325-6" title="6"></a>
<a class="sourceLine" id="cb325-7" title="7">button<span class="op">,</span> input {</a>
<a class="sourceLine" id="cb325-8" title="8">  <span class="kw">font-size</span>: <span class="dv">1.1</span><span class="dt">em</span><span class="op">;</span></a>
<a class="sourceLine" id="cb325-9" title="9">}</a></code></pre></div>
<h3 id="the-initial-game-board">The initial game board</h3>
<p>In the <code>Game</code> component, be sure to import your CSS module file, then update the <code>render</code> method to this:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb326-1" title="1"><span class="co">// ./src/components/Game.js</span></a>
<a class="sourceLine" id="cb326-2" title="2"></a>
<a class="sourceLine" id="cb326-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb326-4" title="4"><span class="im">import</span> styles <span class="im">from</span> <span class="st">&#39;./Game.module.css&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb326-5" title="5"></a>
<a class="sourceLine" id="cb326-6" title="6"><span class="kw">const</span> Game <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb326-7" title="7">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb326-8" title="8">    <span class="op">&lt;</span>div className<span class="op">={</span><span class="va">styles</span>.<span class="at">game</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb326-9" title="9">      <span class="op">&lt;</span>div className<span class="op">={</span><span class="va">styles</span>.<span class="at">players</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb326-10" title="10">        <span class="op">&lt;</span>div<span class="op">&gt;</span>Player <span class="dt">X</span><span class="op">:</span> <span class="op">{</span><span class="co">/* </span><span class="al">TODO</span><span class="co"> Render player 1 name */</span><span class="op">}</span>&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb326-11" title="11">        <span class="op">&lt;</span>div<span class="op">&gt;</span>Player <span class="dt">O</span><span class="op">:</span> <span class="op">{</span><span class="co">/* </span><span class="al">TODO</span><span class="co"> Render player 2 name */</span><span class="op">}</span>&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb326-12" title="12">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb326-13" title="13">      <span class="op">&lt;</span>h3 className<span class="op">={</span><span class="va">styles</span>.<span class="at">announcement</span><span class="op">}&gt;</span>TODO&lt;/h3<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb326-14" title="14">      <span class="op">&lt;</span>div className<span class="op">={</span><span class="va">styles</span>.<span class="at">tic_tac_toe_board</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb326-15" title="15">        <span class="op">{</span><span class="co">/* </span><span class="al">TODO</span><span class="co"> Render game board squares */</span><span class="op">}</span></a>
<a class="sourceLine" id="cb326-16" title="16">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb326-17" title="17">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb326-18" title="18">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb326-19" title="19"><span class="op">}</span></a>
<a class="sourceLine" id="cb326-20" title="20"></a>
<a class="sourceLine" id="cb326-21" title="21"><span class="im">export</span> <span class="im">default</span> Game<span class="op">;</span></a></code></pre></div>
<p>Later in the project, once we have the game state available to us, we’ll replace the <code>TODO</code>s with the player names. We’ll also be able to render some action buttons below the game board when a game is ended to allow users to play again or quit.</p>
<h3 id="rendering-the-game-board-squares">Rendering the game board squares</h3>
<p>For now, let’s turn our attention to rendering the game board squares. In the original tic-tac-toe project, the game board squares were represented by the following HTML:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb327-1" title="1"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;square-0&#39;</span><span class="ot"> class=</span><span class="st">&#39;square row-1 col-1&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb327-2" title="2"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;square-1&#39;</span><span class="ot"> class=</span><span class="st">&#39;square row-1 col-2&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb327-3" title="3"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;square-2&#39;</span><span class="ot"> class=</span><span class="st">&#39;square row-1 col-3&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb327-4" title="4"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;square-3&#39;</span><span class="ot"> class=</span><span class="st">&#39;square row-2 col-1&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb327-5" title="5"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;square-4&#39;</span><span class="ot"> class=</span><span class="st">&#39;square row-2 col-2&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb327-6" title="6"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;square-5&#39;</span><span class="ot"> class=</span><span class="st">&#39;square row-2 col-3&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb327-7" title="7"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;square-6&#39;</span><span class="ot"> class=</span><span class="st">&#39;square row-3 col-1&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb327-8" title="8"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;square-7&#39;</span><span class="ot"> class=</span><span class="st">&#39;square row-3 col-2&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb327-9" title="9"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;square-8&#39;</span><span class="ot"> class=</span><span class="st">&#39;square row-3 col-3&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a></code></pre></div>
<p>In the original tic-tac-toe project, the element <code>id</code> attribute values were used to select individual elements in the DOM. We’re using React instead manipulating the DOM directly, so we won’t need those element <code>id</code> attributes. We’re using <a href="https://github.com/css-modules/css-modules">CSS Modules</a> for our game board styles, so we need to avoid hyphens in our CSS class names. We also need to use the <code>className</code> attribute instead of <code>class</code>. Accounting for all of that, let’s update the <code>TODO</code> comment for rendering game board squares in the <code>Game</code> component to this:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb328-1" title="1"><span class="kw">&lt;div</span><span class="ot"> className=</span><span class="st">&#39;square row_1 col_1&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb328-2" title="2"><span class="kw">&lt;div</span><span class="ot"> className=</span><span class="st">&#39;square row_1 col_2&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb328-3" title="3"><span class="kw">&lt;div</span><span class="ot"> className=</span><span class="st">&#39;square row_1 col_3&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb328-4" title="4"><span class="kw">&lt;div</span><span class="ot"> className=</span><span class="st">&#39;square row_2 col_1&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb328-5" title="5"><span class="kw">&lt;div</span><span class="ot"> className=</span><span class="st">&#39;square row_2 col_2&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb328-6" title="6"><span class="kw">&lt;div</span><span class="ot"> className=</span><span class="st">&#39;square row_2 col_3&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb328-7" title="7"><span class="kw">&lt;div</span><span class="ot"> className=</span><span class="st">&#39;square row_3 col_1&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb328-8" title="8"><span class="kw">&lt;div</span><span class="ot"> className=</span><span class="st">&#39;square row_3 col_2&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb328-9" title="9"><span class="kw">&lt;div</span><span class="ot"> className=</span><span class="st">&#39;square row_3 col_3&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></a></code></pre></div>
<p>We need to track when players click on a specific square and determine which square index (<code>0</code> through <code>8</code>) that they clicked on. To do that, let’s define a <code>Square</code> function component in your <code>Game.js</code> file for rendering squares:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb329-1" title="1"><span class="kw">const</span> Square <span class="op">=</span> (<span class="op">{</span> squareIndex<span class="op">,</span> row<span class="op">,</span> col <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb329-2" title="2">  <span class="kw">const</span> rowStyleName <span class="op">=</span> <span class="vs">`row_</span><span class="sc">${</span>row<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb329-3" title="3">  <span class="kw">const</span> colStyleName <span class="op">=</span> <span class="vs">`col_</span><span class="sc">${</span>col<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb329-4" title="4"></a>
<a class="sourceLine" id="cb329-5" title="5">  <span class="kw">const</span> handleClick <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb329-6" title="6">    <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Clicked on square index: </span><span class="sc">${</span>squareIndex<span class="sc">}</span><span class="vs">...`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb329-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb329-8" title="8"></a>
<a class="sourceLine" id="cb329-9" title="9">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb329-10" title="10">    <span class="op">&lt;</span>div</a>
<a class="sourceLine" id="cb329-11" title="11">      onClick<span class="op">={</span>handleClick<span class="op">}</span></a>
<a class="sourceLine" id="cb329-12" title="12">      className<span class="op">={</span><span class="vs">`</span><span class="sc">${</span><span class="va">styles</span>.<span class="at">square</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>styles[rowStyleName]<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>styles[colStyleName]<span class="sc">}</span><span class="vs">`</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb329-13" title="13">        <span class="op">{</span><span class="co">/* </span><span class="al">TODO</span><span class="co"> Render square &quot;X&quot; or &quot;O&quot; image */</span><span class="op">}</span></a>
<a class="sourceLine" id="cb329-14" title="14">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb329-15" title="15">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb329-16" title="16"><span class="op">};</span></a></code></pre></div>
<p>Notice how the component accepts <code>squareIndex</code>, <code>row</code>, and <code>col</code> props to determine what index this square represents and to render the correct CSS Module class names.</p>
<p>Now we can use the <code>Square</code> component in the <code>Game</code> component’s <code>render</code> method. Replace each <code>&lt;div&gt;</code> with the <code>.square</code> class to be a <code>&lt;Square&gt;</code> component taking in a <code>squareIndex</code> prop, a <code>row</code> prop, and a <code>col</code> prop. For reference, here are the entire contents of the <code>./src/components/Game.js</code> file:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb330-1" title="1"><span class="co">// ./src/components/Game.js</span></a>
<a class="sourceLine" id="cb330-2" title="2"></a>
<a class="sourceLine" id="cb330-3" title="3"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb330-4" title="4"><span class="im">import</span> styles <span class="im">from</span> <span class="st">&#39;./Game.module.css&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb330-5" title="5"></a>
<a class="sourceLine" id="cb330-6" title="6"><span class="kw">const</span> Square <span class="op">=</span> (<span class="op">{</span> squareIndex<span class="op">,</span> row<span class="op">,</span> col <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb330-7" title="7">  <span class="kw">const</span> rowStyleName <span class="op">=</span> <span class="vs">`row_</span><span class="sc">${</span>row<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb330-8" title="8">  <span class="kw">const</span> colStyleName <span class="op">=</span> <span class="vs">`col_</span><span class="sc">${</span>col<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb330-9" title="9"></a>
<a class="sourceLine" id="cb330-10" title="10">  <span class="kw">const</span> handleClick <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb330-11" title="11">    <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Clicked on square index: </span><span class="sc">${</span>squareIndex<span class="sc">}</span><span class="vs">...`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb330-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb330-13" title="13"></a>
<a class="sourceLine" id="cb330-14" title="14">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb330-15" title="15">    <span class="op">&lt;</span>div</a>
<a class="sourceLine" id="cb330-16" title="16">      onClick<span class="op">={</span>handleClick<span class="op">}</span></a>
<a class="sourceLine" id="cb330-17" title="17">      className<span class="op">={</span><span class="vs">`</span><span class="sc">${</span><span class="va">styles</span>.<span class="at">square</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>styles[rowStyleName]<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>styles[colStyleName]<span class="sc">}</span><span class="vs">`</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb330-18" title="18">        <span class="op">{</span><span class="co">/* </span><span class="al">TODO</span><span class="co"> Render square &quot;X&quot; or &quot;O&quot; image */</span><span class="op">}</span></a>
<a class="sourceLine" id="cb330-19" title="19">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb330-20" title="20">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb330-21" title="21"><span class="op">};</span></a>
<a class="sourceLine" id="cb330-22" title="22"></a>
<a class="sourceLine" id="cb330-23" title="23"><span class="kw">const</span> Game <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb330-24" title="24">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb330-25" title="25">    <span class="op">&lt;</span>div className<span class="op">={</span><span class="va">styles</span>.<span class="at">game</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb330-26" title="26">      <span class="op">&lt;</span>div className<span class="op">={</span><span class="va">styles</span>.<span class="at">players</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb330-27" title="27">        <span class="op">&lt;</span>div<span class="op">&gt;</span>Player <span class="dt">X</span><span class="op">:</span> <span class="op">{</span><span class="co">/* </span><span class="al">TODO</span><span class="co"> Render player 1 name */</span><span class="op">}</span>&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb330-28" title="28">        <span class="op">&lt;</span>div<span class="op">&gt;</span>Player <span class="dt">O</span><span class="op">:</span> <span class="op">{</span><span class="co">/* </span><span class="al">TODO</span><span class="co"> Render player 2 name */</span><span class="op">}</span>&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb330-29" title="29">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb330-30" title="30">      <span class="op">&lt;</span>h3 className<span class="op">={</span><span class="va">styles</span>.<span class="at">announcement</span><span class="op">}&gt;</span>TODO&lt;/h3<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb330-31" title="31">      <span class="op">&lt;</span>div className<span class="op">={</span><span class="va">styles</span>.<span class="at">tic_tac_toe_board</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb330-32" title="32">        <span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">0</span><span class="op">}</span> row<span class="op">={</span><span class="dv">1</span><span class="op">}</span> col<span class="op">={</span><span class="dv">1</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb330-33" title="33">        <span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">1</span><span class="op">}</span> row<span class="op">={</span><span class="dv">1</span><span class="op">}</span> col<span class="op">={</span><span class="dv">2</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb330-34" title="34">        <span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">2</span><span class="op">}</span> row<span class="op">={</span><span class="dv">1</span><span class="op">}</span> col<span class="op">={</span><span class="dv">3</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb330-35" title="35">        <span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">3</span><span class="op">}</span> row<span class="op">={</span><span class="dv">2</span><span class="op">}</span> col<span class="op">={</span><span class="dv">1</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb330-36" title="36">        <span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">4</span><span class="op">}</span> row<span class="op">={</span><span class="dv">2</span><span class="op">}</span> col<span class="op">={</span><span class="dv">2</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb330-37" title="37">        <span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">5</span><span class="op">}</span> row<span class="op">={</span><span class="dv">2</span><span class="op">}</span> col<span class="op">={</span><span class="dv">3</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb330-38" title="38">        <span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">6</span><span class="op">}</span> row<span class="op">={</span><span class="dv">3</span><span class="op">}</span> col<span class="op">={</span><span class="dv">1</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb330-39" title="39">        <span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">7</span><span class="op">}</span> row<span class="op">={</span><span class="dv">3</span><span class="op">}</span> col<span class="op">={</span><span class="dv">2</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb330-40" title="40">        <span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">8</span><span class="op">}</span> row<span class="op">={</span><span class="dv">3</span><span class="op">}</span> col<span class="op">={</span><span class="dv">3</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb330-41" title="41">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb330-42" title="42">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb330-43" title="43">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb330-44" title="44"><span class="op">}</span></a>
<a class="sourceLine" id="cb330-45" title="45"></a>
<a class="sourceLine" id="cb330-46" title="46"><span class="im">export</span> <span class="im">default</span> Game<span class="op">;</span></a></code></pre></div>
<p>Run your client application again (<code>npm start</code>); this time you should see your empty tic-tac-toe game board displayed:</p>
<figure>
<img src="https://-open-assets.s3-us-west-1.amazonaws.com/Modular-Curriculum/content/react-redux/topics/websockets/assets/websockets-initial-tic-tac-toe-game-board.png" alt="websockets-initial-tic-tac-toe-game-board" /><figcaption>websockets-initial-tic-tac-toe-game-board</figcaption>
</figure>
<h2 id="phase-4-prompting-users-for-their-player-names">Phase 4: Prompting users for their player names</h2>
<p>Before users start a game of tic-tac-toe, let’s prompt them for their player name. Requiring each user to have a player name will make it easier for us to prompt a player to take their turn (i.e. "Select a square {player name}!").</p>
<h3 id="setting-up-a-simple-form">Setting up a simple form</h3>
<p>In the <code>Home</code> component, add a new state variable named <code>playerName</code>. We’re using Hooks, so we’ll call the <code>useState</code> Hook to declare the state variable:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb331-1" title="1"><span class="kw">const</span> [playerName<span class="op">,</span> setPlayerName] <span class="op">=</span> <span class="at">useState</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Now add a simple form, containing a single <code>&lt;input&gt;</code> element and a <code>&lt;button&gt;</code> element, to prompt the user for their player name. Let’s also change the <code>&lt;h2&gt;</code> heading element to "Welcome!" and add a brief welcome message that prompts the user for their player name:</p>
<pre class="jsx"><code>&lt;div&gt;
  &lt;h2&gt;Welcome!&lt;/h2&gt;
  &lt;p&gt;Please provide your player name and 
    click the &quot;Play Game&quot; button to start a game.&lt;/p&gt;
  &lt;form onSubmit={onSubmit}&gt;
    &lt;input type=&#39;text&#39; value={playerName}
      onChange={onChange} /&gt;
    &lt;button&gt;Play Game&lt;/button&gt;
  &lt;/form&gt;
&lt;/div&gt;</code></pre>
<p>Notice that the <code>&lt;form&gt;</code> and <code>&lt;input&gt;</code> elements respectively reference <code>onSubmit</code> and <code>onChange</code> event handler functions. Go ahead and add those event handler functions. The <code>onSubmit</code> event handler function should prevent the form’s default submit action and the <code>onChange</code> event handler function should use the target <code>&lt;input&gt;</code> element’s <code>value</code> to update the <code>playerName</code> state variable.</p>
<p>At this point, you should be able to enter and remove characters in the <code>&lt;input&gt;</code> element and click the "Play Game" button, though nothing will occur (as expected since your <code>onSubmit</code> function simply prevents the form’s default submit action).</p>
<h3 id="validating-the-form">Validating the form</h3>
<p>To ensure that the user enters a player name before starting a game, let’s add validation to our form.</p>
<p>Add another state variable named <code>errors</code> to your <code>Home</code> component with an initial value of an empty array (i.e. <code>[]</code>):</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb333-1" title="1"><span class="kw">const</span> [errors<span class="op">,</span> setErrors] <span class="op">=</span> <span class="at">useState</span>([])<span class="op">;</span></a></code></pre></div>
<p>In the <code>onSubmit</code> event handler function, declare a variable named <code>errorsToSet</code> set to an empty array. If the <code>playerName</code> state variable is falsy push a message onto the <code>errorsToSet</code> array containing the text "Please provide a player name." Then if the <code>errorsToSet</code> array contains an element, use it to set the <code>errors</code> state variable by invoking <code>setErrors</code>.</p>
<p>When updating state variables that reference objects and arrays, always prefer to update the state variables with new objects or arrays instead of modifying or mutating the existing objects or arrays. For example, instead of pushing an element onto the <code>errors</code> state variable in the <code>onSubmit</code> event handler function, we’re creating a new array, pushing an element onto the new array, and then passing the new array into a call to <code>setErrors</code>.</p>
<p>To render the validation errors, you can create a <code>ValidationErrors</code> subcomponent in your <code>Home.js</code> file like this:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb334-1" title="1"><span class="kw">const</span> ValidationErrors <span class="op">=</span> (<span class="op">{</span> errors <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb334-2" title="2">  <span class="cf">if</span> (errors <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> <span class="va">errors</span>.<span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb334-3" title="3">    <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb334-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb334-5" title="5"></a>
<a class="sourceLine" id="cb334-6" title="6">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb334-7" title="7">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb334-8" title="8">      <span class="op">&lt;</span>p<span class="op">&gt;</span>Please correct the following <span class="dt">errors</span><span class="op">:</span>&lt;/p<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb334-9" title="9">      <span class="op">&lt;</span>ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb334-10" title="10">        <span class="op">{</span> <span class="va">errors</span>.<span class="at">map</span>(error <span class="kw">=&gt;</span> <span class="op">&lt;</span>li key<span class="op">={</span>error<span class="op">}&gt;{</span>error<span class="op">}</span>&lt;/li<span class="op">&gt;</span>) <span class="op">}</span></a>
<a class="sourceLine" id="cb334-11" title="11">      &lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb334-12" title="12">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb334-13" title="13">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb334-14" title="14"><span class="op">};</span></a></code></pre></div>
<p>And then add it just above the form passing in the <code>errors</code> state variable:</p>
<pre class="jsx"><code>&lt;ValidationErrors errors={errors} /&gt;
&lt;form onSubmit={onSubmit}&gt;
  &lt;input type=&#39;text&#39; value={playerName}
    onChange={onChange} /&gt;
  &lt;button&gt;Play Game&lt;/button&gt;
&lt;/form&gt;</code></pre>
<h3 id="passing-the-player-name-up-to-the-app-component">Passing the player name up to the <code>App</code> component</h3>
<p>Now that the <code>Home</code> component has a form to prompt the user for their player name, we need a way to pass the player name back up to the <code>App</code> component so that it can be kept with all of the other global state (that’s yet to be defined).</p>
<p>In the <code>App</code> component, call the <code>useState</code> Hook to declare a <code>playerName</code> state variable:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb336-1" title="1"><span class="kw">const</span> [playerName<span class="op">,</span> setPlayerName] <span class="op">=</span> <span class="at">useState</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Next, declare an <code>updatePlayerName</code> function that accepts a <code>playerName</code> parameter and calls <code>setPlayerName</code> to update the <code>playerName</code> state variable:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb337-1" title="1"><span class="kw">const</span> updatePlayerName <span class="op">=</span> (playerName) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb337-2" title="2">  <span class="at">setPlayerName</span>(playerName)<span class="op">;</span></a>
<a class="sourceLine" id="cb337-3" title="3"><span class="op">};</span></a></code></pre></div>
<p>Then pass the <code>updatePlayerName</code> function into the <code>Home</code> component as a prop:</p>
<pre class="jsx"><code>&lt;Home updatePlayerName={updatePlayerName} /&gt;</code></pre>
<p>Back in the <code>App</code> component, use destructuring to get a reference to the <code>updatePlayerName</code> prop and call it within the <code>onSubmit</code> event handler function:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb339-1" title="1"><span class="kw">const</span> Home <span class="op">=</span> (<span class="op">{</span> updatePlayerName <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb339-2" title="2">  <span class="co">// Code removed for brevity.</span></a>
<a class="sourceLine" id="cb339-3" title="3"></a>
<a class="sourceLine" id="cb339-4" title="4">  <span class="kw">const</span> onSubmit <span class="op">=</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb339-5" title="5">    <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb339-6" title="6"></a>
<a class="sourceLine" id="cb339-7" title="7">    <span class="kw">const</span> errorsToSet <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb339-8" title="8"></a>
<a class="sourceLine" id="cb339-9" title="9">    <span class="cf">if</span> (<span class="op">!</span>playerName) <span class="op">{</span></a>
<a class="sourceLine" id="cb339-10" title="10">      <span class="va">errorsToSet</span>.<span class="at">push</span>(<span class="st">&#39;Please provide a player name.&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb339-11" title="11">    <span class="op">}</span></a>
<a class="sourceLine" id="cb339-12" title="12"></a>
<a class="sourceLine" id="cb339-13" title="13">    <span class="cf">if</span> (<span class="va">errorsToSet</span>.<span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb339-14" title="14">      <span class="at">setErrors</span>(errorsToSet)<span class="op">;</span></a>
<a class="sourceLine" id="cb339-15" title="15">      <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb339-16" title="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb339-17" title="17"></a>
<a class="sourceLine" id="cb339-18" title="18">    <span class="at">updatePlayerName</span>(playerName)<span class="op">;</span></a>
<a class="sourceLine" id="cb339-19" title="19">  <span class="op">};</span></a>
<a class="sourceLine" id="cb339-20" title="20"></a>
<a class="sourceLine" id="cb339-21" title="21">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb339-22" title="22">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb339-23" title="23">      <span class="op">{</span><span class="co">/* Code removed for brevity. */</span><span class="op">}</span></a>
<a class="sourceLine" id="cb339-24" title="24">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb339-25" title="25">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb339-26" title="26"><span class="op">}</span></a></code></pre></div>
<p>Lastly, update the <code>App</code> component to render the <code>Game</code> component if there’s a player name, otherwise render the <code>Home</code> component:</p>
<pre class="jsx"><code>&lt;div&gt;
  &lt;h1&gt;Tic-Tac-Toe Online&lt;/h1&gt;
  {playerName ? (
    &lt;Game playerName={playerName} /&gt;
  ) : (
    &lt;Home updatePlayerName={updatePlayerName} /&gt;
  )}
&lt;/div&gt;</code></pre>
<blockquote>
<p>There are multiple ways to conditionally display elements in JSX. The above example uses an inline expression. Earlier you saw an example of using a subcomponent to conditionally displaying validation messages. Feel free to use the approach that you feel is easiest to write and read.</p>
</blockquote>
<h3 id="testing">Testing</h3>
<p>Take a moment to test your validation error rendering by submitting an empty player name. You should see your <code>'Please provide a player name.'</code> error rendered. Upon a valid form submission to set the <code>playerName</code>, your application should be rendering the <code>&lt;Game&gt;</code> component instead of <code>&lt;Home&gt;</code>. Test that this is working before moving forward.</p>
<p>If you test your client application again, you should see the <code>Home</code> component displayed first, prompting you to enter your player name. Click the "Play Game" button without entering a player name to test that you receive a validation error message asking you to enter a player name. Then provide a player name and click the "Play Game" button. You should now see the <code>Game</code> component being displayed.</p>
<blockquote>
<p>It’s worth noting that we haven’t done anything to prevent a user from entering a player name that’s already been provided by another player. For now, we’ll make a point to enter unique player names when testing so that we can turn our attention to setting up the client/server interaction using WebSockets.</p>
</blockquote>
<h2 id="phase-5-setting-up-websockets">Phase 5: Setting up WebSockets</h2>
<p>Things are moving nicely along! With the player name available, we’re ready to set up the WebSocket server and update the client to connection to the server and send a message.</p>
<p>As you set up the server and client to use WebSockets, you’ll notice that the APIs are very similar. Both the server and the client can send and receive messages (that’s the "two-way" communication that we’re looking for) and both fire events when an errors occur or when connections are closed. An important distinction between the server and the client is that only the server <em>is listening for new connections</em> and only the client <em>can initiate a new connection</em>.</p>
<h3 id="update-the-server">Update the server</h3>
<p>We’ll be using the <code>ws</code> npm package to set up a WebSocket server, so install it in your server project using npm:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb341-1" title="1"><span class="ex">npm</span> install ws@^7.0.0</a></code></pre></div>
<p>In the <code>app</code> module (the <code>app.js</code> file), import the <code>ws</code> module as <code>WebSocket</code>:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb342-1" title="1"><span class="kw">const</span> WebSocket <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;ws&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Just after the call to the <code>createServer</code> function (i.e. <code>const server = createServer(app);</code>), create a WebSocket server by calling the <code>WebSocket.Server</code> method with the <code>new</code> keyword:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb343-1" title="1"><span class="kw">const</span> wss <span class="op">=</span> <span class="kw">new</span> <span class="va">WebSocket</span>.<span class="at">Server</span>(<span class="op">{</span> server <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Notice that we’re passing in the existing HTTP server by setting the <code>server</code> variable as a property on an options object. After creating the WebSocket server we can listen for connections by listening for <code>connection</code> events:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb344-1" title="1"><span class="va">wss</span>.<span class="at">on</span>(<span class="st">&#39;connection&#39;</span><span class="op">,</span> (ws) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb344-2" title="2"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>When a WebSocket connection is established, the callback function will be called with the WebSocket passed in via the <code>ws</code> parameter. We can then listen for <code>message</code> and <code>close</code> events on the WebSocket:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb345-1" title="1"><span class="va">wss</span>.<span class="at">on</span>(<span class="st">&#39;connection&#39;</span><span class="op">,</span> (ws) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb345-2" title="2">  <span class="va">ws</span>.<span class="at">on</span>(<span class="st">&#39;message&#39;</span><span class="op">,</span> (jsonData) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb345-3" title="3">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb345-4" title="4"></a>
<a class="sourceLine" id="cb345-5" title="5">  <span class="va">ws</span>.<span class="at">on</span>(<span class="st">&#39;close&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb345-6" title="6">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb345-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><code>message</code> events are fired when a message is received from the client while <code>close</code> events are fired when the WebSocket connection is closed. For now, just add a <code>TODO</code> comment for the <code>close</code> event handler callback function:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb346-1" title="1"><span class="va">ws</span>.<span class="at">on</span>(<span class="st">&#39;close&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb346-2" title="2">  <span class="co">// </span><span class="al">TODO</span><span class="co"> Cleanup the player that&#39;s associated with this WS.</span></a>
<a class="sourceLine" id="cb346-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>In the <code>message</code> event handler callback function, define a parameter named <code>jsonData</code> and call a function named <code>processIncomingMessage</code> passing in the <code>jsonData</code> parameter and the enclosed <code>ws</code> parameter (from the <code>connection</code> event handler callback function):</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb347-1" title="1"><span class="va">ws</span>.<span class="at">on</span>(<span class="st">&#39;message&#39;</span><span class="op">,</span> (jsonData) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb347-2" title="2">  <span class="at">processIncomingMessage</span>(jsonData<span class="op">,</span> ws)<span class="op">;</span></a>
<a class="sourceLine" id="cb347-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The <code>jsonData</code> parameter is set to the data for the incoming message which will be formatted as JSON (we’ll see how to do that from the client in just a bit).</p>
<p>Now declare a <code>processIncomingMessage</code> function that logs the <code>jsonData</code> to the console (to help with testing and debugging) and uses the <code>JSON.parse</code> method to parse the <code>jsonData</code> to a JavaScript object:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb348-1" title="1"><span class="kw">const</span> processIncomingMessage <span class="op">=</span> (jsonData<span class="op">,</span> ws) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb348-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Processing incoming message </span><span class="sc">${</span>jsonData<span class="sc">}</span><span class="vs">...`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb348-3" title="3"></a>
<a class="sourceLine" id="cb348-4" title="4">  <span class="kw">const</span> message <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(jsonData)<span class="op">;</span></a>
<a class="sourceLine" id="cb348-5" title="5"><span class="op">};</span></a></code></pre></div>
<p>The structure of the WebSocket message is completely up to us to decide. The WS specification has no opinion about the structure of the message payload. For this application, on both the client and server, let’s use the following message structure:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb349-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb349-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;the-message-type&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb349-3" title="3">  <span class="dt">data</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb349-4" title="4">    <span class="co">// One or more properties for the message data.</span></a>
<a class="sourceLine" id="cb349-5" title="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb349-6" title="6"><span class="op">}</span></a></code></pre></div>
<p>Using the above general message structure, when the client sends a message to add a new player, the message will look like this:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb350-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb350-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;add-new-player&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb350-3" title="3">  <span class="dt">data</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb350-4" title="4">    <span class="dt">playerName</span><span class="op">:</span> <span class="st">&#39;[the player name]&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb350-5" title="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb350-6" title="6"><span class="op">}</span></a></code></pre></div>
<p>After parsing the JSON formatted data to an object, we can switch on the <code>message.type</code> property to process specific message types:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb351-1" title="1"><span class="kw">const</span> processIncomingMessage <span class="op">=</span> (jsonData<span class="op">,</span> ws) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb351-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Processing incoming message </span><span class="sc">${</span>jsonData<span class="sc">}</span><span class="vs">...`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb351-3" title="3"></a>
<a class="sourceLine" id="cb351-4" title="4">  <span class="kw">const</span> message <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(jsonData)<span class="op">;</span></a>
<a class="sourceLine" id="cb351-5" title="5"></a>
<a class="sourceLine" id="cb351-6" title="6">  <span class="cf">switch</span> (<span class="va">message</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb351-7" title="7">    <span class="cf">case</span> <span class="st">&#39;add-new-player&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb351-8" title="8">      <span class="at">addNewPlayer</span>(<span class="va">message</span>.<span class="va">data</span>.<span class="at">playerName</span><span class="op">,</span> ws)<span class="op">;</span></a>
<a class="sourceLine" id="cb351-9" title="9">      <span class="cf">break</span><span class="op">;</span></a>
<a class="sourceLine" id="cb351-10" title="10">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb351-11" title="11">      <span class="cf">throw</span> <span class="kw">new</span> <span class="at">Error</span>(<span class="vs">`Unknown message type: </span><span class="sc">${</span><span class="va">message</span>.<span class="at">type</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb351-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb351-13" title="13"><span class="op">};</span></a></code></pre></div>
<p>Notice how we’re throwing an error if the message type is an unexpected or unknown message type. This will help us when testing and debugging if something goes wrong with the client message type.</p>
<p>For now, just stub out the <code>addNewPlayer</code> function:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb352-1" title="1"><span class="kw">const</span> addNewPlayer <span class="op">=</span> (playerName<span class="op">,</span> ws) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb352-2" title="2">  <span class="co">// </span><span class="al">TODO</span><span class="co"> Handle adding the new player.</span></a>
<a class="sourceLine" id="cb352-3" title="3"><span class="op">};</span></a></code></pre></div>
<h3 id="updating-the-client">Updating the client</h3>
<p>Before we can test the WebSocket server, we need to update the client to create a WebSocket connection and send a message to the server.</p>
<p>To start, add an <code>.env</code> file to the root of the <code>client</code> folder with the following contents:</p>
<pre><code>REACT_APP_WS_URL=ws://localhost:8080</code></pre>
<p>Notice that we use <code>ws</code> instead of <code>http</code> to specify the WebSocket URL. The <code>localhost:8080</code> hostname and port is the Express server that’s hosting the WebSocket server. Defining an environment variable will make it easier for you later on to set the WebSocket URL to the correct value for each environment.</p>
<blockquote>
<p>If you were using HTTPS (SSL/TLS) for your HTTP traffic, you’d need to use <code>wss</code> instead of <code>ws</code> to indicate that you want to make a secure WebSocket connection. Failing to do that would result in a browser error.</p>
</blockquote>
<p>At the top of the <code>App</code> module, import two additional Hooks, <code>useEffect</code> and <code>useRef</code>:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb354-1" title="1"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span> useState<span class="op">,</span> useEffect<span class="op">,</span> useRef <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a></code></pre></div>
<p>The <code>useEffect</code> Hook give us a way to add code to function components that will cause side effects. We’ll put all of the code that’s responsible for creating and configuring the WebSocket in a <code>useEffect</code> Hook as the WebSocket will cause side effects as it sends messages to the server.</p>
<p>The <code>useRef</code> Hook gives us a convenient way to store a reference to an object that will persist for the full lifetime of the component. We’ll use it in just a bit to store away the WebSocket object so that we can interact with it later on.</p>
<p>Inside of the <code>App</code> component, just after the call to the <code>useState</code> Hook to declare the <code>playerName</code> state variable, call the <code>useRef</code> Hook to declare a <code>webSocket</code> variable:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb355-1" title="1"><span class="kw">const</span> webSocket <span class="op">=</span> <span class="at">useRef</span>(<span class="kw">null</span>)<span class="op">;</span></a></code></pre></div>
<p>Then call the <code>useEffect</code> Hook and pass in an arrow function:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb356-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb356-2" title="2"></a>
<a class="sourceLine" id="cb356-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>By default, the function passed into the <code>useEffect</code> Hook (referred to as the "effect") will run after every completed render. We can change the default behavior by passing in a second argument that’s an array of values that the effect depends on:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb357-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb357-2" title="2"></a>
<a class="sourceLine" id="cb357-3" title="3"><span class="op">},</span> [playerName])<span class="op">;</span></a></code></pre></div>
<p>Now our effect will only run when the <code>playerName</code> state variable is changed. We can add an additional optimization by immediately returning from the function if the <code>playerName</code> variable doesn’t have a value (for our particular use case, it doesn’t make any sense to create a WebSocket if we don’t have a <code>playerName</code> value):</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb358-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb358-2" title="2">  <span class="cf">if</span> (<span class="op">!</span>playerName) <span class="op">{</span></a>
<a class="sourceLine" id="cb358-3" title="3">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb358-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb358-5" title="5"></a>
<a class="sourceLine" id="cb358-6" title="6"><span class="op">},</span> [playerName])<span class="op">;</span></a></code></pre></div>
<p>Within the effect, create a new client-side WebSocket object by passing in the URL of the WebSocket server, represented by the <code>REACT_APP_WS_URL</code> environment variable. Then set the <code>webSocket</code> ref object’s <code>current</code> property to an object literal with a <code>ws</code> property for the WebSocket:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb359-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb359-2" title="2">  <span class="cf">if</span> (<span class="op">!</span>playerName) <span class="op">{</span></a>
<a class="sourceLine" id="cb359-3" title="3">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb359-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb359-5" title="5"></a>
<a class="sourceLine" id="cb359-6" title="6">  <span class="kw">const</span> ws <span class="op">=</span> <span class="kw">new</span> <span class="at">WebSocket</span>(<span class="va">process</span>.<span class="va">env</span>.<span class="at">REACT_APP_WS_URL</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb359-7" title="7"></a>
<a class="sourceLine" id="cb359-8" title="8">  <span class="co">// </span><span class="al">TODO</span><span class="co"> Define event listeners.</span></a>
<a class="sourceLine" id="cb359-9" title="9"></a>
<a class="sourceLine" id="cb359-10" title="10">  <span class="va">webSocket</span>.<span class="at">current</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb359-11" title="11">    ws<span class="op">,</span></a>
<a class="sourceLine" id="cb359-12" title="12">  <span class="op">};</span></a>
<a class="sourceLine" id="cb359-13" title="13"><span class="op">},</span> [playerName])<span class="op">;</span></a></code></pre></div>
<p>Setting the <code>webSocket</code> ref object’s <code>current</code> property to an object literal (instead of the WebSocket object directly) gives us a safe, convenient way to add references to inline helper functions (we’ll write one later in this project).</p>
<blockquote>
<p>It’s worth noting that updating or changing the <code>webSocket</code> ref object’s <code>current</code> property won’t cause the component to render. The ref object’s <code>current</code> property is similar in function to an ES2015 class instance field.</p>
</blockquote>
<p>We can also return a cleanup function from our effect. This function will be called before the effect is ran so that the previous execution of the effect can be properly cleaned up. To cleanup our effect, we need to call the <code>close</code> method on the WebSocket object (if it’s available) to close the connection to the server:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb360-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb360-2" title="2">  <span class="cf">if</span> (<span class="op">!</span>playerName) <span class="op">{</span></a>
<a class="sourceLine" id="cb360-3" title="3">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb360-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb360-5" title="5"></a>
<a class="sourceLine" id="cb360-6" title="6">  <span class="kw">const</span> ws <span class="op">=</span> <span class="kw">new</span> <span class="at">WebSocket</span>(<span class="va">process</span>.<span class="va">env</span>.<span class="at">REACT_APP_WS_URL</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb360-7" title="7"></a>
<a class="sourceLine" id="cb360-8" title="8">  <span class="co">// </span><span class="al">TODO</span><span class="co"> Define event listeners.</span></a>
<a class="sourceLine" id="cb360-9" title="9"></a>
<a class="sourceLine" id="cb360-10" title="10">  <span class="va">webSocket</span>.<span class="at">current</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb360-11" title="11">    ws<span class="op">,</span></a>
<a class="sourceLine" id="cb360-12" title="12">  <span class="op">};</span></a>
<a class="sourceLine" id="cb360-13" title="13"></a>
<a class="sourceLine" id="cb360-14" title="14">  <span class="cf">return</span> <span class="kw">function</span> <span class="at">cleanup</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb360-15" title="15">    <span class="cf">if</span> (<span class="va">webSocket</span>.<span class="at">current</span> <span class="op">!==</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb360-16" title="16">      <span class="va">webSocket</span>.<span class="va">current</span>.<span class="va">ws</span>.<span class="at">close</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb360-17" title="17">    <span class="op">}</span></a>
<a class="sourceLine" id="cb360-18" title="18">  <span class="op">};</span></a>
<a class="sourceLine" id="cb360-19" title="19"><span class="op">},</span> [playerName])<span class="op">;</span></a></code></pre></div>
<p>The WebSocket object provides four events:</p>
<ul>
<li><code>open</code> - Fires when the connection is opened;</li>
<li><code>message</code> - Fires when a message is received;</li>
<li><code>error</code> - Fires when the connection has been closed because of an error; and</li>
<li><code>close</code> - Fires when the connection is closed.</li>
</ul>
<p>We can listen for these events by assigning an event listener to the following properties. Replace the <code>TODO</code> comment for defining event listeners to the WebSocket event listeners below:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb361-1" title="1"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb361-2" title="2">  <span class="cf">if</span> (<span class="op">!</span>playerName) <span class="op">{</span></a>
<a class="sourceLine" id="cb361-3" title="3">    <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb361-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb361-5" title="5"></a>
<a class="sourceLine" id="cb361-6" title="6">  <span class="kw">const</span> ws <span class="op">=</span> <span class="kw">new</span> <span class="at">WebSocket</span>(<span class="va">process</span>.<span class="va">env</span>.<span class="at">REACT_APP_WS_URL</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb361-7" title="7"></a>
<a class="sourceLine" id="cb361-8" title="8">  <span class="va">ws</span>.<span class="at">onopen</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb361-9" title="9">  <span class="op">};</span></a>
<a class="sourceLine" id="cb361-10" title="10">  </a>
<a class="sourceLine" id="cb361-11" title="11">  <span class="va">ws</span>.<span class="at">onmessage</span> <span class="op">=</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb361-12" title="12">    <span class="va">console</span>.<span class="at">log</span>(e)<span class="op">;</span></a>
<a class="sourceLine" id="cb361-13" title="13">  <span class="op">};</span></a>
<a class="sourceLine" id="cb361-14" title="14">  </a>
<a class="sourceLine" id="cb361-15" title="15">  <span class="va">ws</span>.<span class="at">onerror</span> <span class="op">=</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb361-16" title="16">    <span class="va">console</span>.<span class="at">error</span>(e)<span class="op">;</span></a>
<a class="sourceLine" id="cb361-17" title="17">  <span class="op">};</span></a>
<a class="sourceLine" id="cb361-18" title="18">  </a>
<a class="sourceLine" id="cb361-19" title="19">  <span class="va">ws</span>.<span class="at">onclose</span> <span class="op">=</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb361-20" title="20">    <span class="va">console</span>.<span class="at">log</span>(e)<span class="op">;</span></a>
<a class="sourceLine" id="cb361-21" title="21">  <span class="op">};</span></a>
<a class="sourceLine" id="cb361-22" title="22"></a>
<a class="sourceLine" id="cb361-23" title="23">  <span class="va">webSocket</span>.<span class="at">current</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb361-24" title="24">    ws<span class="op">,</span></a>
<a class="sourceLine" id="cb361-25" title="25">  <span class="op">};</span></a>
<a class="sourceLine" id="cb361-26" title="26"></a>
<a class="sourceLine" id="cb361-27" title="27">  <span class="cf">return</span> <span class="kw">function</span> <span class="at">cleanup</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb361-28" title="28">    <span class="cf">if</span> (<span class="va">webSocket</span>.<span class="at">current</span> <span class="op">!==</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb361-29" title="29">      <span class="va">webSocket</span>.<span class="va">current</span>.<span class="va">ws</span>.<span class="at">close</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb361-30" title="30">    <span class="op">}</span></a>
<a class="sourceLine" id="cb361-31" title="31">  <span class="op">};</span></a>
<a class="sourceLine" id="cb361-32" title="32"><span class="op">},</span> [playerName])<span class="op">;</span></a></code></pre></div>
<blockquote>
<p>There are two ways to assign event listeners: using the above properties (i.e. <code>onopen</code>, <code>onmessage</code>, <code>onerror</code>, or <code>onclose</code>) or using the <code>addEventListener</code> method and passing in the event name and a callback function (i.e. <code>ws.addEventListener('message', (e) =&gt; console.log(e));</code>). Either approach is valid; use the one that you or your team prefers.</p>
</blockquote>
<p>When the WebSocket connection is opened, send an <code>add-new-player</code> message to the server with the <code>playerName</code> value as the message data:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb362-1" title="1"><span class="va">ws</span>.<span class="at">onopen</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb362-2" title="2">  <span class="kw">const</span> message <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb362-3" title="3">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;add-new-player&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb362-4" title="4">    <span class="dt">data</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb362-5" title="5">      playerName<span class="op">,</span></a>
<a class="sourceLine" id="cb362-6" title="6">    <span class="op">},</span></a>
<a class="sourceLine" id="cb362-7" title="7">  <span class="op">};</span></a>
<a class="sourceLine" id="cb362-8" title="8"></a>
<a class="sourceLine" id="cb362-9" title="9">  <span class="va">ws</span>.<span class="at">send</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(message))<span class="op">;</span></a>
<a class="sourceLine" id="cb362-10" title="10"><span class="op">};</span></a></code></pre></div>
<p>The message structure for the outgoing message aligns with what we described earlier when we set up the WebSocket server. Notice how you are manually structuring the <code>message</code> object to generate the message structure below. Also notice that the <code>JSON.stringify</code> method is used to format the message as JSON (as the server is expecting it to be) before passing it to the WebSocket <code>send</code> method.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb363-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb363-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;add-new-player&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb363-3" title="3">  <span class="dt">data</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb363-4" title="4">    <span class="dt">playerName</span><span class="op">:</span> <span class="st">&#39;[the player name]&#39;</span></a>
<a class="sourceLine" id="cb363-5" title="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb363-6" title="6"><span class="op">}</span></a></code></pre></div>
<h3 id="testing-1">Testing</h3>
<p>Start your server by running <code>npm start</code> from a terminal within the <code>server</code> folder then start the client by running <code>npm start</code> within the <code>client</code> folder. In the client, enter a player name and click the "Play Game" button. In the server’s terminal window, you should see something similar to the following output:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb364-1" title="1"><span class="ex">Processing</span> incoming message {<span class="st">&quot;type&quot;</span>:<span class="st">&quot;add-new-player&quot;</span>,<span class="st">&quot;data&quot;</span>:{<span class="st">&quot;playerName&quot;</span>:<span class="st">&quot;[the player name you entered]&quot;</span>}}<span class="ex">...</span></a></code></pre></div>
<p><strong>Congrats!</strong> You just created a WebSocket server, initiated a WebSocket connection from a React application, and received the WebSocket message on the server.</p>
<p>Notice that we don’t have set up CORS to give the client application access to the WebSocket server that’s running on a different <code>localhost</code> port. WebSocket connections aren’t restricted to same-origin like HTTP requests are.</p>
<h2 id="phase-6-starting-a-game">Phase 6: Starting a game</h2>
<p>Once two players have connected to the server using WebSockets, we’re ready to start a game. To do that, we need define a couple of classes to track player and game state data on the server.</p>
<h3 id="tracking-player-and-game-state-data-on-the-server">Tracking player and game state data on the server</h3>
<p>Add a <code>game-state.js</code> file to the root of the server project. Then define two classes in the module:</p>
<ul>
<li>A <code>Player</code> class to track connected players; and</li>
<li>A <code>Game</code> class to encapsulate the logic and state for a game of tic-tac-toe.</li>
</ul>
<div class="sourceCode" id="cb365"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb365-1" title="1"><span class="kw">class</span> Player <span class="op">{</span></a>
<a class="sourceLine" id="cb365-2" title="2">  <span class="at">constructor</span>(playerName<span class="op">,</span> ws) <span class="op">{</span></a>
<a class="sourceLine" id="cb365-3" title="3">    <span class="kw">this</span>.<span class="at">playerName</span> <span class="op">=</span> playerName<span class="op">;</span></a>
<a class="sourceLine" id="cb365-4" title="4">    <span class="kw">this</span>.<span class="at">ws</span> <span class="op">=</span> ws<span class="op">;</span></a>
<a class="sourceLine" id="cb365-5" title="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb365-6" title="6"></a>
<a class="sourceLine" id="cb365-7" title="7">  <span class="at">getData</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb365-8" title="8">    <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb365-9" title="9">      <span class="dt">playerName</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">playerName</span><span class="op">,</span></a>
<a class="sourceLine" id="cb365-10" title="10">    <span class="op">};</span></a>
<a class="sourceLine" id="cb365-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb365-12" title="12"><span class="op">}</span></a></code></pre></div>
<div class="sourceCode" id="cb366"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb366-1" title="1"><span class="kw">class</span> Game <span class="op">{</span></a>
<a class="sourceLine" id="cb366-2" title="2">  <span class="at">constructor</span>(player1) <span class="op">{</span></a>
<a class="sourceLine" id="cb366-3" title="3">    <span class="kw">this</span>.<span class="at">player1</span> <span class="op">=</span> player1<span class="op">;</span></a>
<a class="sourceLine" id="cb366-4" title="4">    <span class="kw">this</span>.<span class="at">player2</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb366-5" title="5">    <span class="kw">this</span>.<span class="at">player1Symbol</span> <span class="op">=</span> <span class="st">&#39;X&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb366-6" title="6">    <span class="kw">this</span>.<span class="at">player2Symbol</span> <span class="op">=</span> <span class="st">&#39;O&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb366-7" title="7">    <span class="kw">this</span>.<span class="at">currentPlayer</span> <span class="op">=</span> player1<span class="op">;</span></a>
<a class="sourceLine" id="cb366-8" title="8">    <span class="kw">this</span>.<span class="at">squareValues</span> <span class="op">=</span> [<span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb366-9" title="9">    <span class="kw">this</span>.<span class="at">gameOver</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb366-10" title="10">    <span class="kw">this</span>.<span class="at">winner</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb366-11" title="11">    <span class="kw">this</span>.<span class="at">statusMessage</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb366-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb366-13" title="13"></a>
<a class="sourceLine" id="cb366-14" title="14">  <span class="at">getPlayers</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb366-15" title="15">    <span class="cf">return</span> [<span class="kw">this</span>.<span class="at">player1</span><span class="op">,</span> <span class="kw">this</span>.<span class="at">player2</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb366-16" title="16">  <span class="op">}</span></a>
<a class="sourceLine" id="cb366-17" title="17"></a>
<a class="sourceLine" id="cb366-18" title="18">  <span class="at">getData</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb366-19" title="19">    <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb366-20" title="20">      <span class="dt">player1</span><span class="op">:</span> <span class="kw">this</span>.<span class="va">player1</span>.<span class="at">getData</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb366-21" title="21">      <span class="dt">player2</span><span class="op">:</span> <span class="kw">this</span>.<span class="va">player2</span>.<span class="at">getData</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb366-22" title="22">      <span class="dt">player1Symbol</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">player1Symbol</span><span class="op">,</span></a>
<a class="sourceLine" id="cb366-23" title="23">      <span class="dt">player2Symbol</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">player2Symbol</span><span class="op">,</span></a>
<a class="sourceLine" id="cb366-24" title="24">      <span class="dt">currentPlayer</span><span class="op">:</span> <span class="kw">this</span>.<span class="va">currentPlayer</span>.<span class="at">getData</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb366-25" title="25">      <span class="dt">squareValues</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">squareValues</span><span class="op">,</span></a>
<a class="sourceLine" id="cb366-26" title="26">      <span class="dt">gameOver</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">gameOver</span><span class="op">,</span></a>
<a class="sourceLine" id="cb366-27" title="27">      <span class="dt">winner</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">winner</span> <span class="op">?</span> <span class="kw">this</span>.<span class="va">winner</span>.<span class="at">getData</span>() : <span class="kw">null</span><span class="op">,</span></a>
<a class="sourceLine" id="cb366-28" title="28">      <span class="dt">statusMessage</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">statusMessage</span><span class="op">,</span></a>
<a class="sourceLine" id="cb366-29" title="29">    <span class="op">};</span></a>
<a class="sourceLine" id="cb366-30" title="30">  <span class="op">}</span></a>
<a class="sourceLine" id="cb366-31" title="31"><span class="op">}</span></a></code></pre></div>
<p>Be sure to export both classes from the module:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb367-1" title="1"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb367-2" title="2">  Game<span class="op">,</span></a>
<a class="sourceLine" id="cb367-3" title="3">  Player<span class="op">,</span></a>
<a class="sourceLine" id="cb367-4" title="4"><span class="op">};</span></a></code></pre></div>
<p>The <code>Player</code> class is a simple class that’s used to associate a player name with a WebSocket connection. The <code>getData</code> method is a convenience method that we’ll call when creating WebSocket messages to get the data for the player.</p>
<p>The <code>Game</code> class encapsulates our game state on the server. When the client app interacts with the server, the game state on the server will be updated. We’ll be adding additional methods to this class as we implement functionality in the game. This class also has a <code>getData</code> method that’ll be used to get the data for the game when creating WebSocket messages.</p>
<p>Ideally, our player and game state data would be persisted to a database, so that if/when the server is restarted, the data would not be lost. To keep things as simple as possible for now, we’ll just store the data in memory.</p>
<h3 id="sending-the-start-game-message-to-the-client">Sending the <code>start-game</code> message to the client</h3>
<p>Now we can update the <code>addNewPlayer</code> function in the <code>app</code> module to create a new game when the first player connects and to start the game when the second player connects.</p>
<p>Import the <code>Game</code> and <code>Player</code> classes into the <code>app</code> module (the <code>app.js</code> file):</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb368-1" title="1"><span class="kw">const</span> <span class="op">{</span> Game<span class="op">,</span> Player <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./game-state&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Declare a <code>game</code> variable just after the line of code that creates the WebSocket server (i.e. <code>const wss = new WebSocket.Server({ server });</code>):</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb369-1" title="1"><span class="kw">let</span> game <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a></code></pre></div>
<p>This module-level global variable is how we’ll be persisting the game across WebSocket messages.</p>
<p>Navigate to the <code>addNewPlayer</code> function in the <code>app</code> module and instantiate an instance of the <code>Player</code> class, passing in the <code>playerName</code> and <code>ws</code> parameters:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb370-1" title="1"><span class="kw">const</span> addNewPlayer <span class="op">=</span> (playerName<span class="op">,</span> ws) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb370-2" title="2">  <span class="kw">const</span> player <span class="op">=</span> <span class="kw">new</span> <span class="at">Player</span>(playerName<span class="op">,</span> ws)<span class="op">;</span></a>
<a class="sourceLine" id="cb370-3" title="3">  <span class="co">// </span><span class="al">TODO</span></a>
<a class="sourceLine" id="cb370-4" title="4"><span class="op">};</span></a></code></pre></div>
<p>Then add an <code>if</code>/<code>else if</code>/<code>else</code> statement that does the following:</p>
<ul>
<li><code>if</code> the <code>game</code> global variable is <code>null</code>, then instantiate an instance of the <code>Game</code> class, passing in the new player (who becomes player "1")</li>
<li><code>else if</code> the game’s <code>player2</code> property is <code>null</code>, then set the game’s <code>player2</code> property to the instantiated player and call the <code>startGame</code> function (we’ll define that function is just a bit)</li>
<li><code>else</code> log to the console that we’re ignoring a player addition (<code>`Ignoring player ${playerName}...`</code>) and <code>close()</code> the player’s WebSocket connection (more about this in a bit)</li>
</ul>
<blockquote>
<p>Ignoring player additions once a game has been started isn’t ideal, but for now, it’s a stop gap so that we can focus on implementing the game. In the bonus phases for this project, you’ll get a chance to extend the server to support multiple concurrent games.</p>
</blockquote>
<div class="sourceCode" id="cb371"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb371-1" title="1"><span class="kw">const</span> addNewPlayer <span class="op">=</span> (playerName<span class="op">,</span> ws) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb371-2" title="2">  <span class="kw">const</span> player <span class="op">=</span> <span class="kw">new</span> <span class="at">Player</span>(playerName<span class="op">,</span> ws)<span class="op">;</span></a>
<a class="sourceLine" id="cb371-3" title="3"></a>
<a class="sourceLine" id="cb371-4" title="4">  <span class="cf">if</span> (game <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb371-5" title="5">    game <span class="op">=</span> <span class="kw">new</span> <span class="at">Game</span>(player)<span class="op">;</span></a>
<a class="sourceLine" id="cb371-6" title="6">  <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="va">game</span>.<span class="at">player2</span> <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb371-7" title="7">    <span class="va">game</span>.<span class="at">player2</span> <span class="op">=</span> player<span class="op">;</span></a>
<a class="sourceLine" id="cb371-8" title="8">    <span class="at">startGame</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb371-9" title="9">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb371-10" title="10">    <span class="co">// </span><span class="al">TODO</span><span class="co"> Ignore any additional player connections.</span></a>
<a class="sourceLine" id="cb371-11" title="11">    <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Ignoring player </span><span class="sc">${</span>playerName<span class="sc">}</span><span class="vs">...`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb371-12" title="12">    <span class="va">ws</span>.<span class="at">close</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb371-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb371-14" title="14"><span class="op">};</span></a></code></pre></div>
<p>Once the <code>game</code> global variable holds a reference to an instance of the <code>Game</code> class and its <code>player1</code> and <code>player2</code> properties are both set to instances of the <code>Player</code> class, we can use the players’ WebSocket connections to broadcast a message containing the current game state. To do that, define a function named <code>startGame</code> that:</p>
<ul>
<li>Calls the Game <code>getData</code> method to get the data for the current game state;</li>
<li>Sets the <code>data.statusMessage</code> property to a message that prompts the current player to select a square; and</li>
<li>Calls the <code>broadcastMessage</code> function (we’ll define this helper function in just a bit) to send a <code>start-game</code> message to both players.</li>
</ul>
<div class="sourceCode" id="cb372"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb372-1" title="1"><span class="kw">const</span> startGame <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb372-2" title="2">  <span class="kw">const</span> data <span class="op">=</span> <span class="va">game</span>.<span class="at">getData</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb372-3" title="3">  <span class="va">data</span>.<span class="at">statusMessage</span> <span class="op">=</span> <span class="vs">`Select a square </span><span class="sc">${</span><span class="va">game</span>.<span class="va">currentPlayer</span>.<span class="at">playerName</span><span class="sc">}</span><span class="vs">!`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb372-4" title="4">  <span class="at">broadcastMessage</span>(<span class="st">&#39;start-game&#39;</span><span class="op">,</span> data<span class="op">,</span> <span class="va">game</span>.<span class="at">getPlayers</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb372-5" title="5"><span class="op">};</span></a></code></pre></div>
<p>Remember that the structure of the messages that are sent between the client and the server is completely up to us to define. The structure of the <code>start-game</code> message type will look like this (before it’s formatted as JSON):</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb373-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb373-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;start-game&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb373-3" title="3">  <span class="dt">data</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb373-4" title="4">    <span class="dt">player1</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb373-5" title="5">      <span class="dt">playerName</span><span class="op">:</span> <span class="st">&#39;Bob&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb373-6" title="6">    <span class="op">},</span></a>
<a class="sourceLine" id="cb373-7" title="7">    <span class="dt">player2</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb373-8" title="8">      <span class="dt">playerName</span><span class="op">:</span> <span class="st">&#39;Sally&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb373-9" title="9">    <span class="op">},</span></a>
<a class="sourceLine" id="cb373-10" title="10">    <span class="dt">player1Symbol</span><span class="op">:</span> <span class="st">&#39;X&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb373-11" title="11">    <span class="dt">player2Symbol</span><span class="op">:</span> <span class="st">&#39;O&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb373-12" title="12">    <span class="dt">currentPlayer</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb373-13" title="13">      <span class="dt">playerName</span><span class="op">:</span> <span class="st">&#39;Bob&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb373-14" title="14">    <span class="op">},</span></a>
<a class="sourceLine" id="cb373-15" title="15">    <span class="dt">squareValues</span><span class="op">:</span> [<span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb373-16" title="16">    <span class="dt">gameOver</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb373-17" title="17">    <span class="dt">winner</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></a>
<a class="sourceLine" id="cb373-18" title="18">    <span class="dt">statusMessage</span><span class="op">:</span> <span class="st">&#39;Select a square Bob!&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb373-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb373-20" title="20"><span class="op">}</span></a></code></pre></div>
<blockquote>
<p>To see where this data structure is defined, see the Game and Player <code>getData</code> methods. In a bit, we’ll update the React client to use this data to render the UI for the game.</p>
</blockquote>
<p>All that’s left to do on the server (at least for now), is to define the <code>broadcastMessage</code> helper function!</p>
<p>The <code>broadcastMessage</code> function accepts a message <code>type</code>, the message <code>data</code>, and an array of <code>Player</code> class instances. The message <code>type</code> and <code>data</code> are used to create a simple object literal which in turn is formatted as JSON using the <code>JSON.stringify</code> method. To assist with testing and debugging, the message JSON is logged to the console. Then the <code>players</code> array is enumerated using the Array <code>forEach</code> method.</p>
<p>Remember that each <code>Player</code> class instance holds a reference to the player’s WebSocket connection via the <code>ws</code> property. The WebSocket connection object provides a <code>send</code> method that when called, sends a message to the connected client. The first argument passed into the <code>send</code> method is the message to send and the second argument is a callback function that’s called if an error occurs when sending the message. For now, just log any errors to the console.</p>
<p>Your <code>broadcastMessage</code> helper function should look something like this:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb374-1" title="1"><span class="kw">const</span> broadcastMessage <span class="op">=</span> (type<span class="op">,</span> data<span class="op">,</span> players) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb374-2" title="2">  <span class="kw">const</span> message <span class="op">=</span> <span class="va">JSON</span>.<span class="at">stringify</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb374-3" title="3">    type<span class="op">,</span></a>
<a class="sourceLine" id="cb374-4" title="4">    data<span class="op">,</span></a>
<a class="sourceLine" id="cb374-5" title="5">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb374-6" title="6"></a>
<a class="sourceLine" id="cb374-7" title="7">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Broadcasting message </span><span class="sc">${</span>message<span class="sc">}</span><span class="vs">...`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb374-8" title="8"></a>
<a class="sourceLine" id="cb374-9" title="9">  <span class="va">players</span>.<span class="at">forEach</span>((player) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb374-10" title="10">    <span class="va">player</span>.<span class="va">ws</span>.<span class="at">send</span>(message<span class="op">,</span> (err) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb374-11" title="11">      <span class="cf">if</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb374-12" title="12">        <span class="co">// </span><span class="al">TODO</span><span class="co"> Handle errors.</span></a>
<a class="sourceLine" id="cb374-13" title="13">        <span class="va">console</span>.<span class="at">error</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb374-14" title="14">      <span class="op">}</span></a>
<a class="sourceLine" id="cb374-15" title="15">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb374-16" title="16">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb374-17" title="17"><span class="op">};</span></a></code></pre></div>
<h3 id="processing-the-start-game-message-on-the-client">Processing the <code>start-game</code> message on the client</h3>
<p>Before we update the <code>App</code> component to handle the processing of <code>start-game</code> messages received from the server, let’s update the <code>Game</code> component to display a "Waiting for game to start…" message when the <code>Game</code> component initially loads. The first player to provide their player name and connect to the server will see this message while they wait for the second player to provide their player name and connect to the server.</p>
<p>Add another <code>useState</code> Hook to initialize a <code>game</code> state variable to the <code>App</code> component just below the existing <code>useState</code> Hook that initializes the <code>playerName</code> state variable:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb375-1" title="1"><span class="kw">const</span> [game<span class="op">,</span> setGame] <span class="op">=</span> <span class="at">useState</span>(<span class="kw">null</span>)<span class="op">;</span></a></code></pre></div>
<p>Then pass the <code>game</code> state variable into the <code>Game</code> component as a prop:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb376-1" title="1"><span class="op">&lt;</span>Game playerName<span class="op">={</span>playerName<span class="op">}</span> game<span class="op">={</span>game<span class="op">}</span> /&gt;</a></code></pre></div>
<p>Update the <code>Game</code> component to destructure the <code>playerName</code> and <code>game</code> props. Then have your component use a ternary statement to check the truthiness of the <code>game</code> prop to conditionally display the following "Waiting for game to start…" message (instead of the game board) if the <code>game</code> prop is falsy:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb377-1" title="1"><span class="op">&lt;</span>h3 className<span class="op">={</span><span class="va">styles</span>.<span class="at">announcement</span><span class="op">}&gt;</span>Waiting <span class="cf">for</span> game to <span class="va">start</span>...&lt;/h3<span class="op">&gt;</span></a></code></pre></div>
<p>Now let’s update the <code>App</code> component to process the <code>start-game</code> message from the server! Update the WebSocket <code>onmessage</code> event listener function to:</p>
<ul>
<li>Log the <code>e.data</code> property to the console;</li>
<li>Call the <code>JSON.parse</code> method to parse the JSON formatted message data; and</li>
<li>Switch on the <code>message.type</code> property to handle the <code>start-game</code> message type.</li>
</ul>
<div class="sourceCode" id="cb378"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb378-1" title="1"><span class="va">ws</span>.<span class="at">onmessage</span> <span class="op">=</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb378-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Processing incoming message </span><span class="sc">${</span><span class="va">e</span>.<span class="at">data</span><span class="sc">}</span><span class="vs">...`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb378-3" title="3"></a>
<a class="sourceLine" id="cb378-4" title="4">  <span class="kw">const</span> message <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(<span class="va">e</span>.<span class="at">data</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb378-5" title="5"></a>
<a class="sourceLine" id="cb378-6" title="6">  <span class="cf">switch</span> (<span class="va">message</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb378-7" title="7">    <span class="cf">case</span> <span class="st">&#39;start-game&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb378-8" title="8">      <span class="at">setGame</span>(<span class="va">message</span>.<span class="at">data</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb378-9" title="9">      <span class="cf">break</span><span class="op">;</span></a>
<a class="sourceLine" id="cb378-10" title="10">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb378-11" title="11">      <span class="cf">throw</span> <span class="kw">new</span> <span class="at">Error</span>(<span class="vs">`Unknown message type: </span><span class="sc">${</span><span class="va">message</span>.<span class="at">type</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb378-12" title="12">  <span class="op">}</span></a>
<a class="sourceLine" id="cb378-13" title="13"><span class="op">};</span></a></code></pre></div>
<p>To process the <code>start-game</code> message and update the <code>game</code> state variable, we just need to call the <code>setGame</code> method passing in the <code>message.data</code> property. Updating the <code>game</code> state variable will cause React to re-render the <code>Game</code> component.</p>
<h3 id="updating-the-game-component-to-render-the-game-state">Updating the <code>Game</code> component to render the game state</h3>
<p>To render the game state, update the <code>Game</code> component’s JSX to use the following game state properties:</p>
<ul>
<li>The <code>game.player1Symbol</code>, <code>game.player2Symbol</code>, <code>game.player1.playerName</code>, and <code>game.player2.playerName</code> properties can be used to display the player information above the game board (replace the <code>Player X: ...</code> and <code>Player O: ...</code> TODO notes).</li>
<li>The <code>&lt;h3&gt;</code> element with a <code>className</code> referencing <code>styles.announcement</code> can be updated to display the <code>game.statusMessage</code> property as content. The <code>game.statusMessage</code> property will be used going forward to communicate to the players the current status of the game.</li>
<li>The <code>game.squareValues</code> array can be used to set a <code>value</code> prop on each <code>Square</code> subcomponent to render either an "X" or "O" when appropriate:</li>
</ul>
<div class="sourceCode" id="cb379"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb379-1" title="1"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">0</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">0</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">1</span><span class="op">}</span> col<span class="op">={</span><span class="dv">1</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb379-2" title="2"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">1</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">1</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">1</span><span class="op">}</span> col<span class="op">={</span><span class="dv">2</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb379-3" title="3"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">2</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">2</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">1</span><span class="op">}</span> col<span class="op">={</span><span class="dv">3</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb379-4" title="4"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">3</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">3</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">2</span><span class="op">}</span> col<span class="op">={</span><span class="dv">1</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb379-5" title="5"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">4</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">4</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">2</span><span class="op">}</span> col<span class="op">={</span><span class="dv">2</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb379-6" title="6"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">5</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">5</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">2</span><span class="op">}</span> col<span class="op">={</span><span class="dv">3</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb379-7" title="7"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">6</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">6</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">3</span><span class="op">}</span> col<span class="op">={</span><span class="dv">1</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb379-8" title="8"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">7</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">7</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">3</span><span class="op">}</span> col<span class="op">={</span><span class="dv">2</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb379-9" title="9"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">8</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">8</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">3</span><span class="op">}</span> col<span class="op">={</span><span class="dv">3</span><span class="op">}</span> /&gt;</a></code></pre></div>
<p>To render the "X" and "O"s in the game board squares, download the following SVG files:</p>
<ul>
<li><a href="https://-open-assets.s3-us-west-1.amazonaws.com/Modular-Curriculum/content/react-redux/topics/websockets/assets/playerX.svg">playerX.svg</a></li>
<li><a href="https://-open-assets.s3-us-west-1.amazonaws.com/Modular-Curriculum/content/react-redux/topics/websockets/assets/playerO.svg">playerO.svg</a></li>
</ul>
<p>Then add a new folder named <code>assets</code> to the <code>src</code> folder and copy the SVG files into new folder.</p>
<p>Back in the <code>Game</code> module, import the SVG files at the top of the module:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb380-1" title="1"><span class="im">import</span> playerX <span class="im">from</span> <span class="st">&#39;../assets/playerX.svg&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb380-2" title="2"><span class="im">import</span> playerO <span class="im">from</span> <span class="st">&#39;../assets/playerO.svg&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Just above the definition for the <code>Square</code> subcomponent, define a <code>SquareImage</code> subcomponent that’ll render a square’s image using an <code>&lt;img&gt;</code> element:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb381-1" title="1"><span class="kw">const</span> SquareImage <span class="op">=</span> (<span class="op">{</span> value <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb381-2" title="2">  <span class="cf">if</span> (value <span class="op">===</span> <span class="st">&#39;&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb381-3" title="3">    <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb381-4" title="4">  <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (value <span class="op">===</span> <span class="st">&#39;X&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb381-5" title="5">    <span class="cf">return</span> <span class="op">&lt;</span>img src<span class="op">={</span>playerX<span class="op">}</span> alt<span class="op">=</span><span class="st">&#39;X&#39;</span> /&gt;</a>
<a class="sourceLine" id="cb381-6" title="6">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb381-7" title="7">    <span class="cf">return</span> <span class="op">&lt;</span>img src<span class="op">={</span>playerO<span class="op">}</span> alt<span class="op">=</span><span class="st">&#39;O&#39;</span> /&gt;</a>
<a class="sourceLine" id="cb381-8" title="8">  <span class="op">}</span></a>
<a class="sourceLine" id="cb381-9" title="9"><span class="op">};</span></a></code></pre></div>
<blockquote>
<p>Notice that we can simply set the <code>&lt;img&gt;</code> element’s <code>src</code> attribute to the imported <code>playerX</code> or <code>playerO</code> SVG files. This is possible because of the front-end build process provided by Create React App. Create React App configures webpack with support for loading images (as well as CSS, fonts, and other file types) which allows you to add an image file to your project, import it directly into a module, and render it in a React component.</p>
</blockquote>
<p>Now we can update the <code>Square</code> subcomponent. Add a <code>value</code> prop and render the <code>SquareImage</code> component inside of the <code>&lt;div&gt;</code> element:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb382-1" title="1"><span class="kw">const</span> Square <span class="op">=</span> (<span class="op">{</span> squareIndex<span class="op">,</span> value<span class="op">,</span> row<span class="op">,</span> col <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb382-2" title="2">  <span class="kw">const</span> rowStyleName <span class="op">=</span> <span class="vs">`row_</span><span class="sc">${</span>row<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb382-3" title="3">  <span class="kw">const</span> colStyleName <span class="op">=</span> <span class="vs">`col_</span><span class="sc">${</span>col<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb382-4" title="4"></a>
<a class="sourceLine" id="cb382-5" title="5">  <span class="kw">const</span> handleClick <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb382-6" title="6">    <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Clicked on square index: </span><span class="sc">${</span>squareIndex<span class="sc">}</span><span class="vs">...`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb382-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb382-8" title="8"></a>
<a class="sourceLine" id="cb382-9" title="9">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb382-10" title="10">    <span class="op">&lt;</span>div</a>
<a class="sourceLine" id="cb382-11" title="11">      onClick<span class="op">={</span>handleClick<span class="op">}</span></a>
<a class="sourceLine" id="cb382-12" title="12">      className<span class="op">={</span><span class="vs">`</span><span class="sc">${</span><span class="va">styles</span>.<span class="at">square</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>styles[rowStyleName]<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>styles[colStyleName]<span class="sc">}</span><span class="vs">`</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb382-13" title="13">        <span class="op">&lt;</span>SquareImage value<span class="op">={</span>value<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb382-14" title="14">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb382-15" title="15">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb382-16" title="16"><span class="op">};</span></a></code></pre></div>
<h3 id="handling-closed-connections">Handling closed connections</h3>
<p>Before we test our latest changes, let’s handle closed connections on both the server and the client. If we don’t handle closed connections, it’d be very easy for the state to get out of sync between the server and the client.</p>
<p>On the client, handling closed connections is relatively straightforward. Update the <code>onclose</code> event listener function to log a message that the connection closed, reset the <code>webSocket</code> ref object, and reset the <code>playerName</code> and <code>game</code> state variables:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb383-1" title="1"><span class="va">ws</span>.<span class="at">onclose</span> <span class="op">=</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb383-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Connection closed: </span><span class="sc">${</span>e<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb383-3" title="3">  <span class="va">webSocket</span>.<span class="at">current</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb383-4" title="4">  <span class="at">setPlayerName</span>(<span class="st">&#39;&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb383-5" title="5">  <span class="at">setGame</span>(<span class="kw">null</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb383-6" title="6"><span class="op">};</span></a></code></pre></div>
<blockquote>
<p>Resetting the ref object and state variables will return the user back to the initial application state which results in the player being prompted again for their player name. This is essentially throwing up our hands and declaring "images/oh no… something went wrong… let’s try that again". Not ideal, but for now, it’ll allow us to keep our focus on finishing the initial implementation of the game.</p>
</blockquote>
<p>On the server, update the WebSocket <code>close</code> event handler callback function to this:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb384-1" title="1"><span class="va">ws</span>.<span class="at">on</span>(<span class="st">&#39;close&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb384-2" title="2">  <span class="co">// If there&#39;s a game available...</span></a>
<a class="sourceLine" id="cb384-3" title="3">  <span class="cf">if</span> (game <span class="op">!==</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb384-4" title="4">    <span class="kw">const</span> <span class="op">{</span> player1<span class="op">,</span> player2 <span class="op">}</span> <span class="op">=</span> game<span class="op">;</span></a>
<a class="sourceLine" id="cb384-5" title="5"></a>
<a class="sourceLine" id="cb384-6" title="6">    <span class="co">// If the closed WS belonged to either player 1 or player 2</span></a>
<a class="sourceLine" id="cb384-7" title="7">    <span class="co">// then we need to abort the game.</span></a>
<a class="sourceLine" id="cb384-8" title="8">    <span class="cf">if</span> (<span class="va">player1</span>.<span class="at">ws</span> <span class="op">===</span> ws <span class="op">||</span> (player2 <span class="op">!==</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> <span class="va">player2</span>.<span class="at">ws</span> <span class="op">===</span> ws)) <span class="op">{</span></a>
<a class="sourceLine" id="cb384-9" title="9">      <span class="co">// If the closed WS doesn&#39;t belong to player 1</span></a>
<a class="sourceLine" id="cb384-10" title="10">      <span class="co">// then close their WS, otherwise if there&#39;s a</span></a>
<a class="sourceLine" id="cb384-11" title="11">      <span class="co">// player 2 then close their WS.</span></a>
<a class="sourceLine" id="cb384-12" title="12">      <span class="cf">if</span> (<span class="va">player1</span>.<span class="at">ws</span> <span class="op">!==</span> ws) <span class="op">{</span></a>
<a class="sourceLine" id="cb384-13" title="13">        <span class="va">player1</span>.<span class="va">ws</span>.<span class="at">close</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb384-14" title="14">      <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (player2 <span class="op">!==</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb384-15" title="15">        <span class="va">player2</span>.<span class="va">ws</span>.<span class="at">close</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb384-16" title="16">      <span class="op">}</span></a>
<a class="sourceLine" id="cb384-17" title="17">      game <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb384-18" title="18">    <span class="op">}</span></a>
<a class="sourceLine" id="cb384-19" title="19">  <span class="op">}</span></a>
<a class="sourceLine" id="cb384-20" title="20"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Handling closed connections on the server is a little trickier than it is on the client. On the server we need to determine if there’s an active game, and if there is we need to check if the closed connection belonged to either player 1 or player 2 (if player 2 is available).</p>
<h3 id="testing-2">Testing</h3>
<p>To test the changes to the server and the client, start both the server and the client. Then, in the browser, provide a player name for the first player. You should see the message "Waiting for game to start…" displayed in the browser.</p>
<p>In the terminal window where you started the server, you should see the following message:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb385-1" title="1"><span class="ex">Processing</span> incoming message {<span class="st">&quot;type&quot;</span>:<span class="st">&quot;add-new-player&quot;</span>,<span class="st">&quot;data&quot;</span>:{<span class="st">&quot;playerName&quot;</span>:<span class="st">&quot;[the player 1 name you entered]&quot;</span>}}<span class="ex">...</span></a></code></pre></div>
<p>Now open a second browser tab and browse to <code>http://localhost:3000</code> and enter a player name for the second player. This time, you should see the game board displayed in the browser.</p>
<figure>
<img src="https://-open-assets.s3-us-west-1.amazonaws.com/Modular-Curriculum/content/react-redux/topics/websockets/assets/websockets-start-game-tic-tac-toe-game-board.png" alt="websockets-start-game-tic-tac-toe-game-board" /><figcaption>websockets-start-game-tic-tac-toe-game-board</figcaption>
</figure>
<p>In the server terminal window, you should see the following messages:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb386-1" title="1"><span class="ex">Processing</span> incoming message {<span class="st">&quot;type&quot;</span>:<span class="st">&quot;add-new-player&quot;</span>,<span class="st">&quot;data&quot;</span>:{<span class="st">&quot;playerName&quot;</span>:<span class="st">&quot;[the player 2 name you entered]&quot;</span>}}<span class="ex">...</span></a>
<a class="sourceLine" id="cb386-2" title="2"><span class="ex">Broadcasting</span> message {<span class="st">&quot;type&quot;</span>:<span class="st">&quot;start-game&quot;</span>,<span class="st">&quot;data&quot;</span>:{<span class="st">&quot;player1&quot;</span>:{<span class="st">&quot;playerName&quot;</span>:<span class="st">&quot;[player 1 name]&quot;</span>},<span class="st">&quot;player2&quot;</span>:{<span class="st">&quot;playerName&quot;</span>:<span class="st">&quot;[player 2 name]]&quot;</span>},<span class="st">&quot;player1Symbol&quot;</span>:<span class="st">&quot;X&quot;</span>,<span class="st">&quot;player2Symbol&quot;</span>:<span class="st">&quot;O&quot;</span>,<span class="st">&quot;currentPlayer&quot;</span>:{<span class="st">&quot;playerName&quot;</span>:<span class="st">&quot;[player 1 name]&quot;</span>},<span class="st">&quot;squareValues&quot;</span>:[<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>],<span class="st">&quot;gameOver&quot;</span>:<span class="ex">false</span>,<span class="st">&quot;winner&quot;</span>:null,<span class="st">&quot;statusMessage&quot;</span>:<span class="st">&quot;Select a square [player 1 name]!&quot;</span>}}<span class="ex">...</span></a></code></pre></div>
<h2 id="phase-7-supporting-player-turns">Phase 7: Supporting player turns</h2>
<p>With the game started, we can turn our attention towards supporting player turns, so that they can select squares on the game board! Clicking a game board square will result in three things happening:</p>
<ul>
<li>The client will handle the game board square click in the <code>Game</code> component and send a <code>select-game-square</code> message to the server;</li>
<li>The server will receive and process the <code>select-game-square</code> message, check the status of the game to see if the game has ended, and send an <code>update-game</code> or <code>end-game</code> message back to the client; and</li>
<li>The client will receive the <code>update-game</code> or <code>end-game</code> message and re-render the <code>Game</code> component with the new game state.</li>
</ul>
<blockquote>
<p>Now that the general WebSocket plumbing is in place to support the two-way communication between the server and client, the remaining phases in this project will let you apply what you’ve learned with less guidance.</p>
</blockquote>
<h3 id="updating-the-client-to-handle-game-board-square-clicks">Updating the client to handle game board square clicks</h3>
<p>Add an additional prop named <code>selectGameSquare</code> to the <code>Game</code> component (we’ll set this prop from within the <code>App</code> component in just a bit):</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb387-1" title="1"><span class="kw">const</span> Game <span class="op">=</span> (<span class="op">{</span> playerName<span class="op">,</span> game<span class="op">,</span> selectGameSquare <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb387-2" title="2">  <span class="co">// Code removed for brevity.</span></a>
<a class="sourceLine" id="cb387-3" title="3"><span class="op">}</span></a></code></pre></div>
<p>To handle game board square clicks, define a function within the <code>Game</code> component named <code>selectSquare</code> that:</p>
<ul>
<li>Accepts a <code>squareIndex</code> parameter;</li>
<li>Immediately returns if the game is over or if the player is not the current player (see the <code>game.gameOver</code> and <code>game.currentPlayer.playerName</code> properties); and</li>
<li>Calls the <code>selectGameSquare</code> prop and passing in the <code>squareIndex</code> parameter.</li>
</ul>
<p>In the <code>Game</code> components JSX, pass the <code>selectSquare</code> function into each of the <code>&lt;Square&gt;</code> components using a prop of the same name:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb388-1" title="1"><span class="op">&lt;</span>Square squareIndex<span class="op">={</span><span class="dv">0</span><span class="op">}</span> value<span class="op">={</span><span class="va">game</span>.<span class="at">squareValues</span>[<span class="dv">0</span>]<span class="op">}</span> row<span class="op">={</span><span class="dv">1</span><span class="op">}</span> col<span class="op">={</span><span class="dv">1</span><span class="op">}</span> selectSquare<span class="op">={</span>selectSquare<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb388-2" title="2"><span class="op">{</span><span class="co">/* Other components removed for brevity. */</span><span class="op">}</span></a></code></pre></div>
<p>In the <code>Square</code> subcomponent, update the prop destructuring to get a reference to the <code>selectSquare</code> prop. Then call the <code>selectSquare</code> prop from within the <code>handleClick</code> event handler function passing in the <code>squareIndex</code> prop value.</p>
<p>In the <code>App</code> component, we need to handle the square selection and send a <code>select-game-square</code> message to the server. Start by defining a function named <code>selectGameSquare</code> that accepts a <code>squareIndex</code> parameter and sends a <code>select-game-square</code> message to the server that looks like this (before its converted to JSON):</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb389-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb389-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;select-game-square&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb389-3" title="3">  <span class="dt">data</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb389-4" title="4">    <span class="dt">squareIndex</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb389-5" title="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb389-6" title="6"><span class="op">}</span></a></code></pre></div>
<p>To see an example of how to send a message to the server, look for where the <code>ws.send</code> method is being called. To help make it a bit easier to send messages to the server (and to keep our code DRY), define a helper function named <code>sendMessage</code> within the effect that creates the WebSocket object. Add a property to the object literal that’s assigned to the <code>webSocket</code> ref object’s <code>current</code> property so that you can call it from elsewhere in the component (i.e. <code>webSocket.current.sendMessage('select-game-square', { squareIndex })</code>):</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb390-1" title="1"><span class="kw">const</span> sendMessage <span class="op">=</span> (type<span class="op">,</span> data) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb390-2" title="2">  <span class="co">// </span><span class="al">TODO</span><span class="co"> Create and send the message to the server.</span></a>
<a class="sourceLine" id="cb390-3" title="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb390-4" title="4"></a>
<a class="sourceLine" id="cb390-5" title="5"><span class="va">webSocket</span>.<span class="at">current</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb390-6" title="6">  ws<span class="op">,</span></a>
<a class="sourceLine" id="cb390-7" title="7">  sendMessage<span class="op">,</span></a>
<a class="sourceLine" id="cb390-8" title="8"><span class="op">};</span></a></code></pre></div>
<p>The <code>sendMessage</code> function should accept <code>type</code> and <code>data</code> parameters and combine them into an object literal to create our self-imposed WebSocket message structure:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb391-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb391-2" title="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;the-message-type&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb391-3" title="3">  <span class="dt">data</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb391-4" title="4">    <span class="co">// One or more properties for the message data.</span></a>
<a class="sourceLine" id="cb391-5" title="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb391-6" title="6"><span class="op">}</span></a></code></pre></div>
<p>Use the <code>JSON.stringify</code> method to convert the message to JSON, then log the message to the console (to assist with testing and debugging), and passing the JSON message into a call to the <code>ws.send</code> method. Now update the <code>onopen</code> event listener function to make use of the <code>sendMessage</code> function:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb392-1" title="1"><span class="va">ws</span>.<span class="at">onopen</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb392-2" title="2">  <span class="at">sendMessage</span>(<span class="st">&#39;add-new-player&#39;</span><span class="op">,</span> <span class="op">{</span> playerName <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb392-3" title="3"><span class="op">};</span></a></code></pre></div>
<blockquote>
<p>Be careful passing the argument for the <code>sendMessage</code> <code>data</code> parameter. Think about the shape of the <code>data</code> property for each message type. If you get the message structure wrong, the server will start to throw errors when receiving messages from the client, so keep an eye out for that.</p>
</blockquote>
<p>To wrap up this part of the updates, add a <code>selectGameSquare</code> prop on the <code>Game</code> component and set it to a reference to the <code>selectGameSquare</code> function:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb393-1" title="1"><span class="op">&lt;</span>Game playerName<span class="op">={</span>playerName<span class="op">}</span> game<span class="op">={</span>game<span class="op">}</span> selectGameSquare<span class="op">={</span>selectGameSquare<span class="op">}</span> /&gt;</a></code></pre></div>
<h3 id="testing-the-changes-so-far">Testing the changes so far</h3>
<p>Start the client and the server and open an additional browser tab so that you can enter two player names. In the player 1 browser tab, click a game board square. In the browser developer tools console you should see output confirmation that a message was sent to the server:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb394-1" title="1"><span class="ex">Sending</span> message <span class="dt">{&quot;type&quot;:&quot;select-game-square&quot;,&quot;data&quot;:{&quot;squareIndex&quot;:0}}</span>...</a></code></pre></div>
<p>In the server terminal window you should see that an "unknown message type" error has occurred:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb395-1" title="1"><span class="ex">Processing</span> incoming message <span class="dt">{&quot;type&quot;:&quot;select-game-square&quot;,&quot;data&quot;:{&quot;squareIndex&quot;:0}}</span>...</a>
<a class="sourceLine" id="cb395-2" title="2">[<span class="ex">path</span> to top-level project folder]/solution/server/app.js:75</a>
<a class="sourceLine" id="cb395-3" title="3">      <span class="ex">throw</span> new Error(<span class="kw">`</span><span class="ex">Unknown</span> message type: <span class="va">${message</span><span class="er">.type</span><span class="va">}</span><span class="kw">`</span>);</a>
<a class="sourceLine" id="cb395-4" title="4">      ^</a>
<a class="sourceLine" id="cb395-5" title="5"></a>
<a class="sourceLine" id="cb395-6" title="6"><span class="ex">Error</span>: Unknown message type: select-game-square</a>
<a class="sourceLine" id="cb395-7" title="7">    <span class="ex">at</span> processIncomingMessage ([path to top-level project folder]/solution/server/app.js:75:13)</a>
<a class="sourceLine" id="cb395-8" title="8">    <span class="ex">at</span> WebSocket.<span class="op">&lt;</span>anonymous<span class="op">&gt;</span> ([path to top-level project folder]/solution/server/app.js:81:5)</a>
<a class="sourceLine" id="cb395-9" title="9">    <span class="ex">at</span> WebSocket.emit (events.js:305:20)</a>
<a class="sourceLine" id="cb395-10" title="10">    <span class="ex">at</span> Receiver.receiverOnMessage ([path to top-level project folder]/solution/server/node_modules/ws/lib/websocket.js:800:20)</a>
<a class="sourceLine" id="cb395-11" title="11">    <span class="ex">at</span> Receiver.emit (events.js:305:20)</a>
<a class="sourceLine" id="cb395-12" title="12">    <span class="ex">at</span> Receiver.dataMessage ([path to top-level project folder]/solution/server/node_modules/ws/lib/receiver.js:436:14)</a>
<a class="sourceLine" id="cb395-13" title="13">    <span class="ex">at</span> Receiver.getData ([path to top-level project folder]/solution/server/node_modules/ws/lib/receiver.js:366:17)</a>
<a class="sourceLine" id="cb395-14" title="14">    <span class="ex">at</span> Receiver.startLoop ([path to top-level project folder]/solution/server/node_modules/ws/lib/receiver.js:142:22)</a>
<a class="sourceLine" id="cb395-15" title="15">    <span class="ex">at</span> Receiver._write ([path to top-level project folder]/solution/server/node_modules/ws/lib/receiver.js:77:10)</a>
<a class="sourceLine" id="cb395-16" title="16">    <span class="ex">at</span> doWrite (_stream_writable.js:464:12)</a></code></pre></div>
<p>Stop and restart the server and enter your player names again. In the player 2 browser tab, make sure that when you click a game board square a message isn’t sent to the server. To confirm that a message wasn’t sent, you shouldn’t see any output in the browser developer tools console and you shouldn’t see any errors in the server terminal window.</p>
<h3 id="updating-the-server-to-process-select-game-square-messages">Updating the server to process <code>select-game-square</code> messages</h3>
<p>As the server error indicated while testing, we need to update the server so that it can process <code>select-game-square</code> messages.</p>
<p>To start, update the <code>processIncomingMessage</code> function by adding a <code>case</code> statement to the <code>message.type</code> switch statement so that it can handle <code>select-game-square</code> values. Within that <code>case</code> statement, call the <code>selectGameSquare</code> function passing in the <code>message.data.squareIndex</code> property and the enclosing function’s <code>ws</code> parameter.</p>
<p>Next, define three new functions: <code>endGame</code> (not a reference to the Avengers movie), <code>updateGame</code>, and <code>selectGameSquare</code>:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb396-1" title="1"><span class="kw">const</span> endGame <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb396-2" title="2">  <span class="co">// </span><span class="al">TODO</span></a>
<a class="sourceLine" id="cb396-3" title="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb396-4" title="4"></a>
<a class="sourceLine" id="cb396-5" title="5"><span class="kw">const</span> updateGame <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb396-6" title="6">  <span class="co">// </span><span class="al">TODO</span></a>
<a class="sourceLine" id="cb396-7" title="7"><span class="op">};</span></a>
<a class="sourceLine" id="cb396-8" title="8"></a>
<a class="sourceLine" id="cb396-9" title="9"><span class="kw">const</span> selectGameSquare <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb396-10" title="10"><span class="op">};</span></a></code></pre></div>
<p>We’ll implement the <code>endGame</code> and <code>updateGame</code> functions in a bit, so for now, just add <code>TODO</code> comments in their function bodies as a reminder.</p>
<p>For the <code>selectGameSquare</code> function implementation:</p>
<ul>
<li>Define two parameters, <code>squareIndex</code> and <code>ws</code>;</li>
<li>Call the <code>game.getPlayers</code> method to get the players for the game and use the <code>ws</code> parameter to determine which player is selecting the square (<em>hint:</em> remember that the <code>Player</code> class contains a property that holds a reference to the player’s WebSocket connection);</li>
<li>After determining the player that’s taking a turn (i.e. selecting a square), call a new method on the <code>game</code> object, <code>selectSquare</code>, passing in the player and the <code>squareIndex</code> parameter;</li>
<li>After selecting the square, call another new method on the <code>game</code> object, <code>checkGameStatus</code>, to determine if the game has ended (either as a win for a player or in a draw);</li>
<li>If the game has ended, call the <code>endGame</code> method and set the <code>game</code> variable to <code>null</code> (setting the <code>game</code> variable to <code>null</code> allows a new game to be started); and</li>
<li>If the game hasn’t ended, call the <code>updateGame</code> method.</li>
</ul>
<p>In the <code>Game</code> class (located in the <code>game-state</code> module), we have two new methods to implement: <code>selectSquare</code> and <code>checkGameStatus</code>.</p>
<p>For the <code>selectSquare</code> method implementation:</p>
<ul>
<li>Define two parameters, <code>player</code> and <code>squareIndex</code>;</li>
<li>As a bit of defensive coding, immediately return from the function if the selected square index value (i.e. <code>this.squareValues[squareIndex]</code>) is not an empty string (i.e. <code>''</code> or <code>""</code>);</li>
<li>Using the <code>this.player1</code> and <code>this.player2</code> properties, determine if the <code>player</code> parameter represents player "1" or player "2", then set the selected square index to that player’s symbol using either the <code>this.player1Symbol</code> or <code>this.player2Symbol</code> property; and</li>
<li>Now that the selected square index has been set the current player’s symbol, it’s time to end the current player’s turn by updating the <code>this.currentPlayer</code> property to reference the other player.</li>
</ul>
<p>For the <code>checkGameStatus</code> method implementation:</p>
<ul>
<li>Use the <code>this.squareValues</code> property, which is an array of the game board’s square values, to determine if either player has won the game (be sure to check each row, column, diagonal) or if the game has ended in a draw;
<ul>
<li>There are <em>many</em> ways to iterate over the array of square values to determine if a player has won the game;</li>
<li>Remember that you built a tic-tac-toe game in an earlier project, so feel free to reference that project for a solution to this coding problem;</li>
</ul></li>
<li>If the game is over (either in a win or draw), set the <code>this.gameOver</code> property to <code>true</code>;</li>
<li>Set the <code>this.winner</code> property to the player that won the game (if the game ended in a draw, leave the property set to <code>null</code>); and</li>
<li>Optionally return the <code>this.gameOver</code> property value from the function so that it can be called from within a conditional statement expression.</li>
</ul>
<p>Back in the <code>app</code> module, we can turn our attention back to implementing the <code>endGame</code> and <code>updateGame</code> functions.</p>
<p>For the <code>endGame</code> function implementation:</p>
<ul>
<li>Call the <code>game.getPlayers</code> method to get an array of the players;</li>
<li>Call the <code>game.getData</code> method to get the game state data;</li>
<li>Set the <code>data.statusMessage</code> property to an appropriate message to indicate the end of the game (e.g. "Winner: [player name]" or "Winner: Draw!");
<ul>
<li>Consider adding a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/get">class getter function</a> named <code>gameOverMessage</code> to the <code>Game</code> class that returns a string for the <code>data.statusMessage</code>; and</li>
</ul></li>
<li>Send an <code>end-game</code> message to each of the players by calling the <code>broadcastMessage</code> function passing in the string literal <code>'end-game'</code>, the data returned by the <code>game.getData</code> method, and the array of players returned by the <code>game.getPlayers</code> method.</li>
</ul>
<p>For the <code>updateGame</code> function implementation:</p>
<ul>
<li>Call the <code>game.getPlayers</code> method to get an array of the players;</li>
<li>Call the <code>game.getData</code> method to get the game state data;</li>
<li>Set the <code>data.statusMessage</code> property to an appropriate message to prompt the next player to take their turn (i.e. "Select a square [current player name]!"); and</li>
<li>Send an <code>update-game</code> message to each of the players by calling the <code>broadcastMessage</code> function passing in the string literal <code>'update-game'</code>, the data returned by the <code>game.getData</code> method, and the array of players returned by the <code>game.getPlayers</code> method.</li>
</ul>
<p>That’s a lot of coding! Pat yourself on the back; you just completed the server part of the project!</p>
<h3 id="updating-the-client-to-process-update-game-and-end-game-messages">Updating the client to process <code>update-game</code> and <code>end-game</code> messages</h3>
<p>Now it’s time to complete the client part of the project by updating it to process <code>update-game</code> and <code>end-game</code> messages.</p>
<p>In the <code>App</code> component’s effect function that creates the WebSocket object, update the <code>onmessage</code> event listener function to process <code>update-game</code> and <code>end-game</code> message types by updating the <code>game</code> state variable. To do this, call the <code>setGame</code> function and pass in the <code>message.data</code> property.</p>
<p>Updating the <code>game</code> state variable will cause the <code>Game</code> component to re-render. When it does, we need to display two buttons within the <code>Game</code> if the game has ended (i.e. the <code>game.gameOver</code> property is set to <code>true</code>):</p>
<ul>
<li>A "Play Again" button that when clicked allows the user to play another game;
<ul>
<li>To play another game, set the <code>game</code> state variable in the <code>App</code> component to <code>null</code> and call the <code>sendMessage</code> function to send an <code>add-new-player</code> message (be sure to pass the player’s name for the message’s data); and</li>
</ul></li>
<li>A "Quit" button that when clicked resets all of the local state in the client;
<ul>
<li>A convenient way to reset all of the local state is to set the <code>playerName</code> state variable to an empty string (i.e. <code>''</code> or <code>""</code>). Doing this results in the effect’s <code>cleanup</code> function being called which will close the WebSocket connection.</li>
</ul></li>
</ul>
<p>For the layout of the buttons, render the following JSX below the game board:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb397-1" title="1"><span class="op">{</span> <span class="va">game</span>.<span class="at">gameOver</span> <span class="op">&amp;&amp;</span> (</a>
<a class="sourceLine" id="cb397-2" title="2">  <span class="op">&lt;</span>div className<span class="op">={</span><span class="va">styles</span>.<span class="at">actions</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb397-3" title="3">    <span class="op">&lt;</span>button onClick<span class="op">={</span>playAgainClick<span class="op">}&gt;</span>Play Again&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb397-4" title="4">    <span class="op">&lt;</span>div className<span class="op">={</span><span class="va">styles</span>.<span class="at">spacer</span><span class="op">}&gt;</span>&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb397-5" title="5">    <span class="op">&lt;</span>button onClick<span class="op">={</span>quit<span class="op">}&gt;</span>Quit&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb397-6" title="6">  &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb397-7" title="7">)<span class="op">}</span></a></code></pre></div>
<h3 id="testing-3">Testing</h3>
<p>Everything is in place now to play a complete game of tic-tac-toe! Start the client and the server and run through (at a minimum) the following testing scenarios:</p>
<ul>
<li>Test that player 1 can win a game;</li>
<li>Test that player 2 can win a game;</li>
<li>Test that completing any row, column, or diagonal wins the game;</li>
<li>Test that a game can be played to a draw;</li>
<li>Test that you can choose to play again at the conclusion of a game; and</li>
<li>Test that you can quit at the conclusion of a game.</li>
</ul>
<p>Excellent job using WebSockets to create an online version of tic-tac-toe!</p>
<h2 id="bonus-phases">Bonus Phases</h2>
<p>Now that you’ve built a <em>basic</em> version of the tic-tac-toe game, there are a lot of ways that you could extend this application.</p>
<h3 id="adding-redux-or-context">Adding Redux or Context</h3>
<p>The state needs for the React application were relatively simple, so we didn’t use Redux or Context. But that doesn’t mean that you can’t still add either one for additional practice.</p>
<h3 id="support-multiple-concurrent-games">Support multiple concurrent games</h3>
<p>After two players have connected to the server and a game is started, all subsequent WebSocket connections are ignored (i.e. closed immediately after they’re opened). Ideally, you’d continue to add new games as players are connected to the server. To do this, you’ll need a way to track multiple game instances on the server and to cleanup those instances when a game has been completed.</p>
<h3 id="player-name-validation">Player name validation</h3>
<p>Currently, when adding a new player, the player name isn’t validated to ensure that it’s unique. Ideally, when a user submits a player name that’s already being used in an active game, the server would return a message to indicate to the client that the supplied player name is already in use so the user could provide a different player name.</p>
<h3 id="connection-health-checks">Connection health checks</h3>
<p>In production, servers can be aggressive about closing inactive WebSocket connections. In some environments, WebSocket connections might be closed after only 60 seconds of inactivity. To keep connections alive, you can add ping/pong health checks to the WebSocket server.</p>
<p>The WebSockets protocol supports the idea of a server sending a "ping" message to a client, and if the client is still connected, it’ll send a "pong" message back to the server. For details on how to do this with the <code>ws</code> npm package, see <a href="https://www.npmjs.com/package/ws#how-to-detect-and-close-broken-connections">this example in the official documentation</a>.</p>
<blockquote>
<p>Technically speaking, there’s no reason why a client couldn’t also send "ping" messages to the server (instead of waiting for the server to send a "ping") but the browser’s WebSocket API doesn’t currently support sending "ping" messages.</p>
</blockquote>
<h3 id="adding-a-player-lobby">Adding a player lobby</h3>
<p>Instead of immediately associating new players with games, you could place them into a player "lobby". If the server arbitrarily limited the number of active games to a small number of games (1-3), the server could add the first two players in line to a game upon the conclusion of one of the active games. Alternatively, you could allow players in the lobby to challenge another player in the lobby. There are lots of ways to implement a lobby… have fun with it!</p>
<h3 id="adding-database-persistence">Adding database persistence</h3>
<p>Instead of keeping player and game state in memory on the server, you could persist both to a PostgreSQL database. This would allow the server to be restarted without losing all of the data. You could also implement win/loss/draw history for each player.</p>
<h3 id="deploying-to-production">Deploying to production</h3>
<p>Deploying applications into a new environment can often be challenging. As with most things in life, practice helps, so deploy your Tic-Tac-Toe Online game into a cloud platform like <a href="https://www.heroku.com/">Heroku</a>.</p>
<hr />
<h1 id="react-solo-project-expectations">React Solo Project Expectations</h1>
<p>Next week, you get a full week to write a compelling front-end application to go into your portfolio.</p>
<h2 id="expectations">Expectations</h2>
<p>The following is the list of expectations that must be met for a project to be considered complete.</p>
<ol type="1">
<li>Project will be picked from the list of projects from the previous reading or come up with your own idea.</li>
<li>You should have the following documentation either in the Wiki of your GitHub repo <em>or</em> in a documentation folder in your root directory:
<ul>
<li>Schema</li>
<li>Feature Document outlining MVP features as well as additional features (user stories and acceptance criteria <em>strongly</em> encouraged)</li>
</ul></li>
<li>A README with instructions on how to launch the application</li>
<li>Your app must have user authentication
<ul>
<li>Sign Up</li>
<li>Login / Logout</li>
<li>Demo User Login</li>
</ul></li>
<li>Must have at least one major CRUD feature in addition to user authentication</li>
<li>Front-end:
<ul>
<li>React</li>
<li>Redux</li>
<li>Hooks are optional (but encouraged)</li>
</ul></li>
<li>Backend:
<ul>
<li>Express</li>
<li>Sequelize</li>
</ul></li>
</ol>
<h2 id="student-responsibilities">Student Responsibilities</h2>
<ol type="1">
<li>By EOD today, create your project repo, upload your feature list to your repo and send your project advisor your list of features for sign-off</li>
<li>Join your new "circle" slack which you will be invited to by the end of day. Your circle consists of all the students that have the same project advisor as you. You will be having stand up and end of day chats with this circle.</li>
<li>Every day you will attend stand up with your advisor and the other students in your circle – be prepared to discuss what you worked on the day before and have a plan for what you want to accomplish that day.</li>
<li>Complete all nightly reports as per usual and use these reports to reflect on your progress. We rely on these reports to check in on your progress so please, as always, take them seriously. Some examples:
<ul>
<li>"I expected to finish the back- and frontend for logging in, but still need to debug my onSubmit."</li>
<li>"At the beginning of the day, I was very confused about the Redux cycle, but going through debugger waterfalls while testing my action creators on the window really helped."</li>
<li>"Today I really struggled with destructuring my state. I think the next time I do a project like this, I will structure my frontend state to use more slices and less nesting."</li>
</ul></li>
</ol>
<h2 id="question-asking">Question Asking</h2>
<p>During this project, you will get practice expressing yourself when running into trouble without just saying "it doesn’t work". In a professional environment, knowing when to ask for help and not spending too much time on any one problem is critical, but making the most out of the time with your manager or Senior Engineers is also vital.</p>
<p>Questions should be asked in Slack to your entire circle. Before asking a question, please have the following available:</p>
<ul>
<li>What you are working on</li>
<li>A description of the problem</li>
<li>What the error message says on the server/frontend console (if there is one)</li>
<li>A relevant code snippet</li>
<li>The debugging process you’ve done so far (MANDATORY)</li>
</ul>
<p>This process allows your fellow students to also help you out – further, it will allow us to know if multiple students are having similar issues and if so we can have a group session to clarify if necessary.</p>
<hr />
<h1 id="react-project">React Project</h1>
<p>You’ve spent the last two weeks on a whirlwind tour of React and some of its most popular features and libraries in its ecosystem. Now, you get to do something substantial with it while its fresh in your minds.</p>
<p>Next week, you get a full week to write a compelling front-end application to go into your portfolio. It should be something that you can display to demonstrate the skills that you’ve picked up over the past two weeks. While you do have to use React, the rest is up to you, but we recommend that you use Hooks in your project because those are the latest way that people build things in React and will be most appealing to people that are looking at your project.</p>
<p>Because this is an individual project, you have full freedom (and ultimately responsibility) of being able to get something done. If you want to build the entire fullstack application yourself, that’s great! Just make sure you scope the amount of work into something that you feel is best for your week’s worth of time. Use your newly-found knowledge of how long it took you to build your other project to determine how much you could get done on your own.</p>
<p>If you choose not to build a full-stack project, but just want to spend all of your time on the front-end, consider building a front-end for <em>any</em> of the group projects, it doesn’t have to be your own. Or, you can check out <a href="https://www.programmableweb.com/">Programmable Web</a> which lists thousands of APIs that you can use in your project.</p>
<p>Now that you have an understanding of how Websockets work, use the <a href="https://socket.io">socket.io</a> library on your backend to make Websocket development easy.</p>
<p>Moreover, search for <em>third-party React libraries</em> that you can use to help speed your development or give your application a polished look. Here are some suggestions for you to look at as a start:</p>
<ul>
<li><a href="https://v2.grommet.io/">Grommet</a>: A react-based framework that provides accessibility, modularity, responsiveness, and theming in a tidy package</li>
<li><a href="https://material-ui.com/">Material UI</a>: A library of components that adhere to the Material design specifications</li>
<li><a href="https://react-bootstrap.github.io/">React Bootstrap</a>: A library of React components that wrap Bootstrap</li>
<li><a href="https://react.semantic-ui.com/">Semantic UI React</a>: A development framework that helps create beautiful, responsive layouts using human-friendly HTML.</li>
</ul>
<p>Those are just starting points. You can look for more by using your favorite search engine and terms like "react libraries".</p>
<h2 id="homework">Homework</h2>
<p>Think about what you’d like to do, poke around <a href="https://www.programmableweb.com/">Programmable Web</a>, go back and look at all of the group projects, look at the list of projects at the end of this article. Find something that you would like to do. You already have a strong knowledge of how to build a data API. You have the code to hook in authentication using JWTs. You can reuse your models and migrations from earlier projects.</p>
<h2 id="planning-day">Planning Day</h2>
<p>Put together your proposal. In software development, normally, a week of planning can give you about three months of work. So, your day of figuring out what you’d like your app to do should give you a week</p>
<h2 id="project-ideas">Project ideas</h2>
<p>Here is that list of project suggestions, again, with their different requirements. Feel free to do one of them, if you think you have time.</p>
<ul>
<li><a href="http://www.airbnb.com">AirBnB</a>
<ul>
<li>Spots</li>
<li>Bookings</li>
<li>Spots search (by location &amp; availability) &amp; Google Maps on search</li>
<li>Reviews</li>
<li><strong>Bonus</strong>: Messaging</li>
<li><strong>Bonus</strong>: User/host profiles</li>
</ul></li>
<li><a href="http://www.asana.com">Asana</a>
<ul>
<li>Projects</li>
<li>Tasks</li>
<li>Teams</li>
<li>Profile for each user</li>
<li><strong>Bonus</strong>: Calendar</li>
<li><strong>Bonus</strong>: Comments on tasks</li>
</ul></li>
<li><a href="http://www.bandcamp.com">Bandcamp</a>
<ul>
<li>Artist page</li>
<li>Song player</li>
<li>Search</li>
<li>Upload/download songs</li>
<li><strong>Bonus</strong>: Purchase songs</li>
<li><strong>Bonus</strong>: Follows</li>
</ul></li>
<li><a href="http://www.basecamp.com">Basecamp</a>
<ul>
<li>To-do Lists</li>
<li>Basecamp Home View</li>
<li>Message Board (post questions and allow comments/answers)</li>
<li>Schedule</li>
<li><strong>Bonus</strong>: Upload Documents &amp; Files</li>
<li><strong>Bonus</strong>: Messaging within a basecamp</li>
</ul></li>
<li><a href="http://www.billpin.com">BillPin</a>
<ul>
<li>Friends</li>
<li>Feed with transactions</li>
<li>Owes me/ I owe</li>
<li>Split bill</li>
<li><strong>Bonus</strong>: profile</li>
</ul></li>
<li><a href="https://www.brainscape.com">BrainScape</a>
<ul>
<li>Create/Delete Decks</li>
<li>Study Decks</li>
<li>Tags/Categories</li>
<li>Search</li>
<li><strong>Bonus</strong>: Badges (associated with progress)</li>
<li><strong>Bonus</strong>: Animation</li>
</ul></li>
<li><a href="http://www.couchsurfing.com">Couchsurfing</a>
<ul>
<li>Spots</li>
<li>Bookings</li>
<li>Spots search (by location &amp; availability) &amp; Google Maps on search</li>
<li>Reviews</li>
<li><strong>Bonus</strong>: Messaging</li>
<li><strong>Bonus</strong>: User/host profiles</li>
</ul></li>
<li><a href="https://discordapp.com/">Discord</a>
<ul>
<li>Servers</li>
<li>Channels within servers</li>
<li>Live Chat</li>
<li>Direct Messaging via private servers</li>
</ul></li>
<li><a href="http://www.etsy.com">Etsy</a>
<ul>
<li>Product Listings</li>
<li>Shopping Cart</li>
<li>Comments / Reviews</li>
<li>Search</li>
<li><strong>Bonus</strong>: Categories</li>
<li><strong>Bonus</strong>: Favorites</li>
</ul></li>
<li><a href="http://www.eventbrite.com">Eventbrite</a>
<ul>
<li>Events</li>
<li>Registration / Tickets</li>
<li>Categories</li>
<li>Bookmark events</li>
<li><strong>Bonus</strong>: Google Maps integration</li>
<li><strong>Bonus</strong>: Search</li>
</ul></li>
<li><a href="http://www.evernote.com">Evernote</a>
<ul>
<li>Notes</li>
<li>Notebooks</li>
<li>Tags</li>
<li>Rich-text editing</li>
<li><strong>Bonus</strong>: Reminders</li>
<li><strong>Bonus</strong>: Search</li>
<li><strong>Bonus</strong>: Auto save</li>
</ul></li>
<li><a href="http://www.feedly.com">Feedly</a>
<ul>
<li>Feeds</li>
<li>Sources</li>
<li>Articles</li>
<li>Reads</li>
<li><strong>Bonus</strong>: Favorites</li>
<li><strong>Bonus</strong>: Search</li>
</ul></li>
<li><a href="http://www.flickr.com">Flickr</a>
<ul>
<li>Photos</li>
<li>Albums</li>
<li>Comments</li>
<li>Tags</li>
<li><strong>Bonus</strong>: Favorites</li>
<li><strong>Bonus</strong>: Follows</li>
</ul></li>
<li><a href="http://www.genius.com">Genius</a>
<ul>
<li>Tracks</li>
<li>Annotations</li>
<li>Comments</li>
<li>Upvotes</li>
<li><strong>Bonus</strong>: Tags</li>
<li><strong>Bonus</strong>: Search</li>
</ul></li>
<li><a href="http://www.goodreads.com">Goodreads</a>
<ul>
<li>Books</li>
<li>Bookshelves</li>
<li>Reviews</li>
<li>Read Status (will read, have read, etc.)</li>
<li><strong>Bonus</strong>: Search across multiple models</li>
<li><strong>Bonus</strong>: Tags</li>
</ul></li>
<li><a href="https://www.hipcamp.com/">HipCamp</a>
<ul>
<li>Spots</li>
<li>Bookings</li>
<li>Spots search (by location &amp; availability) &amp; Google Maps on search</li>
<li>Reviews</li>
<li><strong>Bonus</strong>: Messaging</li>
<li><strong>Bonus</strong>: User/host profiles</li>
</ul></li>
<li><a href="https://www.indiegogo.com/">Indiegogo</a>
<ul>
<li>Profiles</li>
<li>Campaigns</li>
<li>Contributions</li>
<li>Rewards</li>
<li><strong>Bonus</strong>: Categories</li>
<li><strong>Bonus</strong>: Follows</li>
</ul></li>
<li><a href="http://www.instructables.com/">Instructables</a>
<ul>
<li>Projects</li>
<li>Commenting on projects</li>
<li>Adding photos and videos to projects</li>
<li>Searching projects by keyword</li>
<li><strong>Bonus</strong>: Featured project channels</li>
<li><strong>Bonus</strong>: Categories</li>
</ul></li>
<li><a href="http://www.kickstarter.com">Kickstarter</a>
<ul>
<li>Projects</li>
<li>Backing projects &amp; rewards</li>
<li>Search</li>
<li>Categories / Discover feature</li>
<li><strong>Bonus</strong>: Likes</li>
<li><strong>Bonus</strong>: Credit card payments</li>
</ul></li>
<li><a href="http://www.medium.com">Medium</a>
<ul>
<li>Stories</li>
<li>Commenting on stories</li>
<li>Follows and feed</li>
<li>Likes</li>
<li><strong>Bonus</strong>: Topics/categories</li>
<li><strong>Bonus</strong>: Bookmarks</li>
</ul></li>
<li><a href="http://www.meetup.com">Meetup</a>
<ul>
<li>Groups and joining groups</li>
<li>Events and RSVPs</li>
<li>Calendar (on group page)</li>
<li>Search by location and group info (name, description)</li>
<li><strong>Bonus</strong>: Categories</li>
<li><strong>Bonus</strong>: Calendar (for all groups in search results)</li>
</ul></li>
<li><a href="http://www.newsblur.com">Newsblur</a>
<ul>
<li>RSS feeds</li>
<li>Story tagging</li>
<li>Sharing on Blurblog/profile</li>
<li>Full text search of stories</li>
<li><strong>Bonus</strong>: hide or highlight stories</li>
<li><strong>Bonus</strong>: Real-time updating of RSS feeds</li>
</ul></li>
<li><a href="http://www.opentable.com/">OpenTable</a>
<ul>
<li>Create and search restaurants</li>
<li>Reservations</li>
<li>Ratings/reviews</li>
<li>Favorites</li>
<li><strong>Bonus</strong>: Discover/explore</li>
<li><strong>Bonus</strong>: points for bookings and usage of site</li>
</ul></li>
<li><a href="http://www.pinterest.com">Pinterest</a>
<ul>
<li>Profile</li>
<li>Boards and Pins</li>
<li>Follows</li>
<li>Discover feed on home page</li>
<li><strong>Bonus</strong>: notifications</li>
<li><strong>Bonus</strong>: private boards</li>
<li><strong>Bonus</strong>: likes</li>
</ul></li>
<li><a href="http://www.pivotaltracker.com">Pivotal Tracker</a>
<ul>
<li>Projects/Project Page</li>
<li>Stories</li>
<li>Story Workflow</li>
<li>Drag and Drop Prioritization</li>
<li><strong>Bonus</strong>: Iterations</li>
<li><strong>Bonus</strong>: Velocity</li>
</ul></li>
<li><a href="http://www.polleverywhere.com">Poll Everywhere</a>
<ul>
<li>Questions</li>
<li>Web URL to take poll</li>
<li>Live-update Poll view</li>
<li>Group/Ungroup Questions</li>
<li><strong>Bonus</strong>: Text to polls</li>
<li><strong>Bonus</strong>: Reports</li>
</ul></li>
<li><a href="https://www.producthunt.com/">Product Hunt</a>
<ul>
<li>Products</li>
<li>Profile Page</li>
<li>Product Discussion</li>
<li>Search (Users or Products)</li>
<li><strong>Bonus</strong>: Collections</li>
<li><strong>Bonus</strong>: Upvotes and Tags</li>
</ul></li>
<li><a href="http://www.quora.com">Quora</a>
<ul>
<li>Questions</li>
<li>Answers/comments on answers</li>
<li>Search Questions</li>
<li>Topics/Tags</li>
<li><strong>Bonus</strong>: Upvotes, order questions by popularity</li>
<li><strong>Bonus</strong>: Replies to comments</li>
</ul></li>
<li><a href="https://www.rememberthemilk.com/">Remember the Milk</a>
<ul>
<li>Tasks</li>
<li>Lists</li>
<li>List summary (time, num tasks, num completed)</li>
<li>Search</li>
<li><strong>Bonus</strong>: Autocomplete SmartAdd of task properties</li>
<li><strong>Bonus</strong>: Subtasks</li>
</ul></li>
<li><a href="https://robinhood.com/">Robinhood</a>
<ul>
<li>Dashboard + Portfolio</li>
<li>Asset/Stock Detail</li>
<li>Watchlist</li>
<li>Asset/Stock Search</li>
</ul></li>
<li><a href="http://www.slack.com">Slack</a>
<ul>
<li>Live chat</li>
<li>Channels</li>
<li>Direct Message</li>
<li>Teams or multi-person DM</li>
<li><strong>Bonus</strong>: Search Messages</li>
<li><strong>Bonus</strong>: Notifications</li>
</ul></li>
<li><a href="http://www.soundcloud.com">Soundcloud</a>
<ul>
<li>Song CRUD</li>
<li>Playing songs with progress bar with continuous play</li>
<li>Comments</li>
<li>User pages</li>
<li><strong>Bonus</strong>: Wave Forms</li>
<li><strong>Bonus</strong>: Playlists</li>
<li><strong>Bonus</strong>: Likes</li>
</ul></li>
<li><a href="http://www.splitwise.com">SplitWise</a>
<ul>
<li>Friending</li>
<li>Bills</li>
<li>Transaction History</li>
<li>Comments</li>
<li><strong>Bonus</strong>: Groups</li>
<li><strong>Bonus</strong>: Fake "checkout"</li>
</ul></li>
<li><a href="http://www.stackoverflow.com">Stack Overflow</a>
<ul>
<li>Ask Questions</li>
<li>Answer Questions</li>
<li>Search for Questions</li>
<li>Upvote / Downvote Answer</li>
<li><strong>Bonus</strong>: Question Categories</li>
<li><strong>Bonus</strong>: Comment on Questions / Answers</li>
<li><strong>Bonus</strong>: Polymorphic Up/Down Votes: Questions, Answers, Comments</li>
<li><strong>Bonus</strong>: Code Snippets in Answers</li>
</ul></li>
<li><a href="http://www.strava.com">Strava</a>
<ul>
<li>Creating Routes</li>
<li>Saving Workouts</li>
<li>Workout Feed</li>
<li>Workout Stats/Totals</li>
<li><strong>Bonus</strong>: Friends</li>
<li><strong>Bonus</strong>: Workout Comments</li>
<li><strong>Bonus</strong>: Social Feed</li>
</ul></li>
<li><a href="http://www.taskrabbit.com">TaskRabbit</a>
<ul>
<li>Choose a task</li>
<li>Provide task details</li>
<li>Select price &amp; confirm</li>
<li>Get assigned a tasker</li>
<li><strong>Bonus</strong>: Become a Tasker</li>
<li><strong>Bonus</strong>: Fake Payment &amp; Billing</li>
</ul></li>
<li><a href="http://www.teawithstrangers.com/">TeaWithStrangers</a>
<ul>
<li>Choose City</li>
<li>Host Event</li>
<li>Join Event in your city</li>
<li>Dashboard of joined events/hosted events</li>
<li><strong>Bonus</strong>: Google Map API showing events based on location</li>
<li><strong>Bonus</strong>: Suggestions based on event details and user profiles</li>
</ul></li>
<li><a href="http://www.tumblr.com/">Tumblr</a>
<ul>
<li>Posts form for various post types</li>
<li>Feed</li>
<li>Follows</li>
<li>Likes</li>
<li><strong>Bonus</strong>: Reblog</li>
<li><strong>Bonus</strong>: User show page (blog)</li>
</ul></li>
<li><a href="https://untappd.com">Untappd</a>
<ul>
<li>Drinks CRUD</li>
<li>Checkins / reviews</li>
<li>Review feed</li>
<li>Profile</li>
<li><strong>Bonus</strong>: Friendships</li>
<li><strong>Bonus</strong>: Search</li>
<li><strong>Bonus</strong>: Venues</li>
<li><strong>Bonus</strong>: Badges</li>
</ul></li>
<li><a href="http://www.yammer.com">Yammer</a>
<ul>
<li>News feed</li>
<li>Groups</li>
<li>Profile</li>
<li>Likes</li>
<li><strong>Bonus</strong>: Reply</li>
<li><strong>Bonus</strong>: Inbox (personal messages)</li>
<li><strong>Bonus</strong>: Notifications</li>
</ul></li>
<li><a href="http://www.yelp.com">Yelp</a>
<ul>
<li>Business Page</li>
<li>Search / filters</li>
<li>Reviews / ratings</li>
<li>Map</li>
<li><strong>Bonus</strong>: Mark reviews funny, cool, useful etc.</li>
<li><strong>Bonus</strong>: Profile</li>
<li><strong>Bonus</strong>: Friends</li>
</ul></li>
<li><a href="http://www.wufoo.com">Wufoo</a>
<ul>
<li>Build Forms</li>
<li>Build various question types</li>
<li>Share Forms</li>
<li>Display Results</li>
<li><strong>Bonus</strong>: Graph results</li>
</ul></li>
</ul>
</body></html>
