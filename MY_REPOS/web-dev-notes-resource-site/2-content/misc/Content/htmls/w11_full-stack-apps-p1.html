<!DOCTYPE html><html><head>
      <title>w11_full-stack-apps-p1</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\almyk\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.5.13\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header undefined" id="week-11brfull-stack-applications-part-1">WEEK 11<br><em>Full-Stack Applications (Part 1)</em></h1>

<hr>
<p><a href="#regular-expressions-learning-objectives"><strong>Regular Expressions Learning Objectives</strong></a><br>
<a href="#http-full-stack-learning-objectives"><strong>HTTP Full-Stack Learning Objectives</strong></a></p>
<ul>
<li><a href="#the-uniform-resource-locator-url"><strong>The Uniform Resource Locator (URL)</strong></a>
<ul>
<li><a href="#the-specification">The specification</a></li>
<li><a href="#what-is-this-resource-thing">What is this &quot;resource&quot; thing?</a></li>
<li><a href="#the-components-of-a-url">The components of a URL</a></li>
<li><a href="#reading-rfcs">Reading RFCs</a></li>
</ul>
</li>
<li><a href="#regular-expressions-cheat-sheet"><strong>Regular Expressions Cheat Sheet</strong></a>
<ul>
<li><a href="#the-operator">The * operator</a></li>
<li><a href="#the-operator-1">The ? operator</a></li>
<li><a href="#the-operator-2">The + operator</a></li>
<li><a href="#the-operator-3">The . operator</a></li>
<li><a href="#the-operator-without-brackets">The ^ operator without brackets</a></li>
<li><a href="#the-operator-4">The $ operator</a></li>
<li><a href="#the-bracket-expression">The [] bracket expression</a></li>
</ul>
</li>
<li><a href="#regexone-practice"><em>RegexOne Practice</em></a></li>
<li><a href="#http-full-stack-project"><em>HTTP Full-Stack Project</em></a></li>
</ul>
<p><a href="#express-learning-objectives"><strong>Express Learning Objectives</strong></a><br>
<a href="#pug-template-learning-objectives"><strong>Pug Template Learning Objectives</strong></a></p>
<ul>
<li><a href="#moving-into-the-express-lane"><strong>Moving Into the Express Lane</strong></a>
<ul>
<li><a href="#installing-express">Installing Express</a></li>
<li><a href="#creating-an-express-application">Creating an Express application</a></li>
<li><a href="#handling-requests">Handling requests</a></li>
<li><a href="#listening-for-http-connections">Listening for HTTP connections</a></li>
<li><a href="#testing-your-application">Testing your application</a></li>
</ul>
</li>
<li><a href="#templating-meet-pug"><strong>Templating - <em>Meet Pug!</em></strong></a>
<ul>
<li><a href="#what-is-a-template">What is a template?</a></li>
<li><a href="#rendering-a-simple-template">Rendering a simple template</a></li>
</ul>
</li>
<li><a href="#digging-into-the-pug-template-syntax"><strong>Digging Into the Pug Template Syntax</strong></a>
<ul>
<li><a href="#setting-up-a-sandbox-application">Setting up a sandbox application</a></li>
<li><a href="#rendering-elements">Rendering elements</a></li>
<li><a href="#setting-element-attribute-values">Setting element attribute values</a></li>
<li><a href="#rendering-data">Rendering data</a></li>
<li><a href="#iteration-and-conditionals">Iteration and conditionals</a></li>
</ul>
</li>
<li><a href="#exploring-route-paths"><strong>Exploring Route Paths</strong></a>
<ul>
<li><a href="#getting-data-from-a-path">Getting data from a path</a></li>
<li><a href="#defining-flexible-route-paths">Defining flexible route paths</a></li>
<li><a href="#redirecting-incorrect-requests">Redirecting &quot;incorrect&quot; requests</a></li>
</ul>
</li>
<li><a href="#express-routers"><strong>Express Routers</strong></a>
<ul>
<li><a href="#setting-up-the-initial-project">Setting up the initial project</a></li>
<li><a href="#defining-a-collection-of-route-handlers">Defining a collection of route handlers</a></li>
<li><a href="#mounting-a-router-instance">Mounting a Router instance</a></li>
</ul>
</li>
<li><a href="#routing-roundup-project"><em>Routing Roundup Project</em></a></li>
</ul>
<p><a href="#html-forms-learning-objectives"><strong>HTML Forms Learning Objectives</strong></a></p>
<ul>
<li><a href="#html-forms-an-introduction"><strong>HTML Forms: An Introduction</strong></a>
<ul>
<li><a href="#key-components-of-a-form">Key components of a form</a></li>
<li><a href="#submitting-the-form">Submitting the form</a></li>
</ul>
</li>
<li><a href="#html-forms-in-express"><strong>HTML Forms in Express</strong></a>
<ul>
<li><a href="#forms-example-setup">Forms example setup</a></li>
<li><a href="#getting-the-add-guest-form">Getting the &quot;Add Guest&quot; form</a></li>
<li><a href="#a-quick-aside-pug-layout-templates">A quick aside: Pug layout templates</a></li>
<li><a href="#submitting-the-guest-form">Submitting the guest form</a></li>
</ul>
</li>
<li><a href="#data-validation"><strong>Data Validation</strong></a>
<ul>
<li><a href="#importance-of-server-side-data-validation">Importance of server-side data validation</a></li>
<li><a href="#server-side-validations">Server-side validations</a></li>
<li><a href="#server-side-validations-an-example">Server-side validations: an example</a></li>
</ul>
</li>
<li><a href="#express-middleware"><strong>Express Middleware</strong></a>
<ul>
<li><a href="#middleware-overview">Middleware overview</a></li>
<li><a href="#data-validations-with-middleware">Data validations with middleware</a></li>
</ul>
</li>
<li><a href="#protecting-forms-from-csrf"><strong>Protecting forms from CSRF</strong></a>
<ul>
<li><a href="#csrf-explained">CSRF explained</a></li>
<li><a href="#preventing-csrf">Preventing CSRF</a></li>
</ul>
</li>
<li><a href="#formative-forms-project"><em>Formative Forms Project</em></a></li>
</ul>
<p><a href="#data-driven-web-sites-learning-objectives"><strong>Data-Driven Web Sites Learning Objectives</strong></a></p>
<ul>
<li><a href="#acclimating-to-environment-variables"><strong>Acclimating to Environment Variables</strong></a>
<ul>
<li><a href="#what-are-environment-variables">What are environment variables?</a></li>
<li><a href="#setting-and-getting-environment-variable-values">Setting and getting environment variable values</a></li>
<li><a href="#storing-environment-variables-in-a-env-file">Storing environment variables in a <code>.env</code> file</a></li>
<li><a href="#using-a-module-to-organize-environment-variables">Using a module to organize environment variables</a></li>
</ul>
</li>
<li><a href="#asynchronous-route-handlers-in-express"><strong>Asynchronous Route Handlers in Express</strong></a>
<ul>
<li><a href="#calling-asynchronous-functions-or-methods-within-route-handlers">Calling asynchronous functions or methods within route handlers</a></li>
<li><a href="#reducing-boilerplate-code">Reducing boilerplate code</a></li>
</ul>
</li>
<li><a href="#handling-errors-in-express"><strong>Handling Errors in Express</strong></a>
<ul>
<li><a href="#setting-up-an-example-express-application">Setting up an example Express application</a></li>
<li><a href="#the-default-error-handler-in-express">The default error handler in Express</a></li>
<li><a href="#defining-a-custom-error-handler">Defining a custom error handler</a></li>
<li><a href="#handling-page-not-found-errors">Handling &quot;Page Not Found&quot; errors</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-part-1-setting-up-the-project"><em>Data-Driven Websites (Part 1: Setting Up the Project)</em></a></li>
<li><a href="#data-driven-websites-project-part-2-integrating-sequelize-with-express"><em>Data-Driven Websites Project (Part 2: Integrating Sequelize with Express)</em></a></li>
<li><a href="#data-driven-websites-project-part-3-using-sequelize-to-perform-crud-operations"><em>Data-Driven Websites Project (Part 3: Using Sequelize to Perform CRUD Operations)</em></a></li>
</ul>
<hr>
<hr>
<h1 class="mume-header undefined" id="week-11-day-1brnode-http-servers">WEEK-11 DAY-1<br><em>Node HTTP Servers</em></h1>

<hr>
<h1 class="mume-header" id="regular-expressions-learning-objectives">Regular Expressions Learning Objectives</h1>

<p>Regular expressions are a delight and a nightmare. They please and they<br>
confound. They are an important part of every developer&apos;s toolbox. By the time<br>
you finish this, you should be able to</p>
<ul>
<li>Define the effect of the * operator and use it in a regular expression</li>
<li>Define the effect of the ? operator and use it in a regular expression</li>
<li>Define the effect of the + operator and use it in a regular expression</li>
<li>Define the effect of the . operator and use it in a regular expression</li>
<li>Define the effect of the ^ operator and use it in a regular expression</li>
<li>Define the effect of the $ operator and use it in a regular expression</li>
<li>Define the effect of the [] bracket expression and use it in a regular<br>
expression</li>
<li>Define the effect of the - inside brackets and use it in a regular expression</li>
<li>Define the effect of the ^ inside brackets and use it in a regular expression</li>
</ul>
<hr>
<h1 class="mume-header" id="http-full-stack-learning-objectives">HTTP Full-Stack Learning Objectives</h1>

<p>Understanding how Node.js handles incoming HTTP requests using the<br>
<code>IncomingMessage</code> and <code>ServerResponse</code> objects provide a strong foundation of<br>
being able to predict problems when you use frameworks to ease the burden of<br>
writing Web applications. When you complete the associated material for this<br>
lesson, you should be able to:</p>
<ul>
<li>Identify the five parts of a URL</li>
<li>Identify at least three protocols handled by the browser</li>
<li>Use an <code>IncomingMessage</code> object to
<ul>
<li>access the headers sent by a client (like a Web browser) as part of the HTTP<br>
request</li>
<li>access the HTTP method of the request</li>
<li>access the path of the request</li>
<li>access and read the stream of content for requests that have a body</li>
</ul>
</li>
<li>Use a <code>ServerResponse</code> object to
<ul>
<li>write the status code, message, and headers for an HTTP response</li>
<li>write the content of the body of the response</li>
<li>properly end the response to indicate to the client (like a Web browser)<br>
that all content has been written</li>
</ul>
</li>
</ul>
<hr>
<h1 class="mume-header" id="the-uniform-resource-locator-url">The Uniform Resource Locator (URL)</h1>

<p>We use URLs all the time. Now, it&apos;s time to really understand how they work.</p>
<p>From this reading, you should be able to</p>
<ul>
<li>Recall where to find the definition of a URL,</li>
<li>Identify and recall the five components of a URL, and</li>
<li>Identify properly formatted URLs</li>
</ul>
<h2 class="mume-header" id="the-specification">The specification</h2>

<p>Almost all good things that define how the Internet works has one or more things<br>
called IETF RFCs which define how they work. There are two acronyms there:</p>
<ul>
<li><strong>IETF</strong>: Internet Engineering Task Force</li>
<li><strong>RFC</strong>: Request For Comments</li>
</ul>
<p>The IETF is an open standards organization that creates voluntary standards to<br>
maintain and improve the usability and interoperability of the Internet. Things<br>
like the way travels across the Internet is created an maintained by the IETF.<br>
In particular, the <em>Simple Mail Transfer Protocol</em> is now governed by <a href="https://tools.ietf.org/html/rfc5321">RFC<br>
5321</a>. RFC 5321 made obsolete RFC 2821 which, in turn, made obsolete RFC 821.<br>
The IETF is always working to make the Internet better with respect to its<br>
growth and usage.</p>
<p>An RFC is a document usually created by programmers, engineers, and scientists<br>
in the form of a memorandum. They publish the RFC for peer review. When enough<br>
people have reviewed it, and it seems worthy of adoption, the IETF will change<br>
its status to &quot;Internet Standard&quot; which means that everyone should comply with<br>
it if they implement that standard.</p>
<p>The <a href="https://tools.ietf.org/html/rfc3986">RFC 3986</a>, <em>Uniform Resource Identifier (URI): Generic Syntax</em>, is an<br>
&quot;Internet Standard&quot;. That means that software applications that use URLs need to<br>
conform to the specification found in that document lest they be publicly shamed<br>
by computer programmers trying to use the non-conforming software.</p>
<h2 class="mume-header" id="what-is-this-resource-thing">What is this &quot;resource&quot; thing?</h2>

<p>Well, the standard doesn&apos;t do much for you in providing a definition of this<br>
word &quot;resource&quot;.</p>
<blockquote>
<p>This specification does not limit the scope of what might be a resource;<br>
rather, the term &quot;resource&quot; is used in a general sense for whatever might be<br>
identified by a URI. Familiar examples include an electronic document, an<br>
image, a source of information with a consistent purpose (e.g., &quot;today&apos;s<br>
weather report for Los Angeles&quot;), a service (e.g., an HTTP-to-SMS gateway),<br>
and a collection of other resources. A resource is not necessarily accessible<br>
via the Internet; e.g., human beings, corporations, and bound books in a<br>
library can also be resources. Likewise, abstract concepts can be resources,<br>
such as the operators and operands of a mathematical equation, the types of a<br>
relationship (e.g., &quot;parent&quot; or &quot;employee&quot;), or numeric values (e.g., zero,<br>
one, and infinity).</p>
</blockquote>
<p>That influence comes from one of the authors, Dr. Roy Fielding. He has some<br>
strong ideas about how the Internet works and, much to his disappointment, it<br>
continues to move away from his ideals.</p>
<p>For your purposes, a URL points to a (hopefully) accessible resource that can<br>
be accessed, like HTML, CSS, JavaScript, and pure data in the form of JSON.</p>
<h2 class="mume-header" id="the-components-of-a-url">The components of a URL</h2>

<p>In Section 3, <em>Syntax Components</em>, of RFC 3986 contains this helpful ASCII art<br>
graphic to show you the components of a URL.</p>
<pre data-role="codeBlock" data-info class="language-"><code>  foo://example.com:8042/over/there?name=ferret#nose
  \_/   \______________/\_________/ \_________/ \__/
   |           |            |            |        |
scheme     authority       path        query   fragment
</code></pre><p>Here&apos;s an explanation of each of those components.</p>
<h3 class="mume-header" id="the-scheme-of-a-url">The &quot;scheme&quot; of a URL</h3>

<p>This section used to be called &quot;the protocol&quot;, but was updated when URLs became<br>
part of a larger family known as URIs, Uniform Resource Identifiers, which is<br>
what RFC 3986 actually covers.</p>
<p>You&apos;ve actually used three schemes already in class! Can you remember them?</p>
<p>If you replied &quot;http&quot; and &quot;https&quot;, that&apos;s right! When you type an authority in<br>
the browser, like &quot;<a href="http://duckduckgo.com">duckduckgo.com</a>&quot; or &quot;localhost:3000&quot;, the browser <em>assumes</em> that<br>
you want to use HTTP, so it prepends that scheme to the authority. The browser<br>
would then make requests to &quot;<a href="http://duckduckgo.com">http://duckduckgo.com</a>&quot; or &quot;<a href="http://localhost:3000">http://localhost:3000</a>&quot;.</p>
<p>When you double click on an HTML file and it opens locally in your browser, that<br>
is using the &quot;file&quot; scheme, meaning that it is looking for a file local to the<br>
computer! You&apos;ve done this countless times during this course. You may have<br>
noticed the &quot;file&quot; part in the address bar. That&apos;s the scheme it used to access<br>
local files as opposed to making an HTTP request.</p>
<p>This is why it was once named &quot;protocol&quot;, because it was the protocol that the<br>
browser would use to <em>locate the resource</em> using a Uniform Resource Locator.</p>
<h3 class="mume-header" id="stuff-between-the-scheme-and-authority">Stuff between the scheme and authority</h3>

<p>The standard tells us that for URLs that have an authority, the characters &quot;&#x1F615;/&quot;<br>
must exist between the scheme and the authority. That&apos;s why you have to type<br>
those characters. You can blame Sir Tim Berners-Lee for that because he defined<br>
it in the original RFC for this subject, RFC 1738, <em>Uniform Resource Locators<br>
(URL)</em>.</p>
<h3 class="mume-header" id="the-authority">The authority</h3>

<p>This part of as URL is normally the domain name of the resource that has the<br>
resource that you&apos;re trying to access.</p>
<p>Sometimes it has a port number, too, like when you start a local HTTP server<br>
with Node.js. Then, you type &quot;<a href="http://localhost:3000">http://localhost:3000</a>&quot;. The authority is the<br>
entire &quot;localhost:3000&quot;. That means that, even if &quot;<a href="http://localhost:3000">http://localhost:3000</a>&quot; and<br>
&quot;<a href="http://localhost:8081">http://localhost:8081</a>&quot; return the exact same content, they&apos;re considered to be<br>
two different URLs to the same content.</p>
<h3 class="mume-header" id="the-path">The path</h3>

<p>Paths are in the first part of an HTTP request, if you recall. When you click on<br>
a link in your browser that takes you to &quot;<a href="https://duckduckgo.com/about">https://duckduckgo.com/about</a>&quot;, that<br>
results in an HTTP request that begins with the following line:</p>
<pre data-role="codeBlock" data-info class="language-"><code>GET /about HTTP/1.1
</code></pre><p>That&apos;s the path.</p>
<p>If the path is omitted from a URL, it is assumed to be &quot;/&quot;.</p>
<h3 class="mume-header" id="the-query">The query</h3>

<p>This is extra information sent to the browser meant for the processing of the<br>
request. For example, when you go to DuckDuckGo and perform a search for &quot;RFC<br>
3986&quot; by typing it into the search box, the URL that your browser is directed to<br>
reads &quot;<a href="https://duckduckgo.com/?q=RFC+3986">https://duckduckgo.com/?q=RFC+3986</a>&quot;.</p>
<p>The question mark and everything that comes after it (up to the <em>fragment</em>) is<br>
considered the &quot;query&quot; of the URL. Because it&apos;s part of the URL, it means that<br>
different values of the query part of the URL points to different resources even<br>
if the exact same content is returned.</p>
<p>With respect to URLs used for the World Wide Web, queries generated by browsers<br>
(and possibly by your code) will have the following format:</p>
<ul>
<li>Entries in the query are &quot;URL encoded&quot; key-value pairs with an equal sign<br>
between them</li>
<li>Entries are concatenated with the ampersand symbol</li>
</ul>
<p>When the key or value of an entry in a query contains a character that is not<br>
one of the reserved or unreserved characters, then it gets &quot;URL encoded&quot;. That<br>
process replaces each character a percent sign and its hexadecimal <a href="https://en.wikipedia.org/wiki/ASCII#Character_set">ASCII Code</a>.</p>
<p>For example, when your provide the value &quot;Mary<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mi>u</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi mathvariant="normal">/</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>r</mi><mi>y</mi><mi mathvariant="normal">&quot;</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>y</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>q</mi><mi>u</mi><mi>e</mi><mi>r</mi><mi>y</mi><mi>i</mi><mi>n</mi><mi>D</mi><mi>u</mi><mi>c</mi><mi>k</mi><mi>D</mi><mi>u</mi><mi>c</mi><mi>k</mi><mi>G</mi><mi>o</mi><mo separator="true">,</mo><mi>t</mi><mi>h</mi><mi>e</mi><mi>b</mi><mi>r</mi><mi>o</mi><mi>w</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">&quot;</mi><mi>U</mi><mi>R</mi><mi>L</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>s</mi><mi mathvariant="normal">&quot;</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi mathvariant="normal">&quot;</mi></mrow><annotation encoding="application/x-tex">quite/contrary&quot; for your query
in DuckDuckGo, the browser &quot;URL encodes&quot; the &quot;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mord mathdefault">u</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord">/</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord">&quot;</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">u</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">u</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">G</span><span class="mord mathdefault">o</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">&quot;</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">L</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord">&quot;</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord">&quot;</span></span></span></span>&quot; and &quot;/&quot; because those<br>
aren&apos;t allowable characters. Those characters&apos; ASCII Code values are 24 and 2F,<br>
respectively. That transforms the string to &quot;Mary%24quite%2Fcontrary&quot;.</p>
<p>Luckily, JavaScript has built-in methods called <code>encodeURI</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI">link</a>) and <code>decodeURI</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURI">link</a>) that handles that transformation for you!</p>
<h3 class="mume-header" id="the-fragment">The fragment</h3>

<p>The fragment is never sent to the server. Instead, it tells the browser to<br>
access a specific section of the page after it loads. For example, if you look<br>
at the following link</p>
<p><a href="https://en.wikipedia.org/wiki/URL#Protocol-relative_URLs">https://en.wikipedia.org/wiki/URL#Protocol-relative_URLs</a></p>
<p>you can see that there is a fragment value of &quot;#Protocol-relative_URLs&quot;. If you<br>
click on that link, the browser will load that page and, then, scroll that<br>
section into view for you.</p>
<p>Unlike with changing values in <em>any</em> of the other sections, if you change the<br>
value in the fragment, the browser will <em>not</em> reload the page.</p>
<h2 class="mume-header" id="reading-rfcs">Reading RFCs</h2>

<p>Unfortunately, RFCs tend to be very unappealing and technical, not fun to read<br>
at all. However, you should try reading them when you have a question about how<br>
something works that&apos;s governed by the IETF. You will gain insight that only<br>
comes from technical documentation.</p>
<p>As a side note, it is a common thing for programmers to publish April Fool&apos;s<br>
RFCs. Their sense of humor is ... shockingly technical and dry. Here are some<br>
interesting ones, for example.</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc8565">Hypertext Jeopardy Protocol (HTJP/1.0)</a></li>
<li><a href="https://tools.ietf.org/html/rfc6921">Design Considerations for Faster-Than-Light (FTL) Communication</a></li>
<li><a href="https://tools.ietf.org/html/rfc5841">TCP Option to Denote Packet Mood</a></li>
</ul>
<p>Yep, that&apos;s the kind of humor in deeply computer science-y groups.</p>
<p>&#xAF;\(&#x25C9;&#x25E1;&#x25D4;)/&#xAF;</p>
<h2 class="mume-header" id="what-youve-learned">What you&apos;ve learned</h2>

<p>You learned that the five parts of a URL are</p>
<ol>
<li>The scheme (required),</li>
<li>The authority (required),</li>
<li>The path (optional),</li>
<li>The query (optional), and</li>
<li>The fragment (optional, not sent to the server).</li>
</ol>
<p>You were reminded that you actually know three schemes: http, https, and file.</p>
<p>And, that&apos;s it for URLs. &#x1F603;</p>
<hr>
<h1 class="mume-header" id="regular-expressions-cheat-sheet">Regular Expressions Cheat Sheet</h1>

<p>This article lists the most commonly-used regular expressions operators. You<br>
can use it as a handy reference for later while you write regular expressions.</p>
<h2 class="mume-header" id="the-operator">The * operator</h2>

<p>The <code>*</code> operator is known as the <strong>Kleene Star</strong>, one of the <a href="https://regexone.com/lesson/kleene_operators">Kleene operators</a>.<br>
You use the Kleene Star operator to match any number, <strong>zero or more</strong>, of the<br>
character it follows.</p>
<p>For example, take the following regular expression patterns and compare them<br>
with the strings below:</p>
<h4 class="mume-header" id="example-1-xyz">Example 1: <code>xy*z</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>xxz
xyyyzzz
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>yyy
xyxz
</code></pre><h4 class="mume-header" id="example-2-xyz">Example 2: <code>x*yz</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>xxyz
yyyzzz
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>xxx
xyyz
</code></pre><h4 class="mume-header" id="example-3-xyz">Example 3: <code>xyz*</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>xy
xxyzzz
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>zzz
xyyz
</code></pre><h2 class="mume-header" id="the-operator-1">The ? operator</h2>

<p>The question mark operator denotes that the character preceding <code>?</code> is an<br>
<a href="https://regexone.com/lesson/optional_characters">optional character</a>. Note that when you want to use a normal question mark as a<br>
normal character and NOT as a regular expression operator, you need to escape<br>
the character with a forward slash like <code>\?</code>.</p>
<p>Take the following pattern and compare it with the strings below. Notice how<br>
the <code>s?</code> portion of the expression makes the &quot;s&quot; character optional, allowing<br>
the pattern to match both &quot;video&quot; and &quot;videos&quot;.</p>
<h4 class="mume-header" id="example-1-videos">Example 1: <code>videos?</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>cat video
dog videos
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>bird vids
hedgehog vides
</code></pre><h4 class="mume-header" id="example-2-videos">Example 2: <code>videos\?</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>dog videos?
videos? hello?
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>cat video
videos
</code></pre><p>Note different effect of the regular expression with an escaped question mark<br>
verses a non-escaped question mark.</p>
<h4 class="mume-header" id="example-3-videos-watched">Example 3: <code>videos? watched\?</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>dog video watched?
cat videos watched?
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>bird video watched
hedgehog videos not watched
</code></pre><h2 class="mume-header" id="the-operator-2">The + operator</h2>

<p>The <code>+</code> operator is known as the <strong>Kleene Star Plus</strong>. You use Kleene Star Plus<br>
to match <strong>one or more</strong> of the character it follows, instead of <strong>zero or more</strong><br>
like the Kleene Star.</p>
<p>For example, take the following regular expression patterns and strings below:</p>
<h4 class="mume-header" id="example-1-xyz-1">Example 1: <code>xy+z</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>xyyyzzz
xxxyzz
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>xxz
xyxz
</code></pre><p>Note how &quot;xxz&quot; is matched by <code>xy*z</code> but not by <code>xy+z</code>.</p>
<h4 class="mume-header" id="example-2-xyz-1">Example 2: <code>x+yz</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>xyzzz
xxxyzz
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>yzz
xyyz
</code></pre><h4 class="mume-header" id="example-3-xyz-1">Example 3: <code>xyz+</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>xyzzz
xxyz
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>xy
xxy
</code></pre><h2 class="mume-header" id="the-operator-3">The . operator</h2>

<p>The dot operator matches any <strong>single</strong> character. It acts as a <a href="https://regexone.com/lesson/wildcards_dot">wildcard</a> that<br>
can match any single number, letter, symbol, or even whitespace. Like the<br>
question mark operator, in order to use <code>.</code> as a normal character instead of a<br>
regular expression operator, you need to escape the character with a forward<br>
slash (<code>\.</code>).</p>
<p>Take the example expressions and strings below:</p>
<h4 class="mume-header" id="example-1-a">Example 1: <code>..a..</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>12aa3
brains
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>123a4
catch
</code></pre><h4 class="mume-header" id="example-2-at">Example 2: <code>.at.</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>?att
catch
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>1a1t
atss
</code></pre><p>Remember that using a forward slash before a question mark in a regular<br>
expression escapes the question mark so that <code>?</code> is not interpreted as a<br>
regular expression operator.</p>
<h4 class="mume-header" id="example-3">Example 3: <code>...\?</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>123?
????
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>123
?cat
</code></pre><h2 class="mume-header" id="the-operator-without-brackets">The ^ operator without brackets</h2>

<p>The <code>^</code> operator is known as the hat operator. The hat operator can be used in<br>
two ways:</p>
<ul>
<li>Without square brackets to match the start of a line.</li>
<li>Within square brackets to denote when you want to exclude characters.</li>
</ul>
<p>When using <code>^</code> at the beginning of a regular expression pattern, you are<br>
indicating a match with statements that begin with the characters in your<br>
pattern. Note the case sensitivity in the examples below.</p>
<h4 class="mume-header" id="example-1-dog">Example 1: <code>^Dog</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Doggie daycare
Dog food
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>doG master
puppy Dog
</code></pre><h4 class="mume-header" id="example-2-dog">Example 2: <code>^dog</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>doggie
dogs
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>hotdog
small dog
</code></pre><h4 class="mume-header" id="example-3-1">Example 3: <code>^\?</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>? hello
???
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>hi?
\?bye
</code></pre><h2 class="mume-header" id="the-operator-4">The $ operator</h2>

<p>The dollar sign operator is used to define the end of a line. Like how the <code>^</code><br>
hat operator is used to specifically match the beginning characters of a line,<br>
the <code>$</code> dollar sign operator is used to specifically match the end of a line.</p>
<p>Take the following patterns and strings below:</p>
<h4 class="mume-header" id="example-1-smell">Example 1: <code>smell$</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>doggie smell
doggie has an interesting smell
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>doggie smells
doggie is smelling
</code></pre><h4 class="mume-header" id="example-2-dog-1">Example 2: <code>dog.$</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>sit, dog.
good dog!
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>sit, doggie
dogs.
</code></pre><p>In the example below, the hat and dollar sign operators are used together to<br>
create a pattern that matches the entire &quot;doggie smell&quot; string from beginning<br>
to end.</p>
<h4 class="mume-header" id="example-3-doggie-smell">Example 3: <code>^doggie smell$</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>doggie smell
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>big doggie smell
doggie has an interesting smell
doggie smells
</code></pre><h2 class="mume-header" id="the-bracket-expression">The [] bracket expression</h2>

<p>You use square brackets in regular expressions to match and include characters.<br>
You can do so by listing out specific characters or using an alphanumeric range.<br>
You can also use the square brackets in conjunction with a hat operator to<br>
exclude characters.</p>
<p>Take the following patterns that include characters in the strings below:</p>
<h4 class="mume-header" id="example-1-aein">Example 1: <code>[aei]n</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>ban
hen
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>undo
on
</code></pre><h4 class="mume-header" id="example-2-robot-0-9">Example 2: <code>robot [0-9]</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>robot 7
brobot 180
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>robots 7
robot seven
</code></pre><h4 class="mume-header" id="example-3-dw">Example 3: <code>\.[dw]</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>.whale
.dog
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>.cat
whale
</code></pre><h3 class="mume-header" id="the-inside-brackets">The - inside brackets</h3>

<p>You use the dash character to create <a href="https://regexone.com/lesson/character_ranges">character ranges</a> within square brackets.<br>
Multiple ranges can be set in the same square brackets. For example, the<br>
expression <code>[A-Za-z0-9_]</code> is often used to match all alphanumeric characters<br>
in the English language.</p>
<p>Take the following expressions and strings below:</p>
<h4 class="mume-header" id="example-1-0-5-cats">Example 1: <code>[0-5] cats</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>3 cats
33 cats
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>336 cats
3cats
</code></pre><h4 class="mume-header" id="example-2-a-dl-po-s">Example 2: <code>[A-D][l-p][o-s]</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Apple
Dose
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>apple
bone
</code></pre><h4 class="mume-header" id="example-3-a-z0-9a-z">Example 3: <code>[a-z][0-9][A-Z]</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>h4T
bl7XYZ
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>h44T
XYZ7bl
</code></pre><h3 class="mume-header" id="the-inside-brackets-1">The ^ inside brackets</h3>

<p>When using <code>^</code> inside of square brackets, you are denoting that you want to<br>
<a href="https://regexone.com/lesson/excluding_characters">exclude characters</a>. In order to exclude characters, you need to wrap the<br>
operator and the characters you want to exclude within square brackets.</p>
<h4 class="mume-header" id="example-1-b">Example 1: <code>[^b]</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>hog
dog
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>bog
blog
</code></pre><h4 class="mume-header" id="example-2-bcat">Example 2: <code>[^bc]at</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>chat
rat
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>hat
cat
</code></pre><h4 class="mume-header" id="example-3-bcog">Example 3: <code>[^bc]o[^g]</code></h4>

<p>Matches:</p>
<pre data-role="codeBlock" data-info class="language-"><code>hot
pot
</code></pre><p>Does not match:</p>
<pre data-role="codeBlock" data-info class="language-"><code>cog
blog
</code></pre><hr>
<h1 class="mume-header" id="regexone-practice">RegexOne Practice</h1>

<hr>
<p>Just like with Flexbox Froggy and CSS Grid Garden, there are Web sites on the<br>
Internet that really stand out as excellent resources from which to learn.<br>
<a href="https://regexone.com/">RegexOne</a> is one of those resources.</p>
<p>It is a set of simple interactive exercises to help you practice your new-found<br>
knowledge of regular expressions. Do all of the 15 exercises and eight problems.</p>
<p><img src="images/regexone-screenshot.png" alt="RegexOne home page"></p>
<hr>
<h1 class="mume-header" id="http-full-stack-project">HTTP Full-Stack Project</h1>

<p>In this project, you are going to use Node.js to build a data-driven Web site.<br>
This project already includes the Sequelize models and migrations for you. You<br>
will create a Node.js HTTP server and use it to handle incoming requests from a<br>
browser. Then, you will generate HTML to respond to the request.</p>
<p>Today&apos;s project does not address the aesthetics of the visual appearance of the<br>
Web pages. You will have an opportunity later this week to do that. Today is<br>
about <em>functionality</em>.</p>
<h2 class="mume-header" id="project-overview">Project overview</h2>

<p>You will build a simple inventory tracking system for managing the amount of<br>
stuff that you have. The Sequelize data model is already created for you because<br>
you now know how to do that pretty well. You&apos;ll get to flex those muscles later<br>
this week, too.</p>
<p>You will build the server that accepts incoming HTTP requests using <em>only</em><br>
functionality built into Node.js. You will process the incoming request,<br>
determine what needs to be done, and generate HTML to send back to the client.</p>
<p>This project shows you the underpinnings of how Node.js-based Web applications<br>
work. Then, when you use a framework like Express.js or Koa.js, you will know<br>
what they&apos;re doing.</p>
<p><img src="https://appacademy-open-assets.s3-us-west-1.amazonaws.com/Module-Web/http-fullstack/assets/http-fullstack-native-show-final-app.gif" alt="final app"></p>
<h3 class="mume-header" id="the-data-model">The data model</h3>

<p>To focus on the server portion of this, the data model is very simple. It<br>
consists of one entity, the Item. The Item has the following properties.</p>
<table>
<thead>
<tr>
<th>Property name</th>
<th>Data type</th>
<th>Constraints</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>string</td>
<td>not null, unique</td>
</tr>
<tr>
<td>description</td>
<td>text</td>
<td>not null</td>
</tr>
<tr>
<td>imageName</td>
<td colspan="2">string</td>

</tr>
<tr>
<td>amount</td>
<td>integer</td>
<td>not null, default 0</td>
</tr>
</tbody>
</table>
<h3 class="mume-header" id="the-functionality">The functionality</h3>

<p>You will create two HTML pages, one static and one dynamic. The static HTML page<br>
will consist of a form that allows you to add new items that you want to track.<br>
The dynamic HTML page will list the each item and its details and give you a<br>
way to reduce the amount on hand.</p>
<h2 class="mume-header" id="get-started">Get started</h2>

<ul>
<li>
<p>Clone the starter repository from<br>
<a href="https://github.com/appacademy-starters/node-web-app-starter">https://github.com/appacademy-starters/node-web-app-starter</a>. But, this time,<br>
use an extended version of the Git <code>clone</code> command to put it in a specific<br>
directory. You will use the same starter project in the next project, too.</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">git</span> clone https://github.com/appacademy-starters/node-web-app-starter native-node-app
</pre><p>Instead of creating a directory named after the repository,<br>
&quot;node-web-app-starter&quot;, this wil create a directory named &quot;native-node-app&quot;<br>
and put the cloned repository into there.</p>
</li>
<li>
<p>Change the working directory into &quot;native-node-app&quot;</p>
</li>
<li>
<p>Install the npm dependencies</p>
</li>
<li>
<p>Create a database user named &quot;native_node_app&quot; with the password<br>
&quot;oMbE4FNk3db2LwFT&quot; and the CREATEDB privilege which will look like</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">WITH</span> CREATEDB PASSWORD <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</pre><p>You add the CREATEDB in there so you can do the next step and not be bothered<br>
with creating the database yourself</p>
</li>
<li>
<p>Run the Sequelize CLI with the <code>db:create</code> command to create the database</p>
</li>
<li>
<p>Run the Sequelize CLI to migrate the database</p>
</li>
<li>
<p>Run the Sequelize CLI to seed the database</p>
</li>
</ul>
<h2 class="mume-header" id="phase-1-installing-one-tool">Phase 1: Installing one tool</h2>

<p>You will use a development tool to restart the server each time you make a<br>
change to a JavaScript file. This prevents you from having to hit CTRL+C each<br>
time you want to stop and start your server.</p>
<p>The tool is named <a href="https://nodemon.io/">nodemon</a> and is the standard for this type of server<br>
restarting. It is a <em>development</em> tool, so you will install it as a special kind<br>
of dependency, a <em>development dependency</em>. You can do that with</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> nodemon --save-dev
</pre><p>When you deploy your application to production, npm will ignore the development<br>
dependencies because they&apos;re not needed when you run your application for other<br>
people to use. Hopefully by that point, your Web application <em>doesn&apos;t restart</em>!</p>
<h2 class="mume-header" id="phase-2-getting-the-server-started">Phase 2: Getting the server started</h2>

<p>Open the <strong>package.json</strong> file. It specifies that the &quot;main&quot; file for this<br>
project is <strong>server/index.js</strong>. Create a <strong>server</strong> directory and an<br>
<strong>index.js</strong> file in there.</p>
<p>Now, in <strong>package.json</strong>, find the &quot;scripts&quot; section. Add a new entry in there<br>
named &quot;dev&quot; with the value &quot;nodemon server/index.js&quot;. It should look like this.</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon server/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</pre><p>That sets up a way to conveniently run the &quot;nodemon&quot; command by typing the<br>
command <code>npm run dev</code>. You can run that right now. Because you have an empty<br>
<strong>server/index.js</strong> file, it should report something like this:</p>
<pre data-role="codeBlock" data-info class="language-"><code>[nodemon] starting `node server/index.js server/index.js`
[nodemon] clean exit - waiting for changes before restart
</code></pre><p>So, it&apos;s just waiting for you to add some code!</p>
<p>To get an HTTP server up and running, you will add code to do the following in<br>
the <strong>server/index.js</strong> file.</p>
<ul>
<li>Import the built-in &quot;http&quot; module</li>
<li>Create a server using the &quot;http&quot; module that returns &quot;I have items&quot; to every<br>
request</li>
<li>Tell that server to start listening on port 8081</li>
<li>Print a message when the server is ready to accept incoming messages</li>
</ul>
<p>Please look at the sample on the <a href="https://nodejs.org/en/about/">About Node.js&#xAE;</a> page. It has all of the code<br>
that you need to get the above done. You&apos;ll want to change the port number from<br>
what it uses to 8081. You&apos;ll also want to change the text it sends to the<br>
browser from what it reads to &quot;I have items&quot;.</p>
<p>See if you can figure that out on your own. You&apos;ll know you&apos;re done when you<br>
open up your browser to <a href="http://localhost:8081/">http://localhost:8081/</a> (or refresh it because it&apos;s<br>
already there) and see the following.</p>
<p><img src="https://appacademy-open-assets.s3-us-west-1.amazonaws.com/Module-Web/http-fullstack/assets/http-fullstack-native-i-have-items.png" alt="I have items"></p>
<h2 class="mume-header" id="phase-3-understand-the-code">Phase 3: Understand the code</h2>

<p>Hopefully, your code looks similar to the following code.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;http&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">&apos;127.0.0.1&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;text/plain&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&apos;I have items&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Server running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Just a reminder: the first three variable declarations and the last call to<br>
<code>listen</code> are boilerplate code. Every time you write a Node.js server, you would<br>
write the same code over and over. The real meat of the application is in the<br>
callback function that you pass to <code>createServer</code>.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// The code here is what matters. This is the stuff</span>
  <span class="token comment">// that handles requests from the browser and sends</span>
  <span class="token comment">// content back to it.</span>
<span class="token punctuation">}</span>
</pre><p>The first parameter is the &quot;request&quot; object and is of type<br>
<code>http.IncomingMessage</code> (<a href="https://nodejs.org/api/http.html#http_class_http_incomingmessage">link</a>). The second parameter is<br>
the &quot;response&quot; object and is of type <code>http.ServerResponse</code> (<a href="https://nodejs.org/api/http.html#http_class_http_serverresponse">link</a>).</p>
<p>In the code that you wrote, you set the status code of the response to 200 which<br>
means &quot;OK&quot;, if you recall. Then, you set the content type of the content of the<br>
response to &quot;text/plain&quot; which means the browser should just show the content<br>
as plain text. Finally, you use the <code>end</code> method to send some content <em>and</em> end<br>
the response.</p>
<p>That last part is <em>very</em> important. If you don&apos;t end the response, the browser<br>
will just hang, waiting, expecting more from your server.</p>
<p>In this project, you will use more methods and properties of the<br>
<code>IncomingMessage</code> and <code>ServerResponse</code> objects to get your application working.</p>
<h2 class="mume-header" id="phase-4-showing-images">Phase 4: Showing images</h2>

<p>In the <strong>assets/images</strong> directory of this project are four images that your<br>
server should be able to show. (And more, if you add more.)</p>
<p>A normal thing to do is to translate a URL to a path relative to your<br>
application&apos;s root directory. For example, say you typed the following URL into<br>
your browser.</p>
<pre data-role="codeBlock" data-info class="language-"><code>http://localhost:8081/images/thread.jpeg
</code></pre><p>It would make sense to have the server send back the content of<br>
<strong>assets/images/thread.jpeg</strong> so the browser can show it. That&apos;s what you will<br>
do in this step, but for any of the images.</p>
<p>You&apos;ll need a way to read the contents of each file. The modern way to do this<br>
is to use the Promises-based portion of the file system library. At the top of<br>
your <strong>index.js</strong>, import the <code>readFile</code> function from the &quot;promises&quot; property<br>
of &quot;fs&quot; library.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;fs&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promises<span class="token punctuation">;</span>
</pre><p>You will use the <code>await</code> keyword with that function, so you need to change the<br>
signature of the callback method that you pass to the <code>createServer</code> method.<br>
Note the addition of the <code>async</code> keyword before the parameter list.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</pre><p>Again, you will map requests for images to the corresponding file in the<br>
<strong>images</strong> directory. It looks like this.</p>
<pre data-role="codeBlock" data-info class="language-"><code>http://localhost:8081/images/filename.ext
                     \__________________/
                              |
                 +------------+
          _______|_________
         /                 \
./assets/images/filename.ext
</code></pre><p>If the image exists, you&apos;ll send the contents of the image to the browser. If it<br>
does not, then you will tell the browser that it does not exist by sending a 404<br>
NOT FOUND status code.</p>
<h3 class="mume-header" id="phase-4a-the-happy-path">Phase 4a: The happy path</h3>

<p>To determine if the path is one that you want, at the top of your <code>async</code><br>
callback, put an if statement that tests if the <code>req.url</code> property (which is a<br>
string) starts with &quot;/images/&quot;. Replace the comment below to do that.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* req.url start with &quot;/images&quot; */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>


  res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;text/plain&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&apos;I have items&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>If the test passes, that means that <code>req.url</code> will contain a string like<br>
&quot;/images/thread.jpeg&quot;. That means that you will want to load the file from<br>
&quot;./assets/images/thread.jpeg&quot; which is the concatenation of the string<br>
&quot;./assets&quot; and the value of <code>req.url</code>. This code goes inside the <code>if</code> block.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> imageFilePath <span class="token operator">=</span> <span class="token string">&apos;./assets&apos;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
<span class="token keyword">const</span> imageFileContents <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span>imageFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice that you <strong>did not</strong> specify &apos;utf-8&apos; as part of the <code>readFile</code> call.<br>
That&apos;s because the content of an image file is <strong>not</strong> UTF-8 encoded text.<br>
Instead, it&apos;s binary. This way without the encoding just returns the raw data<br>
that is then sent to the browser.</p>
<p>After that, you need to should set the status code of the response to 200 to<br>
indicate everything is OK. Then, you need to set the content type which takes a<br>
little bit of figuring, so you can delay that for just a moment. Assume that the<br>
browser has requested an image in the JPEG format. Finally, you end the response<br>
by sending the data of the file that you read.</p>
<p>Add this code inside the <code>if</code> block after reading the file&apos;s contents.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;image/jpeg&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>imageFileContents<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span><span class="token punctuation">;</span>
</pre><p>The <code>return</code> at the end prevents any other code after it to run, that code at<br>
the bottom that sends back plain text.</p>
<p>You should now be able to see any of the following in your browser!</p>
<ul>
<li><a href="http://localhost:8081/images/thread.jpeg">http://localhost:8081/images/thread.jpeg</a></li>
<li><a href="http://localhost:8081/images/horseshoe.jpeg">http://localhost:8081/images/horseshoe.jpeg</a></li>
<li><a href="http://localhost:8081/images/lint.jpeg">http://localhost:8081/images/lint.jpeg</a></li>
</ul>
<p>Most likely, you can also see the following image, too.</p>
<ul>
<li><a href="http://localhost:8081/images/gravel.png">http://localhost:8081/images/gravel.png</a></li>
</ul>
<p>That&apos;s because browsers are really for giving. Even though you tell the browser<br>
that you are sending JPEG data with the content type &quot;image/jpeg&quot;, the browser<br>
inspects the data and figures out it&apos;s an image in the PNG format. But, you<br>
should not rely on the forgiveness of the browser. Instead, you should determine<br>
the type of image format the file contains from the file extension, either<br>
&quot;.jpeg&quot; or &quot;.png&quot;. Then, you send back &quot;image/jpeg&quot; or &quot;image/png&quot; based on the<br>
file extension.</p>
<p>You can use the built-in &quot;path&quot; library to determine the file extension. Then,<br>
you can use that information to send back the correct image format type in the<br>
<code>setHeader</code> method.</p>
<p>At the top of the <strong>index.js</strong> file, import the &quot;path&quot; library.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s a link to the &quot;path&quot; library: <a href="https://nodejs.org/api/path.html">https://nodejs.org/api/path.html</a>. Find the<br>
method that will extract the file extension from a path. Then, use that in<br>
your code to send back the correct image type.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> fileExtension <span class="token operator">=</span> <span class="token comment">/* Use the path library to get the file extension */</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> imageType <span class="token operator">=</span> <span class="token string">&apos;image/&apos;</span> <span class="token operator">+</span> fileExtension<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">,</span> imageType<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Use the image type</span>
</pre><p><img src="https://appacademy-open-assets.s3-us-west-1.amazonaws.com/Module-Web/http-fullstack/assets/http-fullstack-native-proper-image-type.png" alt="Proper image type"></p>
<p>Make sure you still see &quot;I have items&quot; when you go to <a href="http://localhost:8081">http://localhost:8081</a>.</p>
<h2 class="mume-header" id="phase-4b-no-image-found">Phase 4b: No image found</h2>

<p>Try accessing this URL: images/unknown.png. You will see<br>
an error message in your console about an unhandled promise rejection not being<br>
able to open &apos;./assets/images/unknown.png&apos;. Worse yet, the browser is just<br>
hanging. That&apos;s because this line of code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> imageFileContents <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span>imageFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>threw an error, it wasn&apos;t handled, and the <code>end</code> method never gets called on the<br>
response object. That means the browser just waits and waits and waits.</p>
<p>If you get a request for an image that does not exist, you can just catch this<br>
error and send back a 404 and no content. Replace that single line of code<br>
above with this block of code.</p>
<p>Wrap that line of code above in a <code>try</code>/<code>catch</code> block. In the <code>catch</code> block,<br>
set the status code of the response to 404. Then, just call the <code>end</code> method<br>
of the response with no parameters. The last statement of the <code>catch</code> block<br>
should be a <code>return;</code> statement to prevent other code from running after you<br>
handle this error.</p>
<p>You&apos;ll have to fix the declaration of the <code>imageFileContents</code> variable so that<br>
it works.</p>
<p>Refresh the browser. You should now get a 404 page when you try to access an<br>
image that does not exist. You should see the images that do exist when you go<br>
to their corresponding URLs.</p>
<p>Make sure you still see &quot;I have items&quot; when you go to <a href="http://localhost:8081">http://localhost:8081</a>.</p>
<h2 class="mume-header" id="phase-5-showing-a-static-html-page">Phase 5: Showing a static HTML page</h2>

<p>Here&apos;s some HTML that shows a form that you will use to add new items to the<br>
database. You will serve this statically. That means you won&apos;t change any of<br>
its contents. Instead, you&apos;ll just read the file from disk and send it to the<br>
browser.</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Add an item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Back to the main page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/items<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">required</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>description<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Description<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>description<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>description<span class="token punctuation">&quot;</span></span> <span class="token attr-name">required</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Starting amount<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">required</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Create a new item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</pre><p>You&apos;ll learn a lot more about forms, this week. There are three things to note<br>
about this form.</p>
<ul>
<li>The &quot;method&quot; attribute of the <code>form</code> element is &quot;post&quot; which means the value<br>
of <code>req.method</code> in our request handler will be &quot;POST&quot;. (It is always<br>
uppercase when read from the <code>req.method</code> property.)</li>
<li>The &quot;action&quot; attribute of the <code>form</code> element is &quot;/items&quot;. That will be the<br>
value of <code>req.url</code> that you will need to check when you want to handle the<br>
form submission.</li>
<li>The &quot;name&quot; attribute of the <code>input</code> and <code>textarea</code> (and all form elements) are<br>
the keys that we will use to get the values that a person supplies by typing<br>
into the form.</li>
</ul>
<p>Create a <strong>views</strong> directory in the root of your project. Save the HTML into a<br>
file there named <strong>add-item.html</strong>.</p>
<p><img src="images/http-fullstack-native-new-views-directory.png" alt="add-item.html in views directory"></p>
<p>To serve this HTML, create a new <code>if</code> block that checks to see if the value of<br>
the <code>req.url</code> property is equal to &quot;/items/new&quot;. If it is, then do what you did<br>
with the images. The path to the HTML file should be &quot;./views/add-item.html&quot;.<br>
Read the file&apos;s contents. Set the status code to 200. Set the content type to<br>
&quot;text/html&quot;. Send the content of the file to the browser and end the response.<br>
Use a <code>return;</code> statement to make sure no other code runs.</p>
<p>When you get that working, you should be able to navigate to<br>
<a href="http://localhost:8081/items/new">http://localhost:8081/items/new</a> and see this.</p>
<p><img src="images/http-fullstack-native-serving-static-form.png" alt="seeing form in the browser"></p>
<h2 class="mume-header" id="phase-6-first-step-in-dynamic-content">Phase 6: First step in dynamic content</h2>

<p>Navigate your browser back to <a href="http://localhost:8081">http://localhost:8081</a> where you see &quot;I have<br>
items&quot;. (If that&apos;s not working, figure out how it broke and fix it.) Now, you<br>
will query the database for the number of items in it and report it. Instead of<br>
seeing &quot;I have items&quot;, it should report something like &quot;I have 4 items&quot;.</p>
<p>This is primarily Sequelize code. At the top of <strong>index.js</strong>, import the Item<br>
model.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> Item <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Down at the bottom of your callback after your <code>if</code> blocks and before the line<br>
that reads <code>res.statusCode = 200;</code>, use the <code>findAll</code> method of the Item model<br>
to get all of the items in the database. That should return an array of the<br>
objects. Use the length of that array to show the current number of items in the<br>
database by changing <code>res.end(&apos;I have items&apos;);</code> to include the number of items.</p>
<p><img src="images/http-fullstack-native-show-number-of-items.png" alt="seeing number of items in the browser"></p>
<p>It may surprise you to learn that this is really what most Web applications do.<br>
Read some data from a database. Use that data to generate some content. Send<br>
the content to the browser. That&apos;s the simple recipe.</p>
<p>Do something real quick before the next phase. Instead of serving plain text,<br>
here, change that content type to serve HTML. Then, in whatever string you&apos;re<br>
passing to the <code>res.end</code> method, add this HTML snippet at the beginning of it so<br>
you can easily get to the &quot;add a new item&quot; form.</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/items/new<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Add a new item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</pre><p><img src="images/http-fullstack-native-with-link-to-add-form.png" alt="seeing number of items with a link"></p>
<p>Test the link by clicking on it. It should take you to the form.</p>
<h2 class="mume-header" id="phase-7-handling-the-adding-of-an-item">Phase 7: Handling the adding of an item</h2>

<p>Now&apos;s the time to handle the adding of an item from that form! Click the link<br>
to get to the add the form or navigate to <a href="http://localhost:8081/items/new">http://localhost:8081/items/new</a> in<br>
your browser. If you fill out the form and click the button, it just takes you<br>
back to the main page and doesn&apos;t do anything. It&apos;s time to change that.</p>
<p>Add a new <code>if</code> block that checks that <em>both</em> of these conditions are true:</p>
<ul>
<li>The value of <code>req.url</code> is equal to &quot;/items&quot;</li>
<li>The value of <code>req.method</code> is equal to &quot;POST&quot;</li>
</ul>
<p>Inside that <code>if</code> block is where you will handle the data that someone sends to<br>
the server through the form. You&apos;ll use it to create a new Item and save it to<br>
the database. Then, you&apos;ll redirect back to the main page.</p>
<h3 class="mume-header" id="phase-7a-getting-the-submitted-data">Phase 7a: Getting the submitted data</h3>

<p>Open up your developer tools. On the Network tab, click the &quot;Preserve log&quot;<br>
checkbox above the timeline. Then, fill out the form and click the &quot;Create a new<br>
item&quot; button. That will make the request. Select the &quot;items&quot; entry in the list<br>
of network requests below the timeline. You should see a section entitled<br>
<strong>Form Data</strong>. Click the &quot;view source&quot; link.</p>
<p><img src="images/http-fullstack-native-form-contents-with-urlencoded-request-body.png" alt="seeing the submitted data"></p>
<p>What you see is likely like this, but with whatever values you put in the<br>
fields.</p>
<pre data-role="codeBlock" data-info class="language-"><code>name=Shoe&amp;description=I+have+one+shoe+that+I+cant+seem+to+find+its+pair.+So%2C+I+guess+I+have+one+of+those.&amp;amount=1
</code></pre><p>That&apos;s the content that is sent with the HTTP request to your server. The full<br>
HTTP request looks something like</p>
<pre data-role="codeBlock" data-info class="language-"><code>POST /items HTTP/1.1
Host: localhost:8081
Content-Type: application/x-www-form-urlencoded
Content-Length: 116
... more headers ...

name=Shoe&amp;description=I+have+one+shoe+that+I+cant+seem+to+find+its+pair.+So%2C+I+guess+I+have+one+of+those.&amp;amount=1
</code></pre><p>That&apos;s the &quot;URL encoded&quot; format that you read about in the Five Parts Of A URL<br>
reading. You&apos;ll parse that in the next step. What you have to do, now, is get it<br>
from the <code>IncomingMessage</code> object. That object is a readable stream, so you will<br>
read the bytes from the stream and turn them into a string to use in the next<br>
step.</p>
<p>When your callback is invoked by the server object, it has <em>only</em> read the<br>
headers portion of the HTTP request. The body of the HTTP request (if there is<br>
one) could still be traveling over the airwaves and wires from your computer to<br>
the server. This way, your Web application can look at the values in the headers<br>
and determine whether or not it wants to even respond. Maybe the content length<br>
is 400Gb. You don&apos;t want your server spending however long it takes to read all<br>
of that data, so you can just end it.</p>
<p>To do this easily, you will use a variety of the <code>for</code> loop that works with<br>
asynchronous iterable values as well as normal one. It is the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of">for await...of</a><br>
loop. Like the <code>for of</code> loop, it loops over values rather than indexes. But, the<br>
value after the <code>of</code> can return Promises which the for loop will wait on for<br>
them to resolve before invoking the block of code.</p>
<p>That&apos;s a lot of words. Here&apos;s what it looks like. Put this in your <code>if</code> block<br>
that handles &quot;POST /items&quot;.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">let</span> body <span class="token operator">=</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">let</span> chunk <span class="token keyword">of</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  body <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// body now contains all of the data</span>
<span class="token comment">// from the request</span>
</pre><p>This works because <code>req</code> is an <code>IncomingMessage</code> message object which inherits<br>
from <code>ReadableStream</code> which implements the <a href="https://nodejs.org/api/stream.html#stream_readable_symbol_asynciterator">asynchronous iterator</a> property.</p>
<h3 class="mume-header" id="phase-7b-parsing-the-submitted-data">Phase 7b: Parsing the submitted data</h3>

<p>Now that you have all of the data in the <code>body</code> variable, it&apos;s time to split it<br>
up into the data that you want. From the form, it will look like this as a raw<br>
string:</p>
<pre data-role="codeBlock" data-info class="language-"><code>name=value1&amp;description=value2&amp;amount=value3
</code></pre><p>Use string manipulation to break that into its separate pieces so that you can<br>
access each of key value pairs.</p>
<ul>
<li>Split the string on ampersands, first.</li>
<li>Split each value from the previous step on equal signs.</li>
</ul>
<p>To handle the encoded values on the right side of the equal sign, it is a<br>
two-step process:</p>
<ul>
<li>Replace each of the &quot;+&quot; characters with a space. You have to use a global<br>
regular expression to do this with the <code>replace</code> method because JavaScript<br>
will only replace the first occurrence in the string without a global<br>
regular expression. If the value is in a variable named <code>s</code>, you would call<br>
<code>s.replace(/\+/g, &apos; &apos;)</code> to replace all of the &quot;+&apos; characters in a string with<br>
spaces.</li>
<li>After replacing the plusses, take the value and pass it to the<br>
<code>decodeURIComponent</code> function which will go about translating the percent-sign<br>
encoded values into single characters.</li>
</ul>
<h3 class="mume-header" id="phase-7c-create-an-item">Phase 7c: Create an Item</h3>

<p>You should have the data broken into pieces that you can now access. Use your<br>
Item model to build and save (or create) a new item.</p>
<h3 class="mume-header" id="phase-7d-redirect-the-browser">Phase 7d: Redirect the browser</h3>

<p>Redirecting the browser to go to another URL is a two-step process, too. You<br>
send back status code 302. You also set the header &quot;Location&quot; to the URL that<br>
you want it to navigate to. For this project, set the &quot;Location&quot; to &quot;/&quot;. Then<br>
end the response.</p>
<p><img src="https://appacademy-open-assets.s3-us-west-1.amazonaws.com/Module-Web/http-fullstack/assets/http-fullstack-native-show-form-completion.gif" alt="show form completion"></p>
<p>Make sure that you use a <code>return</code> statement or something to prevent the default<br>
code at the bottom of your request handler from running.</p>
<h2 class="mume-header" id="phase-8-generate-dynamic-content">Phase 8: Generate dynamic content</h2>

<p>At the bottom of your handler, you&apos;ve already queried the items in your Item<br>
objects from the database. Now, it is time to show the items rather than just<br>
displaying how many are in the database.</p>
<p>You can use the <code>write</code> method of the <code>ServerResponse</code> object in the <code>res</code> to<br>
write your HTML to the browser as you&apos;re generating it. Your code may look<br>
something like this.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> Item<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;text/html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
  &lt;div&gt;&lt;a href=&quot;/items/new&quot;&gt;Add a new item&lt;/a&gt;&lt;/div&gt;
  I have </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> items
`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Take a look at this code which just expands on the previous block. It writes the<br>
proper beginning of an HTML document, then writes the dynamic content, then ends<br>
it with the proper end of an HTML document.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> Item<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;text/html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
  &lt;!DOCTYPE html&gt;
  &lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Inventory&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;header&gt;
      &lt;div&gt;&lt;a href=&quot;/items/new&quot;&gt;Add a new item&lt;/a&gt;&lt;/div&gt;
    &lt;/header&gt;
    &lt;main&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`I have </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> items`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
    &lt;/main&gt;
  &lt;/body&gt;
  &lt;/html&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>In the place where there&apos;s only the one line of dynamic content, change it to<br>
have something else, something that shows the name of the item, the amount of<br>
them you have, and the associated image, if <code>imageName</code> is not <code>null</code> or<br>
<code>undefined</code>.</p>
<p>The following screenshot shows where an open <code>table</code> tag has been added to the<br>
end of the string for the first write, a close <code>table</code> tag has been added to the<br>
beginning of the string of the <code>res.end</code> call, and looping is used to create a<br>
new table row (<code>tr</code>) with table data (<code>td</code>) for each of the properties of the<br>
Item.</p>
<p><img src="https://appacademy-open-assets.s3-us-west-1.amazonaws.com/Module-Web/http-fullstack/assets/http-fullstack-native-show-table-of-items.png" alt="table of items"></p>
<p>It looks, in part, like this.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
    &lt;tr&gt;&lt;/td&gt;
  `</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Only write an IMG tag if there is a value</span>
  <span class="token comment">// in imageName</span>

  res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
    &lt;/td&gt;

    &lt;!-- Write more TDs here with the details of the item --&gt;

    &lt;td&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>amount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
      &lt;form method=&quot;post&quot; action=&quot;/items/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/used&quot;&gt;
        &lt;button type=&quot;submit&quot;&gt;Use one&lt;/button&gt;
      &lt;/form&gt;
    `</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;/td&gt;
  &lt;/tr&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>As seen above, for each item, you should also create a form that has the<br>
following content for items with an amount greater than 0.</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/items/&#xAB;item id&#xBB;/used<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Use one<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</pre><p>That&apos;s the last handler that you&apos;ll write to complete the project!</p>
<h2 class="mume-header" id="phase-9">Phase 9</h2>

<p>When there is a POST request to the path &quot;/items/&#xAB;item id&#xBB;/used&quot;, you want to<br>
reduce the amount by 1 of the item specified by the &#xAB;item id&#xBB; in the path. Write<br>
another <code>if</code> block that handles that HTTP request. Parse the id from the path.<br>
Use that id to get the Item from the database. Reduce the amount by 1. Save the<br>
Item back to the database. Redirect back to &quot;/&quot;.</p>
<p><img src="https://appacademy-open-assets.s3-us-west-1.amazonaws.com/Module-Web/http-fullstack/assets/http-fullstack-native-show-final-app.gif" alt="final app"></p>
<h2 class="mume-header" id="complete">Complete!</h2>

<p>That was quite a ride! You created a full-stack Web application! You pulled data<br>
from a database to generate HTML. You sent the HTML to the browser. You handled<br>
requests, both GET and POST, from the browser to interact with and modify the<br>
data in the database. This is literally what Web developers do every single day.</p>
<p>Except with better tools. Tools like you learn about tomorrow.</p>
<hr>
<h1 class="mume-header undefined" id="week-11-day-2brhello-express">WEEK-11 DAY-2<br><em>Hello, Express!</em></h1>

<hr>
<h1 class="mume-header" id="express-learning-objectives">Express Learning Objectives</h1>

<p>Express is the <em>de facto</em> standard for building HTTP applications with Node.js.<br>
When you complete this lesson, you should be able to</p>
<ul>
<li>Send plain text responses for any HTTP request</li>
<li>Use pattern matching to match HTTP request paths to route handlers</li>
<li>Use the Pug template engine to generate HTML from Pug templates to send to the<br>
browser</li>
<li>Pass data to Pug templates to generate dynamic content</li>
<li>Use the <code>Router</code> class to modularize the definition of routes</li>
</ul>
<hr>
<h1 class="mume-header" id="pug-template-learning-objectives">Pug Template Learning Objectives</h1>

<p>Using Pug.js helps reduce the overall creation and maintenance of source code<br>
for HTML generation. It is one of many template engines supported by Express.js<br>
and remains one of the most popular. At the end of this lesson, you will be able<br>
to effectively use Pug.js to</p>
<ul>
<li>Declare HTML tags and their associated ids, classes, attributes, and content</li>
<li>Use conditional statements to determine whether or not to render a block</li>
<li>Use interpolation to mix static text and dynamic values in content and<br>
attributes</li>
<li>Use iteration to generate multiple blocks of HTML based on data provided to<br>
the template</li>
</ul>
<hr>
<h1 class="mume-header" id="moving-into-the-express-lane">Moving Into the Express Lane</h1>

<p>In an earlier lesson, you created a simple HTTP server using JavaScript and<br>
Node.js. That HTTP server, or web application, returned a simple response based<br>
upon the incoming request&apos;s URL (and HTTP method in one case). For example, a<br>
request to the URL <code>http://localhost:300/OK</code> returned a <code>200 OK</code> HTTP response<br>
status code.</p>
<p>Overall, this was easy to do using Node&apos;s native APIs, though the requirements<br>
were relatively straightforward. Using Node to create a web application with<br>
features commonly found in websites unfortunately requires a fair amount of<br>
boilerplate code (i.e. verbose, repetitive code). This can slow down and<br>
distract developers from working on more important tasks.</p>
<p>Enter Express, a popular Node.js framework for building web applications.<br>
Express aims to make common web development tasks easier to implement by<br>
reducing the amount of boilerplate code you need to write. This allows you to<br>
focus on the things that makes your web application special. At the same time,<br>
Express is, in its own words, unopinionated and minimalistic, giving you the<br>
flexibility to decide what&apos;s best for your situation.</p>
<p>As an introduction to Express, let&apos;s create a simple web application. Your<br>
application will return a plain text response containing &quot;Hello from Express!&quot;<br>
for any request to <code>http://localhost:8081/</code>.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Use the <code>express()</code> function to create an Express application;</li>
<li>Recall that routing is determining how an application responds to a client<br>
request to a specific URI (or path) and HTTP method combination;</li>
<li>Use the Application <code>get()</code> method to define a route that handles <code>GET</code><br>
requests;</li>
<li>Use the Response object <code>res.send()</code> method to send a plain text response to a<br>
client; and</li>
<li>Use the <code>app.listen()</code> method to start a server listening for HTTP connections<br>
on a specific port.</li>
</ul>
<h2 class="mume-header" id="installing-express">Installing Express</h2>

<p>Before you can use Express to create a web application, you need to install it<br>
using npm. Open a terminal or command prompt window, browse to your project&apos;s<br>
folder, and initialize npm by running the following command:</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm init -y
</code></pre><p>You&apos;ll now have <code>package.json</code> and <code>package-lock.json</code> files in the root of your<br>
project. The <code>package.json</code> file keeps track of your application&apos;s<br>
dependencies&#x2014;npm packages that your application needs to successfully start and<br>
run.</p>
<p>Run the following command to install Express 4.0:</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm install express@^4.0.0
</code></pre><p>The <code>package.json</code> file will now list Express as a dependency:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
 <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-project-folder-name&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.1&quot;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>At the time of this writing, the latest version of Express 4.0 is <code>4.17.1</code>.<br>
While newer minor or patch versions of Express 4.0 should work fine, newer<br>
major versions (5.0+) might not work as expected. The caret character (<code>^</code>)<br>
the precedes the version number in the <code>package.json</code> file (<code>^4.17.1</code>)<br>
instructs npm to allow versions greater than <code>4.17.1</code> and less than <code>5.0.0</code>.</p>
</blockquote>
<h3 class="mume-header" id="git-and-the-node_modules-folder">Git and the <code>node_modules</code> folder</h3>

<p>In an earlier lesson, you learned that when using <code>npm install</code> to install an<br>
npm package locally into your project, npm downloads and installs the specified<br>
package to the <code>node_modules</code> folder. Over time, as you install dependencies,<br>
the <code>node_modules</code> folder tends to grow to be very large, containing many<br>
folders and files.</p>
<p>If you&apos;re using Git for source control, it&apos;s important to add a <code>.gitignore</code><br>
file to the root of your project and add the entry <code>node_modules/</code> so that the<br>
<code>node_modules</code> folder won&apos;t be tracked by Git.</p>
<blockquote>
<p>As alternative to creating your own <code>.gitignore</code> file, you can use GitHub&apos;s<br>
comprehensive <a href="https://github.com/github/gitignore/blob/master/Node.gitignore"><code>.gitignore</code> file for Node.js projects</a>.</p>
</blockquote>
<h2 class="mume-header" id="creating-an-express-application">Creating an Express application</h2>

<p>Now you&apos;re ready to create your Express application!</p>
<p>Add a file named <code>app.js</code> to your project folder and open it in your code<br>
editor. Use the <code>require</code> directive to import the <code>express</code> module and assign it<br>
to a variable named <code>express</code>. The <code>express</code> variable references a function<br>
(exported by the <code>express</code> module) that you can call to create an Express<br>
application. Assign the return value from the <code>express</code> function call to a<br>
variable named <code>app</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>app</code> variable holds a reference to an Express Application (<code>app</code>) object.<br>
You&apos;ll call methods on the <code>app</code> object as you build out your web application.</p>
<h2 class="mume-header" id="handling-requests">Handling requests</h2>

<p>Next, you need to configure the routing for your application.</p>
<p>The process of configuring routing is determining how an application should<br>
respond to a client request to an endpoint&#x2014;a  specific URI (or path) and HTTP<br>
method combination. For example, when a client makes a <code>GET</code> request to your<br>
application by browsing to the URL <code>http://localhost:8081/</code>, it should return<br>
the plain text response &quot;Hello from Express!&quot;.</p>
<blockquote>
<p><strong>Do you remember the parts of a URL?</strong> In the URL <code>http://localhost:8081/</code>,<br>
the protocol is <code>http</code>, the domain is <code>localhost</code>, the port is <code>8081</code> (we&apos;ll<br>
see in a bit how to configure the port for your application), and the path is<br>
<code>/</code>.</p>
</blockquote>
<p>The Express Application (<code>app</code>) object contains a collection of methods for<br>
defining an application&apos;s routes:</p>
<ul>
<li><code>get()</code> - to handle <code>GET</code> requests</li>
<li><code>post()</code> - to handle <code>POST</code> requests</li>
<li><code>put()</code> - to handle <code>PUT</code> requests</li>
<li><code>delete()</code> - to handle <code>DELETE</code> requests</li>
</ul>
<p><code>GET</code> and <code>POST</code> are two of the most commonly used HTTP methods, followed by<br>
<code>PUT</code> and <code>DELETE</code>.</p>
<blockquote>
<p>See the Express documentation for a <a href="https://expressjs.com/en/4x/api.html#routing-methods">complete list of the available routing<br>
methods</a>.</p>
</blockquote>
<p>To define a route to handle <code>GET</code> requests, call the <code>app.get()</code> method passing<br>
in the route path and a route handler function:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO Send a response back to the client.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Express provides a lot of flexibility with the format of the route path. A route<br>
path can be a string, string pattern, regular expression, or an array containing<br>
any combination of those. For now, you&apos;ll just use a string, but in later<br>
articles you&apos;ll see how to use the other options.</p>
<p>The route handler function is called by Express whenever an incoming request<br>
matches the route. The function defines two parameters, <code>req</code> and <code>res</code>, giving<br>
you access respectively to the Request and Response objects. The Request (<code>req</code>)<br>
object is used to get information about the client request that&apos;s currently<br>
being processed. The Response (<code>res</code>) object is used to prepare a response to<br>
return to the client.</p>
<p>To send a plain text response to the client, call the <code>res.send()</code> method<br>
passing in the desired content:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from Express!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s the code for your application so far:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from Express!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="listening-for-http-connections">Listening for HTTP connections</h2>

<p>Great job so far! Now you need to start the server listening for HTTP<br>
connections from clients. To do that, call the <code>app.listen()</code> method passing in<br>
the desired port to use and an optional callback function:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The callback function will be called when the server has started listening for<br>
connections. Logging a message to the console gives you an easy way to see when<br>
the server is ready for testing.</p>
<p>Here&apos;s the complete code for your application:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from Express!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="testing-your-application">Testing your application</h2>

<p>To test your application, open a terminal or command prompt window, browse to<br>
your project&apos;s folder, and run the following command:</p>
<pre data-role="codeBlock" data-info class="language-"><code>node app.js
</code></pre><p>If your application starts successfully, you&apos;ll see the text &quot;Listening on port<br>
8081&#x2026;&quot; displayed in the terminal or command prompt window. Next, open a web<br>
browser and browse to the address <code>http://localhost:8081/</code>. You should see the<br>
text &quot;Hello from Express!&quot; displayed in the browser.</p>
<p>If you see the expected text, congrats! If you don&apos;t, double check the<br>
following:</p>
<ul>
<li>Make sure that you started your application by running the command <code>node app.js</code>.</li>
<li>Double check that the URL you entered into your browser&apos;s address bar is<br>
<code>http://localhost:8081/</code>.</li>
<li>Check the terminal or command prompt window to see if an error is occurring.</li>
</ul>
<h2 class="mume-header" id="what-you-learned">What you learned</h2>

<p>In this article, you learned</p>
<ul>
<li>how to use the <code>express()</code> function to create an Express application;</li>
<li>that routing is determining how an application responds to a client request to<br>
a specific URI (or path) and HTTP method combination;</li>
<li>how to use the Application <code>get()</code> method to define a route that handles <code>GET</code><br>
requests;</li>
<li>how to use the Response object <code>res.send()</code> method to send a plain text<br>
response to a client; and</li>
<li>how to use the <code>app.listen()</code> method to start a server listening for HTTP<br>
connections on a specific port.</li>
</ul>
<h2 class="mume-header" id="see-also">See also&#x2026;</h2>

<p>As you learn about Express, you&apos;ll find it helpful to explore Express&apos; official<br>
documentation at <a href="https://expressjs.com/">expressjs.com</a>.</p>
<hr>
<h1 class="mume-header" id="templating-meet-pug">Templating - <em>Meet Pug!</em></h1>

<p>In a previous article, you learned how to use the Response object&apos;s <code>res.send()</code><br>
method to send a plain text response to the client. Sending plain text is, well,<br>
plain! A much more common content format when sending a response to browser<br>
clients is HTML.</p>
<p>You <strong>could</strong> use the <code>res.send()</code> method to send a string of HTML content to<br>
the client:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;&lt;title&gt;Welcome&lt;/head&gt;&lt;/title&gt;
      &lt;body&gt;
        &lt;h1&gt;Hello from Express!&lt;/h1&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  `</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>While it works, using this technique is tedious and prone to errors. Can you<br>
spot the error in the above HTML (hint: look at the nesting of the HTML<br>
elements)?</p>
<p>Luckily, there&apos;s a better way. Developers have used templates (files that<br>
contain markup and code) to render HTML content for many years (that&apos;s<br>
practically centuries in internet time!) Express integrates with many popular<br>
templating engines (libraries that provide support for writing templates). In<br>
this article you&apos;ll learn how to use the popular Pug templating engine to<br>
render HTML content.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Create a Pug template that contains one or more variables;</li>
<li>Use the <code>app.set()</code> method and the <code>view engine</code> application setting property<br>
to configure Express to use the Pug template engine; and</li>
<li>Use the Response object <code>res.render()</code> method to render a Pug template to send<br>
an HTML response to a client.</li>
</ul>
<h2 class="mume-header" id="what-is-a-template">What is a template?</h2>

<p>A template allows developers to easily combine static and dynamic content.<br>
Templates are typically written using a special, proprietary syntax to make it<br>
as easy as possible for developers to create content. Here&apos;s an example of a<br>
simple Pug template:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span> <span class="token plain-text">Welcome</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span> <span class="token plain-text">Welcome #{username}!</span>
</pre><p>Notice the lack of angle brackets (i.e. <code>&lt;</code> and <code>&gt;</code>) in this example on the<br>
<code>html</code>, <code>head</code>, <code>title</code>, <code>body</code>, and <code>h1</code> elements.</p>
<p>You also don&apos;t have to close elements. Pug will take care of that for you. It<br>
uses indents to determine which elements are children of other elements. In the<br>
above example, <code>head</code> is a child of <code>html</code> because <code>head</code> is indented more than<br>
<code>html</code>. When Pug turns that into HTML, it will place the <code>&lt;head&gt;...&lt;/head&gt;</code><br>
element <em>inside</em> the <code>&lt;html&gt;...&lt;/html&gt;</code> element. Look at all the typing that Pug<br>
has saved you!</p>
<p>Element content is provided just to the right of the element name. The content<br>
for the <code>title</code> element is &quot;Welcome&quot; and the content for the <code>h1</code> element is<br>
&quot;Welcome #{username}!&quot;.</p>
<p>At runtime, the templating engine combines data (often retrieved from a<br>
database) with a template to render the content for the response to return to<br>
the client. In the above template, Pug will replace the text <code>#{username}</code> with<br>
the <code>username</code> variable value that you give it when you tell express to render<br>
that template. Assuming that the <code>username</code> variable is set to the value<br>
<code>mycoolusername</code>, Pug would render the following HTML:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Welcome<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Welcome mycoolusername!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</pre><blockquote>
<p>Pug, by default, removes indentation and all whitespace between elements.<br>
In some rare cases you might need to manually control how whitespace<br>
is handled. For information on how to do this, see the <a href="https://pugjs.org/language/plain-text.html#whitespace-control">official Pug<br>
documentation</a>.</p>
</blockquote>
<h2 class="mume-header" id="rendering-a-simple-template">Rendering a simple template</h2>

<p>Before we further explore Pug&apos;s template syntax, let&apos;s see how to use Express to<br>
render a simple template to send a response to a client.</p>
<h3 class="mume-header" id="setting-up-the-project">Setting up the project</h3>

<p>Create a folder for your project, open a terminal or command prompt window,<br>
browse to your project&apos;s folder, and initialize npm. (You use the <code>-y</code> flag so<br>
that you don&apos;t have to answer those annoying questions. <code>npm</code> will just use<br>
default values for everything.)</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm init -y
</code></pre><p>Then install Express using <code>npm</code>.</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm install express
</code></pre><p>Now you&apos;re ready to create the application. Add a file named <code>app.js</code> to your<br>
project folder. Import the <code>express</code> module and assign it to a variable named<br>
<code>express</code>, then call the <code>express</code> function and assign the return value to a<br>
variable named <code>app</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>In the previous article, you used the <code>app.get()</code> method to define a route for<br>
handling <code>GET</code> requests. As an alternative to the <code>app.get()</code> method, Express<br>
provides a method named <code>all()</code> that can be used to define a route that handles<br>
any HTTP method.</p>
<p>Call the <code>app.all()</code> method, passing in an asterisk (<code>*</code>) for the route path and<br>
a route handler function that calls the <code>res.send()</code> method to send a plain text<br>
response to the client:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from the Pug template example app!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Remember that the route handler function is called by Express whenever an<br>
incoming request matches the route. The function defines two parameters, <code>req</code><br>
and <code>res</code>, giving you access respectively to the Request and Response objects.</p>
<p>The asterisk (<code>*</code>) in the route path is a wildcard character that will match any<br>
number of characters in the incoming request&apos;s URL path (e.g. <code>/</code>, <code>/about</code>,<br>
<code>/about/foo</code>, and so on). Combining this route path with the <code>get.all()</code> method<br>
defines a route that will match any incoming request, regardless of its path or<br>
HTTP method.</p>
<blockquote>
<p>This approach is unorthodox and not commonly seen in real world applications.<br>
Generally speaking, you should prefer to use the <code>app</code> methods that map to<br>
individual HTTP methods. We&apos;re using the <code>app.all()</code> in this article to<br>
demonstrate the flexibility that Express provides when defining routes.</p>
</blockquote>
<p>When a route can match any incoming request it can be helpful to know the<br>
current request&apos;s method and path. The Request object passed into the route<br>
handler function via the <code>req</code> parameter provides information about the incoming<br>
request. You can log two Request object properties in particular, <code>req.method</code><br>
and <code>req.path</code>, to the console to see the current request&apos;s method and path:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request method: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from the Pug template example app!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>The Express Request and Response objects provide a number of helpful<br>
properties and methods for working with HTTP requests and responses. To learn<br>
more, see the official Express docs for the <a href="https://expressjs.com/en/4x/api.html#req">Request</a> and<br>
<a href="https://expressjs.com/en/4x/api.html#res">Response</a> objects.</p>
</blockquote>
<p>Now start the server listening for HTTP connections by calling the<br>
<code>app.listen()</code> method:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s what the code for your application should look like at this point:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request method: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from the Pug template example app!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>To test your application, open a terminal, browse to your project&apos;s folder, and<br>
run the command:</p>
<pre data-role="codeBlock" data-info class="language-"><code>node app.js
</code></pre><p>The text &quot;Listening on port 8081&#x2026;&quot; should display in the terminal or command<br>
prompt window. Open a web browser and browse to the address<br>
<code>http://localhost:8081/</code> to confirm that the application sends a response<br>
containing the plain text &quot;Hello from the Pug template example app!&quot;.</p>
<h3 class="mume-header" id="creating-a-template">Creating a template</h3>

<p>Templates are stored in the <code>views</code> folder by default. To create a template, add<br>
a folder named <code>views</code> to your project, then add a file named <code>layout.pug</code><br>
containing the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span><span class="token punctuation">=</span><span class="token code"> title</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span><span class="token punctuation">=</span><span class="token code"> heading</span>
</pre><p>The assignment operator (<code>=</code>) following the <code>title</code> and <code>h1</code> element names<br>
instructs Pug to set the content for those elements respectively to the <code>title</code><br>
and <code>heading</code> variables.</p>
<blockquote>
<p>You&apos;ll learn more about how to render data in a Pug template in a later<br>
article.</p>
</blockquote>
<h3 class="mume-header" id="configuring-express-to-use-a-template-engine">Configuring Express to use a template engine</h3>

<p>Before you can use the Pug template engine in an Express application, you need<br>
to install it:</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm install pug@^2.0.0
</code></pre><p>To configure Express to use Pug as its default template engine, call the<br>
<code>app.set()</code> method and set the <code>view engine</code> application setting property to the<br>
value <code>pug</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>The <code>view engine</code> property is just one of the available application settings.<br>
For a list of available settings see the <a href="https://expressjs.com/en/4x/api.html#app.settings.table">Express documentation</a>.</p>
</blockquote>
<p>Setting the <code>view engine</code> application setting property isn&apos;t required, but it<br>
has the following benefits:</p>
<ol>
<li>It makes it clearer to code reviewers that your application is using the Pug<br>
template engine; and</li>
<li>You don&apos;t have to supply the file extension of the template when rendering a<br>
template (we&apos;ll see how this works next).</li>
</ol>
<h3 class="mume-header" id="rendering-a-template">Rendering a template</h3>

<p>Now you&apos;re ready to update your application to use your template. Update your<br>
route handler function to call the Response object&apos;s <code>res.render()</code> method,<br>
passing in the name of the template:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request method: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;layout&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>At this point, if run and test your application, you won&apos;t see any content<br>
displayed in the browser.</p>
<blockquote>
<p>If you left your application running in the terminal or command prompt window,<br>
you&apos;ll need to stop and restart it so that Node picks up your latest code<br>
changes. To do that, press <code>CTRL+C</code> to stop the application and run <code>node app.js</code> to restart the application.</p>
</blockquote>
<p>If you view the source for the page in the browser, you&apos;ll see the following<br>
HTML:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</pre><p>Notice that the <code>title</code> and <code>h1</code> elements don&apos;t have any content. The template<br>
expects data for the <code>title</code> and <code>heading</code> variables, but you&apos;re currently not<br>
passing any data. To fix that, pass an object literal containing <code>title</code> and<br>
<code>heading</code> properties as a second argument to the <code>res.render()</code> method call:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request method: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> pageData <span class="token operator">=</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Welcome&apos;</span><span class="token punctuation">,</span> heading<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;layout&apos;</span><span class="token punctuation">,</span> pageData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now if run and test your application, you should see the expected content<br>
displayed in the browser.</p>
<p>Here&apos;s what the code for your application should look like after updating it to<br>
render the Pug template:</p>
<p><strong>app.js</strong></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request method: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> pageData <span class="token operator">=</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Welcome&apos;</span><span class="token punctuation">,</span> heading<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;layout&apos;</span><span class="token punctuation">,</span> pageData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>views/layout.pug</strong></p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span><span class="token punctuation">=</span><span class="token code"> title</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span><span class="token punctuation">=</span><span class="token code"> heading</span>
</pre><h2 class="mume-header" id="what-you-learned-1">What you learned</h2>

<p>In this article, you learned</p>
<ul>
<li>how to create a Pug template that contains one or more variables;</li>
<li>how to use the <code>app.set()</code> method and the <code>view engine</code> application setting<br>
property to configure Express to use the Pug template engine; and</li>
<li>how to use the Response object <code>res.render()</code> method to render a Pug template<br>
to send an HTML response to a client.</li>
</ul>
<hr>
<h1 class="mume-header" id="digging-into-the-pug-template-syntax">Digging Into the Pug Template Syntax</h1>

<p>Now that you&apos;ve seen how to create and render a simple Pug template, let&apos;s<br>
explore Pug&apos;s syntax in more depth. Learning Pug&apos;s syntax takes time and effort,<br>
but the payoff is that writing and maintaining templates will generally take<br>
less time overall.</p>
<p>When you finish this article, you should be able to use the Pug template syntax<br>
to:</p>
<ul>
<li>Render elements;</li>
<li>Set element attribute values;</li>
<li>Set element class and ID attribute values;</li>
<li>Set element content from a variable;</li>
<li>Set an element attribute value from a variable;</li>
<li>Inject a variable value into text using interpolation;</li>
<li>Iterate the elements in an array to generate content; and</li>
<li>Conditionally display content.</li>
</ul>
<h2 class="mume-header" id="setting-up-a-sandbox-application">Setting up a sandbox application</h2>

<blockquote>
<p><strong>Exercise your brain!</strong> Use the following application as a sandbox to test<br>
and experiment with the Pug syntax as it&apos;s introduced in this article. Doing<br>
this will help you to remember what you&apos;ve learned.</p>
</blockquote>
<p>Create a folder for your project, open a terminal or command prompt window,<br>
browse to your project&apos;s folder, and initialize npm:</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm init -y
</code></pre><p>Then install Express 4.0 and Pug 2:</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm install express@^4.0.0 pug@^2.0.0
</code></pre><p>Add a folder named <code>views</code> to your project, then add a file named <code>layout.pug</code><br>
containing the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span><span class="token punctuation">=</span><span class="token code"> title</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span><span class="token punctuation">=</span><span class="token code"> heading</span>
</pre><p>Then add a file named <code>app.js</code> to your project folder containing the following<br>
code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request method: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;layout&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Pug Template Syntax Sandbox&apos;</span><span class="token punctuation">,</span> heading<span class="token punctuation">:</span> <span class="token string">&apos;Welcome to the Sandbox!&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>To test your application, open a terminal or command prompt window, browse to<br>
your project&apos;s folder, and run the command:</p>
<pre data-role="codeBlock" data-info class="language-"><code>node app.js
</code></pre><p>The text &quot;Listening on port 8081&#x2026;&quot; should display in the terminal or command<br>
prompt window. Open a web browser and browse to the address<br>
<code>http://localhost:8081/</code> to confirm that the application sends a response that<br>
displays an HTML <code>&lt;h1&gt;</code> element containing the text &quot;Welcome to the Sandbox!&quot;.</p>
<h2 class="mume-header" id="rendering-elements">Rendering elements</h2>

<p>Consider the following excerpt from a Pug template:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">ul</span>
  <span class="token tag">li</span> <span class="token plain-text">Item A</span>
  <span class="token tag">li</span> <span class="token plain-text">Item B</span>
  <span class="token tag">li</span> <span class="token plain-text">Item C</span>
</pre><p>This renders an HTML unordered list:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Item A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Item B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Item C<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</pre><p>Text at the beginning of a line (with or without white space) represents an HTML<br>
element. Any text included after the element name will be added as the element&apos;s<br>
inner text. To add an element as a child element, simply indent the line for the<br>
child element by one or more spaces (two spaces is a common convention).</p>
<blockquote>
<p>Whether you decide to use two or four spaces for indenting elements, it&apos;s<br>
important to keep your indentation consistent throughout the template. Not<br>
doing so might result in Pug throwing an error at runtime.</p>
</blockquote>
<h2 class="mume-header" id="setting-element-attribute-values">Setting element attribute values</h2>

<p>To set attribute values on an element, follow the element name with a pair of<br>
parentheses containing one or more attribute name/value pairs:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/about&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;menu-button&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">About</span>
</pre><p>Renders to:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/about<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu-button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>About<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</pre><h3 class="mume-header" id="setting-class-and-id-attribute-values">Setting <code>class</code> and <code>id</code> attribute values</h3>

<p>Element class and ID attributes are very common attributes to set, so Pug<br>
provides a shortcut syntax for each. You can set an element&apos;s <code>class</code> attribute<br>
using the syntax <code>.classname</code> and an element&apos;s <code>id</code> attribute using <code>#idname</code>:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">div#container</span>
  <span class="token tag">a.button</span> <span class="token plain-text">Cancel</span>
</pre><p>Renders to:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Cancel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</pre><p>You can also combine a class name with an ID name or chain multiple class names:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">div#container.main</span>
  <span class="token tag">a.button.large</span> <span class="token plain-text">Cancel</span>
</pre><p>Renders to:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>main<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button large<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Cancel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</pre><p>This example can be further condensed. <code>&lt;div&gt;</code> elements are so common, Pug<br>
allows you to remove the <code>&lt;div&gt;</code> element&apos;s name:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">#container.main</span>
  <span class="token tag">a.button.large</span> <span class="token plain-text">Cancel</span>
</pre><h2 class="mume-header" id="rendering-data">Rendering data</h2>

<p>As you saw in an earlier article, you can provide data to a template by passing<br>
an object to the <code>res.render()</code> method:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;layout&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">:</span> <span class="token string">&apos;Grace&apos;</span><span class="token punctuation">,</span> lastName<span class="token punctuation">:</span> <span class="token string">&apos;Hopper&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Properties on the object passed as the second argument to the <code>res.render()</code><br>
method are defined within a template as local variables, which can be used to<br>
set element content:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">ul</span>
  <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> firstName</span>
  <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> lastName</span>
</pre><p>Which would render to:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Grace<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Hopper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</pre><p>Variables can also be used to set element attribute values:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">form</span>
  <span class="token tag">div</span>
    <span class="token tag">label</span> <span class="token plain-text">First Name:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;firstName&apos;</span> value<span class="token operator">=</span>firstName</span><span class="token punctuation">)</span></span></span>
  <span class="token tag">div</span>
    <span class="token tag">label</span> <span class="token plain-text">Last Name:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;lastName&apos;</span> value<span class="token operator">=</span>lastName</span><span class="token punctuation">)</span></span></span>
</pre><p>Renders to:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>First Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>firstName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Grace<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>Last Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lastName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Hopper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</pre><p>You can also use interpolation to inject a variable value into text:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">p</span> <span class="token plain-text">Welcome #{firstName} #{lastName}!</span>
</pre><p>Renders to:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Welcome Grace Hopper!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</pre><blockquote>
<p>Notice how Pug&apos;s interpolation syntax <code>#{expression}</code> differs from<br>
JavaScript&apos;s string template literal interpolation syntax <code>${expression}</code>. In<br>
a Pug template, the text to the right of the element name is just plain text,<br>
not JavaScript.</p>
</blockquote>
<h2 class="mume-header" id="iteration-and-conditionals">Iteration and conditionals</h2>

<p>You can even use dynamic data to control the generation of HTML in your<br>
templates. Suppose you pass an array of colors to the <code>res.render()</code> method:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;layout&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&apos;Red&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;Green&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;Blue&apos;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Using that array of values, you can generate an ordered list:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">ul</span>
  <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> color <span class="token keyword">in</span></span> colors</span>
    <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> color</span>
</pre><p>Which renders as:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Red<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Green<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Blue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</pre><p>You can also conditionally display content. First, send a boolean value to the<br>
template that indicates if the current user is logged in or not:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;layout&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> userIsLoggedIn<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Then you can use that boolean variable to determine what content to display:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token flow-control"><span class="token branch keyword">if</span> userIsLoggedIn</span>
  <span class="token tag">h2</span> <span class="token plain-text">Welcome!</span>
<span class="token flow-control"><span class="token branch keyword">else</span></span>
  <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/login&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Please login</span>
</pre><p>If the <code>userIsLoggedIn</code> variable is <code>true</code> (indicating that the user has logged<br>
in) then the template would render:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Welcome!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
</pre><p>Otherwise the template would render:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/login<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Please login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</pre><h2 class="mume-header" id="what-you-learned-2">What you learned</h2>

<p>In this article, you learned how to</p>
<ul>
<li>render elements;</li>
<li>set element attribute values;</li>
<li>set element class and ID attribute values;</li>
<li>set element content from a variable;</li>
<li>set an element attribute value from a variable;</li>
<li>inject a variable value into text using interpolation;</li>
<li>iterate the elements in an array to generate content; and</li>
<li>conditionally display content.</li>
</ul>
<h2 class="mume-header" id="see-also-1">See also&#x2026;</h2>

<p>There&apos;s so much more that you can do with Pug! Be sure to take some time to<br>
explore <a href="https://pugjs.org/api/getting-started.html">Pug&apos;s documentation</a>.</p>
<hr>
<h1 class="mume-header" id="exploring-route-paths">Exploring Route Paths</h1>

<p>You&apos;ve seen that defining route paths in Express using a string is easy to do:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/about&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;About&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/contact&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Contact&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/our-team&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Our Team&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>You can also easily include child paths:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/our-team/sf&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Our Team - San Francisco&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/our-team/nyc&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Our Team - New York City&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>But what if you need to match multiple paths for a single resource? Having to<br>
define a route using a string route path for each variation is time consuming<br>
and difficult to maintain. In some cases, it might be impossible to spell out<br>
every possible variation. For example, what if the variable part of the path<br>
represents the ID of a database record to retrieve? Luckily, Express provides a<br>
wealth of options for defining route paths that you can use to solve virtually<br>
any routing challenge.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Recall that route parameters are named URL segments used to capture values;</li>
<li>Define a route whose path contains one or more route parameters;</li>
<li>Recall that a route path can be a string, string pattern, regular expression,<br>
or an array containing any combination of those;</li>
<li>Define a route path using a string pattern; and</li>
<li>Define a route path using a regular expression.</li>
</ul>
<h2 class="mume-header" id="getting-data-from-a-path">Getting data from a path</h2>

<p>Imagine that you&apos;re developing a website for the Best Company Ever. As a<br>
starting point, your project&apos;s <code>app.js</code> file contains the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// TODO Define routes.</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>To follow along, be sure to initialize npm in your project folder (<code>npm init -y</code>) and install Express (<code>npm install express@^4.0.0</code>). Use <code>node app.js</code> to<br>
run the server. Remember that if you leave the server running in the terminal<br>
or command prompt window while you&apos;re working, you&apos;ll need to stop and restart<br>
it so that Node picks up your latest code changes. To do that, press <code>CTRL+C</code><br>
to stop the server and run <code>node app.js</code> again to restart the server.</p>
</blockquote>
<p>You need to define your application&apos;s first route for a &quot;Product&quot; page that<br>
displays information about a product from the Best Company Ever&apos;s catalog. The<br>
product to display is variable&#x2014;meaning that it depends on the product ID that&apos;s<br>
passed via the URL path:</p>
<ul>
<li><code>/product/1</code> - displays information for the product whose database ID is <code>1</code>;</li>
<li><code>/product/2</code> - displays information for the product whose database ID is <code>2</code>;</li>
<li>and so on.</li>
</ul>
<p>Your initial thought is to use a query string parameter for the product ID (e.g.<br>
<code>/product?id=1</code>) instead of including it in the path. But after a bit of<br>
research, you <a href="https://www.google.com/search?q=query+string+parameters+and+search+engine+results">decide against that approach for SEO (search engine optimization)<br>
reasons</a>.</p>
<p>Defining routes using string based route paths for the first two products gives<br>
you something like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/product/1&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Product ID: 1&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/product/2&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Product ID: 2&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This works, but the Best Company Ever is very successful (of course they are&#x2026;<br>
they&apos;re the best company ever!) and they have over 1,000 products in their<br>
catalog. That means you have at least 998 routes left to define! Clearly, using<br>
string based route paths simply won&apos;t work. Also, you want to keep your code as<br>
DRY (don&apos;t repeat yourself!) as possible.</p>
<h3 class="mume-header" id="leveraging-route-parameters">Leveraging route parameters</h3>

<p>Express route parameters are specifically designed for this situation.</p>
<p>A path is divided into segments using forward slashes (<code>/</code>). For example, given<br>
the path <code>/locations/ca/search</code>, <code>locations</code>, <code>ca</code>, and <code>search</code> would all be<br>
segments. A route parameter is a named path segment that captures the value at<br>
that position in the path. The captured value is available within a route<br>
handler function via the <code>req.params</code> object.</p>
<p>Here&apos;s the &quot;Product&quot; page route defined using an <code>id</code> route parameter:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/product/:id&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Product ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Using this route definition, the following request URL paths all match:</p>
<ul>
<li><code>/product/1</code> - displays &quot;Product ID: 1&quot;</li>
<li><code>/product/2</code> - displays &quot;Product ID: 2&quot;</li>
<li><code>/product/asdf</code> - displays &quot;Product ID: asdf&quot;</li>
</ul>
<p>That&apos;s progress! But unfortunately, while <code>1</code> and <code>2</code> are valid product IDs, the<br>
string <code>asdf</code> is not.</p>
<h3 class="mume-header" id="restricting-route-parameter-matches">Restricting route parameter matches</h3>

<p>By default, a route parameter will match almost any character (exceptions<br>
include a question mark <code>?</code> which denotes the beginning of the query string and<br>
a slash <code>/</code> which marks the beginning of the next path segment). Given that,<br>
<code>1</code>, <code>2</code>, and <code>asdf</code> are all valid values.</p>
<p>You can use a regular expression to exert more control over which values will<br>
match. Regular expressions use a language agnostic syntax for matching string<br>
patterns. For example, a dot <code>.</code> represents any character in a regular<br>
expression, so the expression <code>c.t</code> can match <code>cat</code>, <code>cot</code>, or <code>cut</code>, but not<br>
<code>can</code> nor <code>bat</code>.</p>
<p>There are many other special characters that you can use to match specific<br>
string patterns:</p>
<ul>
<li>the special character <code>\d</code> matches a single digit (i.e. <code>0</code> through <code>9</code>); and</li>
<li>adding a plus sign <code>\d+</code> matches one or more digits.</li>
</ul>
<p>To apply a regular expression to a route parameter, place it in parentheses just<br>
after the route parameter name:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/product/:id(\\d+)&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Product ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now the route will only match URL paths that have a number in the route<br>
parameter&apos;s position:</p>
<ul>
<li><code>/product/1</code> - displays &quot;Product ID: 1&quot;</li>
<li><code>/product/2</code> - displays &quot;Product ID: 2&quot;</li>
<li><code>/product/asdf</code> - displays &quot;Cannot GET /product/asdf&quot; (404 Not Found)</li>
</ul>
<blockquote>
<p>The regular expression has an extra backslash <code>\</code> in the route path before<br>
<code>\d+</code> because the backslash character is used to escape special characters<br>
within a JavaScript string literal. For more information see the &quot;Escape<br>
notation&quot; section on the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">MDN Web Docs <code>String</code> page</a>.</p>
</blockquote>
<p>Now the route parameter only matches a numeric value in the URL path but the<br>
value via the <code>req.params</code> object is still a string. If you need the route<br>
parameter value as a number, you&apos;ll need to convert it:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/product/:id(\\d+)&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> productId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Product ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>productId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>For more information on the <code>parseInt()</code> function, see <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseInt">this page on MDN Web<br>
Docs</a>.</p>
</blockquote>
<h2 class="mume-header" id="defining-flexible-route-paths">Defining flexible route paths</h2>

<p>As you develop websites and web applications, you&apos;ll likely find that using a<br>
combination of strings and route parameters to define your routes will cover the<br>
majority of your use cases. Sometimes though, situations will come up that will<br>
require a different approach.</p>
<p>Your next task for the Best Company Ever website is to define a route for their<br>
&quot;Products&quot; page. After spending some time with the internal stakeholders for the<br>
project from the Sales, Marketing, and Customer Support departments, you&apos;ve<br>
determined that the following use cases and issues all need to be addressed:</p>
<ul>
<li>Marketing somehow managed to design and publish advertisements using both<br>
<code>www.bestcompanyever.com/products</code> and <code>www.bestcompanyever.com/our-products</code><br>
as the URLs for the same &quot;Products&quot; page.</li>
<li>Customer Support has noticed that sometimes customers forget the &quot;s&quot; at the<br>
end of &quot;products&quot; and get frustrated when they get a &quot;Page Not Found&quot; error<br>
trying to browse to the URL <code>www.bestcompanyever.com/product</code>.</li>
<li>Customer Support has also noticed that sometimes customers mistype the word<br>
&quot;products&quot; as &quot;prodcts&quot; or &quot;productts&quot;.</li>
<li>Sales would like to allow customers to use &quot;productos&quot; (Spanish for<br>
&quot;products&quot;) to make it as easy as possible for everyone to find the &quot;Products&quot;<br>
page.</li>
</ul>
<p>All of this translates into mapping the following paths to the &quot;Products&quot; page:</p>
<ul>
<li><code>/products</code></li>
<li><code>/our-products</code></li>
<li><code>/product</code></li>
<li><code>/prodcts</code></li>
<li><code>/productts</code></li>
<li><code>/productos</code></li>
</ul>
<p>Having to define a route for each of these paths would be less than ideal.<br>
Luckily, Express provides a number of options for defining route paths including<br>
using</p>
<ul>
<li>a string (this is what you&apos;ve been using up to this point);</li>
<li>a string pattern;</li>
<li>a regular expression; or</li>
<li>an array containing any combination of those.</li>
</ul>
<p>Let&apos;s use these options to develop a solution!</p>
<h3 class="mume-header" id="using-a-string-pattern">Using a string pattern</h3>

<p>Your first attempt at defining the route for the &quot;Products&quot; page looks like<br>
this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/products&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Currently, when running the application (<code>node app.js</code>) the only URL that<br>
returns the string &quot;Products&quot; is <code>http://localhost:8081/products</code> (i.e. the path<br>
<code>/products</code>). This makes sense, as our route&apos;s path is defined using the string<br>
<code>/products</code>.</p>
<p>You can use a string pattern to define a route path that will match more<br>
incoming request URL paths. The following characters, when used within a string<br>
based route path, behave somewhat like their regular expression counterparts:</p>
<ul>
<li>question mark <code>?</code> - specifies that the previous character can appear zero to<br>
one time</li>
<li>plus sign <code>+</code> - specifies that the previous character can appear one or more<br>
times</li>
<li>asterisk <code>*</code> - matches any number of characters (i.e. &quot;wildcard&quot; character)</li>
</ul>
<p>Looking at your route again, adding a question mark <code>?</code> after the <code>s</code> in the<br>
path <code>/products</code> specifies that the <code>s</code> can appear zero to one time:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/products?&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now your route will match the URL paths <code>/products</code> and <code>/product</code>.</p>
<p>After reviewing the list of paths that you need to match, you notice that you<br>
can add an additional question mark <code>?</code> after the <code>u</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/produ?cts?&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now both the <code>u</code> and the <code>s</code> are effectively optional, allowing the following<br>
URL paths to match:</p>
<ul>
<li><code>/products</code></li>
<li><code>/product</code></li>
<li><code>/prodcts</code></li>
</ul>
<p>Taking it a step further, you add a plus sign <code>+</code> after the <code>t</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/produ?ct+s?&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>That change allows one or more <code>t</code>s to appear in the URL path, allowing the<br>
following URL paths to match:</p>
<ul>
<li><code>/products</code></li>
<li><code>/product</code></li>
<li><code>/prodcts</code></li>
<li><code>/productts</code></li>
</ul>
<p>And now for the master stroke: you add an asterisk <code>*</code> in between the <code>/</code> and<br>
<code>p</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/*produ?ct+s?&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now all of the following URL paths match:</p>
<ul>
<li><code>/products</code></li>
<li><code>/product</code></li>
<li><code>/prodcts</code></li>
<li><code>/productts</code></li>
<li><code>/our-products</code></li>
</ul>
<p>Using string patterns to define route paths are useful but fairly limited in<br>
capability. For example, our string pattern based route path has the following<br>
deficiencies:</p>
<ul>
<li>The asterisk <code>*</code> matches the URL path <code>/our-products</code> but also literally<br>
anything else between the <code>/</code> and <code>p</code>, including <code>/cool-products</code>,<br>
<code>asdf-products</code>, and so on.</li>
<li>The plus sign <code>+</code> after the <code>t</code> matches <code>tt</code> but also <code>ttt</code>, <code>tttt</code>, and so<br>
on.</li>
</ul>
<p>Depending on your specific situation, these shortcomings might be something you<br>
can live with. If you can&apos;t, you can write a more sophisticated route path using<br>
a regular expression.</p>
<h3 class="mume-header" id="using-a-regular-expression">Using a regular expression</h3>

<p>When defining a route, Express allows you to define your route path using a<br>
regular expression. You can rewrite your original &quot;Products&quot; page route using a<br>
regular expression like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token regex">/^\/products\/?$/i</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>At this point, only the URL path <code>/products</code> will match.</p>
<p>Regular expressions can be difficult to read and understand. Here&apos;s a<br>
step-by-step breakdown, from left to right, of the above regular expression<br>
(don&apos;t worry about committing all of this regular expression syntax to memory;<br>
you&apos;ll have access to documentation when designing complex regular expression<br>
based routes):</p>
<ul>
<li><code>/</code> - Denotes the beginning of the regular expression.</li>
<li><code>^</code> - Indicates that the expression must match the beginning of the URL path<br>
string.</li>
<li><code>\/</code> - Matches a forward slash <code>/</code>. Because forward slashes have special<br>
meaning (they mark the beginning and ending of a regular expression) they must<br>
be escaped with a backslash <code>\</code>.</li>
<li><code>products</code> - Matches the literal string <code>products</code>.</li>
<li><code>\/?</code> - Matches zero or one instance of a forward slash <code>/</code>.
<ul>
<li>Since you&apos;re using the <code>^</code> and <code>$</code> characters to match the beginning and<br>
ending of the URL path string, you need to add an optional forward slash at<br>
the end of the expression in order to allow for URL paths that have a<br>
trailing forward slash.</li>
</ul>
</li>
<li><code>$</code> - Indicates that the expression must match the ending of the URL path<br>
string.</li>
<li><code>/</code> - Denotes the ending of the regular expression.</li>
<li><code>i</code> - Indicates that the regular expression is case-insensitive.</li>
</ul>
<blockquote>
<p>We&apos;re just scratching the surface of what&apos;s possible with regular expressions.<br>
For more information about regular expressions, see <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions">this page on MDN Web<br>
Docs</a>.</p>
</blockquote>
<p>Now let&apos;s work on extending the regular expression to match more URL paths.</p>
<p>Since the question mark <code>?</code> character behaves like it does within a string<br>
pattern, you can make the <code>u</code> and the <code>s</code> in <code>products</code> optional like you did<br>
before:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token regex">/^\/produ?cts?\/?$/i</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This allows the following URL paths to match:</p>
<ul>
<li><code>/products</code></li>
<li><code>/product</code></li>
<li><code>/prodcts</code></li>
</ul>
<p>Instead of using the plus sign <code>+</code> after the <code>t</code> to allow one or more <code>t</code>s to<br>
appear in the URL path, you can use a set of curly braces <code>{}</code> to specify the<br>
minimum and maximum number of instances:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token regex">/^\/produ?ct{1,2}s?\/?$/i</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now the following URL paths will match:</p>
<ul>
<li><code>/products</code></li>
<li><code>/product</code></li>
<li><code>/prodcts</code></li>
<li><code>/productts</code> (but not <code>/producttts</code>, <code>/productttts</code>, or so on)</li>
</ul>
<p>To match on the URL path <code>/our-products</code>, you can use a set of parentheses <code>()</code><br>
to define a capture group containing the string <code>our-</code> and follow the capture<br>
group with a question mark <code>?</code> to make it optional:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token regex">/^\/(our-)?produ?ct{1,2}s?\/?$/i</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>Capture groups are a powerful tool when writing regular expressions. In this<br>
example, you&apos;re simply using a capture group as a way to group the characters<br>
<code>our-</code> together so that the question mark <code>?</code> that follows the group will<br>
apply to the group as if it were a single character.</p>
</blockquote>
<p>Going one step further, you can add another capture group by wrapping<br>
<code>(our-)?produ?ct{1,2}s?</code> in another set of parentheses. Then, within the new<br>
capture group, append the text <code>|productos</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token regex">/^\/((our-)?produ?ct{1,2}s?|productos)\/?$/i</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The pipe character <code>|</code> is used to create a logical &quot;OR&quot; expression (i.e. &quot;this&quot;<br>
or &quot;that&quot;). Adding the pipe <code>|</code> within the new group specifies that the<br>
expression <code>(our-)?produ?ct{1,2}s?</code> or <code>productos</code> should match.</p>
<p>With this change in place, the following URL paths all match:</p>
<ul>
<li><code>/products</code></li>
<li><code>/product</code></li>
<li><code>/prodcts</code></li>
<li><code>/productts</code> (but not <code>/producttts</code>, <code>/productttts</code>, or so on)</li>
<li><code>/our-products</code></li>
<li><code>/productos</code></li>
</ul>
<blockquote>
<p><strong>Don&apos;t worry if you found this section difficult to understand.</strong> A lot of<br>
developers find regular expressions to be challenging to write, test, and<br>
debug. Unless your work requires you to write regular expressions on a<br>
frequent basis, it&apos;s likely that you&apos;ll need to spend time brushing up your<br>
regular expressions skills before you can successfully write or update an<br>
expression. Using a good tool can make a big difference&#x2014;ask your fellow<br>
developers what tool(s) they&apos;ve found to be helpful!</p>
</blockquote>
<h3 class="mume-header" id="using-an-array-of-paths">Using an array of paths</h3>

<p>In addition to the techniques you&apos;ve seen so far, you can also use an array of<br>
values for the route path:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token regex">/^\/(our-)?produ?ct{1,2}s?\/?$/i</span><span class="token punctuation">,</span> <span class="token string">&apos;/productos&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>When a route is defined using an array of values for the route path, Express<br>
will check each of the array&apos;s elements to determine if an incoming request URL<br>
path is a match.</p>
<p>Using an array allows you to simplify the regular expression a bit by pulling<br>
the <code>/productos</code> path out of the regular expression into its own route path<br>
string. This change has no effect on the outward functionality of your<br>
application; it&apos;s all about choosing the option that&apos;s easiest to read,<br>
understand, and maintain.</p>
<h2 class="mume-header" id="redirecting-incorrect-requests">Redirecting &quot;incorrect&quot; requests</h2>

<p>All of the internal stakeholders at the Best Company Ever love the new website.<br>
They&apos;re especially happy that you were able to address all of the URL path<br>
oddities surrounding the &quot;Products&quot; page.</p>
<p>There&apos;s one final issue to address though. A sharp-eyed tester noticed that when<br>
you request the &quot;Products&quot; page using one of the non-preferred paths (e.g.<br>
<code>/prodcts</code>) the page displays as expected, but the URL in the browser&apos;s address<br>
bar shows the non-preferred path (i.e.<br>
<code>http://www.bestcompanyever.com/prodcts</code>). Ideally, when a client requests the<br>
&quot;Products&quot; page using anything other than the preferred route of <code>/products</code>,<br>
they&apos;d be redirected back to the page using the preferred path.</p>
<p>You can accomplish this by updating the route handler to check if the current<br>
request&apos;s path (i.e. <code>req.path</code>) starts with the preferred path, and if not,<br>
uses the <code>res.redirect()</code> method to redirect the client:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// If the current request path doesn&apos;t match our preferred</span>
<span class="token comment">// route path then redirect the client.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&apos;/products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>By default, Express routing isn&apos;t case-sensitive, so the request path<br>
<code>/Products</code> would match our preferred route path <code>/products</code>. To prevent from<br>
redirecting requests that only differ by casing, the string <code>toLowerCase()</code><br>
method is being used to force the request path to all lowercase. Also, Express<br>
allows incoming request paths that have an optional trailing forward slash<br>
(i.e. <code>/products/</code>) to match a route path without a trailing forward slash<br>
(i.e. <code>/products</code>). Using the string <code>startsWith()</code> method gives us an easy<br>
way to check for the preferred path without having to account for the trailing<br>
slash.</p>
</blockquote>
<p>After finishing all of the refactoring, the final version of your <code>app.js</code> file<br>
should now look like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/product/:id(\\d+)&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Product ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token regex">/^\/(our-)?produ?ct{1,2}s?\/?$/i</span><span class="token punctuation">,</span> <span class="token string">&apos;/productos&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// If the current request path doesn&apos;t match our preferred</span>
 <span class="token comment">// route path then redirect the client.</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&apos;/products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Products&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="what-you-learned-3">What you learned</h2>

<p>In this article, you learned</p>
<ul>
<li>that route parameters are named URL segments used to capture values;</li>
<li>how to define a route whose path contains one or more route parameters;</li>
<li>that a route path can be a string, string pattern, regular expression, or an<br>
array containing any combination of those;</li>
<li>how to define a route path using a string pattern; and</li>
<li>how to define a route path using a regular expression.</li>
</ul>
<hr>
<h1 class="mume-header" id="express-routers">Express Routers</h1>

<p>As you&apos;ve learned about Express routing, you&apos;ve defined routes within a single<br>
<code>app.js</code> file. While this is a convenient approach to use while learning, it&apos;s<br>
not very practical for &quot;real world&quot; web applications.</p>
<p>In the real world, web applications tend to target groups of resources, where<br>
each resource is associated with multiple routes. For example, a customer order<br>
management application might target resources like &quot;Customers&quot;, &quot;Products&quot;,<br>
&quot;Product Categories&quot;, and &quot;Orders&quot;, and each of those resources might have<br>
routes for creating, retrieving, updating, and deleting records (often referred<br>
to as CRUD operations). Additionally, some resources might need to share the<br>
same routes.</p>
<p>In these situations, defining all of your web application&apos;s routes within a<br>
single JavaScript file is simply put, a bad idea.</p>
<p>Express routers allow developers to create collections of modular, mountable<br>
route handlers. Using routers helps to keep your code organized and DRY (don&apos;t<br>
repeat yourself!), ensuring that your code is as readable and maintainable as<br>
possible.</p>
<p>As an introduction to Express routers, let&apos;s create routing for a sports team<br>
application. You&apos;ll use a router to define routes for &quot;Home&quot;, &quot;Schedule&quot;, and<br>
&quot;Roster&quot; pages. Then you&apos;ll see how to mount that router onto your application<br>
so that its routes are shared across multiple teams.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Use the <code>express.Router</code> class to define a collection of route handlers; and</li>
<li>Use the <code>app.use()</code> method to mount a Router instance for a specific route<br>
path.</li>
</ul>
<h2 class="mume-header" id="setting-up-the-initial-project">Setting up the initial project</h2>

<p>Create a folder for your project, open a terminal or command prompt window,<br>
browse to your project&apos;s folder, and initialize npm:</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm init -y
</code></pre><p>Then install Express 4.0:</p>
<pre data-role="codeBlock" data-info class="language-"><code>npm install express@^4.0.0
</code></pre><p>Add a file named <code>app.js</code> file to your project containing the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// TODO Mount router instances.</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Your application doesn&apos;t contain any routes yet, so hold off on testing for a<br>
bit.</p>
<blockquote>
<p>Remember that if you leave your application running in the terminal or command<br>
prompt window while you&apos;re working, you&apos;ll need to stop and restart it so that<br>
Node picks up your latest code changes. To do that, press <code>CTRL+C</code> to stop the<br>
application and run <code>node app.js</code> to restart the application.</p>
</blockquote>
<h2 class="mume-header" id="defining-a-collection-of-route-handlers">Defining a collection of route handlers</h2>

<p>While it&apos;s not required, a common convention is to create each Express router<br>
instance within its own Node module. Remember that in Node, each file is treated<br>
as a separate module. So, to create a new module for your router, add a new file<br>
named <code>routes.js</code> to your project.</p>
<blockquote>
<p>Typically, the name of the module reflects the resource that the router will<br>
be defining routes for. Going back to the customer order management<br>
application, you&apos;d have files named <code>customers.js</code> and <code>products.js</code><br>
containing routers (and route definitions) for the Customers and Products<br>
resources. For this article, you&apos;ll keep things simple and just use the<br>
filename <code>routes.js</code>.</p>
</blockquote>
<p>At the top of the file, use the <code>require</code> directive to import the <code>express</code><br>
module and assign it to a variable named <code>express</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>You&apos;ve had a lot of practice using the <code>express</code> function (exported by the<br>
<code>express</code> module) to create Express applications. The <code>express</code> module also<br>
exports the <code>Router</code> class via a property on the <code>express</code> function, which you<br>
can use to create an instance of a router:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Create the Router instance.</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Everything that you&apos;ve done so far with defining routes using an Express<br>
Application (<code>app</code>) object can be done with a router instance. For this reason,<br>
a router can be thought of as a &quot;mini-app&quot;.</p>
<blockquote>
<p>The Express Application (<code>app</code>) object and Router objects also handle<br>
middleware in the same way. You&apos;ll learn about middleware in a future lesson.</p>
</blockquote>
<p>Using the <code>router.get()</code> method, define a collection of routes for a sports team<br>
including &quot;Home&quot;, &quot;Schedule&quot;, and &quot;Roster&quot; pages:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Define routes.</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Home&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/schedule&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Schedule&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/roster&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Roster&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Code contained within a module isn&apos;t automatically visible or callable to code<br>
contained in other modules. To expose code to other modules, you can use the<br>
<code>module.exports</code> object. Since you only have one object to export from your<br>
module, simply assign the <code>router</code> variable to the <code>module.exports</code> property:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><p>Here&apos;s the completed code for the <code>routes.js</code> file:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Router instance.</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Home&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/schedule&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Schedule&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/roster&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Roster&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="mounting-a-router-instance">Mounting a Router instance</h2>

<p>Now that you&apos;ve finished setting up your router instance, you&apos;re ready to make<br>
use of it within your <code>app.js</code> file. At the top of the file just below where<br>
you&apos;re importing the <code>express</code> module, use the <code>require</code> directive to import the<br>
<code>routes</code> module and assign it to a variable named <code>routes</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>Notice that the call to the <code>require</code> directive to import the <code>routes</code> module<br>
starts with a relative path (i.e. a dot <code>.</code> followed by a forward slash <code>/</code>).<br>
This tells Node that the <code>routes</code> module is a local module contained within<br>
our project, as opposed to a module contained within an external dependency<br>
located in the <code>node_modules</code> folder (that was installed using the <code>npm install</code> command).</p>
</blockquote>
<p>To expose your router instance to the outside world so that it can handle<br>
incoming HTTP requests, you need to tell your Express Application (<code>app</code>) object<br>
to use it. To do that, call the <code>app.use()</code> method passing in an optional route<br>
path along with the <code>routes</code> variable (the instance of your router):</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mount router instances.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/portland-thorns&apos;</span><span class="token punctuation">,</span> routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Providing a route path when mounting your router instance allows you to mount<br>
the router instance multiple times each with a different route path:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mount router instances.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/portland-thorns&apos;</span><span class="token punctuation">,</span> routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/orlando-pride&apos;</span><span class="token punctuation">,</span> routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The combination of the router mount paths and the route paths defined within the<br>
router allows you to easily and quickly build a hierarchy of routes:</p>
<ul>
<li><code>/portland-thorns/</code></li>
<li><code>/portland-thorns/schedule</code></li>
<li><code>/portland-thorns/roster</code></li>
<li><code>/orlando-pride/</code></li>
<li><code>/orlando-pride/schedule</code></li>
<li><code>/orlando-pride/roster</code></li>
</ul>
<p>If you mounted the router instance without supplying a route path (i.e.<br>
<code>app.use(routes)</code>), then your application would only have the following routes<br>
configured:</p>
<ul>
<li><code>/</code></li>
<li><code>/schedule</code></li>
<li><code>/roster</code></li>
</ul>
<blockquote>
<p>Mounting a router instance without a route path might not seem very useful at<br>
first glance, but it can be helpful technique for keeping your project<br>
organized by defining top-level routes in their own module using a router.</p>
</blockquote>
<p>The completed code for your <code>app.js</code> file should look like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mount router instances.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/portland-thorns&apos;</span><span class="token punctuation">,</span> routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/orlando-pride&apos;</span><span class="token punctuation">,</span> routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="testing-the-application">Testing the application</h3>

<p>To test your application, open a terminal or command prompt window, browse to<br>
your project&apos;s folder, and run the following command:</p>
<pre data-role="codeBlock" data-info class="language-"><code>node app.js
</code></pre><p>If your application starts successfully, you&apos;ll see the text &quot;Listening on port<br>
8081&#x2026;&quot; displayed in the terminal or command prompt window. Next, open a web<br>
browser and browse to each of the following addresses for the Portland Thorns:</p>
<ul>
<li><code>http://localhost:8081/portland-thorns</code> - displays the text &quot;Home&quot; in the<br>
browser.</li>
<li><code>http://localhost:8081/portland-thorns/schedule</code> - displays the text<br>
&quot;Schedule&quot; in the browser.</li>
<li><code>http://localhost:8081/portland-thorns/roster</code> - displays the text &quot;Roster&quot; in<br>
the browser.</li>
</ul>
<p>Now browse to the following addresses for the Orlando Pride:</p>
<ul>
<li><code>http://localhost:8081/orlando-pride</code> - displays the text &quot;Home&quot; in the<br>
browser.</li>
<li><code>http://localhost:8081/orlando-pride/schedule</code> - displays the text &quot;Schedule&quot;<br>
in the browser.</li>
<li><code>http://localhost:8081/orlando-pride/roster</code> - displays the text &quot;Roster&quot; in<br>
the browser.</li>
</ul>
<p>Congrats on creating your first Express application with routers!</p>
<h2 class="mume-header" id="what-you-learned-4">What you learned</h2>

<p>In this article, you learned</p>
<ul>
<li>how to use the <code>express.Router</code> class to define a collection of route<br>
handlers; and</li>
<li>how to use the <code>app.use()</code> method to mount a Router instance for a specific<br>
route path.</li>
</ul>
<h2 class="mume-header" id="see-also-2">See also&#x2026;</h2>

<p>For more information about the Express Router class, <a href="https://expressjs.com/en/4x/api.html#router">see the official<br>
documentation</a>.</p>
<hr>
<h1 class="mume-header" id="routing-roundup-project">Routing Roundup Project</h1>

<p>Now that you&apos;ve learned about routing in Express, it&apos;s time to create an<br>
application to apply your knowledge! In this project, you&apos;ll:</p>
<ul>
<li>Create a web application using Express;</li>
<li>Use Express to send an HTTP response containing plain text;</li>
<li>Use Express to send an HTTP response containing HTML rendered from a Pug<br>
template;</li>
<li>Define route paths using a string, string pattern, or regular expression;</li>
<li>Define a route path containing a route parameter; and</li>
<li>Use an Express router to define a collection of route handlers.</li>
</ul>
<h2 class="mume-header" id="getting-started">Getting started</h2>

<ul>
<li>Clone the repository from<br>
<a href="https://github.com/appacademy-starters/routing-roundup-starter">https://github.com/appacademy-starters/routing-roundup-starter</a></li>
<li>Run <code>npm install</code> to install the dependencies</li>
<li>When you want to run tests, run <code>npm test</code></li>
</ul>
<h2 class="mume-header" id="phase-1-defining-the-default-route">Phase 1: Defining the default route</h2>

<p>To get started, install Express 4.x using <code>npm</code>.</p>
<p>Now you&apos;re ready to create your Express application. Add a file named <code>app.js</code><br>
to your project. For your first route, the application should return the plain<br>
text response &quot;Hello from Express!&quot; for <code>GET</code> requests to the default or root<br>
resource. Configure your application to listen for HTTP connections on port<br>
<code>8081</code>.</p>
<p>If you would like to, setup <code>nodemon</code> as a dev dependency so you don&apos;t have to<br>
restart your server when you make code changes.</p>
<p>To manually test your application, use Node to start your application. Open up a<br>
browser and browse to the URL <code>http://localhost:8081/</code>. You should see the plain<br>
text &quot;Hello from Express!&quot; displayed.</p>
<p>We&apos;ve also provided automated integration tests that you can use to test your<br>
application.  With your application started and listening for HTTP connections<br>
on port <code>8081</code>, run the command <code>npm test</code> from a terminal. (You will need <em>two</em><br>
terminals open to do this, one to run the app and one to run the tests.)</p>
<p>The tests will confirm that each of your application&apos;s routes return the<br>
expected HTTP responses. Initially, most of the tests will fail as you haven&apos;t<br>
implemented all of the expected routes yet. As you work your way through the<br>
project, more tests will start to pass. If you have any trouble with using the<br>
tests don&apos;t hesitate to ask a TA for help!</p>
<h2 class="mume-header" id="phase-2-using-a-template-to-render-html">Phase 2: Using a template to render HTML</h2>

<p>For your next route, you&apos;ll use Express to send an HTTP response containing HTML<br>
rendered from a Pug template.</p>
<p>Start with creating a Pug template with three variables for the request method,<br>
the request path, and a random number. Render the variable values using an<br>
unordered list:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>[method]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>[path]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>[random number]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</pre><p>Replace the <code>[method]</code>, <code>[path]</code>, and <code>[random number]</code> text with the respective<br>
variable values.</p>
<p>After you complete your template, install Pug 2 and configure Express to use it<br>
as its default view engine. Then define a route that will match any request,<br>
regardless of the HTTP method, to a top level resource (such as <code>/about</code> or<br>
<code>/foo</code>). Use Express to render your template passing in the request method, the<br>
request path, and a random number. For the request method and path, remember<br>
that a route handler function&apos;s <code>req</code> parameter references the Express Request<br>
object which provides detail about the client request that&apos;s currently being<br>
processed. For the random number, use a whole number (no fractional or decimal<br>
part) greater than or equal to zero.</p>
<blockquote>
<p>Note: there are multiple ways to define a route path that&apos;ll match any request<br>
for a top level resource. Experiment a bit and use the approach that feels the<br>
easiest to implement. Think carefully about the order of your route<br>
definitions to ensure that you don&apos;t prevent other routes from being able to<br>
match their intended requests.</p>
</blockquote>
<blockquote>
<p>Additional note: remember that you can use the <code>console.log()</code> method to<br>
output the <code>req</code> parameter to the console as a way to inspect the properties<br>
that are available on the Request object. You can also use the <a href="https://expressjs.com/en/4x/api.html#req">official<br>
Express documentation</a> to research the available<br>
properties.</p>
</blockquote>
<p>To manually test your application, use Node to start your application, open up a<br>
browser, and browse to the URL <code>http://localhost:8081/about</code>. You should see the<br>
request method (<code>GET</code>), the request path (<code>/about</code>), and a random number<br>
displayed in an HTML unordered list.</p>
<p>To test your application using the provided automated integration tests, start<br>
your application listening for HTTP connections on port <code>8081</code> and run the<br>
command <code>mocha</code> from a terminal. You should see an additional set of tests pass<br>
that were previously failing.</p>
<h2 class="mume-header" id="phase-3-defining-another-flexible-route">Phase 3: Defining another flexible route</h2>

<p>For this route, you&apos;ll use Express to define a route that&apos;ll match any <code>GET</code><br>
request whose path ends with the letters &quot;xyz&quot;. The route should return the<br>
plain text response &quot;That&apos;s all I wrote.&quot;</p>
<blockquote>
<p>Note: there are multiple ways to define a route path that&apos;ll match any request<br>
whose path ends with a specific set of characters. Experiment a bit and use<br>
the approach that feels the easiest to implement. Again, think carefully about<br>
the order of your route definitions to ensure that all of your application&apos;s<br>
routes continue to work as intended.</p>
</blockquote>
<p>To manually test your application, use Node to start your application, open up a<br>
browser, and browse to the URL <code>http://localhost:8081/xyz</code> or<br>
<code>http://localhost:8081/something-else-xyz</code>. You should see the plain text<br>
&quot;That&apos;s all I wrote.&quot; displayed.</p>
<p>To test your application using the provided automated integration tests, start<br>
your application listening for HTTP connections on port <code>8081</code> and run the<br>
command <code>mocha</code> from a terminal. Same as before, you should see an additional<br>
set of tests pass that were previously failing.</p>
<h2 class="mume-header" id="phase-4-capturing-a-value-from-the-url-path">Phase 4: Capturing a value from the URL path</h2>

<p>Next, you&apos;ll use Express to define a route that&apos;ll match any <code>GET</code> request whose<br>
path starts with the path <code>/capital-letters/</code>. The route should return a plain<br>
text response of the uppercase version of the text in the path that follows<br>
<code>/capital-letters/</code>. For example, a request URL path of<br>
<code>/capital-letters/little</code> would return the plain text response &quot;LITTLE&quot;.</p>
<p>To complete this part of the project, think about how to define a route whose<br>
path contains a named path segment that captures the value at that position in<br>
the path. For more information, review the &quot;Exploring Route Paths&quot; article in<br>
this lesson to help you arrive at a solution.</p>
<p>To manually test your application, start your application, open up a browser,<br>
and browse to the URL <code>http://localhost:8081/capital-letters/express</code>. You<br>
should see the plain text &quot;EXPRESS&quot; displayed.</p>
<p>To test your application using the provided automated integration tests, start<br>
your application and run the command <code>mocha</code> from a terminal. You should see an<br>
additional set of tests pass that were previously failing.</p>
<h2 class="mume-header" id="phase-5-defining-a-collection-of-route-handlers">Phase 5: Defining a collection of route handlers</h2>

<p>To complete your project, you&apos;ll use an Express router to define a collection of<br>
route handlers. One of those route handlers should respond to the URL path<br>
<code>/bio</code> with the plain text &quot;Bio&quot; and another should response to <code>/contact</code> with<br>
the plain text &quot;Contact&quot;.</p>
<p>Once you&apos;ve defined your router, mount two instances to your application so<br>
that:</p>
<ul>
<li>
<p>A request with the URL path <code>/margot/bio</code> will return the plain text response<br>
&quot;Bio&quot; and <code>/margot/contact</code> will return the plain text response &quot;Contact&quot;; and</p>
</li>
<li>
<p>A request with the URL path <code>/margeaux/bio</code> will return the plain text<br>
response &quot;Bio&quot; and <code>/margeaux/contact</code> will return the plain text response<br>
&quot;Contact&quot;.</p>
</li>
</ul>
<p>To manually test your application, start your application, open up a browser,<br>
and browse to the URLs <code>http://localhost:8081/margot/bio</code>,<br>
<code>http://localhost:8081/margot/contact</code>, <code>http://localhost:8081/margeaux/bio</code>,<br>
and <code>http://localhost:8081/margeaux/contact</code>, and check that the application<br>
returns the expected responses.</p>
<p>To test your application using the provided automated integration tests, start<br>
your application and run the command <code>mocha</code> from a terminal. Now you should see<br>
all of the tests pass!</p>
<h2 class="mume-header" id="what-weve-learned">What We&apos;ve Learned</h2>

<p>Your Express routing application is now complete! Great job building out your<br>
application&apos;s routes using a variety of techniques.</p>
<p>In this project, you:</p>
<ul>
<li>Created a web application using Express;</li>
<li>used Express to send an HTTP response containing plain text;</li>
<li>used Express to send an HTTP response containing HTML rendered from a Pug<br>
template;</li>
<li>defined route paths using a string, string pattern, or regular expression;</li>
<li>defined a route path containing a route parameter; and</li>
<li>used an Express router to define a collection of route handlers.</li>
</ul>
<hr>
<h1 class="mume-header undefined" id="week-11-day-3brform-handling">WEEK-11 DAY-3<br><em>Form Handling</em></h1>

<hr>
<h1 class="mume-header" id="html-forms-learning-objectives">HTML Forms Learning Objectives</h1>

<p>HTML forms are the way that you collect data from a user to power your Web<br>
application. Using forms is a vital building block for your Web application<br>
knowledge. After this lesson, you should be able to:</p>
<ol>
<li>Describe the interaction between the client and server when an HTML form is<br>
loaded into the browser, the user submits it, and the server processes it</li>
<li>Create an HTML form using the Pug template engine</li>
<li>Use express to handle a form&apos;s POST request</li>
<li>Use the built-in <code>express.urlencoded()</code> middleware function to parse incoming<br>
request body form data</li>
<li>Explain what data validation is and why it&apos;s necessary for the server to<br>
validate incoming data</li>
<li>Validate user-provided data from within an Express route handler function</li>
<li>Write a custom middleware function that validates user-provided data</li>
<li>Use the <code>csurf</code> middleware to embed a token value in forms to protect against<br>
Cross-Site Request Forgery exploits</li>
</ol>
<hr>
<h1 class="mume-header" id="html-forms-an-introduction">HTML Forms: An Introduction</h1>

<p>HTML Forms are an essential and ubiquitous part of the web. You use forms to<br>
search, create resources (i.e. account, posts), update resources, and more.</p>
<p>While forms may seem simple on the surface, there&apos;s more complexity that you<br>
have to think about as a developer when you&apos;re building a web app that uses HTML<br>
forms. In this introductory lesson you will learn about:</p>
<ul>
<li>the key components of a form</li>
<li>the client and browser interaction when it comes to handling HTML forms</li>
<li>the usual flow of a form submission</li>
</ul>
<h2 class="mume-header" id="key-components-of-a-form">Key components of a form</h2>

<p>Let&apos;s imagine that a user just landed on a website you built and loads up a form<br>
that allows users to sign up for a mailing list.</p>
<p>The browser would load up HTML that includes something like this:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Sign up for an account<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/sign-up<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fullname<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Email:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Sign Up<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</pre><p>Let&apos;s first break down the various components of the form.</p>
<h3 class="mume-header" id="form"><code>&lt;form&gt;</code></h3>

<p>The <code>&lt;form&gt;</code> element is the parent element of all of the input fields. This<br>
element has two attributes that are unique to <code>&lt;form&gt;</code> elements: <code>action</code> and<br>
<code>method</code>.</p>
<p>The <code>action</code> attribute defines the location (URL) where the form should send the<br>
data to when it is submitted. In this example, the <code>action</code> attribute has a<br>
value of <code>/sign-up</code>. The <code>action</code> can be set to either an <a href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_is_a_URL#Examples_of_absolute_URLs">absolute URL</a> or a<br>
<a href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/What_is_a_URL#Examples_of_relative_URLs">relative URL</a>. If it is a relative URL (ex: <code>/sign-up</code>), then it will be sent<br>
to the server that served up the website that the user is on.</p>
<p>The <code>method</code> attribute defines the HTTP verb that should be used to make the<br>
request to the server. Browsers support only two values for this attribute:<br>
&quot;get&quot; and &quot;post&quot;. You will use &quot;post&quot; 99% of the time.</p>
<blockquote>
<p>Forms typically use POST requests because POST requests are used to send data<br>
that results in a change on the server. For example, if someone wanted to sign<br>
up for an account, that form would use a POST request. In contrast, GET<br>
requests are used to retrieve data from the server. A typical use case for a<br>
form that uses a GET method is a search form. For example, the search input on<br>
<a href="http://www.google.com">www.google.com</a> is part of a form that uses a GET method.</p>
</blockquote>
<p>In this example, when the form is submitted, it will make a POST request to the<br>
server&apos;s <code>/sign-up</code> route.</p>
<h3 class="mume-header" id="input"><code>&lt;input&gt;</code></h3>

<p>In this example, there are two input fields for entering data: one for the<br>
user&apos;s name, and one for the user&apos;s email. These fields are represented by the<br>
<code>&lt;input&gt;</code> element.</p>
<p>Notice how there is a <code>type</code> attribute in each <code>&lt;input&gt;</code> element. The type<br>
attribute tells the browser what kind of input it expects, and the browser<br>
enforces different rules for each type of input.</p>
<p>For example, in the <code>&lt;input&gt;</code> field with <code>type=&quot;email&quot;</code>, if the user tries to<br>
submit an email that does not have the &quot;@&quot; character in it, then most browsers<br>
will display notify users that they have put in an invalid email address.</p>
<p>There are several types of inputs, including number, password, and checkbox. You<br>
can learn more about all of the different types types in the<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input">MDN docs on input types</a>. Some of the less-commonly-used ones are quite<br>
interesting!</p>
<p>There are also other HTML elements that serve as data input fields but are not<br>
represented by an <code>&lt;input&gt;</code> element, such as <code>&lt;textarea&gt;</code> and <code>&lt;select&gt;</code>.</p>
<p>The first two <code>&lt;input&gt;</code> fields in the example also have a <code>name</code> attribute. The<br>
<code>name</code> attribute is important because when the form data is sent to the server,<br>
the data is represented in key-value pairs with the value of the <code>name</code><br>
attribute set as the key. For form submissions with a &quot;post&quot; method, the input<br>
field data would be sent to the server in the body of the HTTP request in the<br>
<code>x-www-form-urlencoded</code> format. For example, the data for the example form would<br>
look something like this when it is submitted to the server:</p>
<pre data-role="codeBlock" data-info="plaintext" class="language-plaintext"><code>fullname=John+Doe&amp;email=john@doe.com
</code></pre><p>The <code>id</code> attribute ties the <code>&lt;input&gt;</code> element to the <code>&lt;label&gt;</code> element by<br>
matching the <code>&lt;label&gt;</code> element&apos;s <code>for</code> attribute. Associating a <code>&lt;label&gt;</code><br>
element with the <code>&lt;input&gt;</code> field in this way offers accessibility and useability<br>
benefits. For example, if the user clicks on a <code>&lt;label&gt;</code> element that is<br>
associated with an <code>&lt;input&gt;</code> field, then the <code>&lt;input&gt;</code> field would come into<br>
focus.</p>
<p>Finally, the last <code>&lt;input&gt;</code> element with <code>type=&quot;submit&quot;</code> is unique in that it<br>
does not store any data. Instead, this element renders as a button with text<br>
that is equal to its <code>value</code> attribute. You could also write <code>&lt;input&gt;</code> elements<br>
with <code>type=&quot;submit&quot;</code> as a <code>&lt;button&gt;</code> element, like this:<br>
<code>&lt;button type=&quot;submit&quot;&gt;Sign Up&lt;/button&gt;</code>. When the user clicks on this button,<br>
then the form is submitted.</p>
<h2 class="mume-header" id="submitting-the-form">Submitting the form</h2>

<p>As mentioned earlier, when this form is submitted, it will make a POST request<br>
to the server&apos;s <code>/sign-up</code> route.</p>
<p>In the previous lesson, you learned about routing in an Express server, so you<br>
can imagine that the above example might make a request to a route that looks<br>
something like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/sign-up&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle the request here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>When the request reaches the server, the data captured in the form is then<br>
validated. For example, you might want to set up a validation that verifies that<br>
the user actually typed something into the <code>fullname</code> field before submitting.</p>
<blockquote>
<p>There are various validations that you can set on the frontend elements<br>
themselves. For example, if you add a <code>required</code> attribute to an <code>&lt;input&gt;</code><br>
field, then the browser would prevent the user from being able to submit a<br>
form if that required field were empty. <strong>However</strong>, frontend validations can<br>
be easily manipulated: someone could simply open up the dev tools and remove<br>
the <code>required</code> attribute and then submit the form with an empty input. This is<br>
why server-side validations are crucial and necessary.</p>
</blockquote>
<p>If the data is invalid, then the server would send back error messages to the<br>
frontend to be displayed to the user. For example, if the user had submitted a<br>
form with an empty <code>fullname</code> field, then the server can send back an error<br>
message to notify the user that the &quot;Name field is required&quot;. Specifically, the<br>
error would return a complete HTML page containing the entire form along with<br>
the error messages. This is so that the user can resolve the error and then<br>
resubmit the form, effectively repeating the whole form submission process<br>
again.</p>
<p>Validations can also be more robust than simple checks for whether or not a<br>
field was filled out. As a developer, you can customize and set up any sort of<br>
validation on the data that the user is submitting. In a later reading, you&apos;ll<br>
learn more about validations.</p>
<p>Finally, once the user resolves the errors, then the server can successfully<br>
process the data. At this point, the server would typically redirect the user to<br>
a different page by responding with a <code>302 Found</code> status. For example, if a user<br>
had just signed up for a new account, the server might redirect them to the<br>
profile page after they have successfully signed up.</p>
<h2 class="mume-header" id="what-youve-learned-1">What you&apos;ve learned</h2>

<p>In this reading, you learned about:</p>
<ul>
<li>the key components of a form</li>
<li>the client and browser interaction when it comes to handling HTML forms</li>
<li>the usual flow of a form submission</li>
</ul>
<p>In the next reading, you&apos;ll get an opportunity to build out a form that<br>
interacts with an Express server!</p>
<hr>
<h1 class="mume-header" id="html-forms-in-express">HTML Forms in Express</h1>

<p>In the previous reading, you learned about the fundamental components of an HTML<br>
form and how the client and server interacts when a form is submitted.</p>
<p>In this reading, you&apos;ll learn how to:</p>
<ul>
<li>Create an HTML form using the Pug template engine.</li>
<li>Define a pair of GET and POST routes to deliver an HTML form to the user and<br>
process requests from that form.</li>
<li>Create and use a Pug layout template to eliminate code duplication across Pug<br>
views.</li>
<li>Configure an Express application to use the built-in <code>urlencoded</code> middleware<br>
function to parse incoming request body form data (encoded as<br>
x-www-form-urlencoded).</li>
</ul>
<h2 class="mume-header" id="forms-example-setup">Forms example setup</h2>

<p>Let&apos;s learn about forms with an example. In this example, your friends are<br>
having a wedding, and they want you want to build a simple website that lets<br>
them keep track of their guest list!</p>
<p>Here&apos;s how the website will work:</p>
<ol>
<li>The website has two main pages: the home page where your friends can see the<br>
full list of guests, and a &quot;guest form&quot; page that has a form where they can<br>
add guests.</li>
<li>At the top of both pages, there should be two links that lets them easily<br>
navigate back and forth between the home page and the guest form page.</li>
<li>When they add a guest, they should be redirected back to the home page so<br>
they can see the newly added guest.</li>
</ol>
<p>Follow along by creating a <code>forms-demo</code> directory, starting up a Node project,<br>
installing the dependencies, and then creating the necessary files:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">mkdir</span> forms-demo
<span class="token function">cd</span> forms-demo
<span class="token function">npm</span> init --yes
<span class="token function">npm</span> <span class="token function">install</span> express@^4.0.0 pug@^2.0.0
<span class="token function">npm</span> <span class="token function">install</span> nodemon@^2.0.0 --save-dev
<span class="token function">mkdir</span> views
<span class="token function">touch</span> index.js views/index.pug
</pre><p>Since this example will be used and built upon in all of the remaining readings<br>
in this lesson, it&apos;s highly recommended that you actively follow along in this<br>
example. Executing the above commands should leave you with a <code>forms-demo</code><br>
directory that looks like:</p>
<pre data-role="codeBlock" data-info="plaintext" class="language-plaintext"><code>forms-demo
&#x2502;   node_modules/
|   views/
&#x2502;   &#x2502;   index.pug
&#x2502;   index.js
&#x2502;   package-lock.json
&#x2502;   package.json
</code></pre><p>Let&apos;s also set up a <code>start</code> script. Update your <code>package.json</code> so that it looks<br>
something like:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;forms-demo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.4&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.2&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Don&apos;t worry if the minor and patch versions of your dependencies don&apos;t end up<br>
matching exactly.</p>
<p>In your <code>index.js</code> file, set up the your Express server. In the server file,<br>
keep track of your guests with an array. When the server is first started, the<br>
guests array should be empty. Keep in mind that this guests array will be reset<br>
every time the server/application restarts. In a future lesson, you&apos;ll learn how<br>
to persist this type of data to a database in your Express applications.</p>
<p>Go ahead and also set up a root route that renders the <code>index.pug</code> template<br>
along with the <code>title</code> and <code>guests</code> array:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;view engine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> guests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest List&quot;</span><span class="token punctuation">,</span> guests <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Finally, populate the <code>index.pug</code> template with some Pug content. Set the<br>
<code>title</code> in the <code>head</code> element, render an <code>h1</code> element to display the <code>title</code>,<br>
and then also set up two links to allow users to easily navigate back and forth<br>
between the <code>/</code> and <code>/guest</code> URL.</p>
<p>Underneath the navigation links, render a <code>table</code> element that will be used to<br>
keep track of all of the invited guests. There will be three pieces of<br>
information will be tracked for each guest:</p>
<ul>
<li>Full Name</li>
<li>Email</li>
<li>Guests (i.e. will they have a &quot;plus one&quot;? Can they bring their kids?)</li>
</ul>
<p>After following the instructions above, your <code>index.pug</code> should look something<br>
like this:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token doctype">doctype html</span>
<span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span><span class="token punctuation">=</span><span class="token code"> title</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span><span class="token punctuation">=</span><span class="token code"> title</span>
    <span class="token tag">div</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;/&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Home</span>
    <span class="token tag">div</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Guest</span>

    <span class="token tag">table</span>
      <span class="token tag">thead</span>
        <span class="token tag">tr</span>
          <span class="token tag">th</span> <span class="token plain-text">Full Name</span>
          <span class="token tag">th</span> <span class="token plain-text">Email</span>
          <span class="token tag">th</span> <span class="token plain-text"># Guests</span>
      <span class="token tag">tbody</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> guest <span class="token keyword">in</span></span> guests</span>
          <span class="token tag">tr</span>
            <span class="token tag">td</span> <span class="token plain-text">#{guest.fullname}</span>
            <span class="token tag">td</span> <span class="token plain-text">#{guest.email}</span>
            <span class="token tag">td</span> <span class="token plain-text">#{guest.numGuests}</span>
</pre><p>Alright! At this point you should be able to start up your server by running<br>
<code>npm start</code>. Navigate to <code>http://localhost:8081/</code> to see a page with an <code>h1</code><br>
element that says &quot;Guest List&quot;, two navigation links, and an empty guests table.</p>
<h2 class="mume-header" id="getting-the-add-guest-form">Getting the &quot;Add Guest&quot; form</h2>

<p>Now that you have the home page set up, let&apos;s first set up the <code>/guest</code><br>
route and view.</p>
<p>As a reminder, this view should show a very basic form that allows users to add<br>
a guest to the guest list.</p>
<p>First, create a <code>guest-form.pug</code> template for that view, and add a simple form<br>
to it with a full name input field, an email input field, a number of guests<br>
input field, and a submit input.</p>
<p>Then, add the <code>method</code> and <code>action</code> attributes to the form. Use &quot;post&quot; for the<br>
<code>method</code> attribute. For <code>action</code>, go ahead and set it so that the form<br>
submission is routed to &quot;/guest&quot;:</p>
<p>Here&apos;s what your <code>guest-form.pug</code> file should look like:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">h2</span> <span class="token plain-text">Add Guest</span>
<span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;post&quot;</span> action<span class="token operator">=</span><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullname&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Full Name:</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullname&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;fullname&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;fullname&quot;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Email:</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Num Guests</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;number&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Add Guest&quot;</span></span><span class="token punctuation">)</span></span></span>
</pre><blockquote>
<p><strong>Note:</strong> You&apos;ll want to be sure that the <code>name</code> of your inputs are consistent<br>
with the <code>guests</code> array object properties. The rationale for this will become<br>
clearer later in the reading when you start saving each guest into the<br>
<code>guests</code> array, but essentially, you want to keep your variable names<br>
consistent between the frontend and the backend.</p>
</blockquote>
<p>Then, set up the route in the Express server so that the <code>guest-form.pug</code><br>
template gets rendered when the user navigates to <code>localhost:8081/guest</code>. For<br>
this route, set the <code>title</code> to &quot;Guest Form&quot;:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// REST OF FILE NOT SHOWN</span>
</pre><p>Here&apos;s what the <code>index.js</code> file should look like now:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;view engine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> guests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest List&quot;</span><span class="token punctuation">,</span> guests <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>When users navigate to <code>localhost:8081/guest</code>, the HTTP request will be routed<br>
to the <code>app.get(&apos;/guest&apos;)</code> route, which responds by rendering the<br>
<code>guest-form.pug</code> template. You should now see a form that allows users to input<br>
a guest&apos;s email, full name, and number of allowed guests.</p>
<h2 class="mume-header" id="a-quick-aside-pug-layout-templates">A quick aside: Pug layout templates</h2>

<p>One thing to note right now is that the <code>guest-form.pug</code> template is missing the<br>
navigation links that allows users to easily move back and forth between the<br>
home page and the guest form page.</p>
<p>To fix this, you have a couple of options. You could simply copy and paste the<br>
top of <code>index.pug</code> to the top of <code>guest-form.pug</code>. However, this solution<br>
quickly grows unwieldy once you need to add other templates that also need easy<br>
navigation.</p>
<p>Fortunately, Pug provides a clean way of preventing duplication of code with its<br>
template inheritance feature. Pug provides two keywords for template<br>
inheritance: <code>block</code> and <code>extends</code>.</p>
<p>According to the <a href="https://pugjs.org/language/inheritance.html">Pug documentation</a>, a <code>block</code> is a chunk of Pug code that &quot;a<br>
child template can replace&quot;. To understand what this means, go ahead and start a<br>
new template called <code>layout.pug</code>.</p>
<p>Then, move all of the content that you&apos;d like all of your templates to share<br>
into this <code>layout.pug</code> file. Finally, at the bottom, declare a new <code>block</code> by<br>
writing &quot;<code>block content</code>&quot;, and nest an <code>h1</code> element in that <code>block</code> that says<br>
&quot;This is the layout template.&quot; Here&apos;s what your new <code>layout.pug</code> template should<br>
look like:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token doctype">doctype html</span>
<span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span><span class="token punctuation">=</span><span class="token code"> title</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span><span class="token punctuation">=</span><span class="token code"> title</span>
    <span class="token tag">div</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;/&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Home</span>
    <span class="token tag">div</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Guest</span>

    <span class="token keyword">block content</span>
      <span class="token tag">h1</span> <span class="token plain-text">This is the layout template</span>
</pre><p>Next, update your <code>index.pug</code> to this:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">table</span>
    <span class="token tag">thead</span>
      <span class="token tag">tr</span>
        <span class="token tag">th</span> <span class="token plain-text">Full Name</span>
        <span class="token tag">th</span> <span class="token plain-text">Email</span>
        <span class="token tag">th</span> <span class="token plain-text"># Guests</span>
    <span class="token tag">tbody</span>
      <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> guest <span class="token keyword">in</span></span> guests</span>
        <span class="token tag">tr</span>
          <span class="token tag">td</span> <span class="token plain-text">#{guest.fullname}</span>
          <span class="token tag">td</span> <span class="token plain-text">#{guest.email}</span>
          <span class="token tag">td</span> <span class="token plain-text">#{guest.numGuests}</span>

</pre><p>Finally, update your <code>guest-form.pug</code> file to this:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">h2</span> <span class="token plain-text">Add Guest</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;post&quot;</span> action<span class="token operator">=</span><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullname&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Full Name:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullname&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;fullname&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;fullname&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Email:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Num Guests</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;number&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Add Guest&quot;</span></span><span class="token punctuation">)</span></span></span>

</pre><p>Then, navigate back and forth between <code>localhost:8081/</code> and<br>
<code>localhost:8081/guest</code> and see what happens.</p>
<p>Let&apos;s explore how this works. The <code>extends</code> key word denotes that the<br>
<code>index.pug</code> and <code>guest-form.pug</code> templates are now inheriting from the<br>
<code>layout.pug</code> template. This means that when the <code>index.pug</code> and <code>guest-form.pug</code><br>
templates are rendered, they will render all of the content that exists in<br>
<code>layout.pug</code>.</p>
<p>The <code>block</code> allows for any child template to redefine the content within that<br>
block. In <code>layout.pug</code>, a <code>block</code> named &quot;content&quot; is defined with an <code>h1</code><br>
element underneath it. In <code>guest-form.pug</code>, the &quot;content&quot; <code>block</code> is now<br>
redefined to render the guest <code>form</code> instead of that <code>h1</code> element.</p>
<p>This would work even if the original &quot;content&quot; <code>block</code> in <code>layout.pug</code> had no<br>
content inside of it. For example, go ahead and remove that &quot;This is the layout<br>
template&quot; <code>h1</code> from <code>layout.pug</code>, and notice how the <code>block</code> redefinition still<br>
works. You don&apos;t need to add that <code>h1</code> back to the template. That was only there<br>
to make <code>block</code> redefinitions a little bit clearer.</p>
<p>Using template inheritance, you can simply inherit from <code>layout.pug</code> in all of<br>
your new Pug templates. This is especially useful if you want to render the same<br>
navigation elements throughout your entire web application.</p>
<h2 class="mume-header" id="submitting-the-guest-form">Submitting the guest form</h2>

<p>Let&apos;s get back to finishing up the guest form.</p>
<p>Right now, if the user submits the form, it makes a POST request to &quot;/guest&quot;.<br>
Set up the route that would handle this request:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// MORE CODE TO COME</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="x-www-form-urlencoded"><code>x-www-form-urlencoded</code></h3>

<p>The previous reading briefly touched on how when forms are submitted with a<br>
&quot;post&quot; method, the data is sent to the server in the body of the HTTP request.<br>
It also mentioned how the data is encoded in a <code>x-www-form-urlencoded</code> format.<br>
Simply put, <code>x-wwww-form-urlencoded</code> format means that the data is formatted in<br>
a consistent way so that the server understands exactly what is being submitted.</p>
<p>This will make more sense with an example. When input data is sent in the body<br>
of the HTTP request, they&apos;re sent in a key-value string format, like this:<br>
<code>fullname=[FULLNAME_VALUE]&amp;email=[EMAIL_VALUE]&amp;numGuests=[NUM_GUESTS_VALUE]</code>.</p>
<p>Let&apos;s suppose you know a married couple called Jack Hill and Jill Hill. You plan<br>
on inviting them, but you really don&apos;t want to have to enter them twice. Plus,<br>
they&apos;re one of those couples that share email addresses, so it would be super<br>
convenient to enter them as one entry. So for the fullname field, you enter<br>
&quot;Jack&amp;Jill Hill&quot;. In the email field, you enter their email,<br>
<a href="mailto:%22jack.jill@hill.com">&quot;jack.jill@hill.com</a>&quot;, and then put down &quot;2&quot; for number of guests.</p>
<p>The problem here is that some characters in the key-value string format have<br>
special meaning. For example, notice how the &quot;&amp;&quot; character is used to split the<br>
two key-value pairs.</p>
<p>Unfortunately, because you put down &quot;Jack&amp;Jill Hill&quot; for the <code>fullname</code> field,<br>
it could be confusing as to whether or not the &quot;&amp;&quot; character was actually part<br>
of one of the input values or if it&apos;s there to split up a key-value pair. In<br>
order to clarify the meaning, the data string needs to be encoded so that those<br>
special characters are consistently mapped to other characters that don&apos;t have<br>
special meaning.</p>
<p>So in our example, the &quot;@&quot; character would be represented instead by &quot;%40&quot; and<br>
the &quot;&amp;&quot; symbol would be represented by &quot;%3D&quot;. This results in the data being<br>
sent in the <code>x-www-form-urlencoded</code> format that looks like this:<br>
<code>fullname=Jack%3DJill+Hill&amp;email=jack.jill%40hill.com&amp;numGuests=2</code>.</p>
<blockquote>
<p>&quot;%40&quot; and &quot;%3D&quot; are <a href="https://en.wikipedia.org/wiki/Percent-encoding">percent encoded</a> values. Values after the &quot;%&quot; character<br>
are hexadecimal values.</p>
</blockquote>
<h3 class="mume-header" id="parsing-the-request-body">Parsing the request body</h3>

<p>Once the request reaches the server, because the body of the request is now<br>
encoded in an <code>x-www-form-urlencoded</code> format, it needs to be decoded and parsed,<br>
preferably into a format that would be easy for the routes to handle.</p>
<p>Fortunately, the Express framework comes with a middleware function that does<br>
this for us. You&apos;ll learn more about middleware in an upcoming reading, but for<br>
now, go ahead and add <code>app.use(express.urlencoded())</code> to your <code>index.js</code> file<br>
under where the view engine is being set:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;view engine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> guests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;layout&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest List&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// MORE CODE TO COME</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Because of the <code>express.urlencoded()</code> middleware function, the body data is now<br>
available in the <code>req</code> object. Specifically, <code>req.body</code> has now been formatted<br>
as an object that looks like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token punctuation">{</span>
  fullname<span class="token punctuation">:</span> <span class="token string">&apos;Jack&amp;Jill Hill&apos;</span><span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token string">&apos;jack.jill@hill.com&apos;</span><span class="token punctuation">,</span>
  numGuests<span class="token punctuation">:</span> <span class="token string">&apos;2&apos;</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>Notice how the number of guests field is a string even though the <code>input</code> type<br>
was a &quot;number&quot;. This will be discussed in more detail in the next reading.</p>
</blockquote>
<p>Let&apos;s parse out the fields from the <code>req.body</code> object and push this guest entry<br>
into the <code>guests</code> array. Then, redirect the user back to the home page by using<br>
the <code>res</code> object&apos;s <code>redirect</code> method. That method redirects the user by sending<br>
a response with a <code>302 Found</code> HTTP status code to the client.</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> guest <span class="token operator">=</span> <span class="token punctuation">{</span>
    fullname<span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>fullname<span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
    numGuests<span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>numGuests
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  guests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>To recap, when the user submits the add guest form, the following happens:</p>
<ol>
<li>Because the <code>&lt;form&gt;</code> has a &quot;post&quot; <code>method</code>, the form data is sent in the body<br>
of the HTTP request in an <code>x-www-form-urlencoded</code> format.</li>
<li>When the request reaches the server, the <code>express.urlencoded</code> middleware<br>
function parses the urlencoded body into an object available via the<br>
<code>req.body</code> property.</li>
<li>The request is handled by the <code>/guest</code> POST route.</li>
<li>After the guest is added to the <code>guests</code> array, the server redirects the user<br>
back to the home page by sending a <code>302 Found</code> response. (Feel free confirm<br>
this in the <code>network</code> tab of your developer tools.)</li>
<li>When users lands on the home page, they can see the newly added guest in the<br>
guests table.</li>
</ol>
<h2 class="mume-header" id="what-youve-learned-2">What you&apos;ve learned</h2>

<p>There were a lot of steps that went into submitting just one simple form, but<br>
this form submission process is a common flow that you&apos;ll encounter often as a<br>
developer!</p>
<p>In this reading, you learned how to:</p>
<ul>
<li>Create an HTML form using the Pug template engine.</li>
<li>Define a pair of GET and POST routes to deliver an HTML form to the user and<br>
process requests from that form.</li>
<li>Create and use a Pug layout template to eliminate code duplication across Pug<br>
views.</li>
<li>Configure an Express application to use the built-in <code>urlencoded</code> middleware<br>
function to parse incoming request body form data (encoded as<br>
x-www-form-urlencoded).</li>
</ul>
<hr>
<h1 class="mume-header" id="data-validation">Data Validation</h1>

<p>When setting up HTML forms, it&apos;s important to check and clean the incoming data<br>
to ensure that the data is correct.</p>
<p>In this lesson, you will:</p>
<ol>
<li>Understand what data validation is and why it&apos;s necessary for the server to<br>
validate incoming data.</li>
<li>Validate user-provided data from within an Express route handler function and<br>
return a response containing user-friendly validation error messages when<br>
necessary.</li>
</ol>
<h2 class="mume-header" id="importance-of-server-side-data-validation">Importance of server-side data validation</h2>

<p>Data validation is the process of ensuring that the incoming data is correct.<br>
This section will cover the rationale for validating incoming<br>
data on the server side.</p>
<p>Even though you could add add validations on the client side, client-side<br>
validations are not as secure and can be circumvented. Because client-side<br>
validations can be circumvented, it&apos;s necessary to implement server-side data<br>
validations.</p>
<h3 class="mume-header" id="lack-of-trust-in-client-side-validations">Lack of trust in client-side validations</h3>

<p>Let&apos;s talk through an example. Suppose you had an HTML form that collects a<br>
user&apos;s age. First of all, the whole point of the form is to collect the user&apos;s<br>
age, so you want to ensure that the &quot;age&quot; field is not blank. To account for<br>
this, you set a <code>required</code> attribute on the age <code>&lt;input&gt;</code>.</p>
<p>You also want to make sure that users submit a number for their age, so you set<br>
the <code>&lt;input&gt;</code> field&apos;s <code>type</code> attribute equal to &quot;number&quot;:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>for</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/age<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Age: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">required</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>age<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</pre><p>Excellent, now, whenever users fill out this form, they&apos;re unable to submit the<br>
form unless the &quot;age&quot; field is filled out with a number. This seems like it<br>
would ensure that you have clean and correct data being submitted to your<br>
server.</p>
<p>Unfortunately, those frontend validations are not reliable. Someone could open<br>
up the developer&apos;s console and remove the <code>required</code> attribute, and then change<br>
the <code>type</code> to equal &quot;text&quot;.</p>
<p>Another situation to account for is that the end user might not even be using<br>
that specific form to submit data. Someone could be programmatically submitting<br>
a POST request to the server. In this scenario, they would never interact with<br>
the HTML form and its validations.</p>
<p>Ultimately, client-side validations are good for immediate feedback to the user,<br>
but they should not be relied upon for enforcing clean data submission.</p>
<h2 class="mume-header" id="server-side-validations">Server-side validations</h2>

<p>So what kind of data validations should you implement on the server side? Let&apos;s<br>
walk through a few examples.</p>
<h3 class="mume-header" id="expected-data-types">Expected data types</h3>

<p>The previous reading discussed how when a form is submitted, the data is<br>
typically urlencoded. One effect of this url encoding is that each value will<br>
arrive at the server as a string. Because of this, there&apos;s a tremendous need to<br>
validate that the provided string can be successfully converted to the desired<br>
type.</p>
<p>The previous example about the &quot;age&quot; field discussed how a user could circumvent<br>
the <code>type=&quot;number&quot;</code> attribute on the frontend. Without server-side data<br>
validation on that &quot;age&quot; field, you could end up with an invalid value (for<br>
example, <code>NaN</code>) when trying to convert the &quot;age&quot; value into a number in the<br>
server.</p>
<p>Other examples of data type validations include:</p>
<ul>
<li>Checking for integer vs. float<br>
(perhaps you want to only store the user&apos;s age as an integer)</li>
<li>Checking that an input date string can be converted to a valid date.</li>
</ul>
<h3 class="mume-header" id="valid-ranges-and-format">Valid ranges and format</h3>

<p>To continue with our &quot;age&quot; field example, one logical validation you might want<br>
to enforce is that users submit a valid age. For example, it&apos;s unlikely that a<br>
user is over 120 years old.</p>
<p>You could also check that values come in the correct format. A telephone number<br>
should not have any letters in it, and if you want to ensure that it is<br>
a US-based telephone number, you might also want to check that the phone number<br>
is 10 digits long.</p>
<p>Another example might be that you want to ensure that your users are creating<br>
strong and secure passwords. To do this, you could require and check for the<br>
presence of a symbol and a number in the password, or prevent users from setting<br>
&quot;password&quot; as their password.</p>
<h3 class="mume-header" id="other-validations">Other validations</h3>

<p>Validations do not have to be constrained to just checking one field at a time.<br>
To continue with the example on passwords, let&apos;s suppose you also wanted to add<br>
a &quot;Confirm Password&quot; field to ensure that users did not make a typo on their<br>
password when creating an account. In this scenario, it&apos;s necessary to add a<br>
validation to ensure that the &quot;Password&quot; and &quot;Confirmed Password&quot; fields have<br>
the same value.</p>
<p>Validations could get even more complex based on the needs of your application.<br>
For example, let&apos;s suppose you have a form for users to order products. You<br>
probably want to validate that their selected shipment order is valid given the<br>
order&apos;s weight and destination postal code. After all, you don&apos;t want users<br>
trying to select &quot;1-day delivery&quot; for a couch that needs to be transported<br>
across the country.</p>
<h2 class="mume-header" id="server-side-validations-an-example">Server-side validations: an example</h2>

<p>Let&apos;s pick up where last reading&apos;s example left off and add some server-side<br>
validations. As a reminder, in the last reading, you built a website that allows<br>
you to add guests to a guest list.</p>
<h3 class="mume-header" id="setup">Setup</h3>

<p>At this moment, the directory of that example should look like this:</p>
<pre data-role="codeBlock" data-info="plaintext" class="language-plaintext"><code>forms-demo
&#x2502;   node_modules/
|   views/
&#x2502;   &#x2502;   guest-form.pug
&#x2502;   &#x2502;   index.pug
&#x2502;   &#x2502;   layout.pug
&#x2502;   index.js
&#x2502;   package-lock.json
&#x2502;   package.json
</code></pre><p>The <code>index.js</code> file should look like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;view engine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> guests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest List&quot;</span><span class="token punctuation">,</span> guests <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> guest <span class="token operator">=</span> <span class="token punctuation">{</span>
    fullName<span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>fullName<span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
    numGuests<span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>numGuests
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  guests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>views/layout.pug</code> template should look like this:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token doctype">doctype html</span>
<span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span><span class="token punctuation">=</span><span class="token code"> title</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span><span class="token punctuation">=</span><span class="token code"> title</span>
    <span class="token tag">div</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;/&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Home</span>
    <span class="token tag">div</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Guest</span>

    <span class="token keyword">block content</span>


</pre><p>The <code>views/index.pug</code> file should look like this:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">table</span>
    <span class="token tag">thead</span>
      <span class="token tag">tr</span>
        <span class="token tag">th</span> <span class="token plain-text">Full Name</span>
        <span class="token tag">th</span> <span class="token plain-text">Email</span>
        <span class="token tag">th</span> <span class="token plain-text"># Guests</span>
    <span class="token tag">tbody</span>
      <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> guest <span class="token keyword">in</span></span> guests</span>
        <span class="token tag">tr</span>
          <span class="token tag">td</span> <span class="token plain-text">#{guest.fullName}</span>
          <span class="token tag">td</span> <span class="token plain-text">#{guest.email}</span>
          <span class="token tag">td</span> <span class="token plain-text">#{guest.numGuests}</span>

</pre><p>Finally, the <code>guest-form.pug</code> should look like this:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">h2</span> <span class="token plain-text">Add Guest</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;post&quot;</span> action<span class="token operator">=</span><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullName&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Full Name:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;text&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;fullName&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;fullName&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Email:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Num Guests</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;number&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Add Guest&quot;</span></span><span class="token punctuation">)</span></span></span>

</pre><h3 class="mume-header" id="validations-checking-that-all-fields-are-filled">Validations: checking that all fields are filled</h3>

<p>First, because all three fields are important, let&apos;s add validations to ensure<br>
that each of the field is filled out with a value before it can be successfully<br>
submitted.</p>
<p>To be clear, you can add a <code>required</code> attribute to the three <code>input</code> fields, and<br>
the user would not be able to submit until each field has a value. However, as<br>
was discussed in the previous reading, these kinds of front-end validations can<br>
be circumvented, so for this reading, let&apos;s focus on how to implement these<br>
validations in the server.</p>
<p>To do this, instantiate an <code>errors</code> array in <code>app.post(&apos;/guest&apos;)</code>. Then, check<br>
for truthy values in each of the <code>req.body</code> fields, and if any of the fields are<br>
missing, then push in an error message into the <code>errors</code> array to notify the<br>
user about how that field is required:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fullName<span class="token punctuation">,</span> email<span class="token punctuation">,</span> numGuests <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fullName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the full name field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the email field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>numGuests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the field for number of guests.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> guest <span class="token operator">=</span> <span class="token punctuation">{</span>
    fullName<span class="token punctuation">,</span>
    email<span class="token punctuation">,</span>
    numGuests
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  guests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now, if the <code>errors</code> array has an error message in it, then don&apos;t add the<br>
<code>guest</code> to the <code>guests</code> array. Instead, give the user an opportunity to fix the<br>
errors before resubmitting the form again.</p>
<p>You can do this by rendering the <code>guest-form.pug</code> template again along with the<br>
<code>errors</code> array. Then, update that template to display each error message to the<br>
user. Also, if there are errors, let&apos;s go ahead and return out of the callback<br>
function and ensure that none of the code below executes. Add this below the<br>
validations:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// VALIDATIONS HERE</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span><span class="token punctuation">,</span> errors <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// `return` if there are errors.</span>
<span class="token punctuation">}</span>

<span class="token comment">// REST OF CODE NOT SHOWN</span>
</pre><p>Here&apos;s what that route should look like now:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fullName<span class="token punctuation">,</span> email<span class="token punctuation">,</span> numGuests <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fullName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the full name field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the email field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>numGuests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the field for number of guests.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span><span class="token punctuation">,</span> errors <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> guest <span class="token operator">=</span> <span class="token punctuation">{</span>
    fullName<span class="token punctuation">,</span>
    email<span class="token punctuation">,</span>
    numGuests
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  guests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Update <code>guest-form.pug</code> to display error messages whenever they exist:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">div</span>
    <span class="token tag">ul</span>
      <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
        <span class="token tag">li</span> <span class="token plain-text">#{error}</span>
  <span class="token tag">h2</span> <span class="token plain-text">Add Guest</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;post&quot;</span> action<span class="token operator">=</span><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullName&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Full Name:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;text&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;fullName&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;fullName&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Email:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Num Guests</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;number&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Add Guest&quot;</span></span><span class="token punctuation">)</span></span></span>


</pre><p>There&apos;s one more thing to fix here. One problem is that when the user navigates<br>
to <code>localhost:8081/guest</code> now, when <code>guest-form.pug</code> is rendered, the<br>
<code>app.get(&apos;/guest&apos;)</code> route is not rendering an <code>errors</code> variable. Therefore,<br>
when <code>guest-form.pug</code> tries to iterate through the <code>errors</code> array, there&apos;s an<br>
error because <code>errors</code> does not exist.</p>
<p>You have a couple of options here: you can either check for the truthiness of<br>
<code>errors</code> in <code>guest-form.pug</code>, or you can render an empty <code>errors</code> array variable<br>
in the <code>app.get(&apos;/guest&apos;)</code> route callback. For now, let&apos;s go ahead and go<br>
with the first option and update the <code>guest-form.pug</code> template:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span> <span class="token plain-text">#{error}</span>
  <span class="token tag">h2</span> <span class="token plain-text">Add Guest</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;post&quot;</span> action<span class="token operator">=</span><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullName&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Full Name:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;text&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;fullName&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;fullName&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Email:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Num Guests</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;number&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Add Guest&quot;</span></span><span class="token punctuation">)</span></span></span>

</pre><p>Things should be working properly now! If the user forgets to submit any of the<br>
fields, the user should get a very specific message about which field needs to<br>
be filled out still.</p>
<h3 class="mume-header" id="validations-ensuring-that-numguests-is-valid">Validations: ensuring that <code>numGuests</code> is valid</h3>

<p>Let&apos;s add a couple more validations on the <code>numGuests</code> field to get really<br>
comfortable with data validations. First, it probably makes sense that the<br>
number of guests per entry on the guest list is at least one. Also, as<br>
previously mentioned, each of the values will arrive at the server as a string.<br>
Although, JavaScript automatically converts strings into numbers when a string<br>
is being compared to a number, it&apos;s good practice to compare values of the same<br>
type.</p>
<p>This brings up another necessary validation. Add a validation that checks to<br>
make sure that the <code>numGuests</code> field is actually a value that can be converted<br>
into a number. When you&apos;ve added these validations, your <code>app.post(&apos;/guest&apos;)</code><br>
route should look something like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fullName<span class="token punctuation">,</span> email<span class="token punctuation">,</span> numGuests <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token keyword">const</span> numGuestsNum <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>numGuests<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fullName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the full name field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the email field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>numGuests <span class="token operator">||</span> numGuests <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out a valid number for number of guests.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span><span class="token punctuation">,</span> errors <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> guest <span class="token operator">=</span> <span class="token punctuation">{</span>
    fullName<span class="token punctuation">,</span>
    email<span class="token punctuation">,</span>
    numGuests<span class="token punctuation">:</span> numGuestsNum
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  guests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>There are now validations in place to ensure that the <code>numGuests</code> field is a<br>
valid number that is greater than 0. Test to make sure this is working properly<br>
by changing the <code>numGuests</code> input type to &quot;text&quot; and submitting invalid data<br>
(you can either edit this directly in <code>guest-form.pug</code> or by opening up the<br>
developers console to edit the HTML)</p>
<h3 class="mume-header" id="improve-user-experience">Improve user experience</h3>

<p>One thing that&apos;s somewhat annoying right now is that any time there is a<br>
server-side error, all the fields get wiped, and the user has to fill them all<br>
out again. For example, even if the <code>fullName</code> and <code>email</code> fields were filled<br>
out without any issue, a small mistake on the <code>numGuests</code> field would require<br>
the user to have to start the whole process over again and fill out each field.</p>
<p>Let&apos;s improve the user experience by pre-setting each field with the values that<br>
they had just submitted. To do this, whenever there is an error, not only should<br>
you render the <code>errors</code> array, but also go ahead and render back the values from<br>
<code>req.body</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span><span class="token punctuation">,</span>
    errors<span class="token punctuation">,</span>
    email<span class="token punctuation">,</span>
    fullName<span class="token punctuation">,</span>
    numGuests
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>Then, in <code>guest-form.pug</code>, set each input&apos;s <code>value</code> attribute to equal the<br>
associated variables that was rendered back:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span> <span class="token plain-text">#{error}</span>
  <span class="token tag">h2</span> <span class="token plain-text">Add Guest</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;post&quot;</span> action<span class="token operator">=</span><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullName&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Full Name:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;text&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;fullName&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;fullName&quot;</span> value<span class="token operator">=</span>fullName</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Email:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> value<span class="token operator">=</span>email</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Num Guests</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;number&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> value<span class="token operator">=</span>numGuests</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Add Guest&quot;</span></span><span class="token punctuation">)</span></span></span>

</pre><p>Go ahead and test out the improved user experience! Now, each field&apos;s value<br>
should persist even if there was an error.</p>
<h2 class="mume-header" id="recap">Recap</h2>

<p>In this lesson, you learned:</p>
<ol>
<li>What data validation is and why it&apos;s necessary for the server to<br>
validate incoming data.</li>
<li>How to validate user-provided data from within an Express route handler<br>
function and return a response containing user-friendly validation error<br>
messages when necessary.</li>
</ol>
<hr>
<h1 class="mume-header" id="express-middleware">Express Middleware</h1>

<p>In a previous reading, we briefly introduced the urlencoded middleware function.<br>
Middleware functions are a critical part of a robust Express server. In this<br>
reading you will:</p>
<ol>
<li>Understand that the request pipeline in an Express application is composed of<br>
a series of middleware functions.</li>
<li>Write a custom middleware function that validates user-provided data<br>
(submitted via an HTML form), sets an array of user-friendly validation error<br>
messages on the Request object when necessary, and passes control to the next<br>
middleware function.</li>
</ol>
<h2 class="mume-header" id="middleware-overview">Middleware overview</h2>

<p>Express middleware is kind of a misnomer: because of the &quot;middle&quot; in<br>
&quot;middleware&quot;, you might assume that middleware is anything that sits between the<br>
client and the Express server. However, according to the<br>
<a href="https://expressjs.com/en/guide/using-middleware.html">Express documentation on using middleware</a>: &quot;An Express application is<br>
essentially a series of middleware function calls.&quot; Let&apos;s dive into what this<br>
means.</p>
<p>For starters, start up a demo server by running the following commands:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">mkdir</span> middleware-demo
<span class="token function">cd</span> middleware-demo
<span class="token function">npm</span> init --yes
<span class="token function">npm</span> <span class="token function">install</span> express@^4.0.0
<span class="token function">npm</span> <span class="token function">install</span> nodemon@^2.0.0 --save-dev
<span class="token function">touch</span> index.js
</pre><p>Then, in your <code>index.js</code>, handle get requests to the root path by responding<br>
with &quot;Hello World!&quot;:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Set up a <code>start</code> script in your <code>package.json</code>:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;middleware-demo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.2&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Then start up your server by running <code>npm start</code></p>
<h3 class="mume-header" id="anatomy-of-a-middleware-function">Anatomy of a middleware function</h3>

<p>In Express, a middleware function is a function that takes three arguments, in<br>
this specific order:</p>
<ol>
<li><code>req</code>- the request object</li>
<li><code>res</code>- the response object</li>
<li><code>next</code>- according to the <a href="https://expressjs.com/en/guide/using-middleware.html">Express documentation on using middleware</a>: &quot;the<br>
next middleware function in the application&#x2019;s request-response cycle&quot;</li>
</ol>
<p>These arguments might seem a little familiar. Up to this point, you&apos;ve been<br>
handling all requests with a callback function that takes a <code>req</code> and <code>res</code><br>
argument.</p>
<p>For example, take a look at the callback function that you just set up to send<br>
back &quot;Hello World!&quot;: it takes <code>req</code> and <code>res</code> as the first two arguments. There<br>
is, in fact, an optional <code>next</code> argument that you could have passed into this<br>
function as well. The <code>next</code> argument will be discussed in more depth later in<br>
this reading.</p>
<p>This means that all of the callback functions that you&apos;ve been writing this<br>
whole time to handle requests and send back responses are actually middleware<br>
functions.</p>
<h3 class="mume-header" id="series-of-middleware-functions">Series of middleware functions</h3>

<p>As a reminder, the documentation mentioned that &quot;an Express application is a<br>
<em>series</em> of middleware function calls.&quot; To explore what &quot;series&quot; means there,<br>
let&apos;s set up another middleware function.</p>
<p>Here&apos;s the goal: let&apos;s set up a middleware function that logs the time of each<br>
request.</p>
<p>Remember, a middleware function takes three arguments: <code>req</code>, <code>res</code>, and <code>next</code>.<br>
In <code>index.js</code>, create a middleware function <code>logTime</code> that console logs the<br>
current time formatted as an ISO string. At the end of the middleware function,<br>
invoke the <code>next</code> function, which represents the next middleware function:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">logTime</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Current time: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Now, update the <code>app.get(&apos;/&apos;)</code> route so that it calls <code>logTime</code> before it<br>
invokes the anonymous callback function that sends back &quot;Hello World!&quot;:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> logTime<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>To confirm that this is working, refresh <code>localhost:3000</code> and check that your<br>
server logs are showing the current time of each request.</p>
<p>Let&apos;s recap what just happened:</p>
<ol>
<li>When the user lands on <code>localhost:3000</code>, a GET request is made to the &quot;/&quot; route of the Express server.</li>
<li>The first middleware function this route invokes is <code>logTime</code>. In <code>logTime</code>, the current time is logged. At the end of <code>logTime</code>, it invokes <code>next</code>, which represents the next middleware function.</li>
<li>The next middleware function in this example is the anonymous callback<br>
function that runs <code>res.send(&quot;Hello World!&quot;)</code>.</li>
</ol>
<p>You could invoke as many middleware functions as you&apos;d like. In addition,<br>
because the <code>req</code> and <code>res</code> objects are passed through every one of the<br>
middleware functions, you could store values in the <code>req</code> object for the next<br>
middleware function to use.</p>
<p>Let&apos;s explore this by creating another middleware function called <code>passOnMessage</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">passOnMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Passing on a message!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span>passedMessage <span class="token operator">=</span> <span class="token string">&quot;Hello from passOnMessage!&quot;</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Then, let&apos;s add this middleware function to the <code>app.get(&apos;/&apos;)</code> route and then<br>
console.log the <code>req.passedMessage</code> in one of the later middleware functions:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> logTime<span class="token punctuation">,</span> passOnMessage<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Passed Message: &quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>passedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>In the example above, the <code>passedMessage</code> was added to the <code>req</code> object so<br>
that it could be used in a later middleware function. Alternatively, you might<br>
instead want to store properties inside of the <a href="https://expressjs.com/en/4x/api.html#res.locals">res.local</a> object so that you<br>
don&apos;t accidentally override an existing property in the <code>req</code> object.</p>
</blockquote>
<p>Instead of passing each middleware function in separate arguments, you could<br>
also pass them all in as one array argument:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>logTime<span class="token punctuation">,</span> passOnMessage<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Passed Message: &quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>passedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The order does matter. Try changing up the order of the middleware functions and<br>
see the order of the console.log statements.</p>
<h3 class="mume-header" id="application-level-middleware">Application-level middleware</h3>

<p>To be clear, with the current set up, <code>logTime</code> and <code>passOnMessage</code> will only be<br>
executed for the <code>app.get(&apos;/&apos;)</code> route. For example, let&apos;s say you set up another<br>
route:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/bye&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Bye World.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Because that route does not currently take in <code>logTime</code> as one of its arguments,<br>
it would not invoke the <code>logTime</code> middleware function. To fix this, you could<br>
simply pass in the <code>logTime</code> function, but if there was a middleware function<br>
that you wanted to execute for every single route, this could be pretty tedious.</p>
<p>Setting up an application-level middleware function that runs for every single<br>
route is simple. In fact, the <code>express.urlencoded</code> middleware you set up in the<br>
previous reading was an application-level middleware.</p>
<p>To do this, remove <code>logTime</code> from the <code>app.get(&apos;/&apos;)</code> arguments. Instead, add it<br>
as an application-wide middleware by writing <code>app.use(logTime)</code>. After doing<br>
this, your <code>index.js</code> file should look like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">logTime</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Current time: &quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">passOnMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Passing on a message!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span>passedMessage <span class="token operator">=</span> <span class="token string">&quot;Hello from passOnMessage!&quot;</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> passOnMessage<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Passed Message: &quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>passedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/bye&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Bye World.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now, whenever you navigate to either <code>localhost:3000</code> or <code>localhost:3000/bye</code>,<br>
the <code>passTime</code> middleware function will be executed. Note how the<br>
<code>passOnMessage</code> is only executed for the <code>app.get(&apos;/&apos;)</code> route.</p>
<h2 class="mume-header" id="data-validations-with-middleware">Data validations with middleware</h2>

<p>In the previous reading, you set up data validations in your Express server in<br>
the &quot;Guest List&quot; example.</p>
<p>Let&apos;s pick up where that example left off and move the data validations into a<br>
middleware function.</p>
<p>At this point, your <code>index.js</code> should look like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;view engine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> guests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest List&quot;</span><span class="token punctuation">,</span> guests <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fullname<span class="token punctuation">,</span> email<span class="token punctuation">,</span> numGuests <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token keyword">const</span> numGuestsNum <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>numGuests<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fullname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the full name field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the email field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>numGuests <span class="token operator">||</span> numGuests <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out a valid number for number of guests.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span><span class="token punctuation">,</span>
      errors<span class="token punctuation">,</span>
      email<span class="token punctuation">,</span>
      fullname<span class="token punctuation">,</span>
      numGuests
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> guest <span class="token operator">=</span> <span class="token punctuation">{</span>
    fullname<span class="token punctuation">,</span>
    email<span class="token punctuation">,</span>
    numGuests<span class="token punctuation">:</span> numGuestsNum
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  guests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>You might be wondering why you would want to move the validation logic into a<br>
middleware function. Suppose you now wanted to add a route that would allow the<br>
user to update a <code>guest</code> on the guest list.</p>
<p>In that update route, you probably want to enforce the same validations. You<br>
could simply copy and paste over all of those validations, but having it in a<br>
middleware function would keep your code DRY.</p>
<p>To start, create a function called <code>validateGuest</code> and move all of the<br>
validation logic into that function.</p>
<p>Because this will be a middleware function, be sure to accept <code>req</code>, <code>res</code>, and<br>
<code>next</code> as arguments in the function.</p>
<p>Finally, your <code>validateGuest</code> functions should pass on error messages to a later<br>
function so the later function can render the error messages back to the client.</p>
<p>When you&apos;re done with your <code>validateGuest</code> function, it should look something<br>
like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">validateGuest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fullname<span class="token punctuation">,</span> email<span class="token punctuation">,</span> numGuests <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token keyword">const</span> numGuestsNum <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>numGuests<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fullname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the full name field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the email field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>numGuests <span class="token operator">||</span> numGuests <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out a valid number for number of guests.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  req<span class="token punctuation">.</span>errors <span class="token operator">=</span> errors<span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Notice how the <code>errors</code> array is passed on to the next middleware function by<br>
being added to the <code>req</code> object. Update your <code>app.post(&apos;/guest&apos;)</code> route so that<br>
it now uses the <code>validateGuest</code> middleware function and so that it checks<br>
<code>req.errors</code> for error messages:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> validateGuest<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fullname<span class="token punctuation">,</span> email<span class="token punctuation">,</span> numGuests <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span><span class="token punctuation">,</span>
      errors<span class="token punctuation">:</span> req<span class="token punctuation">.</span>errors<span class="token punctuation">,</span>
      email<span class="token punctuation">,</span>
      fullname<span class="token punctuation">,</span>
      numGuests
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> guest <span class="token operator">=</span> <span class="token punctuation">{</span>
    fullname<span class="token punctuation">,</span>
    email<span class="token punctuation">,</span>
    numGuests
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  guests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>In summary, moving validations into a middleware allows you to concisely reuse<br>
validations across different routes. In production-level projects, you&apos;ll likely<br>
use a validation library called <a href="https://express-validator.github.io/docs/">express-validator</a>, which follows the same<br>
pattern of validating data in middleware functions and then passing on error<br>
messages through the <code>req</code> object.</p>
<p>The <a href="https://express-validator.github.io/docs/">express-validator</a> library gives you a wide range of pre-built validations<br>
so that you don&apos;t have to implement validation logic from scratch. For example,<br>
it comes with a pre-built validation for checking whether an input field&apos;s is in<br>
a proper email format: <code>check(&apos;email&apos;).isEmail()</code>. You&apos;ll get a chance to<br>
explore the <code>express-validator</code> middleware functions more in today&apos;s project!</p>
<h2 class="mume-header" id="what-you-learned-5">What you learned</h2>

<p>In this reading, you learned:</p>
<ol>
<li>that the request pipeline in an Express application is composed of a series<br>
of middleware functions</li>
<li>how to write a custom middleware function that validates user-provided data<br>
(submitted via an HTML form), sets an array of user-friendly validation error<br>
messages on the Request object when necessary, and passes control to the next<br>
middleware function.</li>
</ol>
<hr>
<h1 class="mume-header" id="protecting-forms-from-csrf">Protecting forms from CSRF</h1>

<p>The web, unfortunately, is full of bad actors who consistently try to exploit<br>
any insecurities that a web application might have. This reading will talk about<br>
one common attack called Cross Site Request Forgery (CSRF).</p>
<p>In this reading, you will learn:</p>
<ol>
<li>How to use the <code>csurf</code> middleware to embed a token value in forms to protect<br>
against CSRF exploits.</li>
</ol>
<h2 class="mume-header" id="csrf-explained">CSRF explained</h2>

<p>Let&apos;s explain what CSRF is with an example. Imagine that you are a customer at a<br>
bank called &quot;Bad Bank Inc.&quot;. To put it bluntly, this bank sucks, and their<br>
website is full of security issues.</p>
<p>In any case, you decide one day that you need to send your brother some money,<br>
so you go <code>http://badbank.com</code> and sign into your account. Once you have<br>
provided the correct credentials to log in, <code>http://badbank.com</code> sends back a<br>
cookie.</p>
<blockquote>
<p><strong>Brief overview of cookies:</strong> At a super high level, when a user logs into a<br>
website, one way that the server can &quot;log in the user&quot; is by sending back a<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">cookie</a> to the client. For example, if you log to <code>facebook.com</code>,<br>
<code>facebook.com</code>&apos;s server would send the browser back a cookie. Now, on every<br>
subsequent request to <code>facebook.com</code>, the browser would attach that cookie to<br>
the request. When the request arrives at the server, the server sees the<br>
cookie and sees that you&apos;re logged in and authorized to navigate around your<br>
account.</p>
</blockquote>
<p>Now that you&apos;re logged in, you navigate to <code>http://badbank.com/send-money</code>,<br>
which renders a a page that looks like this:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Bad Bank<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Send Money<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/send-money<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>recipient<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Recipient Email: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>recipient<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>recipient<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Amount: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Send Money<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</pre><p>The page has a form where you can fill out a &quot;recipient&quot; field and an &quot;amount&quot;<br>
field. You fill out your brother&apos;s email <code>joe@gmail.com</code> in the recipient field<br>
and $100 for the amount, and then hit the &apos;Send Money&apos; button.</p>
<p>When you hit the &apos;Send Money&apos; button, the following happens:</p>
<ol>
<li>An HTTP POST request is made to <code>http://badbank.com/send-money</code>. When you<br>
logged in earlier, your browser received a cookie and stored it in<br>
association with <code>http://badbank.com</code>. Now, your browser sees this &quot;send<br>
money&quot; request going to the <code>http://badbank.com</code> domain, so it attaches that<br>
cookie to the HTTP request.</li>
<li>The request arrives at the server. The server sees that there is a cookie,<br>
and it checks the cookie.</li>
<li>Since the cookie is valid, the server knows that you are logged in, and the<br>
server processes the form data to see who you&apos;re sending money to and how<br>
much you are sending.</li>
<li>The server finishes processing the form data and sends $100 to your brother<br>
Joe.</li>
</ol>
<p>Things are going well so far!</p>
<p>Unfortunately, a devious hacker comes along. The hacker puts up another website<br>
that looks like this:</p>
<pre data-role="codeBlock" data-info="html" class="language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>See Cute Puppies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
      <span class="token selector">form</span> <span class="token punctuation">{</span>
        <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">input<span class="token attribute">[type=&quot;submit&quot;]</span></span> <span class="token punctuation">{</span>
        <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://badbank.com/send-money<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>recipient<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Recipient Email: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>recipient<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>recipient<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hacker@gmail.com<span class="token punctuation">&quot;</span></span>
      <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Amount: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1000000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>See the cutest puppies!<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</pre><p>Let&apos;s break down what&apos;s going on in the hacker&apos;s website:</p>
<ol>
<li>First, the hacker puts up the exact same &quot;Send Money&quot; form on his website: it<br>
hits the same endpoint (<code>http://badbank.com/send-money</code>) with the same method<br>
(&quot;post&quot;), and it has all the fields that the endpoint expects when parsing<br>
the form (&quot;recipient&quot; and &quot;amount&quot;).</li>
<li>One difference here is that the hacker hid the form on the website with CSS<br>
by setting the form&apos;s visibility to hidden.</li>
<li>The other key difference is that the hacker went ahead and pre-filled the<br>
recipient field&apos;s value to his own email address, <a href="mailto:%22hacker@gmail.com">&quot;hacker@gmail.com</a>&quot;, and<br>
then also pre-filled the &quot;amount&quot; field&apos;s value to 1 million.</li>
<li>The only part of the form that the hacker decides to show is the submit<br>
button, and he changed the button text to an irresistible prompt: &quot;See the<br>
cutest puppies!&quot;.</li>
<li>Naturally, you love puppies, so as you&apos;re browsing the web and land on this<br>
hacker&apos;s website, you click the button, thinking that you&apos;re about to see<br>
puppies.</li>
<li>Instead, a &quot;ost&quot; request gets sent to <code>http://badbank.com/send-money</code> along<br>
with the pre-filled form data.</li>
</ol>
<p>Here&apos;s the problem, because you had recently logged into <code>http://badbank.com</code>,<br>
your browser is currently storing the cookie to keep you logged in. When the<br>
browser sees that you are making another request to the <code>badbank.com</code> domain, it<br>
attaches the same cookie to the request that the hacker tricked you into making.</p>
<p>Now, when the hacker&apos;s request makes it to <code>badbank.com</code>&apos;s server, it sees the<br>
cookie, sees that you&apos;re logged in and thinks that it&apos;s you making the request,<br>
so it sends $1 million to <a href="mailto:%22hacker@gmail.com">&quot;hacker@gmail.com</a>&quot;.</p>
<h2 class="mume-header" id="preventing-csrf">Preventing CSRF</h2>

<p>One foundational strategy to prevent a CSRF attack would be to have your server<br>
render a secret token as part of the form. Then, when the form gets submitted,<br>
it checks for the secret token to verify that it actually came from a form that<br>
the server itself had rendered, and not from some other malicious source.</p>
<p>Now, when a hacker tries to imitate the form on his own website, his form<br>
wouldn&apos;t have the secret token, and the server would know to reject any requests<br>
from that malicious form.</p>
<p>Let&apos;s pick up where we left off in our previous reading&apos;s &quot;Guest List&quot; example<br>
and walk through how to implement this CSRF token strategy.</p>
<h3 class="mume-header" id="example-setup">Example setup</h3>

<p>At this point, here&apos;s what the <code>index.js</code> file for the &quot;Guest List&quot; example<br>
project should look like:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;view engine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> guests <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Define a route.</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest List&quot;</span><span class="token punctuation">,</span> guests <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">validateGuest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fullname<span class="token punctuation">,</span> email<span class="token punctuation">,</span> numGuests <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token keyword">const</span> numGuestsNum <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>numGuests<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fullname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the full name field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out the email field.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>numGuests <span class="token operator">||</span> numGuests <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Please fill out a valid number for number of guests.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  req<span class="token punctuation">.</span>errors <span class="token operator">=</span> errors<span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> validateGuest<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fullname<span class="token punctuation">,</span> email<span class="token punctuation">,</span> numGuests <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span><span class="token punctuation">,</span>
      errors<span class="token punctuation">:</span> req<span class="token punctuation">.</span>errors<span class="token punctuation">,</span>
      email<span class="token punctuation">,</span>
      fullname<span class="token punctuation">,</span>
      numGuests
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> guest <span class="token operator">=</span> <span class="token punctuation">{</span>
    fullname<span class="token punctuation">,</span>
    email<span class="token punctuation">,</span>
    numGuests
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  guests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>guest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8081</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s what the <code>index.pug</code> file looks like:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">table</span>
    <span class="token tag">thead</span>
      <span class="token tag">tr</span>
        <span class="token tag">th</span> <span class="token plain-text">Full Name</span>
        <span class="token tag">th</span> <span class="token plain-text">Email</span>
        <span class="token tag">th</span> <span class="token plain-text"># Guests</span>
    <span class="token tag">tbody</span>
      <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> guest <span class="token keyword">in</span></span> guests</span>
        <span class="token tag">tr</span>
          <span class="token tag">td</span> <span class="token plain-text">#{guest.fullname}</span>
          <span class="token tag">td</span> <span class="token plain-text">#{guest.email}</span>
          <span class="token tag">td</span> <span class="token plain-text">#{guest.numGuests}</span>


<span class="token tag">Here</span>&apos;s what the `guest<span class="token punctuation">-</span>form<span class="token punctuation">.</span>pug` file looks like:

```pug
<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span> <span class="token plain-text">#{error}</span>
  <span class="token tag">h2</span> <span class="token plain-text">Add Guest</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;post&quot;</span> action<span class="token operator">=</span><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullname&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Full Name:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullname&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;fullname&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;fullname&quot;</span> value<span class="token operator">=</span>fullname</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Email:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> value<span class="token operator">=</span>email</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Num Guests</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;number&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> value<span class="token operator">=</span>numGuests</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Add Guest&quot;</span></span><span class="token punctuation">)</span></span></span>

</pre><h3 class="mume-header" id="using-the-csurf-library">Using the <code>csurf</code> library</h3>

<p>Let&apos;s use the <code>csurf</code> library to handle this whole process of creating a secret<br>
token for the form and then checking the secret token when forms are submitted.</p>
<p>The <code>csurf</code> library creates a middleware function that does the following:</p>
<ol>
<li>It creates a secret value, which is sent to the client and stored as a cookie<br>
named <code>_csrf</code>.</li>
<li>On every request for a form, a CSRF token is generated from that secret<br>
value. That CSRF token is then sent back to the client as part of the form in<br>
a hidden input field.</li>
<li>Whenever the client submits the form, the server checks the CSRF token that&apos;s<br>
embedded in the form and verifies that it is a valid CSRF token by checking<br>
it against the secret <code>_csrf</code> value that was attached to the request as a<br>
cookie.</li>
</ol>
<p>By taking the steps above, the hacker site would not have the CSRF token<br>
embedded as part of the form on his site, and therefore it would fail the CSRF<br>
token verification process.</p>
<p>Let&apos;s implement the above flow in the &quot;Guest List&quot; project. First, start by<br>
running <code>npm install csurf@^1.0.0</code>.</p>
<p>Then, go ahead and also install the <code>cookie-parser</code> middleware by running<br>
<code>npm install cookie-parser@^1.0.0</code>. Remember, the secret value is stored as a<br>
cookie named <code>_csrf</code>, so whenever the form is submitted, the server needs to be<br>
able to parse out the cookie in order to verify the CSRF token against the<br>
secret <code>_csrf</code> value.</p>
<p>At the top of <code>index.js</code>, require the <code>csurf</code> and <code>cookie-parser</code> dependencies.<br>
Add the <code>cookie-parser</code> middleware as an application-wide middleware function.<br>
For the <code>csurf</code> middleware, go ahead and create the function now so that you can<br>
later use it in specific routes:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cookie-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;csurf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;view engine&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Adding cookieParser() as application-wide middleware</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrfProtection <span class="token operator">=</span> <span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> cookie<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// creating csrfProtection middleware to use in specific routes</span>

<span class="token comment">// REST OF FILE NOT SHOWN</span>
</pre><p>In the <code>app.get(&apos;/guest-form&apos;)</code> route, pass in the <code>csrfProtection</code> function as<br>
one of the middleware functions for that route. Then in the route&apos;s final<br>
callback middleware function, generate a CSRF token by calling<br>
<code>req.csrfToken()</code>.</p>
<p>The <code>csrfToken()</code> function was added to the <code>req</code> object by the <code>csrfProtection</code><br>
middleware. The middleware function also generated a secret <code>_csrf</code> value and<br>
stored it in the <code>res</code> object&apos;s headers so that the client can store it as a<br>
cookie. Finally, render the CSRF token under a <code>csrfToken</code> key so that the<br>
<code>guest-form.pug</code> template can use it:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/guest-form&quot;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;guest-form&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&quot;Guest Form&quot;</span><span class="token punctuation">,</span> csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>In <code>guest-form.pug</code>, add a hidden input field with a <code>name</code> attribute of<br>
&quot;_csrf&quot; and the <code>value</code> attribute set to the <code>csrfToken</code> that the server<br>
renders:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span> <span class="token plain-text">#{error}</span>
  <span class="token tag">h2</span> <span class="token plain-text">Add Guest</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">method</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;post&quot;</span> action<span class="token operator">=</span><span class="token string">&quot;/guest&quot;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;hidden&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;_csrf&quot;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullname&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Full Name:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;fullname&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;fullname&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;fullname&quot;</span> value<span class="token operator">=</span>fullname</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Email:</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;email&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;email&quot;</span> value<span class="token operator">=</span>email</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;numGuests&quot;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Num Guests</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;number&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;numGuests&quot;</span> value<span class="token operator">=</span>numGuests</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&quot;submit&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Add Guest&quot;</span></span><span class="token punctuation">)</span></span></span>

</pre><p>Finally, back in <code>index.js</code>, pass in the <code>csrfProtection</code> function to<br>
<code>app.post(&apos;/guest&apos;)</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/guest&quot;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> validateGuest<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// REST OF CODE NOT SHOWN</span>
<span class="token punctuation">}</span>
</pre><p>Now whenever the form is submitted, the <code>csrfProtection</code> middleware function<br>
verifies that the CSRF token that was set in the hidden input field is a valid<br>
token by checking it against the secret <code>_csrf</code> value that was sent as a cookie.</p>
<p>In summary, now, if a hacker tries to add a guest to your guest list, his form<br>
would be missing the CSRF token. Therefore, the endpoint throw an error and<br>
prevent a guest from being added.</p>
<p>There are <a href="https://github.com/pillarjs/understanding-csrf">other considerations</a> to take into account to fully protect your web<br>
applications from CSRF attacks. For now, adding the CSRF token is a solid first<br>
line of defense.</p>
<h2 class="mume-header" id="what-you-learned-6">What you learned</h2>

<p>In this reading, you learned how to use the csurf middleware to embed a token<br>
value in forms to protect against CSRF exploits.</p>
<p>This reading concludes this lesson on HTML Forms, and you&apos;re now ready to build<br>
out your own Express application that uses forms!</p>
<hr>
<h1 class="mume-header" id="formative-forms-project">Formative Forms Project</h1>

<p>Today you&apos;ll be going through the formative experience of building out an<br>
Express application that uses HTML forms!</p>
<p>This application allows users to create two types of user accounts: a normal<br>
user account and an interesting user account. It keeps track of all of the users<br>
in a table on the home page.</p>
<p>When you&apos;re done with the project, your web application should have the<br>
following features:</p>
<ol>
<li>Site-wide navigation elements that allows users to navigate between the home<br>
page and the two other pages.</li>
<li>A table that shows all of the existing users.</li>
<li>A form that can be used to create a normal user account.</li>
<li>A form that can be used to create an interesting user account.</li>
</ol>
<h2 class="mume-header" id="getting-started-1">Getting started</h2>

<ul>
<li>Clone the starter project from<br>
<a href="https://github.com/appacademy-starters/formative-forms-starter">https://github.com/appacademy-starters/formative-forms-starter</a></li>
<li>Run <code>npm install</code> to install the dependencies</li>
<li>Run <code>npm test</code> to run the tests for the project</li>
</ul>
<h2 class="mume-header" id="phase-0-intro-to-the-skeleton-directory">Phase 0: Intro to the skeleton directory</h2>

<p>The skeleton directory has a bare bone <code>index.js</code> file that renders &quot;Hello<br>
World!&quot; when a user land on <code>localhost:3000/</code>. There&apos;s also a <code>users</code> array that<br>
already has one user created for you. Throughout the project, as you add new<br>
users, you&apos;ll do so by pushing the new users into this array.</p>
<p>It also has a <code>layout.pug</code> template that your other templates can extend. The<br>
<code>layout.pug</code> imports Bootstrap stylesheets in the <code>head</code> element. Feel free to<br>
make your website look fancy with the available Bootstrap styling by adding<br>
Bootstrap class names to your elements.</p>
<p>For example, here is the documentation on how to<br>
<a href="https://getbootstrap.com/docs/4.4/components/forms/">add Bootstrap styles to a form element</a> by adding the Bootstrap classes to each<br>
element.</p>
<h2 class="mume-header" id="phase-1-home-page">Phase 1: Home page</h2>

<p>Pass each of the specs in <code>01_home.test.js</code> file. Running <code>npm test</code> will run<br>
every single test across all five test files. If you only want to run the specs<br>
in <code>01_home.test.js</code>, run <code>npm test -- --grep home</code>. The <code>--grep</code> flag only<br>
executes tests with names that match the passed in option value.</p>
<p>Overall, this project will give you ample opportunity to get familiar with<br>
reading specs and then building out features to satisfy those specs. Be sure to<br>
check the specs often for guidance!</p>
<p>In this first phase, create an <code>index.pug</code> template and update the <code>app.get(&quot;/&quot;)</code><br>
route so that it renders the index template. Remember to render the <code>users</code><br>
array so that it&apos;s available in the <code>index.pug</code> template.</p>
<p><a href="https://pugjs.org/language/inheritance.html">Extend</a> the <code>index.pug</code> template to inherit from <code>layout.pug</code>. Declare a block<br>
named &quot;content&quot; and add a table to render existing users. Follow the specs to<br>
create an <code>h2</code> header for the table.</p>
<blockquote>
<p><strong>Hint:</strong> Read the error messages to see the expected header name.</p>
</blockquote>
<p>Create table headers and columns for each user&apos;s information.</p>
<blockquote>
<p><strong>Hint:</strong> Take a look at 01_home.test.js to view what columns are expected in<br>
the table.</p>
</blockquote>
<p>At the top of the <code>body</code> element in <code>layout.pug</code>, add navigation links so that<br>
users can easily navigate between the home page (&quot;/&quot; route), normal user<br>
creation form (&quot;/create&quot; route), and interesting user creation form<br>
(&quot;/create-interesting&quot; route).</p>
<h2 class="mume-header" id="phase-2-create-the-normal-user-form">Phase 2: Create the normal user form</h2>

<p>Pass each of the specs in <code>02_create_form.test.js</code>. You can run the specs in<br>
this file by running <code>npm test -- --grep create-normal</code>.</p>
<p>In this phase, go ahead and set up this route to use the <a href="https://www.npmjs.com/package/csurf">csurf</a> middleware to<br>
render a CSRF token in a hidden input field. Be sure to in the <code>{cookie: true}</code><br>
options when creating the middleware function.</p>
<p>Because your application will be using cookies to store the secret CSRF value,<br>
go ahead and also set up the <a href="https://www.npmjs.com/package/cookie-parser">cookie-parser</a> middleware as an application-wide<br>
middleware function.</p>
<p>Set up a route so that when users land on <code>/create</code>, a form renders with the<br>
following fields:</p>
<ul>
<li><code>_csrf</code> <strong>(hidden field)</strong></li>
<li><code>firstName</code></li>
<li><code>lastName</code></li>
<li><code>email</code></li>
<li><code>password</code></li>
<li><code>confirmedPassword</code></li>
</ul>
<p>Be sure to set correct input <code>type</code> and <code>name</code> attributes, and also remember to<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/label">add a label</a> correlating to each input field&apos;s <code>name</code>.</p>
<p>Make sure your <code>_csrf</code> field has an appropriate value from your middleware. At<br>
this point, remove some duplication from your Pug template by leveraging<br>
<a href="https://pugjs.org/language/mixins.html">mixins</a>. Create a mixin to easily generate <code>label</code> and <code>input</code> element pairs.<br>
Think of how you would create a mixin using <code>input</code> attributes as parameters.</p>
<h2 class="mume-header" id="phase-3-submitting-the-form">Phase 3: Submitting the form</h2>

<p>Pass each of the specs in <code>03_form_submit.test.js</code>. You can run the specs in<br>
this file by running <code>npm test -- --grep form-submit</code>.</p>
<p>Begin by setting up a <code>&quot;/create&quot;</code> route to handle POST requests. Now that you<br>
are handling POST requests, you&apos;ll need access to <code>req.body</code>. Have your<br>
application use the <code>express.urlencoded</code> middleware to decode the form&apos;s request<br>
body string into data that can be accessible in <code>req.body</code>.</p>
<p>The next step is to protect this route from CSRF attacks by using the middleware<br>
function that you set up using the <a href="https://www.npmjs.com/package/csurf">csurf</a> library. Make sure you&apos;ve included<br>
the middleware function in both of the GET and POST <code>&quot;/create&quot;</code> routes.</p>
<p>Now set up data validations and create an <code>errors</code> array within the<br>
<code>app.post(&quot;/create&quot;)</code> route. You want to validate whether the user has provided<br>
a <code>firstName</code>, <code>lastName</code>, <code>email</code>, and <code>password</code>. Read the error messages from<br>
the specs to determine what messages to <code>push</code> into your <code>errors</code> array.</p>
<p>Time to update the <code>create.pug</code> template to render the error messages. Start by<br>
creating an unordered list at the top of your <code>create-form.pug</code> block. Inside of<br>
the unordered list, add a paragraph element with the following content:<br>
<code>The following errors were found:</code>. Now, iterate through each error to create<br>
list items with the error messages. Only render errors if they are present in<br>
the <code>errors</code> array. How can you determine if there are errors present?</p>
<p>You&apos;ll want to be sure that you&apos;re pre-filling each input field with<br>
already-submitted values so that users don&apos;t have to fill out all of the fields<br>
again whenever there are errors. How can you update your <code>input</code> elements so<br>
that already-submitted values are still showing even after a form submission<br>
fails a data validation?</p>
<h2 class="mume-header" id="phase-4-create-interesting-user-form">Phase 4: Create interesting user form</h2>

<p>Pass each of the specs in <code>04_create_interesting_form.test.js</code>. You can run the<br>
specs in this file by running <code>npm test -- --grep create-interesting</code>.</p>
<p>Notice how this form includes all of the fields from the first form. Reduce code<br>
duplication by leveraging the Pug <a href="https://pugjs.org/language/includes.html">includes</a> feature.</p>
<p>One way you could refactor is to create an <code>includes</code> directory inside your<br>
views and make the following files:</p>
<ul>
<li><code>views/includes/errors.pug</code></li>
<li><code>views/includes/form-inputs.pug</code></li>
</ul>
<p>Now create a <code>create-interesting.pug</code> template for your &quot;interesting user form&quot;<br>
and refactor your <code>create.pug</code> template to leverage the Pug <code>includes</code> feature.<br>
Start by dividing your existing <code>create.pug</code> template into <code>errors.pug</code> and<br>
<code>form-inputs.pug</code>. Think of how to use the templates to keep your code DRY.</p>
<h2 class="mume-header" id="phase-5-submit-create-interesting-user-form">Phase 5: Submit create interesting user form</h2>

<p>Pass each of the specs in <code>05_interesting_form_submit.test.js</code>. You can run the<br>
specs in this file by running <code>npm test -- --grep submit-interesting</code>.</p>
<p>Go ahead and add validations and write error messages for this new form. Because<br>
this new form still has the same base fields as the other form, be sure to still<br>
run the same validations that you are currently running for the<br>
<code>app.post(&apos;/create&apos;)</code> route. If you have not done so already, go ahead and move<br>
all of the validations for the first form into a custom middleware function that<br>
both <code>app.post(&apos;/create&apos;)</code> and <code>app.post(&apos;/create-interesting</code>) can use. Be sure<br>
to store those errors on the <code>req</code> object so that they can be used in a later<br>
middleware function.</p>
<p>Once you&apos;ve ensured that your base fields are being validated, go ahead and add<br>
validations for the new <code>age</code> and <code>favoriteBeatle</code> fields. Follow the error<br>
messages in the specs to determine what your error messages should be. Please<br>
write these new validations in a custom middleware function.</p>
<p>Create <a href="https://pugjs.org/language/mixins.html">mixins</a> for the <code>favoriteBeatle</code> options. How can you make sure that a<br>
user&apos;s <code>favoriteBeatle</code> is automatically selected when a form with errors<br>
re-renders upon submission?</p>
<p>How can you make sure a user&apos;s <code>iceCream</code> checkbox accurately renders whether<br>
the user likes ice cream upon an unsuccessful form submission? When saving the<br>
user, be sure to use the checkbox&apos;s value (ex: &quot;on&quot;) to convert the<br>
<code>user.iceCream</code> property to a boolean.</p>
<p>Finally, make sure your <code>index.pug</code> template is also rendering your new user<br>
properties.</p>
<p>You&apos;ve made it! Confirm that your whole app works as expected by running<br>
<code>npm test</code>.</p>
<h2 class="mume-header" id="bonus">Bonus</h2>

<p>In a production-level Express application, you&apos;ll likely use a library to help<br>
handle most of your data validation. One of the most popular data validation<br>
libraries is the <a href="https://express-validator.github.io/docs/">express-validator</a> library, which gives you a wide range of<br>
robust validations right out of the box.</p>
<p>Install this dependency and use it to add a validation to check that the user<br>
password being submitted is at least 5 characters long and that it at least has<br>
one number in it.</p>
<p>Then, go ahead and migrate any validations that you had on the <code>age</code> and<br>
<code>favoriteBeatle</code> fields to use the <a href="https://express-validator.github.io/docs/">express-validator</a> library instead.</p>
<p>Once you&apos;re done with those fields, continue migrating all other validations to<br>
use <a href="https://express-validator.github.io/docs/">express-validator</a> and add validations to check <em>all</em> user input (e.g,<br>
checking that a valid email is submitted).</p>
<hr>
<h1 class="mume-header undefined" id="week-11-day-4brdata-driven-app">WEEK-11 DAY-4<br><em>Data-Driven App</em></h1>

<hr>
<h1 class="mume-header" id="data-driven-web-sites-learning-objectives">Data-Driven Web Sites Learning Objectives</h1>

<p>This is where it all comes together: databases, HTTP servers, HTML, CSS, request<br>
and response, JavaScript powering it all. This is <strong>full-stack</strong>. At the end of<br>
this content, you should be able to:</p>
<ol>
<li>Use environment variables to specify configuration of or provide sensitive<br>
information for your code</li>
<li>Use the <code>dotenv</code> npm package to load environment variables defined in an<br>
<code>.env</code> file</li>
<li>Recall that Express cannot process unhandled Promise rejections from<br>
within route handler (or middleware) functions;</li>
<li>Use a Promise <code>catch</code> block or a <code>try</code>/<code>catch</code> statement with <code>async</code>/<code>await</code><br>
to properly handle errors thrown from within an asynchronous route handler<br>
(or middleware) function</li>
<li>Write a wrapper function to simplify catching errors thrown within<br>
asynchronous route handler (or middleware) functions</li>
<li>Use the <code>morgan</code> npm package to log requests to the terminal window to assist<br>
with auditing and debugging</li>
<li>Add support for the Bootstrap front-end component library to a Pug layout<br>
template</li>
<li>Install and configure Sequelize within an Express application.</li>
<li>Use Sequelize to test the connection to a database before starting the HTTP<br>
server on application startup</li>
<li>Define a collection of routes (and views) that perform CRUD operations<br>
against a single resource using Sequelize</li>
<li>Handle Sequelize validation errors when users are attempting to create or<br>
update data and display error messages to the user so that they can resolve<br>
any data quality issues</li>
<li>Describe how an Express.js error handler function differs from middleware<br>
and route handler functions</li>
<li>Define a global Express.js error-handling function to catch and process<br>
unhandled errors</li>
<li>Define a middleware function to handle requests for unknown routes by<br>
returning a 404 NOT FOUND error</li>
</ol>
<hr>
<h1 class="mume-header" id="acclimating-to-environment-variables">Acclimating to Environment Variables</h1>

<p>As your Express applications increase in complexity, the need to have a<br>
convenient way to configure your applications will also increase.</p>
<p>For example, consider an application that uses a database for data persistence.<br>
To connect to the database, do you simply provide the username and password to<br>
use when making a connection to the database directly in your code? What if your<br>
teammate uses a different username or password? Do they modify the code to make<br>
it work for them? If they do that, how do you keep the application working on<br>
your system?</p>
<p>It&apos;s not just the differences between you and your teammates&apos; systems. Your<br>
applications won&apos;t always run locally; eventually they&apos;ll need to run on<br>
external servers to facilitate testing or to ultimately serve your end users. In<br>
most cases, your application will need to be configured differently when it&apos;s<br>
running on an external server than when it&apos;s running locally.</p>
<p>You need a solution for managing your application&apos;s configuration! When you<br>
finish this article, you should be able to:</p>
<ul>
<li>Recall what environment variables are and how they&apos;re commonly used;</li>
<li>Set and get an environment variable value;</li>
<li>Store environment variable values in an <code>.env</code> file;</li>
<li>Use a module to organize environment variables; and</li>
<li>Understand how to run npm scripts in different environments.</li>
</ul>
<h2 class="mume-header" id="what-are-environment-variables">What are environment variables?</h2>

<p>To understand what an environment variable is, we need to start with<br>
understanding what an environment is.</p>
<p>An environment is the system that an application is deployed to and running in.<br>
Up to now your applications have been running on your local machine, which is<br>
typically referred to as the &quot;local environment&quot; or &quot;local development<br>
environment&quot;.</p>
<p>For real life applications, there are usually several environments&#x2014;aside from<br>
each developer&apos;s local environment&#x2014;that the application will be deployed and ran<br>
within:</p>
<ul>
<li>Testing - An environment that&apos;s used to test the application to ensure that<br>
recent changes don&apos;t affect existing functionality and that new features meet<br>
the project&apos;s requirements.</li>
<li>Staging - An environment that mirrors the production environment to ensure<br>
that nothing unexpected occurs before the application is deployed to<br>
production.</li>
<li>Production - The environment that serves end users. For applications that need<br>
to support a large number of users, the production environment can contain<br>
multiple servers (sometimes dozens or even hundreds of servers).</li>
</ul>
<p>Environment variables are application configuration related variables whose<br>
values change depending on the environment that the application is running in.<br>
Using environment variables allows you to change the behavior of your<br>
application by the environment that it&apos;s running in without having to hard code<br>
values in your code.</p>
<h3 class="mume-header" id="how-are-environment-variables-commonly-used">How are environment variables commonly used?</h3>

<p>In an earlier lesson, you learned how to use the Sequelize ORM to connect to a<br>
PostgreSQL database to retrieve, create, update, and delete data. To connect to<br>
the database, you provided values for the following configuration variables<br>
within a module named <code>config/database.js</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> <span class="token string">&quot;mydbuser&quot;</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">&quot;mydbuserpassword&quot;</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> <span class="token string">&quot;mydbname&quot;</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The database connection settings that you use in your local development<br>
environment&#x2014;in particular the <code>username</code> and <code>password</code> values&#x2014;won&apos;t be the same<br>
that the testing, staging, or production environments will need.</p>
<p>Sequelize allows you to define database connection settings per environment like<br>
this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> <span class="token string">&quot;mydbuser&quot;</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">&quot;mydbuserpassword&quot;</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> <span class="token string">&quot;mydbname&quot;</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  test<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> <span class="token string">&quot;testdbuser&quot;</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">&quot;testdbuserpassword&quot;</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> <span class="token string">&quot;testdbname&quot;</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  production<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> <span class="token string">&quot;proddbuser&quot;</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">&quot;proddbuserpassword&quot;</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> <span class="token string">&quot;proddbname&quot;</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>While you could hard code different settings for each environment this approach<br>
is inelegant, difficult to maintain, and insecure. Application configuration can<br>
unexpectedly need to change in test, staging, and production environments.<br>
Having to make a code change to change an application&apos;s configuration in a<br>
specific environment isn&apos;t ideal.</p>
<p>Using environment variables for the database connection settings separates the<br>
configuration from the application&apos;s code and allows the configuration to be<br>
updated without having to make a code change.</p>
<p>Where else should you use environment variables? Anywhere that the behavior of<br>
your code needs to change based upon the environment that it&apos;s running in.<br>
Environment variables are commonly used for:</p>
<ul>
<li>Database connection settings (as you&apos;ve just seen)</li>
<li>Server HTTP ports</li>
<li>Static file locations</li>
<li>API keys and secrets</li>
</ul>
<h2 class="mume-header" id="setting-and-getting-environment-variable-values">Setting and getting environment variable values</h2>

<p>Now that you know what environment variables are and how they&apos;re used, it&apos;s time<br>
to see how to set and get an environment variable value.</p>
<h3 class="mume-header" id="setting-an-environment-variable-value">Setting an environment variable value</h3>

<p>The simplest way to set an environment variable, is via the command line, by<br>
declaring and setting the environment variable before the <code>node</code> command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">PORT<span class="token operator">=</span>8080 node app.js
</pre><p>You can even declare and set multiple environment variables:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">PORT<span class="token operator">=</span>8080 NODE_ENV<span class="token operator">=</span>development node app.js
</pre><blockquote>
<p>The <code>NODE_ENV</code> environment variable is a special variable that&apos;s used by<br>
many node programs to determine what environment the application is running<br>
in. For example, setting the <code>NODE_ENV</code> environment variable to <code>production</code><br>
enables features in Express that help to improve the overall performance of<br>
your application. For more information, see <a href="https://expressjs.com/en/advanced/best-practice-performance.html#set-node_env-to-production">this page</a> in<br>
the Express documentation.<br>
Sequelize also uses the <code>NODE_ENV</code> variable to determine which section of the<br>
<code>config.json</code> file it will use for database configuration.</p>
</blockquote>
<p>This approach also works within an npm <code>start</code> script:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PORT=8080 NODE_ENV=development node app.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="getting-an-environment-variable-value">Getting an environment variable value</h3>

<p>To get an environment variable value, you simply use the <code>process.env</code> property:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">;</span>
</pre><p>The <code>process</code> object is a global Node object, so you can safely access the<br>
<code>process.env</code> property from anywhere within your Node application.</p>
<p>If the <code>PORT</code> environment variable isn&apos;t declared and set, it&apos;ll have a value of<br>
<code>undefined</code>. You can use the logical <code>OR</code> (<code>||</code>) operator to provide a default<br>
value in code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="storing-environment-variables-in-a-env-file">Storing environment variables in a <code>.env</code> file</h2>

<p>Passing environment variables from the command line is not an ideal solution.<br>
Defining an npm <code>start</code> script keeps you from having to type the variables again<br>
and again, but it&apos;s still not a convenient way to maintain them.</p>
<p>Using the <code>dotenv</code> npm package, you can declare and set all of your environment<br>
variables in a <code>.env</code> file and the <code>dotenv</code> package will load your variables<br>
from that file and set them on the <code>process.env</code> property.</p>
<p>To start, install the <code>dotenv</code> npm package as a development dependency:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> dotenv --save-dev
</pre><blockquote>
<p>Remember that npm tracks two main types of dependencies in the <code>package.json</code><br>
file: dependencies (<code>dependencies</code>) and development dependencies<br>
(<code>devDependencies</code>). <em>Dependencies</em> (<code>dependencies</code>) are the packages that<br>
your project needs in order to successfully run when in production (i.e. your<br>
application has been deployed or published to a server that can be accessed by<br>
your users). <em>Development dependencies</em> (<code>devDependencies</code>) are the packages<br>
that are needed locally when doing development work on the project. Passing<br>
the <code>--save-dev</code> flag when installing a dependency tells npm to install the<br>
dependency as a development dependency.</p>
</blockquote>
<p>Then add an <code>.env</code> file to the root of your project that contains all of your<br>
environment variables:</p>
<pre data-role="codeBlock" data-info class="language-"><code>PORT=8080
DB_USERNAME=mydbuser
DB_PASSWORD=mydbuserpassword
DB_DATABASE=mydbname
DB_HOST=localhost
</code></pre><blockquote>
<p><strong>Pro tip for VS Code users:</strong> Install the <a href="https://marketplace.visualstudio.com/items?itemName=mikestead.dotenv">DotENV extension</a> to add syntax coloring in <code>.env</code> files.</p>
</blockquote>
<h3 class="mume-header" id="loading-environment-variables-on-application-startup">Loading environment variables on application startup</h3>

<p>Using the <code>dotenv</code> npm package, it&apos;s easy to load your environment variables<br>
when your Express application starts up. Just run this code before you configure<br>
and start your Express application:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Load the environment variables from the .env file</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;dotenv&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from Express!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="another-way-to-use-dotenv">Another way to use dotenv</h3>

<p>Another way to use the dotenv module is to load it before your app loads on<br>
the Node.JS command line by using Node.JS&apos;s <code>-r</code> option to require a module<br>
immediately.  To use it this way you could change your <code>npm start</code> command<br>
in your package.json to look like this:</p>
<pre data-role="codeBlock" data-info="json" class="language-json">  <span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node -r dotenv/config app.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Doing it this way makes sure that all of the environment variables are loaded<br>
before you execute any of the code of your app.</p>
<p>Whichever way you decide to go, the main point is to load the contents of your<br>
<code>.env</code> file as early as possible so those variables will be available to your<br>
code.</p>
<h3 class="mume-header" id="keeping-the-env-file-out-of-source-control">Keeping the <code>.env</code> file out of source control</h3>

<p>It&apos;s important to keep your <code>.env</code> file out of your source control as it will<br>
often contain sensitive information like database connection settings or API<br>
keys and secrets. If you&apos;re using Git for your source control, make sure that<br>
your <code>.gitignore</code> file includes an entry for <code>.env</code> files.</p>
<p>If you&apos;re working on a team, you&apos;ll need a way to document what the contents of<br>
the <code>.env</code> should look like. One approach is to update the project&apos;s <code>README.md</code><br>
file with instructions on what environment variables need to be defined in the<br>
<code>.env</code> file. Another option is to add an <code>.env.example</code> file to your project<br>
that mirrors the contents of the <code>.env</code> file but replaces any sensitive<br>
information with dummy values:</p>
<pre data-role="codeBlock" data-info class="language-"><code>PORT=8080
DB_USERNAME=dbuser
DB_PASSWORD=dbuserpassword
DB_DATABASE=dbname
DB_HOST=localhost
</code></pre><p>In many companies, managing the environment variables or <code>.env</code> files will<br>
be handled by whatever process the company uses to get the code deployed and<br>
running on the actual servers. Often companies will have dedicated teams of<br>
System Administrators or &quot;DevOps&quot; personnel that handle these tasks. As a<br>
developer you may have to work with these teams to determine what the best<br>
strategy is for getting the environment variables set for your application.</p>
<h2 class="mume-header" id="using-a-module-to-organize-environment-variables">Using a module to organize environment variables</h2>

<p>Earlier we mentioned that the <code>process</code> object is a global Node object, which<br>
means that you can safely access the <code>process.env</code> property from anywhere within<br>
your Node application. While that&apos;s true, you might find it helpful to<br>
encapsulate all of your <code>process.env</code> property access into a single <code>config</code><br>
module. The <code>config</code> module has a single purpose: to import all of your<br>
environment variables and export them to make them available to the rest of your<br>
application:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// config.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  environment<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">&apos;development&apos;</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">,</span>
  db<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_USERNAME</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_PASSWORD</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_DATABASE</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_HOST</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Creating a <code>config</code> module also gives you a convenient place to optionally<br>
provide default values and to alias environment variable names (notice how the<br>
<code>NODE_ENV</code> environment variable is being aliased to <code>environment</code>).</p>
<p>Any other module in your application that needs access to a configuration<br>
variable value just needs to require the <code>config</code> module:</p>
<blockquote>
<p>Make sure this is done after the environment variables are loaded if you are<br>
using the <code>dotenv</code> module.</p>
</blockquote>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Load the environment variables from the .env file</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;dotenv&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the port environment variable value.</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> port <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from Express!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start listening for connections.</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice how destructuring is being used to get a specific configuration variable<br>
value when requiring the <code>config</code> module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> port <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Without using destructuring, you could get the <code>port</code> configuration variable<br>
value like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> config<span class="token punctuation">.</span>port<span class="token punctuation">;</span>
</pre><p>Or like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port<span class="token punctuation">;</span>
</pre><p>Any of these approaches work fine. Deciding which to use is one of the many<br>
stylistic choices you&apos;ll make as a developer.</p>
<h3 class="mume-header" id="running-npm-binaries">Running npm binaries</h3>

<p>Using npx to run an npm binary like the Sequelize CLI won&apos;t work if you&apos;ve<br>
defined environment variables in an <code>.env</code> file for your database connection<br>
settings. You&apos;ll need to use a tool like the <code>dotenv-cli</code> npm package as an<br>
intermediary between npx and the Sequelize CLI to load your environment<br>
variables from the <code>.env</code> file and run the command that you pass into it.</p>
<p>To start, install the <code>dotenv-cli</code> package as a development dependency:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> dotenv-cli --save-dev
</pre><p>Then use npx to run the <code>dotenv</code> command passing in the command to invoke using<br>
the set of environment variables loaded from your <code>.env</code> file:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx dotenv sequelize db:migrate
</pre><h3 class="mume-header" id="defining-environment-specific-npm-scripts">Defining environment specific npm scripts</h3>

<p>Sometimes you may want to run different npm scripts for different <code>NODE_ENV</code><br>
environments.</p>
<p>For instance you might have this in your package.json for local development.</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>But in production we may not want to run nodemon, since our code won&apos;t be<br>
changing constantly. Perhaps, production needs a package.json like this instead:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node app.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>To keep from having to manually change your npm <code>start</code> script before you deploy<br>
your application to the production environment, you can use a tool like the<br>
<code>per-env</code> npm package that allows you to define npm scripts for each of your<br>
application&apos;s environments.</p>
<p>To start, install the <code>per-env</code> package:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> per-env
</pre><p>Then update your npm scripts to this:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;per-env&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start:development&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start:production&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node app.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>If the <code>NODE_ENV</code> environment variable is set to <code>production</code>, then running the<br>
<code>start</code> script will result in the execution of the <code>start:production</code> script. If<br>
the <code>NODE_ENV</code> variable isn&apos;t defined, then the <code>start:development</code> script will<br>
be executed by default.</p>
<p>Using this approach, you can conveniently define a <code>start</code> script (or any<br>
predefined or custom script) for each environment that your application will be<br>
deployed to.</p>
<h2 class="mume-header" id="what-you-learned-7">What you learned</h2>

<p>In this article, you learned how to</p>
<ul>
<li>set and get an environment variable value</li>
<li>store environment variable values in an <code>.env</code> file</li>
<li>use a module to organize environment variables</li>
<li>handle running different npm scripts in different environments.</li>
</ul>
<hr>
<h1 class="mume-header" id="asynchronous-route-handlers-in-express">Asynchronous Route Handlers in Express</h1>

<p>Up to this point, your Express route handler functions have been<br>
synchronous&#x2014;each statement predictably executes in the order that they&apos;re<br>
written in. Most Express applications, at some point, need to interact with a<br>
database or an API (or both). Interacting with those external resources requires<br>
you to write asynchronous code, which in turn requires your route handler<br>
functions to be asynchronous.</p>
<p>In modern JavaScript applications, writing asynchronous code means working with<br>
Promises and optionally the <code>async</code>/<code>await</code> keywords. When working with Promises<br>
in Express route handlers or middleware functions, special attention needs to be<br>
spent on how errors are handled.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Recall that Express cannot process unhandled Promise rejections from<br>
within route handler (or middleware) functions;</li>
<li>Use a Promise <code>catch</code> block or a <code>try</code>/<code>catch</code> statement with <code>async</code>/<code>await</code><br>
to properly handle errors thrown from within an asynchronous route handler (or<br>
middleware) function; and</li>
<li>Write a wrapper function to simplify catching errors thrown within<br>
asynchronous route handler (or middleware) functions.</li>
</ul>
<h2 class="mume-header" id="calling-asynchronous-functions-or-methods-within-route-handlers">Calling asynchronous functions or methods within route handlers</h2>

<p>To see how to properly call asynchronous functions or methods within route<br>
handlers, you need an asynchronous function or method to call.</p>
<h3 class="mume-header" id="creating-a-simple-asynchronous-function">Creating a simple asynchronous function</h3>

<p>In a future article, you&apos;ll see how to integrate your Express application with a<br>
database. For now keep things as simple as possible by creating a standalone<br>
function that wraps the built-in <code>setTimeout()</code> function in a Promise:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">/**
* Asynchronous function that delays for the provided length of time.
* If the length of time to wait is less than &apos;0&apos;, then the returned
* Promise will reject, otherwise it&apos;ll resolve.
* @param {number} timeToWait - The length of time to wait in milliseconds.
*/</span>
<span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">timeToWait</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>timeToWait <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error has occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`All done waiting for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timeToWait<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms!`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>timeToWait<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The above <code>delay()</code> function accepts a <code>timeToWait</code> value and returns a new<br>
Promise that calls the <code>setTimeout()</code> function passing in the <code>timeToWait</code><br>
absolute value. When the <code>setTimeout()</code> function call completes, the Promise is<br>
resolved if the <code>timeToWait</code> value is a positive number or it&apos;s rejected if the<br>
<code>timeToWait</code> value is a negative number.</p>
<blockquote>
<p><strong>Note:</strong> The <code>Math.abs()</code> function is used to get the absolute value of the<br>
<code>timeToWait</code> parameter value. Getting the absolute value ensures that the<br>
value passed to the <code>setTimeout()</code> function is always a positive number. For<br>
more information about absolute values, see <a href="https://en.wikipedia.org/wiki/Absolute_value">this Wikipedia page</a>.</p>
</blockquote>
<h3 class="mume-header" id="setting-up-the-express-application">Setting up the Express application</h3>

<p>With your <code>delay()</code> function in hand, use it to create a simple Express<br>
application:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Asynchronous function that delays for the provided length of time.
* If the length of time to wait is less than &apos;0&apos;, then the returned
* Promise will reject, otherwise it&apos;ll resolve.
* @param {number} timeToWait - The length of time to wait in milliseconds.
*/</span>
<span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">timeToWait</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>timeToWait <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error has occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`All done waiting for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timeToWait<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms!`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>timeToWait<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><strong>Note:</strong> If you&apos;re following along, don&apos;t forget to use npm to install<br>
Express (i.e. <code>npm install express</code>)!</p>
</blockquote>
<p>Now call the <code>delay()</code> function within your route handler function. Remember<br>
that the <code>delay()</code> function returns a Promise, so you can use the Promise<br>
<code>then()</code> method to execute code when the <code>delay()</code> method completes. Within the<br>
callback that you pass to the <code>then()</code> method, send the value returned from the<br>
<code>delay()</code> function to the client using the <code>res.send()</code> method:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>If you start your application (i.e. <code>node app.js</code>) and browse to<br>
<code>http://localhost:8080/</code> you&apos;ll see that the request hangs for 5 seconds before<br>
the server sends the response &quot;All done waiting for 5000ms!&quot;</p>
<p>Feel free to experiment by varying the number of milliseconds that you&apos;re<br>
passing to the <code>delay()</code> function. For now, continue to pass a positive number;<br>
we&apos;ll see in just a moment what happens when we pass a negative number.</p>
<h3 class="mume-header" id="using-asyncawait">Using <code>async</code>/<code>await</code></h3>

<p>Instead of using the Promise <code>then()</code> method to execute code when an<br>
asynchronous function or method call has completed, you can use the <code>await</code><br>
keyword.</p>
<p>Start with adding the <code>async</code> keyword to your route handler function to indicate<br>
that it&apos;s going to make an asynchronous function or method call. Then use the<br>
<code>await</code> keyword to wait for a result to be returned from the <code>delay()</code> function<br>
call:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>If you test your application again you&apos;ll see that it behaves the same as it did<br>
before&#x2014;the request hangs for 5 seconds before the server sends the response &quot;All<br>
done waiting for 5000ms!&quot;</p>
<h3 class="mume-header" id="catching-errors-thrown-by-asynchronous-functions-or-methods">Catching errors thrown by asynchronous functions or methods</h3>

<p>So far, you&apos;ve stayed on the &quot;happy&quot; path by passing a positive number to the<br>
<code>delay()</code> function. If you pass a negative number to the <code>delay()</code> function,<br>
it&apos;ll throw an error:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This time when testing your application, the browser will indefinitely hang as<br>
it waits for the server to return a response. If you look in the terminal,<br>
you&apos;ll see that an error occurred:</p>
<pre data-role="codeBlock" data-info class="language-"><code>(node:89455) UnhandledPromiseRejectionWarning: Error: An error has occurred!
    at Timeout._onTimeout ([path to the project folder]/app.js:13:14)
    at listOnTimeout (internal/timers.js:537:17)
    at processTimers (internal/timers.js:481:7)
(node:89455) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 1)
(node:89455) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.
</code></pre><p>Node.js is warning you that an unhandled Promise rejection occurred.<br>
Furthermore, it&apos;s warning that in a future version of Node, unhandled Promise<br>
rejections will terminate the Node process (which would result in your<br>
application being stopped)!</p>
<p>Luckily, this issue is easy to deal with&#x2014;simply add a <code>try</code>/<code>catch</code> statement<br>
around your asynchronous function or method call:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice that you need to add the <code>next</code> parameter to your route handler function<br>
parameter list and pass the caught error to the <code>next()</code> method in the <code>catch</code><br>
block. Passing the error to the <code>next()</code> method allows the Express default error<br>
handler process the error.</p>
<blockquote>
<p><strong>Note:</strong> When writing custom middleware functions, calling the <code>next()</code><br>
method <strong>without an argument</strong> passes control to the next middleware function.<br>
Calling the <code>next()</code> method <strong>with an argument</strong> results in Express handling<br>
the current request as an error and skipping any remaining routing and<br>
middleware functions.</p>
</blockquote>
<p>The Express default error handler is a special type of middleware function<br>
that&apos;s responsible for handling errors. In a development environment, the<br>
default error handler logs the error to the console and sends a response with an<br>
HTTP status code of <code>500 Internal Server Error</code> to the client containing the<br>
error message along with the stack trace.</p>
<p>If you test your application again, you&apos;ll see the default error handler in<br>
action as it provides details about the unhandled error that occurred after the<br>
<code>delay()</code> function has waited for the number of milliseconds that you passed in:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Error: An error has occurred!
   at Timeout._onTimeout ([path to the project folder]/app.js:13:14)
   at listOnTimeout (internal/timers.js:537:17)
   at processTimers (internal/timers.js:481:7)
</code></pre><p>If you&apos;re not using the <code>async</code>/<code>await</code> keywords, you need to call the <code>catch()</code><br>
method on the Promise returned by the <code>delay()</code> function to handle any thrown<br>
errors:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Again, notice that you need to add the <code>next</code> parameter to your route handler<br>
function parameter list and call the <code>next()</code> method passing in the error caught<br>
by the <code>catch()</code> method.</p>
<p>If you&apos;re only passing the error to the <code>next()</code> method, you can simplify your<br>
code by passing the reference to the <code>next()</code> method directly to the <code>catch()</code><br>
method call:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Express is able to automatically catch errors thrown by synchronous route<br>
handlers. When performing asynchronous operations within route handlers, it&apos;s<br>
important to remember that <strong>Express is unable to catch errors thrown by<br>
asynchronous route handlers</strong>. Given that, asynchronous route handlers need to<br>
catch their own errors and pass them to the <code>next()</code> method.</p>
<blockquote>
<p><strong>Note:</strong> While all of the examples that you&apos;ve seen in this article are built<br>
around route handlers, everything that&apos;s been shown and discussed equally<br>
applies to asynchronous custom middleware functions.</p>
</blockquote>
<h2 class="mume-header" id="reducing-boilerplate-code">Reducing boilerplate code</h2>

<p>Adding a <code>try</code>/<code>catch</code> statement to each route handler function that needs to<br>
call an asynchronous function or method can result in a lot of boilerplate code.<br>
If your application only has a handful of routes that&apos;s probably not an issue,<br>
but if your application has dozens of routes (or more), it&apos;s worth taking a look<br>
at how you can reduce the amount of boilerplate code you need to write.</p>
<h3 class="mume-header" id="writing-an-asynchronous-route-handler-wrapper-function">Writing an asynchronous route handler wrapper function</h3>

<p>One approach to avoiding writing boilerplate code is to write a simple<br>
asynchronous route handler wrapper function to catch errors.</p>
<p>Start by defining a function named <code>asyncHandler</code> that accepts a reference to a<br>
route handler function and returns a function that defines three parameters,<br>
<code>req</code>, <code>res</code>, and <code>next</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Then, within the function that&apos;s being returned, call the passed in route<br>
handler function (i.e. the <code>handler</code> parameter), passing in the <code>req</code>, <code>res</code>,<br>
and <code>next</code> parameters:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>And finally, call the <code>catch()</code> method on the Promise returned from the route<br>
handler function passing in the <code>next</code> parameter:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Remember, passing the <code>next</code> parameter to the <code>catch()</code> method allows the<br>
Express default error handler to process any errors thrown by the route handler<br>
function.</p>
<p>Because each of the arrow functions return a single statement, the<br>
<code>asyncHandler()</code> function can optionally be written a little more concisely:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><strong>Note:</strong> Developers sometimes find the more concise version to be more<br>
difficult to read and understand, so if you&apos;re working on a team, talk with<br>
your teammates and determine which approach is the team&apos;s preferred approach.</p>
</blockquote>
<h3 class="mume-header" id="using-the-asynchronous-route-handler-wrapper-function">Using the asynchronous route handler wrapper function</h3>

<p>As a reminder, this is what your asynchronous route handler currently looks<br>
like:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Wrapping your asynchronous route handler with your <code>asyncHandler()</code> helper<br>
function looks like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Because the <code>asyncHandler()</code> function is calling the <code>catch()</code> method on the<br>
Promise that&apos;s returned from the asynchronous route handler you can safely<br>
remove the <code>try</code>/<code>catch</code> statement. This makes asynchronous route handlers<br>
cleaner and easier to read and maintain.</p>
<blockquote>
<p><strong>Note:</strong> You might wonder how the <code>asyncHandler()</code> function can successfully<br>
call the <code>catch()</code> method after invoking the asynchronous route handler<br>
function if the route handler function doesn&apos;t explicitly return a Promise.<br>
Remember that marking a function or method with the <code>async</code> keyword results in<br>
that function or method implicitly returning a Promise. Your asynchronous<br>
route handler is marked as an <code>async</code> function, so it implicitly returns a<br>
Promise.</p>
</blockquote>
<h2 class="mume-header" id="what-you-learned-8">What you learned</h2>

<p>In this article, you learned</p>
<ul>
<li>that Express cannot process unhandled Promise rejections from within a route<br>
handler (or middleware) function;</li>
<li>how to use a Promise <code>catch</code> block or a <code>try</code>/<code>catch</code> statement with<br>
<code>async</code>/<code>await</code> to properly handle errors thrown from within asynchronous<br>
route handler (or middleware) function; and</li>
<li>how to write a wrapper function to simplify catching errors thrown within<br>
asynchronous route handler (or middleware) functions.</li>
</ul>
<h2 class="mume-header" id="see-also-3">See also&#x2026;</h2>

<p>While writing a wrapper function for your asynchronous route handler function is<br>
easy to do, you can also use an npm package to accomplish the same thing without<br>
having to write any extra code. If you&apos;re interested to see what this looks<br>
like, check out the <a href="https://www.npmjs.com/package/express-promise-router"><code>express-promise-router</code> npm<br>
package</a>.</p>
<hr>
<h1 class="mume-header" id="handling-errors-in-express">Handling Errors in Express</h1>

<p>No matter how hard we try, we all make mistakes when writing code. If you&apos;re<br>
lucky, the coding mistake will break the execution of the application in a very<br>
obvious way&#x2014;crashing the application when testing in the local development<br>
environment. If you&apos;re unlucky, the coding mistake will go unnoticed, only to<br>
surface as an unexpected error when the application is being used by end users.</p>
<p>When an unexpected error occurs, the default error handler in Express will send<br>
a response to the browser containing the error message along with the stack<br>
trace (if you&apos;re not running in a production environment). While the default<br>
error handler might work fine in your local development environment, for most<br>
applications you&apos;ll want to create a custom error handler to precisely control<br>
how errors are handled in other environments (i.e. test, staging, or<br>
production).</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Describe how an error handler function differs from middleware and route<br>
handler functions;</li>
<li>Define a global error-handling function to catch and process unhandled errors;<br>
and</li>
<li>Define a route to handle requests for unknown routes by throwing a 404 NOT<br>
FOUND error.</li>
</ul>
<h2 class="mume-header" id="setting-up-an-example-express-application">Setting up an example Express application</h2>

<p>Let&apos;s create a simple application to assist with exploring how to handle errors<br>
in Express.</p>
<p>Create a folder for your project (if you haven&apos;t already), open a terminal and<br>
browse to your project folder, and run the following commands:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> init -y
<span class="token function">npm</span> <span class="token function">install</span> express@^4.0.0 pug@^2.0.0
<span class="token function">npm</span> <span class="token function">install</span> nodemon --save-dev
</pre><blockquote>
<p><strong>Important:</strong> If you&apos;re using Git, don&apos;t forget to add a <code>.gitignore</code> file in<br>
the root of your project folder that contains an entry to ignore the<br>
<code>node_modules</code> folder! The <code>node_modules</code> folder tends to be very large and<br>
would bloat the Git repository if it was committed and pushed. Ignoring the<br>
<code>node_modules</code> folder is possible because it can be generated on demand by<br>
running the <code>npm install</code> command.</p>
</blockquote>
<p>Add an <code>app.js</code> file to the root of your project containing the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/throw-error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Next, define an npm <code>start</code> script in your <code>package.json</code> file that uses Nodemon<br>
to run the application:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
 <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;handling-errors-in-express&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app.js&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.1&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;pug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.4&quot;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;nodemon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.2&quot;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p><strong>Pro Tip:</strong> Creating scripts in the <code>package.json</code> file allows you to<br>
customize and rename often used terminal commands. For example, the above<br>
<code>&quot;start&quot;: &quot;nodemon app.js&quot;</code> script allows you to run <code>npm start</code> instead of<br>
<code>npx nodemon app.js</code> in your terminal to run the application.</p>
</blockquote>
<p>The last bit of set up business is to create a couple of Pug views. Add a<br>
<code>views</code> folder to the root of the project. Then add two files to the <code>views</code><br>
folder: <code>layout.pug</code> and <code>index.pug</code>:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- layout.pug</span>

<span class="token doctype">doctype html</span>
<span class="token tag">html</span>
 <span class="token tag">head</span>
   <span class="token tag">title</span> <span class="token plain-text">Custom Error Handlers - #{title}</span>
 <span class="token tag">body</span>
   <span class="token tag">h1</span> <span class="token plain-text">Custom Error Handlers</span>
   <span class="token tag">h2</span><span class="token punctuation">=</span><span class="token code"> title</span>
   <span class="token tag">div</span>
     <span class="token keyword">block content</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- index.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">p</span> <span class="token plain-text">Welcome to the Custom Error Handlers project!</span>
</pre><p>Now you&apos;re ready to run and test your application! From the terminal, run the<br>
command <code>npm start</code>, then browse to the URL <code>http://localhost:8080/</code>. You should<br>
see the application&apos;s Home page.</p>
<h2 class="mume-header" id="the-default-error-handler-in-express">The default error handler in Express</h2>

<p>After an error is thrown or the <code>next()</code> method is called with an argument from<br>
within a route handler, Express will handle the error using its default error<br>
handler.</p>
<p>You can see the default error handler in action by starting the example<br>
application (i.e. <code>npm start</code>) and browsing to<br>
<code>http://localhost:8080/throw-error</code>. The default error handler will send a<br>
response to the browser containing the error message along with the stack trace:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Error: An error occurred!
   at throwError ([path to the project folder]/app.js:14:9)
   at [path to the project folder]/app.js:29:3
   at Layer.handle [as handle_request] ([path to the project folder]/node_modules/express/lib/router/layer.js:95:5)
   at next ([path to the project folder]/node_modules/express/lib/router/route.js:137:13)
   at Route.dispatch ([path to the project folder]/node_modules/express/lib/router/route.js:112:3)
   at Layer.handle [as handle_request] ([path to the project folder]/node_modules/express/lib/router/layer.js:95:5)
   at [path to the project folder]/node_modules/express/lib/router/index.js:281:22
   at Function.process_params ([path to the project folder]/node_modules/express/lib/router/index.js:335:12)
   at next ([path to the project folder]/node_modules/express/lib/router/index.js:275:10)
   at expressInit ([path to the project folder]/node_modules/express/lib/middleware/init.js:40:5)
</code></pre><blockquote>
<p><strong>Note:</strong> If you&apos;re following along, the placeholder text &quot;[path to the<br>
project folder]&quot; in the above error stack trace information will display the<br>
actual absolute path to your project folder.</p>
</blockquote>
<p>The response will also have an HTTP status code of <code>500 Internal Server Error</code>.<br>
You can view the response&apos;s HTTP status code by inspecting the network<br>
information using your browser&apos;s developer tools.</p>
<h3 class="mume-header" id="do-you-need-a-custom-error-handler">Do you need a custom error handler?</h3>

<p>If the <code>NODE_ENV</code> environment variable is set to &quot;production&quot;, then the default<br>
error handler will simply return a response with an HTTP status code of <code>500 Internal Server Error</code> containing the text &quot;Internal Server Error&quot;.</p>
<p>You can see this in action by setting the <code>NODE_ENV</code> environment variable before<br>
starting the example application:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">NODE_ENV<span class="token operator">=</span>production node app.js
</pre><p><img src="images/express-default-error-handler-in-production.png" alt="express-default-error-handler-in-production"></p>
<p>If an end user were to see the above error message in production, it would<br>
likely leave them frustrated and confused. While a custom error handler won&apos;t be<br>
able to magically resolve unexpected errors for your users, it will allow you to<br>
display a friendlier message using your website&apos;s layout template (you&apos;ll see<br>
how to do this later in this article).</p>
<p>Defining a custom error handler will also allow you to log unexpected errors so<br>
that you (or someone on your team) can review them periodically to determine if<br>
an undetected bug has made its way into production.</p>
<h2 class="mume-header" id="defining-a-custom-error-handler">Defining a custom error handler</h2>

<p>As you&apos;ve seen in earlier lessons, Express middleware functions define three<br>
parameters (<code>req</code>, <code>res</code>, <code>next</code>) and route handlers define two or three<br>
parameters (<code>req</code>, <code>res</code>, and optionally the <code>next</code> parameter):</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Middleware function.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from a middleware function!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Route handler function.</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello from a route handler function!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Error handling functions look the same as middleware functions except they<br>
define four parameters instead of three&#x2014;<code>err</code>, <code>req</code>, <code>res</code>, and <code>next</code>:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Custom error handler functions have to define four parameters otherwise Express<br>
won&apos;t recognize the function as an error handler. Route handler function<br>
definitions can omit the <code>next</code> parameter if it&apos;s not going to be used; error<br>
handler functions have to include the <code>next</code> parameter.</p>
<p>Define error handler functions after all other calls to <code>app.use()</code> and all of<br>
your application&apos;s route definitions:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/throw-error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Custom error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This ensures that your custom error handler will get called to handle errors<br>
from any of your application&apos;s middleware or route handler functions.</p>
<p>If you test your custom error handler by browsing to<br>
<code>http://localhost:8080/throw-error</code> you&apos;ll see that it sends a response<br>
containing the text &quot;An error occurred!&quot;.</p>
<p>If you use your browser&apos;s developer tools to inspect the response of<br>
<code>http://localhost:8080/throw-error</code>, you&apos;ll notice that the response HTTP status<br>
code is <code>200 OK</code>, which is the default status code used by Express when sending<br>
responses. You can use the <code>res.status()</code> method to set a different status code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Custom error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice how the <code>err.status</code> property is checked to see if it has a value before<br>
the status is set to the literal numeric value <code>500</code>. Giving priority to the<br>
<code>err.status</code> property allows code elsewhere in the application to throw an error<br>
that includes the specific HTTP status code to send to the client.</p>
<p>You can return an HTML response instead of plain text by rendering a Pug view:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Custom error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   title<span class="token punctuation">:</span> <span class="token string">&apos;Server Error&apos;</span><span class="token punctuation">,</span>
   message<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
   error<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Be sure to add the <code>error.pug</code> view to the <code>views</code> folder:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- error.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">div</span>
   <span class="token tag">p</span><span class="token punctuation">=</span><span class="token code"> message <span class="token operator">||</span> <span class="token string">&apos;An unexpected error occurred on the server.&apos;</span></span>
 <span class="token flow-control"><span class="token branch keyword">if</span> stack</span>
   <span class="token tag">h3</span> <span class="token plain-text">Stack Trace</span>
   <span class="token tag">pre</span><span class="token punctuation">=</span><span class="token code"> stack</span>
</pre><p>Notice that the error <code>message</code> and <code>stack</code> properties are only being passed to<br>
the view if the <code>NODE_ENV</code> environment variable isn&apos;t set to &quot;production&quot;. For<br>
security reasons, it&apos;s important to avoid leaking potentially sensitive<br>
information about your application.</p>
<p>If you test your custom error handler again by browsing to<br>
<code>http://localhost:8080/throw-error</code> you&apos;ll see that it sends an HTML response<br>
containing information about the error that was thrown.</p>
<p>To test how the error handler will behave in the production environment, set the<br>
<code>NODE_ENV</code> environment variable to &quot;production&quot; before starting the example<br>
application:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">NODE_ENV<span class="token operator">=</span>production node app.js
</pre><h3 class="mume-header" id="defining-multiple-custom-error-handlers">Defining multiple custom error handlers</h3>

<p>Express allows you to define more than one custom error handler which is useful<br>
if you need to handle specific types of errors differently. It&apos;s also useful for<br>
creating an error handler to perform a specific error handling task. Let&apos;s look<br>
at an example of defining a second error handler that&apos;s responsible for logging<br>
errors.</p>
<p>Error handlers, like route handlers, are executed by Express in the order that<br>
they&apos;re defined in, so defining a new error handler before the existing handler<br>
ensures that it&apos;ll be called first:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Custom error handlers.</span>

<span class="token comment">// Error handler to log errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO Log the error to the database.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generic error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Server Error&apos;</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
    stack<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The new error handler simply uses the <code>console.error()</code> method to log errors to<br>
the console, provided that the <code>NODE_ENV</code> environment variable isn&apos;t set to<br>
&quot;production&quot;. In the production environment, there&apos;s a TODO comment to log the<br>
error to the database. The <code>console.error()</code> method call in the existing error<br>
handler was removed; logging errors is now the responsibility of the new error<br>
handler.</p>
<blockquote>
<p><strong>Note:</strong> Logging errors to a database&#x2014;or another type of data store&#x2014;is a<br>
common practice in production environments. Doing this allows a developer or<br>
system administrator to periodically review a log of application errors to<br>
determine if there are any issues that might need to be looked at in more<br>
detail. There are many ways to handle error logging, ranging from npm logging<br>
packages (e.g. <a href="https://www.npmjs.com/package/winston"><code>winston</code></a>) to full-blown application<br>
monitoring cloud-based services.</p>
</blockquote>
<p>Also notice that the new error handler calls the <code>next()</code> method passing in the<br>
<code>err</code> parameter (the current error) which passes control to the next error<br>
handler. An error handler needs to call <code>next()</code> or return a response. Failing<br>
to do this will result in the request &quot;hanging&quot; and consuming resources on the<br>
server.</p>
<h2 class="mume-header" id="handling-page-not-found-errors">Handling &quot;Page Not Found&quot; errors</h2>

<p>A common feature for applications to implement is to present a friendly &quot;Page<br>
Not Found&quot; message to end users when a request can&apos;t be matched to one of the<br>
application&apos;s defined routes. Let&apos;s see how to implement this feature using a<br>
combination of a middleware function and an error handler function.</p>
<p>First, add a new middleware function after the last route in your application<br>
(but before any of your error handlers):</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Catch unhandled requests and forward to error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The requested page couldn\&apos;t be found.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
 <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Placing this middleware function after all of your routes means that this<br>
middleware function will only be invoked if a request fails to match any of your<br>
routes.</p>
<p>Notice that the middleware function creates a new Error object and sets a<br>
<code>status</code> property on the object to the literal number <code>404</code>. <code>404</code> is the HTTP<br>
status code for &quot;Not Found&quot; responses indicating that the requested resource<br>
could not be found.</p>
<p>After setting the <code>status</code> property, the <code>next()</code> method is called with the<br>
<code>err</code> variable passed as an argument. Remember that calling the <code>next()</code> method<br>
with an argument results in Express handling the current request as an error and<br>
skipping any remaining routing and middleware functions.</p>
<p>At this point, you can test your &quot;Page Not Found&quot; middleware function by<br>
browsing to <code>http://localhost:8080/some-unknown-page</code> (or really any path that<br>
doesn&apos;t match one of your application&apos;s configured routes). You should see your<br>
&quot;Server Error&quot; page displaying the message &quot;The requested page couldn&apos;t be<br>
found.&quot;</p>
<h3 class="mume-header" id="creating-a-page-not-found-page">Creating a &quot;Page Not Found&quot; page</h3>

<p>While the current solution works, a more elegant solution would be to present a<br>
specific &quot;Page Not Found&quot; page to the end user.</p>
<p>To do this, define another error handler&#x2014;in between the logging and generic<br>
error handlers&#x2014;for handling 404 errors:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Error handler for 404 errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;page-not-found&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Page Not Found&apos;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>This error handler starts by checking if the <code>err.status</code> property is set to<br>
<code>404</code>&#x2014;which indicates that the current error is a &quot;Not Found&quot; error. If the<br>
current error is a &quot;Not Found&quot; error, then it sets the response HTTP status code<br>
to <code>404</code> and calls the <code>res.render()</code> method to render the <code>page-not-found</code> view<br>
(you&apos;ll create that view in just a bit). Otherwise, the <code>next()</code> method is<br>
called with the <code>err</code> parameter passed as an argument, which passes control to<br>
the next error handler.</p>
<p>Before testing your new error handler, don&apos;t forget to add a new view named<br>
<code>page-not-found.pug</code> to the <code>views</code> folder with the following content:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- page-not-found.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">div</span>
   <span class="token tag">p</span> <span class="token plain-text">Sorry, we couldn&apos;t find the page that you requested.</span>
</pre><p>Now if you test your application again by browsing to<br>
<code>http://localhost:8080/some-unknown-page</code> (or any path that doesn&apos;t match one of<br>
your application&apos;s configured routes) you should see your new &quot;Page Not Found&quot;<br>
page.</p>
<p>For your reference, here&apos;s the final version of the <code>app.js</code> file:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the Express app.</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the pug view engine.</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define routes.</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/throw-error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;An error occurred!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Catch unhandled requests and forward to error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The requested page couldn\&apos;t be found.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Custom error handlers.</span>

<span class="token comment">// Error handler to log errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO Log the error to the database.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Error handler for 404 errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;page-not-found&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Page Not Found&apos;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generic error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Server Error&apos;</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
    stack<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="what-you-learned-9">What you learned</h2>

<p>In this article, you learned</p>
<ul>
<li>how an error handler function differs from middleware and route handler<br>
functions;</li>
<li>how to define a global error-handling function to catch and process unhandled<br>
errors; and</li>
<li>how to define a route to handle requests for unknown routes by throwing a 404<br>
NOT FOUND error.</li>
</ul>
<hr>
<h1 class="mume-header" id="data-driven-websites-part-1-setting-up-the-project">Data-Driven Websites - Part 1: Setting Up the Project</h1>

<p>Data-driven websites are everywhere online. From e-commerce websites to search<br>
websites to mega social media websites, data is the foundation of the dynamic,<br>
personalized experiences that users have come to expect of the Web.</p>
<p>You&apos;ve learned all of the necessary skills&#x2014;now it&apos;s time to bring it all<br>
together to create a data-driven website using Express!</p>
<p>Over the next three articles, you&apos;ll create a data-driven Reading List website<br>
that will allow you to view a list of books, add a book to the list, update a<br>
book in the list, and delete a book from the list. In this article, you&apos;ll set<br>
up the project. In the next article, you&apos;ll learn how to integrate Sequelize<br>
with an Express application. In the last article, you&apos;ll create the routes and<br>
views to perform CRUD (create, read, update, and delete) operations using<br>
Sequelize.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Split the Express application and HTTP server into separate modules;</li>
<li>Use the <code>morgan</code> npm package to log requests; and</li>
<li>Add support for the Bootstrap front-end component library to your<br>
application&apos;s Pug layout template.</li>
</ul>
<p>You&apos;ll also review the following:</p>
<ul>
<li>Setting up a new Express project;</li>
<li>Stubbing out an Express application;</li>
<li>Adding custom error handlers to an Express application; and</li>
<li>Configuring environment variables.</li>
</ul>
<h2 class="mume-header" id="setting-up-the-project-1">Setting up the project</h2>

<p>First things first, create a folder for your project. If you&apos;re using source<br>
control (and you are&#x2014;right?), open a terminal, browse to your project folder,<br>
and initialize your Git repository by running the command <code>git init</code>.</p>
<p>You&apos;ll be using npm to install packages in just a bit, so be sure to add a<br>
<code>.gitignore</code> file to the root of your project. Then add the entry<br>
<code>node_modules/</code> to the <code>.gitignore</code> file so that the <code>node_modules</code> folder<br>
(where npm downloads packages to) won&apos;t be tracked by Git.</p>
<blockquote>
<p><strong>Pro Tip:</strong> While configuring Git to not track the <code>node_modules</code> folder is<br>
important to do, it&apos;s not necessarily the only thing you want to configure Git<br>
not to track. For a more comprehensive <code>.gitignore</code> file for Node.js projects,<br>
you can use <a href="https://github.com/github/gitignore/blob/master/Node.gitignore">GitHub&apos;s <code>.gitignore</code> file for Node.js projects</a>.</p>
</blockquote>
<h3 class="mume-header" id="initializing-npm-and-installing-dependencies">Initializing npm and installing dependencies</h3>

<p>Before you stub out the application, use npm to initialize your project and<br>
install the following dependencies:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> init -y
<span class="token function">npm</span> <span class="token function">install</span> express@^4.0.0 pug@^2.0.0
</pre><p>Then install Nodemon as a development dependency:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> nodemon@^2.0.0 --save-dev
</pre><h2 class="mume-header" id="stubbing-out-the-application">Stubbing out the application</h2>

<p>Now it&apos;s time to stub out the application by writing the minimal amount of code<br>
to define the route for the default route (i.e. the &quot;Home&quot; page).</p>
<p>Start with adding a <code>routes</code> module by adding a file named <code>routes.js</code> to the<br>
root of your project containing the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><p>The default route renders the <code>index</code> view which you&apos;ll create in just a bit.</p>
<p>Next, add the <code>app</code> module (<code>app.js</code>) to the root of your project containing the<br>
following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>To stub out the initial views for the application, add a folder named <code>views</code> to<br>
the root of the project. Then add two Pug templates to the <code>views</code><br>
folder&#x2014;<code>layout.pug</code> and <code>index.pug</code> containing the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/layout.pug</span>

<span class="token doctype">doctype html</span>
<span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">title</span> <span class="token plain-text">Reading List - #{title}</span>
  <span class="token tag">body</span>
    <span class="token tag">h1</span> <span class="token plain-text">Reading List</span>
    <span class="token tag">div</span>
      <span class="token tag">h2</span> <span class="token plain-text">#{title}</span>
      <span class="token keyword">block content</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/index.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">p</span> <span class="token plain-text">Hello from the Reading List app!</span>
</pre><p>The <code>layout.pug</code> template provides the overall HTML for each page in the<br>
application while the <code>index.pug</code> template provides the HTML for the index or<br>
default page for the application.</p>
<p>All four of these files&#x2014;<code>routes.js</code>, <code>app.js</code>, <code>layout.pug</code>, and<br>
<code>index.pug</code>&#x2014;will evolve and change as you add features to the Reading List<br>
application.</p>
<h3 class="mume-header" id="testing-the-initial-application-setup">Testing the initial application setup</h3>

<p>It&apos;s time to test your initial application setup before you make any further<br>
changes.</p>
<p>Open the <code>package.json</code> file and replace the placeholder npm <code>test</code> script (that<br>
was generated by npm) with the following <code>start</code> script:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span>
<span class="token punctuation">}</span>
</pre><p>From the terminal, run the command <code>npm start</code> to start your application, then<br>
browse to <code>http://localhost:8080/</code>. You should see the &quot;Home&quot; page displaying<br>
the message &quot;Hello from the Reading List app!&quot;</p>
<blockquote>
<p><strong>Now is a good time to commit your changes (if you haven&apos;t already)!</strong> In<br>
general, making smaller commits more often where each commit contains a<br>
related set of changes is better than waiting until the end of the day to make<br>
one giant commit that contains all of the changes for the entire day.</p>
</blockquote>
<h2 class="mume-header" id="splitting-the-application-and-server-into-separate-modules">Splitting the application and server into separate modules</h2>

<p>Now that you&apos;ve created a simple, initial version of the application, it&apos;s time<br>
to start adding additional features and making general improvements to the<br>
overall design of the application.</p>
<p>Up until this point, you&apos;ve created your Express application and started the<br>
HTTP server within the same module&#x2014;the <code>app</code> module. A common practice is to<br>
separate the application and server into separate modules. Doing this has the<br>
following benefits:</p>
<ul>
<li><strong>Improved separation of concerns:</strong> As much as possible, each module in your<br>
application should be responsible for doing one thing and only one thing.<br>
Separating out the server setup and startup into its own module improves the<br>
overall separation of concerns by allowing the <code>app</code> module to only be<br>
responsible for creating the Express application.</li>
<li><strong>Improved testability:</strong> Removing the startup of the HTTP server from the<br>
<code>app</code> module improves the testability of the Express application. While you<br>
won&apos;t be writing tests for your Express application in this project,<br>
establishing good coding practices will set you up to write tests for your<br>
application in the future.</li>
</ul>
<h3 class="mume-header" id="updating-the-app-module">Updating the <code>app</code> module</h3>

<p>The last two statements in the <code>app</code> module (<code>app.js</code>) are responsible for<br>
defining a port and starting the server listening for HTTP connections:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Go ahead and remove that code. In its place, add this line of code to export the<br>
Express application from the module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><p>For reference, here&apos;s what the complete <code>app</code> module should look like at this<br>
point:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="defining-a-new-entry-point-for-the-application">Defining a new entry point for the application</h3>

<p>As a reminder, the npm <code>start</code> script currently looks like this:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span>
<span class="token punctuation">}</span>
</pre><p>Nodemon is being used to start the application and to restart the application<br>
when a change is made to any of the files in the project. The <code>app.js</code> file is<br>
provided as the entry point for the application&#x2014;the module that&apos;s responsible<br>
for configuring and starting the application.</p>
<p>Now that the <code>app</code> module doesn&apos;t start the server listening for HTTP<br>
connections, it can no longer be used as the entry point for the application. To<br>
create a new entry point for the application, add a folder named <code>bin</code> to the<br>
root of the project. Then add a file named <code>www</code> (with no <code>.js</code> extension)<br>
containing the following code. Make sure <code>#!/usr/bin/env node</code> is on the first<br>
line of your file:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../app&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a port and start listening for connections.</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Then update the npm <code>start</code> script to pass the <code>www</code> file into Nodemon as the<br>
entry point:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon ./bin/www&quot;</span>
<span class="token punctuation">}</span>
</pre><p>To test your application&apos;s new entry point, run the command <code>npm start</code>, then<br>
browse to <code>http://localhost:8080/</code>. As before, you should see the &quot;Home&quot; page<br>
displaying the message &quot;Hello from the Reading List app!&quot;</p>
<h3 class="mume-header" id="taking-a-closer-look-at-the-binwww-file">Taking a closer look at the <code>./bin/www</code> file</h3>

<p>The <code>bin</code> folder is a common Unix convention for naming a folder that contains<br>
executable scripts. Even though it&apos;s lacking the <code>.js</code> file extension, the <code>www</code><br>
file is actually a JavaScript module that contains the code to start up the<br>
Express application.</p>
<p>You might have noticed that the first line of the <code>www</code> file isn&apos;t valid<br>
JavaScript:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
</pre><p>This is an instance of a <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">Unix shebang</a>. The shebang has to<br>
be written on the first line of the <code>www</code> file. It tells the system what<br>
interpreter to pass the file to for execution. In this case, <code>node</code> is specified<br>
as the interpreter via the Unix <code>env</code> command.</p>
<p>The intention of the <code>./bin/www</code> file is for it to be an executable<br>
script&#x2014;meaning that you could start the application by simply entering the file<br>
name in the terminal as a command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">bin/www
</pre><p>If you attempt to execute the script, you&apos;ll receive a &quot;permission denied&quot;<br>
error. Text files by default do not have the necessary permissions. You can use<br>
the <code>chmod</code> command in the root of your project to add the missing permissions:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">chmod</span> +x bin/www
</pre><p>With the proper permissions added, you can run the command <code>bin/www</code> to start<br>
your application.</p>
<blockquote>
<p><strong>Note:</strong> The ability to run your application via a <code>bin</code> script is primarily<br>
useful for Node projects that are intended to be used as command line tools or<br>
utilities. The Sequelize CLI is an example of a Node.js command line tool<br>
that&apos;s executable via a <code>bin</code> folder script. For Express applications like the<br>
Reading List application, it&apos;s far more common to use an npm <code>start</code> script to<br>
run the application.</p>
</blockquote>
<h2 class="mume-header" id="logging-requests-using-morgan">Logging requests using Morgan</h2>

<p>Currently, after the application starts up and displays the message &quot;Listening<br>
on port 8080...&quot;, nothing else is written to the console to show activity. To<br>
assist with testing and debugging, you can install the <code>morgan</code> npm package, an<br>
HTTP request logger middleware for Node.js and Express:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> morgan
</pre><p>Aftering installing <code>morgan</code>, import it into the <code>app</code> module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> morgan <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;morgan&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><strong>Code organization tip:</strong> Notice how the external modules are imported first<br>
and grouped together followed by the imported internal modules. While this<br>
isn&apos;t a hard requirement, it can help make it easier to read a module&apos;s<br>
dependencies.</p>
</blockquote>
<p>Then call the <code>app.use()</code> method to add <code>morgan</code> to the application request<br>
pipeline:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">&apos;dev&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The string literal &quot;dev&quot; is passed into <code>morgan</code> to configure the request<br>
logging format. The &quot;dev&quot; format is just one of the available predefined<br>
formats.</p>
<p>Now if you start your application and browse to <code>http://localhost:8080/</code>, you&apos;ll<br>
see the request logged to the console:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">GET / 200 9.851 ms - 172
</pre><p>Here&apos;s a breakdown of the above output:</p>
<ul>
<li><code>GET</code> - The request HTTP method</li>
<li><code>/</code> - The request path</li>
<li><code>9.851 ms</code> - The response time in milliseconds</li>
<li><code>172</code> - The <code>Content-Length</code> response header value that indicates the size of<br>
the response body in bytes</li>
</ul>
<h2 class="mume-header" id="adding-custom-error-handlers">Adding custom error handlers</h2>

<p>As you learned in a previous article, Express provides a default error handler,<br>
but for most applications you&apos;ll want to create a custom error handler to<br>
precisely control how errors are handled.</p>
<p>In the <code>app</code> module, start with adding a middleware function to catch unmatched<br>
requests and throw a &quot;Page Not Found&quot; error:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token comment">// Code remove for brevity.</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Catch unhandled requests and forward to error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The requested page couldn\&apos;t be found.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// TODO Add custom error handlers.</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><p>Next, add the following custom error handlers&#x2014;an error handler to log errors, an<br>
error handler to handle &quot;Page Not Found&quot; errors, and a generic error handler:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token comment">// Code remove for brevity.</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Catch unhandled requests and forward to error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The requested page couldn\&apos;t be found.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Custom error handlers.</span>

<span class="token comment">// Error handler to log errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// TODO Log the error to the database.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Error handler for 404 errors.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;page-not-found&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Page Not Found&apos;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generic error handler.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&apos;production&apos;</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Server Error&apos;</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
    stack<span class="token punctuation">:</span> isProduction <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><p>To complete your custom error handlers, add two views to the <code>views</code><br>
folder&#x2014;<code>error.pug</code> and <code>page-not-found.pug</code>:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- error.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">div</span>
   <span class="token tag">p</span><span class="token punctuation">=</span><span class="token code"> message <span class="token operator">||</span> <span class="token string">&apos;An unexpected error occurred on the server.&apos;</span></span>
 <span class="token flow-control"><span class="token branch keyword">if</span> stack</span>
   <span class="token tag">h3</span> <span class="token plain-text">Stack Trace</span>
   <span class="token tag">pre</span><span class="token punctuation">=</span><span class="token code"> stack</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- page-not-found.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
 <span class="token tag">div</span>
   <span class="token tag">p</span> <span class="token plain-text">Sorry, we couldn&apos;t find the page that you requested.</span>
</pre><h3 class="mume-header" id="testing-your-custom-error-handlers">Testing your custom error handlers</h3>

<p>To test your custom error handlers, update the default route (<code>/</code>) in the<br>
<code>routes</code> module to temporarily throw an error:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;This is a test error!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Start your application and browse to <code>http://localhost:8080/</code> and you should see<br>
the &quot;Server Error&quot; page. Next, browse to an unknown path like<br>
<code>http://localhost:8080/asdf</code> and you should see the &quot;Page Not Found&quot; page.</p>
<p>You should also see the errors logged to the terminal:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">Error: This is a <span class="token function">test</span> error<span class="token operator">!</span>
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/routes.js:7:9
    at Layer.handle <span class="token punctuation">[</span>as handle_request<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/layer.js:95:5<span class="token punctuation">)</span>
    at next <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/route.js:137:13<span class="token punctuation">)</span>
    at Route.dispatch <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/route.js:112:3<span class="token punctuation">)</span>
    at Layer.handle <span class="token punctuation">[</span>as handle_request<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/layer.js:95:5<span class="token punctuation">)</span>
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:281:22
    at Function.process_params <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:335:12<span class="token punctuation">)</span>
    at next <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:275:10<span class="token punctuation">)</span>
    at Function.handle <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:174:3<span class="token punctuation">)</span>
    at router <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:47:12<span class="token punctuation">)</span>
GET / 500 452.308 ms - 2070
</pre><pre data-role="codeBlock" data-info="sh" class="language-bash">Error: The requested page couldn&apos;t be found.
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/app.js:16:15
    at Layer.handle <span class="token punctuation">[</span>as handle_request<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/layer.js:95:5<span class="token punctuation">)</span>
    at trim_prefix <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:317:13<span class="token punctuation">)</span>
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:284:7
    at Function.process_params <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:335:12<span class="token punctuation">)</span>
    at next <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:275:10<span class="token punctuation">)</span>
    at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:635:15
    at next <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:260:14<span class="token punctuation">)</span>
    at Function.handle <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:174:3<span class="token punctuation">)</span>
    at router <span class="token punctuation">(</span><span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/node_modules/express/lib/router/index.js:47:12<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  status: 404
<span class="token punctuation">}</span>
GET /asdf 404 15.648 ms - 223
</pre><p>Also notice that thanks to the request logging provided by the <code>morgan</code><br>
middleware, you can see the <code>500</code> (Internal Server Error) and <code>404</code> (Not Found)<br>
HTTP response status codes returned by the server.</p>
<p>After confirming that your custom error handlers work as expected, be sure to<br>
remove the code that you temporarily added to your default route!</p>
<blockquote>
<p>For a refresher on the custom error handlers, see the &quot;Catching and Handling<br>
Errors in Express&quot; article.</p>
</blockquote>
<h2 class="mume-header" id="configuring-environment-variables">Configuring environment variables</h2>

<p>Since the Reading List application will use a database for data persistence,<br>
your project needs to include a way to configure the database connection<br>
settings across environments. To do that, let&apos;s use environment variables to<br>
configure the application.</p>
<blockquote>
<p>For a refresher on how to use environment variables within an Express<br>
application, see the &quot;Acclimating to Environment Variables&quot; article.</p>
</blockquote>
<p>To start, install <code>per-env</code> as a project dependency the <code>dotenv</code> and<br>
<code>dotenv-cli</code> as development dependencies (i.e. dependencies that are only needed<br>
in development environments):</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> per-env
<span class="token function">npm</span> <span class="token function">install</span> dotenv dotenv-cli --save-dev
</pre><p>As a reminder, the <code>per-env</code> package allows you to define npm scripts for each<br>
of your application&apos;s environments. The <code>dotenv</code> package is used to load<br>
environment variables from an <code>.env</code> file and the <code>dotenv-cli</code> package acts as<br>
an intermediary between npx and tools or utilities (like the Sequelize CLI) to<br>
load your environment variables from an <code>.env</code> file and run the command that you<br>
pass into it.</p>
<h3 class="mume-header" id="adding-the-env-and-envexample-files">Adding the <code>.env</code> and <code>.env.example</code> files</h3>

<p>Next, add two files to the root of your project&#x2014;<code>.env</code> and <code>.env.example</code> with<br>
the following content:</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt"><code>PORT=8080
</code></pre><p>The <code>.env</code> file is where you define the environment variables to configure your<br>
application. At this point in the project, you just need to define the <code>PORT</code><br>
environment variable. The <code>.env</code> file shouldn&apos;t be committed to source control<br>
as the environment variables it defines are specific to your development<br>
environment. Additionally, it might contain sensitive information.</p>
<blockquote>
<p>To ensure that the <code>.env</code> file isn&apos;t committed to source control, add <code>.env</code><br>
as an entry to your project&apos;s <code>.gitignore</code> file. If you&apos;re using GitHub&apos;s<br>
<code>.gitignore</code> file for Node.js projects, this has already been done for you.</p>
</blockquote>
<p>Because the <code>.env</code> file isn&apos;t committed to source control, the <code>.env.example</code><br>
file serves as documentation for your teammates so they can create their own<br>
<code>.env</code> files.</p>
<h3 class="mume-header" id="adding-the-config-module">Adding the <code>config</code> module</h3>

<p>Let&apos;s encapsulate all of the <code>process.env</code> property access into a single<br>
<code>config</code> module by importing all of the application&apos;s environment variables and<br>
exporting them to make them available to the rest of the application.</p>
<p>Add a folder named <code>config</code> to the root of the project. Then add a file named<br>
<code>index.js</code> to the <code>config</code> folder containing the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  environment<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">&apos;development&apos;</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Now you can update the <code>./bin/www</code> file to get the port from the <code>config</code><br>
module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> <span class="token punctuation">{</span> port <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../app&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start listening for connections.</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="updating-the-npm-start-script">Updating the npm <code>start</code> script</h3>

<p>To load the environment variables from the <code>.env</code> file in the local development<br>
environment while ignoring the <code>.env</code> file in the production environment, update<br>
the <code>package.json</code> file <code>scripts</code> section:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;per-env&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start:development&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon -r dotenv/config ./bin/www&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start:production&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./bin/www&quot;</span>
<span class="token punctuation">}</span>
</pre><p>To review, if the <code>NODE_ENV</code> environment variable is set to <code>production</code>, then<br>
running the <code>start</code> script will result in the execution of the<br>
<code>start:production</code> script. If the <code>NODE_ENV</code> variable isn&apos;t defined (or set to<br>
<code>development</code>), then the <code>start:development</code> script will be executed by default.</p>
<p>At this point, running the command <code>npm start</code> should start your application<br>
just like it before.</p>
<h3 class="mume-header" id="supporting-debugging-in-visual-studio-code">Supporting debugging in Visual Studio Code</h3>

<p>To use the debugger in Visual Studio Code, configure it to load your environment<br>
variables from your <code>.env</code> file. Open the <code>launch.json</code> file located in the<br>
<code>.vscode</code> folder and add the <code>envFile</code> property to your Node configuration:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
 <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
 <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
     <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Launch Program&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;skipFiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token string">&quot;&lt;node_internals&gt;/**&quot;</span>
     <span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${workspaceFolder}/bin/www&quot;</span><span class="token punctuation">,</span>
     &quot;envFile<span class="token string">&quot;: &quot;</span>$<span class="token punctuation">{</span>workspaceFolder<span class="token punctuation">}</span>/.env&quot;
   <span class="token punctuation">}</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p><strong>Note:</strong> If you don&apos;t have <code>.vscode/launch.json</code> file in your project, see<br>
<a href="https://code.visualstudio.com/docs/editor/debugging#_launch-configurations">this page</a> in the Visual Studio Code<br>
documentation for instructions on how to set up debugging.</p>
</blockquote>
<h2 class="mume-header" id="setting-up-bootstrap">Setting up Bootstrap</h2>

<p>One last bit of project set up work before installing and configuring Sequelize!<br>
Update the <code>views/layout.pug</code> view with the following Bootstrap template markup:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token doctype">doctype html</span>
<span class="token tag">html</span>
  <span class="token tag">head</span>
    <span class="token tag">meta<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">charset</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;utf-8&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">meta<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">name</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;viewport&apos;</span> content<span class="token operator">=</span>&apos;width<span class="token operator">=</span>device<span class="token operator">-</span>width</span><span class="token punctuation">,</span> <span class="token attr-name">initial-scale</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token number">1</span></span><span class="token punctuation">,</span> <span class="token attr-name">shrink-to-fit</span><span class="token punctuation">=</span><span class="token attr-value">no&apos;</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">link<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">rel</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;stylesheet&apos;</span> href<span class="token operator">=</span><span class="token string">&apos;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css&apos;</span> integrity<span class="token operator">=</span><span class="token string">&apos;sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh&apos;</span> crossorigin<span class="token operator">=</span><span class="token string">&apos;anonymous&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">title</span> <span class="token plain-text">Reading List - #{title}</span>
  <span class="token tag">body</span>
    <span class="token tag">nav<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;navbar navbar-expand-lg navbar-dark bg-primary&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;navbar-brand&apos;</span> href<span class="token operator">=</span><span class="token string">&apos;/&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Reading List</span>
    <span class="token tag">.container</span>
      <span class="token tag">h2<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">#{title}</span>
      <span class="token keyword">block content</span>
    <span class="token tag">script<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">src</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;https://code.jquery.com/jquery-3.4.1.slim.min.js&apos;</span> integrity<span class="token operator">=</span><span class="token string">&apos;sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n&apos;</span> crossorigin<span class="token operator">=</span><span class="token string">&apos;anonymous&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token script"><span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">&apos;https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js&apos;</span> integrity<span class="token operator">=</span><span class="token string">&apos;sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo&apos;</span> crossorigin<span class="token operator">=</span><span class="token string">&apos;anonymous&apos;</span><span class="token punctuation">)</span> <span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">&apos;https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js&apos;</span> integrity<span class="token operator">=</span><span class="token string">&apos;sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6&apos;</span> crossorigin<span class="token operator">=</span><span class="token string">&apos;anonymous&apos;</span><span class="token punctuation">)</span></span>
</pre><p>Adding support for the Bootstrap front-end component library will give the<br>
Reading List application a nice, polished look. The above markup was taken<br>
directly from <a href="https://getbootstrap.com/docs/4.4/getting-started/introduction/#starter-template">the starter template published in the official Bootstrap<br>
documentation</a>.</p>
<blockquote>
<p>Adding Bootstrap won&apos;t change the look of the application much at this point.<br>
Later on, once you start adding forms to the application, it&apos;ll be easier to<br>
notice the benefits of using a library like Bootstrap.</p>
</blockquote>
<h2 class="mume-header" id="what-you-learned-10">What you learned</h2>

<p>In this article, you learned how to:</p>
<ul>
<li>Split the Express application and HTTP server into separate modules;</li>
<li>Use the <code>morgan</code> npm package to log requests; and</li>
<li>Add support for the Bootstrap front-end component library to your<br>
application&apos;s Pug layout template.</li>
</ul>
<p>You also reviewed the following:</p>
<ul>
<li>Setting up a new Express project;</li>
<li>Stubbing out an Express application;</li>
<li>Adding custom error handlers to an Express application; and</li>
<li>Configuring environment variables.</li>
</ul>
<p>Next up: integrating Sequelize with an Express application!</p>
<hr>
<h1 class="mume-header" id="data-driven-websites-project-part-2-integrating-sequelize-with-express">Data-Driven Websites Project (Part 2: Integrating Sequelize with Express)</h1>

<p>Welcome to part two of creating the data-driven Reading List website!</p>
<p>Over the course of three articles, you&apos;ll create a data-driven Reading List<br>
website that will allow you to view a list of books, add a book to the list,<br>
update a book in the list, and delete a book from the list. In the first<br>
article, you created the project. In this article, you&apos;ll learn how to integrate<br>
Sequelize with an Express application. In the last article, you&apos;ll create the<br>
routes and views to perform CRUD (create, read, update, and delete) operations<br>
using Sequelize.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Install and configure Sequelize within an Express application; and</li>
<li>Use Sequelize to test the connection to a database before starting the HTTP<br>
server on application startup.</li>
</ul>
<p>You&apos;ll also review the following:</p>
<ul>
<li>Using the Sequelize CLI to create a model and migration;</li>
<li>Using the Sequelize CLI to seed the database; and</li>
<li>Using Sequelize to query data from the database.</li>
</ul>
<h2 class="mume-header" id="installing-and-configuring-sequelize">Installing and configuring Sequelize</h2>

<p>First things first, you need to install and configure Sequelize!</p>
<p>Use npm to install the following dependencies:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> sequelize@^5.0.0 pg@^8.0.0
</pre><p>Then install the Sequelize CLI as a development dependency:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> sequelize-cli@^5.0.0 --save-dev
</pre><h3 class="mume-header" id="configuring-the-sequelize-cli">Configuring the Sequelize CLI</h3>

<p>Before using the Sequelize CLI to initialize Sequelize within your project, add<br>
a file named <code>.sequelizerc</code> to the root of your project containing the following<br>
code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&apos;config&apos;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&apos;config&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;database.js&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&apos;models-path&apos;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&apos;db&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&apos;seeders-path&apos;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&apos;db&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;seeders&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&apos;migrations-path&apos;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&apos;db&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;migrations&apos;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The <code>.sequelizerc</code> file configures the Sequelize CLI so that it knows:</p>
<ul>
<li>Where your database configuration is located; and</li>
<li>Where to generate the <code>models</code>, <code>seeders</code>, and <code>migrations</code> folders.</li>
</ul>
<h3 class="mume-header" id="initializing-sequelize">Initializing Sequelize</h3>

<p>Now you&apos;re ready to initialize Sequelize by running the following command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx sequelize init
</pre><p>When the command completes, your project should now contain the following:</p>
<ul>
<li>The <code>config/database.js</code> file;</li>
<li>The <code>db/migrations</code>, <code>db/models</code>, and <code>db/seeders</code> folders; and</li>
<li>The <code>db/models/index.js</code> file.</li>
</ul>
<h3 class="mume-header" id="creating-a-new-database-and-database-user">Creating a new database and database user</h3>

<p>To prepare for configuring Sequelize, you need to create a new database for the<br>
Reading List application to use and a new normal or limited user (i.e. a user<br>
without superuser privileges) that has permissions to access the new database.</p>
<p>Open psql by running the command <code>psql</code> (to use the currently logged in user) or<br>
<code>psql -U &#xAB;super user username&#xBB;</code> to specify the username of the super user to<br>
use. Then execute the following SQL statements:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> reading_list<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">user</span> reading_list_app <span class="token keyword">with</span> encrypted password <span class="token string">&apos;&#xAB;a strong password for the reading_list_app user&#xBB;&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token keyword">database</span> reading_list <span class="token keyword">to</span> reading_list_app<span class="token punctuation">;</span>
</pre><p>Make note of the password that you use as you&apos;ll need them for the next step in<br>
the configuration process!</p>
<blockquote>
<p>To review how to create a new PostgreSQL database and user, see the &quot;Database<br>
Management Walk-Through&quot; and &quot;User Management Walk-Through&quot; readings in the<br>
SQL lesson.</p>
</blockquote>
<h3 class="mume-header" id="adding-the-database-environment-variables">Adding the database environment variables</h3>

<p>Now you&apos;re ready to add the <code>DB_USERNAME</code>, <code>DB_PASSWORD</code>, <code>DB_DATABASE</code>, and<br>
<code>DB_HOST</code> environment variables to the <code>.env</code> and <code>.env.example</code> files:</p>
<pre data-role="codeBlock" data-info class="language-"><code>PORT=8080
DB_USERNAME=reading_list_app
DB_PASSWORD=&#xAB;the reading_list_app user password&#xBB;
DB_DATABASE=reading_list
DB_HOST=localhost
</code></pre><p>Next, update the <code>config</code> module (the <code>config/index.js</code> file) with the following<br>
code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./config/index.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  environment<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">&apos;development&apos;</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">8080</span><span class="token punctuation">,</span>
  db<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_USERNAME</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_PASSWORD</span><span class="token punctuation">,</span>
    database<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_DATABASE</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DB_HOST</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Remember that the <code>config</code> module is responsible for providing access to your<br>
application&apos;s environment variables. Any part of the application that needs<br>
access to the <code>DB_USERNAME</code>, <code>DB_PASSWORD</code>, <code>DB_DATABASE</code>, and <code>DB_HOST</code><br>
environment variables can use the <code>username</code>, <code>password</code>, <code>database</code>, and <code>host</code><br>
properties on the <code>config</code> module&apos;s <code>db</code> object.</p>
<h3 class="mume-header" id="configuring-the-sequelize-database-connection">Configuring the Sequelize database connection</h3>

<p>Now you&apos;re ready to configure the database connection for Sequelize! Update the<br>
<code>config/database.js</code> file with the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span>
  username<span class="token punctuation">,</span>
  password<span class="token punctuation">,</span>
  database<span class="token punctuation">,</span>
  host<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./index&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>db<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">,</span>
    password<span class="token punctuation">,</span>
    database<span class="token punctuation">,</span>
    host<span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&apos;postgres&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The first statement uses the <code>require()</code> function to import the <code>config/index</code><br>
module. Destructuring is used to declare the <code>username</code>, <code>password</code>, <code>database</code>,<br>
and <code>host</code> variables and initialize them to the values of the corresponding<br>
property names on the <code>config</code> module&apos;s <code>db</code> property.</p>
<p>You could remove the destructuring by refactoring the above statement into the<br>
following statements:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./index&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> config<span class="token punctuation">.</span>db<span class="token punctuation">;</span>
<span class="token keyword">const</span> username <span class="token operator">=</span> db<span class="token punctuation">.</span>username<span class="token punctuation">;</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> db<span class="token punctuation">.</span>password<span class="token punctuation">;</span>
<span class="token keyword">const</span> database <span class="token operator">=</span> db<span class="token punctuation">.</span>database<span class="token punctuation">;</span>
<span class="token keyword">const</span> host <span class="token operator">=</span> db<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
</pre><p>The <code>config/database</code> module then exports an object with a property named<br>
<code>development</code> set to an object literal with <code>username</code>, <code>password</code>, <code>database</code>,<br>
<code>host</code>, and <code>dialect</code> properties:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  development<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">,</span>
    password<span class="token punctuation">,</span>
    database<span class="token punctuation">,</span>
    host<span class="token punctuation">,</span>
    dialect<span class="token punctuation">:</span> <span class="token string">&apos;postgres&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The <code>development</code> property name indicates that these configuration settings are<br>
for the <code>development</code> environment. The <code>username</code>, <code>password</code>, <code>database</code>,<br>
<code>host</code>, and <code>dialect</code> property names are the Sequelize options used to configure<br>
the database connection.</p>
<blockquote>
<p>For a complete list of the available Sequelize options, see <a href="https://sequelize.org/master/class/lib/sequelize.js~Sequelize.html#instance-constructor-constructor">the official<br>
Sequelize API documentation</a>.</p>
</blockquote>
<h2 class="mume-header" id="testing-the-connection-to-the-database">Testing the connection to the database</h2>

<p>You&apos;ve configured Sequelize&#x2014;specifically the database connection&#x2014;but how do you<br>
know if Sequelize can actually connect to the database? The Sequelize instance<br>
method <code>authenticate()</code> can be used to test the connection to the database by<br>
attempting to execute the query <code>SELECT 1+1 AS result</code> against the database<br>
specified in the <code>config/database</code> module.</p>
<p>The Reading List application is a data-driven website, so it&apos;ll be heavily<br>
dependent on its database. Given that, it&apos;s best to test the connection to the<br>
database as early as possible. You can do that by updating the <code>./bin/www</code> file<br>
to test the connection to the database before starting the application listening<br>
for HTTP connections.</p>
<p>Update the <code>./bin/www</code> file with the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token keyword">const</span> <span class="token punctuation">{</span> port <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../app&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check the database connection before starting the app.</span>
db<span class="token punctuation">.</span>sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Database connection success! Sequelize is ready to use...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Start listening for connections.</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Database connection failure.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>In addition to importing the <code>app</code> module, the <code>require()</code> function is called to<br>
import the <code>./db/models</code> module&#x2014;a module that was generated by the Sequelize CLI<br>
when you initialized your project to use Sequelize.</p>
<p>The <code>./db/models</code> module provides access to the Sequelize instance via the<br>
<code>sequelize</code> property. The <code>authenticate()</code> method is called on the Sequelize<br>
instance. The <code>authenticate()</code> method is asynchronous, so it returns a Promise<br>
that will resolve if the connection to the database is successful, otherwise it<br>
will be rejected:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Check the database connection before starting the app.</span>
db<span class="token punctuation">.</span>sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// The connection to the database succeeded.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// The connection to the database failed.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Inside of the <code>then()</code> method callback, a message is logged to the console and<br>
the application is started listening for HTTP connections. Inside of the<br>
<code>catch()</code> method callback, an error message and the <code>err</code> object are logged to<br>
the console:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// Check the database connection before starting the app.</span>
db<span class="token punctuation">.</span>sequelize<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Database connection success! Sequelize is ready to use...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Start listening for connections.</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Database connection failure.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>To test the connection to the database, run the command <code>npm start</code> in the<br>
terminal to start your application. In the console, you should see the success<br>
message if the database connection succeeded, otherwise you&apos;ll see the error<br>
message.</p>
<h2 class="mume-header" id="creating-the-book-model">Creating the Book model</h2>

<p>Now that you&apos;ve confirmed that the application can successfully connect to the<br>
database, it&apos;s time to create the application&apos;s first model.</p>
<p>As a reminder, the Reading List website&#x2014;when it&apos;s completed&#x2014;will allow you to<br>
view a list of books, add a book to the list, update a book in the list, and<br>
delete a book from the list. At the heart of all of these features are books, so<br>
let&apos;s use the Sequelize CLI to generate a <code>Book</code> model.</p>
<p>The <code>Book</code> model should include the following properties:</p>
<ul>
<li><code>title</code> - A string representing the title;</li>
<li><code>author</code> - A string representing the the author;</li>
<li><code>releaseDate</code> - A date representing the release date;</li>
<li><code>pageCount</code> - An integer representing the page count; and</li>
<li><code>publisher</code> - A string representing the publisher.</li>
</ul>
<p>From the terminal, run the following command to use the Sequelize CLI to<br>
generate the <code>Book</code> model:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx sequelize model:generate --name Book --attributes <span class="token string">&quot;title:string, author:string, releaseDate:dateonly, pageCount:integer, publisher:string&quot;</span>
</pre><p>If the command succeeds, you&apos;ll see the following output in the console:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">New model was created at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/db/models/book.js <span class="token keyword">.</span>
New migration was created at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/db/migrations/<span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-Book.js <span class="token keyword">.</span>
</pre><p>This confirms that two files were generated: a file for the <code>Book</code> model and a<br>
file for a database migration to add the <code>Books</code> table to the database.</p>
<h3 class="mume-header" id="updating-the-generated-book-model-and-migration-files">Updating the generated <code>Book</code> model and migration files</h3>

<p>The <code>Book</code> model and migration files generated by the Sequelize CLI are close to<br>
what is needed, but some changes are required. Two things in particular need to<br>
be addressed: column string lengths and column nullability (i.e. the ability for<br>
a column to accept <code>null</code> values).</p>
<p>For your reference, here are the generated model and migration files:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/models/book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Book <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Book&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
    pageCount<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    publisher<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Book<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Book<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/migrations/[timestamp]-create-book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATEONLY</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      updatedAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">down</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>As it is, the generated migration file would create the following <code>Books</code> table<br>
in the database:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">reading_list<span class="token operator">=</span><span class="token comment"># \d &quot;Books&quot;</span>
                                        Table <span class="token string">&quot;public.Books&quot;</span>
   Column    <span class="token operator">|</span>           Type           <span class="token operator">|</span> Collation <span class="token operator">|</span> Nullable <span class="token operator">|</span>               Default
-------------+--------------------------+-----------+----------+-------------------------------------
 <span class="token function">id</span>          <span class="token operator">|</span> integer                  <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span> nextval<span class="token punctuation">(</span><span class="token string">&apos;&quot;Books_id_seq&quot;&apos;</span>::regclass<span class="token punctuation">)</span>
 title       <span class="token operator">|</span> character varying<span class="token punctuation">(</span>255<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 author      <span class="token operator">|</span> character varying<span class="token punctuation">(</span>255<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 releaseDate <span class="token operator">|</span> <span class="token function">date</span>                     <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 pageCount   <span class="token operator">|</span> integer                  <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 publisher   <span class="token operator">|</span> character varying<span class="token punctuation">(</span>255<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 createdAt   <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 updatedAt   <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
Indexes:
    <span class="token string">&quot;Books_pkey&quot;</span> PRIMARY KEY, btree <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</pre><p>Notice that all of the <code>Book</code> <code>string</code> based properties (i.e. <code>title</code>, <code>author</code>,<br>
and <code>publisher</code>) resulted in columns with a data type of <code>character varying(255)</code>, which is a variable length text based column up to 255 characters<br>
in length. Allowing for 255 characters for the <code>title</code> column seems about right,<br>
but for the <code>author</code> and <code>publisher</code> columns, it seems excessive.</p>
<p>Also notice that the <code>title</code>, <code>author</code>, <code>releaseDate</code>, <code>pageCount</code>, and<br>
<code>publisher</code> columns all allow <code>null</code> values (a value of <code>not null</code> in the<br>
&quot;Nullable&quot; column means that the column doesn&apos;t allow <code>null</code> values, otherwise<br>
the column allows <code>null</code> values). Ideally, each book in the database would have<br>
values for all of those columns.</p>
<p>We can address both of these issues by updating the <code>./db/models/book.js</code> file<br>
to the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/models/book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Book <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Book&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Book<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Book<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The migration file <code>./db/migrations/[timestamp]-create-book.js</code> also needs to be<br>
updated to the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/migrations/[timestamp]-create-book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      updatedAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">down</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">dropTable</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="applying-the-pending-migration">Applying the pending migration</h3>

<p>After resolving the column data type and nullability issues in the model and<br>
migration files, you&apos;re ready to apply the pending migration to create the<br>
<code>Books</code> table in the database. In the terminal, run the following command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx dotenv sequelize db:migrate
</pre><p>Notice that you&apos;re using npx to invoke the <code>dotenv</code> tool which loads your<br>
environment variables from the <code>.env</code> file and then invokes the <code>sequelize db:migrate</code> command. In the console, you should see something similar to the<br>
following output:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">Loaded configuration <span class="token function">file</span> <span class="token string">&quot;config/database.js&quot;</span><span class="token keyword">.</span>
Using environment <span class="token string">&quot;development&quot;</span><span class="token keyword">.</span>
<span class="token operator">==</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-create-book: migrating <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">==</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-create-book: migrated <span class="token punctuation">(</span>0.021s<span class="token punctuation">)</span>
</pre><p>To confirm the creation of the <code>Books</code> table, you can run the following command<br>
from within psql:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">\d <span class="token string">&quot;Books&quot;</span>
</pre><blockquote>
<p>Be sure that you&apos;re connected to the <code>reading_list</code> database in psql. If you<br>
are, the cursor should read <code>reading_list=#</code>. If you&apos;re not connected to the<br>
correct database, you can run the command <code>\c reading_list</code> to connect to the<br>
<code>reading_list</code> database.</p>
</blockquote>
<p>After running the <code>\d &quot;Books&quot;</code> command, you should see the following output<br>
within psql:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">                                        Table <span class="token string">&quot;public.Books&quot;</span>
   Column    <span class="token operator">|</span>           Type           <span class="token operator">|</span> Collation <span class="token operator">|</span> Nullable <span class="token operator">|</span>               Default
-------------+--------------------------+-----------+----------+-------------------------------------
 <span class="token function">id</span>          <span class="token operator">|</span> integer                  <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span> nextval<span class="token punctuation">(</span><span class="token string">&apos;&quot;Books_id_seq&quot;&apos;</span>::regclass<span class="token punctuation">)</span>
 title       <span class="token operator">|</span> character varying<span class="token punctuation">(</span>255<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 author      <span class="token operator">|</span> character varying<span class="token punctuation">(</span>100<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 releaseDate <span class="token operator">|</span> <span class="token function">date</span>                     <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 pageCount   <span class="token operator">|</span> integer                  <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 publisher   <span class="token operator">|</span> character varying<span class="token punctuation">(</span>100<span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 createdAt   <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
 updatedAt   <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span>
Indexes:
    <span class="token string">&quot;Books_pkey&quot;</span> PRIMARY KEY, btree <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="seeding-the-database">Seeding the database</h2>

<p>With the <code>Books</code> table created in the database, you&apos;re ready to seed the table<br>
with some test data!</p>
<p>To start, you need to create a seed file by running the following command in the<br>
terminal from the root of your project:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx sequelize seed:generate --name test-data
</pre><p>If the command succeeds, you&apos;ll see the following output in the console:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">seeders folder at <span class="token string">&quot;[path to the project folder]/db/seeders&quot;</span> already exists.
New seed was created at <span class="token punctuation">[</span>path to the project folder<span class="token punctuation">]</span>/db/seeders/<span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-test-data.js <span class="token keyword">.</span>
</pre><p>This confirms that the seed file was generated. Go ahead and replace the<br>
contents of the <code>./db/seeders/[timestamp]-test-data.js</code> with the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/seeders/[timestamp]-test-data.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">up</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">bulkInsert</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;The Martian&apos;</span><span class="token punctuation">,</span>
        author<span class="token punctuation">:</span> <span class="token string">&apos;Andy Weir&apos;</span><span class="token punctuation">,</span>
        releaseDate<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2014-02-11&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        pageCount<span class="token punctuation">:</span> <span class="token number">384</span><span class="token punctuation">,</span>
        publisher<span class="token punctuation">:</span> <span class="token string">&apos;Crown&apos;</span><span class="token punctuation">,</span>
        createdAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        updatedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Ready Player One&apos;</span><span class="token punctuation">,</span>
        author<span class="token punctuation">:</span> <span class="token string">&apos;Ernest Cline&apos;</span><span class="token punctuation">,</span>
        releaseDate<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2011-08-16&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        pageCount<span class="token punctuation">:</span> <span class="token number">384</span><span class="token punctuation">,</span>
        publisher<span class="token punctuation">:</span> <span class="token string">&apos;Crown&apos;</span><span class="token punctuation">,</span>
        createdAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        updatedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Harry Potter and the Sorcerer\&apos;s Stone&apos;</span><span class="token punctuation">,</span>
        author<span class="token punctuation">:</span> <span class="token string">&apos;J.K. Rowling&apos;</span><span class="token punctuation">,</span>
        releaseDate<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&apos;1998-10-01&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        pageCount<span class="token punctuation">:</span> <span class="token number">309</span><span class="token punctuation">,</span>
        publisher<span class="token punctuation">:</span> <span class="token string">&apos;Scholastic Press&apos;</span><span class="token punctuation">,</span>
        createdAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        updatedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">down</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">queryInterface<span class="token punctuation">,</span> Sequelize</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> queryInterface<span class="token punctuation">.</span><span class="token function">bulkDelete</span><span class="token punctuation">(</span><span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>The <code>up</code> property references an anonymous method that uses the<br>
<code>queryInterface.bulkInsert()</code> method to insert an array of books into the <code>Book</code><br>
table while the <code>down</code> property references an anonymous method that uses the<br>
<code>queryInterface.bulkDelete()</code> method to delete all of the data in the <code>Books</code><br>
table.</p>
<blockquote>
<p>Feel free to add to the array of books&#x2026; have fun with it!</p>
</blockquote>
<p>To seed your database with your test data, run the following command:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">npx dotenv sequelize db:seed:all
</pre><p>In the console, you should see something similar to the following output:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash">Loaded configuration <span class="token function">file</span> <span class="token string">&quot;config/database.js&quot;</span><span class="token keyword">.</span>
Using environment <span class="token string">&quot;development&quot;</span><span class="token keyword">.</span>
<span class="token operator">==</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-test-data: migrating <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">==</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span>-test-data: migrated <span class="token punctuation">(</span>0.009s<span class="token punctuation">)</span>
</pre><p>Then you can use psql to check if the <code>Books</code> table contains the test data:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token keyword">select</span> * from <span class="token string">&quot;Books&quot;</span><span class="token punctuation">;</span>
</pre><p>Which should produce the following output:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"> <span class="token function">id</span> <span class="token operator">|</span>                 title                 <span class="token operator">|</span>    author    <span class="token operator">|</span> releaseDate <span class="token operator">|</span> pageCount <span class="token operator">|</span>    publisher     <span class="token operator">|</span>         createdAt          <span class="token operator">|</span>         updatedAt
----+---------------------------------------+--------------+-------------+-----------+------------------+----------------------------+----------------------------
  2 <span class="token operator">|</span> The Martian                           <span class="token operator">|</span> Andy Weir    <span class="token operator">|</span> 2014-02-11  <span class="token operator">|</span>       384 <span class="token operator">|</span> Crown            <span class="token operator">|</span> 2020-03-31 19:06:32.452-07 <span class="token operator">|</span> 2020-03-31 19:06:32.452-07
  3 <span class="token operator">|</span> Ready Player One                      <span class="token operator">|</span> Ernest Cline <span class="token operator">|</span> 2011-08-16  <span class="token operator">|</span>       384 <span class="token operator">|</span> Crown            <span class="token operator">|</span> 2020-03-31 19:06:32.452-07 <span class="token operator">|</span> 2020-03-31 19:06:32.452-07
  4 <span class="token operator">|</span> Harry Potter and the Sorcerer&apos;s Stone <span class="token operator">|</span> J.K. Rowling <span class="token operator">|</span> 1998-10-01  <span class="token operator">|</span>       309 <span class="token operator">|</span> Scholastic Press <span class="token operator">|</span> 2020-03-31 19:06:32.452-07 <span class="token operator">|</span> 2020-03-31 19:06:32.452-07
<span class="token punctuation">(</span>3 rows<span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="querying-and-rendering-a-temporary-list-of-books">Querying and rendering a temporary list of books</h2>

<p>Now that you&apos;ve installed and configured Sequelize, created the <code>Book</code> model and<br>
associated migration, and seeded the <code>Books</code> table, you&apos;re ready to update your<br>
application&apos;s default route to query the for a list of books and render the data<br>
in the <code>index</code> view!</p>
<p>In the <code>routes</code> module (the <code>./routes.js</code> file), use the <code>require()</code> function to<br>
import the <code>models</code> module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Then update the default route (<code>/</code>) to this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>async</code> keyword was added to make the route handler an asynchronous function<br>
and the <code>db.Book.findAll()</code> method is used to retrieve a list of books from the<br>
database.</p>
<p>For your reference, here&apos;s what the complete <code>./routes.js</code> file should look<br>
like:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><p>Now you can update the <code>./views/index.pug</code> view to render the array of books:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">p</span> <span class="token plain-text">Hello from the Reading List app!</span>
  <span class="token tag">h3</span> <span class="token plain-text">Books</span>
  <span class="token tag">ul</span>
    <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> book <span class="token keyword">in</span></span> books</span>
      <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>title</span>
</pre><p>For now, the formatting of the book list is very simple. In the next article,<br>
you&apos;ll see how to use Bootstrap to improve the look and feel of the book list<br>
table.</p>
<p>Run the command <code>npm start</code> to start your application (if it&apos;s not already<br>
started) and browse to <code>http://localhost:8080/</code>. You should see the list of<br>
books from the database rendered to the page in an unordered list!</p>
<h2 class="mume-header" id="what-you-learned-11">What you learned</h2>

<p>In this article, you learned how to:</p>
<ul>
<li>Install and configure Sequelize within an Express application; and</li>
<li>Use Sequelize to test the connection to a database before starting the HTTP<br>
server on application startup.</li>
</ul>
<p>You also reviewed the following:</p>
<ul>
<li>Using the Sequelize CLI to create a model;</li>
<li>Using the Sequelize CLI to seed the database; and</li>
<li>Using Sequelize to query data from the database.</li>
</ul>
<p>Next up: creating the routes and views to perform CRUD (create, read, update,<br>
and delete) operations using Sequelize!</p>
<hr>
<h1 class="mume-header" id="data-driven-websites-project-part-3-using-sequelize-to-perform-crud-operations">Data-Driven Websites Project (Part 3: Using Sequelize to Perform CRUD Operations)</h1>

<p>Welcome to part three of creating the data-driven Reading List website!</p>
<p>Over the course of three articles, you&apos;ll create a data-driven Reading List<br>
website that will allow you to view a list of books, add a book to the list,<br>
update a book in the list, and delete a book from the list. In the first<br>
article, you created the project. In the second article, you learned how to<br>
integrate Sequelize with an Express application. In this article, you&apos;ll create<br>
the routes and views to perform CRUD (create, read, update, and delete)<br>
operations using Sequelize.</p>
<p>When you finish this article, you should be able to:</p>
<ul>
<li>Define a collection of routes and views that use Sequelize to perform CRUD<br>
operations against a single resource; and</li>
<li>Handle Sequelize validation errors when users are attempting to create or<br>
update data and display error messages to the user so that they can resolve<br>
any data quality issues.</li>
</ul>
<p>You&apos;ll also review the following:</p>
<ul>
<li>Using a wrapper function to catch errors thrown within asynchronous route<br>
handler functions;</li>
<li>Using Pug to create HTML forms;</li>
<li>Using the <code>csurf</code> middleware to protect against CSRF exploits;</li>
<li>Using the built-in <code>express.urlencoded()</code> middleware function to parse<br>
incoming request body form data;</li>
<li>Using Sequelize model validations to validate user-provided data;</li>
<li>Using the <code>express-validator</code> validation library to validate user-provided<br>
data within an Express route; and</li>
<li>Using Pug includes and mixins to remove unnecessary code duplication.</li>
</ul>
<h2 class="mume-header" id="planning-the-routes-and-views">Planning the routes and views</h2>

<p>Before creating any new routes or views, it&apos;s a good idea to plan out what pages<br>
need to be added to support the required CRUD (create, read, update, and delete)<br>
operations along with their associated routes, HTTP methods, and views.</p>
<p>Here&apos;s a list of the proposed pages to add to the Reading List application:</p>
<table>
<thead>
<tr>
<th>Page Name</th>
<th>Route Path</th>
<th>HTTP Methods</th>
<th>View Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Book List</td>
<td><code>/</code></td>
<td><code>GET</code></td>
<td><code>book-list.pug</code></td>
</tr>
<tr>
<td>Add Book</td>
<td><code>/book/add</code></td>
<td><code>GET</code> <code>POST</code></td>
<td><code>book-add.pug</code></td>
</tr>
<tr>
<td>Edit Book</td>
<td><code>/book/edit/:id</code></td>
<td><code>GET</code> <code>POST</code></td>
<td><code>book-edit.pug</code></td>
</tr>
<tr>
<td>Delete Book</td>
<td><code>/book/delete/:id</code></td>
<td><code>GET</code> <code>POST</code></td>
<td><code>book-delete.pug</code></td>
</tr>
</tbody>
</table>
<p>There are a number of acceptable ways that you could approach implementing the<br>
required CRUD operations for the <code>Book</code> resource or model. The above approach is<br>
a common, tried-and-true way of implementing CRUD operations within a<br>
server-side rendered web application.</p>
<blockquote>
<p>The term <strong>server-side rendered</strong> simply means that all of the work of<br>
generating the HTML for the web application&apos;s pages is done on the server.<br>
Later on, you&apos;ll learn how to use client-side technologies like React to move<br>
some of that work to the client (i.e. the browser).</p>
</blockquote>
<p>Notice that the &quot;Add Book&quot;, &quot;Edit Book&quot;, and &quot;Delete Book&quot; pages need to support<br>
both the <code>GET</code> and <code>POST</code> HTTP methods. The <code>GET</code> HTTP method will be used to<br>
initially retrieve each page&apos;s HTML form while the <code>POST</code> HTTP method will be<br>
used to process each page&apos;s HTML form submissions.</p>
<p>Also notice that the route paths for the &quot;Edit Book&quot; and &quot;Delete Book&quot; pages<br>
define an <code>:id</code> route parameter. Without a book ID, those pages wouldn&apos;t know<br>
what book record they were supposed to be editing or deleting. The &quot;Add Book&quot;<br>
page doesn&apos;t need an <code>:id</code> route parameter because that page is adding a new<br>
book record, so a book ID isn&apos;t needed (the ID for the new record will be<br>
created by the database when the record is inserted into the table).</p>
<p>Now that you have a plan, let&apos;s start building out the proposed pages&#x2014;starting<br>
with the &quot;Book List&quot; page!</p>
<h2 class="mume-header" id="creating-the-book-list-page">Creating the Book List page</h2>

<p>As a reminder, here&apos;s what the default route (<code>/</code>) in the <code>routes</code> module (i.e.<br>
the <code>routes.js</code> file) looks like at this point:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Home&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>And the <code>./views/index.pug</code> view:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/index.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">p</span> <span class="token plain-text">Hello from the Reading List app!</span>
  <span class="token tag">h3</span> <span class="token plain-text">Books</span>
  <span class="token tag">ul</span>
    <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> book <span class="token keyword">in</span></span> books</span>
      <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>title</span>
</pre><p>It&apos;s a small change, but start with renaming the <code>./views/index.pug</code> view to<br>
<code>./views/book-list.pug</code>. Changing the name of the view will make it easier to<br>
identify the purpose of the view at a glance.</p>
<p>After renaming the view, update the call to the <code>res.render()</code> method in the<br>
default route:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice that the <code>title</code> property&#x2014;on the object passed as the second argument to<br>
the <code>res.render()</code> method&#x2014;was changed from &quot;Home&quot; to &quot;Books&quot;.</p>
<h3 class="mume-header" id="applying-bootstrap-styles-to-the-book-list-page">Applying Bootstrap styles to the Book List page</h3>

<p>When you added Bootstrap to the project in the first article in this series, it<br>
was mentioned that the look of the application wouldn&apos;t change much at that<br>
point. Let&apos;s change that!</p>
<p>Update the <code>./views/book-list.pug</code> view with the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-list.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-3&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-success&apos;</span> href<span class="token operator">=</span><span class="token string">&apos;/book/add&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;button&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
  <span class="token tag">table<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;table table-striped table-hover&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">thead<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;thead-dark&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">tr</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
        <span class="token tag">th<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">scope</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;col&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">tbody</span>
      <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> book <span class="token keyword">in</span></span> books</span>
        <span class="token tag">tr</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>title</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>author</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>releaseDate</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>pageCount</span>
          <span class="token tag">td</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>publisher</span>
          <span class="token tag">td</span>
            <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-primary&apos;</span> href<span class="token operator">=</span><span class="token template-string"><span class="token string">`/book/edit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> role<span class="token operator">=</span><span class="token string">&apos;button&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Edit</span>
            <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-danger ml-2&apos;</span> href<span class="token operator">=</span><span class="token template-string"><span class="token string">`/book/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> role<span class="token operator">=</span><span class="token string">&apos;button&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Delete</span>
</pre><p>Here&apos;s an overview of the above Pug template code:</p>
<ul>
<li>A hyperlink (<code>&lt;a&gt;</code>) at the top of the page (<code>a(class=&apos;btn btn-success&apos; href=&apos;/book/add&apos; role=&apos;button&apos;) Add Book</code>) gives users a way to navigate to<br>
the &quot;Add Book&quot; page. The hyperlink is styled to look like a button using the<br>
<a href="https://getbootstrap.com/docs/4.4/components/buttons/">Bootstrap button CSS classes</a> (<code>btn btn-success</code>).</li>
<li>An HTML table is used to render the list of books. The <a href="https://getbootstrap.com/docs/4.4/content/tables/">Bootstrap table CSS<br>
classes</a> (<code>table table-striped table-hover</code>) are used to<br>
style the table.</li>
<li>Each row in the books HTML table contains two hyperlinks&#x2014;one to navigate to<br>
the &quot;Edit Book&quot; page and another to navigate to the &quot;Delete Book&quot; page. Again,<br>
both hyperlinks are styled to look like buttons using the <a href="https://getbootstrap.com/docs/4.4/components/buttons/">Bootstrap button<br>
CSS classes</a>.</li>
</ul>
<blockquote>
<p>For more information about the Bootstrap front-end component library, see <a href="https://getbootstrap.com/docs/4.4/">the<br>
official documentation</a>.</p>
</blockquote>
<h3 class="mume-header" id="adding-an-asynchronous-route-handler-wrapper-function">Adding an asynchronous route handler wrapper function</h3>

<p>In an earlier article, you learned that Express is unable to catch errors thrown<br>
by asynchronous route handlers. Given that, asynchronous route handlers need to<br>
catch their own errors and pass them to the <code>next()</code> method. That&apos;s exactly what<br>
the default route handler is currently doing:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>While you could continue to add <code>try</code>/<code>catch</code> statements to each of your route<br>
handlers, defining a simple asynchronous route handler wrapper function will<br>
keep you from having to write that boilerplate code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>For your reference, here&apos;s what the <code>./routes.js</code> file should look like at this<br>
point in the project:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="testing-the-book-list-page">Testing the Book List page</h3>

<p>Open a terminal and browse to your project folder. Run the command <code>npm start</code><br>
to start your application and browse to <code>http://localhost:8080/</code>. You should see<br>
the list of books from the database rendered to the page&#x2014;but instead of using an<br>
unordered list to format the list of books you should see a nicely Bootstrap<br>
formatted HTML table!</p>
<h2 class="mume-header" id="adding-the-add-book-page">Adding the Add Book page</h2>

<p>The next page that you&apos;ll add to the Reading List application is the &quot;Add Book&quot;<br>
page. As the name clearly suggests, this page will allow you to add a new book<br>
to the reading list.</p>
<h3 class="mume-header" id="adding-protection-from-csrf-attacks">Adding protection from CSRF attacks</h3>

<p>Before adding the route and view for the &quot;Add Book&quot; page, go ahead and prepare<br>
to add protection from CSRF attacks by installing and configuring the necessary<br>
dependencies and middleware.</p>
<p>To review, Cross-Site Request Forgery (CSRF) is an attack that results in an end<br>
user executing unwanted actions within a web application. Imagine that the<br>
Reading List website requires users to login before they can view and make<br>
changes to their reading list (in a future article you&apos;ll learn how to implement<br>
user login within an Express application!) If a user was currently logged into<br>
the Reading List website, a CSRF attack would trick the user into clicking a<br>
link that unexpectedly sends a POST request to the Reading List website&#x2014;a<br>
request that might add or delete a book without the user&apos;s consent!</p>
<p>While this particular example is trivial in terms of its impact to the user,<br>
imagine that the affected web application is a banking application. The end user<br>
could end up unintentionally transferring money to the hacker&apos;s bank account!</p>
<blockquote>
<p>For a detailed walkthrough of a CSRF attack and how to protect against CSRF<br>
attacks, see the &quot;Protecting Forms from CSRF&quot; article in the Express HTML<br>
Forms lesson.</p>
</blockquote>
<p>From a terminal, install the following dependencies into your project:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> csurf@^1.0.0
<span class="token function">npm</span> <span class="token function">install</span> cookie-parser@^1.0.0
</pre><p>Within the <code>app</code> module (i.e. the <code>./app.js</code> file), use the <code>require()</code> function<br>
to import the <code>cookie-parser</code> middleware and call the <code>app.use()</code> method to add<br>
the middleware just after adding the <code>morgan</code> middleware to the request<br>
pipeline. While you&apos;re updating the <code>app</code> module, go ahead and add the built-in<br>
Express <code>urlencoded</code> middleware after adding the <code>cookie-parser</code> middleware<br>
(you&apos;ll need the <code>urlencoded</code> middleware to parse the request body form data in<br>
just a bit):</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> morgan <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;morgan&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;cookie-parser&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./routes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">&apos;dev&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Code removed for brevity.</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="defining-the-routes-for-the-add-book-page">Defining the routes for the Add Book page</h3>

<p>Now you&apos;re ready to define the routes for the &quot;Add Book&quot; page!</p>
<p>At the top of the <code>routes</code> module (i.e. the <code>./routes.js</code> file), add a call to<br>
the <code>require()</code> function to import the <code>csurf</code> module:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;csurf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Code removed for brevity.</span>
</pre><p>Then call the <code>csurf()</code> function to create the <code>csrfProtection</code> middleware that<br>
you&apos;ll add to each of the routes that need CSRF protection:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;csurf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> csrfProtection <span class="token operator">=</span> <span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> cookie<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Code removed for brevity.</span>
</pre><p>Now you&apos;re ready to add the routes for the &quot;Add Book&quot; page to the <code>routes</code><br>
module just after the existing default route (<code>/</code>)&#x2014;a <code>GET</code> route to initially<br>
retrieve the &quot;Add Book&quot; page&apos;s HTML form and a <code>POST</code> route to process the<br>
page&apos;s HTML form submissions:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
    book<span class="token punctuation">,</span>
    csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">,</span>
    author<span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">,</span>
    pageCount<span class="token punctuation">,</span>
    publisher<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

  <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token punctuation">,</span>
    author<span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">,</span>
    pageCount<span class="token punctuation">,</span>
    publisher<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
      book<span class="token punctuation">,</span>
      error<span class="token punctuation">:</span> err<span class="token punctuation">,</span>
      csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s an overview of the above routes:</p>
<ul>
<li>Two routes are defined for the &quot;Add Book&quot; page&#x2014;a <code>/book/add</code> <code>GET</code> route and a<br>
<code>/book/add</code> <code>POST</code> route. As mentioned earlier, the <code>GET</code> route is used to<br>
initially retrieve the page&apos;s HTML form while the <code>POST</code> route is used to<br>
process submissions from the page&apos;s HTML form.</li>
<li>Both routes use the <code>csrfProtection</code> middleware to protect against CSRF<br>
attacks.</li>
<li>Within the <code>GET</code> route handler, the Sequelize <code>db.Book.build()</code> method is used<br>
to create a new instance of the <code>Book</code> model which is then passed to the<br>
<code>book-add</code> view.</li>
<li>Within the <code>POST</code> route handler, destructuring is used to declare and<br>
initialize the <code>title</code>, <code>author</code>, <code>releaseDate</code>, <code>pageCount</code>, and <code>publisher</code><br>
variables from the <code>req.body</code> property. The <code>title</code>, <code>author</code>, <code>releaseDate</code>,<br>
<code>pageCount</code>, and <code>publisher</code> variables are then used to create a new instance<br>
of the <code>Book</code> model with a call to the <code>db.Book.build()</code> method. The<br>
<code>book.save()</code> method is called on the instance to persist the model to the<br>
database and if that operation succeeds the user is redirected to the default<br>
route (<code>/</code>). If an error occurs, the <code>book-add</code> view is rendered and sent to<br>
the client (so the error can be displayed to the end user).</li>
</ul>
<h3 class="mume-header" id="creating-the-view-for-the-add-book-page">Creating the view for the Add Book page</h3>

<p>Add a view to the <code>views</code> folder named <code>book-add.pug</code> containing the following<br>
code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> error</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">pre</span><span class="token punctuation">=</span><span class="token code"> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/book/add&apos;</span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;title&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>title <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;author&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>author <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>releaseDate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;pageCount&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>pageCount <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;publisher&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>publisher <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>Here&apos;s an overview of the above Pug template code:</p>
<ul>
<li>A conditional statement checks to see if the <code>error</code> variable is truthy (i.e.<br>
has a reference to an error) and if there&apos;s an error, the <code>JSON.stringify()</code><br>
method is used to render the error to the page as JSON. Later in this article,<br>
you&apos;ll refactor this part of the view to improve the display of errors to the<br>
end user.</li>
<li>A hidden <code>&lt;input&gt;</code> element is used to render the CSRF token value to the page<br>
(i.e. <code>input(type=&apos;hidden&apos; name=&apos;_csrf&apos; value=csrfToken)</code>).</li>
<li>A series of <code>&lt;label&gt;</code> and text <code>&lt;input&gt;</code> elements are rendered to create the<br>
form fields for the <code>Book</code> model <code>title</code>, <code>author</code>, <code>releaseDate</code>,<br>
<code>pageCount</code>, and <code>publisher</code> properties. The <a href="https://getbootstrap.com/docs/4.4/components/forms/">Bootstrap form CSS<br>
classes</a> (<code>form-group</code>, <code>form-control</code>) are used to style the<br>
form.</li>
<li>At the bottom of the form, a submit <code>&lt;button&gt;</code> element is rendered along with<br>
a &quot;Cancel&quot; hyperlink that allows the end user to navigate back to the &quot;Book<br>
List&quot; page.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> HTML <code>&lt;input&gt;</code> element types aren&apos;t used to their fullest extent in<br>
the above code. Feel free to experiment with using <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#%3Cinput%3E_types">the available <code>&lt;input&gt;</code><br>
element types</a> to add client-side validation but<br>
remember that client-side validation is intended only to improve the end user<br>
experience. Because client-side validation can easily be thwarted, validating<br>
data on the server is absolutely essential to do. You&apos;ll implement server-side<br>
validation in just a bit.</p>
</blockquote>
<h3 class="mume-header" id="testing-the-add-book-page">Testing the Add Book page</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Add Book&quot; button at the top of the &quot;Book<br>
List&quot; page to browse to the &quot;Add Book&quot; page. Provide a value for each of the<br>
form fields and click the &quot;Add Book&quot; button to submit the form to the server. Be<br>
sure that you provide a valid date value (i.e. &quot;2000-01-31&quot;). You should now see<br>
your new book in the list of books on the &quot;Book List&quot; page!</p>
<p>If you click the &quot;Add Book&quot; button again and submit the &quot;Add Book&quot; page form<br>
without providing any values, an error occurs when attempting to persist an<br>
instance of the <code>Book</code> model to the database. The lengthy error message<br>
displayed just above the form will look like this:</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SequelizeDatabaseError&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;length&quot;</span><span class="token operator">:</span> <span class="token number">116</span><span class="token punctuation">,</span>
    <span class="token property">&quot;severity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ERROR&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;22007&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datetime.c&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3774&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;routine&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DateTimeParseError&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;INSERT INTO \&quot;Books\&quot; (\&quot;id\&quot;,\&quot;title\&quot;,\&quot;author\&quot;,\&quot;releaseDate\&quot;,\&quot;pageCount\&quot;,\&quot;publisher\&quot;,\&quot;createdAt\&quot;,\&quot;updatedAt\&quot;) VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7) RETURNING *;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;Invalid date&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;length&quot;</span><span class="token operator">:</span> <span class="token number">116</span><span class="token punctuation">,</span>
    <span class="token property">&quot;severity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ERROR&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;22007&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datetime.c&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3774&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;routine&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DateTimeParseError&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;INSERT INTO \&quot;Books\&quot; (\&quot;id\&quot;,\&quot;title\&quot;,\&quot;author\&quot;,\&quot;releaseDate\&quot;,\&quot;pageCount\&quot;,\&quot;publisher\&quot;,\&quot;createdAt\&quot;,\&quot;updatedAt\&quot;) VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7) RETURNING *;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;Invalid date&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sql&quot;</span><span class="token operator">:</span> <span class="token string">&quot;INSERT INTO \&quot;Books\&quot; (\&quot;id\&quot;,\&quot;title\&quot;,\&quot;author\&quot;,\&quot;releaseDate\&quot;,\&quot;pageCount\&quot;,\&quot;publisher\&quot;,\&quot;createdAt\&quot;,\&quot;updatedAt\&quot;) VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7) RETURNING *;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Invalid date&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;2020-04-02 15:20:33.668 +00:00&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre><p>From the error message, you can see that a <code>SequelizeDatabaseError</code> occurred<br>
when attempting to insert into the <code>Books</code> table. The underlying error is a<br>
date/time parse error, which is occurring because you didn&apos;t supply a value for<br>
the <code>releaseDate</code> property on the <code>Book</code> model.</p>
<p>It&apos;s not just empty strings that result in date/time parse errors. Improperly<br>
formatted date/time <code>string</code> values&#x2014;or simply bad <code>string</code> values&#x2014;can also<br>
produce date/time parse errors. For example, all of the following <code>string</code><br>
date/time values cannot be parsed to date/time values:</p>
<ul>
<li>Jan 31st 2002</li>
<li>100/31/2002</li>
<li>Jaanuary 31, 2002</li>
</ul>
<p>You can use the <code>input</code> element&apos;s <code>placeholder</code> attribute to communicate to<br>
users an example of the expected input format. Refactor your <code>input#releaseDate</code><br>
element to include a placeholder:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> </span>
      <span class="token attr-name">id</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span> </span>
      <span class="token attr-name">name</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span> </span>
      <span class="token attr-name">value</span><span class="token punctuation">=</span><span class="token attr-value">book<span class="token punctuation">.</span>releaseDate </span>
      <span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-control&apos;</span> </span>
      <span class="token attr-name">placeholder</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;ex: 2000-01-31&apos;</span></span><span class="token punctuation">)</span></span></span>
</pre><p>Time to implement server-side validations! You&apos;ll see how to implement<br>
validations using two different approaches&#x2014;within the <code>Book</code> database model<br>
using Sequelize&apos;s built-in model validation and within the &quot;Add Book&quot; page<br>
<code>POST</code> route using the <code>express-validator</code> validation library.</p>
<h2 class="mume-header" id="implementing-server-side-validation-using-sequelize">Implementing server-side validation using Sequelize</h2>

<p>Before updating the <code>Book</code> model (the <code>./db/models/book.js</code> file), make a copy<br>
of the existing code by copying the entire file with a file extension of <code>.bak</code><br>
(i.e. <code>book.js.bak</code>) or simply copying and pasting the code within the existing<br>
file and commenting it out. When implementing validation at the route level<br>
using a validation library, you&apos;ll want a convenient way to remove or disable<br>
the validations in the <code>Book</code> model.</p>
<h3 class="mume-header" id="adding-validations-to-the-book-model">Adding validations to the <code>Book</code> model</h3>

<p>Now you&apos;re ready to update the <code>Book</code> model to the following code:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/models/book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Book <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Book&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        len<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Title must not be more than 255 characters long&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Author&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Author&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        len<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Author must not be more than 100 characters long&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Release Date&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        isDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a valid date for Release Date&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Page Count&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        isInt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a valid integer for Page Count&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        notNull<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Publisher&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        notEmpty<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Please provide a value for Publisher&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        len<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          msg<span class="token punctuation">:</span> <span class="token string">&apos;Publisher must not be more than 100 characters long&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Book<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Book<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s an overview of the above code:</p>
<ul>
<li>Sequelize validation rules or validators are applied to model<br>
properties&#x2014;referred to by Sequelize as &quot;attributes&quot;&#x2014;using the <code>validate</code><br>
property. The <code>validate</code> property is set to an object whose properties<br>
represent each validation rule to apply to the model attribute.</li>
<li>For the <code>string</code> based model attributes (i.e. text based database table<br>
columns) that don&apos;t allow <code>null</code> values&#x2014;the <code>title</code>, <code>author</code>, <code>publisher</code><br>
properties&#x2014;the <code>notNull</code> and <code>notEmpty</code> validators are applied to disallow<br>
<code>null</code> values <strong>and</strong> empty string values.</li>
<li>Notice the nuance between the <code>allowNull</code> model attribute property and the<br>
<code>notNull</code> validation rule. The <code>allowNull</code> model attribute property is set to<br>
<code>false</code> to configure the underlying database table column to disallow <code>null</code><br>
values and the <code>notNull</code> validation rule is applied to validate that a model<br>
instance attribute value is not <code>null</code>.</li>
<li>The <code>len</code> validation is also applied to the <code>string</code> based model attributes to<br>
give feedback to the end user when a model instance attribute value exceeds<br>
the configured maximum length for the underlying database table column.</li>
<li>The <code>isDate</code> and <code>isInt</code> validators are applied respectively to the<br>
<code>releaseDate</code> and <code>pageCount</code> model attributes to validate that the model<br>
instance attribute values can be successfully parsed to the underlying<br>
database table column data types.</li>
</ul>
<blockquote>
<p>Sequelize provides a variety of validators that you can apply to model<br>
attributes. For a list of the available validators, see <a href="https://sequelize.org/v5/manual/models-definition.html#validations">the official<br>
Sequelize documentation</a>.</p>
</blockquote>
<blockquote>
<p>For more information about Sequelize model validations see the &quot;Model<br>
Validations With Sequelize&quot; article in the SQL ORM lesson.</p>
</blockquote>
<h3 class="mume-header" id="updating-the-add-book-page-post-route">Updating the Add Book page <code>POST</code> route</h3>

<p>With the model validations in place, now you need to update the &quot;Add Book&quot; page<br>
<code>POST</code> route in the <code>routes</code> module (the <code>./routes.js</code> file) to process<br>
Sequelize validation errors.</p>
<p>To start, add the <code>next</code> parameter to the route handler function&apos;s parameter<br>
list:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Code removed for brevity.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Then update the <code>try</code>/<code>catch</code> statement to this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&apos;SequelizeValidationError&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> errors <span class="token operator">=</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
      book<span class="token punctuation">,</span>
      errors<span class="token punctuation">,</span>
      csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Within the <code>catch</code> block, the <code>err.name</code> property is checked to see if the error<br>
is a <code>SequelizeValidationError</code> error type which is the error type that<br>
Sequelize throws if a validation error has occurred.</p>
<p>If it&apos;s a validation error, the <code>Array#map()</code> method is called on the<br>
<code>err.errors</code> array to create an array of error messages. Currently, <code>err</code> is an<br>
object with an <code>errors</code> property.</p>
<p>The <code>err.errors</code> property is an array of <em>error objects</em> that provide detailed<br>
information about each validation error. Each element in <code>err.errors</code> has a<br>
<code>message</code> property. The <code>Array#map()</code> method plucks the <code>message</code> property from<br>
each <em>error object</em> to create an array of validation messages. This array of<br>
validation messages will be rendered on the form, instead of the array of<br>
<em>error objects</em>.</p>
<p>If the error isn&apos;t a <code>SequelizeValidationError</code> error, then the error is passed<br>
as an argument to the <code>next()</code> method call which results in Express handing the<br>
request off to the application&apos;s defined error handlers for processing.</p>
<p>For your reference, the updated &quot;Add Book&quot; page <code>POST</code> route should now look<br>
like this:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">,</span>
    author<span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">,</span>
    pageCount<span class="token punctuation">,</span>
    publisher<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

  <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token punctuation">,</span>
    author<span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">,</span>
    pageCount<span class="token punctuation">,</span>
    publisher<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&apos;SequelizeValidationError&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> errors <span class="token operator">=</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
        book<span class="token punctuation">,</span>
        errors<span class="token punctuation">,</span>
        csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="updating-the-add-book-page-view">Updating the Add Book page view</h3>

<p>The final part of implementing validations is to update the &quot;Add Book&quot; page view<br>
(the <code>./views/book-add.pug</code> file) to render the array of validation messages.<br>
Replace the existing <code>if error</code> conditional statement with the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>

<span class="token comment">//- Code removed for brevity.</span>
</pre><p>The Bootstrap <code>alert alert-danger</code> CSS classes are used to style the unordered<br>
list of validation messages.</p>
<p>For your reference, the updated &quot;Add Book&quot; page view should now look like this:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/book/add&apos;</span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;title&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>title <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;author&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>author <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>releaseDate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span> placeholder<span class="token operator">=</span><span class="token string">&apos;ex: 2000-01-31&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;pageCount&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>pageCount <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;publisher&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>publisher <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><h3 class="mume-header" id="testing-the-server-side-validations">Testing the server-side validations</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Add Book&quot; button at the top of the &quot;Book<br>
List&quot; page to browse to the &quot;Add Book&quot; page. Click the &quot;Add Book&quot; button to<br>
submit the &quot;Add Book&quot; page form without providing any values. You should now see<br>
a list of validation messages displayed just above the form.</p>
<p>Provide a value for each of the form fields and click the &quot;Add Book&quot; button to<br>
submit the form to the server. You should now see your new book in the list of<br>
books on the &quot;Book List&quot; page!</p>
<h2 class="mume-header" id="implementing-server-side-validation-using-a-validation-library">Implementing server-side validation using a validation library</h2>

<p>Keeping your application&apos;s validation logic out of your database models makes<br>
your code more modular. Improved modularity allows you to more easily update one<br>
part of your application without worrying as much about how that change will<br>
impact another part of your application.</p>
<p>In this section, you&apos;ll replace the Sequelize model validations with route level<br>
validations using the <code>express-validator</code> validation library.</p>
<h3 class="mume-header" id="removing-the-sequelize-model-validations">Removing the Sequelize model validations</h3>

<p>Before you updated the <code>Book</code> model (the <code>./db/models/book.js</code> file), you made a<br>
copy of the existing code by either copying the entire file with a file<br>
extension of <code>.bak</code> (i.e. <code>book.js.bak</code>) or copying and pasting the code within<br>
the existing file and commenting it out. It&apos;s time to use your backup copy of<br>
the <code>Book</code> model to remove the Sequelize validations.</p>
<p>For your reference, here&apos;s what the <code>Book</code> model (the <code>./db/models/book.js</code><br>
file) should look like before proceeding:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./db/models/book.js</span>

<span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Book <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&apos;Book&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    releaseDate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    pageCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    publisher<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Book<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">models</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// associations can be defined here</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Book<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="updating-the-add-book-page-post-route-1">Updating the Add Book page <code>POST</code> route</h3>

<p>From the terminal, use npm to install the <code>express-validator</code> package:</p>
<pre data-role="codeBlock" data-info="sh" class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> express-validator@^6.0.0
</pre><p>In the <code>routes</code> module (i.e. the <code>./routes.js</code> file), use the <code>require()</code><br>
function to import the <code>express-validator</code> module (just after importing the<br>
<code>csurf</code> module) and destructuring to declare and initialize the <code>check</code> and<br>
<code>validationResult</code> variables:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;csurf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> check<span class="token punctuation">,</span> validationResult <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express-validator&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Code remove for brevity.</span>
</pre><p>The <code>check</code> variable references a function (defined by the <code>express-validator</code><br>
validation library) that returns a middleware function for validating a request.<br>
When you call the <code>check()</code> method, you pass in the name of the field&#x2014;in this<br>
case a request body form field name&#x2014;that you want to validate:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> titleValidator <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The value returned by the <code>check()</code> method is a validation chain object. The<br>
object is referred to as a validation &quot;chain&quot; because you can add one or more<br>
validators by making a series of method calls.</p>
<p>One of the validators that you can add to the validation chain is the <code>exists()</code><br>
validator:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> titleValidator <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>exists()</code> validator will fail if the request body is missing a form field<br>
with the name (or key) <code>title</code> or because we set the <code>checkFalsy</code> option to<br>
<code>true</code> the validator will fail if the request body contains a form field with<br>
the name <code>title</code> but the value is set to a falsy value (eg <code>&quot;&quot;</code>, <code>0</code>, <code>false</code>,<br>
<code>null</code>).</p>
<p>When a validator fails, it&apos;ll add a validation error to the current request. You<br>
can chain a call to the <code>withMessage()</code> method to customize the validation error<br>
message for the previous validator in the chain:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> titleValidator <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Now if the <code>exists()</code> validator for the field <code>title</code> fails, a validation error<br>
will be added to the request with the message &quot;Please provide a value for<br>
Title&quot;.</p>
<p>The <code>express-validator</code> validation library is built on top of the validator.js<br>
library. This means that all of the <a href="https://github.com/validatorjs/validator.js#validators">available validators within the<br>
validator.js library</a> are available for you to use in<br>
your validation logic.</p>
<p>One of the available validators is the <code>isLength()</code> validator, which can be used<br>
to check the length of a string based field:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> titleValidator <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Title must not be more than 255 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Notice how the <code>isLength()</code> method is called directly on the return value of the<br>
<code>withMessage()</code> method? This is the validation chain in action&#x2014;each method call<br>
in the validation chain returns the validation chain so you can keep adding<br>
validators. This is also known as &quot;method chaining&quot;.</p>
<blockquote>
<p>APIs that make use of method chaining are often referred to as <a href="https://en.wikipedia.org/wiki/Fluent_interface">fluent<br>
APIs</a>.</p>
</blockquote>
<p>Instead of declaring a variable for each field that you want to define a<br>
validation chain for, you can declare a single variable that&apos;s initialized to an<br>
array of validation chains:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token keyword">const</span> bookValidators <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Title must not be more than 255 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;author&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Author&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Author must not be more than 100 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;releaseDate&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Release Date&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isISO8601</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a valid date for Release Date&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;pageCount&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Page Count&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isInt</span><span class="token punctuation">(</span><span class="token punctuation">{</span> min<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a valid integer for Page Count&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;publisher&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Publisher&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Publisher must not be more than 100 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</pre><p>Each validation chain is an Express middleware function. After initializing an<br>
array containing all of your field validation chains, you can simply add the<br>
array directly to your route definition:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> bookValidators<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Code removed for brevity.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Because each field validation chain is a middleware function and the Express<br>
Application <code>post()</code> method accepts an array of middleware functions, each<br>
validation chain will be called when the request matches the route path.</p>
<p>Within the route handler function, <code>validationResult()</code> function is used to<br>
extract any validation errors from the current request:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> bookValidators<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

    <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> validatorErrors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>validatorErrors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> errors <span class="token operator">=</span> validatorErrors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
        book<span class="token punctuation">,</span>
        errors<span class="token punctuation">,</span>
        csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>The <code>validatorErrors</code> object provides an <code>isEmpty()</code> method to check if there<br>
are any validation errors. If there aren&apos;t any validation errors, then the<br>
<code>book.save()</code> method is called to persist the book to the database and the user<br>
is redirected to the default route (i.e. the &quot;Book List&quot; page).</p>
<p>If there are validation errors, the <code>array()</code> method is called on the<br>
<code>validatorErrors</code> object to get an array of validation error objects. Each error<br>
object has a <code>msg</code> property containing the validation error message. The<br>
<code>Array#map()</code> method plucks the <code>msg</code> property from each error object into a<br>
new array of validation messages named <code>errors</code>.</p>
<blockquote>
<p>For more information about the <code>express-validator</code> library, see <a href="https://express-validator.github.io/docs/">the official<br>
documentation</a>.</p>
</blockquote>
<p>For your reference, here&apos;s what the <code>./routes.js</code> file should look like after<br>
being updated:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript"><span class="token comment">// ./routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> csrf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;csurf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> check<span class="token punctuation">,</span> validationResult <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express-validator&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./db/models&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> csrfProtection <span class="token operator">=</span> <span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> cookie<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">asyncHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;ASC&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-list&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Books&apos;</span><span class="token punctuation">,</span> books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
    book<span class="token punctuation">,</span>
    csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> bookValidators <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Title&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Title must not be more than 255 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;author&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Author&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Author must not be more than 100 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;releaseDate&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Release Date&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isISO8601</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a valid date for Release Date&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;pageCount&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Page Count&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isInt</span><span class="token punctuation">(</span><span class="token punctuation">{</span> min<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a valid integer for Page Count&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token string">&apos;publisher&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">{</span> checkFalsy<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Please provide a value for Publisher&apos;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">isLength</span><span class="token punctuation">(</span><span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withMessage</span><span class="token punctuation">(</span><span class="token string">&apos;Publisher must not be more than 100 characters long&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/add&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> bookValidators<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

    <span class="token keyword">const</span> book <span class="token operator">=</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> validatorErrors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>validatorErrors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> errors <span class="token operator">=</span> validatorErrors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-add&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Add Book&apos;</span><span class="token punctuation">,</span>
        book<span class="token punctuation">,</span>
        errors<span class="token punctuation">,</span>
        csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="testing-the-updated-server-side-validations">Testing the updated server-side validations</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Add Book&quot; button at the top of the &quot;Book<br>
List&quot; page to browse to the &quot;Add Book&quot; page. Click the &quot;Add Book&quot; button to<br>
submit the &quot;Add Book&quot; page form without providing any values. You should now see<br>
a list of validation messages displayed just above the form.</p>
<p>Provide a value for each of the form fields and click the &quot;Add Book&quot; button to<br>
submit the form to the server. You should now see your new book in the list of<br>
books on the &quot;Book List&quot; page!</p>
<h2 class="mume-header" id="adding-the-edit-book-page">Adding the Edit Book page</h2>

<p>The next page that you&apos;ll add to the Reading List application is the &quot;Edit Book&quot;<br>
page. As the name clearly suggests, this page will allow you to edit the details<br>
of a book from the reading list.</p>
<h3 class="mume-header" id="defining-the-routes-for-the-edit-book-page">Defining the routes for the Edit Book page</h3>

<p>Add the routes for the &quot;Edit Book&quot; page to the <code>routes</code> module (i.e. the<br>
<code>./routes.js file) just after the routes for the &quot;Add Book&quot; page&#x2014;a</code>GET<code>route to initially retrieve the &quot;Edit Book&quot; page&apos;s HTML form and a</code>POST` route to<br>
process the page&apos;s HTML form submissions:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/book/edit/:id(\\d+)&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bookId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> book <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-edit&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">&apos;Edit Book&apos;</span><span class="token punctuation">,</span>
      book<span class="token punctuation">,</span>
      csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/edit/:id(\\d+)&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> bookValidators<span class="token punctuation">,</span>
  <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bookId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bookToUpdate <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>

    <span class="token keyword">const</span> book <span class="token operator">=</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      author<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      pageCount<span class="token punctuation">,</span>
      publisher<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> validatorErrors <span class="token operator">=</span> <span class="token function">validationResult</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>validatorErrors<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> bookToUpdate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> errors <span class="token operator">=</span> validatorErrors<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-edit&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Edit Book&apos;</span><span class="token punctuation">,</span>
        book<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span>book<span class="token punctuation">,</span> id<span class="token punctuation">:</span> bookId <span class="token punctuation">}</span><span class="token punctuation">,</span>
        errors<span class="token punctuation">,</span>
        csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s an overview of the above routes:</p>
<ul>
<li>Just like you did for the &quot;Add Book&quot; page, two routes are defined for the<br>
&quot;Edit Book&quot; page&#x2014;a <code>GET</code> route and a <code>POST</code> route, both with a path of<br>
<code>/book/edit/:id(\\d+)</code>. The <code>:id(\\d+)</code> path segment defines the <code>id</code><br>
property in your <code>req.params</code>, the route parameter to capture the book ID to<br>
edit. The <code>\\d+</code> segment uses <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions">regexp</a> to ensure that only numbers<br>
(or <strong>d</strong>igits) will match this segment.</li>
<li>Within both route handlers, the <code>parseInt()</code> function is used to convert the<br>
<code>req.params.id</code> property from a string into an integer.</li>
<li>Within both route handlers, the Sequelize <code>db.Book.findByPk()</code> method uses the<br>
book ID to retrieve which book to edit from the database.</li>
<li>Just like in the <code>/book/add</code> route, destructuring is used to declare and<br>
initialize the <code>title</code>, <code>author</code>, <code>releaseDate</code>, <code>pageCount</code>, and <code>publisher</code><br>
variables from the <code>req.body</code> property. Those variables are then used to<br>
create a <code>book</code> object literal whose properties align with the <code>Book</code> model<br>
properties. If there aren&apos;t any validation errors, the object literal is<br>
passed into the <code>book.update()</code> method to update the book in the database and<br>
the user is redirected to the default route <code>/</code>. If there are validation<br>
errors, the <code>book-edit</code> view is re-rendered with the validation errors.</li>
</ul>
<p>When passing the <code>book</code> object into the <code>book-edit</code> view, you can use spread<br>
syntax to copy the <code>book</code> object literal properties into a new object. To the<br>
right of spreading the <code>book</code> object, an <code>id</code> property is declared and assigned<br>
to the <code>bookId</code> variable value:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">book<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>book<span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> bookId
<span class="token punctuation">}</span>
</pre><p>The spread syntax above actually creates this <code>book</code> object:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript">book<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  title<span class="token punctuation">,</span>
  author<span class="token punctuation">,</span>
  releaseDate<span class="token punctuation">,</span>
  pageCount<span class="token punctuation">,</span>
  publisher<span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> bookId
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="creating-the-view-for-the-edit-book-page">Creating the view for the Edit Book page</h3>

<p>Add a view to the <code>views</code> folder named <code>book-edit.pug</code> containing the following<br>
code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-edit.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token template-string"><span class="token string">`/book/edit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;title&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>title <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;author&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>author <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>releaseDate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span> placeholder<span class="token operator">=</span><span class="token string">&apos;ex: 2000-01-31&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;pageCount&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>pageCount <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;publisher&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>publisher <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Update Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>This view is almost the same as the view for the &quot;Add Book&quot; page. On the form<br>
element&apos;s <code>action</code> attribute and the submit button content are different.</p>
<blockquote>
<p>In just a bit, you&apos;ll see how you can leverage features built into Pug to<br>
avoid unnecessary code duplication.</p>
</blockquote>
<h3 class="mume-header" id="testing-the-edit-book-page">Testing the Edit Book page</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Edit&quot; button for one of the books listed in<br>
the table on the &quot;Book List&quot; page to edit that book. Change one or more form<br>
field values and click the &quot;Update Book&quot; button to submit the form to the<br>
server. You should now see the update book in the list of books on the &quot;Book<br>
List&quot; page!</p>
<h3 class="mume-header" id="including-view-templates-for-dryer-code">Including view templates for DRYer code</h3>

<p>Currently, the &quot;Add Book&quot; and &quot;Edit Book&quot; views contain very similar code. Pug<br>
allows you to <code>include</code> the contents of a template within another template. You<br>
can use this feature to eliminate the code duplication between the<br>
<code>./views/book-add.pug</code> and <code>./views/book-edit.pug</code> files.</p>
<p>Start by adding a new file named <code>book-form-fields.pug</code> to the <code>views</code> folder<br>
containing the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-form-fields.pug</span>

<span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;title&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Title</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;title&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>title <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;author&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Author</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;author&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>author <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;releaseDate&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Release Date</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;releaseDate&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>releaseDate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span> placeholder<span class="token operator">=</span><span class="token string">&apos;ex: 2000-01-31&apos;</span></span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;pageCount&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Page Count</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;pageCount&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>pageCount <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
<span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
  <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;publisher&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Publisher</span>
  <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;publisher&apos;</span> value<span class="token operator">=</span>book<span class="token punctuation">.</span>publisher <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span></span><span class="token punctuation">)</span></span></span>
</pre><p>Then update the <code>book-add.pug</code> and <code>book-edit.pug</code> views to the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">// ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/book/add&apos;</span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">include book-form-fields.pug</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-edit.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token template-string"><span class="token string">`/book/edit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">include book-form-fields.pug</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Update Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>Notice the use of the <code>include</code> keyword to include the contents of the<br>
<code>book-form-fields.pug</code> template.</p>
<p>Another Pug feature&#x2014;mixins&#x2014;allows you to create reusable blocks of Pug code. You<br>
can use this Pug feature to further eliminate code duplication.</p>
<p>Add a new file named <code>utils.pug</code> to the <code>views</code> folder containing the following<br>
code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/utils.pug</span>

<span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">validationErrorSummary</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span></span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>
</pre><p>Notice that the <code>validationErrorSummary</code> mixin defines an <code>errors</code> parameter. As<br>
you might expect, mixin parameters allow you to pass data into the mixin.</p>
<p>Next, update the <code>book-add.pug</code> and <code>book-edit.pug</code> views to the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">// ./views/book-add.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">include utils.pug</span>

<span class="token keyword">block content</span>
  <span class="token mixin"><span class="token name function">+validationErrorSummary</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span></span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/book/add&apos;</span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">include book-form-fields.pug</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Add Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-edit.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">include utils.pug</span>

<span class="token keyword">block content</span>
  <span class="token mixin"><span class="token name function">+validationErrorSummary</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span></span>
  <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token template-string"><span class="token string">`/book/edit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token keyword">include book-form-fields.pug</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;submit&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-primary&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Update Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;/&apos;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;btn btn-warning ml-2&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>Notice the use of the <code>include</code> keyword again to include the contents of the<br>
<code>utils.pug</code> template which makes the <code>validationErrorSummary</code> mixin available<br>
within the <code>book-add.pug</code> and <code>book-edit.pug</code> templates. The mixin is called<br>
by prefixing the mixin name with a plus sign (<code>+</code>) and adding a set of<br>
parentheses after the mixin name. Inside of the parentheses, the <code>errors</code><br>
variable is passed as an argument to the <code>validationErrorSummary</code> mixin.</p>
<p>You can go a bit further to eliminate more code duplication. Update the<br>
<code>./views/utils.pug</code> template to contain the following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/utils.pug</span>

<span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">validationErrorSummary</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span></span>
  <span class="token flow-control"><span class="token branch keyword">if</span> errors</span>
    <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;alert alert-danger&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;alert&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">p</span> <span class="token plain-text">The following error(s) occurred:</span>
      <span class="token tag">ul</span>
        <span class="token flow-control"><span class="token each"><span class="token keyword">each</span> error <span class="token keyword">in</span></span> errors</span>
          <span class="token tag">li</span><span class="token punctuation">=</span><span class="token code"> error</span>

<span class="token mixin"><span class="token keyword">mixin</span> <span class="token function">textField</span><span class="token punctuation">(</span>labelText<span class="token punctuation">,</span> fieldName<span class="token punctuation">,</span> fieldValue<span class="token punctuation">,</span> placeholder<span class="token punctuation">)</span></span>
  <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;form-group&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">label<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">for</span><span class="token punctuation">=</span><span class="token attr-value">fieldName</span><span class="token punctuation">)</span></span></span><span class="token punctuation">=</span><span class="token code"> labelText</span>
    <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;text&apos;</span> id<span class="token operator">=</span>fieldName name<span class="token operator">=</span>fieldName value<span class="token operator">=</span>fieldValue <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&apos;form-control&apos;</span> placeholder<span class="token operator">=</span>placeholder</span><span class="token punctuation">)</span></span></span>
</pre><p>Then update the <code>./views/book-form-fields.pug</code> template to contain this code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-form-fields.pug</span>

<span class="token keyword">include utils.pug</span>

<span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>title<span class="token punctuation">)</span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Author&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;author&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>author<span class="token punctuation">)</span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Release Date&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;releaseDate&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>releaseDate<span class="token punctuation">,</span> <span class="token string">&apos;ex: 2000-01-31&apos;</span><span class="token punctuation">)</span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Page Count&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pageCount&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>pageCount<span class="token punctuation">)</span></span>
<span class="token mixin"><span class="token name function">+textField</span><span class="token punctuation">(</span><span class="token string">&apos;Publisher&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;publisher&apos;</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span>publisher<span class="token punctuation">)</span></span>
</pre><p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Use the &quot;Add Book&quot; page to add a new book and then use<br>
the &quot;Edit Book&quot; page to edit the book. Everything should work as it did before<br>
the refactoring of the view code.</p>
<p>Congratulations on making your code DRYer!</p>
<h2 class="mume-header" id="add-the-delete-book-page">Add the Delete Book page</h2>

<p>The next page that you&apos;ll add to the Reading List application is the &quot;Delete<br>
Book&quot; page. This page is relatively simple as it only needs to prompt the user<br>
if the selected book is the book that they want to delete.</p>
<h3 class="mume-header" id="defining-the-routes-for-the-delete-book-page">Defining the routes for the Delete Book page</h3>

<p>Add the routes for the &quot;Delete Book&quot; page to the <code>routes</code> module (i.e. the<br>
<code>./routes.js file) just after the routes for the &quot;Edit Book&quot; page&#x2014;a</code>GET<code>route to initially retrieve the &quot;Delete Book&quot; page&apos;s HTML form and a</code>POST` route to<br>
process the page&apos;s HTML form submissions:</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/book/delete/:id(\\d+)&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bookId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> book <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;book-delete&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&apos;Delete Book&apos;</span><span class="token punctuation">,</span>
    book<span class="token punctuation">,</span>
    csrfToken<span class="token punctuation">:</span> req<span class="token punctuation">.</span><span class="token function">csrfToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/book/delete/:id(\\d+)&apos;</span><span class="token punctuation">,</span> csrfProtection<span class="token punctuation">,</span> <span class="token function">asyncHandler</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bookId <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> book <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Book<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> book<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Here&apos;s an overview of the above routes:</p>
<ul>
<li>Just like you did for the &quot;Add Book&quot; and &quot;Edit Book&quot; pages, two routes are<br>
defined for the &quot;Delete Book&quot; page&#x2014;a <code>/book/delete/:id(\\d+)</code> <code>GET</code> route and<br>
a <code>/book/delete/:id(\\d+)</code> <code>POST</code> route.</li>
<li>Within both route handlers, the <code>parseInt()</code> function is used to convert the<br>
<code>req.params.id</code> property string value into a <code>number</code>.</li>
<li>Within both route handlers, the Sequelize <code>db.Book.findByPk()</code> method is used<br>
to retrieve the book to delete from the database.</li>
<li>Within the <code>POST</code> route handler, the <code>book.destroy()</code> method is called to<br>
delete the book from the database and the user is redirected to the default<br>
route (<code>/</code>).</li>
</ul>
<h3 class="mume-header" id="creating-the-view-for-the-delete-book-page">Creating the view for the Delete Book page</h3>

<p>Add a view to the <code>views</code> folder named <code>book-delete.pug</code> containing the<br>
following code:</p>
<pre data-role="codeBlock" data-info="pug" class="language-pug"><span class="token comment">//- ./views/book-delete.pug</span>

<span class="token keyword">extends layout.pug</span>

<span class="token keyword">block content</span>
  <span class="token tag">h3</span><span class="token punctuation">=</span><span class="token code"> book<span class="token punctuation">.</span>title</span>
  <span class="token tag">div<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;py-4&apos;</span></span><span class="token punctuation">)</span></span></span>
    <span class="token tag">p</span> <span class="token plain-text">Proceed with deleting this book?</span>
  <span class="token tag">div</span>
    <span class="token tag">form<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">action</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token template-string"><span class="token string">`/book/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>book<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> method<span class="token operator">=</span><span class="token string">&apos;post&apos;</span></span><span class="token punctuation">)</span></span></span>
      <span class="token tag">input<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">type</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;hidden&apos;</span> name<span class="token operator">=</span><span class="token string">&apos;_csrf&apos;</span> value<span class="token operator">=</span>csrfToken</span><span class="token punctuation">)</span></span></span>
      <span class="token tag">button<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-danger&apos;</span> type<span class="token operator">=</span><span class="token string">&apos;submit&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Delete Book</span>
      <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">class</span><span class="token punctuation">=</span><span class="token attr-value"><span class="token string">&apos;btn btn-warning ml-2&apos;</span> href<span class="token operator">=</span><span class="token string">&apos;/&apos;</span> role<span class="token operator">=</span><span class="token string">&apos;button&apos;</span></span><span class="token punctuation">)</span></span></span> <span class="token plain-text">Cancel</span>
</pre><p>The purpose of this view is simple: display the title of the book that&apos;s about<br>
to be deleted and render a simple form containing a hidden <code>&lt;input&gt;</code> element for<br>
the CSRF token and a <code>&lt;button&gt;</code> element to submit the form.</p>
<h3 class="mume-header" id="testing-the-delete-book-page">Testing the Delete Book page</h3>

<p>Run the command <code>npm start</code> to start your application and browse to<br>
<code>http://localhost:8080/</code>. Click the &quot;Delete&quot; button for one of the books listed<br>
in the table on the &quot;Book List&quot; page to delete that book. On the &quot;Delete Book&quot;<br>
page, click the &quot;Delete Book&quot; button to delete the book. You should now see that<br>
the book has been removed from the list of books on the &quot;Book List&quot; page!</p>
<h2 class="mume-header" id="what-you-learned-12">What you learned</h2>

<p>In this article, you learned how to:</p>
<ul>
<li>Define a collection of routes and views that use Sequelize to perform CRUD<br>
operations against a single resource; and</li>
<li>Handle Sequelize validation errors when users are attempting to create or<br>
update data and display error messages to the user so that they can resolve<br>
any data quality issues.</li>
</ul>
<p>You also reviewed the following:</p>
<ul>
<li>Using a wrapper function to catch errors thrown within asynchronous route<br>
handler functions;</li>
<li>Using Pug to create HTML forms;</li>
<li>Using the <code>csurf</code> middleware to protect against CSRF exploits;</li>
<li>Using the built-in <code>express.urlencoded()</code> middleware function to parse<br>
incoming request body form data;</li>
<li>Using Sequelize model validations to validate user-provided data;</li>
<li>Using the <code>express-validator</code> validation library to validate user-provided<br>
data within an Express route; and</li>
<li>Using Pug includes and mixins to remove unnecessary code duplication.</li>
</ul>

      </div>
      <div class="md-sidebar-toc"><ul>
<li><a href="#regular-expressions-learning-objectives">Regular Expressions Learning Objectives</a></li>
<li><a href="#http-full-stack-learning-objectives">HTTP Full-Stack Learning Objectives</a></li>
<li><a href="#the-uniform-resource-locator-url">The Uniform Resource Locator (URL)</a>
<ul>
<li><a href="#the-specification">The specification</a></li>
<li><a href="#what-is-this-resource-thing">What is this &quot;resource&quot; thing?</a></li>
<li><a href="#the-components-of-a-url">The components of a URL</a>
<ul>
<li><a href="#the-scheme-of-a-url">The &quot;scheme&quot; of a URL</a></li>
<li><a href="#stuff-between-the-scheme-and-authority">Stuff between the scheme and authority</a></li>
<li><a href="#the-authority">The authority</a></li>
<li><a href="#the-path">The path</a></li>
<li><a href="#the-query">The query</a></li>
<li><a href="#the-fragment">The fragment</a></li>
</ul>
</li>
<li><a href="#reading-rfcs">Reading RFCs</a></li>
<li><a href="#what-youve-learned">What you&apos;ve learned</a></li>
</ul>
</li>
<li><a href="#regular-expressions-cheat-sheet">Regular Expressions Cheat Sheet</a>
<ul>
<li><a href="#the-operator">The * operator</a>
<ul>
<li><a href="#example-1-xyz">Example 1: <code>xy*z</code></a></li>
<li><a href="#example-2-xyz">Example 2: <code>x*yz</code></a></li>
<li><a href="#example-3-xyz">Example 3: <code>xyz*</code></a></li>
</ul>
</li>
<li><a href="#the-operator-1">The ? operator</a>
<ul>
<li><a href="#example-1-videos">Example 1: <code>videos?</code></a></li>
<li><a href="#example-2-videos">Example 2: <code>videos\?</code></a></li>
<li><a href="#example-3-videos-watched">Example 3: <code>videos? watched\?</code></a></li>
</ul>
</li>
<li><a href="#the-operator-2">The + operator</a>
<ul>
<li><a href="#example-1-xyz-1">Example 1: <code>xy+z</code></a></li>
<li><a href="#example-2-xyz-1">Example 2: <code>x+yz</code></a></li>
<li><a href="#example-3-xyz-1">Example 3: <code>xyz+</code></a></li>
</ul>
</li>
<li><a href="#the-operator-3">The . operator</a>
<ul>
<li><a href="#example-1-a">Example 1: <code>..a..</code></a></li>
<li><a href="#example-2-at">Example 2: <code>.at.</code></a></li>
<li><a href="#example-3">Example 3: <code>...\?</code></a></li>
</ul>
</li>
<li><a href="#the-operator-without-brackets">The ^ operator without brackets</a>
<ul>
<li><a href="#example-1-dog">Example 1: <code>^Dog</code></a></li>
<li><a href="#example-2-dog">Example 2: <code>^dog</code></a></li>
<li><a href="#example-3-1">Example 3: <code>^\?</code></a></li>
</ul>
</li>
<li><a href="#the-operator-4">The $ operator</a>
<ul>
<li><a href="#example-1-smell">Example 1: <code>smell$</code></a></li>
<li><a href="#example-2-dog-1">Example 2: <code>dog.$</code></a></li>
<li><a href="#example-3-doggie-smell">Example 3: <code>^doggie smell$</code></a></li>
</ul>
</li>
<li><a href="#the-bracket-expression">The [] bracket expression</a>
<ul>
<li><a href="#example-1-aein">Example 1: <code>[aei]n</code></a></li>
<li><a href="#example-2-robot-0-9">Example 2: <code>robot [0-9]</code></a></li>
<li><a href="#example-3-dw">Example 3: <code>\.[dw]</code></a></li>
<li><a href="#the-inside-brackets">The - inside brackets</a>
<ul>
<li><a href="#example-1-0-5-cats">Example 1: <code>[0-5] cats</code></a></li>
<li><a href="#example-2-a-dl-po-s">Example 2: <code>[A-D][l-p][o-s]</code></a></li>
<li><a href="#example-3-a-z0-9a-z">Example 3: <code>[a-z][0-9][A-Z]</code></a></li>
</ul>
</li>
<li><a href="#the-inside-brackets-1">The ^ inside brackets</a>
<ul>
<li><a href="#example-1-b">Example 1: ``</a></li>
<li><a href="#example-2-bcat">Example 2: <code>at</code></a></li>
<li><a href="#example-3-bcog">Example 3: <code>o</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#regexone-practice">RegexOne Practice</a></li>
<li><a href="#http-full-stack-project">HTTP Full-Stack Project</a>
<ul>
<li><a href="#project-overview">Project overview</a>
<ul>
<li><a href="#the-data-model">The data model</a></li>
<li><a href="#the-functionality">The functionality</a></li>
</ul>
</li>
<li><a href="#get-started">Get started</a></li>
<li><a href="#phase-1-installing-one-tool">Phase 1: Installing one tool</a></li>
<li><a href="#phase-2-getting-the-server-started">Phase 2: Getting the server started</a></li>
<li><a href="#phase-3-understand-the-code">Phase 3: Understand the code</a></li>
<li><a href="#phase-4-showing-images">Phase 4: Showing images</a>
<ul>
<li><a href="#phase-4a-the-happy-path">Phase 4a: The happy path</a></li>
</ul>
</li>
<li><a href="#phase-4b-no-image-found">Phase 4b: No image found</a></li>
<li><a href="#phase-5-showing-a-static-html-page">Phase 5: Showing a static HTML page</a></li>
<li><a href="#phase-6-first-step-in-dynamic-content">Phase 6: First step in dynamic content</a></li>
<li><a href="#phase-7-handling-the-adding-of-an-item">Phase 7: Handling the adding of an item</a>
<ul>
<li><a href="#phase-7a-getting-the-submitted-data">Phase 7a: Getting the submitted data</a></li>
<li><a href="#phase-7b-parsing-the-submitted-data">Phase 7b: Parsing the submitted data</a></li>
<li><a href="#phase-7c-create-an-item">Phase 7c: Create an Item</a></li>
<li><a href="#phase-7d-redirect-the-browser">Phase 7d: Redirect the browser</a></li>
</ul>
</li>
<li><a href="#phase-8-generate-dynamic-content">Phase 8: Generate dynamic content</a></li>
<li><a href="#phase-9">Phase 9</a></li>
<li><a href="#complete">Complete!</a></li>
</ul>
</li>
<li><a href="#express-learning-objectives">Express Learning Objectives</a></li>
<li><a href="#pug-template-learning-objectives">Pug Template Learning Objectives</a></li>
<li><a href="#moving-into-the-express-lane">Moving Into the Express Lane</a>
<ul>
<li><a href="#installing-express">Installing Express</a>
<ul>
<li><a href="#git-and-the-node_modules-folder">Git and the <code>node_modules</code> folder</a></li>
</ul>
</li>
<li><a href="#creating-an-express-application">Creating an Express application</a></li>
<li><a href="#handling-requests">Handling requests</a></li>
<li><a href="#listening-for-http-connections">Listening for HTTP connections</a></li>
<li><a href="#testing-your-application">Testing your application</a></li>
<li><a href="#what-you-learned">What you learned</a></li>
<li><a href="#see-also">See also&#x2026;</a></li>
</ul>
</li>
<li><a href="#templating-meet-pug">Templating - <em>Meet Pug!</em></a>
<ul>
<li><a href="#what-is-a-template">What is a template?</a></li>
<li><a href="#rendering-a-simple-template">Rendering a simple template</a>
<ul>
<li><a href="#setting-up-the-project">Setting up the project</a></li>
<li><a href="#creating-a-template">Creating a template</a></li>
<li><a href="#configuring-express-to-use-a-template-engine">Configuring Express to use a template engine</a></li>
<li><a href="#rendering-a-template">Rendering a template</a></li>
</ul>
</li>
<li><a href="#what-you-learned-1">What you learned</a></li>
</ul>
</li>
<li><a href="#digging-into-the-pug-template-syntax">Digging Into the Pug Template Syntax</a>
<ul>
<li><a href="#setting-up-a-sandbox-application">Setting up a sandbox application</a></li>
<li><a href="#rendering-elements">Rendering elements</a></li>
<li><a href="#setting-element-attribute-values">Setting element attribute values</a>
<ul>
<li><a href="#setting-class-and-id-attribute-values">Setting <code>class</code> and <code>id</code> attribute values</a></li>
</ul>
</li>
<li><a href="#rendering-data">Rendering data</a></li>
<li><a href="#iteration-and-conditionals">Iteration and conditionals</a></li>
<li><a href="#what-you-learned-2">What you learned</a></li>
<li><a href="#see-also-1">See also&#x2026;</a></li>
</ul>
</li>
<li><a href="#exploring-route-paths">Exploring Route Paths</a>
<ul>
<li><a href="#getting-data-from-a-path">Getting data from a path</a>
<ul>
<li><a href="#leveraging-route-parameters">Leveraging route parameters</a></li>
<li><a href="#restricting-route-parameter-matches">Restricting route parameter matches</a></li>
</ul>
</li>
<li><a href="#defining-flexible-route-paths">Defining flexible route paths</a>
<ul>
<li><a href="#using-a-string-pattern">Using a string pattern</a></li>
<li><a href="#using-a-regular-expression">Using a regular expression</a></li>
<li><a href="#using-an-array-of-paths">Using an array of paths</a></li>
</ul>
</li>
<li><a href="#redirecting-incorrect-requests">Redirecting &quot;incorrect&quot; requests</a></li>
<li><a href="#what-you-learned-3">What you learned</a></li>
</ul>
</li>
<li><a href="#express-routers">Express Routers</a>
<ul>
<li><a href="#setting-up-the-initial-project">Setting up the initial project</a></li>
<li><a href="#defining-a-collection-of-route-handlers">Defining a collection of route handlers</a></li>
<li><a href="#mounting-a-router-instance">Mounting a Router instance</a>
<ul>
<li><a href="#testing-the-application">Testing the application</a></li>
</ul>
</li>
<li><a href="#what-you-learned-4">What you learned</a></li>
<li><a href="#see-also-2">See also&#x2026;</a></li>
</ul>
</li>
<li><a href="#routing-roundup-project">Routing Roundup Project</a>
<ul>
<li><a href="#getting-started">Getting started</a></li>
<li><a href="#phase-1-defining-the-default-route">Phase 1: Defining the default route</a></li>
<li><a href="#phase-2-using-a-template-to-render-html">Phase 2: Using a template to render HTML</a></li>
<li><a href="#phase-3-defining-another-flexible-route">Phase 3: Defining another flexible route</a></li>
<li><a href="#phase-4-capturing-a-value-from-the-url-path">Phase 4: Capturing a value from the URL path</a></li>
<li><a href="#phase-5-defining-a-collection-of-route-handlers">Phase 5: Defining a collection of route handlers</a></li>
<li><a href="#what-weve-learned">What We&apos;ve Learned</a></li>
</ul>
</li>
<li><a href="#html-forms-learning-objectives">HTML Forms Learning Objectives</a></li>
<li><a href="#html-forms-an-introduction">HTML Forms: An Introduction</a>
<ul>
<li><a href="#key-components-of-a-form">Key components of a form</a>
<ul>
<li><a href="#form"><code>&lt;form&gt;</code></a></li>
<li><a href="#input"><code>&lt;input&gt;</code></a></li>
</ul>
</li>
<li><a href="#submitting-the-form">Submitting the form</a></li>
<li><a href="#what-youve-learned-1">What you&apos;ve learned</a></li>
</ul>
</li>
<li><a href="#html-forms-in-express">HTML Forms in Express</a>
<ul>
<li><a href="#forms-example-setup">Forms example setup</a></li>
<li><a href="#getting-the-add-guest-form">Getting the &quot;Add Guest&quot; form</a></li>
<li><a href="#a-quick-aside-pug-layout-templates">A quick aside: Pug layout templates</a></li>
<li><a href="#submitting-the-guest-form">Submitting the guest form</a>
<ul>
<li><a href="#x-www-form-urlencoded"><code>x-www-form-urlencoded</code></a></li>
<li><a href="#parsing-the-request-body">Parsing the request body</a></li>
</ul>
</li>
<li><a href="#what-youve-learned-2">What you&apos;ve learned</a></li>
</ul>
</li>
<li><a href="#data-validation">Data Validation</a>
<ul>
<li><a href="#importance-of-server-side-data-validation">Importance of server-side data validation</a>
<ul>
<li><a href="#lack-of-trust-in-client-side-validations">Lack of trust in client-side validations</a></li>
</ul>
</li>
<li><a href="#server-side-validations">Server-side validations</a>
<ul>
<li><a href="#expected-data-types">Expected data types</a></li>
<li><a href="#valid-ranges-and-format">Valid ranges and format</a></li>
<li><a href="#other-validations">Other validations</a></li>
</ul>
</li>
<li><a href="#server-side-validations-an-example">Server-side validations: an example</a>
<ul>
<li><a href="#setup">Setup</a></li>
<li><a href="#validations-checking-that-all-fields-are-filled">Validations: checking that all fields are filled</a></li>
<li><a href="#validations-ensuring-that-numguests-is-valid">Validations: ensuring that <code>numGuests</code> is valid</a></li>
<li><a href="#improve-user-experience">Improve user experience</a></li>
</ul>
</li>
<li><a href="#recap">Recap</a></li>
</ul>
</li>
<li><a href="#express-middleware">Express Middleware</a>
<ul>
<li><a href="#middleware-overview">Middleware overview</a>
<ul>
<li><a href="#anatomy-of-a-middleware-function">Anatomy of a middleware function</a></li>
<li><a href="#series-of-middleware-functions">Series of middleware functions</a></li>
<li><a href="#application-level-middleware">Application-level middleware</a></li>
</ul>
</li>
<li><a href="#data-validations-with-middleware">Data validations with middleware</a></li>
<li><a href="#what-you-learned-5">What you learned</a></li>
</ul>
</li>
<li><a href="#protecting-forms-from-csrf">Protecting forms from CSRF</a>
<ul>
<li><a href="#csrf-explained">CSRF explained</a></li>
<li><a href="#preventing-csrf">Preventing CSRF</a>
<ul>
<li><a href="#example-setup">Example setup</a></li>
<li><a href="#using-the-csurf-library">Using the <code>csurf</code> library</a></li>
</ul>
</li>
<li><a href="#what-you-learned-6">What you learned</a></li>
</ul>
</li>
<li><a href="#formative-forms-project">Formative Forms Project</a>
<ul>
<li><a href="#getting-started-1">Getting started</a></li>
<li><a href="#phase-0-intro-to-the-skeleton-directory">Phase 0: Intro to the skeleton directory</a></li>
<li><a href="#phase-1-home-page">Phase 1: Home page</a></li>
<li><a href="#phase-2-create-the-normal-user-form">Phase 2: Create the normal user form</a></li>
<li><a href="#phase-3-submitting-the-form">Phase 3: Submitting the form</a></li>
<li><a href="#phase-4-create-interesting-user-form">Phase 4: Create interesting user form</a></li>
<li><a href="#phase-5-submit-create-interesting-user-form">Phase 5: Submit create interesting user form</a></li>
<li><a href="#bonus">Bonus</a></li>
</ul>
</li>
<li><a href="#data-driven-web-sites-learning-objectives">Data-Driven Web Sites Learning Objectives</a></li>
<li><a href="#acclimating-to-environment-variables">Acclimating to Environment Variables</a>
<ul>
<li><a href="#what-are-environment-variables">What are environment variables?</a>
<ul>
<li><a href="#how-are-environment-variables-commonly-used">How are environment variables commonly used?</a></li>
</ul>
</li>
<li><a href="#setting-and-getting-environment-variable-values">Setting and getting environment variable values</a>
<ul>
<li><a href="#setting-an-environment-variable-value">Setting an environment variable value</a></li>
<li><a href="#getting-an-environment-variable-value">Getting an environment variable value</a></li>
</ul>
</li>
<li><a href="#storing-environment-variables-in-a-env-file">Storing environment variables in a <code>.env</code> file</a>
<ul>
<li><a href="#loading-environment-variables-on-application-startup">Loading environment variables on application startup</a></li>
<li><a href="#another-way-to-use-dotenv">Another way to use dotenv</a></li>
<li><a href="#keeping-the-env-file-out-of-source-control">Keeping the <code>.env</code> file out of source control</a></li>
</ul>
</li>
<li><a href="#using-a-module-to-organize-environment-variables">Using a module to organize environment variables</a>
<ul>
<li><a href="#running-npm-binaries">Running npm binaries</a></li>
<li><a href="#defining-environment-specific-npm-scripts">Defining environment specific npm scripts</a></li>
</ul>
</li>
<li><a href="#what-you-learned-7">What you learned</a></li>
</ul>
</li>
<li><a href="#asynchronous-route-handlers-in-express">Asynchronous Route Handlers in Express</a>
<ul>
<li><a href="#calling-asynchronous-functions-or-methods-within-route-handlers">Calling asynchronous functions or methods within route handlers</a>
<ul>
<li><a href="#creating-a-simple-asynchronous-function">Creating a simple asynchronous function</a></li>
<li><a href="#setting-up-the-express-application">Setting up the Express application</a></li>
<li><a href="#using-asyncawait">Using <code>async</code>/<code>await</code></a></li>
<li><a href="#catching-errors-thrown-by-asynchronous-functions-or-methods">Catching errors thrown by asynchronous functions or methods</a></li>
</ul>
</li>
<li><a href="#reducing-boilerplate-code">Reducing boilerplate code</a>
<ul>
<li><a href="#writing-an-asynchronous-route-handler-wrapper-function">Writing an asynchronous route handler wrapper function</a></li>
<li><a href="#using-the-asynchronous-route-handler-wrapper-function">Using the asynchronous route handler wrapper function</a></li>
</ul>
</li>
<li><a href="#what-you-learned-8">What you learned</a></li>
<li><a href="#see-also-3">See also&#x2026;</a></li>
</ul>
</li>
<li><a href="#handling-errors-in-express">Handling Errors in Express</a>
<ul>
<li><a href="#setting-up-an-example-express-application">Setting up an example Express application</a></li>
<li><a href="#the-default-error-handler-in-express">The default error handler in Express</a>
<ul>
<li><a href="#do-you-need-a-custom-error-handler">Do you need a custom error handler?</a></li>
</ul>
</li>
<li><a href="#defining-a-custom-error-handler">Defining a custom error handler</a>
<ul>
<li><a href="#defining-multiple-custom-error-handlers">Defining multiple custom error handlers</a></li>
</ul>
</li>
<li><a href="#handling-page-not-found-errors">Handling &quot;Page Not Found&quot; errors</a>
<ul>
<li><a href="#creating-a-page-not-found-page">Creating a &quot;Page Not Found&quot; page</a></li>
</ul>
</li>
<li><a href="#what-you-learned-9">What you learned</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-part-1-setting-up-the-project">Data-Driven Websites - Part 1: Setting Up the Project</a>
<ul>
<li><a href="#setting-up-the-project-1">Setting up the project</a>
<ul>
<li><a href="#initializing-npm-and-installing-dependencies">Initializing npm and installing dependencies</a></li>
</ul>
</li>
<li><a href="#stubbing-out-the-application">Stubbing out the application</a>
<ul>
<li><a href="#testing-the-initial-application-setup">Testing the initial application setup</a></li>
</ul>
</li>
<li><a href="#splitting-the-application-and-server-into-separate-modules">Splitting the application and server into separate modules</a>
<ul>
<li><a href="#updating-the-app-module">Updating the <code>app</code> module</a></li>
<li><a href="#defining-a-new-entry-point-for-the-application">Defining a new entry point for the application</a></li>
<li><a href="#taking-a-closer-look-at-the-binwww-file">Taking a closer look at the <code>./bin/www</code> file</a></li>
</ul>
</li>
<li><a href="#logging-requests-using-morgan">Logging requests using Morgan</a></li>
<li><a href="#adding-custom-error-handlers">Adding custom error handlers</a>
<ul>
<li><a href="#testing-your-custom-error-handlers">Testing your custom error handlers</a></li>
</ul>
</li>
<li><a href="#configuring-environment-variables">Configuring environment variables</a>
<ul>
<li><a href="#adding-the-env-and-envexample-files">Adding the <code>.env</code> and <code>.env.example</code> files</a></li>
<li><a href="#adding-the-config-module">Adding the <code>config</code> module</a></li>
<li><a href="#updating-the-npm-start-script">Updating the npm <code>start</code> script</a></li>
<li><a href="#supporting-debugging-in-visual-studio-code">Supporting debugging in Visual Studio Code</a></li>
</ul>
</li>
<li><a href="#setting-up-bootstrap">Setting up Bootstrap</a></li>
<li><a href="#what-you-learned-10">What you learned</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-project-part-2-integrating-sequelize-with-express">Data-Driven Websites Project (Part 2: Integrating Sequelize with Express)</a>
<ul>
<li><a href="#installing-and-configuring-sequelize">Installing and configuring Sequelize</a>
<ul>
<li><a href="#configuring-the-sequelize-cli">Configuring the Sequelize CLI</a></li>
<li><a href="#initializing-sequelize">Initializing Sequelize</a></li>
<li><a href="#creating-a-new-database-and-database-user">Creating a new database and database user</a></li>
<li><a href="#adding-the-database-environment-variables">Adding the database environment variables</a></li>
<li><a href="#configuring-the-sequelize-database-connection">Configuring the Sequelize database connection</a></li>
</ul>
</li>
<li><a href="#testing-the-connection-to-the-database">Testing the connection to the database</a></li>
<li><a href="#creating-the-book-model">Creating the Book model</a>
<ul>
<li><a href="#updating-the-generated-book-model-and-migration-files">Updating the generated <code>Book</code> model and migration files</a></li>
<li><a href="#applying-the-pending-migration">Applying the pending migration</a></li>
</ul>
</li>
<li><a href="#seeding-the-database">Seeding the database</a></li>
<li><a href="#querying-and-rendering-a-temporary-list-of-books">Querying and rendering a temporary list of books</a></li>
<li><a href="#what-you-learned-11">What you learned</a></li>
</ul>
</li>
<li><a href="#data-driven-websites-project-part-3-using-sequelize-to-perform-crud-operations">Data-Driven Websites Project (Part 3: Using Sequelize to Perform CRUD Operations)</a>
<ul>
<li><a href="#planning-the-routes-and-views">Planning the routes and views</a></li>
<li><a href="#creating-the-book-list-page">Creating the Book List page</a>
<ul>
<li><a href="#applying-bootstrap-styles-to-the-book-list-page">Applying Bootstrap styles to the Book List page</a></li>
<li><a href="#adding-an-asynchronous-route-handler-wrapper-function">Adding an asynchronous route handler wrapper function</a></li>
<li><a href="#testing-the-book-list-page">Testing the Book List page</a></li>
</ul>
</li>
<li><a href="#adding-the-add-book-page">Adding the Add Book page</a>
<ul>
<li><a href="#adding-protection-from-csrf-attacks">Adding protection from CSRF attacks</a></li>
<li><a href="#defining-the-routes-for-the-add-book-page">Defining the routes for the Add Book page</a></li>
<li><a href="#creating-the-view-for-the-add-book-page">Creating the view for the Add Book page</a></li>
<li><a href="#testing-the-add-book-page">Testing the Add Book page</a></li>
</ul>
</li>
<li><a href="#implementing-server-side-validation-using-sequelize">Implementing server-side validation using Sequelize</a>
<ul>
<li><a href="#adding-validations-to-the-book-model">Adding validations to the <code>Book</code> model</a></li>
<li><a href="#updating-the-add-book-page-post-route">Updating the Add Book page <code>POST</code> route</a></li>
<li><a href="#updating-the-add-book-page-view">Updating the Add Book page view</a></li>
<li><a href="#testing-the-server-side-validations">Testing the server-side validations</a></li>
</ul>
</li>
<li><a href="#implementing-server-side-validation-using-a-validation-library">Implementing server-side validation using a validation library</a>
<ul>
<li><a href="#removing-the-sequelize-model-validations">Removing the Sequelize model validations</a></li>
<li><a href="#updating-the-add-book-page-post-route-1">Updating the Add Book page <code>POST</code> route</a></li>
<li><a href="#testing-the-updated-server-side-validations">Testing the updated server-side validations</a></li>
</ul>
</li>
<li><a href="#adding-the-edit-book-page">Adding the Edit Book page</a>
<ul>
<li><a href="#defining-the-routes-for-the-edit-book-page">Defining the routes for the Edit Book page</a></li>
<li><a href="#creating-the-view-for-the-edit-book-page">Creating the view for the Edit Book page</a></li>
<li><a href="#testing-the-edit-book-page">Testing the Edit Book page</a></li>
<li><a href="#including-view-templates-for-dryer-code">Including view templates for DRYer code</a></li>
</ul>
</li>
<li><a href="#add-the-delete-book-page">Add the Delete Book page</a>
<ul>
<li><a href="#defining-the-routes-for-the-delete-book-page">Defining the routes for the Delete Book page</a></li>
<li><a href="#creating-the-view-for-the-delete-book-page">Creating the view for the Delete Book page</a></li>
<li><a href="#testing-the-delete-book-page">Testing the Delete Book page</a></li>
</ul>
</li>
<li><a href="#what-you-learned-12">What you learned</a></li>
</ul>
</li>
</ul>
</div>
      <a id="sidebar-toc-btn">&#x2261;</a>
    
    
    
    
    
    
    
    
<script>

var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </body></html>