<!DOCTYPE html>
<html>
  <head>
<script>window.NREUM||(NREUM={});NREUM.info={"beacon":"bam-cell.nr-data.net","errorBeacon":"bam-cell.nr-data.net","licenseKey":"98ebaa2fbd","applicationID":"233526624","transactionName":"c11aERNaXltSERdDR19YUQYVGltZUwZA","queueTime":2,"applicationTime":166,"agent":""}</script>
<script>(window.NREUM||(NREUM={})).loader_config={licenseKey:"98ebaa2fbd",applicationID:"233526624"};window.NREUM||(NREUM={}),__nr_require=function(e,t,n){function r(n){if(!t[n]){var i=t[n]={exports:{}};e[n][0].call(i.exports,function(t){var i=e[n][1][t];return r(i||t)},i,i.exports)}return t[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<n.length;i++)r(n[i]);return r}({1:[function(e,t,n){function r(){}function i(e,t,n){return function(){return o(e,[u.now()].concat(c(arguments)),t?null:this,n),t?void 0:this}}var o=e("handle"),a=e(6),c=e(7),f=e("ee").get("tracer"),u=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",l=p+"ixn-";a(d,function(e,t){s[t]=i(p+t,!0,"api")}),s.addPageAction=i(p+"addPageAction",!0),s.setCurrentRouteName=i(p+"routeName",!0),t.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,t){var n={},r=this,i="function"==typeof t;return o(l+"tracer",[u.now(),e,n],r),function(){if(f.emit((i?"":"no-")+"fn-start",[u.now(),r,i],n),i)try{return t.apply(this,arguments)}catch(e){throw f.emit("fn-err",[arguments,this,e],n),e}finally{f.emit("fn-end",[u.now()],n)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,t){m[t]=i(l+t)}),newrelic.noticeError=function(e,t){"string"==typeof e&&(e=new Error(e)),o("err",[e,u.now(),!1,t])}},{}],2:[function(e,t,n){function r(){return c.exists&&performance.now?Math.round(performance.now()):(o=Math.max((new Date).getTime(),o))-a}function i(){return o}var o=(new Date).getTime(),a=o,c=e(8);t.exports=r,t.exports.offset=a,t.exports.getLastTimestamp=i},{}],3:[function(e,t,n){function r(e,t){var n=e.getEntries();n.forEach(function(e){"first-paint"===e.name?d("timing",["fp",Math.floor(e.startTime)]):"first-contentful-paint"===e.name&&d("timing",["fcp",Math.floor(e.startTime)])})}function i(e,t){var n=e.getEntries();n.length>0&&d("lcp",[n[n.length-1]])}function o(e){e.getEntries().forEach(function(e){e.hadRecentInput||d("cls",[e])})}function a(e){if(e instanceof m&&!g){var t=Math.round(e.timeStamp),n={type:e.type};t<=p.now()?n.fid=p.now()-t:t>p.offset&&t<=Date.now()?(t-=p.offset,n.fid=p.now()-t):t=p.now(),g=!0,d("timing",["fi",t,n])}}function c(e){d("pageHide",[p.now(),e])}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var f,u,s,d=e("handle"),p=e("loader"),l=e(5),m=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){f=new PerformanceObserver(r);try{f.observe({entryTypes:["paint"]})}catch(v){}u=new PerformanceObserver(i);try{u.observe({entryTypes:["largest-contentful-paint"]})}catch(v){}s=new PerformanceObserver(o);try{s.observe({type:"layout-shift",buffered:!0})}catch(v){}}if("addEventListener"in document){var g=!1,w=["click","keydown","mousedown","pointerdown","touchstart"];w.forEach(function(e){document.addEventListener(e,a,!1)})}l(c)}},{}],4:[function(e,t,n){function r(e,t){if(!i)return!1;if(e!==i)return!1;if(!t)return!0;if(!o)return!1;for(var n=o.split("."),r=t.split("."),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var c=navigator.userAgent,f=c.match(a);f&&c.indexOf("Chrome")===-1&&c.indexOf("Chromium")===-1&&(i="Safari",o=f[1])}t.exports={agent:i,version:o,match:r}},{}],5:[function(e,t,n){function r(e){function t(){e(a&&document[a]?document[a]:document[i]?"hidden":"visible")}"addEventListener"in document&&o&&document.addEventListener(o,t,!1)}t.exports=r;var i,o,a;"undefined"!=typeof document.hidden?(i="hidden",o="visibilitychange",a="visibilityState"):"undefined"!=typeof document.msHidden?(i="msHidden",o="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(i="webkitHidden",o="webkitvisibilitychange",a="webkitVisibilityState")},{}],6:[function(e,t,n){function r(e,t){var n=[],r="",o=0;for(r in e)i.call(e,r)&&(n[o]=t(r,e[r]),o+=1);return n}var i=Object.prototype.hasOwnProperty;t.exports=r},{}],7:[function(e,t,n){function r(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,i=n-t||0,o=Array(i<0?0:i);++r<i;)o[r]=e[t+r];return o}t.exports=r},{}],8:[function(e,t,n){t.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,t,n){function r(){}function i(e){function t(e){return e&&e instanceof r?e:e?u(e,f,a):a()}function n(n,r,i,o,a){if(a!==!1&&(a=!0),!l.aborted||o){e&&a&&e(n,r,i);for(var c=t(i),f=v(n),u=f.length,s=0;s<u;s++)f[s].apply(c,r);var p=d[h[n]];return p&&p.push([b,n,r,c]),c}}function o(e,t){y[e]=v(e).concat(t)}function m(e,t){var n=y[e];if(n)for(var r=0;r<n.length;r++)n[r]===t&&n.splice(r,1)}function v(e){return y[e]||[]}function g(e){return p[e]=p[e]||i(n)}function w(e,t){s(e,function(e,n){t=t||"feature",h[n]=t,t in d||(d[t]=[])})}var y={},h={},b={on:o,addEventListener:o,removeEventListener:m,emit:n,get:g,listeners:v,context:t,buffer:w,abort:c,aborted:!1};return b}function o(e){return u(e,f,a)}function a(){return new r}function c(){(d.api||d.feature)&&(l.aborted=!0,d=l.backlog={})}var f="nr@context",u=e("gos"),s=e(6),d={},p={},l=t.exports=i();t.exports.getOrSetContext=o,l.backlog=d},{}],gos:[function(e,t,n){function r(e,t,n){if(i.call(e,t))return e[t];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return e[t]=r,r}var i=Object.prototype.hasOwnProperty;t.exports=r},{}],handle:[function(e,t,n){function r(e,t,n,r){i.buffer([e],r),i.emit(e,t,n)}var i=e("ee").get("handle");t.exports=r,r.ee=i},{}],id:[function(e,t,n){function r(e){var t=typeof e;return!e||"object"!==t&&"function"!==t?-1:e===window?0:a(e,o,function(){return i++})}var i=1,o="nr@id",a=e("gos");t.exports=r},{}],loader:[function(e,t,n){function r(){if(!x++){var e=b.info=NREUM.info,t=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&t))return u.abort();f(y,function(t,n){e[t]||(e[t]=n)});var n=a();c("mark",["onload",n+b.offset],null,"api"),c("timing",["load",n]);var r=p.createElement("script");r.src="https://"+e.agent,t.parentNode.insertBefore(r,t)}}function i(){"complete"===p.readyState&&o()}function o(){c("mark",["domContent",a()+b.offset],null,"api")}var a=e(2),c=e("handle"),f=e(6),u=e("ee"),s=e(4),d=window,p=d.document,l="addEventListener",m="attachEvent",v=d.XMLHttpRequest,g=v&&v.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:v,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1194.min.js"},h=v&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),b=t.exports={offset:a.getLastTimestamp(),now:a,origin:w,features:{},xhrWrappable:h,userAgent:s};e(1),e(3),p[l]?(p[l]("DOMContentLoaded",o,!1),d[l]("load",r,!1)):(p[m]("onreadystatechange",i),d[m]("onload",r)),c("mark",["firstbyte",a.getLastTimestamp()],null,"api");var x=0},{}],"wrap-function":[function(e,t,n){function r(e,t){function n(t,n,r,f,u){function nrWrapper(){var o,a,s,p;try{a=this,o=d(arguments),s="function"==typeof r?r(o,a):r||{}}catch(l){i([l,"",[o,a,f],s],e)}c(n+"start",[o,a,f],s,u);try{return p=t.apply(a,o)}catch(m){throw c(n+"err",[o,a,m],s,u),m}finally{c(n+"end",[o,a,p],s,u)}}return a(t)?t:(n||(n=""),nrWrapper[p]=t,o(t,nrWrapper,e),nrWrapper)}function r(e,t,r,i,o){r||(r="");var c,f,u,s="-"===r.charAt(0);for(u=0;u<t.length;u++)f=t[u],c=e[f],a(c)||(e[f]=n(c,s?f+r:r,i,f,o))}function c(n,r,o,a){if(!m||t){var c=m;m=!0;try{e.emit(n,r,o,t,a)}catch(f){i([f,n,r,o],e)}m=c}}return e||(e=s),n.inPlace=r,n.flag=p,n}function i(e,t){t||(t=s);try{t.emit("internal-error",e)}catch(n){}}function o(e,t,n){if(Object.defineProperty&&Object.keys)try{var r=Object.keys(e);return r.forEach(function(n){Object.defineProperty(t,n,{get:function(){return e[n]},set:function(t){return e[n]=t,t}})}),t}catch(o){i([o],n)}for(var a in e)l.call(e,a)&&(t[a]=e[a]);return t}function a(e){return!(e&&e instanceof Function&&e.apply&&!e[p])}function c(e,t){var n=t(e);return n[p]=e,o(e,n,s),n}function f(e,t,n){var r=e[t];e[t]=c(r,n)}function u(){for(var e=arguments.length,t=new Array(e),n=0;n<e;++n)t[n]=arguments[n];return t}var s=e("ee"),d=e(7),p="nr@original",l=Object.prototype.hasOwnProperty,m=!1;t.exports=r,t.exports.wrapFunction=c,t.exports.wrapInPlace=f,t.exports.argsToArray=u},{}]},{},["loader"]);</script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-6242674-23"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-6242674-23', { 'optimize_id': 'GTM-T48MRN9'});
    </script>

    <title>Whatsapp Web Reveng</title>
<meta name="description" content="Reverse engineering WhatsApp Web.">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://awesomeopensource.com/project/sigalor/whatsapp-web-reveng">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

      /* copy template below */
      /* ------------------- */
      /* ----------------- */
      /* ----------------- */

      /*ipad and below */


      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {

      }

      /* end template copy */
      /* ----------------- */
      /* ----------------- */
      /* ----------------- */

      /*ipad and below */
      .show_on_phones {
        display: block;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .show_on_phones {
          display: none;
        }
      }

      .twenty_px_padding_top {
        padding-top: 20px;
      }

      /*ipad and below */
      .projects_category_explorer_left_column {
        max-width: 0;
        margin-right: 0;
        display: none;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .projects_category_explorer_left_column {
          min-width: 20%;
          margin-right: 5%;
          display: block;
        }
      }

      /*ipad and below */
      .projects_list_right_column {
        min-width: 100%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .projects_list_right_column {
          min-width: 75%;
        }
      }

      .display_flex {
        display: flex;
      }

      .margin_bottom_15 {
        margin-bottom: 15px;
      }

      /*ipad and below */
      .image-gallery-image {
        width: 100% !important;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .image-gallery-image {
          width: 1280px !important;
        }
      }

      /*ipad and below */
      .aos_sponsorship_link {
        font-size: 14px;
        font-weight: bold;
        color: blue;
        text-decoration: underline;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_sponsorship_link {
          font-size: 18px;
          font-weight: bold;
          color: blue;
          text-decoration: underline;
        }
      }

      /*ipad and below */
      .aos_desktop_right_ads_container {
        display: none;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_desktop_right_ads_container {
          display: block;
        }
      }

      /*ipad and below */
      .aos_project_screen_container {
        margin-left: 5%;
        margin-right: 5%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_screen_container {
          margin-left: 5%;
          margin-right: 0;
          display: flex;
        }
      }

      /*ipad and below */
      .aos_project_inner_screen_container {
        width: 100%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_inner_screen_container {
          width: 95%;
        }
      }

      /*ipad and below
      .aos_license_text_metadata {
        margin-top: 0 !important;
      }

      everything larger than ipad
      @media screen and (min-width: 1024px) {
        .aos_license_text_metadata {
          margin-top: 0 !important;
        }
      }*/

      /*ipad and below */
      .projects_list_ad_slot_1 {
        height: fit-content;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .projects_list_ad_slot_1 {
          height: fit-content;
        }
      }

      /*ipad and below */
      .projects_list_ad_slot_2 {
        height: fit-content;
        margin-top: -34px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .projects_list_ad_slot_2 {
          height: fit-content;
          margin-top: 0;
        }
      }

      /*ipad and below */
      .project_page_ad_slot_1 {
        display: block;
        height: fit-content;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .project_page_ad_slot_1 {
          display: block;
          height: fit-content;
        }
      }

      /*ipad and below */
      .project_page_ad_slot_2 {
        display: block;
        height: fit-content;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .project_page_ad_slot_2 {
          display: block;
          height: fit-content;
        }
      }

      /*ipad and below */
      .aos_category_explorer_category_container {
        background-color: white;
        padding: 10px;
        margin-bottom: 0px;
        border-bottom: 1px solid lightgray;
        border-left: 1px solid lightgray;
        border-right: 1px solid lightgray;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_category_explorer_category_container {
          background-color: white;
          padding: 10px;
          margin-bottom: 0px;
          border-bottom: 1px solid lightgray;
          border-left: 1px solid lightgray;
          border-right: 1px solid lightgray;
        }
      }

      .aos_category_explorer_category_container:first-child {
        border-top: 1px solid lightgray;
      }

      /*ipad and below */
      .aos_topic_count {
        font-size: 10px;
        color: #4f4f4f;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_topic_count {
          font-size: 16px;
          color: #4f4f4f;
        }
      }

      /*ipad and below */
      .aos_topic_icon {
        display: none;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_topic_icon {
          font-size: 14px;
          display: inline-block;
        }
      }

      /*ipad and below */
      .aos_project_count {
        color: #4f4f4f;
        font-size: 14px;
        font-weight: bold;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_count {
          font-size: 14px;
          font-weight: bold;
        }
      }

      /*ipad and below */
      .aos_project_star {
        font-size: 14px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_star {
          font-size: 14px;
          /*margin-right: 7px;*/
        }
      }

      /*ipad and below */
      .aos_project_metadata_trademark_notice {
        font-size: 8px;
        color: gray;
        margin-top: 10px;
        border-bottom: 1px solid lightgray;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_metadata_trademark_notice {
          font-size: 12px;
          color: gray;
          margin-top: 20px;
          border-bottom: 1px solid lightgray;
        }
      }

      /*ipad and below */
      .aos_project_metadata_description {
        margin-bottom: 10px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_metadata_description {
          margin-bottom: 5px;
        }
      }

      .aos_project_metadata {
        display: inline-block;
        margin-bottom: 10px;
        width: 100%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_metadata {
          display: inline-block;
          margin-bottom: 10px;
          width: 100%;
        }
      }

      /*ipad and below */
      .aos_project_metadata_content {
        /*border-bottom: 1px solid lightgray;*/
        font-size: 16px;
        color: #000000;
        font-weight: 300;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_metadata_content {
          /*border-bottom: 1px solid lightgray;*/
          font-size: 16px;
          color: #000000;
          font-weight: 300;
        }
      }

      /*ipad and below */
      .aos_project_metadata_header {
        color: #808080;
        margin-bottom: 10px;
        margin-top: 10px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_metadata_header {
          color: #808080;
          margin-bottom: 10px;
          margin-top: 10px;
          font-size: 16px;
        }
      }

      aos_project_metadata_header:hover {
        color: #808080;
      }

      /*ipad and below */
      .aos_project_metadata_title {
        font-size: 20px;
        margin-bottom: 5px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_metadata_title {
          font-size: 30px;
          margin-bottom: 10px;
        }
      }

      /*ipad and below */
      .aos_app_container {
        display: flex;
        flex-direction: row;
        width: 100%;
        margin-bottom: 2px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_app_container {
          display: flex;
          flex-direction: row;
          width: 100%;
          margin-bottom: 0;
        }
      }

      @media screen and (min-width: 1025px) {
        .aos_desktop_ad_spacer {
          margin-top: 5px;
          margin-bottom: 5px;
        }
      }

      /*ipad and below */
      .aos_show_ad_on_mobile {
        display: none;
      }

      @media screen and (max-width: 1024px) {
        .aos_show_ad_on_mobile {
          /*display: inline-block;*/
          display: block; /*adsense recommended*/
        }
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1025px) {
        .aos_show_ad_on_desktop {
          /*display: inline-block;*/
          display: block; /*adsense recommended*/
        }
      }

      /*ipad and below */
      @media screen and (max-width: 1024px) {
        .aos_show_ad_on_desktop {
          display: none;
        }
      }

      /*ipad and below */
      .aos_filter_topics_input {
        font-size: 16px;
        padding: 10px;
        border: 1px solid lightgray;
        background-color: white;
        border-radius: 10px;
        box-shadow: 1px 1px 5px lightgrey;
        margin-bottom: 20px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_filter_topics_input {
          font-size: 20px;
          padding: 10px;
          border: 1px solid lightgray;
          background-color: white;
          border-radius: 10px;
          box-shadow: 1px 1px 5px lightgrey;
          margin-bottom: 20px;
        }
      }

      /* ipad and below */
      .aos_topics_project {
        font-family: helvetica, arial, sans-serif;
        font-size: 12px;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_topics_project {
          font-family: helvetica, arial, sans-serif;
          margin-bottom: 0;
          font-size: 20px;
          border-radius: 10px;
          padding: 0;
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          width: 100%;
        }
      }

      /* ipad and below
      .aos_topics_sidebar {
        font-family: helvetica, arial, sans-serif;
        font-size: 12px;
        margin-left: 2%;
        margin-right: 2%;
        width: 94%;
        padding: 0;
        display: flex;
        flex-direction: column;
      }

       everything larger than ipad
      @media screen and (min-width: 1024px) {
        .aos_topics_sidebar {
          font-family: helvetica, arial, sans-serif;
          margin-left: 5%;
          margin-right: 2%;
          width: 30%;
          margin-bottom: 0;
          font-size: 20px;
          border-radius: 10px;
          padding: 0;
          display: flex;
          flex-direction: column;
        }
      }*/

      /*ipad and below */
      .aos_pill_box {
        display: flex;
        color: black;
        border-radius: 5px;
        padding: 2px;
        margin: 2px;
        align-items: center;
        border-color: black;
        background-color: white;
        font-size: 12px;
        border: 1px solid black;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_pill_box {
          display: flex;
          color: black;
          border-radius: 5px;
          padding: 5px;
          margin: 10px;
          align-items: center;
          border: 0;
          background-color: white;
          box-shadow: 1px 1px 10px 1px rgba(0,0,0,0.25);
          font-size: 16px;
        }
      }

      /*ipad and below */
      .aos_selected_topics_text_container {
        display: none;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_selected_topics_text_container {
          margin-left: 25px;
          margin-right: 10px;
          margin-bottom: 10px;
          margin-top: 10px;
          padding: 5px;
          font-weight: bold;
          font-size: 20px;
          white-space: nowrap;
          display: inline-block;
        }
      }

      /*ipad and below */
      .aos_pagenavigator_links_container {
        display: flex;
        justify-content: space-around;
        font-size: 12px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_pagenavigator_links_container {
          display: flex;
          justify-content: space-around;
          font-size: 16px;
        }
      }

      /*ipad and below */
      .aos_project_container {
        padding-bottom: 20px;
        padding-left: 0;
        padding-right: 0;
        padding-top: 5px;
        width: 100%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_container {
          /*border-radius: 10px;*/
          padding-bottom: 20px;
          padding-left: 0;
          padding-right: 0;
          padding-top: 5px;
          width: 100%;
        }
      }

      /*ipad and below */
      .aos_project_description {
        font-size: 16px;
        width: 100%;
        font-weight: 300; /* match adsense */
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_description {
          font-size: 16px;
          font-weight: 300; /* match adsense */
        }
      }

      /*ipad and below */
      .aos_project_title {
        font-size: 20px;
        margin-bottom: 2px;
        font-weight: 400; /* match adsense */
        width: 100%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_project_title {
          font-size: 20px;
          margin-bottom: 2px;
          font-weight: 400; /* match adsense */
        }
      }

      .aos_project_title a :hover {
        text-decoration: none !important;
      }

      .aos_no_underline:hover {
        text-decoration: none !important;
      }

      .aos_grey_link:hover {
        color: #808080 !important;
      }

      .aos_grey_link {
        color: #808080 !important;
      }

      /*ipad and below */
      .category_topic_filter_container {
        width: 94%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .category_topic_filter_container {
          width: 94%;
        }
      }

      /*ipad and below */
      .aos_projects_container {
        font-family: helvetica, arial, sans-serif;
        margin-right: 2%;
        width: 96%; /* won't insert an ad this small (68%), but bigger and it overflows to the right with some topics that are long */
        font-size: 14px;
        margin-bottom: 5px;
        margin-left: 2%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_projects_container {
          font-family: helvetica, arial, sans-serif;
          margin-right: 0;
          width: 90%; /* was 53 before removing right margin spacer / ad container */
          font-size: 18px;
          margin-bottom: 5px;
          min-width: 800px;
          margin-left: 5%;
        }
      }

      /*ipad and below */
      .aos_pagenavigator_container {
        display: flex;
        justify-content: center;
        font-size: 9px;
        margin-bottom: 0;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_pagenavigator_container {
          display: flex;
          justify-content: center;
          font-size: 16px;
          margin-bottom: 10px;
        }
      }

      /*ipad and below */
      .aos_header_title_container_ipad_and_smaller {
        font-size: 12px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 134px;
        white-space: nowrap;
        flex-direction: column;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_header_title_container_ipad_and_smaller {
          display: none;
        }
      }


      /*ipad and below */
      .aos_header_title_container_larger_than_ipad {
        display: none;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_header_title_container_larger_than_ipad {
          display: block;
        }
      }

      /*ipad and below */
      .aos_logo_image {
        height: 25px;
        width: 25px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_logo_image {
          height: 50px;
          width: 50px;
        }
      }

      /*ipad and below */
      .aos_fixed_footer_container {
        display: flex;
        margin-left: 0;
        margin-right: 0;
        margin-top: 2px;
        width: 100%;
        justify-content: center;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_fixed_footer_container {
          display: flex;
          margin-left: 5%;
          margin-right: 20%;
          margin-top: 5px;
          margin-bottom: 5px;
          width: 75%;
          justify-content: center;
        }
      }

      /*ipad and below */
      .aos_fixed_header_container {
        margin-left: 2%;
        margin-right: 2%;
        margin-top: 4px;
        margin-bottom: 2px;
        width: 96%;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_fixed_header_container {
          margin-left: 5%;
          margin-right: 20%;
          margin-top: 5px;
          margin-bottom: 5px;
          width: 75%;
        }
      }

      /*ipad and below */
      body {
        margin-top: 0;
        margin-right: 0;
        margin-bottom: 0;
        margin-left: 0;
        padding: 0
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        body {
          margin-top: 0;
          margin-right: 0;
          margin-bottom: 0;
          margin-left: 0;
          padding: 0
        }
      }

      /* ipad and below */
      .aos_topics_sidebar_link {
        width: 100%;
        margin-bottom: 10px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 14px;
      }

      /* everything larger than ipad */
      @media screen and (min-width: 1024px) {
        .aos_topics_sidebar_link {
          width: 100%;
          margin-bottom: 10px;
          font-size: 18px;
        }
      }

      html {
        margin: 0;
        padding: 0
      }

      a {
        color: #000000;
        text-decoration: none;
      }

      a:visited {
        text-decoration: none;
      }

      a:hover {
        /*color: #0366d6;*/
        color: #000000; /* match adsense */
        text-decoration: underline;
      }

      .AOS_Pill:hover {
        text-decoration: none;
      }

      /* MIT licensed github-markdown.css */
      /* https://github.com/sindresorhus/github-markdown-css */
      @font-face {
        font-family: octicons-link;
        src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff');
      }
      .markdown-body {
        -ms-text-size-adjust: 100%;
        -webkit-text-size-adjust: 100%;
        line-height: 1.5;
        color: #24292e;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        font-size: 16px;
        line-height: 1.5;
        word-wrap: break-word;
      }
      .markdown-body .pl-c {
        color: #6a737d;
      }
      .markdown-body .pl-c1,
      .markdown-body .pl-s .pl-v {
        color: #005cc5;
      }
      .markdown-body .pl-e,
      .markdown-body .pl-en {
        color: #6f42c1;
      }
      .markdown-body .pl-smi,
      .markdown-body .pl-s .pl-s1 {
        color: #24292e;
      }
      .markdown-body .pl-ent {
        color: #22863a;
      }
      .markdown-body .pl-k {
        color: #d73a49;
      }
      .markdown-body .pl-s,
      .markdown-body .pl-pds,
      .markdown-body .pl-s .pl-pse .pl-s1,
      .markdown-body .pl-sr,
      .markdown-body .pl-sr .pl-cce,
      .markdown-body .pl-sr .pl-sre,
      .markdown-body .pl-sr .pl-sra {
        color: #032f62;
      }
      .markdown-body .pl-v,
      .markdown-body .pl-smw {
        color: #e36209;
      }
      .markdown-body .pl-bu {
        color: #b31d28;
      }
      .markdown-body .pl-ii {
        color: #fafbfc;
        background-color: #b31d28;
      }
      .markdown-body .pl-c2 {
        color: #fafbfc;
        background-color: #d73a49;
      }
      .markdown-body .pl-c2::before {
        content: "^M";
      }
      .markdown-body .pl-sr .pl-cce {
        font-weight: bold;
        color: #22863a;
      }
      .markdown-body .pl-ml {
        color: #735c0f;
      }
      .markdown-body .pl-mh,
      .markdown-body .pl-mh .pl-en,
      .markdown-body .pl-ms {
        font-weight: bold;
        color: #005cc5;
      }
      .markdown-body .pl-mi {
        font-style: italic;
        color: #24292e;
      }
      .markdown-body .pl-mb {
        font-weight: bold;
        color: #24292e;
      }
      .markdown-body .pl-md {
        color: #b31d28;
        background-color: #ffeef0;
      }
      .markdown-body .pl-mi1 {
        color: #22863a;
        background-color: #f0fff4;
      }
      .markdown-body .pl-mc {
        color: #e36209;
        background-color: #ffebda;
      }
      .markdown-body .pl-mi2 {
        color: #f6f8fa;
        background-color: #005cc5;
      }
      .markdown-body .pl-mdr {
        font-weight: bold;
        color: #6f42c1;
      }
      .markdown-body .pl-ba {
        color: #586069;
      }
      .markdown-body .pl-sg {
        color: #959da5;
      }
      .markdown-body .pl-corl {
        text-decoration: underline;
        color: #032f62;
      }
      .markdown-body .octicon {
        display: inline-block;
        vertical-align: text-top;
        fill: currentColor;
      }
      .markdown-body a {
        background-color: transparent;
      }
      .markdown-body a:active,
      .markdown-body a:hover {
        outline-width: 0;
      }
      .markdown-body strong {
        font-weight: inherit;
      }
      .markdown-body strong {
        font-weight: bolder;
      }
      .markdown-body h1 {
        font-size: 2em;
        margin: 0.67em 0;
      }
      .markdown-body img {
        border-style: none;
      }
      .markdown-body code,
      .markdown-body kbd,
      .markdown-body pre {
        font-family: monospace, monospace;
        font-size: 1em;
      }
      .markdown-body hr {
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }
      .markdown-body input {
        font: inherit;
        margin: 0;
      }
      .markdown-body input {
        overflow: visible;
      }
      .markdown-body [type="checkbox"] {
        box-sizing: border-box;
        padding: 0;
      }
      .markdown-body * {
        box-sizing: border-box;
      }
      .markdown-body input {
        font-family: inherit;
        font-size: inherit;
        line-height: inherit;
      }
      .markdown-body a {
        color: #0366d6;
        text-decoration: none;
      }
      .markdown-body a:hover {
        text-decoration: underline;
      }
      .markdown-body strong {
        font-weight: 600;
      }
      .markdown-body hr {
        height: 0;
        margin: 15px 0;
        overflow: hidden;
        background: transparent;
        border: 0;
        border-bottom: 1px solid #dfe2e5;
      }
      .markdown-body hr::before {
        display: table;
        content: "";
      }
      .markdown-body hr::after {
        display: table;
        clear: both;
        content: "";
      }
      .markdown-body table {
        border-spacing: 0;
        border-collapse: collapse;
      }
      .markdown-body td,
      .markdown-body th {
        padding: 0;
      }
      .markdown-body h1,
      .markdown-body h2,
      .markdown-body h3,
      .markdown-body h4,
      .markdown-body h5,
      .markdown-body h6 {
        margin-top: 0;
        margin-bottom: 0;
      }
      .markdown-body h1 {
        font-size: 32px;
        font-weight: 600;
      }
      .markdown-body h2 {
        font-size: 24px;
        font-weight: 600;
      }
      .markdown-body h3 {
        font-size: 20px;
        font-weight: 600;
      }
      .markdown-body h4 {
        font-size: 16px;
        font-weight: 600;
      }
      .markdown-body h5 {
        font-size: 14px;
        font-weight: 600;
      }
      .markdown-body h6 {
        font-size: 12px;
        font-weight: 600;
      }
      .markdown-body p {
        margin-top: 0;
        margin-bottom: 10px;
      }
      .markdown-body blockquote {
        margin: 0;
      }
      .markdown-body ul,
      .markdown-body ol {
        padding-left: 0;
        margin-top: 0;
        margin-bottom: 0;
      }
      .markdown-body ol ol,
      .markdown-body ul ol {
        list-style-type: lower-roman;
      }
      .markdown-body ul ul ol,
      .markdown-body ul ol ol,
      .markdown-body ol ul ol,
      .markdown-body ol ol ol {
        list-style-type: lower-alpha;
      }
      .markdown-body dd {
        margin-left: 0;
      }
      .markdown-body code {
        font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
        font-size: 12px;
      }
      .markdown-body pre {
        margin-top: 0;
        margin-bottom: 0;
        font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
        font-size: 12px;
      }
      .markdown-body .octicon {
        vertical-align: text-bottom;
      }
      .markdown-body .pl-0 {
        padding-left: 0 !important;
      }
      .markdown-body .pl-1 {
        padding-left: 4px !important;
      }
      .markdown-body .pl-2 {
        padding-left: 8px !important;
      }
      .markdown-body .pl-3 {
        padding-left: 16px !important;
      }
      .markdown-body .pl-4 {
        padding-left: 24px !important;
      }
      .markdown-body .pl-5 {
        padding-left: 32px !important;
      }
      .markdown-body .pl-6 {
        padding-left: 40px !important;
      }
      .markdown-body::before {
        display: table;
        content: "";
      }
      .markdown-body::after {
        display: table;
        clear: both;
        content: "";
      }
      .markdown-body>*:first-child {
        margin-top: 0 !important;
      }
      .markdown-body>*:last-child {
        margin-bottom: 0 !important;
      }
      .markdown-body a:not([href]) {
        color: inherit;
        text-decoration: none;
      }
      .markdown-body .anchor {
        float: left;
        padding-right: 4px;
        margin-left: -20px;
        line-height: 1;
      }
      .markdown-body .anchor:focus {
        outline: none;
      }
      .markdown-body p,
      .markdown-body blockquote,
      .markdown-body ul,
      .markdown-body ol,
      .markdown-body dl,
      .markdown-body table,
      .markdown-body pre {
        margin-top: 0;
        margin-bottom: 16px;
      }
      .markdown-body hr {
        height: 0.25em;
        padding: 0;
        margin: 24px 0;
        background-color: #e1e4e8;
        border: 0;
      }
      .markdown-body blockquote {
        padding: 0 1em;
        color: #6a737d;
        border-left: 0.25em solid #dfe2e5;
      }
      .markdown-body blockquote>:first-child {
        margin-top: 0;
      }
      .markdown-body blockquote>:last-child {
        margin-bottom: 0;
      }
      .markdown-body kbd {
        display: inline-block;
        padding: 3px 5px;
        font-size: 11px;
        line-height: 10px;
        color: #444d56;
        vertical-align: middle;
        background-color: #fafbfc;
        border: solid 1px #c6cbd1;
        border-bottom-color: #959da5;
        border-radius: 3px;
        box-shadow: inset 0 -1px 0 #959da5;
      }
      .markdown-body h1,
      .markdown-body h2,
      .markdown-body h3,
      .markdown-body h4,
      .markdown-body h5,
      .markdown-body h6 {
        margin-top: 24px;
        margin-bottom: 16px;
        font-weight: 600;
        line-height: 1.25;
      }
      .markdown-body h1 .octicon-link,
      .markdown-body h2 .octicon-link,
      .markdown-body h3 .octicon-link,
      .markdown-body h4 .octicon-link,
      .markdown-body h5 .octicon-link,
      .markdown-body h6 .octicon-link {
        color: #1b1f23;
        vertical-align: middle;
        visibility: hidden;
      }
      .markdown-body h1:hover .anchor,
      .markdown-body h2:hover .anchor,
      .markdown-body h3:hover .anchor,
      .markdown-body h4:hover .anchor,
      .markdown-body h5:hover .anchor,
      .markdown-body h6:hover .anchor {
        text-decoration: none;
      }
      .markdown-body h1:hover .anchor .octicon-link,
      .markdown-body h2:hover .anchor .octicon-link,
      .markdown-body h3:hover .anchor .octicon-link,
      .markdown-body h4:hover .anchor .octicon-link,
      .markdown-body h5:hover .anchor .octicon-link,
      .markdown-body h6:hover .anchor .octicon-link {
        visibility: visible;
      }
      .markdown-body h1 {
        padding-bottom: 0.3em;
        font-size: 2em;
        border-bottom: 1px solid #eaecef;
      }
      .markdown-body h2 {
        padding-bottom: 0.3em;
        font-size: 1.5em;
        border-bottom: 1px solid #eaecef;
      }
      .markdown-body h3 {
        font-size: 1.25em;
      }
      .markdown-body h4 {
        font-size: 1em;
      }
      .markdown-body h5 {
        font-size: 0.875em;
      }
      .markdown-body h6 {
        font-size: 0.85em;
        color: #6a737d;
      }
      .markdown-body ul,
      .markdown-body ol {
        padding-left: 2em;
      }
      .markdown-body ul ul,
      .markdown-body ul ol,
      .markdown-body ol ol,
      .markdown-body ol ul {
        margin-top: 0;
        margin-bottom: 0;
      }
      .markdown-body li {
        word-wrap: break-all;
      }
      .markdown-body li>p {
        margin-top: 16px;
      }
      .markdown-body li+li {
        margin-top: 0.25em;
      }
      .markdown-body dl {
        padding: 0;
      }
      .markdown-body dl dt {
        padding: 0;
        margin-top: 16px;
        font-size: 1em;
        font-style: italic;
        font-weight: 600;
      }
      .markdown-body dl dd {
        padding: 0 16px;
        margin-bottom: 16px;
      }
      .markdown-body table {
        display: block;
        width: 100%;
        overflow: auto;
      }
      .markdown-body table th {
        font-weight: 600;
      }
      .markdown-body table th,
      .markdown-body table td {
        padding: 6px 13px;
        border: 1px solid #dfe2e5;
      }
      .markdown-body table tr {
        background-color: #fff;
        border-top: 1px solid #c6cbd1;
      }
      .markdown-body table tr:nth-child(2n) {
        background-color: #f6f8fa;
      }
      .markdown-body img {
        max-width: 100%;
        box-sizing: content-box;
        background-color: #fff;
      }
      .markdown-body img[align=right] {
        padding-left: 20px;
      }
      .markdown-body img[align=left] {
        padding-right: 20px;
      }
      .markdown-body code {
        padding: 0.2em 0.4em;
        margin: 0;
        font-size: 85%;
        background-color: rgba(27,31,35,0.05);
        border-radius: 3px;
      }
      .markdown-body pre {
        word-wrap: normal;
      }
      .markdown-body pre>code {
        padding: 0;
        margin: 0;
        font-size: 100%;
        word-break: normal;
        white-space: pre;
        background: transparent;
        border: 0;
      }
      .markdown-body .highlight {
        margin-bottom: 16px;
      }
      .markdown-body .highlight pre {
        margin-bottom: 0;
        word-break: normal;
      }
      .markdown-body .highlight pre,
      .markdown-body pre {
        padding: 16px;
        overflow: auto;
        font-size: 85%;
        line-height: 1.45;
        background-color: #f6f8fa;
        border-radius: 3px;
      }
      .markdown-body pre code {
        display: inline;
        max-width: auto;
        padding: 0;
        margin: 0;
        overflow: visible;
        line-height: inherit;
        word-wrap: normal;
        background-color: transparent;
        border: 0;
      }
      .markdown-body .full-commit .btn-outline:not(:disabled):hover {
        color: #005cc5;
        border-color: #005cc5;
      }
      .markdown-body kbd {
        display: inline-block;
        padding: 3px 5px;
        font: 11px "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
        line-height: 10px;
        color: #444d56;
        vertical-align: middle;
        background-color: #fafbfc;
        border: solid 1px #d1d5da;
        border-bottom-color: #c6cbd1;
        border-radius: 3px;
        box-shadow: inset 0 -1px 0 #c6cbd1;
      }
      .markdown-body :checked+.radio-label {
        position: relative;
        z-index: 1;
        border-color: #0366d6;
      }
      .markdown-body .task-list-item {
        list-style-type: none;
      }
      .markdown-body .task-list-item+.task-list-item {
        margin-top: 3px;
      }
      .markdown-body .task-list-item input {
        margin: 0 0.2em 0.25em -1.6em;
        vertical-align: middle;
      }
      .markdown-body hr {
        border-bottom-color: #eee;
      }
      /* github-markdown.css overrides */
      .markdown-body h2 {
        margin-bottom: 0;
        margin-top: 0;
      }

      .hll { background-color: #ffffcc }
      .c { color: #008000 } /* Comment */
      .err { border: 1px solid #FF0000 } /* Error */
      .k { color: #0000ff } /* Keyword */
      .cm { color: #008000 } /* Comment.Multiline */
      .cp { color: #0000ff } /* Comment.Preproc */
      .c1 { color: #008000 } /* Comment.Single */
      .cs { color: #008000 } /* Comment.Special */
      .ge { font-style: italic } /* Generic.Emph */
      .gh { font-weight: bold } /* Generic.Heading */
      .gp { font-weight: bold } /* Generic.Prompt */
      .gs { font-weight: bold } /* Generic.Strong */
      .gu { font-weight: bold } /* Generic.Subheading */
      .kc { color: #0000ff } /* Keyword.Constant */
      .kd { color: #0000ff } /* Keyword.Declaration */
      .kn { color: #0000ff } /* Keyword.Namespace */
      .kp { color: #0000ff } /* Keyword.Pseudo */
      .kr { color: #0000ff } /* Keyword.Reserved */
      .kt { color: #2b91af } /* Keyword.Type */
      .s { color: #a31515 } /* Literal.String */
      .nc { color: #2b91af } /* Name.Class */
      .ow { color: #0000ff } /* Operator.Word */
      .sb { color: #a31515 } /* Literal.String.Backtick */
      .sc { color: #a31515 } /* Literal.String.Char */
      .sd { color: #a31515 } /* Literal.String.Doc */
      .s2 { color: #a31515 } /* Literal.String.Double */
      .se { color: #a31515 } /* Literal.String.Escape */
      .sh { color: #a31515 } /* Literal.String.Heredoc */
      .si { color: #a31515 } /* Literal.String.Interpol */
      .sx { color: #a31515 } /* Literal.String.Other */
      .sr { color: #a31515 } /* Literal.String.Regex */
      .s1 { color: #a31515 } /* Literal.String.Single */
      .ss { color: #a31515 } /* Literal.String.Symbol */

    </style>

    <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Product",
  "name": "sigalor/whatsapp-web-reveng",
  "description": "Reverse engineering WhatsApp Web.",
  "url": "https://awesomeopensource.com/project/sigalor/whatsapp-web-reveng",
  "sku": "project/sigalor/whatsapp-web-reveng",
  "mpn": "project/sigalor/whatsapp-web-reveng",
  "image": "https://github.com/sigalor.png",
  "brand": {
    "@type": "Brand",
    "name": "sigalor/whatsapp-web-reveng",
    "logo": "https://github.com/sigalor.png"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.94",
    "ratingCount": "4815"
  }
}
</script>


    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="XUuUOkPMQSihgeIBvPzLMfff89aMg8alPgKGmfg2QICYF4bsxmnKat+0HH22Ra5FTNFdSTcA7V7TPDMJKHPgGg==" />
  <script async src='/cdn-cgi/bm/cv/669835187/api.js'></script></head>

  <body>
    <script type="application/json" id="js-react-on-rails-context">{"railsEnv":"production","inMailer":false,"i18nLocale":"en","i18nDefaultLocale":"en","rorVersion":"11.2.1","rorPro":false,"href":"http://awesomeopensource.com/project/sigalor/whatsapp-web-reveng","location":"/project/sigalor/whatsapp-web-reveng","scheme":"http","host":"awesomeopensource.com","port":null,"pathname":"/project/sigalor/whatsapp-web-reveng","search":null,"httpAcceptLanguage":null,"serverSide":false}</script>
<div id="Root-react-component-b60edf15-d40a-4285-af67-b242c3142445"><div style="font-family:helvetica, arial, sans-serif" data-reactroot=""><div class="aos_fixed_header_container"><div class="display_flex margin_bottom_15"><div style="margin-right:1%;display:flex;align-items:center"><a href="https://awesomeopensource.com" title="Awesome Open Source Home" rel="canonical"><img src="https://awesomeopensource.com/awesome.gif" class="aos_logo_image"/></a></div><div class="aos_header_title_container_larger_than_ipad"><div style="white-space:nowrap;font-size:24px;font-weight:bold;display:flex;flex-direction:row;align-items:center;height:100%"><div>Awesome Open Source</div></div></div><div class="aos_header_title_container_ipad_and_smaller"><div>Awesome Open Source</div></div><div style="display:flex;flex-wrap:wrap"></div></div><div></div></div><div class="aos_project_screen_container"><div class="aos_project_inner_screen_container"><div class="aos_project_metadata"><div class="aos_project_metadata_title">Whatsapp <!-- -->Web <!-- -->Reveng</div><div class="aos_project_metadata_description">Reverse engineering WhatsApp Web.</div><div class="aos_project_metadata_header">Stars</div><span class="aos_project_metadata_content">4,815</span><div class="project_page_ad_slot_1"><ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-gv-v+1t-u+27" data-ad-client="ca-pub-1878397330895234" data-ad-slot="5649017589"></ins></div><div class="aos_project_metadata_header aos_license_text_metadata">License</div><span class="aos_project_metadata_content">mit</span><div class="aos_project_metadata_header"><a href="https://github.com/sigalor/whatsapp-web-reveng" target="_blank" class="aos_grey_link" rel="nofollow">Repository</a></div><span class="aos_project_metadata_content"><a href="https://github.com/sigalor/whatsapp-web-reveng" target="_blank">https://github.com/sigalor/whatsapp-web-reveng</a></span><div class="aos_project_metadata_header"><a href="https://github.com/sigalor/whatsapp-web-reveng/issues" target="_blank" class="aos_grey_link" rel="nofollow">Open Issues</a></div><span class="aos_project_metadata_content"><a href="https://github.com/sigalor/whatsapp-web-reveng/issues" target="_blank">124</a></span><div class="aos_project_metadata_header">Most Recent Commit</div><span class="aos_project_metadata_content">a month ago</span><div class="aos_project_metadata_header">Related Projects</div><span class="aos_project_metadata_content"><a href="https://awesomeopensource.com/projects/javascript"><div style="display:block;text-decoration:none;padding-bottom:10px">javascript<span> (<!-- -->67,310<!-- -->)</span></div></a><a href="https://awesomeopensource.com/projects/node"><div style="display:block;text-decoration:none;padding-bottom:10px">node<span> (<!-- -->935<!-- -->)</span></div></a><a href="https://awesomeopensource.com/projects/reverse-engineering"><div style="display:block;text-decoration:none;padding-bottom:10px">reverse-engineering<span> (<!-- -->446<!-- -->)</span></div></a><a href="https://awesomeopensource.com/projects/encryption"><div style="display:block;text-decoration:none;padding-bottom:10px">encryption<span> (<!-- -->320<!-- -->)</span></div></a><a href="https://awesomeopensource.com/projects/whatsapp"><div style="display:block;text-decoration:none;padding-bottom:10px">whatsapp<span> (<!-- -->101<!-- -->)</span></div></a><a href="https://awesomeopensource.com/projects/whatsapp-web"><div style="display:block;text-decoration:none;padding-bottom:10px">whatsapp-web<span> (<!-- -->30<!-- -->)</span></div></a></span></div><div class="markdown-body"><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h1>
<a id="whatsapp-web-reverse-engineered" class="anchor" href="#whatsapp-web-reverse-engineered" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WhatsApp Web reverse engineered</h1>
<h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h2>
<p>This project intends to provide a complete description and re-implementation of the WhatsApp Web API, which will eventually lead to a custom client. WhatsApp Web internally works using WebSockets; this project does as well.</p>
<h2>
<a id="trying-it-out" class="anchor" href="#trying-it-out" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Trying it out</h2>
<p>Before you can run the application, make sure that you have the following software installed:</p>
<ul>
<li>Node.js (at least version 8, as the <code>async</code> <code>await</code> syntax is used)</li>
<li>Python 2.7 with the following <code>pip</code> packages installed:
<ul>
<li>
<code>websocket-client</code> and <code>git+https://github.com/dpallot/simple-websocket-server.git</code> for acting as WebSocket server and client.</li>
<li>
<code>curve25519-donna</code> and <code>pycrypto</code> for the encryption stuff.</li>
<li>
<code>pyqrcode</code> for QR code generation.</li>
<li>
<code>protobuf</code> for reading and writing the binary conversation format.</li>
</ul>
</li>
<li>Note: On Windows <code>curve25519-donna</code> requires <a href="http://aka.ms/vcpython27" rel="nofollow">Microsoft Visual C++ 9.0</a> and you need to copy <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/windows" rel="nofollow"><code>stdint.h</code></a> into <code>C:\Users\YOUR USERNAME\AppData\Local\Programs\Common\Microsoft\Visual C++ for Python\9.0\VC\include</code>.</li>
</ul>
<p>Before starting the application for the first time, run <code>npm install -f</code> to install all Node and <code>pip install -r requirements.txt</code> for all Python dependencies.</p>
<p>Lastly, to finally launch it, just run <code>npm start</code> on Linux based OS's and <code>npm run win</code> on Windows. Using fancy <code>concurrently</code> and <code>nodemon</code> magic, all three local components will be started after each other and when you edit a file, the changed module will automatically restart to apply the changes.</p>
<h2>
<a id="reimplementations" class="anchor" href="#reimplementations" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Reimplementations</h2>
<h3>
<a id="javascript" class="anchor" href="#javascript" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JavaScript</h3>
<p>A recent addition is a version of the decryption routine translated to in-browser JavaScript. Run <code>node index_jsdemo.js</code> (just needed because browsers don't allow changing HTTP headers for WebSockets), then open <code>client/login-via-js-demo.html</code> as a normal file in any browser. The console output should show decrypted binary messages after scanning the QR code.</p>
<p><a href="https://github.com/adiwajshing" rel="nofollow">adiwajshing</a> created <a href="https://github.com/adiwajshing/Baileys" rel="nofollow">Baileys</a>, a Node library that implements the WhatsApp Web API.</p>
<p><a href="https://github.com/ndunks" rel="nofollow">ndunks</a> made a TypeScript reimplementation at <a href="https://github.com/ndunks/WaJs" rel="nofollow">WaJs</a>.</p>
<h3>
<a id="rust" class="anchor" href="#rust" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Rust</h3>
<p>With <a href="https://github.com/wiomoc/whatsappweb-rs" rel="nofollow">whatsappweb-rs</a>, <a href="https://github.com/wiomoc" rel="nofollow">wiomoc</a> created a WhatsApp Web client in Rust.</p>
<h3>
<a id="go" class="anchor" href="#go" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Go</h3>
<p><a href="https://github.com/Rhymen" rel="nofollow">Rhymen</a> created <a href="https://github.com/Rhymen/go-whatsapp" rel="nofollow">go-whatsapp</a>, a Go package that implements the WhatsApp Web API.</p>
<h3>
<a id="clojure" class="anchor" href="#clojure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Clojure</h3>
<p><a href="https://github.com/vzaramel" rel="nofollow">vzaramel</a> created <a href="https://github.com/vzaramel/whatsappweb-clj" rel="nofollow">whatsappweb-clj</a>, a Clojure library the implements the WhatsApp Web API.</p>
<h2>
<a id="application-architecture" class="anchor" href="#application-architecture" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Application architecture</h2>
<p>The project is organized in the following way. Note the used ports and make sure that they are not in use elsewhere before starting the application.
<a href="https://raw.githubusercontent.com/sigalor/whatsapp-web-reveng/master/doc/img/app-architecture1000.png" target="_blank" rel="nofollow"><img src="https://raw.githubusercontent.com/sigalor/whatsapp-web-reveng/master/doc/img/app-architecture1000.png" alt="whatsapp-web-reveng Application architecture" style="max-width:100%;"></a></p>
<h2>
<a id="login-and-encryption-details" class="anchor" href="#login-and-encryption-details" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Login and encryption details</h2>
<p>WhatsApp Web encrypts the data using several different algorithms. These include <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" rel="nofollow">AES 256 CBC</a>, <a href="https://en.wikipedia.org/wiki/Curve25519" rel="nofollow">Curve25519</a> as Diffie-Hellman key agreement scheme, <a href="https://en.wikipedia.org/wiki/HKDF" rel="nofollow">HKDF</a> for generating the extended shared secret and <a href="https://en.wikipedia.org/wiki/Hash-based_message_authentication_code" rel="nofollow">HMAC</a> with SHA256.</p>
<p>Starting the WhatsApp Web session happens by just connecting to one of its websocket servers at <code>wss://w[1-8].web.whatsapp.com/ws</code> (<code>wss://</code> means that the websocket connection is secure; <code>w[1-8]</code> means that any number between 1 and 8 can follow the <code>w</code>). Also make sure that, when establishing the connection, the HTTP header <code>Origin: https://web.whatsapp.com</code> is set, otherwise the connection will be rejected.</p>
<h3>
<a id="messages" class="anchor" href="#messages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Messages</h3>
<p>When you send messages to a WhatsApp Web websocket, they need to be in a specific format. It is quite simple and looks like <code>messageTag,JSON</code>, e.g. <code>1515590796,["data",123]</code>. Note that apparently the message tag can be anything. This application mostly uses the current timestamp as tag, just to be a bit unique. WhatsApp itself often uses message tags like <code>s1</code>, <code>1234.--0</code> or something like that. Obviously the message tag may not contain a comma. Additionally, JSON <em>objects</em> are possible as well as payload.</p>
<h3>
<a id="logging-in" class="anchor" href="#logging-in" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logging in</h3>
<p>To log in at an open websocket, follow these steps:</p>
<ol>
<li>Generate your own <code>clientId</code>, which needs to be 16 base64-encoded bytes (i.e. 25 characters). This application just uses 16 random bytes, i.e. <code>base64.b64encode(os.urandom(16))</code> in Python.</li>
<li>Decide for a tag for your message, which is more or less arbitrary (see above). This application uses the current timestamp (in seconds) for that. Remember this tag for later.</li>
<li>The message you send to the websocket looks like this: <code>messageTag,["admin","init",[0,3,2390],["Long browser description","ShortBrowserDesc"],"clientId",true]</code>.
<ul>
<li>Obviously, you need to replace <code>messageTag</code> and <code>clientId</code> by the values you chose before</li>
<li>The <code>[0,3,2390]</code> part specifies the current WhatsApp Web version. The last value changes frequently. It should be quite backwards-compatible though.</li>
<li>
<code>"Long browser description"</code> is an arbitrary string that will be shown in the WhatsApp app in the list of registered WhatsApp Web clients after you scan the QR code.</li>
<li>
<code>"ShortBrowserDesc"</code> has not been observed anywhere yet but is arbitrary as well.</li>
</ul>
</li>
<li>After a few moments, your websocket will receive a message in the specified format with the message tag <em>you chose in step 2</em>. The JSON object of this message has the following attributes:
<ul>
<li>
<code>status</code>: should be 200</li>
<li>
<code>ref</code>: in the application, this is treated as the server ID; important for the QR generation, see below</li>
<li>
<code>ttl</code>: is 20000, maybe the time after the QR code becomes invalid</li>
<li>
<code>update</code>: a boolean flag</li>
<li>
<code>curr</code>: the current WhatsApp Web version, e.g. <code>0.2.7314</code>
</li>
<li>
<code>time</code>: the timestamp the server responded at, as floating-point milliseconds, e.g. <code>1515592039037.0</code>
</li>
</ul>
</li>
</ol>
<h3>
<a id="qr-code-generation" class="anchor" href="#qr-code-generation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>QR code generation</h3>
<ol start="5">
<li>Generate your own private key with Curve25519, e.g. <code>curve25519.Private()</code>.</li>
<li>Get the public key from your private key, e.g. <code>privateKey.get_public()</code>.</li>
<li>Obtain the string later encoded by the QR code by concatenating the following values with a comma:
<ul>
<li>the server ID, i.e. the <code>ref</code> attribute from step 4</li>
<li>the base64-encoded version of your public key, i.e. <code>base64.b64encode(publicKey.serialize())</code>
</li>
<li>your client ID</li>
</ul>
</li>
<li>Turn this string into an image (e.g. using <code>pyqrcode</code>) and scan it using the WhatsApp app.</li>
</ol>
<h3>
<a id="requesting-new-ref-for-qr-code-generation-not-implemented" class="anchor" href="#requesting-new-ref-for-qr-code-generation-not-implemented" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requesting new ref for QR code generation (not implemented)</h3>
<ol start="9">
<li>You can request up to 5 new server refs when previous one expires (<code>ttl</code>).</li>
<li>Do it by sending <code>messageTag,["admin","Conn","reref"]</code>.</li>
<li>The server responds with JSON with the following attributes:
<ul>
<li>
<code>status</code>: should be 200 (other ones: 304 - reuse previous ref, 429 - new ref denied)</li>
<li>
<code>ref</code>: new ref</li>
<li>
<code>ttl</code>: expiration time</li>
</ul>
</li>
<li>Update your QR code with the new ref.</li>
</ol>
<h3>
<a id="after-scanning-the-qr-code" class="anchor" href="#after-scanning-the-qr-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>After scanning the QR code</h3>
<ol start="13">
<li>Immediately after you scan the QR code, the websocket receives several important JSON messages that build up the encryption details. These use the specified message format and have a JSON <em>array</em> as payload. Their message tag has no special meaning. The first entry of the JSON array has one of the following values:
<ul>
<li>
<code>Conn</code>: array contains JSON object as second element with connection information containing the following attributes and many more:
<ul>
<li>
<code>battery</code>: the current battery percentage of your phone</li>
<li>
<code>browserToken</code>: used to logout without active WebSocket connection (not implemented yet)</li>
<li>
<code>clientToken</code>: used to resuming closed sessions aka "Remember me" (not implemented yet)</li>
<li>
<code>phone</code>: an object with detailed information about your phone, e.g. <code>device_manufacturer</code>, <code>device_model</code>, <code>os_build_number</code>, <code>os_version</code>
</li>
<li>
<code>platform</code>: your phone OS, e.g. <code>android</code>
</li>
<li>
<code>pushname</code>: the name of yours you provided WhatsApp</li>
<li>
<code>secret</code> (remember this!)</li>
<li>
<code>serverToken</code>: used to resuming closed sessions aka "Remember me" (not implemented yet)</li>
<li>
<code>wid</code>: your phone number in the chat identification format (see below)</li>
</ul>
</li>
<li>
<code>Stream</code>: array has four elements in total, so the entire payload is like <code>["Stream","update",false,"0.2.7314"]</code>
</li>
<li>
<code>Props</code>: array contains JSON object as second element with several properties like <code>imageMaxKBytes</code> (1024), <code>maxParticipants</code> (257), <code>videoMaxEdge</code> (960) and others</li>
</ul>
</li>
</ol>
<h3>
<a id="key-generation" class="anchor" href="#key-generation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Key generation</h3>
<ol start="14">
<li>You are now ready for generating the final encryption keys. Start by decoding the <code>secret</code> from <code>Conn</code> as base64 and storing it as <code>secret</code>. This decoded secret will be 144 bytes long.</li>
<li>Take the <em>first 32 bytes</em> of the decoded secret and use it as a public key. Together with your private key, generate a shared key out of it and call it <code>sharedSecret</code>. The application does it using <code>privateKey.get_shared_key(curve25519.Public(secret[:32]), lambda a:a)</code>.</li>
<li>Extend <code>sharedSecret</code> to 80 bytes using HKDF. Call this value <code>sharedSecretExpanded</code>.</li>
<li>This step is optional, it validates the data provided by the server. The method is called <em>HMAC validation</em>. Do it by first calculating <code>HmacSha256(sharedSecretExpanded[32:64], secret[:32] + secret[64:])</code>. Compare this value to <code>secret[32:64]</code>. If they are not equal, abort the login.</li>
<li>You now have the encrypted keys: store <code>sharedSecretExpanded[64:] + secret[64:]</code> as <code>keysEncrypted</code>.</li>
<li>The encrypted keys now need to be decrypted using AES with <code>sharedSecretExpanded[:32]</code> as key, i.e. store <code>AESDecrypt(sharedSecretExpanded[:32], keysEncrypted)</code> as <code>keysDecrypted</code>.</li>
<li>The <code>keysDecrypted</code> variable is 64 bytes long and contains two keys, each 32 bytes long. The <code>encKey</code> is used for decrypting binary messages sent to you by the WhatsApp Web server or encrypting binary messages you send to the server. The <code>macKey</code> is needed to validate the messages sent to you:
<ul>
<li>
<code>encKey</code>: <code>keysDecrypted[:32]</code>
</li>
<li>
<code>macKey</code>: <code>keysDecrypted[32:64]</code>
</li>
</ul>
</li>
</ol>
<h3>
<a id="restoring-closed-sessions-not-implemented" class="anchor" href="#restoring-closed-sessions-not-implemented" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Restoring closed sessions (not implemented)</h3>
<ol>
<li>After sending <code>init</code> command, check whether you have <code>serverToken</code> and <code>clientToken</code>.</li>
<li>If so, send <code>messageTag,["admin","login","clientToken","serverToken","clientId","takeover"]</code>
</li>
<li>The server should respond with <code>{"status": 200}</code>. Other statuses:
<ul>
<li>401: Unpaired from the phone</li>
<li>403: Access denied, check <code>tos</code> field in the JSON: if it equals or greater than 2, you have violated TOS</li>
<li>405: Already logged in</li>
<li>409: Logged in from another location</li>
</ul>
</li>
</ol>
<h3>
<a id="resolving-challenge-not-implemented" class="anchor" href="#resolving-challenge-not-implemented" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Resolving challenge (not implemented)</h3>
<ol start="4">
<li>When using old or expired <code>serverToken</code> and <code>clientToken</code>, you will be challenged to confirm that you still have valid encryption keys.</li>
<li>The challenge looks like this <code>messageTag,["Cmd",{"type":"challenge","challenge":"BASE_64_ENCODED_STRING=="}]</code>
</li>
<li>Decode <code>challenge</code> string from Base64, sign it with your macKey, encode it back with Base64 and send <code>messageTag,["admin","challenge","BASE_64_ENCODED_STRING==","serverToken","clientId"]</code>
</li>
<li>The server should respond with <code>{"status": 200}</code>, but it means nothing.</li>
<li>After solving challenge your connection should be restored.</li>
</ol>
<h3>
<a id="logging-out" class="anchor" href="#logging-out" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logging out</h3>
<ol>
<li>When you have an active WebSocket connection, just send <code>goodbye,,["admin","Conn","disconnect"]</code>.</li>
<li>When you don't have such connection (for example your session has been taken over from another location), sign your <code>encKey</code> with your <code>macKey</code> and encode it with Base64. Let's say it is your <code>logoutToken</code>.</li>
<li>Send a POST request to <code>https://dyn.web.whatsapp.com/logout?t=browserToken&amp;m=logoutToken</code>
</li>
<li>Remember to always clear your sessions, so sessions list in your phone will not grow big.</li>
</ol>
<h3>
<a id="validating-and-decrypting-messages" class="anchor" href="#validating-and-decrypting-messages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Validating and decrypting messages</h3>
<p>Now that you have the two keys, validating and decrypting messages the server sent to you is quite easy. Note that this is only needed for <em>binary</em> messages, all JSON you receive stays plain. The binary messages always have 32 bytes at the beginning that specify the HMAC checksum. Both JSON <em>and</em> binary messages have a message tag at their very start that can be discarded, i.e. only the portion after the first comma character is significant.</p>
<ol>
<li>Validate the message by hashing the actual message content with the <code>macKey</code> (here <code>messageContent</code> is the <em>entire</em> binary message): <code>HmacSha256(macKey, messageContent[32:])</code>. If this value is not equal to <code>messageContent[:32]</code>, the message sent to you by the server is invalid and should be discarded.</li>
<li>Decrypt the message content using AES and the <code>encKey</code>: <code>AESDecrypt(encKey, messageContent[32:])</code>.</li>
</ol>
<p>The data you get in the final step has a binary format which is described in the following. Even though it's binary, you can still see several strings in it, especially the content of messages you sent is quite obvious there.</p>
<h2>
<a id="binary-message-format" class="anchor" href="#binary-message-format" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Binary message format</h2>
<h3>
<a id="binary-decoding" class="anchor" href="#binary-decoding" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Binary decoding</h3>
<p>The Python script <code>backend/decoder.py</code> implements the <code>MessageParser</code> class. It is able to create a JSON structure out of binary data in which the data is still organized in a rather messy way. The section about Node Handling below will discuss how the nodes are reorganized afterwards.</p>
<p><code>MessageParser</code> initially just needs some data and then processes it byte by byte, i.e. as a stream. It has a couple of constants and a lot of methods which all build on each other.</p>
<h4>
<a id="constants" class="anchor" href="#constants" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Constants</h4>
<ul>
<li>
<em>Tags</em> with their respective integer values
<ul>
<li>
<em>LIST_EMPTY</em>: 0</li>
<li>
<em>STREAM_8</em>: 2</li>
<li>
<em>DICTIONARY_0</em>: 236</li>
<li>
<em>DICTIONARY_1</em>: 237</li>
<li>
<em>DICTIONARY_2</em>: 238</li>
<li>
<em>DICTIONARY_3</em>: 239</li>
<li>
<em>LIST_8</em>: 248</li>
<li>
<em>LIST_16</em>: 249</li>
<li>
<em>JID_PAIR</em>: 250</li>
<li>
<em>HEX_8</em>: 251</li>
<li>
<em>BINARY_8</em>: 252</li>
<li>
<em>BINARY_20</em>: 253</li>
<li>
<em>BINARY_32</em>: 254</li>
<li>
<em>NIBBLE_8</em>: 255</li>
</ul>
</li>
<li>
<em>Tokens</em> are a long list of 151 strings in which the indices matter:
<ul>
<li><code>[None,None,None,"200","400","404","500","501","502","action","add", "after","archive","author","available","battery","before","body", "broadcast","chat","clear","code","composing","contacts","count", "create","debug","delete","demote","duplicate","encoding","error", "false","filehash","from","g.us","group","groups_v2","height","id", "image","in","index","invis","item","jid","kind","last","leave", "live","log","media","message","mimetype","missing","modify","name", "notification","notify","out","owner","participant","paused", "picture","played","presence","preview","promote","query","raw", "read","receipt","received","recipient","recording","relay", "remove","response","resume","retry","s.whatsapp.net","seconds", "set","size","status","subject","subscribe","t","text","to","true", "type","unarchive","unavailable","url","user","value","web","width", "mute","read_only","admin","creator","short","update","powersave", "checksum","epoch","block","previous","409","replaced","reason", "spam","modify_tag","message_info","delivery","emoji","title", "description","canonical-url","matched-text","star","unstar", "media_key","filename","identity","unread","page","page_count", "search","media_message","security","call_log","profile","ciphertext", "invite","gif","vcard","frequent","privacy","blacklist","whitelist", "verify","location","document","elapsed","revoke_invite","expiration", "unsubscribe","disable"]</code></li>
</ul>
</li>
</ul>
<h4>
<a id="number-reformatting" class="anchor" href="#number-reformatting" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Number reformatting</h4>
<ul>
<li>
<em>Unpacking nibbles</em>: Returns the ASCII representation for numbers between 0 and 9. Returns <code>-</code> for 10, <code>.</code> for 11 and <code>\0</code> for 15.</li>
<li>
<em>Unpacking hex values</em>: Returns the ASCII representation for numbers between 0 and 9 or letters between A and F (i.e. uppercase) for numbers between 10 and 15.</li>
<li>
<em>Unpacking bytes</em>: Expects a tag as an additional parameter, namely <em>NIBBLE_8</em> or <em>HEX_8</em>. Unpacks a nibble or hex value accordingly.</li>
</ul>
<h4>
<a id="number-formats" class="anchor" href="#number-formats" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Number formats</h4>
<ul>
<li>
<em>Byte</em>: A plain ol' byte.</li>
<li>
<em>Integer with N bytes</em>: Reads N bytes and builds a number out of them. Can be little or big endian; if not specified otherwise, big endian is used. Note that no negative values are possible.</li>
<li>
<em>Int16</em>: An integer with two bytes, read using <em>Integer with N bytes</em>.</li>
<li>
<em>Int20</em>: Consumes three bytes and constructs an integer using the last four bits of the first byte and the entire second and third byte. Is therefore always big endian.</li>
<li>
<em>Int32</em>: An integer with four bytes, read using <em>Integer with N bytes</em>.</li>
<li>
<em>Int64</em>: An integer with eight bytes, read using <em>Integer with N bytes</em>.</li>
<li>
<em>Packed8</em>: Expects a tag as an additional parameter, namely <em>NIBBLE_8</em> or <em>HEX_8</em>. Returns a string.
<ul>
<li>First reads a byte <code>n</code> and does the following <code>n&amp;127</code> many times: Reads a byte <code>l</code> and for each nibble, adds the result of its <em>unpacked version</em> to the return value (using <em>unpacking bytes</em> with the given tag). Most significant nibble first.</li>
<li>If the most significant bit of <code>n</code> was set, removes the last character of the return value.</li>
</ul>
</li>
</ul>
<h4>
<a id="helper-methods" class="anchor" href="#helper-methods" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Helper methods</h4>
<ul>
<li>
<em>Read bytes</em>: Reads and returns the specified number of bytes.</li>
<li>
<em>Check for list tag</em>: Expects a tag as parameter and returns true if the tag is <code>LIST_EMPTY</code>, <code>LIST_8</code> or <code>LIST_16</code> (i.e. 0, 248 or 249).</li>
<li>
<em>Read list size</em>: Expects a list tag as parameter. Returns 0 for <code>LIST_EMPTY</code>, returns a read byte for <code>LIST_8</code> or a read <em>Int16</em> for <code>LIST_16</code>.</li>
<li>
<em>Read a string from characters</em>: Expects the string length as parameter, reads this many bytes and returns them as a string.</li>
<li>
<em>Get a token</em>: Expects an index to the array of <em>Tokens</em>, and returns the respective string.</li>
<li>
<em>Get a double token</em>: Expects two integers <code>a</code> and <code>b</code> and gets the token at index <code>a*256+b</code>.</li>
</ul>
<h4>
<a id="strings" class="anchor" href="#strings" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Strings</h4>
<p>Reading a string needs a <em>tag</em> as parameter. Depending on this tag, different data is read.</p>
<ul>
<li>If the tag is between 3 and 235, the <em>token</em> (i.e. a string) of this tag is got. If the token is <code>"s.whatsapp.net"</code>, <code>"c.us"</code> is returned instead, otherwise the token is returned as is.</li>
<li>If the tag is between <em>DICTIONARY_0</em> and <em>DICTIONARY_3</em>, a <em>double token</em> is returned, with <code>tag-DICTIONARY_0</code> as first and a read byte as second parameter.</li>
<li>
<em>LIST_EMPTY</em>: Nothing is returned (e.g. <code>None</code>).</li>
<li>
<em>BINARY_8</em>: A byte is read which is then used to <em>read a string from characters</em> with this length.</li>
<li>
<em>BINARY_20</em>: An <em>Int20</em> is read which is then used to <em>read a string from characters</em> with this length.</li>
<li>
<em>BINARY_32</em>: An <em>Int32</em> is read which is then used to <em>read a string from characters</em> with this length.</li>
<li>
<em>JID_PAIR</em>
<ul>
<li>First, a byte is read which is then used to <em>read a string</em> <code>i</code> with this tag.</li>
<li>Second, another byte is read which is then used to <em>read a string</em> <code>j</code> with this tag.</li>
<li>Finally, <code>i</code> and <code>j</code> are joined together with an <code>@</code> sign and the result is returned.</li>
</ul>
</li>
<li>
<em>NIBBLE_8</em> or <em>HEX_8</em>: A <em>Packed8</em> with this tag is returned.</li>
</ul>
<h4>
<a id="attribute-lists" class="anchor" href="#attribute-lists" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Attribute lists</h4>
<p>Reading an attribute list needs the number of attributes to read as parameter. An attribute list is always a JSON object. For each attribute read, the following steps are executed for getting key-value pairs (exactly in this order!):</p>
<ul>
<li>
<em>Key</em>: A byte is read which is then used to <em>read a string</em> with this tag.</li>
<li>
<em>Value</em>: A byte is read which is then used to <em>read a string</em> with this tag.</li>
</ul>
<h4>
<a id="nodes" class="anchor" href="#nodes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Nodes</h4>
<p>A node always consists of a JSON array with exactly three entries: description, attributes and content. The following steps are needed to read a node:</p>
<ol>
<li>A <em>list size</em> <code>a</code> is read by using a read byte as the tag. The list size 0 is invalid.</li>
<li>The description tag is read as a byte. The value 2 is invalid for this tag. The description string <code>descr</code> is then obtained by <em>reading a string</em> with this tag.</li>
<li>The attributes object <code>attrs</code> is read by <em>reading an attributes object</em> with length <code>(a-2 + a%2) &gt;&gt; 1</code>.</li>
<li>If <code>a</code> was odd, this node does not have any content, i.e. <code>[descr, attrs, None]</code> is returned.</li>
<li>For getting the node's content, first a byte, i.e. a tag is read. Depending on this tag, different types of content emerge:
<ul>
<li>If the tag is a <em>list tag</em>, a <em>list is read</em> using this tag (see below for lists).</li>
<li>
<em>BINARY_8</em>: A byte is read which is then used as length for <em>reading bytes</em>.</li>
<li>
<em>BINARY_20</em>: An <em>Int20</em> is read which is then used as length for <em>reading bytes</em>.</li>
<li>
<em>BINARY_32</em>: An <em>Int32</em> is read which is then used as length for <em>reading bytes</em>.</li>
<li>If the tag is something else, a <em>string is read</em> using this tag.</li>
</ul>
</li>
<li>Eventually, <code>[descr, attrs, content]</code> is returned.</li>
</ol>
<h4>
<a id="lists" class="anchor" href="#lists" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lists</h4>
<p>Reading a list requires a <em>list tag</em> (i.e. <em>LIST_EMPTY</em>, <em>LIST_8</em> or <em>LIST_16</em>). The length of the list is then obtained by <em>reading a list size</em> using this tag. For each list entry, a <em>node is read</em>.</p>
<h3>
<a id="node-handling" class="anchor" href="#node-handling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Node Handling</h3>
<p>After a binary message has been transformed into JSON, it is still rather hard to read. That's why, internally, WhatsApp Web completely retransforms this structure into something that can be easily processed and eventually translated into user interface content. This section will deal with this and awaits completion.</p>
<h2>
<a id="binary-conversation-format" class="anchor" href="#binary-conversation-format" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Binary conversation format</h2>
<p>When a node has been read, the contents of messages that have been actually sent by the user (i.e. text, image, audio, video etc.) are still not directly visible or accessible via the JSON. Instead, they are kept in a protobuf message. See <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/doc/spec/def.proto" rel="nofollow">here</a> for the definitions. The "wrapper" message type is <code>WebMessageInfo</code>.</p>
<h2>
<a id="whatsapp-web-api" class="anchor" href="#whatsapp-web-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WhatsApp Web API</h2>
<p>WhatsApp Web itself has an interesting API as well. You can even try it out directly in your browser. Just log in at the normal <a href="https://web.whatsapp.com/" rel="nofollow">https://web.whatsapp.com/</a>, then open the browser development console. Now enter something like the following (see below for details on the chat identification):</p>
<ul>
<li><code>window.Store.Wap.profilePicFind("<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="75414c444746414043424d4c35165b0006">[email&#160;protected]</a>").then(res =&gt; console.log(res));</code></li>
<li><code>window.Store.Wap.lastseenFind("<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a19598909392959497969998e1c28fd4d2">[email&#160;protected]</a>").then(res =&gt; console.log(res));</code></li>
<li><code>window.Store.Wap.statusFind("<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d1e5e8e0e3e2e5e4e7e6e9e891b2ffa4a2">[email&#160;protected]</a>").then(res =&gt; console.log(res));</code></li>
</ul>
<p>Using the amazing Chrome developer console, you can see that <code>window.Store.Wap</code> contains a lot of other very interesting functions. Many of them return JavaScript promises. When you click on the <em>Network</em> tab and then on <em>WS</em> (maybe you need to reload the site first), you can look at all the communication between WhatsApp Web and its servers.</p>
<h3>
<a id="chat-identification--jid" class="anchor" href="#chat-identification--jid" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Chat identification / JID</h3>
<p>The WhatsApp Web API uses the following formats to identify chats with individual users and groups of multiple users.</p>
<ul>
<li>
<strong>Chats</strong>: <code>[country code][number]@c.us</code>, e.g. <strong><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="41757870737275747776797801226f3432">[email&#160;protected]</a></code></strong> when you are from Germany and your phone number is <code>0123 456789</code>.</li>
<li>
<strong>Groups</strong>: <code>[phone number of group creator]-[timestamp of group creation]@g.us</code>, e.g. <strong><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="02363b333031363734353a3b2f3337323b3b33333b333b42652c7771">[email&#160;protected]</a></code></strong> for the group that <code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="487c71797a7b7c7d7e7f7071082b663d3b">[email&#160;protected]</a></code> created on November 5 2017.</li>
<li>
<strong>Broadcast Channels</strong> <code>[timestamp of broadcast channel creation]@broadcast</code>, e.g. <strong><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="39080c0900000808000800795b4b56585d5a584a4d">[email&#160;protected]</a></code></strong> for an broadcast channel created on November 5 2017.</li>
</ul>
<h3>
<a id="websocket-messages" class="anchor" href="#websocket-messages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WebSocket messages</h3>
<p>There are two types of WebSocket messages that are exchanged between server and client. On the one hand, plain JSON that is rather unambiguous (especially for the API calls above), on the other hand encrypted binary messages.</p>
<p>Unfortunately, these binary ones cannot be looked at using the Chrome developer tools. Additionally, the Python backend, that of course also receives these messages, needs to decrypt them, as they contain encrypted data. The section about encryption details discusses how it can be decrypted.</p>
<h2>
<a id="dealing-with-e2e-media" class="anchor" href="#dealing-with-e2e-media" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dealing with E2E media</h2>
<h3>
<a id="encryption" class="anchor" href="#encryption" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Encryption</h3>
<ol>
<li>Generate your own <code>mediaKey</code>, which needs to be 32 bytes.</li>
<li>Expand it to 112 bytes using HKDF with type-specific application info (see below). Call this value <code>mediaKeyExpanded</code>.</li>
<li>Split <code>mediaKeyExpanded</code> into:
<ul>
<li>
<code>iv</code>: <code>mediaKeyExpanded[:16]</code>
</li>
<li>
<code>cipherKey</code>: <code>mediaKeyExpanded[16:48]</code>
</li>
<li>
<code>macKey</code>: <code>mediaKeyExpanded[48:80]</code>
</li>
<li>
<code>refKey</code>: <code>mediaKeyExpanded[80:]</code> (not used)</li>
</ul>
</li>
<li>Encrypt the file with AES-CBC using <code>cipherKey</code> and <code>iv</code>, pad it and call it <code>enc</code>.</li>
<li>Sign <code>iv + enc</code> with <code>macKey</code> using HMAC SHA-256 and store the first 10 bytes of the hash as <code>mac</code>.</li>
<li>Hash the file with SHA-256 and store it as <code>fileSha256</code>, hash the <code>enc + mac</code> with SHA-256 and store it as <code>fileEncSha256</code>.</li>
<li>Encode the <code>fileEncSha256</code> with base64 and store it as <code>fileEncSha256B64</code>.</li>
<li>This step is required only for streamable media, e.g. video and audio. As CBC mode allows to decrypt a data from random offset (block-size aligned), it is possible to play and seek the media without the need to fully download it. That said, we need to generate a <code>sidecar</code>. Do it by signing every <code>[n*64K, (n+1)*64K+16]</code> chunk with <code>macKey</code>, truncating the result to the first 10 bytes. Then combine everything in one piece.</li>
</ol>
<h3>
<a id="upload" class="anchor" href="#upload" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Upload</h3>
<ol start="8">
<li>Retrieve the upload-url by sending <code>messageTag,["action", "encr_upload", filetype, fileEncSha256B64]</code>
<ul>
<li>
<code>filetype</code> can be one of <code>image</code>, <code>audio</code>, <code>document</code> or <code>video</code>
</li>
</ul>
</li>
<li>Create a multipart-form with the following fields:
<ul>
<li>fieldname: <code>hash</code>: <code>fileEncSha256B64</code>
</li>
<li>fieldname: <code>file</code>, filename: <code>blob</code>: <code>enc+mac</code>
</li>
</ul>
</li>
<li>Do a POST request to the url with query string <code>?f=j</code> and the correct <code>content-type</code> and the multipart-form, WhatsApp will respond with the download url for the file.</li>
<li>All relevant information to send the file are now generated, just build the proto and send it.</li>
</ol>
<h3>
<a id="decryption" class="anchor" href="#decryption" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Decryption</h3>
<ol>
<li>Obtain <code>mediaKey</code> and decode it from Base64 if necessary.</li>
<li>Expand it to 112 bytes using HKDF with type-specific application info (see below). Call this value <code>mediaKeyExpanded</code>.</li>
<li>Split <code>mediaKeyExpanded</code> into:
<ul>
<li>
<code>iv</code>: <code>mediaKeyExpanded[:16]</code>
</li>
<li>
<code>cipherKey</code>: <code>mediaKeyExpanded[16:48]</code>
</li>
<li>
<code>macKey</code>: <code>mediaKeyExpanded[48:80]</code>
</li>
<li>
<code>refKey</code>: <code>mediaKeyExpanded[80:]</code> (not used)</li>
</ul>
</li>
<li>Download media data from the <code>url</code> and split it into:
<ul>
<li>
<code>file</code>: <code>mediaData[:-10]</code>
</li>
<li>
<code>mac</code>: <code>mediaData[-10:]</code>
</li>
</ul>
</li>
<li>Validate media data with HMAC by signing <code>iv + file</code> with <code>macKey</code> using SHA-256. Take in mind that <code>mac</code> is truncated to 10 bytes, so you should compare only the first 10 bytes.</li>
<li>Decrypt <code>file</code> with AES-CBC using <code>cipherKey</code> and <code>iv</code>, and unpad it. Note that this means that your session's keys (i.e. <code>encKey</code> and <code>macKey</code> from the <em>Key generation</em> section) are not necessary to decrypt a media file.</li>
</ol>
<h3>
<a id="application-info-for-hkdf" class="anchor" href="#application-info-for-hkdf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Application info for HKDF</h3>
<p>Depending on the media type, the literal strings in the right column are the values for the <code>appInfo</code> parameter from the <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py#L37" rel="nofollow"><code>HKDF</code> function</a>.</p>
<table>
<thead>
<tr>
<th>Media Type</th>
<th>Application Info</th>
</tr>
</thead>
<tbody>
<tr>
<td>IMAGE</td>
<td><code>WhatsApp Image Keys</code></td>
</tr>
<tr>
<td>VIDEO</td>
<td><code>WhatsApp Video Keys</code></td>
</tr>
<tr>
<td>AUDIO</td>
<td><code>WhatsApp Audio Keys</code></td>
</tr>
<tr>
<td>DOCUMENT</td>
<td><code>WhatsApp Document Keys</code></td>
</tr>
</tbody>
</table>
<h2>
<a id="extending-the-web-apps-capabilities" class="anchor" href="#extending-the-web-apps-capabilities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Extending the web app's capabilities</h2>
<h3>
<a id="adding-own-commands" class="anchor" href="#adding-own-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Adding own commands</h3>
<p>The message forwarding procedures are rather complex, as there are several layers of websockes involved in the process. For adding your own commands, follow these steps.</p>
<ol>
<li>
<p>First, decide on what the final destination of your command shall be. To be consistent with the other, please prefix it with <code>backend_</code> if it's meant to be received by the Python backend or use <code>api_</code> if the command is directed to the NodeJS API.</p>
</li>
<li>
<p>Now, look at <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/client/js/main.js" rel="nofollow"><code>client/js/main.js</code></a>. In <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/client/js/main.js#L214" rel="nofollow">line 214</a>, you can see an instantiation of the <code>BootstrapStep</code> JavaScript class. It needs the following information:</p>
<ul>
<li>
<code>websocket</code>: is probably always the same</li>
<li>
<code>request.type</code>: should generally be <code>call</code>, as this allows a response to be passed back to the command's sender</li>
<li>
<code>request.callArgs</code>: an object which has to contain a <code>command</code> attribute specifying the name of your command and as many additional key-value-pairs as you want. All of these will be passed to the receiver.</li>
<li>
<code>request.successCondition</code>: on receiving a response for a call, this shall be a function returning <code>true</code> when the response is valid/expected. Use the next attribute for specifying code to be executed when the response is valid.</li>
<li>
<code>request.successActor</code>: when the success condition evaluated to <code>true</code>, this success actor function is called</li>
</ul>
<p>When the <code>BootstrapStep</code> object has been constructed, call <code>.run()</code> for running indefinitely or <code>.run(timeout_ms)</code> for failing when no response has been received after a specific timeout. The <code>run</code> function returns a Promise.</p>
</li>
<li>
<p>Next, edit <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/index.js" rel="nofollow"><code>index.js</code></a>. It contains a couple of blocks beginning with <code>clientWebsocket.waitForMessage</code>. You can copy one of these blocks and edit the parameters. The <code>waitForMessage</code> function needs the following attributes:</p>
<ul>
<li>
<code>condition</code>: when a message is received and this condition evaluates to <code>true</code> on it, the message will be processed by the following <code>.then(...)</code> block</li>
<li>
<code>keepWhenHit</code>: it is possible for a message handler to be detached immediately after it receives its first fitting message. Control this here.
The returned promise's <code>then</code> block finally handles a received message. It gets a <code>clientCallRequest</code> you can call <code>.respond({...})</code> on to send a JSON response to the caller. If the NodeJS API is not the message's final destination, you need to instantiate a new <code>BootstrapStep</code> here which will contact to the Python backend and, after it receives its response, will return it to the original caller.</li>
</ul>
</li>
<li>
<p>Thus, when you want a message for the backend, now edit <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp-web-backend.py" rel="nofollow"><code>backend/whatsapp-web-backend.py</code></a>. In the if-else-compound starting in <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp-web-backend.py#L88" rel="nofollow">line 88</a>, add your own branch for the command name you chose. Then, edit <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py" rel="nofollow"><code>backend/whatsapp.py</code></a> and add a function similar to <code>generateQRCode</code> in <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py#L223" rel="nofollow">line 223</a>. Just using something like in <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py#L230" rel="nofollow"><code>getLoginInfo</code></a> may not be enough, as your command may require an asynchronous request to the WhatsApp Web servers. In this case, make sure to add an entry to <code>self.messageQueue</code> with the message tag you chose and send an appropriate message to <code>self.activeWs</code>. The servers will respond to your request with a response containing the same tag, thus this is resolved in <a href="https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py#L134" rel="nofollow">line 134</a>. Make sure to eventually call <code>pend["callback"]["func"]({...})</code> with the JSON object containing your response data to resolve the callback.</p>
</li>
</ol>
<h2>
<a id="docker" class="anchor" href="#docker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Docker</h2>
<p><strong>Please note, this version is not stable enough to be deployabled in production.</strong></p>
<h3>
<a id="build-docker-image" class="anchor" href="#build-docker-image" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Build docker image</h3>
<p><code>docker build . -t whatsapp-web-reveng</code></p>
<h3>
<a id="run-your-image-and-redirect-front--back-ports" class="anchor" href="#run-your-image-and-redirect-front--back-ports" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Run your image and redirect front &amp; back ports</h3>
<p><code>docker run -p 2019:2019 -p 2018:2018 whatsapp-web-reveng</code></p>
<p>Front end (client) at : <a href="http://localhost:2018/" rel="nofollow">http://localhost:2018/</a></p>
<h3>
<a id="for-server-use" class="anchor" href="#for-server-use" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>For server use</h3>
<p>The addresses of the websockets used are "localhost" by default.
If you want to deploy this docker on your own server and share it, modify the backend websocket address on the front end.
<code>client/js/main.js</code></p>
<pre lang="javascript" class="highlight-javascript"><span class="kd">let</span> <span class="nx">backendInfo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">url</span><span class="p">:</span> <span class="s2">"ws://{{your-server-addr}}:2020"</span><span class="p">,</span>
    <span class="na">timeout</span><span class="p">:</span> <span class="mi">10000</span>
<span class="p">};</span>
</pre>
<p>Front end (client) at : : <a href="http://%7B%7Byour-server-addr%7D%7D:2018/" rel="nofollow">http://{{your-server-addr}}:2018/</a></p>
<h2>
<a id="tasks" class="anchor" href="#tasks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tasks</h2>
<h3>
<a id="backend" class="anchor" href="#backend" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Backend</h3>
<ul>
<li>[ ] More and more errors start to occur in the binary message decoding. Update this documentation to resemble the changes, then implement them.</li>
<li>[ ] Allow sending messages as well. Of course JSON is easy, but <em>writing</em> the binary message format needs to start being examined.</li>
</ul>
<h3>
<a id="web-frontend" class="anchor" href="#web-frontend" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Web frontend</h3>
<ul>
<li>[ ] Allow reusing the session after successful login. Probably normal cookies are best for this. See <a href="https://github.com/sigalor/whatsapp-web-reveng/issues/9" rel="nofollow">#9</a> for details.</li>
<li>[ ] An UI that is not that technical, but rather starts to emulate the actual WhatsApp Web UI.</li>
</ul>
<h3>
<a id="general-development" class="anchor" href="#general-development" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>General development</h3>
<ul>
<li>[ ] Allow usage on Windows, i.e. entirely fix <a href="https://github.com/sigalor/whatsapp-web-reveng/issues/16" rel="nofollow">#16</a>.</li>
</ul>
<h3>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Documentation</h3>
<ul>
<li>[ ] The <em>Node Handling</em> section. Could become very long.</li>
<li>[ ] Outsource the different documentation parts into their own files, maybe into the <code>gh-pages</code> branch.</li>
</ul>
<h2>
<a id="legal" class="anchor" href="#legal" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Legal</h2>
<p>This code is in no way affiliated with, authorized, maintained, sponsored or endorsed by WhatsApp or any of its affiliates or subsidiaries. This is an independent and unofficial software. Use at your own risk.</p>
<h2>
<a id="cryptography-notice" class="anchor" href="#cryptography-notice" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cryptography Notice</h2>
<p>This distribution includes cryptographic software. The country in which you currently reside may have restrictions on the import, possession, use, and/or re-export to another country, of encryption software. BEFORE using any encryption software, please check your country's laws, regulations and policies concerning the import, possession, or use, and re-export of encryption software, to see if this is permitted. See <a href="http://www.wassenaar.org/" rel="nofollow">http://www.wassenaar.org/</a> for more information.</p>
<p>The U.S. Government Department of Commerce, Bureau of Industry and Security (BIS), has classified this software as Export Commodity Control Number (ECCN) 5D002.C.1, which includes information security software using or performing cryptographic functions with asymmetric algorithms. The form and manner of this distribution makes it eligible for export under the License Exception ENC Technology Software Unrestricted (TSU) exception (see the BIS Export Administration Regulations, Section 740.13) for both object code and source code.</p>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">(function(){window['__CF$cv$params']={r:'6120b9460d37e738',m:'d479e1265cf77d0456489eebf2c11d8819af6c2c-1610725525-1800-ARofdwyi73OPUcJIBnY7EYJSzQqTjdltwQq4QV0Wu7RIVz37AoblOcWgi3LOmI9bP9Bdc6EL6QkABB1lF6wvmeXZNAkWIlfvizzG7Chj3t0f+ACPFxuR6zjSRzoWMz0z7gY8NJ1h0dfUwfjoVmzU138ow95mNAEH4yz9w8sqo8de',s:[0x7ed9612163,0xef8d3f77ac],}})();</script></body></html>
</div><div><br/><div style="border:1px solid gray;border-radius:5px;background-color:lightgray;padding:2%"><div style="font-size:24px;font-weight:bold;margin-bottom:10px">Get A Weekly Email With Trending Projects For These Topics</div><div style="margin-bottom:10px">No Spam.  Unsubscribe easily at any time.</div><div><div><input type="checkbox" name="topics" value="javascript"/> <!-- -->javascript<!-- --> (<!-- -->67,310<!-- -->)</div><div><input type="checkbox" name="topics" value="node"/> <!-- -->node<!-- --> (<!-- -->935<!-- -->)</div><div><input type="checkbox" name="topics" value="reverse-engineering"/> <!-- -->reverse-engineering<!-- --> (<!-- -->446<!-- -->)</div><div><input type="checkbox" name="topics" value="encryption"/> <!-- -->encryption<!-- --> (<!-- -->320<!-- -->)</div><div><input type="checkbox" name="topics" value="whatsapp"/> <!-- -->whatsapp<!-- --> (<!-- -->101<!-- -->)</div><div><input type="checkbox" name="topics" value="whatsapp-web"/> <!-- -->whatsapp-web<!-- --> (<!-- -->30<!-- -->)</div></div><div><input type="email" style="width:95%;margin-top:10px;margin-bottom:10px;padding:5px;font-size:20px;border-radius:5px" name="email" placeholder="Your email address"/></div><div><input type="submit" style="color:white;background-color:#0366d6;font-size:20px;border:1px solid black;border-radius:5px;padding:5px;cursor:pointer" value="Subscribe"/></div></div></div><h2>Find Open Source By Browsing 7,000 Topics Across 59 Categories</h2><div class="aos_topics_sidebar" style="margin:0;width:100%"><div class="category_topic_filter_container"><input style="width:100%" placeholder="Search, browse and combine topics" value="" class="aos_filter_topics_input"/></div><div style="display:block;box-shadow:1px 1px 5px lightgray"><a data-category-name="Advertising" href="https://awesomeopensource.com/categories/advertising"><div class="aos_category_explorer_category_container" data-category-name="Advertising"><span data-category-name="Advertising">Advertising<span data-category-name="Advertising" class="aos_project_count"> <!-- -->10</span></span></div></a><a data-category-name="All Projects" href="https://awesomeopensource.com/projects"><div class="aos_category_explorer_category_container" data-category-name="All Projects"><span data-category-name="All Projects">All Projects</span></div></a><a data-category-name="Application Programming Interfaces" href="https://awesomeopensource.com/categories/application-programming-interfaces"><div class="aos_category_explorer_category_container" data-category-name="Application Programming Interfaces"><span data-category-name="Application Programming Interfaces">Application Programming Interfaces<span data-category-name="Application Programming Interfaces" class="aos_project_count"> <!-- -->124</span></span></div></a><a data-category-name="Applications" href="https://awesomeopensource.com/categories/applications"><div class="aos_category_explorer_category_container" data-category-name="Applications"><span data-category-name="Applications">Applications<span data-category-name="Applications" class="aos_project_count"> <!-- -->192</span></span></div></a><a data-category-name="Artificial Intelligence" href="https://awesomeopensource.com/categories/artificial-intelligence"><div class="aos_category_explorer_category_container" data-category-name="Artificial Intelligence"><span data-category-name="Artificial Intelligence">Artificial Intelligence<span data-category-name="Artificial Intelligence" class="aos_project_count"> <!-- -->78</span></span></div></a><a data-category-name="Blockchain" href="https://awesomeopensource.com/categories/blockchain"><div class="aos_category_explorer_category_container" data-category-name="Blockchain"><span data-category-name="Blockchain">Blockchain<span data-category-name="Blockchain" class="aos_project_count"> <!-- -->73</span></span></div></a><a data-category-name="Build Tools" href="https://awesomeopensource.com/categories/build-tools"><div class="aos_category_explorer_category_container" data-category-name="Build Tools"><span data-category-name="Build Tools">Build Tools<span data-category-name="Build Tools" class="aos_project_count"> <!-- -->113</span></span></div></a><a data-category-name="Cloud Computing" href="https://awesomeopensource.com/categories/cloud-computing"><div class="aos_category_explorer_category_container" data-category-name="Cloud Computing"><span data-category-name="Cloud Computing">Cloud Computing<span data-category-name="Cloud Computing" class="aos_project_count"> <!-- -->80</span></span></div></a><a data-category-name="Code Quality" href="https://awesomeopensource.com/categories/code-quality"><div class="aos_category_explorer_category_container" data-category-name="Code Quality"><span data-category-name="Code Quality">Code Quality<span data-category-name="Code Quality" class="aos_project_count"> <!-- -->28</span></span></div></a><a data-category-name="Collaboration" href="https://awesomeopensource.com/categories/collaboration"><div class="aos_category_explorer_category_container" data-category-name="Collaboration"><span data-category-name="Collaboration">Collaboration<span data-category-name="Collaboration" class="aos_project_count"> <!-- -->32</span></span></div></a><a data-category-name="Command Line Interface" href="https://awesomeopensource.com/categories/command-line-interface"><div class="aos_category_explorer_category_container" data-category-name="Command Line Interface"><span data-category-name="Command Line Interface">Command Line Interface<span data-category-name="Command Line Interface" class="aos_project_count"> <!-- -->49</span></span></div></a><a data-category-name="Community" href="https://awesomeopensource.com/categories/community"><div class="aos_category_explorer_category_container" data-category-name="Community"><span data-category-name="Community">Community<span data-category-name="Community" class="aos_project_count"> <!-- -->83</span></span></div></a><a data-category-name="Companies" href="https://awesomeopensource.com/categories/companies"><div class="aos_category_explorer_category_container" data-category-name="Companies"><span data-category-name="Companies">Companies<span data-category-name="Companies" class="aos_project_count"> <!-- -->60</span></span></div></a><a data-category-name="Compilers" href="https://awesomeopensource.com/categories/compilers"><div class="aos_category_explorer_category_container" data-category-name="Compilers"><span data-category-name="Compilers">Compilers<span data-category-name="Compilers" class="aos_project_count"> <!-- -->63</span></span></div></a><a data-category-name="Computer Science" href="https://awesomeopensource.com/categories/computer-science"><div class="aos_category_explorer_category_container" data-category-name="Computer Science"><span data-category-name="Computer Science">Computer Science<span data-category-name="Computer Science" class="aos_project_count"> <!-- -->80</span></span></div></a><a data-category-name="Configuration Management" href="https://awesomeopensource.com/categories/configuration-management"><div class="aos_category_explorer_category_container" data-category-name="Configuration Management"><span data-category-name="Configuration Management">Configuration Management<span data-category-name="Configuration Management" class="aos_project_count"> <!-- -->42</span></span></div></a><a data-category-name="Content Management" href="https://awesomeopensource.com/categories/content-management"><div class="aos_category_explorer_category_container" data-category-name="Content Management"><span data-category-name="Content Management">Content Management<span data-category-name="Content Management" class="aos_project_count"> <!-- -->175</span></span></div></a><a data-category-name="Control Flow" href="https://awesomeopensource.com/categories/control-flow"><div class="aos_category_explorer_category_container" data-category-name="Control Flow"><span data-category-name="Control Flow">Control Flow<span data-category-name="Control Flow" class="aos_project_count"> <!-- -->213</span></span></div></a><a data-category-name="Data Formats" href="https://awesomeopensource.com/categories/data-formats"><div class="aos_category_explorer_category_container" data-category-name="Data Formats"><span data-category-name="Data Formats">Data Formats<span data-category-name="Data Formats" class="aos_project_count"> <!-- -->78</span></span></div></a><a data-category-name="Data Processing" href="https://awesomeopensource.com/categories/data-processing"><div class="aos_category_explorer_category_container" data-category-name="Data Processing"><span data-category-name="Data Processing">Data Processing<span data-category-name="Data Processing" class="aos_project_count"> <!-- -->276</span></span></div></a><a data-category-name="Data Storage" href="https://awesomeopensource.com/categories/data-storage"><div class="aos_category_explorer_category_container" data-category-name="Data Storage"><span data-category-name="Data Storage">Data Storage<span data-category-name="Data Storage" class="aos_project_count"> <!-- -->135</span></span></div></a><a data-category-name="Economics" href="https://awesomeopensource.com/categories/economics"><div class="aos_category_explorer_category_container" data-category-name="Economics"><span data-category-name="Economics">Economics<span data-category-name="Economics" class="aos_project_count"> <!-- -->64</span></span></div></a><a data-category-name="Frameworks" href="https://awesomeopensource.com/categories/frameworks"><div class="aos_category_explorer_category_container" data-category-name="Frameworks"><span data-category-name="Frameworks">Frameworks<span data-category-name="Frameworks" class="aos_project_count"> <!-- -->215</span></span></div></a><a data-category-name="Games" href="https://awesomeopensource.com/categories/games"><div class="aos_category_explorer_category_container" data-category-name="Games"><span data-category-name="Games">Games<span data-category-name="Games" class="aos_project_count"> <!-- -->129</span></span></div></a><a data-category-name="Graphics" href="https://awesomeopensource.com/categories/graphics"><div class="aos_category_explorer_category_container" data-category-name="Graphics"><span data-category-name="Graphics">Graphics<span data-category-name="Graphics" class="aos_project_count"> <!-- -->110</span></span></div></a><a data-category-name="Hardware" href="https://awesomeopensource.com/categories/hardware"><div class="aos_category_explorer_category_container" data-category-name="Hardware"><span data-category-name="Hardware">Hardware<span data-category-name="Hardware" class="aos_project_count"> <!-- -->152</span></span></div></a><a data-category-name="Integrated Development Environments" href="https://awesomeopensource.com/categories/integrated-development-environments"><div class="aos_category_explorer_category_container" data-category-name="Integrated Development Environments"><span data-category-name="Integrated Development Environments">Integrated Development Environments<span data-category-name="Integrated Development Environments" class="aos_project_count"> <!-- -->49</span></span></div></a><a data-category-name="Learning Resources" href="https://awesomeopensource.com/categories/learning-resources"><div class="aos_category_explorer_category_container" data-category-name="Learning Resources"><span data-category-name="Learning Resources">Learning Resources<span data-category-name="Learning Resources" class="aos_project_count"> <!-- -->166</span></span></div></a><a data-category-name="Legal" href="https://awesomeopensource.com/categories/legal"><div class="aos_category_explorer_category_container" data-category-name="Legal"><span data-category-name="Legal">Legal<span data-category-name="Legal" class="aos_project_count"> <!-- -->29</span></span></div></a><a data-category-name="Libraries" href="https://awesomeopensource.com/categories/libraries"><div class="aos_category_explorer_category_container" data-category-name="Libraries"><span data-category-name="Libraries">Libraries<span data-category-name="Libraries" class="aos_project_count"> <!-- -->129</span></span></div></a><a data-category-name="Lists Of Projects" href="https://awesomeopensource.com/categories/lists-of-projects"><div class="aos_category_explorer_category_container" data-category-name="Lists Of Projects"><span data-category-name="Lists Of Projects">Lists Of Projects<span data-category-name="Lists Of Projects" class="aos_project_count"> <!-- -->22</span></span></div></a><a data-category-name="Machine Learning" href="https://awesomeopensource.com/categories/machine-learning"><div class="aos_category_explorer_category_container" data-category-name="Machine Learning"><span data-category-name="Machine Learning">Machine Learning<span data-category-name="Machine Learning" class="aos_project_count"> <!-- -->347</span></span></div></a><a data-category-name="Mapping" href="https://awesomeopensource.com/categories/mapping"><div class="aos_category_explorer_category_container" data-category-name="Mapping"><span data-category-name="Mapping">Mapping<span data-category-name="Mapping" class="aos_project_count"> <!-- -->64</span></span></div></a><a data-category-name="Marketing" href="https://awesomeopensource.com/categories/marketing"><div class="aos_category_explorer_category_container" data-category-name="Marketing"><span data-category-name="Marketing">Marketing<span data-category-name="Marketing" class="aos_project_count"> <!-- -->15</span></span></div></a><a data-category-name="Mathematics" href="https://awesomeopensource.com/categories/mathematics"><div class="aos_category_explorer_category_container" data-category-name="Mathematics"><span data-category-name="Mathematics">Mathematics<span data-category-name="Mathematics" class="aos_project_count"> <!-- -->55</span></span></div></a><a data-category-name="Media" href="https://awesomeopensource.com/categories/media"><div class="aos_category_explorer_category_container" data-category-name="Media"><span data-category-name="Media">Media<span data-category-name="Media" class="aos_project_count"> <!-- -->239</span></span></div></a><a data-category-name="Messaging" href="https://awesomeopensource.com/categories/messaging"><div class="aos_category_explorer_category_container" data-category-name="Messaging"><span data-category-name="Messaging">Messaging<span data-category-name="Messaging" class="aos_project_count"> <!-- -->98</span></span></div></a><a data-category-name="Networking" href="https://awesomeopensource.com/categories/networking"><div class="aos_category_explorer_category_container" data-category-name="Networking"><span data-category-name="Networking">Networking<span data-category-name="Networking" class="aos_project_count"> <!-- -->315</span></span></div></a><a data-category-name="Operating Systems" href="https://awesomeopensource.com/categories/operating-systems"><div class="aos_category_explorer_category_container" data-category-name="Operating Systems"><span data-category-name="Operating Systems">Operating Systems<span data-category-name="Operating Systems" class="aos_project_count"> <!-- -->89</span></span></div></a><a data-category-name="Operations" href="https://awesomeopensource.com/categories/operations"><div class="aos_category_explorer_category_container" data-category-name="Operations"><span data-category-name="Operations">Operations<span data-category-name="Operations" class="aos_project_count"> <!-- -->121</span></span></div></a><a data-category-name="Package Managers" href="https://awesomeopensource.com/categories/package-managers"><div class="aos_category_explorer_category_container" data-category-name="Package Managers"><span data-category-name="Package Managers">Package Managers<span data-category-name="Package Managers" class="aos_project_count"> <!-- -->55</span></span></div></a><a data-category-name="Programming Languages" href="https://awesomeopensource.com/categories/programming-languages"><div class="aos_category_explorer_category_container" data-category-name="Programming Languages"><span data-category-name="Programming Languages">Programming Languages<span data-category-name="Programming Languages" class="aos_project_count"> <!-- -->245</span></span></div></a><a data-category-name="Runtime Environments" href="https://awesomeopensource.com/categories/runtime-environments"><div class="aos_category_explorer_category_container" data-category-name="Runtime Environments"><span data-category-name="Runtime Environments">Runtime Environments<span data-category-name="Runtime Environments" class="aos_project_count"> <!-- -->100</span></span></div></a><a data-category-name="Science" href="https://awesomeopensource.com/categories/science"><div class="aos_category_explorer_category_container" data-category-name="Science"><span data-category-name="Science">Science<span data-category-name="Science" class="aos_project_count"> <!-- -->42</span></span></div></a><a data-category-name="Security" href="https://awesomeopensource.com/categories/security"><div class="aos_category_explorer_category_container" data-category-name="Security"><span data-category-name="Security">Security<span data-category-name="Security" class="aos_project_count"> <!-- -->396</span></span></div></a><a data-category-name="Social Media" href="https://awesomeopensource.com/categories/social-media"><div class="aos_category_explorer_category_container" data-category-name="Social Media"><span data-category-name="Social Media">Social Media<span data-category-name="Social Media" class="aos_project_count"> <!-- -->27</span></span></div></a><a data-category-name="Software Architecture" href="https://awesomeopensource.com/categories/software-architecture"><div class="aos_category_explorer_category_container" data-category-name="Software Architecture"><span data-category-name="Software Architecture">Software Architecture<span data-category-name="Software Architecture" class="aos_project_count"> <!-- -->72</span></span></div></a><a data-category-name="Software Development" href="https://awesomeopensource.com/categories/software-development"><div class="aos_category_explorer_category_container" data-category-name="Software Development"><span data-category-name="Software Development">Software Development<span data-category-name="Software Development" class="aos_project_count"> <!-- -->72</span></span></div></a><a data-category-name="Software Performance" href="https://awesomeopensource.com/categories/software-performance"><div class="aos_category_explorer_category_container" data-category-name="Software Performance"><span data-category-name="Software Performance">Software Performance<span data-category-name="Software Performance" class="aos_project_count"> <!-- -->58</span></span></div></a><a data-category-name="Software Quality" href="https://awesomeopensource.com/categories/software-quality"><div class="aos_category_explorer_category_container" data-category-name="Software Quality"><span data-category-name="Software Quality">Software Quality<span data-category-name="Software Quality" class="aos_project_count"> <!-- -->133</span></span></div></a><a data-category-name="Text Editors" href="https://awesomeopensource.com/categories/text-editors"><div class="aos_category_explorer_category_container" data-category-name="Text Editors"><span data-category-name="Text Editors">Text Editors<span data-category-name="Text Editors" class="aos_project_count"> <!-- -->49</span></span></div></a><a data-category-name="Text Processing" href="https://awesomeopensource.com/categories/text-processing"><div class="aos_category_explorer_category_container" data-category-name="Text Processing"><span data-category-name="Text Processing">Text Processing<span data-category-name="Text Processing" class="aos_project_count"> <!-- -->136</span></span></div></a><a data-category-name="User Interface" href="https://awesomeopensource.com/categories/user-interface"><div class="aos_category_explorer_category_container" data-category-name="User Interface"><span data-category-name="User Interface">User Interface<span data-category-name="User Interface" class="aos_project_count"> <!-- -->330</span></span></div></a><a data-category-name="User Interface Components" href="https://awesomeopensource.com/categories/user-interface-components"><div class="aos_category_explorer_category_container" data-category-name="User Interface Components"><span data-category-name="User Interface Components">User Interface Components<span data-category-name="User Interface Components" class="aos_project_count"> <!-- -->514</span></span></div></a><a data-category-name="Version Control" href="https://awesomeopensource.com/categories/version-control"><div class="aos_category_explorer_category_container" data-category-name="Version Control"><span data-category-name="Version Control">Version Control<span data-category-name="Version Control" class="aos_project_count"> <!-- -->30</span></span></div></a><a data-category-name="Virtualization" href="https://awesomeopensource.com/categories/virtualization"><div class="aos_category_explorer_category_container" data-category-name="Virtualization"><span data-category-name="Virtualization">Virtualization<span data-category-name="Virtualization" class="aos_project_count"> <!-- -->71</span></span></div></a><a data-category-name="Web Browsers" href="https://awesomeopensource.com/categories/web-browsers"><div class="aos_category_explorer_category_container" data-category-name="Web Browsers"><span data-category-name="Web Browsers">Web Browsers<span data-category-name="Web Browsers" class="aos_project_count"> <!-- -->42</span></span></div></a><a data-category-name="Web Servers" href="https://awesomeopensource.com/categories/web-servers"><div class="aos_category_explorer_category_container" data-category-name="Web Servers"><span data-category-name="Web Servers">Web Servers<span data-category-name="Web Servers" class="aos_project_count"> <!-- -->26</span></span></div></a><a data-category-name="Web User Interface" href="https://awesomeopensource.com/categories/web-user-interface"><div class="aos_category_explorer_category_container" data-category-name="Web User Interface"><span data-category-name="Web User Interface">Web User Interface<span data-category-name="Web User Interface" class="aos_project_count"> <!-- -->210</span></span></div></a></div></div><div class="aos_project_metadata_trademark_notice">&quot;<!-- -->Whatsapp <!-- -->Web <!-- -->Reveng<!-- -->&quot; and other potentially trademarked words, copyrighted images and copyrighted readme contents likely belong to the legal entity who owns the &quot;<a href="https://github.com/sigalor" target="_blank">Sigalor</a>&quot; organization.  Awesome Open Source is not affiliated with the legal entity who owns the &quot;<a href="https://github.com/sigalor" target="_blank">Sigalor</a>&quot; organization.</div></div></div><div class="aos_fixed_footer_container"><br/></div></div></div>
      <script type="application/json" class="js-react-on-rails-component" data-component-name="Root" data-dom-id="Root-react-component-b60edf15-d40a-4285-af67-b242c3142445">{"topics":[{"id":null,"name":"javascript","count":67310},{"id":null,"name":"python","count":49729},{"id":null,"name":"java","count":30048},{"id":null,"name":"c-plus-plus","count":17339},{"id":null,"name":"php","count":15812},{"id":null,"name":"c","count":14340},{"id":null,"name":"go","count":14132},{"id":null,"name":"ruby","count":12268},{"id":null,"name":"c-sharp","count":11505},{"id":null,"name":"objective-c","count":10769}],"projectTopics":[{"id":null,"name":"encryption","count":320},{"id":null,"name":"javascript","count":67310},{"id":null,"name":"node","count":935},{"id":null,"name":"reverse-engineering","count":446},{"id":null,"name":"whatsapp","count":101},{"id":null,"name":"whatsapp-web","count":30}],"selectedTopics":[],"currentUrl":"https://awesomeopensource.com/project/sigalor/whatsapp-web-reveng","projects":[],"project":{"id":117979,"created_at":"2018-08-21T02:18:01.953Z","updated_at":"2021-01-14T07:15:08.535Z","markdown_readme":"\u003c!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\" \"http://www.w3.org/TR/REC-html40/loose.dtd\"\u003e\n\u003chtml\u003e\u003cbody\u003e\n\u003ch1\u003e\n\u003ca id=\"whatsapp-web-reverse-engineered\" class=\"anchor\" href=\"#whatsapp-web-reverse-engineered\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eWhatsApp Web reverse engineered\u003c/h1\u003e\n\u003ch2\u003e\n\u003ca id=\"introduction\" class=\"anchor\" href=\"#introduction\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eThis project intends to provide a complete description and re-implementation of the WhatsApp Web API, which will eventually lead to a custom client. WhatsApp Web internally works using WebSockets; this project does as well.\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"trying-it-out\" class=\"anchor\" href=\"#trying-it-out\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTrying it out\u003c/h2\u003e\n\u003cp\u003eBefore you can run the application, make sure that you have the following software installed:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNode.js (at least version 8, as the \u003ccode\u003easync\u003c/code\u003e \u003ccode\u003eawait\u003c/code\u003e syntax is used)\u003c/li\u003e\n\u003cli\u003ePython 2.7 with the following \u003ccode\u003epip\u003c/code\u003e packages installed:\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ewebsocket-client\u003c/code\u003e and \u003ccode\u003egit+https://github.com/dpallot/simple-websocket-server.git\u003c/code\u003e for acting as WebSocket server and client.\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ecurve25519-donna\u003c/code\u003e and \u003ccode\u003epycrypto\u003c/code\u003e for the encryption stuff.\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003epyqrcode\u003c/code\u003e for QR code generation.\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eprotobuf\u003c/code\u003e for reading and writing the binary conversation format.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eNote: On Windows \u003ccode\u003ecurve25519-donna\u003c/code\u003e requires \u003ca href=\"http://aka.ms/vcpython27\" rel=\"nofollow\"\u003eMicrosoft Visual C++ 9.0\u003c/a\u003e and you need to copy \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/windows\" rel=\"nofollow\"\u003e\u003ccode\u003estdint.h\u003c/code\u003e\u003c/a\u003e into \u003ccode\u003eC:\\Users\\YOUR USERNAME\\AppData\\Local\\Programs\\Common\\Microsoft\\Visual C++ for Python\\9.0\\VC\\include\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eBefore starting the application for the first time, run \u003ccode\u003enpm install -f\u003c/code\u003e to install all Node and \u003ccode\u003epip install -r requirements.txt\u003c/code\u003e for all Python dependencies.\u003c/p\u003e\n\u003cp\u003eLastly, to finally launch it, just run \u003ccode\u003enpm start\u003c/code\u003e on Linux based OS's and \u003ccode\u003enpm run win\u003c/code\u003e on Windows. Using fancy \u003ccode\u003econcurrently\u003c/code\u003e and \u003ccode\u003enodemon\u003c/code\u003e magic, all three local components will be started after each other and when you edit a file, the changed module will automatically restart to apply the changes.\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"reimplementations\" class=\"anchor\" href=\"#reimplementations\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eReimplementations\u003c/h2\u003e\n\u003ch3\u003e\n\u003ca id=\"javascript\" class=\"anchor\" href=\"#javascript\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eJavaScript\u003c/h3\u003e\n\u003cp\u003eA recent addition is a version of the decryption routine translated to in-browser JavaScript. Run \u003ccode\u003enode index_jsdemo.js\u003c/code\u003e (just needed because browsers don't allow changing HTTP headers for WebSockets), then open \u003ccode\u003eclient/login-via-js-demo.html\u003c/code\u003e as a normal file in any browser. The console output should show decrypted binary messages after scanning the QR code.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/adiwajshing\" rel=\"nofollow\"\u003eadiwajshing\u003c/a\u003e created \u003ca href=\"https://github.com/adiwajshing/Baileys\" rel=\"nofollow\"\u003eBaileys\u003c/a\u003e, a Node library that implements the WhatsApp Web API.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/ndunks\" rel=\"nofollow\"\u003endunks\u003c/a\u003e made a TypeScript reimplementation at \u003ca href=\"https://github.com/ndunks/WaJs\" rel=\"nofollow\"\u003eWaJs\u003c/a\u003e.\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"rust\" class=\"anchor\" href=\"#rust\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eRust\u003c/h3\u003e\n\u003cp\u003eWith \u003ca href=\"https://github.com/wiomoc/whatsappweb-rs\" rel=\"nofollow\"\u003ewhatsappweb-rs\u003c/a\u003e, \u003ca href=\"https://github.com/wiomoc\" rel=\"nofollow\"\u003ewiomoc\u003c/a\u003e created a WhatsApp Web client in Rust.\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"go\" class=\"anchor\" href=\"#go\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eGo\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/Rhymen\" rel=\"nofollow\"\u003eRhymen\u003c/a\u003e created \u003ca href=\"https://github.com/Rhymen/go-whatsapp\" rel=\"nofollow\"\u003ego-whatsapp\u003c/a\u003e, a Go package that implements the WhatsApp Web API.\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"clojure\" class=\"anchor\" href=\"#clojure\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eClojure\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/vzaramel\" rel=\"nofollow\"\u003evzaramel\u003c/a\u003e created \u003ca href=\"https://github.com/vzaramel/whatsappweb-clj\" rel=\"nofollow\"\u003ewhatsappweb-clj\u003c/a\u003e, a Clojure library the implements the WhatsApp Web API.\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"application-architecture\" class=\"anchor\" href=\"#application-architecture\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eApplication architecture\u003c/h2\u003e\n\u003cp\u003eThe project is organized in the following way. Note the used ports and make sure that they are not in use elsewhere before starting the application.\n\u003ca href=\"https://raw.githubusercontent.com/sigalor/whatsapp-web-reveng/master/doc/img/app-architecture1000.png\" target=\"_blank\" rel=\"nofollow\"\u003e\u003cimg src=\"https://raw.githubusercontent.com/sigalor/whatsapp-web-reveng/master/doc/img/app-architecture1000.png\" alt=\"whatsapp-web-reveng Application architecture\" style=\"max-width:100%;\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"login-and-encryption-details\" class=\"anchor\" href=\"#login-and-encryption-details\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eLogin and encryption details\u003c/h2\u003e\n\u003cp\u003eWhatsApp Web encrypts the data using several different algorithms. These include \u003ca href=\"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard\" rel=\"nofollow\"\u003eAES 256 CBC\u003c/a\u003e, \u003ca href=\"https://en.wikipedia.org/wiki/Curve25519\" rel=\"nofollow\"\u003eCurve25519\u003c/a\u003e as Diffie-Hellman key agreement scheme, \u003ca href=\"https://en.wikipedia.org/wiki/HKDF\" rel=\"nofollow\"\u003eHKDF\u003c/a\u003e for generating the extended shared secret and \u003ca href=\"https://en.wikipedia.org/wiki/Hash-based_message_authentication_code\" rel=\"nofollow\"\u003eHMAC\u003c/a\u003e with SHA256.\u003c/p\u003e\n\u003cp\u003eStarting the WhatsApp Web session happens by just connecting to one of its websocket servers at \u003ccode\u003ewss://w[1-8].web.whatsapp.com/ws\u003c/code\u003e (\u003ccode\u003ewss://\u003c/code\u003e means that the websocket connection is secure; \u003ccode\u003ew[1-8]\u003c/code\u003e means that any number between 1 and 8 can follow the \u003ccode\u003ew\u003c/code\u003e). Also make sure that, when establishing the connection, the HTTP header \u003ccode\u003eOrigin: https://web.whatsapp.com\u003c/code\u003e is set, otherwise the connection will be rejected.\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"messages\" class=\"anchor\" href=\"#messages\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eMessages\u003c/h3\u003e\n\u003cp\u003eWhen you send messages to a WhatsApp Web websocket, they need to be in a specific format. It is quite simple and looks like \u003ccode\u003emessageTag,JSON\u003c/code\u003e, e.g. \u003ccode\u003e1515590796,[\"data\",123]\u003c/code\u003e. Note that apparently the message tag can be anything. This application mostly uses the current timestamp as tag, just to be a bit unique. WhatsApp itself often uses message tags like \u003ccode\u003es1\u003c/code\u003e, \u003ccode\u003e1234.--0\u003c/code\u003e or something like that. Obviously the message tag may not contain a comma. Additionally, JSON \u003cem\u003eobjects\u003c/em\u003e are possible as well as payload.\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"logging-in\" class=\"anchor\" href=\"#logging-in\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eLogging in\u003c/h3\u003e\n\u003cp\u003eTo log in at an open websocket, follow these steps:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGenerate your own \u003ccode\u003eclientId\u003c/code\u003e, which needs to be 16 base64-encoded bytes (i.e. 25 characters). This application just uses 16 random bytes, i.e. \u003ccode\u003ebase64.b64encode(os.urandom(16))\u003c/code\u003e in Python.\u003c/li\u003e\n\u003cli\u003eDecide for a tag for your message, which is more or less arbitrary (see above). This application uses the current timestamp (in seconds) for that. Remember this tag for later.\u003c/li\u003e\n\u003cli\u003eThe message you send to the websocket looks like this: \u003ccode\u003emessageTag,[\"admin\",\"init\",[0,3,2390],[\"Long browser description\",\"ShortBrowserDesc\"],\"clientId\",true]\u003c/code\u003e.\n\u003cul\u003e\n\u003cli\u003eObviously, you need to replace \u003ccode\u003emessageTag\u003c/code\u003e and \u003ccode\u003eclientId\u003c/code\u003e by the values you chose before\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003e[0,3,2390]\u003c/code\u003e part specifies the current WhatsApp Web version. The last value changes frequently. It should be quite backwards-compatible though.\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e\"Long browser description\"\u003c/code\u003e is an arbitrary string that will be shown in the WhatsApp app in the list of registered WhatsApp Web clients after you scan the QR code.\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003e\"ShortBrowserDesc\"\u003c/code\u003e has not been observed anywhere yet but is arbitrary as well.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAfter a few moments, your websocket will receive a message in the specified format with the message tag \u003cem\u003eyou chose in step 2\u003c/em\u003e. The JSON object of this message has the following attributes:\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003estatus\u003c/code\u003e: should be 200\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eref\u003c/code\u003e: in the application, this is treated as the server ID; important for the QR generation, see below\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ettl\u003c/code\u003e: is 20000, maybe the time after the QR code becomes invalid\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eupdate\u003c/code\u003e: a boolean flag\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ecurr\u003c/code\u003e: the current WhatsApp Web version, e.g. \u003ccode\u003e0.2.7314\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003etime\u003c/code\u003e: the timestamp the server responded at, as floating-point milliseconds, e.g. \u003ccode\u003e1515592039037.0\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"qr-code-generation\" class=\"anchor\" href=\"#qr-code-generation\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eQR code generation\u003c/h3\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003eGenerate your own private key with Curve25519, e.g. \u003ccode\u003ecurve25519.Private()\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eGet the public key from your private key, e.g. \u003ccode\u003eprivateKey.get_public()\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eObtain the string later encoded by the QR code by concatenating the following values with a comma:\n\u003cul\u003e\n\u003cli\u003ethe server ID, i.e. the \u003ccode\u003eref\u003c/code\u003e attribute from step 4\u003c/li\u003e\n\u003cli\u003ethe base64-encoded version of your public key, i.e. \u003ccode\u003ebase64.b64encode(publicKey.serialize())\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eyour client ID\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eTurn this string into an image (e.g. using \u003ccode\u003epyqrcode\u003c/code\u003e) and scan it using the WhatsApp app.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"requesting-new-ref-for-qr-code-generation-not-implemented\" class=\"anchor\" href=\"#requesting-new-ref-for-qr-code-generation-not-implemented\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eRequesting new ref for QR code generation (not implemented)\u003c/h3\u003e\n\u003col start=\"9\"\u003e\n\u003cli\u003eYou can request up to 5 new server refs when previous one expires (\u003ccode\u003ettl\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003eDo it by sending \u003ccode\u003emessageTag,[\"admin\",\"Conn\",\"reref\"]\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe server responds with JSON with the following attributes:\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003estatus\u003c/code\u003e: should be 200 (other ones: 304 - reuse previous ref, 429 - new ref denied)\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eref\u003c/code\u003e: new ref\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ettl\u003c/code\u003e: expiration time\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUpdate your QR code with the new ref.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"after-scanning-the-qr-code\" class=\"anchor\" href=\"#after-scanning-the-qr-code\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAfter scanning the QR code\u003c/h3\u003e\n\u003col start=\"13\"\u003e\n\u003cli\u003eImmediately after you scan the QR code, the websocket receives several important JSON messages that build up the encryption details. These use the specified message format and have a JSON \u003cem\u003earray\u003c/em\u003e as payload. Their message tag has no special meaning. The first entry of the JSON array has one of the following values:\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eConn\u003c/code\u003e: array contains JSON object as second element with connection information containing the following attributes and many more:\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ebattery\u003c/code\u003e: the current battery percentage of your phone\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ebrowserToken\u003c/code\u003e: used to logout without active WebSocket connection (not implemented yet)\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eclientToken\u003c/code\u003e: used to resuming closed sessions aka \"Remember me\" (not implemented yet)\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ephone\u003c/code\u003e: an object with detailed information about your phone, e.g. \u003ccode\u003edevice_manufacturer\u003c/code\u003e, \u003ccode\u003edevice_model\u003c/code\u003e, \u003ccode\u003eos_build_number\u003c/code\u003e, \u003ccode\u003eos_version\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eplatform\u003c/code\u003e: your phone OS, e.g. \u003ccode\u003eandroid\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003epushname\u003c/code\u003e: the name of yours you provided WhatsApp\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003esecret\u003c/code\u003e (remember this!)\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eserverToken\u003c/code\u003e: used to resuming closed sessions aka \"Remember me\" (not implemented yet)\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ewid\u003c/code\u003e: your phone number in the chat identification format (see below)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eStream\u003c/code\u003e: array has four elements in total, so the entire payload is like \u003ccode\u003e[\"Stream\",\"update\",false,\"0.2.7314\"]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eProps\u003c/code\u003e: array contains JSON object as second element with several properties like \u003ccode\u003eimageMaxKBytes\u003c/code\u003e (1024), \u003ccode\u003emaxParticipants\u003c/code\u003e (257), \u003ccode\u003evideoMaxEdge\u003c/code\u003e (960) and others\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"key-generation\" class=\"anchor\" href=\"#key-generation\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eKey generation\u003c/h3\u003e\n\u003col start=\"14\"\u003e\n\u003cli\u003eYou are now ready for generating the final encryption keys. Start by decoding the \u003ccode\u003esecret\u003c/code\u003e from \u003ccode\u003eConn\u003c/code\u003e as base64 and storing it as \u003ccode\u003esecret\u003c/code\u003e. This decoded secret will be 144 bytes long.\u003c/li\u003e\n\u003cli\u003eTake the \u003cem\u003efirst 32 bytes\u003c/em\u003e of the decoded secret and use it as a public key. Together with your private key, generate a shared key out of it and call it \u003ccode\u003esharedSecret\u003c/code\u003e. The application does it using \u003ccode\u003eprivateKey.get_shared_key(curve25519.Public(secret[:32]), lambda a:a)\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eExtend \u003ccode\u003esharedSecret\u003c/code\u003e to 80 bytes using HKDF. Call this value \u003ccode\u003esharedSecretExpanded\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThis step is optional, it validates the data provided by the server. The method is called \u003cem\u003eHMAC validation\u003c/em\u003e. Do it by first calculating \u003ccode\u003eHmacSha256(sharedSecretExpanded[32:64], secret[:32] + secret[64:])\u003c/code\u003e. Compare this value to \u003ccode\u003esecret[32:64]\u003c/code\u003e. If they are not equal, abort the login.\u003c/li\u003e\n\u003cli\u003eYou now have the encrypted keys: store \u003ccode\u003esharedSecretExpanded[64:] + secret[64:]\u003c/code\u003e as \u003ccode\u003ekeysEncrypted\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe encrypted keys now need to be decrypted using AES with \u003ccode\u003esharedSecretExpanded[:32]\u003c/code\u003e as key, i.e. store \u003ccode\u003eAESDecrypt(sharedSecretExpanded[:32], keysEncrypted)\u003c/code\u003e as \u003ccode\u003ekeysDecrypted\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003ekeysDecrypted\u003c/code\u003e variable is 64 bytes long and contains two keys, each 32 bytes long. The \u003ccode\u003eencKey\u003c/code\u003e is used for decrypting binary messages sent to you by the WhatsApp Web server or encrypting binary messages you send to the server. The \u003ccode\u003emacKey\u003c/code\u003e is needed to validate the messages sent to you:\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eencKey\u003c/code\u003e: \u003ccode\u003ekeysDecrypted[:32]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003emacKey\u003c/code\u003e: \u003ccode\u003ekeysDecrypted[32:64]\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"restoring-closed-sessions-not-implemented\" class=\"anchor\" href=\"#restoring-closed-sessions-not-implemented\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eRestoring closed sessions (not implemented)\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eAfter sending \u003ccode\u003einit\u003c/code\u003e command, check whether you have \u003ccode\u003eserverToken\u003c/code\u003e and \u003ccode\u003eclientToken\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eIf so, send \u003ccode\u003emessageTag,[\"admin\",\"login\",\"clientToken\",\"serverToken\",\"clientId\",\"takeover\"]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eThe server should respond with \u003ccode\u003e{\"status\": 200}\u003c/code\u003e. Other statuses:\n\u003cul\u003e\n\u003cli\u003e401: Unpaired from the phone\u003c/li\u003e\n\u003cli\u003e403: Access denied, check \u003ccode\u003etos\u003c/code\u003e field in the JSON: if it equals or greater than 2, you have violated TOS\u003c/li\u003e\n\u003cli\u003e405: Already logged in\u003c/li\u003e\n\u003cli\u003e409: Logged in from another location\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"resolving-challenge-not-implemented\" class=\"anchor\" href=\"#resolving-challenge-not-implemented\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eResolving challenge (not implemented)\u003c/h3\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eWhen using old or expired \u003ccode\u003eserverToken\u003c/code\u003e and \u003ccode\u003eclientToken\u003c/code\u003e, you will be challenged to confirm that you still have valid encryption keys.\u003c/li\u003e\n\u003cli\u003eThe challenge looks like this \u003ccode\u003emessageTag,[\"Cmd\",{\"type\":\"challenge\",\"challenge\":\"BASE_64_ENCODED_STRING==\"}]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eDecode \u003ccode\u003echallenge\u003c/code\u003e string from Base64, sign it with your macKey, encode it back with Base64 and send \u003ccode\u003emessageTag,[\"admin\",\"challenge\",\"BASE_64_ENCODED_STRING==\",\"serverToken\",\"clientId\"]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eThe server should respond with \u003ccode\u003e{\"status\": 200}\u003c/code\u003e, but it means nothing.\u003c/li\u003e\n\u003cli\u003eAfter solving challenge your connection should be restored.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"logging-out\" class=\"anchor\" href=\"#logging-out\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eLogging out\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eWhen you have an active WebSocket connection, just send \u003ccode\u003egoodbye,,[\"admin\",\"Conn\",\"disconnect\"]\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eWhen you don't have such connection (for example your session has been taken over from another location), sign your \u003ccode\u003eencKey\u003c/code\u003e with your \u003ccode\u003emacKey\u003c/code\u003e and encode it with Base64. Let's say it is your \u003ccode\u003elogoutToken\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eSend a POST request to \u003ccode\u003ehttps://dyn.web.whatsapp.com/logout?t=browserToken\u0026amp;m=logoutToken\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eRemember to always clear your sessions, so sessions list in your phone will not grow big.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"validating-and-decrypting-messages\" class=\"anchor\" href=\"#validating-and-decrypting-messages\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eValidating and decrypting messages\u003c/h3\u003e\n\u003cp\u003eNow that you have the two keys, validating and decrypting messages the server sent to you is quite easy. Note that this is only needed for \u003cem\u003ebinary\u003c/em\u003e messages, all JSON you receive stays plain. The binary messages always have 32 bytes at the beginning that specify the HMAC checksum. Both JSON \u003cem\u003eand\u003c/em\u003e binary messages have a message tag at their very start that can be discarded, i.e. only the portion after the first comma character is significant.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eValidate the message by hashing the actual message content with the \u003ccode\u003emacKey\u003c/code\u003e (here \u003ccode\u003emessageContent\u003c/code\u003e is the \u003cem\u003eentire\u003c/em\u003e binary message): \u003ccode\u003eHmacSha256(macKey, messageContent[32:])\u003c/code\u003e. If this value is not equal to \u003ccode\u003emessageContent[:32]\u003c/code\u003e, the message sent to you by the server is invalid and should be discarded.\u003c/li\u003e\n\u003cli\u003eDecrypt the message content using AES and the \u003ccode\u003eencKey\u003c/code\u003e: \u003ccode\u003eAESDecrypt(encKey, messageContent[32:])\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThe data you get in the final step has a binary format which is described in the following. Even though it's binary, you can still see several strings in it, especially the content of messages you sent is quite obvious there.\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"binary-message-format\" class=\"anchor\" href=\"#binary-message-format\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eBinary message format\u003c/h2\u003e\n\u003ch3\u003e\n\u003ca id=\"binary-decoding\" class=\"anchor\" href=\"#binary-decoding\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eBinary decoding\u003c/h3\u003e\n\u003cp\u003eThe Python script \u003ccode\u003ebackend/decoder.py\u003c/code\u003e implements the \u003ccode\u003eMessageParser\u003c/code\u003e class. It is able to create a JSON structure out of binary data in which the data is still organized in a rather messy way. The section about Node Handling below will discuss how the nodes are reorganized afterwards.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eMessageParser\u003c/code\u003e initially just needs some data and then processes it byte by byte, i.e. as a stream. It has a couple of constants and a lot of methods which all build on each other.\u003c/p\u003e\n\u003ch4\u003e\n\u003ca id=\"constants\" class=\"anchor\" href=\"#constants\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eConstants\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cem\u003eTags\u003c/em\u003e with their respective integer values\n\u003cul\u003e\n\u003cli\u003e\n\u003cem\u003eLIST_EMPTY\u003c/em\u003e: 0\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eSTREAM_8\u003c/em\u003e: 2\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eDICTIONARY_0\u003c/em\u003e: 236\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eDICTIONARY_1\u003c/em\u003e: 237\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eDICTIONARY_2\u003c/em\u003e: 238\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eDICTIONARY_3\u003c/em\u003e: 239\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eLIST_8\u003c/em\u003e: 248\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eLIST_16\u003c/em\u003e: 249\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eJID_PAIR\u003c/em\u003e: 250\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eHEX_8\u003c/em\u003e: 251\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eBINARY_8\u003c/em\u003e: 252\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eBINARY_20\u003c/em\u003e: 253\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eBINARY_32\u003c/em\u003e: 254\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eNIBBLE_8\u003c/em\u003e: 255\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eTokens\u003c/em\u003e are a long list of 151 strings in which the indices matter:\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e[None,None,None,\"200\",\"400\",\"404\",\"500\",\"501\",\"502\",\"action\",\"add\", \"after\",\"archive\",\"author\",\"available\",\"battery\",\"before\",\"body\", \"broadcast\",\"chat\",\"clear\",\"code\",\"composing\",\"contacts\",\"count\", \"create\",\"debug\",\"delete\",\"demote\",\"duplicate\",\"encoding\",\"error\", \"false\",\"filehash\",\"from\",\"g.us\",\"group\",\"groups_v2\",\"height\",\"id\", \"image\",\"in\",\"index\",\"invis\",\"item\",\"jid\",\"kind\",\"last\",\"leave\", \"live\",\"log\",\"media\",\"message\",\"mimetype\",\"missing\",\"modify\",\"name\", \"notification\",\"notify\",\"out\",\"owner\",\"participant\",\"paused\", \"picture\",\"played\",\"presence\",\"preview\",\"promote\",\"query\",\"raw\", \"read\",\"receipt\",\"received\",\"recipient\",\"recording\",\"relay\", \"remove\",\"response\",\"resume\",\"retry\",\"s.whatsapp.net\",\"seconds\", \"set\",\"size\",\"status\",\"subject\",\"subscribe\",\"t\",\"text\",\"to\",\"true\", \"type\",\"unarchive\",\"unavailable\",\"url\",\"user\",\"value\",\"web\",\"width\", \"mute\",\"read_only\",\"admin\",\"creator\",\"short\",\"update\",\"powersave\", \"checksum\",\"epoch\",\"block\",\"previous\",\"409\",\"replaced\",\"reason\", \"spam\",\"modify_tag\",\"message_info\",\"delivery\",\"emoji\",\"title\", \"description\",\"canonical-url\",\"matched-text\",\"star\",\"unstar\", \"media_key\",\"filename\",\"identity\",\"unread\",\"page\",\"page_count\", \"search\",\"media_message\",\"security\",\"call_log\",\"profile\",\"ciphertext\", \"invite\",\"gif\",\"vcard\",\"frequent\",\"privacy\",\"blacklist\",\"whitelist\", \"verify\",\"location\",\"document\",\"elapsed\",\"revoke_invite\",\"expiration\", \"unsubscribe\",\"disable\"]\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e\n\u003ca id=\"number-reformatting\" class=\"anchor\" href=\"#number-reformatting\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eNumber reformatting\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cem\u003eUnpacking nibbles\u003c/em\u003e: Returns the ASCII representation for numbers between 0 and 9. Returns \u003ccode\u003e-\u003c/code\u003e for 10, \u003ccode\u003e.\u003c/code\u003e for 11 and \u003ccode\u003e\\0\u003c/code\u003e for 15.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eUnpacking hex values\u003c/em\u003e: Returns the ASCII representation for numbers between 0 and 9 or letters between A and F (i.e. uppercase) for numbers between 10 and 15.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eUnpacking bytes\u003c/em\u003e: Expects a tag as an additional parameter, namely \u003cem\u003eNIBBLE_8\u003c/em\u003e or \u003cem\u003eHEX_8\u003c/em\u003e. Unpacks a nibble or hex value accordingly.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e\n\u003ca id=\"number-formats\" class=\"anchor\" href=\"#number-formats\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eNumber formats\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cem\u003eByte\u003c/em\u003e: A plain ol' byte.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eInteger with N bytes\u003c/em\u003e: Reads N bytes and builds a number out of them. Can be little or big endian; if not specified otherwise, big endian is used. Note that no negative values are possible.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eInt16\u003c/em\u003e: An integer with two bytes, read using \u003cem\u003eInteger with N bytes\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eInt20\u003c/em\u003e: Consumes three bytes and constructs an integer using the last four bits of the first byte and the entire second and third byte. Is therefore always big endian.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eInt32\u003c/em\u003e: An integer with four bytes, read using \u003cem\u003eInteger with N bytes\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eInt64\u003c/em\u003e: An integer with eight bytes, read using \u003cem\u003eInteger with N bytes\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003ePacked8\u003c/em\u003e: Expects a tag as an additional parameter, namely \u003cem\u003eNIBBLE_8\u003c/em\u003e or \u003cem\u003eHEX_8\u003c/em\u003e. Returns a string.\n\u003cul\u003e\n\u003cli\u003eFirst reads a byte \u003ccode\u003en\u003c/code\u003e and does the following \u003ccode\u003en\u0026amp;127\u003c/code\u003e many times: Reads a byte \u003ccode\u003el\u003c/code\u003e and for each nibble, adds the result of its \u003cem\u003eunpacked version\u003c/em\u003e to the return value (using \u003cem\u003eunpacking bytes\u003c/em\u003e with the given tag). Most significant nibble first.\u003c/li\u003e\n\u003cli\u003eIf the most significant bit of \u003ccode\u003en\u003c/code\u003e was set, removes the last character of the return value.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e\n\u003ca id=\"helper-methods\" class=\"anchor\" href=\"#helper-methods\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eHelper methods\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cem\u003eRead bytes\u003c/em\u003e: Reads and returns the specified number of bytes.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eCheck for list tag\u003c/em\u003e: Expects a tag as parameter and returns true if the tag is \u003ccode\u003eLIST_EMPTY\u003c/code\u003e, \u003ccode\u003eLIST_8\u003c/code\u003e or \u003ccode\u003eLIST_16\u003c/code\u003e (i.e. 0, 248 or 249).\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eRead list size\u003c/em\u003e: Expects a list tag as parameter. Returns 0 for \u003ccode\u003eLIST_EMPTY\u003c/code\u003e, returns a read byte for \u003ccode\u003eLIST_8\u003c/code\u003e or a read \u003cem\u003eInt16\u003c/em\u003e for \u003ccode\u003eLIST_16\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eRead a string from characters\u003c/em\u003e: Expects the string length as parameter, reads this many bytes and returns them as a string.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eGet a token\u003c/em\u003e: Expects an index to the array of \u003cem\u003eTokens\u003c/em\u003e, and returns the respective string.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eGet a double token\u003c/em\u003e: Expects two integers \u003ccode\u003ea\u003c/code\u003e and \u003ccode\u003eb\u003c/code\u003e and gets the token at index \u003ccode\u003ea*256+b\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e\n\u003ca id=\"strings\" class=\"anchor\" href=\"#strings\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eStrings\u003c/h4\u003e\n\u003cp\u003eReading a string needs a \u003cem\u003etag\u003c/em\u003e as parameter. Depending on this tag, different data is read.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIf the tag is between 3 and 235, the \u003cem\u003etoken\u003c/em\u003e (i.e. a string) of this tag is got. If the token is \u003ccode\u003e\"s.whatsapp.net\"\u003c/code\u003e, \u003ccode\u003e\"c.us\"\u003c/code\u003e is returned instead, otherwise the token is returned as is.\u003c/li\u003e\n\u003cli\u003eIf the tag is between \u003cem\u003eDICTIONARY_0\u003c/em\u003e and \u003cem\u003eDICTIONARY_3\u003c/em\u003e, a \u003cem\u003edouble token\u003c/em\u003e is returned, with \u003ccode\u003etag-DICTIONARY_0\u003c/code\u003e as first and a read byte as second parameter.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eLIST_EMPTY\u003c/em\u003e: Nothing is returned (e.g. \u003ccode\u003eNone\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eBINARY_8\u003c/em\u003e: A byte is read which is then used to \u003cem\u003eread a string from characters\u003c/em\u003e with this length.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eBINARY_20\u003c/em\u003e: An \u003cem\u003eInt20\u003c/em\u003e is read which is then used to \u003cem\u003eread a string from characters\u003c/em\u003e with this length.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eBINARY_32\u003c/em\u003e: An \u003cem\u003eInt32\u003c/em\u003e is read which is then used to \u003cem\u003eread a string from characters\u003c/em\u003e with this length.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eJID_PAIR\u003c/em\u003e\n\u003cul\u003e\n\u003cli\u003eFirst, a byte is read which is then used to \u003cem\u003eread a string\u003c/em\u003e \u003ccode\u003ei\u003c/code\u003e with this tag.\u003c/li\u003e\n\u003cli\u003eSecond, another byte is read which is then used to \u003cem\u003eread a string\u003c/em\u003e \u003ccode\u003ej\u003c/code\u003e with this tag.\u003c/li\u003e\n\u003cli\u003eFinally, \u003ccode\u003ei\u003c/code\u003e and \u003ccode\u003ej\u003c/code\u003e are joined together with an \u003ccode\u003e@\u003c/code\u003e sign and the result is returned.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eNIBBLE_8\u003c/em\u003e or \u003cem\u003eHEX_8\u003c/em\u003e: A \u003cem\u003ePacked8\u003c/em\u003e with this tag is returned.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e\n\u003ca id=\"attribute-lists\" class=\"anchor\" href=\"#attribute-lists\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAttribute lists\u003c/h4\u003e\n\u003cp\u003eReading an attribute list needs the number of attributes to read as parameter. An attribute list is always a JSON object. For each attribute read, the following steps are executed for getting key-value pairs (exactly in this order!):\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cem\u003eKey\u003c/em\u003e: A byte is read which is then used to \u003cem\u003eread a string\u003c/em\u003e with this tag.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eValue\u003c/em\u003e: A byte is read which is then used to \u003cem\u003eread a string\u003c/em\u003e with this tag.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e\n\u003ca id=\"nodes\" class=\"anchor\" href=\"#nodes\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eNodes\u003c/h4\u003e\n\u003cp\u003eA node always consists of a JSON array with exactly three entries: description, attributes and content. The following steps are needed to read a node:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eA \u003cem\u003elist size\u003c/em\u003e \u003ccode\u003ea\u003c/code\u003e is read by using a read byte as the tag. The list size 0 is invalid.\u003c/li\u003e\n\u003cli\u003eThe description tag is read as a byte. The value 2 is invalid for this tag. The description string \u003ccode\u003edescr\u003c/code\u003e is then obtained by \u003cem\u003ereading a string\u003c/em\u003e with this tag.\u003c/li\u003e\n\u003cli\u003eThe attributes object \u003ccode\u003eattrs\u003c/code\u003e is read by \u003cem\u003ereading an attributes object\u003c/em\u003e with length \u003ccode\u003e(a-2 + a%2) \u0026gt;\u0026gt; 1\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eIf \u003ccode\u003ea\u003c/code\u003e was odd, this node does not have any content, i.e. \u003ccode\u003e[descr, attrs, None]\u003c/code\u003e is returned.\u003c/li\u003e\n\u003cli\u003eFor getting the node's content, first a byte, i.e. a tag is read. Depending on this tag, different types of content emerge:\n\u003cul\u003e\n\u003cli\u003eIf the tag is a \u003cem\u003elist tag\u003c/em\u003e, a \u003cem\u003elist is read\u003c/em\u003e using this tag (see below for lists).\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eBINARY_8\u003c/em\u003e: A byte is read which is then used as length for \u003cem\u003ereading bytes\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eBINARY_20\u003c/em\u003e: An \u003cem\u003eInt20\u003c/em\u003e is read which is then used as length for \u003cem\u003ereading bytes\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eBINARY_32\u003c/em\u003e: An \u003cem\u003eInt32\u003c/em\u003e is read which is then used as length for \u003cem\u003ereading bytes\u003c/em\u003e.\u003c/li\u003e\n\u003cli\u003eIf the tag is something else, a \u003cem\u003estring is read\u003c/em\u003e using this tag.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eEventually, \u003ccode\u003e[descr, attrs, content]\u003c/code\u003e is returned.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e\n\u003ca id=\"lists\" class=\"anchor\" href=\"#lists\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eLists\u003c/h4\u003e\n\u003cp\u003eReading a list requires a \u003cem\u003elist tag\u003c/em\u003e (i.e. \u003cem\u003eLIST_EMPTY\u003c/em\u003e, \u003cem\u003eLIST_8\u003c/em\u003e or \u003cem\u003eLIST_16\u003c/em\u003e). The length of the list is then obtained by \u003cem\u003ereading a list size\u003c/em\u003e using this tag. For each list entry, a \u003cem\u003enode is read\u003c/em\u003e.\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"node-handling\" class=\"anchor\" href=\"#node-handling\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eNode Handling\u003c/h3\u003e\n\u003cp\u003eAfter a binary message has been transformed into JSON, it is still rather hard to read. That's why, internally, WhatsApp Web completely retransforms this structure into something that can be easily processed and eventually translated into user interface content. This section will deal with this and awaits completion.\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"binary-conversation-format\" class=\"anchor\" href=\"#binary-conversation-format\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eBinary conversation format\u003c/h2\u003e\n\u003cp\u003eWhen a node has been read, the contents of messages that have been actually sent by the user (i.e. text, image, audio, video etc.) are still not directly visible or accessible via the JSON. Instead, they are kept in a protobuf message. See \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/doc/spec/def.proto\" rel=\"nofollow\"\u003ehere\u003c/a\u003e for the definitions. The \"wrapper\" message type is \u003ccode\u003eWebMessageInfo\u003c/code\u003e.\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"whatsapp-web-api\" class=\"anchor\" href=\"#whatsapp-web-api\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eWhatsApp Web API\u003c/h2\u003e\n\u003cp\u003eWhatsApp Web itself has an interesting API as well. You can even try it out directly in your browser. Just log in at the normal \u003ca href=\"https://web.whatsapp.com/\" rel=\"nofollow\"\u003ehttps://web.whatsapp.com/\u003c/a\u003e, then open the browser development console. Now enter something like the following (see below for details on the chat identification):\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ewindow.Store.Wap.profilePicFind(\"49123456789@c.us\").then(res =\u0026gt; console.log(res));\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewindow.Store.Wap.lastseenFind(\"49123456789@c.us\").then(res =\u0026gt; console.log(res));\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ewindow.Store.Wap.statusFind(\"49123456789@c.us\").then(res =\u0026gt; console.log(res));\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eUsing the amazing Chrome developer console, you can see that \u003ccode\u003ewindow.Store.Wap\u003c/code\u003e contains a lot of other very interesting functions. Many of them return JavaScript promises. When you click on the \u003cem\u003eNetwork\u003c/em\u003e tab and then on \u003cem\u003eWS\u003c/em\u003e (maybe you need to reload the site first), you can look at all the communication between WhatsApp Web and its servers.\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"chat-identification--jid\" class=\"anchor\" href=\"#chat-identification--jid\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eChat identification / JID\u003c/h3\u003e\n\u003cp\u003eThe WhatsApp Web API uses the following formats to identify chats with individual users and groups of multiple users.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eChats\u003c/strong\u003e: \u003ccode\u003e[country code][number]@c.us\u003c/code\u003e, e.g. \u003cstrong\u003e\u003ccode\u003e49123456789@c.us\u003c/code\u003e\u003c/strong\u003e when you are from Germany and your phone number is \u003ccode\u003e0123 456789\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eGroups\u003c/strong\u003e: \u003ccode\u003e[phone number of group creator]-[timestamp of group creation]@g.us\u003c/code\u003e, e.g. \u003cstrong\u003e\u003ccode\u003e49123456789-1509911919@g.us\u003c/code\u003e\u003c/strong\u003e for the group that \u003ccode\u003e49123456789@c.us\u003c/code\u003e created on November 5 2017.\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eBroadcast Channels\u003c/strong\u003e \u003ccode\u003e[timestamp of broadcast channel creation]@broadcast\u003c/code\u003e, e.g. \u003cstrong\u003e\u003ccode\u003e1509911919@broadcast\u003c/code\u003e\u003c/strong\u003e for an broadcast channel created on November 5 2017.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e\n\u003ca id=\"websocket-messages\" class=\"anchor\" href=\"#websocket-messages\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eWebSocket messages\u003c/h3\u003e\n\u003cp\u003eThere are two types of WebSocket messages that are exchanged between server and client. On the one hand, plain JSON that is rather unambiguous (especially for the API calls above), on the other hand encrypted binary messages.\u003c/p\u003e\n\u003cp\u003eUnfortunately, these binary ones cannot be looked at using the Chrome developer tools. Additionally, the Python backend, that of course also receives these messages, needs to decrypt them, as they contain encrypted data. The section about encryption details discusses how it can be decrypted.\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"dealing-with-e2e-media\" class=\"anchor\" href=\"#dealing-with-e2e-media\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eDealing with E2E media\u003c/h2\u003e\n\u003ch3\u003e\n\u003ca id=\"encryption\" class=\"anchor\" href=\"#encryption\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eEncryption\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eGenerate your own \u003ccode\u003emediaKey\u003c/code\u003e, which needs to be 32 bytes.\u003c/li\u003e\n\u003cli\u003eExpand it to 112 bytes using HKDF with type-specific application info (see below). Call this value \u003ccode\u003emediaKeyExpanded\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eSplit \u003ccode\u003emediaKeyExpanded\u003c/code\u003e into:\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eiv\u003c/code\u003e: \u003ccode\u003emediaKeyExpanded[:16]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ecipherKey\u003c/code\u003e: \u003ccode\u003emediaKeyExpanded[16:48]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003emacKey\u003c/code\u003e: \u003ccode\u003emediaKeyExpanded[48:80]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003erefKey\u003c/code\u003e: \u003ccode\u003emediaKeyExpanded[80:]\u003c/code\u003e (not used)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eEncrypt the file with AES-CBC using \u003ccode\u003ecipherKey\u003c/code\u003e and \u003ccode\u003eiv\u003c/code\u003e, pad it and call it \u003ccode\u003eenc\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eSign \u003ccode\u003eiv + enc\u003c/code\u003e with \u003ccode\u003emacKey\u003c/code\u003e using HMAC SHA-256 and store the first 10 bytes of the hash as \u003ccode\u003emac\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eHash the file with SHA-256 and store it as \u003ccode\u003efileSha256\u003c/code\u003e, hash the \u003ccode\u003eenc + mac\u003c/code\u003e with SHA-256 and store it as \u003ccode\u003efileEncSha256\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eEncode the \u003ccode\u003efileEncSha256\u003c/code\u003e with base64 and store it as \u003ccode\u003efileEncSha256B64\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThis step is required only for streamable media, e.g. video and audio. As CBC mode allows to decrypt a data from random offset (block-size aligned), it is possible to play and seek the media without the need to fully download it. That said, we need to generate a \u003ccode\u003esidecar\u003c/code\u003e. Do it by signing every \u003ccode\u003e[n*64K, (n+1)*64K+16]\u003c/code\u003e chunk with \u003ccode\u003emacKey\u003c/code\u003e, truncating the result to the first 10 bytes. Then combine everything in one piece.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"upload\" class=\"anchor\" href=\"#upload\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eUpload\u003c/h3\u003e\n\u003col start=\"8\"\u003e\n\u003cli\u003eRetrieve the upload-url by sending \u003ccode\u003emessageTag,[\"action\", \"encr_upload\", filetype, fileEncSha256B64]\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003efiletype\u003c/code\u003e can be one of \u003ccode\u003eimage\u003c/code\u003e, \u003ccode\u003eaudio\u003c/code\u003e, \u003ccode\u003edocument\u003c/code\u003e or \u003ccode\u003evideo\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate a multipart-form with the following fields:\n\u003cul\u003e\n\u003cli\u003efieldname: \u003ccode\u003ehash\u003c/code\u003e: \u003ccode\u003efileEncSha256B64\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003efieldname: \u003ccode\u003efile\u003c/code\u003e, filename: \u003ccode\u003eblob\u003c/code\u003e: \u003ccode\u003eenc+mac\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eDo a POST request to the url with query string \u003ccode\u003e?f=j\u003c/code\u003e and the correct \u003ccode\u003econtent-type\u003c/code\u003e and the multipart-form, WhatsApp will respond with the download url for the file.\u003c/li\u003e\n\u003cli\u003eAll relevant information to send the file are now generated, just build the proto and send it.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"decryption\" class=\"anchor\" href=\"#decryption\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eDecryption\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eObtain \u003ccode\u003emediaKey\u003c/code\u003e and decode it from Base64 if necessary.\u003c/li\u003e\n\u003cli\u003eExpand it to 112 bytes using HKDF with type-specific application info (see below). Call this value \u003ccode\u003emediaKeyExpanded\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eSplit \u003ccode\u003emediaKeyExpanded\u003c/code\u003e into:\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003eiv\u003c/code\u003e: \u003ccode\u003emediaKeyExpanded[:16]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ecipherKey\u003c/code\u003e: \u003ccode\u003emediaKeyExpanded[16:48]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003emacKey\u003c/code\u003e: \u003ccode\u003emediaKeyExpanded[48:80]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003erefKey\u003c/code\u003e: \u003ccode\u003emediaKeyExpanded[80:]\u003c/code\u003e (not used)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eDownload media data from the \u003ccode\u003eurl\u003c/code\u003e and split it into:\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003efile\u003c/code\u003e: \u003ccode\u003emediaData[:-10]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003emac\u003c/code\u003e: \u003ccode\u003emediaData[-10:]\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eValidate media data with HMAC by signing \u003ccode\u003eiv + file\u003c/code\u003e with \u003ccode\u003emacKey\u003c/code\u003e using SHA-256. Take in mind that \u003ccode\u003emac\u003c/code\u003e is truncated to 10 bytes, so you should compare only the first 10 bytes.\u003c/li\u003e\n\u003cli\u003eDecrypt \u003ccode\u003efile\u003c/code\u003e with AES-CBC using \u003ccode\u003ecipherKey\u003c/code\u003e and \u003ccode\u003eiv\u003c/code\u003e, and unpad it. Note that this means that your session's keys (i.e. \u003ccode\u003eencKey\u003c/code\u003e and \u003ccode\u003emacKey\u003c/code\u003e from the \u003cem\u003eKey generation\u003c/em\u003e section) are not necessary to decrypt a media file.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e\n\u003ca id=\"application-info-for-hkdf\" class=\"anchor\" href=\"#application-info-for-hkdf\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eApplication info for HKDF\u003c/h3\u003e\n\u003cp\u003eDepending on the media type, the literal strings in the right column are the values for the \u003ccode\u003eappInfo\u003c/code\u003e parameter from the \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py#L37\" rel=\"nofollow\"\u003e\u003ccode\u003eHKDF\u003c/code\u003e function\u003c/a\u003e.\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eMedia Type\u003c/th\u003e\n\u003cth\u003eApplication Info\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eIMAGE\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eWhatsApp Image Keys\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eVIDEO\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eWhatsApp Video Keys\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eAUDIO\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eWhatsApp Audio Keys\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eDOCUMENT\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003eWhatsApp Document Keys\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2\u003e\n\u003ca id=\"extending-the-web-apps-capabilities\" class=\"anchor\" href=\"#extending-the-web-apps-capabilities\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eExtending the web app's capabilities\u003c/h2\u003e\n\u003ch3\u003e\n\u003ca id=\"adding-own-commands\" class=\"anchor\" href=\"#adding-own-commands\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eAdding own commands\u003c/h3\u003e\n\u003cp\u003eThe message forwarding procedures are rather complex, as there are several layers of websockes involved in the process. For adding your own commands, follow these steps.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eFirst, decide on what the final destination of your command shall be. To be consistent with the other, please prefix it with \u003ccode\u003ebackend_\u003c/code\u003e if it's meant to be received by the Python backend or use \u003ccode\u003eapi_\u003c/code\u003e if the command is directed to the NodeJS API.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNow, look at \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/client/js/main.js\" rel=\"nofollow\"\u003e\u003ccode\u003eclient/js/main.js\u003c/code\u003e\u003c/a\u003e. In \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/client/js/main.js#L214\" rel=\"nofollow\"\u003eline 214\u003c/a\u003e, you can see an instantiation of the \u003ccode\u003eBootstrapStep\u003c/code\u003e JavaScript class. It needs the following information:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003ewebsocket\u003c/code\u003e: is probably always the same\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003erequest.type\u003c/code\u003e: should generally be \u003ccode\u003ecall\u003c/code\u003e, as this allows a response to be passed back to the command's sender\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003erequest.callArgs\u003c/code\u003e: an object which has to contain a \u003ccode\u003ecommand\u003c/code\u003e attribute specifying the name of your command and as many additional key-value-pairs as you want. All of these will be passed to the receiver.\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003erequest.successCondition\u003c/code\u003e: on receiving a response for a call, this shall be a function returning \u003ccode\u003etrue\u003c/code\u003e when the response is valid/expected. Use the next attribute for specifying code to be executed when the response is valid.\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003erequest.successActor\u003c/code\u003e: when the success condition evaluated to \u003ccode\u003etrue\u003c/code\u003e, this success actor function is called\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWhen the \u003ccode\u003eBootstrapStep\u003c/code\u003e object has been constructed, call \u003ccode\u003e.run()\u003c/code\u003e for running indefinitely or \u003ccode\u003e.run(timeout_ms)\u003c/code\u003e for failing when no response has been received after a specific timeout. The \u003ccode\u003erun\u003c/code\u003e function returns a Promise.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNext, edit \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/index.js\" rel=\"nofollow\"\u003e\u003ccode\u003eindex.js\u003c/code\u003e\u003c/a\u003e. It contains a couple of blocks beginning with \u003ccode\u003eclientWebsocket.waitForMessage\u003c/code\u003e. You can copy one of these blocks and edit the parameters. The \u003ccode\u003ewaitForMessage\u003c/code\u003e function needs the following attributes:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003econdition\u003c/code\u003e: when a message is received and this condition evaluates to \u003ccode\u003etrue\u003c/code\u003e on it, the message will be processed by the following \u003ccode\u003e.then(...)\u003c/code\u003e block\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ekeepWhenHit\u003c/code\u003e: it is possible for a message handler to be detached immediately after it receives its first fitting message. Control this here.\nThe returned promise's \u003ccode\u003ethen\u003c/code\u003e block finally handles a received message. It gets a \u003ccode\u003eclientCallRequest\u003c/code\u003e you can call \u003ccode\u003e.respond({...})\u003c/code\u003e on to send a JSON response to the caller. If the NodeJS API is not the message's final destination, you need to instantiate a new \u003ccode\u003eBootstrapStep\u003c/code\u003e here which will contact to the Python backend and, after it receives its response, will return it to the original caller.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThus, when you want a message for the backend, now edit \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp-web-backend.py\" rel=\"nofollow\"\u003e\u003ccode\u003ebackend/whatsapp-web-backend.py\u003c/code\u003e\u003c/a\u003e. In the if-else-compound starting in \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp-web-backend.py#L88\" rel=\"nofollow\"\u003eline 88\u003c/a\u003e, add your own branch for the command name you chose. Then, edit \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py\" rel=\"nofollow\"\u003e\u003ccode\u003ebackend/whatsapp.py\u003c/code\u003e\u003c/a\u003e and add a function similar to \u003ccode\u003egenerateQRCode\u003c/code\u003e in \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py#L223\" rel=\"nofollow\"\u003eline 223\u003c/a\u003e. Just using something like in \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py#L230\" rel=\"nofollow\"\u003e\u003ccode\u003egetLoginInfo\u003c/code\u003e\u003c/a\u003e may not be enough, as your command may require an asynchronous request to the WhatsApp Web servers. In this case, make sure to add an entry to \u003ccode\u003eself.messageQueue\u003c/code\u003e with the message tag you chose and send an appropriate message to \u003ccode\u003eself.activeWs\u003c/code\u003e. The servers will respond to your request with a response containing the same tag, thus this is resolved in \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/blob/master/backend/whatsapp.py#L134\" rel=\"nofollow\"\u003eline 134\u003c/a\u003e. Make sure to eventually call \u003ccode\u003epend[\"callback\"][\"func\"]({...})\u003c/code\u003e with the JSON object containing your response data to resolve the callback.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e\n\u003ca id=\"docker\" class=\"anchor\" href=\"#docker\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eDocker\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003ePlease note, this version is not stable enough to be deployabled in production.\u003c/strong\u003e\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"build-docker-image\" class=\"anchor\" href=\"#build-docker-image\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eBuild docker image\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003edocker build . -t whatsapp-web-reveng\u003c/code\u003e\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"run-your-image-and-redirect-front--back-ports\" class=\"anchor\" href=\"#run-your-image-and-redirect-front--back-ports\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eRun your image and redirect front \u0026amp; back ports\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003edocker run -p 2019:2019 -p 2018:2018 whatsapp-web-reveng\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eFront end (client) at : \u003ca href=\"http://localhost:2018/\" rel=\"nofollow\"\u003ehttp://localhost:2018/\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003e\n\u003ca id=\"for-server-use\" class=\"anchor\" href=\"#for-server-use\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eFor server use\u003c/h3\u003e\n\u003cp\u003eThe addresses of the websockets used are \"localhost\" by default.\nIf you want to deploy this docker on your own server and share it, modify the backend websocket address on the front end.\n\u003ccode\u003eclient/js/main.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre lang=\"javascript\" class=\"highlight-javascript\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ebackendInfo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"ws://{{your-server-addr}}:2020\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\n\u003cp\u003eFront end (client) at : : \u003ca href=\"http://%7B%7Byour-server-addr%7D%7D:2018/\" rel=\"nofollow\"\u003ehttp://{{your-server-addr}}:2018/\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"tasks\" class=\"anchor\" href=\"#tasks\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTasks\u003c/h2\u003e\n\u003ch3\u003e\n\u003ca id=\"backend\" class=\"anchor\" href=\"#backend\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eBackend\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e[ ] More and more errors start to occur in the binary message decoding. Update this documentation to resemble the changes, then implement them.\u003c/li\u003e\n\u003cli\u003e[ ] Allow sending messages as well. Of course JSON is easy, but \u003cem\u003ewriting\u003c/em\u003e the binary message format needs to start being examined.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e\n\u003ca id=\"web-frontend\" class=\"anchor\" href=\"#web-frontend\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eWeb frontend\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e[ ] Allow reusing the session after successful login. Probably normal cookies are best for this. See \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/issues/9\" rel=\"nofollow\"\u003e#9\u003c/a\u003e for details.\u003c/li\u003e\n\u003cli\u003e[ ] An UI that is not that technical, but rather starts to emulate the actual WhatsApp Web UI.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e\n\u003ca id=\"general-development\" class=\"anchor\" href=\"#general-development\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eGeneral development\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e[ ] Allow usage on Windows, i.e. entirely fix \u003ca href=\"https://github.com/sigalor/whatsapp-web-reveng/issues/16\" rel=\"nofollow\"\u003e#16\u003c/a\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e\n\u003ca id=\"documentation\" class=\"anchor\" href=\"#documentation\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eDocumentation\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e[ ] The \u003cem\u003eNode Handling\u003c/em\u003e section. Could become very long.\u003c/li\u003e\n\u003cli\u003e[ ] Outsource the different documentation parts into their own files, maybe into the \u003ccode\u003egh-pages\u003c/code\u003e branch.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e\n\u003ca id=\"legal\" class=\"anchor\" href=\"#legal\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eLegal\u003c/h2\u003e\n\u003cp\u003eThis code is in no way affiliated with, authorized, maintained, sponsored or endorsed by WhatsApp or any of its affiliates or subsidiaries. This is an independent and unofficial software. Use at your own risk.\u003c/p\u003e\n\u003ch2\u003e\n\u003ca id=\"cryptography-notice\" class=\"anchor\" href=\"#cryptography-notice\" aria-hidden=\"true\"\u003e\u003cspan aria-hidden=\"true\" class=\"octicon octicon-link\"\u003e\u003c/span\u003e\u003c/a\u003eCryptography Notice\u003c/h2\u003e\n\u003cp\u003eThis distribution includes cryptographic software. The country in which you currently reside may have restrictions on the import, possession, use, and/or re-export to another country, of encryption software. BEFORE using any encryption software, please check your country's laws, regulations and policies concerning the import, possession, or use, and re-export of encryption software, to see if this is permitted. See \u003ca href=\"http://www.wassenaar.org/\" rel=\"nofollow\"\u003ehttp://www.wassenaar.org/\u003c/a\u003e for more information.\u003c/p\u003e\n\u003cp\u003eThe U.S. Government Department of Commerce, Bureau of Industry and Security (BIS), has classified this software as Export Commodity Control Number (ECCN) 5D002.C.1, which includes information security software using or performing cryptographic functions with asymmetric algorithms. The form and manner of this distribution makes it eligible for export under the License Exception ENC Technology Software Unrestricted (TSU) exception (see the BIS Export Administration Regulations, Section 740.13) for both object code and source code.\u003c/p\u003e\n\u003c/body\u003e\u003c/html\u003e\n","project_id":116014572,"name":"whatsapp-web-reveng","owner_login":"sigalor","description":"Reverse engineering WhatsApp Web.","pushed_at":"2020-12-12T07:45:43.000Z","stargazers_count":4815,"open_issues_count":124,"has_downloads":true,"archived":false,"license_key":"mit","homepage":null,"private":false,"project_created_at":"2018-01-02T12:48:44.000Z","project_updated_at":"2021-01-13T17:12:00.000Z","language":"JavaScript","added_language_topic":true},"categories":[{"name":"Advertising","topicsCount":10},{"name":"Application Programming Interfaces","topicsCount":124},{"name":"Applications","topicsCount":192},{"name":"Artificial Intelligence","topicsCount":78},{"name":"Blockchain","topicsCount":73},{"name":"Build Tools","topicsCount":113},{"name":"Cloud Computing","topicsCount":80},{"name":"Code Quality","topicsCount":28},{"name":"Collaboration","topicsCount":32},{"name":"Command Line Interface","topicsCount":49},{"name":"Community","topicsCount":83},{"name":"Companies","topicsCount":60},{"name":"Compilers","topicsCount":63},{"name":"Computer Science","topicsCount":80},{"name":"Configuration Management","topicsCount":42},{"name":"Content Management","topicsCount":175},{"name":"Control Flow","topicsCount":213},{"name":"Data Formats","topicsCount":78},{"name":"Data Processing","topicsCount":276},{"name":"Data Storage","topicsCount":135},{"name":"Economics","topicsCount":64},{"name":"Frameworks","topicsCount":215},{"name":"Games","topicsCount":129},{"name":"Graphics","topicsCount":110},{"name":"Hardware","topicsCount":152},{"name":"Integrated Development Environments","topicsCount":49},{"name":"Learning Resources","topicsCount":166},{"name":"Legal","topicsCount":29},{"name":"Libraries","topicsCount":129},{"name":"Lists Of Projects","topicsCount":22},{"name":"Machine Learning","topicsCount":347},{"name":"Mapping","topicsCount":64},{"name":"Marketing","topicsCount":15},{"name":"Mathematics","topicsCount":55},{"name":"Media","topicsCount":239},{"name":"Messaging","topicsCount":98},{"name":"Networking","topicsCount":315},{"name":"Operating Systems","topicsCount":89},{"name":"Operations","topicsCount":121},{"name":"Package Managers","topicsCount":55},{"name":"Programming Languages","topicsCount":245},{"name":"Runtime Environments","topicsCount":100},{"name":"Science","topicsCount":42},{"name":"Security","topicsCount":396},{"name":"Social Media","topicsCount":27},{"name":"Software Architecture","topicsCount":72},{"name":"Software Development","topicsCount":72},{"name":"Software Performance","topicsCount":58},{"name":"Software Quality","topicsCount":133},{"name":"Text Editors","topicsCount":49},{"name":"Text Processing","topicsCount":136},{"name":"User Interface","topicsCount":330},{"name":"User Interface Components","topicsCount":514},{"name":"Version Control","topicsCount":30},{"name":"Virtualization","topicsCount":71},{"name":"Web Browsers","topicsCount":42},{"name":"Web Servers","topicsCount":26},{"name":"Web User Interface","topicsCount":210},{"name":"All Projects","topicsCount":0}],"advertisement":{"variation":"project","title":"Become A Software Engineer At Top Companies","description":"Identify your strengths with a free online coding quiz, and skip resume and recruiter screens at multiple companies at once.  It's free, confidential, includes a free flight and hotel, along with help to study to pass interviews and negotiate a high salary!","url":"https://triplebyte.com/a/PGNifkM/pt2"},"nonCommercial":false,"nonDerivative":false}</script>
      



    <!-- load synchronously before app bundle so adsbygoogle is always defined, google's new ad code doesn't seem to like this, at least for the initial review  -->
    <!-- try loading programatically and async with a callback to push the ads and see if it helps page load speed -->
    <!--script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script-->
    <script src="/packs/root-bundle-1f53b6db74aa6b1bef19.js"></script>
  </body>
</html>
