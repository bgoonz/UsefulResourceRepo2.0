define(["translations","pgadmin.browser.endpoints","pgadmin.user_management.current_user","pgadmin.browser.utils","pgadmin.browser.messages","pgadmin.server.supported_servers"],(function(e,t,n,a,i,r){return function(e){function t(t){for(var a,o,s=t[0],l=t[1],d=t[2],u=0,f=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&f.push(i[o][0]),i[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(c&&c(t);f.length;)f.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(a=!1)}a&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},i={12:0},r=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise((function(t,a){n=i[e]=[t,a]}));t.push(n[2]=a);var r,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+""+({14:"vendors~geometry",15:"vendors~snapsvg"}[e]||e)+".chunk.js"}(e);var l=new Error;r=function(t){s.onerror=s.onload=null,clearTimeout(d);var n=i[e];if(0!==n){if(n){var a=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+a+": "+r+")",l.name="ChunkLoadError",l.type=a,l.request=r,n[1](l)}i[e]=void 0}};var d=setTimeout((function(){r({type:"timeout",target:s})}),12e4);s.onerror=s.onload=r,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e},Object.defineProperty(o,"p",{get:function(){try{if("function"!=typeof getChunkURL)throw new Error("WebpackRequireFrom: 'getChunkURL' is not a function or not available at runtime. See https://github.com/agoldis/webpack-require-from#troubleshooting");return getChunkURL()}catch(e){return""}}});var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var c=l;return r.push([303,1,2,5,3,0,4]),n()}([,,function(e,t,n){"use strict";var a,i;n(23),n(35),n(5),n(30),a=[n(104)],void 0===(i=function(e){return function(t){var n=e[t]?e[t]:t;if(1==arguments.length)return n;try{var a=arguments;return n.split("%s").map((function(e,t){return t>0?t<a.length?[a[t],e].join(""):["%s",e].join(""):e})).join("")}catch(e){return console.error(e),n}}}.apply(t,a))||(e.exports=i)},,function(e,t,n){"use strict";(function(a){var i;function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(21),n(24),n(25),n(14),n(42),n(27),n(12),n(74),n(36),n(5),n(29),n(19),n(68),n(9),n(30),n(16),void 0===(i=function(){var e=window.pgAdmin=window.pgAdmin||{};function t(e,t,n){return void 0===n||0==+n?Math[e](t):(t=+t,n=+n,isNaN(t)||n%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-n:-n)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+n:n))))}return function(e,t,n){function a(t,n,a,r){a=a||"width";var o,l,d,f=(n.match(c)||[])[2],p="px"===f?1:u[f+"toPx"];if(p||/r?em/i.test(f)&&!r)t=p?t:"rem"===f?s:"fontSize"===a&&+e.parentNode||t,p=p||parseFloat(i(t,"fontSize")),d=parseFloat(n)*p;else{l=(o=t.style)[a];try{o[a]=n}catch(e){return 0}d=o[a]?parseFloat(i(t,a)):0,o[a]=void 0!==l?l:null}return d}function i(e,t){var n,o,s,l,u,f=["paddingTop","paddingBottom","borderTop","borderBottom"],p=4;if(o=e.style["pixel"+t.charAt(0).toUpperCase()+t.slice(1)],"%"===(s=((n=d?d(e)[t]:o?o+"px":"fontSize"===t?a(e,"1em","left",1)+"px":e.currentStyle[t]).match(c)||[])[2])&&r)if(/^top|bottom/.test(t)){for(l=(u=e.parentNode||e).offsetHeight;p--;)l-=parseFloat(i(u,f[p]));n=parseFloat(n)/100*l+"px"}else n=a(e,n);else("auto"===n||s&&"px"!==s)&&d?n=0:s&&"px"!==s&&!d&&(n=a(e,n)+"px");return n}var r,o=t.createElement("test"),s=t.documentElement,l=t.defaultView,d=l&&l.getComputedStyle,c=/^(-?[\d+\.\-]+)([a-z]+|%)$/i,u={},f=[1/25.4,1/2.54,1/72,1/6],p=["mm","cm","pt","pc","in","mozmm"],h=6;for(s.appendChild(o),d&&(o.style.marginTop="1%",r="1%"===d(o).marginTop);h--;)u[p[h]+"toPx"]=f[h]?f[h]*u.inToPx:a(o,"1"+p[h]);s.removeChild(o),e.toPx=a}(e,window.document),e.natural_sort=function(e,t,n){n=n||{};var a,i,o=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,s=/(^[ ]*|[ ]*$)/g,l=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,d=/^0x[0-9a-f]+$/i,c=/^0/,u=function(e){return n.insensitive&&(""+e).toLowerCase()||""+e},f=u(e).replace(s,"")||"",p=u(t).replace(s,"")||"",h=f.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),_=p.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),g=parseInt(f.match(d))||1!==h.length&&f.match(l)&&Date.parse(f),m=parseInt(p.match(d))||g&&p.match(l)&&Date.parse(p)||null,b=n.desc?-1:1;if(m){if(g<m)return-1*b;if(g>m)return 1*b}for(var v=0,y=Math.max(h.length,_.length);v<y;v++){if(a=!(h[v]||"").match(c)&&parseFloat(h[v])||h[v]||0,i=!(_[v]||"").match(c)&&parseFloat(_[v])||_[v]||0,isNaN(a)!==isNaN(i))return(isNaN(a)?1:-1)*b;if(r(a)!==r(i)&&(a+="",i+=""),a<i)return-1*b;if(a>i)return 1*b}return 0},e.numeric_comparator=function(e,t){return(e=parseInt(e))<(t=parseInt(t))?-1:e==t?0:1},Math.round10||(Math.round10=function(e,n){return t("round",e,n)}),Math.floor10||(Math.floor10=function(e,n){return t("floor",e,n)}),Math.ceil10||(Math.ceil10=function(e,n){return t("ceil",e,n)}),e}.apply(t,[]))||(e.exports=i)}).call(this,n(4))},,function(e,t,n){"use strict";var a,i;n(5),n(9),a=[n(105)],void 0===(i=function(e){return function(t,n){var a=e[t],i=a;return a?i=i.replace(/([<])([^:^>]*:)?([^>]+)([>])/g,(function(e,t,a,i){return i in n?n[i]:e})):a}}.apply(t,a))||(e.exports=i)},,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(8),n(15),n(23),n(35),n(27),n(3),n(36),n(61),n(5),n(29),n(131),n(9),n(62),n(30),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.parseShortcutValue=function(e){var t="";e.alt&&(t+="alt+");e.shift&&(t+="shift+");e.control&&(t+="ctrl+");return t+=e.key.char.toLowerCase()},t.handleKeyNavigation=function(e){var t=(0,r.default)(e.currentTarget).find(".wizard-header"),n=(0,r.default)(e.currentTarget).find(".wizard-footer"),a=(0,r.default)(e.currentTarget).find(".select-row-cell:first"),i=(0,r.default)(e.currentTarget).find(".select-row-cell:last"),o=(0,r.default)(t).find("button:enabled:first"),s=(0,r.default)(t).find("button:enabled:last"),l=(0,r.default)(n).find("button:enabled:last"),d=(0,r.default)(n).find("button:enabled:first");e.shiftKey&&9===e.keyCode?o&&(0,r.default)(o).is((0,r.default)(e.target))?l&&((0,r.default)(l).focus(),e.preventDefault(),e.stopPropagation()):(0,r.default)(d).is((0,r.default)(e.target))&&((0,r.default)(a).find(".custom-control-input").is(":visible")?((0,r.default)(i).find(".custom-control-input").focus(),e.preventDefault(),e.stopPropagation()):(0,r.default)(e.currentTarget).find(".wizard-content").find(".CodeMirror-scroll").is(":visible")&&(0,r.default)(s).focus()):9===e.keyCode?l&&(0,r.default)(l).is((0,r.default)(e.target))?((0,r.default)(o).focus(),e.preventDefault(),e.stopPropagation()):"Name"==e.target.innerText?((0,r.default)(a).find(".custom-control-input").is(":visible")?(0,r.default)(a).find(".custom-control-input").focus():(0,r.default)(d).focus(),e.preventDefault(),e.stopPropagation()):"DIV"==e.target.tagName?((0,r.default)(e.currentTarget).find(".custom-control-input:first").trigger("focus"),e.preventDefault(),e.stopPropagation()):"TEXTAREA"==e.target.tagName&&(0,r.default)(d).focus():27===e.keyCode&&(0,r.default)(t).find("button.ajs-close").click()},t.findAndSetFocus=function(e){if(0==e.length)return;setTimeout((function(){var t=e.find("button.fa-plus:first");0==t.length&&(t=e.find("\n          .pgadmin-controls:first .btn:not(.toggle),\n          .pgadmin-controls:first,\n          .ajs-commands:first,\n          .CodeMirror-scroll,\n          .pgadmin-wizard").find('*[tabindex]:not([tabindex="-1"]),input:enabled')),t.length>0?t[0].focus():e[0].focus()}),200)},t.getEpoch=function(e){var t=e||new Date;return parseInt(t.getTime()/1e3)},t.getGCD=function(e){var t=function e(t,n){return 0==t?n:e(n%t,t)},n=e.length;if(n<=2)return t(e[0],e[1]);for(var a=e[0],i=1;i<n;i++)a=t(e[i],a);return a},t.getMod=function(e,t){return(e%t+t)%t},t.parseFuncParams=function(e){var t=[],n="",a="";if(e.endsWith("()"))n=e.substring(0,e.length-2);else if(e.endsWith(")")){if(!e.endsWith("()")&&e.endsWith(")")){var i=0,r=e.length;for(i=e.length-2;i>=0;){if("("==e[i]){r=i;break}if('"'==e[i])for(i--;'"'!=e[i];)i--;i--}n=e.substring(0,r),a=e.substring(r+1,e.length-1);var o=0,s="",l=["IN","OUT","INOUT","VARIADIC"];for(i=0;i<a.length;){if('"'==a[i])for(i++;'"'!=a[i];)i++;else" "==a[i]?(""==s||l.indexOf(s)>-1)&&(s=a.substring(o,i),o=i+1):","==a[i]&&(t.push([s,a.substring(o,i)]),s="",o=i+1);i++}t.push([s,a.substring(o)])}}else n=e;return{func_name:n,param_string:a,params:t}},t.quote_ident=s,t.fully_qualify=function(e,t,n){var a=i.getTreeNodeHierarchyFromIdentifier.call(e,n),r="";void 0!==a.schema?r=s(a.schema._label):void 0!==a.view?r=s(a.view._label):void 0!==a.catalog&&(r=s(a.catalog._label));void 0!==a.package&&"package"!=t._type&&(""==r?r=s(a.package._label):r+="."+s(a.package._label));return""!=r?r+"."+s(t._label):s(t._label)},t.getRandomInt=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},t.titleize=function(e){return""===e||null===e?e:e.split(" ").map((function(e){return e[0].toUpperCase()+e.substr(1).toLowerCase()})).join(" ")},t.sprintf=function(e){try{var t=arguments;return e.split("%s").map((function(e,n){return n>0?n<t.length?[t[n],e].join(""):["%s",e].join(""):e})).join("")}catch(t){return console.error(t),e}},t.CSVToArray=function(e,t,n){t=t||",",n=n||'"';var a=new RegExp("(\\"+t+"|\\r?\\n|\\r|^)"+('"'==n?'(?:"([^"]*(?:""[^"]*)*)"|':"(?:'([^']*(?:''[^']*)*)'|")+('"'==n?'([^"\\'+t+"\\r\\n]*))":"([^'\\"+t+"\\r\\n]*))"),"gi"),i=[[]],r=null;for(;r=a.exec(e);){var o,s=r[1];s.length&&s!==t&&i.push([]),o=r[2]?r[2].replace(new RegExp(n+n,"g"),n):r[3],i[i.length-1].push(o)}return i},t.isString=t.isFunction=t.isValidData=void 0;var a=o(n(1)),i=n(51),r=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}t.isValidData=function(e){return!a.default.isUndefined(e)&&!a.default.isNull(e)};t.isFunction=function(e){return a.default.isFunction(e)};function s(e){var t=!1;return isNaN(parseInt(e))||(t=!0),e.search(/[^a-z0-9_]/g)>-1&&(e=e.replace(/"/g,'""'),t=!0),t?'"'.concat(e,'"'):e}t.isString=function(e){return a.default.isString(e)}},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(){var e=null;try{e=window.opener&&window.opener.pgAdmin?function e(t){return t.opener&&t.opener.pgAdmin?e(t.opener):t}(window.opener):window.parent&&window.parent.pgAdmin?window.parent:window.top&&window.top.pgAdmin?window.top:window}catch(t){e=window}return e}();t.default=a},,,,,,,,,,,,function(e,t,n){"use strict";(function(e){function a(t){var n=0,a=0,r={};do{var o=t.getData();if(o._type in this.Nodes&&this.Nodes[o._type].hasId){var s=i(o._type,a);void 0===r[s]&&(r[s]=e.extend({},o,{priority:n}),n-=1)}a+=1,t=t.hasParent()?t.parent():null}while(t);return r}function i(e,t){return"partition"===e&&t>0?"table":e}n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.getTreeNodeHierarchyFromElement=function(e,t){return a.call(e,t)},t.getTreeNodeHierarchyFromIdentifier=function(e){var t=this.treeMenu.translateTreeNodeIdFromACITree(e),n=this.treeMenu.findNode(t);return null===n?null:a.call(this,n)},t.getTreeNodeHierarchy=a}).call(this,n(1))},,,,,,,function(e,t,n){"use strict";(function(a){var i,r;n(31),n(177),n(41),n(123),n(40),n(18),n(46),i=[n(107)],void 0===(r=function(){var e=window.Slick,t=function(e,t){return e.fromCell==t.fromCell&&e.toCell==t.toCell&&e.fromRow==t.fromRow&&e.toRow==t.toRow},n=function(t){return new e.Range(0,1,t.getDataLength()-1,t.getColumns().length-1)},i=function(e){return!a.isUndefined(e[0].pos)},r=function(e,t){return t.fromCell==t.toCell&&0==t.fromRow&&t.toRow==e.getDataLength()-1},o=function(e,t){return 0===t.fromRow&&t.toRow===e.getDataLength()-1},s=function(e,t){return t.fromCell===function(e){return a.findIndex(e.getColumns(),(function(e){var t=e.pos;return!a.isUndefined(t)&&l(e)}))}(e)&&t.toCell===function(e){return a.findLastIndex(e.getColumns(),l)}(e)};function l(e){return a.isUndefined(e.selectable)||!0===e.selectable}return{addRange:function(e,t){return e.push(t),e},removeRange:function(e,n){return a.filter(e,(function(e){return!t(e,n)}))},isRangeSelected:function(e,n){return a.any(e,(function(e){return t(e,n)}))},areAllRangesSingleRows:function(e,t){return a.every(e,(function(e){return e.fromRow==e.toRow&&s(t,e)}))},areAllRangesSingleColumns:function(e,t){return a.every(e,r.bind(this,t))},areAllRangesCompleteRows:function(e,t){return a.every(t,(function(t){return s(e,t)}))},areAllRangesCompleteColumns:function(e,t){return a.every(t,(function(t){return o(e,t)}))},rangeForRow:function(t,n){var a=t.getColumns();return i(a)?new e.Range(n,0,n,t.getColumns().length-1):new e.Range(n,1,n,t.getColumns().length-1)},rangeForColumn:function(t,n){return new e.Range(0,n,t.getDataLength()-1,n)},isEntireGridSelected:function(e){var a=e.getSelectionModel().getSelectedRanges();return 1==a.length&&t(a[0],n(e))},getRangeOfWholeGrid:n,isFirstColumnData:i,getIndexesOfCompleteRows:function(e,t){var n=[];return t.forEach((function(t){s(e,t)&&(n=n.concat(a.range(t.fromRow,t.toRow+1)))})),n},selectAll:function(e){var t=n(e);e.getSelectionModel().setSelectedRanges([t])},isRangeAColumn:r,rangeHasCompleteColumns:o,rangeHasCompleteRows:s,isAnyCellOfColumnSelected:function(e,t){return a.any(e,(function(e){return e.fromCell<=t&&e.toCell>=t}))},isRangeEntirelyWithinSelectedRanges:function(e,t){return a.any(e,(function(e){return e.fromCell<=t.fromCell&&e.toCell>=t.toCell&&e.fromRow<=t.fromRow&&e.toRow>=t.toRow}))},isAnyCellOfRowSelected:function(e,t){return a.any(e,(function(e){return e.fromRow<=t&&e.toRow>=t}))}}}.apply(t,i))||(e.exports=r)}).call(this,n(1))},,,,,function(e,t,n){"use strict";var a,i;n(23),n(42),n(152),n(74),n(5),n(9),a=[n(0),n(1),n(2),n(6)],void 0===(i=function(e,t,n,a){var i={epicRandomString:function(e){for(var t=[],n=0;n<36;n++)t[n]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("").replace(/-/g,"").substr(0,e)},getHash:function(e){for(var t=0,n=e.length,a=0;a<n;a++)t=(t<<5)-t+e.charCodeAt(a),t|=0;return t},calculateColumnWidth:function(t){e("body").append('<span id="pg_text" style="visibility: hidden;">'+t+"</span>");var n=e("#pg_text").width()+23;return e("#pg_text").remove(),n},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},previousStatus:null,fetchConnectionStatus:function(t,r,o){var s=a("sqleditor.connection_status",{trans_id:t.transId});if("visible"===document.visibilityState&&"visible"===r.data("panel-visible")&&!o.hasClass("obtaining-conn")){var l=t;e.ajax({url:s,method:"GET"}).done((function(e){if(e&&e.data){var t=e.data.status,a=e.data.message,s=!1;switch(l.update_notifications(e.data.notifies),t){case 1:t!=i.previousStatus||o.hasClass("fa-hourglass-half")||(o.removeClass().addClass("fa fa-hourglass-half"),s=!0);break;case 2:i.previousStatus==t||o.hasClass("fa-clock")||(o.removeClass().addClass("fa fa-clock"),s=!0);break;case 3:i.previousStatus==t||o.hasClass("fa-exclamation-circle")||(o.removeClass().addClass("fa fa-exclamation-circle"),s=!0);break;case 4:i.previousStatus==t||o.hasClass("fa-exclamation-triangle")||(o.removeClass().addClass("fa fa-exclamation-triangle"),s=!0);break;default:i.previousStatus==t||o.hasClass("fa-query_tool_connected")||(o.removeClass().addClass("pg-font-icon icon-query-tool-connected"),s=!0)}i.previousStatus=t,s&&(r.popover("hide"),r.attr("data-content",a))}else i.previousStatus=-99,a=n("An unexpected error occurred - ensure you are logged into the application."),r.attr("data-content",a),o.hasClass("icon-query-tool-disconnected")||(r.popover("hide"),o.removeClass().addClass("pg-icon-font icon-query-tool-disconnected"))})).fail((function(e){i.previousStatus=-1;var t=n("Transaction status check failed.");0==e.readyState?t=n("Not connected to the server or the connection to the server has been closed."):e.responseJSON&&e.responseJSON.errormsg&&(t=e.responseJSON.errormsg),r.attr("data-content",t),o.hasClass("icon-query-tool-disconnected")||(r.popover("hide"),o.removeClass().addClass("pg-font-icon icon-query-tool-disconnected"))}))}},updateConnectionStatusFlag:function(t){var n=e(".connection_status");n.data("panel-visible")!=t&&n.data("panel-visible",t)},calcFontSize:function(e){if(e){e=parseFloat(Math.round(parseFloat(e+"e+2"))+"e-2");var t=Number(e);if(t>0)return t+"em"}return"1em"},addEditableIcon:function(e,n){var a={cssClass:"editable-column-header-icon",content:n?'<i class="fa fa-pencil-alt"></i>':'<i class="fa fa-lock"></i>'};t.isUndefined(e.header)||t.isUndefined(e.header.buttons)?e.header={buttons:[a]}:e.header.buttons.push(a)}};return i}.apply(t,a))||(e.exports=i)},,function(e,t,n){"use strict";(function(e){n(10),n(3),n(61),n(5),n(29),n(9),Object.defineProperty(t,"__esModule",{value:!0}),t.getDatabaseLabel=o,t.getPanelTitle=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.get_preferences_for_module("browser");null==n&&(n=t.treeMenu.selected());var d=i.getTreeNodeHierarchyFromIdentifier.call(t,n);if(s(d))return;var c=o(d),u="";u=a||r.qt_tab_title_placeholder;var f={database:c,username:d.server.user.name,server:d.server.label,type:"query_tool"},p=l(u,f);return e.escape(p)},t.setQueryToolDockerTitle=function(t,n,a,i){var o="",s="";i||"true"==i?(s=(0,r.default)("File - ")+a,o="fa fa-file-alt"):"false"==n||0==n?(s=(0,r.default)("View/Edit Data - ")+a,o="pg-font-icon icon-view-data"):(s=(0,r.default)("Query Tool - ")+a,o="pg-font-icon icon-query-tool");t.title('<span title="'+e.escape(s)+'">'+e.escape(a)+"</span>"),t.icon(o)},t.generateTitle=l;var a,i=n(51),r=(a=n(2))&&a.__esModule?a:{default:a};function o(e){return e.database?e.database.label:e.server.db}function s(e){return void 0===e.server}function l(t,n){return"query_tool"==n.type?t=(t=(t=t.replace(new RegExp("%DATABASE%"),n.database)).replace(new RegExp("%USERNAME%"),n.username)).replace(new RegExp("%SERVER%"),n.server):"datagrid"==n.type?t=(t=(t=(t=(t=t.replace(new RegExp("%DATABASE%"),n.database)).replace(new RegExp("%USERNAME%"),n.username)).replace(new RegExp("%SERVER%"),n.server)).replace(new RegExp("%SCHEMA%"),n.schema)).replace(new RegExp("%TABLE%"),n.table):"debugger"==n.type&&(t=(t=(t=(t=t.replace(new RegExp("%FUNCTION%"),n.function_name)).replace(new RegExp("%ARGS%"),n.args)).replace(new RegExp("%SCHEMA%"),n.schema)).replace(new RegExp("%DATABASE%"),n.database)),e.escape(t)}}).call(this,n(1))},,,,,,,,,,,,,function(e,t,n){"use strict";n(31),n(41),n(8),n(3),n(5),n(62),Object.defineProperty(t,"__esModule",{value:!0}),t.processEventDebugger=function(e,t,n,i){var r,o,s="";this.validateShortcutKeys(n.edit_grid_values,t)?(this._stopEventPropagation(t),(r=e.find('div.wcPanelTabContent:not(".wcPanelTabContentHidden")')).length&&(o=(0,a.default)(r).find("td.editable:first")).length&&o.trigger("click")):this.validateShortcutKeys(n.move_next,t)?(this._stopEventPropagation(t),s=l(i,"right")):this.validateShortcutKeys(n.move_previous,t)?(this._stopEventPropagation(t),s=l(i,"left")):this.validateShortcutKeys(n.switch_panel,t)&&(this._stopEventPropagation(t),s=l(i,"switch"));return s},t.processEventQueryTool=function(e,t,n,i){if(e.isQueryRunning())return;var r=n.which||n.keyCode,o="",s=e.preferences.execute_query,d=e.preferences.explain_query,c=e.preferences.explain_analyze_query,u=e.preferences.download_csv,f=e.preferences.move_next,p=e.preferences.move_previous,h=e.preferences.switch_panel,_=e.preferences.toggle_case,g=e.preferences.commit_transaction,m=e.preferences.rollback_transaction,b=e.preferences.save_data,v=e.preferences.show_query_tool;if(this.validateShortcutKeys(s,n))this._stopEventPropagation(n),t.executeQuery(e);else if(this.validateShortcutKeys(d,n))this._stopEventPropagation(n),t.explain(e);else if(this.validateShortcutKeys(c,n))this._stopEventPropagation(n),t.explainAnalyze(e);else if(this.validateShortcutKeys(u,n))this._stopEventPropagation(n),t.download(e);else if(this.validateShortcutKeys(_,n))this._stopEventPropagation(n),t.toggleCaseOfSelectedText(e);else if(this.validateShortcutKeys(g,n))e.is_transaction_buttons_disabled||(this._stopEventPropagation(n),t.executeCommit(e));else if(this.validateShortcutKeys(m,n))e.is_transaction_buttons_disabled||(this._stopEventPropagation(n),t.executeRollback(e));else if(this.validateShortcutKeys(b,n))this._stopEventPropagation(n),t.saveDataChanges(e);else if(this.validateShortcutKeys(v,n))this._stopEventPropagation(n),t.openQueryTool(e);else if((this.isMac()&&n.metaKey||!this.isMac()&&n.ctrlKey)&&!n.altKey&&n.shiftKey&&191===r)this._stopEventPropagation(n),t.commentBlockCode(e);else if((this.isMac()&&!this.isKeyCtrlAltShift(n)&&n.metaKey||!this.isMac()&&!this.isKeyAltShift(n)&&n.ctrlKey)&&191===r)this._stopEventPropagation(n),t.commentLineCode(e);else if((this.isMac()&&!this.isKeyCtrlAltShift(n)&&n.metaKey||!this.isMac()&&!this.isKeyAltShift(n)&&n.ctrlKey)&&190===r)this._stopEventPropagation(n),t.uncommentLineCode(e);else if((this.isMac()&&n.metaKey||!this.isMac()&&n.ctrlKey)&&!n.altKey&&n.shiftKey&&75===r)this._stopEventPropagation(n),t.formatSql(e);else if(27==r)t.focusOut(e),(0,a.default)(n.target).hasClass("dropdown-item")&&(0,a.default)(n.target).closest(".dropdown-submenu").length>0&&(0,a.default)(n.target).closest(".dropdown-submenu").find(".dropdown-menu").removeClass("show");else if(this.validateShortcutKeys(f,n))this._stopEventPropagation(n),o=l(i,"right");else if(this.validateShortcutKeys(p,n))this._stopEventPropagation(n),o=l(i,"left");else if(this.validateShortcutKeys(h,n))this._stopEventPropagation(n),o=l(i,"switch");else if(38===r||40===r){if((0,a.default)(n.target).closest(".dropdown-menu").length>0){this._stopEventPropagation(n);var y=(0,a.default)(n.target).closest("li");for((0,a.default)(n.target).closest(".dropdown-menu").find(".show").removeClass("show"),38===r?y=y.prev():40===r&&(y=y.next());y.hasClass("dropdown-divider")||y.hasClass("d-none")||y.find(".dropdown-item").first().hasClass("disabled");)38===r?y=y.prev():40===r&&(y=y.next());y.find(".dropdown-item").trigger("focus")}}else if(37===r||39===r){if((0,a.default)(n.target).closest(".dropdown-menu").length>0){this._stopEventPropagation(n);var w=(0,a.default)(n.target).closest("li");if(39===r)w.hasClass("dropdown-submenu")&&(w.find(".dropdown-menu").addClass("show"),w.find(".dropdown-menu .dropdown-item").first().trigger("focus"));else if(37===r){var x=w.closest(".dropdown-menu");x.closest(".dropdown-submenu").length>0&&(x.removeClass("show"),(w=x.closest(".dropdown-submenu")).find(".dropdown-item").trigger("focus"))}}}else{var C=this.validateMacros(e,n);!1!==C&&(this._stopEventPropagation(n),t.executeMacro(e,C))}return o},t.focusDockerPanel=l,t.validateShortcutKeys=function(e,t){if(!e)return!1;var n=t.which||t.keyCode;return e.alt==t.altKey&&e.shift==t.shiftKey&&e.control==t.ctrlKey&&e.key.key_code==n},t.validateMacros=function(e,t){var n=t.which||t.keyCode,a=e.macros.filter((function(e){return e.alt==t.altKey&&e.control==t.ctrlKey&&e.key_code==n}));if(1==a.length)return a[0].id;return!1},t._stopEventPropagation=function(e){e.cancelBubble=!0,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()},t.isMac=function(){return-1!=window.navigator.platform.search("Mac")},t.isKeyCtrlAlt=function(e){return e.ctrlKey||e.altKey},t.isKeyAltShift=function(e){return e.altKey||e.shiftKey},t.isKeyCtrlShift=function(e){return e.ctrlKey||e.shiftKey},t.isKeyCtrlAltShift=function(e){return e.ctrlKey||e.altKey||e.shiftKey},t.isAltShiftBoth=function(e){return e.altKey&&e.shiftKey&&!e.ctrlKey},t.isCtrlShiftBoth=function(e){return e.ctrlKey&&e.shiftKey&&!e.altKey},t.isCtrlAltBoth=function(e){return e.ctrlKey&&e.altKey&&!e.shiftKey},t.shortcut_key=s,t.shortcut_title=function(e,t){var n="";if(null==t)return n;t.alt&&(n=(0,i.default)("Alt")+"+");t.shift&&(n+=(0,i.default)("Shift")+"+");t.control&&(n+=(0,i.default)("Ctrl")+"+");return n+=s(t),"".concat(e," (").concat(n,")")},t.shortcut_accesskey_title=function(e,t){return"".concat(e," (")+(0,i.default)("accesskey")+" + ".concat(s(t),")")};var a=o(n(0)),i=o(n(2)),r=n(22);function o(e){return e&&e.__esModule?e:{default:e}}function s(e){var t="";return e.key&&e.key.char&&(t=e.key.char.toUpperCase()),t}function l(e,t){if(e){if(!e._focusFrame){if(0==e._frameList.length&&0==e._frameList[0]._panelList.length)return;e._frameList[0]._panelList[e._frameList[0]._curTab].focus()}var n=e._focusFrame,a=0,i=!1;if("switch"==t){var o,s=e._frameList.length;for(o=0;o<s&&n!==e._frameList[o];o++);a=(n=e._frameList[(0,r.getMod)(o+1,s)])._curTab,i=!0}else"left"==t?a=(0,r.getMod)(n._curTab-1,n._panelList.length):"right"==t&&(a=(0,r.getMod)(n._curTab+1,n._panelList.length));var l=n._panelList[a];return l.$container.find('*[tabindex]:not([tabindex="-1"])').trigger("focus"),l.focus(i),l._type}}},,,,,,,,,,,function(e,t,n){"use strict";n(3),n(12),n(98),Object.defineProperty(t,"__esModule",{value:!0}),t.setPGCSRFToken=function(e,t){if(!t)throw"csrf-token meta tag has not been set";var n=i.default.sync;i.default.sync=function(a,i,r){return r.beforeSend=function(n){n.setRequestHeader(e,t)},n(a,i,r)};var o=i.default.get;i.default.get=function(n,a,i){return i.beforeSend=function(n){n.setRequestHeader(e,t)},o(n,a,i)},a.default.ajaxSetup({beforeSend:function(n){n.setRequestHeader(e,t)}}),r.default.interceptors.request.use((function(n){return n.headers[e]=t,n}),(function(e){return Promise.reject(e)}))};var a=o(n(0)),i=o(n(20)),r=o(n(54));function o(e){return e&&e.__esModule?e:{default:e}}},,,function(e,t,n){"use strict";n(31),n(40),n(3),n(46),Object.defineProperty(t,"__esModule",{value:!0}),t.showQueryTool=function(e,t,n,s,l,d){var u=s||"",f=function(e,t){return(0,o.getPanelTitle)(e,t)}(t,l);if(void 0===t.treeMenu.findNodeByDomElement(l))return void n.alert((0,a.default)("Query Tool Error"),(0,a.default)("No object selected."));var p=r.getTreeNodeHierarchyFromIdentifier.call(t,l);if(function(e){return void 0===e.server}(p))return;var h=function(e,t,n){var a=(0,i.default)("datagrid.panel",{trans_id:e});a+="?is_query_tool=".concat(!0)+"&sgid=".concat(n.server_group._id)+"&sid=".concat(n.server._id)+"&server_type=".concat(n.server.server_type),function(e){return e.database}(n)&&(a+="&did=".concat(n.database._id));return a}(d,0,p);c(e,d,h,f,u,n)},t.generateScript=function(e,t,n){var a="".concat(e.database,"/").concat(e.user,"@").concat(e.server),r=(0,s.getRandomInt)(1,9999999),o=(0,i.default)("datagrid.panel",{trans_id:r});o+="?is_query_tool=".concat(!0)+"&sgid=".concat(e.sgid)+"&sid=".concat(e.sid)+"&server_type=".concat(e.stype)+"&did=".concat(e.did),c(t,r,o,a,"",n)},t.launchDataGrid=c,t._set_dynamic_tab=function(e,t){e.docker.findPanels("frm_datagrid").forEach((function(e){t?(0,l.default)("#"+e.$title.index()+" div:first").addClass("wcPanelTab-dynamic"):(0,l.default)("#"+e.$title.index()+" div:first").removeClass("wcPanelTab-dynamic")})),e.docker.findPanels("frm_debugger").forEach((function(e){t?(0,l.default)("#"+e.$title.index()+" div:first").addClass("wcPanelTab-dynamic"):(0,l.default)("#"+e.$title.index()+" div:first").removeClass("wcPanelTab-dynamic")}))};var a=d(n(2)),i=d(n(6)),r=n(51),o=n(65),s=n(22),l=d(n(0));function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,i,r,o){e.launch_grid(t,n,!0,i,r)||o.alert((0,a.default)("Query tool launch error"),(0,a.default)("Please allow the pop-ups for this site to perform the desired action. If the main window of pgAdmin is closed then close this window and open a new pgAdmin session."))}},,,,,,,function(e,t,n){"use strict";n(8);var a=o(n(0)),i=o(n(1)),r=o(n(39));function o(e){return e&&e.__esModule?e:{default:e}}e.exports={modifyAcitreeAnimation:function(e,t){var n=e.get_preference("browser","enable_acitree_animation").value;i.default.isUndefined(t)&&(t=e.tree),n?t.options({animateRoot:!0,unanimated:!1,show:i.default.extend(t.options().show,{duration:75}),hide:i.default.extend(t.options().hide,{duration:75}),view:i.default.extend(t.options().view,{duration:75})}):t.options({animateRoot:!1,unanimated:!0,show:i.default.extend(t.options().show,{duration:0}),hide:i.default.extend(t.options().hide,{duration:0}),view:i.default.extend(t.options().view,{duration:0})})},modifyAlertifyAnimation:function(e){(i.default.isUndefined(e)||i.default.isNull(e))&&(e=r.default.pgAdmin.Browser),e.get_preference("browser","enable_alertify_animation").value?((0,a.default)(document).find("body").removeClass("alertify-no-animation"),i.default.each(document.getElementsByTagName("iframe"),(function(e){(0,a.default)(e.contentDocument).find("body").removeClass("alertify-no-animation")}))):((0,a.default)(document).find("body").addClass("alertify-no-animation"),i.default.each(document.getElementsByTagName("iframe"),(function(e){(0,a.default)(e.contentDocument).find("body").addClass("alertify-no-animation")})))}}},,,,,function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.getTransId=function(e){return i.default.ajax({data:e,type:"POST",async:!1,url:(0,a.default)("file_manager.get_trans_id"),dataType:"json",contentType:"application/json; charset=utf-8"})},t.removeTransId=function(e){return i.default.ajax({type:"GET",async:!1,url:(0,a.default)("file_manager.delete_trans_id",{trans_id:e}),dataType:"json",contentType:"application/json; charset=utf-8"})},t.set_last_traversed_dir=function(e,t){return i.default.ajax({url:(0,a.default)("file_manager.save_last_dir",{trans_id:t}),type:"POST",data:JSON.stringify(e),contentType:"application/json"})};var a=r(n(6)),i=r(n(0));function r(e){return e&&e.__esModule?e:{default:e}}},,,function(e,t){e.exports=n},,,,,,,,function(e,t,n){"use strict";n(123),n(10),n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.initializeToolbar=function(e,t){l=e,i.default.each(d,(function(e){u(e)})),i.default.each(c,(function(e){u(e)})),e.on(t.EVENT.BUTTON,(function(e){"name"in e&&e.name===(0,a.default)("Query Tool")?r.default.DataGrid.show_query_tool("",r.default.Browser.tree.selected()):"name"in e&&e.name===(0,a.default)("View Data")?r.default.DataGrid.show_data_grid({mnuid:3},r.default.Browser.tree.selected()):"name"in e&&e.name===(0,a.default)("Filtered Rows")?r.default.DataGrid.show_filtered_row({mnuid:4},r.default.Browser.tree.selected()):"name"in e&&e.name===(0,a.default)("Search objects")&&r.default.SearchObjects.show_search_objects("",r.default.Browser.tree.selected())}))},t.enable=function(e,t){e in s?l.buttonEnable(e,t):console.warn("Developer warning: No tool button found with label: "+e)};var a=o(n(2)),i=o(n(1)),r=o(n(4));function o(e){return e&&e.__esModule?e:{default:e}}var s={},l=null,d=[{label:(0,a.default)("Query Tool"),ariaLabel:(0,a.default)("Query Tool"),btnClass:"pg-font-icon icon-query-tool",text:"",toggled:!1,toggleClass:"",parentClass:"pg-toolbar-btn btn-primary-icon",enabled:!1},{label:(0,a.default)("View Data"),ariaLabel:(0,a.default)("View Data"),btnClass:"pg-font-icon sql-icon-lg icon-view-data",text:"",toggled:!1,toggleClass:"",parentClass:"pg-toolbar-btn btn-primary-icon",enabled:!1},{label:(0,a.default)("Filtered Rows"),ariaLabel:(0,a.default)("Filtered Rows"),btnClass:"pg-font-icon icon-filter-table-toolbar",text:"",toggled:!1,toggleClass:"",parentClass:"pg-toolbar-btn btn-primary-icon",enabled:!1},{label:(0,a.default)("Search objects"),ariaLabel:(0,a.default)("Search objects"),btnClass:"fa fa-search",text:"",toggled:!1,toggleClass:"",parentClass:"pg-toolbar-btn btn-primary-icon",enabled:!1}],c=[];function u(e){(!(e.label in s)||i.default.findIndex(l._buttonList,{name:e.label})<0)&&(l.addButton(e.label,e.btnClass,e.text,e.label,e.toggled,e.toggleClass,e.parentClass,e.enabled,e.ariaLabel),s[e.label]=e)}},,function(e,t,n){"use strict";var a,i;a=[n(2),n(52)],void 0===(i=function(e,t){return{copyTextToClipboard:function(n){var a=document.createElement("textarea");a.style.position="fixed",a.style.top=0,a.style.left=0,a.style.width="2em",a.style.height="2em",a.style.padding=0,a.style.border="none",a.style.outline="none",a.style.boxShadow="none",a.style.background="transparent",document.body.appendChild(a),a.select();document.addEventListener("copy",(function e(t){document.removeEventListener("copy",e);var a=t.clipboardData||window.clipboardData;a&&(a.setData("text",n),window.parent.window.clipboardData=n,t.preventDefault())}));try{document.execCommand("copy")}catch(n){t.alert(e("Error"),e("Oops, unable to copy to clipboard"))}document.body.removeChild(a)},getTextFromClipboard:function(){return window.parent.window.clipboardData||""}}}.apply(t,a))||(e.exports=i)},,,,,function(e,t,n){"use strict";n(8),n(18),n(3),n(7);var a=o(n(0)),i=o(n(118)),r=n(22);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var l=function(){function e(t,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dialogContainer=t,this.tabSwitching=!1,this.tabs=this.dialogContainer.find(".nav-tabs:visible"),this.tabs.length>0&&(this.tabs=this.tabs[0]),this.dialogTabBackward=(0,r.parseShortcutValue)(n),this.dialogTabForward=(0,r.parseShortcutValue)(a),(0,i.default)(this.dialogContainer[0]).bind(this.dialogTabBackward,this.onKeyboardEvent.bind(this)),(0,i.default)(this.dialogContainer[0]).bind(this.dialogTabForward,this.onKeyboardEvent.bind(this))}var t,n,o;return t=e,(n=[{key:"onKeyboardEvent",value:function(e,t){var n=this.dialogContainer.find(".tab-content:first > .tab-pane.active:first:visible"),a=this.isActivePaneHasChildTabs(n);this.tabSwitching||(this.tabSwitching=!0,a&&this.navigate(t,a.childTab,a.childTabPane,e)||this.navigate(t,this.tabs,n,e))}},{key:"isActivePaneHasChildTabs",value:function(e){var t=e.find(".nav-tabs:first:visible");return t.length>0?{childTab:t,childTabPane:e.find(".tab-content:first > .tab-pane.active:first:visible")}:null}},{key:"navigate",value:function(e,t,n,a){return e==this.dialogTabBackward?this.navigateBackward(t,n,a):e==this.dialogTabForward&&this.navigateForward(t,n,a)}},{key:"navigateBackward",value:function(e,t,n){var i,o,s=this,l=(0,a.default)(e).find("li").has("a.active").prev("li");return l.length>0?(l.find("a").tab("show"),(o=(i=t.prev()).find(".tab-content:first > .tab-pane.active:first:visible")).length>0?(0,r.findAndSetFocus)(o):(0,r.findAndSetFocus)(i),setTimeout((function(){s.tabSwitching=!1}),200),n.stopPropagation(),!0):(this.tabSwitching=!1,!1)}},{key:"navigateForward",value:function(e,t,n){var i,o,s=this,l=(0,a.default)(e).find("li").has("a.active").next("li");return l.length>0?(l.find("a").tab("show"),(o=(i=t.next()).find(".tab-content:first > .tab-pane.active:first:visible")).length>0?(0,r.findAndSetFocus)(o):(0,r.findAndSetFocus)(i),setTimeout((function(){s.tabSwitching=!1}),200),n.stopPropagation(),!0):(this.tabSwitching=!1,!1)}},{key:"detach",value:function(){(0,i.default)(this.dialogContainer[0]).unbind(this.dialogTabBackward),(0,i.default)(this.dialogContainer[0]).unbind(this.dialogTabForward)}}])&&s(t.prototype,n),o&&s(t,o),e}();e.exports={dialogTabNavigator:l}},function(e,t,n){"use strict";var a,i;function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}return n}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}n(21),n(24),n(25),n(8),n(85),n(66),n(15),n(59),n(14),n(23),n(42),n(37),n(27),n(10),n(12),n(5),n(29),n(67),n(19),n(9),n(16),n(7),n(38),a=[n(2),n(6),n(0),n(1),n(13),n(11),n(20),n(69),n(82),n(91),n(17),n(109),n(22),n(158),n(154)],void 0===(i=function(e,t,n,a,i,s,l,d,c,u,f,p,h){if(s.UserManagement)return s.UserManagement;var _=t("user_management.users"),g=t("user_management.roles"),m=t("user_management.auth_sources"),b=!(1!=p.auth_sources.length||!p.auth_sources.includes("internal")),v=d.Extension.PasswordDepCell=d.Extension.PasswordCell.extend({initialize:function(){d.Extension.PasswordCell.prototype.initialize.apply(this,arguments),d.Extension.DependentCell.prototype.initialize.apply(this,arguments)},dependentChanged:function(){this.$el.empty(),this.render();var e=this.model,t=this.column,n=this.column.get("editable");return(a.isFunction(n)?!!n.apply(t,[e]):!!n)?this.$el.addClass("editable"):this.$el.removeClass("editable"),this.delegateEvents(),this},render:function(){d.NumberCell.prototype.render.apply(this,arguments);var e=this.model,t=this.column,n=this.column.get("editable"),i=a.isFunction(n)?!!n.apply(t,[e]):!!n;return i?this.$el.addClass("editable"):this.$el.removeClass("editable"),this},remove:d.Extension.DependentCell.prototype.remove});return s.UserManagement={init:function(){if(!this.initialized)return this.initialized=!0,this},change_password:function(n){var a=e("Change Password");i.ChangePassword||i.dialog("ChangePassword",(function(){return{main:function(e,t){this.set({title:e,url:t})},build:function(){i.pgDialogBuild.apply(this)},settings:{url:void 0},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-primary-icon pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:e("Change Password"),url:t("help.static",{filename:"change_user_password.html"})}},{text:e("Close"),key:27,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button",attrs:{name:"close",type:"button"}}],options:{padding:!1,overflow:!1,modal:!1,resizable:!0,maximizable:!0,pinnable:!1,closableByDimmer:!1,closable:!1}}},hooks:{onclose:function(){return setTimeout((function(){return i.ChangePassword().destroy()}),500)}},prepare:function(){var e=document.createElement("iframe");e.frameBorder="no",e.width="100%",e.height="100%",e.src=this.setting("url"),this.elements.content.appendChild(e)},callback:function(e){if("dialog_help"==e.button.element.name)return e.cancel=!0,void s.showHelp(e.button.element.name,e.button.element.getAttribute("url"),null,null)}}})),i.ChangePassword(a,n).resizeTo(s.stdW.lg,s.stdH.md)},isPgaLoginRequired:function(e){return void 0===e.responseJSON&&void 0!==e.data?401===e.status&&e.data&&e.data.info&&"PGADMIN_LOGIN_REQUIRED"===e.data.info:401===e.status&&e.responseJSON&&e.responseJSON.info&&"PGADMIN_LOGIN_REQUIRED"===e.responseJSON.info},pgaLogin:function(n){var a=e("pgAdmin 4 login");n=n||t("security.login"),i.PgaLogin||i.dialog("PgaLogin",(function(){return{main:function(e,t){this.set({title:e,url:t})},build:function(){i.pgDialogBuild.apply(this)},settings:{url:void 0},setup:function(){return{buttons:[{text:e("Close"),key:27,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button",attrs:{name:"close",type:"button"}}],options:{padding:!1,overflow:!1,modal:!0,resizable:!0,maximizable:!0,pinnable:!1,closableByDimmer:!1,closable:!1}}},hooks:{onclose:function(){return setTimeout((function(){return i.PgaLogin().destroy()}))}},prepare:function(){var e=this,t=document.createElement("iframe"),n=this.setting("url");t.onload=function(){-1==(this.contentDocument||this.contentWindow.document).location.href.indexOf(n)&&(this.contentWindow.stop(),this.onload=null,e.close(),s.Events.trigger("pgadmin:user:logged-in"))},t.frameBorder="no",t.width="100%",t.height="100%",t.src=n,e.elements.content.appendChild(t)}}})),i.PgaLogin(a,n).resizeTo(s.stdW.md,s.stdH.md)},show_users:function(){if(p.is_admin){var u=[],f=[],y=s.Node.Model.extend({idAttribute:"id",urlRoot:_,defaults:{id:void 0,username:void 0,email:void 0,active:!0,role:"2",newPassword:void 0,confirmPassword:void 0,auth_source:"internal",authOnlyInternal:b},schema:[{id:"auth_source",label:e("Authentication source"),type:"text",control:"Select2",url:t("user_management.auth_sources"),cellHeaderClasses:"width_percent_30",visible:function(e){return!e.get("authOnlyInternal")},disabled:!1,cell:"Select2",select2:{allowClear:!1,openOnEnter:!1,first_empty:!1},options:function(){return f},editable:function(e){return e instanceof l.Collection||e.isNew()&&!e.get("authOnlyInternal")}},{id:"username",label:e("Username"),type:"text",cell:d.Extension.StringDepCell,cellHeaderClasses:"width_percent_30",deps:["auth_source"],editable:function(e){return!e.get("authOnlyInternal")&&"internal"!=e.get("auth_source")||(e.isNew()&&null!=e.get("username")&&""!=e.get("username")&&setTimeout((function(){e.set("username",void 0)}),10),!1)},disabled:!1},{id:"email",label:e("Email"),type:"text",cell:d.Extension.StringDepCell,cellHeaderClasses:"width_percent_30",deps:["id"],editable:function(e){return!e.get("authOnlyInternal")||!(e instanceof l.Collection)&&!!e.isNew()}},{id:"role",label:e("Role"),type:"text",control:"Select2",cellHeaderClasses:"width_percent_20",cell:"select2",select2:{allowClear:!1,openOnEnter:!1,first_empty:!1},options:function(e){var t=[];return e instanceof c.Control?a.each(u,(function(e){t.push({label:e.name,value:e.id.toString()})})):a.each(u,(function(e){t.push([e.name,e.id.toString()])})),t},editable:function(e){return e instanceof l.Collection||e.get("id")!=p.id}},{id:"active",label:e("Active"),type:"switch",cell:"switch",cellHeaderClasses:"width_percent_10",sortable:!1,editable:function(e){return e instanceof l.Collection||e.get("id")!=p.id}},{id:"newPassword",label:e("New password"),type:"password",disabled:!1,control:"input",cell:v,cellHeaderClasses:"width_percent_20",deps:["auth_source"],sortable:!1,editable:function(e){return"internal"==e.get("auth_source")}},{id:"confirmPassword",label:e("Confirm password"),type:"password",disabled:!1,control:"input",cell:v,cellHeaderClasses:"width_percent_20",deps:["auth_source"],sortable:!1,editable:function(e){return"internal"==e.get("auth_source")}}],validate:function(){var t=null,n=this.changed||{};if("internal"==this.get("auth_source")&&("email"in n||!this.isNew())&&(a.isUndefined(this.get("email"))||a.isNull(this.get("email"))||""==String(this.get("email")).replace(/^\s+|\s+$/g,"")))return t=e("Email address cannot be empty."),this.errorModel.set("email",t),t;if(this.get("email")&&!/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(this.get("email")))return t=e("Invalid email address: %s.",this.get("email")),this.errorModel.set("email",t),t;if(this.get("email")&&this.collection.nonFilter.where({email:this.get("email"),auth_source:"internal"}).length>1)return t=e("The email address %s already exists.",this.get("email")),this.errorModel.set("email",t),t;if(this.errorModel.unset("email"),"role"in n&&(a.isUndefined(this.get("role"))||a.isNull(this.get("role"))||""==String(this.get("role")).replace(/^\s+|\s+$/g,"")))return t=e("Role cannot be empty for user %s.",this.get("email")||""),this.errorModel.set("role",t),t;if(this.errorModel.unset("role"),"internal"==this.get("auth_source"))if(this.isNew()){if("newPassword"in n&&(a.isUndefined(this.get("newPassword"))||a.isNull(this.get("newPassword"))||""==this.get("newPassword")))return t=e("Password cannot be empty for user %s.",this.get("email")||""),this.errorModel.set("newPassword",t),t;if(!a.isUndefined(this.get("newPassword"))&&!a.isNull(this.get("newPassword"))&&this.get("newPassword").length<6)return t=e("Password must be at least 6 characters for user %s.",this.get("email")||""),this.errorModel.set("newPassword",t),t;if(this.errorModel.unset("newPassword"),"confirmPassword"in n&&(a.isUndefined(this.get("confirmPassword"))||a.isNull(this.get("confirmPassword"))||""==this.get("confirmPassword")))return t=e("Confirm Password cannot be empty for user %s.",this.get("email")||""),this.errorModel.set("confirmPassword",t),t;if(this.errorModel.unset("confirmPassword"),this.get("newPassword")&&this.get("confirmPassword")&&this.get("newPassword")!=this.get("confirmPassword"))return t=e("Passwords do not match for user %s.",this.get("email")||""),this.errorModel.set("confirmPassword",t),t;this.errorModel.unset("confirmPassword")}else if((a.isUndefined(this.get("newPassword"))||a.isNull(this.get("newPassword"))||""==this.get("newPassword"))&&(a.isUndefined(this.get("confirmPassword"))||a.isNull(this.get("confirmPassword"))||""==this.get("confirmPassword")))this.errorModel.unset("newPassword"),""==this.get("newPassword")&&this.set({newPassword:void 0}),this.errorModel.unset("confirmPassword"),""==this.get("confirmPassword")&&this.set({confirmPassword:void 0});else{if(!a.isUndefined(this.get("newPassword"))&&!a.isNull(this.get("newPassword"))&&""==!this.get("newPassword")&&this.get("newPassword").length<6)return t=e("Password must be at least 6 characters for user %s.",this.get("email")||""),this.errorModel.set("newPassword",t),t;if(a.isUndefined(this.get("confirmPassword"))||a.isNull(this.get("confirmPassword"))||""==this.get("confirmPassword"))return t=e("Confirm Password cannot be empty for user %s.",this.get("email")||""),this.errorModel.set("confirmPassword",t),t;if(this.get("newPassword")&&this.get("confirmPassword")&&this.get("newPassword")!=this.get("confirmPassword"))return t=e("Passwords do not match for user %s.",this.get("email")||""),this.errorModel.set("confirmPassword",t),t;this.errorModel.unset("newPassword"),this.errorModel.unset("confirmPassword")}else if(this.get("username")&&this.collection.nonFilter.where({username:this.get("username"),auth_source:"ldap"}).length>1)return t=e("The username %s already exists.",this.get("username")),this.errorModel.set("username",t),t;return null}}),w=c.generateGridColumnsFromModel(null,y,"edit"),x=d.Extension.DeleteCell.extend({deleteRow:function(t){var n=this;if(t.preventDefault(),n.model.get("id")==p.id)return i.alert(e("Cannot delete user."),e("Cannot delete currently logged in user."),(function(){return!0})),!0;!(!a.isUndefined(this.column.get("canDeleteRow"))&&a.isFunction(this.column.get("canDeleteRow")))||d.callByNeed(this.column.get("canDeleteRow"),this.column,this.model)?n.model.isNew()?n.model.destroy():i.confirm(e("Delete user?"),e("Are you sure you wish to delete this user?"),(function(){n.model.destroy({wait:!0,success:function(){i.success(e("User deleted."))},error:function(){i.error(e("Error during deleting user."))}})}),(function(){return!0})):i.alert(e("Error"),e("This user cannot be deleted."),(function(){return!0}))}});w.columns.unshift({name:"pg-backform-delete",label:"",cell:x,editable:!1,cell_priority:-1,canDeleteRow:!0}),i.UserManagement||i.dialog("UserManagement",(function(){return{main:function(e){this.set("title",e)},build:function(){i.pgDialogBuild.apply(this)},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-primary-icon pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:e("Users"),url:t("help.static",{filename:"user_management.html"})}},{text:e("Close"),key:27,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button user_management_pg-alertify-button",attrs:{name:"close",type:"button"}}],options:{title:e("User Management"),padding:!1,overflow:!1,modal:!1,resizable:!0,maximizable:!0,pinnable:!1,closableByDimmer:!1,closable:!1}}},hooks:{onclose:function(){this.view&&(this.view.remove({data:!0,internal:!0,silent:!0}),this.$content.remove())}},prepare:function(){var t=a.template(['<div class="pg-prop-footer" style="visibility:hidden;">',' <div class="pg-prop-status-bar">','    <div class="error-in-footer"> ','      <div class="d-flex px-2 py-1"> ','        <div class="pr-2"> ','          <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i> ',"        </div> ",'        <div class="alert-text" role="status"></div> ','        <div class="ml-auto close-error-bar"> ','          <a class="close-error fa fa-times text-danger"></a> ',"        </div> ","      </div> ","    </div> "," </div>","</div>"].join("\n")),s=n(t()),c=d.Row.extend({userInvalidClass:"bg-user-invalid",initialize:function(){d.Row.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"pgadmin:user:invalid",this.userInvalid),this.listenTo(this.model,"pgadmin:user:valid",this.userValid)},userInvalid:function(){n(this.el).removeClass("new"),n(this.el).addClass(this.userInvalidClass)},userValid:function(){n(this.el).removeClass(this.userInvalidClass)}}),p=l.Collection.extend({model:y,url:_,initialize:function(){l.Collection.prototype.initialize.apply(this,arguments);var e=this;e.changedUser=null,e.invalidUsers={},e.nonFilter=this,e.on("add",e.onModelAdd),e.on("remove",e.onModelRemove),e.on("pgadmin-session:model:invalid",(function(t,n){e.invalidUsers[n.cid]=t,n.trigger("pgadmin:user:invalid",n),s.find(".alert-text").html(t),s.css("visibility","visible")})),e.on("pgadmin-session:model:valid",(function(t){delete e.invalidUsers[t.cid],t.trigger("pgadmin:user:valid",t),this.updateErrorMsg(),this.saveUser(t)}))},onModelAdd:function(e){e.startNewSession()},onModelRemove:function(e){delete this.invalidUsers[e.cid],this.updateErrorMsg()},updateErrorMsg:function(){var e=null;for(var t in this.invalidUsers)if(e=this.invalidUsers[t])break;e?(s.find(".alert-text").html(e),s.css("visibility","visible")):(s.find(".alert-text").empty(),s.css("visibility","hidden"))},saveUser:function(t){var n=t.toJSON(!0);if(t.isNew()&&"ldap"==t.get("auth_source")&&(!t.get("username")||!t.get("auth_source")||!t.get("role"))||t.isNew()&&"internal"==t.get("auth_source")&&(!t.get("email")||!t.get("role")||!t.get("newPassword")||!t.get("confirmPassword")||t.get("newPassword")!=t.get("confirmPassword"))||!t.isNew()&&t.get("newPassword")!=t.get("confirmPassword"))return!1;t.sessChanged()&&n&&!a.isEmpty(n)&&(t.stopSession(),t.save({},{attrs:n,wait:!0,success:function(){var n=t.get("auth_source");t.set({newPassword:void 0,confirmPassword:void 0,auth_source:void 0}),t.set({auth_source:n}),t.startNewSession(),i.success(e("User '%s' saved.",t.get("username")))},error:function(n,a){t.startNewSession(),i.error(e("Error saving user: '%s'",a.responseJSON.errormsg))}}))}}),b=this.userCollection=new p,v='<div class="navtab-inline-controls pgadmin-controls">\n                    <div class="input-group">\n                      <div class="input-group-prepend">\n                        <span class="input-group-text fa fa-search" id="labelSearch"></span>\n                        </div>\n                          <input type="search" class="form-control" id="txtGridSearch" placeholder="'+e("Search")+'" aria-label="'+e("Search")+'" aria-describedby="labelSearch" />\n                        </div>\n                        <button id="btn_add" type="button" class="btn btn-secondary btn-navtab-inline add" title="'+e("Add")+'">\n                          <span class="fa fa-plus "></span>\n                        </button>\n                      </div>\n                    </div>\n                  </div>',x=a.template(v),C={canAdd:!0,add_title:e("Add new user")},S=n("<div></div>",{class:"user_container flex-grow-1"});n.ajax({url:g,method:"GET",async:!1}).done((function(e){u=e})).fail((function(){setTimeout((function(){i.alert(e("Error"),e("Cannot load user roles."))}),100)})),n.ajax({url:m,method:"GET",async:!1}).done((function(e){f=e})).fail((function(){setTimeout((function(){i.alert(e("Error"),e("Cannot load user Sources."))}),100)}));var k,T=this.view=new d.Grid({row:c,columns:w.columns,collection:b,className:"backgrid table table-bordered table-noouter-border table-bottom-border table-hover"});S.append(T.render().$el[0]),this.$content=n("<div class='user_management object subnode subnode-noouter-border d-flex flex-column'></div>").append(x(C)).append(S).append(s),this.elements.content.appendChild(this.$content[0]),b.nonFilter=(k=b,new d.Extension.ClientSideFilter({collection:k,placeholder:e("Filter by email"),wait:150})).setCustomSearchBox(n("#txtGridSearch")).shadowCollection,b.fetch(),this.$content.find("a.close-error").on("click",(function(){s.find(".alert-text").empty(),s.css("visibility","hidden")})),this.$content.find("button.add").first().on("click",(function(e){e.preventDefault();var t,a=!1,i=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw r}}}}(b.models.entries());try{for(i.s();!(t=i.n()).done;){var s=r(t.value,2),l=s[0];if(s[1].isNew()){var d=T.body.rows[l].$el;d.addClass("new"),n(d).pgMakeVisible("backgrid"),n(d).find(".email").trigger("click"),a=!0}}}catch(e){i.e(e)}finally{i.f()}if(!a){n(T.body.$el.find(n("tr.new"))).removeClass("new");var c=new y(null,{handler:b,top:b,collection:b});b.add(c);var u=T.body.rows[b.indexOf(c)].$el;u.addClass("new"),n(u).pgMakeVisible("backgrid"),n(u).find(".email").trigger("click")}return!1})),h.findAndSetFocus(this.$content)},callback:function(t){if("dialog_help"==t.button.element.name)return t.cancel=!0,void s.showHelp(t.button.element.name,t.button.element.getAttribute("url"),null,null);if("close"==t.button.element.name){var n=this;a.all(this.userCollection.pluck("id"))&&a.isEmpty(this.userCollection.invalidUsers)||(t.cancel=!0,i.confirm(e("Discard unsaved changes?"),e("Are you sure you want to close the dialog? Any unsaved changes will be lost."),(function(){return n.close(),!0}),(function(){return!0})))}}}})),i.UserManagement(!0).resizeTo(s.stdW.md,s.stdH.md)}}},s.UserManagement}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";n(3),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.httpResponseRequiresNewTransaction=r,t.handleLoginRequiredAndTransactionRequired=o,t.handleQueryToolAjaxError=function(e,t,n,a,r,s){if(0===n.readyState)return(0,i.default)("Not connected to the server or the connection to the server has been closed.");o(e,t,n,a,r,s);var l=n.responseText;void 0!==n.responseJSON&&(void 0!==n.responseJSON.errormsg&&(l=n.responseJSON.errormsg),503===n.status&&void 0!==n.responseJSON.info&&"CONNECTION_LOST"==n.responseJSON.info&&(l=null,setTimeout((function(){a&&t.saveState(a,r),t.handle_connection_lost(!1,n)}))));return l};var a,i=(a=n(2))&&a.__esModule?a:{default:a};function r(e){return void 0===e.responseJSON&&void 0!==e.data?404===e.status&&e.data&&e.data.info&&"DATAGRID_TRANSACTION_REQUIRED"===e.data.info:404===e.status&&e.responseJSON&&e.responseJSON.info&&"DATAGRID_TRANSACTION_REQUIRED"===e.responseJSON.info}function o(e,t,n,a,i,o){return i=i&&i.length>0?i:[],e.Browser.UserManagement.isPgaLoginRequired(n)?(a&&t.saveState(a,i),e.Browser.UserManagement.pgaLogin()):o&&r(n)?(a&&t.saveState(a,i),t.initTransaction()):void 0}},,,,,,function(e,t,n){"use strict";(function(e){n(21),n(24),n(25),n(41),n(8),n(40),n(15),n(59),n(14),n(23),n(18),n(97),n(70),n(3),n(34),n(71),n(43),n(12),n(98),n(5),n(19),n(9),n(30),n(83),n(46),n(16),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.isValidTreeNodeData=t.Tree=t.TreeNode=void 0;var a=n(22),i=o(n(0)),r=o(n(13));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}var h=function(){function e(t,n,a,i){u(this,e),this.id=t,this.data=n,this.setParent(i),this.children=[],this.domNode=a}return p(e,[{key:"hasParent",value:function(){return null!==this.parentNode&&void 0!==this.parentNode}},{key:"parent",value:function(){return this.parentNode}},{key:"setParent",value:function(e){this.parentNode=e,this.path=this.id,null!=e&&void 0!==e.path&&(this.path=e.path+"."+this.id)}},{key:"getData",value:function(){if(void 0!==this.data)return null===this.data?null:Object.assign({},this.data)}},{key:"getHtmlIdentifier",value:function(){return this.domNode}},{key:"reload",value:function(e){var t=this;return new Promise((function(n){t.unload(e).then((function(){e.aciTreeApi.setInode(t.domNode),e.aciTreeApi.deselect(t.domNode),setTimeout((function(){e.selectNode(t.domNode)}),0),n()}))}))}},{key:"unload",value:function(e){var t=this;return new Promise((function(n,a){t.children=[],e.aciTreeApi.unload(t.domNode,{success:function(){n(!0)},fail:function(){a()}})}))}},{key:"open",value:function(e,t){var n=this;return new Promise((function(a,i){!t||null!=n.domNode&&void 0!==n.domNode?e.aciTreeApi.isOpen(n.domNode)?a(!0):e.aciTreeApi.open(n.domNode,{success:function(){a(!0)},fail:function(){i(!0)}}):a(!0)}))}},{key:"ancestorNode",value:function(e){for(var t=this;t.hasParent();)if(e(t=t.parent()))return t;return null}},{key:"anyFamilyMember",value:function(e){return!!e(this)||null!==this.ancestorNode(e)}},{key:"anyParent",value:function(e){return null!==this.ancestorNode(e)}}]),e}();t.TreeNode=h;var _=function(){function t(){u(this,t),this.rootNode=new h(void 0,{}),this.aciTreeApi=void 0,this.draggableTypes={}}return p(t,[{key:"registerDraggableType",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"object"==c(e)?Object.keys(e).forEach((function(n){t.registerDraggableType(n,e[n])})):null!=n&&e.replace(/ +/," ").split(" ").forEach((function(e){t.draggableTypes[e]=n}))}},{key:"getDraggable",value:function(e){return this.draggableTypes[e]?this.draggableTypes[e]:null}},{key:"prepareDraggable",value:function(t,n){var a=this.getDraggable(t._type);null!=a&&n.find(".aciTreeItem").attr("draggable",!0)[0].addEventListener("dragstart",(function(r){var o=a(t,n);if("string"==typeof o?o={text:o,cur:{from:o.length,to:o.length}}:o.cur||(o=l(l({},o),{},{cur:{from:o.text.length,to:o.text.length}})),r.dataTransfer.setData("text",JSON.stringify(o)),r.dataTransfer.dropEffect&&(r.dataTransfer.dropEffect="move"),r.dataTransfer.setDragImage){var s=(0,i.default)('\n              <div class="drag-tree-node">\n                <span>'.concat(e.escape(o.text),"</span>\n              </div>"));(0,i.default)("body .drag-tree-node").remove(),(0,i.default)("body").append(s),r.dataTransfer.setDragImage(s[0],0,0)}}))}},{key:"addNewNode",value:function(e,t,n,a){var i=this.findNode(a);return this.createOrUpdateNode(e,t,i,n)}},{key:"findNode",value:function(e){return null==e||0===e.length?this.rootNode:function(e,t){if(null===t)return e;return function e(n){if(void 0!==n.path&&void 0!==t&&!t.startsWith(n.path))return null;for(var a=0,i=n.children.length;a<i;a++){var r=e(n.children[a]);if(null!==r)return r}return n.path===t?n:null}(e)}(this.rootNode,e.join("."))}},{key:"findNodeWithToggle",value:function(e){var t=this;if(null==e||!Array.isArray(e))return Promise.reject();e=e.join(".");var n=function(t){return void 0!==t&&void 0!==e&&(e.startsWith(t+".")||e===t)};return function a(i){return new Promise((function(r,o){null!=e&&0!==e.length||r(null),void 0===i.path||n(i.path)?i.path===e?r(i):i.open(t,!0).then((function(){for(var e=0,t=i.children.length;e<t;e++){var s=i.children[e];if(n(s.path))return void r(a(s))}o(null)})).catch((function(){o(null)})):o(null)}))}(this.rootNode)}},{key:"findNodeByDomElement",value:function(e){var t=this.translateTreeNodeIdFromACITree(e);if(t&&t[0])return this.findNode(t)}},{key:"selected",value:function(){return this.aciTreeApi.selected()}},{key:"scrollTo",value:function(e){e.scrollIntoView()}},{key:"selectNode",value:function(e,t){this.aciTreeApi.select(e),t&&this.scrollTo(e[0])}},{key:"createOrUpdateNode",value:function(e,t,n,a){var i=[e];null!=n&&(i=[n.path,e]);var r=this.findNode(i);if(null!==r)return r.data=t,r.domNode=a,r;var o=new h(e,t,a,n);return n===this.rootNode&&(o.parentNode=null),null!=n&&n.children.push(o),o}},{key:"unloadNode",value:function(e,t,n,a){var i=[e],r=this.findNode(a);null!=r&&(i=[r.path,e]);var o=this.findNode(i);o&&(o.children=[])}},{key:"register",value:function(e){var t=this;e.on("acitree",function(e,t,n,a){if(t.isItem(n)&&-1!=["added","idset","beforeunload"].indexOf(a)){var i=t.getId(n),o=t.itemData(n),s=this.translateTreeNodeIdFromACITree(t.parent(n));"beforeunload"===a?this.unloadNode(i,o,n,s):("added"===a&&this.prepareDraggable(o,n),this.addNewNode(i,o,n,s)),o.errmsg&&r.default.error(o.errmsg)}}.bind(this)),this.aciTreeApi=e.aciTree("api");var n=function(e){var n=t.aciTreeApi.itemFrom(e.target);n.length&&(e.ctrlKey&&t.aciTreeApi.select(n),(0,i.default)(n).on("contextmenu:visible",(function(){(0,i.default)(n).trigger("blur"),(0,i.default)(n).off("contextmenu:visible")})))};e.off("mousedown",n).on("mousedown",n)}},{key:"translateTreeNodeIdFromACITree",value:function(e){for(var t=e,n=[];null!=t&&t.length>0&&(n.unshift(this.aciTreeApi.getId(t)),this.aciTreeApi.hasParent(t));)t=this.aciTreeApi.parent(t);return n}}]),t}();t.Tree=_;var g=a.isValidData;t.isValidTreeNodeData=g}).call(this,n(1))},,,,function(e,t){e.exports=a},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(42),n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e.showOnScroll){var t=a.default.fn.select2.amd.require("select2/utils"),n=function(e,t){this.$element=e,this.options=t,this._dataToConvert=t.get("data")||[]},r=null;r=null!=e.data?a.default.fn.select2.amd.require("select2/data/array"):a.default.fn.select2.amd.require("select2/data/select"),t.Extend(n,r),n.prototype.query=function(e,t){var n=[],i=this;e.page||(e.page=1);this.$element.children().each((function(){var t=(0,a.default)(this);if(t.is("option")||t.is("optgroup")){var r=i.item(t),o=i.matches(e,r);null!==o&&n.push(o)}})),t({results:n.slice(20*(e.page-1),20*e.page),pagination:{more:n.length>=20*e.page}})},e.minimumInputLength>0&&(n=t.Decorate(n,a.default.fn.select2.amd.require("select2/data/minimumInputLength"))),e.maximumInputLength>0&&(n=t.Decorate(n,a.default.fn.select2.amd.require("select2/data/maximumInputLength"))),e.maximumSelectionLength>0&&(n=t.Decorate(n,a.default.fn.select2.amd.require("select2/data/maximumSelectionLength"))),e.tags&&(n=t.Decorate(n,a.default.fn.select2.amd.require("select2/data/tags"))),null==e.tokenSeparators&&null==e.tokenizer||(n=t.Decorate(n,a.default.fn.select2.amd.require("select2/data/tokenizer"))),e.dataAdapter=n,i.default.isUndefined(e.ajax)&&(e.ajax={})}return e},n(115);var a=r(n(0)),i=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}},,,function(e,t,n){"use strict";n(3),n(5),n(9),Object.defineProperty(t,"__esModule",{value:!0}),t.getHelpUrl=function(e,t,n,a){var i=Math.floor(n/1e4),r=Math.floor(n/100)-100*i,o=n-(1e4*i+100*r),s="",l=i+"."+r;"ppas"==a&&i<10?l=i+"."+r+"."+o:"pg"==a&&i>=10&&(l=i);"/"!=(s=e.replace("$VERSION$",l)).substr(-1)&&(s+="/");return s+t}},function(e,t,n){"use strict";n(31);var a,i=(a=n(1))&&a.__esModule?a:{default:a};e.exports={generate_url:function(e,t,n,a,r,o){var s="";return i.default.each(i.default.sortBy(i.default.pick(t,r),(function(e){return e.priority})),(function(e){s="".concat(s,"/").concat(encodeURI(e._id))})),s=o?"".concat(s,"/").concat(o):"".concat(s,"/"),"".concat(e).concat(a,"/").concat(n).concat(s)}}},,function(e,t,n){"use strict";n(21),n(24),n(25),n(8),n(85),n(15),n(59),n(14),n(23),n(42),n(48),n(27),n(10),n(3),n(12),n(5),n(29),n(19),n(62),n(30),n(16),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.browserTreeState=t.pgBrowser=void 0;var a=l(n(1)),i=l(n(0)),r=l(n(6)),o=l(n(2)),s=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}function d(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var u=s.default.Browser=s.default.Browser||{};t.pgBrowser=u;var f=u.browserTreeState=u.browserTreeState||{};t.browserTreeState=f,a.default.extend(u.browserTreeState,{parent:"server",orig_parent:"server_group",stored_state:{},last_state:{},current_state:{},init:function(){var e=u.get_preference("browser","browser_tree_state_save_interval");a.default.isUndefined(e)||-1===e.value?a.default.isUndefined(e)||i.default.ajax({url:(0,r.default)("settings.reset_tree_state"),type:"DELETE"}).fail((function(e){var t=e.responseText;if(417==e.status||410==e.status||500==e.status)try{t=JSON.parse(e.responseText).errormsg}catch(e){console.warn(e.stack||e)}console.warn((0,o.default)('Error resetting the tree saved state."'),t)})):(setInterval(this.save_state,1e3*e.value),this.fetch_state.apply(this),u.Events.on("pgadmin:browser:tree:expand-from-previous-tree-state",this.expand_from_previous_state,this),u.Events.on("pgadmin:browser:tree:remove-from-tree-state",this.remove_from_cache,this),u.Events.on("pgadmin:browser:tree:update-tree-state",this.update_cache,this))},save_state:function(){var e=u.browserTreeState;e.last_state!=JSON.stringify(e.current_state)&&i.default.ajax({url:(0,r.default)("settings.save_tree_state"),type:"POST",contentType:"application/json",data:JSON.stringify(e.current_state)}).done((function(){e.last_state=JSON.stringify(e.current_state)})).fail((function(e){var t=e.responseText;if(417==e.status||410==e.status||500==e.status)try{t=JSON.parse(e.responseText).errormsg}catch(e){console.warn(e.stack||e)}console.warn((0,o.default)('Error saving the tree state."'),t)}))},fetch_state:function(){var e=this;i.default.ajax({url:(0,r.default)("settings.get_tree_state"),type:"GET",dataType:"json",contentType:"application/json"}).done((function(t){e.stored_state=t})).fail((function(e){var t=e.responseText;if(417==e.status||410==e.status||500==e.status)try{t=JSON.parse(e.responseText).errormsg}catch(e){console.warn(e.stack||e)}console.warn((0,o.default)("Error fetching the tree state."),t)}))},update_cache:function(e){var t,n=e&&u.tree.itemData(e),i=(n&&u.Nodes[n._type]).getTreeNodeHierarchy(e),r=u.tree.pathId(e),o=r.join(),s=[],l=-1;if(u.tree.hasParent(e)&&this.parent in i){if(t=i[this.parent]._id,u.tree.isOpen(e)){r.push(n.id),s=r.join(),t in this.current_state||(this.current_state[t]={paths:[],selected:{},conn_status:{},is_opened:{}});var d=a.default.find(this.current_state[t].paths,(function(e){return-1!==e.search(s)}));a.default.isUndefined(d)&&(a.default.isUndefined(this.current_state[t].paths)?this.current_state[t].paths=[]:l=this.current_state[t].paths.indexOf(o),-1!==l?this.current_state[t].paths[l]=s:this.current_state[t].paths.push(s))}this.update_database_status(e),this.update_current_selected_item(i)}},remove_from_cache:function(e){var t=this,n=t.stored_state||{},i=e&&u.tree.itemData(e),r=i&&u.Nodes[i._type],o=r&&r.getTreeNodeHierarchy(e);if(null!==o&&u.tree.hasParent(e)&&o.hasOwnProperty(t.parent)){var s=o&&o[t.parent]._id,l=o&&o[t.orig_parent].id;if(this.update_database_status(e),i._type!=t.parent&&"database"!=i._type){if(u.tree.isClosed(e)){var d=t.current_state[s].paths,c=void 0;if(o.hasOwnProperty("database")&&(c=o.database.id),!a.default.isUndefined(d)&&!a.default.isUndefined(d.length)){var f=0,p=void 0;a.default.each(d,(function(e){if(!a.default.isUndefined(e)){var n=e.split(",");if(-1!==n.indexOf(i.id)&&(void 0===c||void 0!==c&&-1!==n.indexOf(c))){var r=n.indexOf(i.id);n.splice(r),(p=n.join())==l?t.current_state[s].paths.splice(e,1):t.current_state[s].paths[f]=p}f++}}))}}}else s in n&&"paths"in n[s]&&(n[s].paths=t.current_state[s].paths,t.save_state())}},expand_from_previous_state:function(e){var t=this,n=t.stored_state||{},i=e&&u.tree.itemData(e),r=i&&u.Nodes[i._type],o=r&&r.getTreeNodeHierarchy(e);if(null!==o&&u.tree.hasParent(e)&&o.hasOwnProperty(t.parent)&&(i._type!=t.parent||!1!==u.tree.isOpen(e))){var s=n[o[t.parent]._id];if(!("database"==i._type&&s&&"conn_status"in s&&"is_opened"in s)||0!==s.conn_status[i.id]&&0!==s.is_opened[i.id]&&i.id in s.is_opened){if(!a.default.isUndefined(s)&&"paths"in s&&!a.default.isUndefined(s.paths.length)){var l=d(s.paths),c=void 0;o.hasOwnProperty("database")&&(c=o.database.id),a.default.each(l,(function(r){if(!a.default.isUndefined(r)){var s=r.split(",");if(-1!==s.indexOf(i.id)&&(void 0===c||void 0!==c&&-1!==s.indexOf(c))){var l=s.indexOf(i.id);if(u.tree.toggle(e),l==s.length-1){var d=n[o[t.parent]._id].paths.indexOf(r);n[o[t.parent]._id].paths.splice(d,1)}}}}))}this.select_tree_item(e)}}},update_database_status:function(e){var t=e&&u.tree.itemData(e),n=(t&&u.Nodes[t._type]).getTreeNodeHierarchy(e);if(n.hasOwnProperty("database")){var a=n.database.id,i=n&&n[this.parent]._id;i in this.current_state&&"selected"in this.current_state[i]&&(n.database.connected?this.current_state[i].conn_status[a]=1:this.current_state[i].conn_status[a]=0,"database"==t._type&&(u.tree.isOpen(e)?this.current_state[i].is_opened[a]=1:this.current_state[i].is_opened[a]=0))}},update_current_selected_item:function(e){if(this.parent in e){var t=e&&e[this.parent]._id,n=u.tree.itemData(u.tree.selected()),i=void 0;n=n?n.id:void 0,e.hasOwnProperty("database")&&(i=e.database.id),t in this.current_state&&"selected"in this.current_state[t]&&!a.default.isUndefined(n)&&(this.current_state[t].selected[e[this.parent].id]=n,a.default.isUndefined(i)||(this.current_state[t].selected[i]=n))}},select_tree_item:function(e){var t=this.stored_state||{},n=e&&u.tree.itemData(e),a=n&&u.Nodes[n._type],i=a&&a.getTreeNodeHierarchy(e),r=t[i[this.parent]._id];if(i.hasOwnProperty("database")){var o=i.database.id;r&&"selected"in r&&o in r.selected&&r.selected[o]==n.id&&u.tree.select(e)}}})},,,function(e,t,n){"use strict";var a,i,r;n(66),n(15),n(5),n(67),n(9),n(7),(r=r||{}).dashboard=n(163),(r=r||{}).tools=r.tools||{},r.tools.user_management=n(125),(r=r||{}).browser=r.browser||{},r.browser.object_statistics=n(170),(r=r||{}).browser=r.browser||{},r.browser.dependencies=n(173),(r=r||{}).browser=r.browser||{},r.browser.dependents=n(174),(r=r||{}).browser=r.browser||{},r.browser.object_sql=n(175),(r=r||{}).browser=r.browser||{},r.browser.bgprocess=n(176),(r=r||{}).node=r.node||{},r.node.server_group=n(261),(r=r||{}).node=r.node||{},r.node.server=n(143),(r=r||{}).node=r.node||{},r.node.database=n(262),(r=r||{}).node=r.node||{},r.node.role=n(263),(r=r||{}).node=r.node||{},r.node.cast=n(264),(r=r||{}).node=r.node||{},r.node.tablespace=n(265),(r=r||{}).node=r.node||{},r.node.resource_group=n(266),(r=r||{}).node=r.node||{},r.node.event_trigger=n(267),(r=r||{}).node=r.node||{},r.node.extension=n(268),(r=r||{}).node=r.node||{},r.node.language=n(269),(r=r||{}).node=r.node||{},r.node.foreign_data_wrapper=n(270),(r=r||{}).node=r.node||{},r.node.foreign_server=n(271),(r=r||{}).node=r.node||{},r.node.user_mapping=n(272),(r=r||{}).node=r.node||{},r.node.schema=n(273),(r=r||{}).node=r.node||{},r.node.catalog=n(274),(r=r||{}).node=r.node||{},r.node.catalog_object=n(275),(r=r||{}).node=r.node||{},r.node.collation=n(276),(r=r||{}).node=r.node||{},r.node.domain=n(277),(r=r||{}).node=r.node||{},r.node.domain_constraints=n(278),(r=r||{}).node=r.node||{},r.node.foreign_table=n(279),(r=r||{}).node=r.node||{},r.node.fts_configuration=n(280),(r=r||{}).node=r.node||{},r.node.fts_dictionary=n(281),(r=r||{}).node=r.node||{},r.node.fts_parser=n(282),(r=r||{}).node=r.node||{},r.node.fts_template=n(283),(r=r||{}).node=r.node||{},r.node.function=n(208),(r=r||{}).node=r.node||{},r.node.procedure=n(284),(r=r||{}).node=r.node||{},r.node.edbfunc=n(209),(r=r||{}).node=r.node||{},r.node.edbproc=n(285),(r=r||{}).node=r.node||{},r.node.edbvar=n(286),(r=r||{}).node=r.node||{},r.node.trigger_function=n(287),(r=r||{}).node=r.node||{},r.node.package=n(288),(r=r||{}).node=r.node||{},r.node.sequence=n(289),(r=r||{}).node=r.node||{},r.node.synonym=n(290),(r=r||{}).node=r.node||{},r.node.type=n(291),(r=r||{}).node=r.node||{},r.node.rule=n(210),(r=r||{}).node=r.node||{},r.node.index=n(292),(r=r||{}).node=r.node||{},r.node.row_security_policy=n(293),(r=r||{}).node=r.node||{},r.node.trigger=n(294),(r=r||{}).node=r.node||{},r.node.catalog_object_column=n(295),(r=r||{}).node=r.node||{},r.node.view=n(296),(r=r||{}).node=r.node||{},r.node.mview=n(297),(r=r||{}).node=r.node||{},r.node.table=n(298),(r=r||{}).node=r.node||{},r.node.partition=n(301),(r=r||{}).node=r.node||{},r.node.compound_trigger=n(302),a=[n(2),n(6),n(0),n(1),n(13),n(4),n(84),n(63),n(20),n(178),n(92),n(117),n(65),n(22),n(64)],void 0===(i=function(e,t,n,a,i,r,o,s,l,d,c,u,f,p){var h=window.wcDocker,_=r.Browser;return r.DataGrid||(r.DataGrid=a.extend({init:function(){if(!this.initialized){this.initialized=!0,this.title_index=1;var t=this,n=setInterval((function(){_.preference_version()>0&&(t.preferences=_.get_preferences_for_module("sqleditor"),clearInterval(n))}),0);_.onPreferencesChange("sqleditor",(function(){t.preferences=_.get_preferences_for_module("sqleditor")}));for(var i=["table","view","mview","foreign_table","catalog_object","partition"],o=function(t){var n=!a.isUndefined(t)&&!a.isNull(t)&&-1!==a.indexOf(i,t._type);return u.enable(e("View Data"),n),u.enable(e("Filtered Rows"),n),n},s=[{name:"query_tool",module:this,applies:["tools"],callback:"show_query_tool",enable:function(t){var n=!(a.isUndefined(t)||a.isNull(t)||-1!=a.indexOf(r.unsupported_nodes,t._type)||("database"!=t._type||!t.allowConn)&&"database"==t._type);return u.enable(e("Query Tool"),n),n},priority:1,label:e("Query Tool"),icon:"pg-font-icon icon-query-tool"}],l=0;l<i.length;l++)s.push({name:"view_all_rows_context_"+i[l],node:i[l],module:this,data:{mnuid:3},applies:["context","object"],callback:"show_data_grid",enable:o,category:"view_data",priority:101,label:e("All Rows")},{name:"view_first_100_rows_context_"+i[l],node:i[l],module:this,data:{mnuid:1},applies:["context","object"],callback:"show_data_grid",enable:o,category:"view_data",priority:102,label:e("First 100 Rows")},{name:"view_last_100_rows_context_"+i[l],node:i[l],module:this,data:{mnuid:2},applies:["context","object"],callback:"show_data_grid",enable:o,category:"view_data",priority:103,label:e("Last 100 Rows")},{name:"view_filtered_rows_context_"+i[l],node:i[l],module:this,data:{mnuid:4},applies:["context","object"],callback:"show_filtered_row",enable:o,category:"view_data",priority:104,label:e("Filtered Rows...")});r.Browser.add_menu_category("view_data",e("View/Edit Data"),100,""),r.Browser.add_menus(s),new r.Browser.Frame({name:"frm_datagrid",showTitle:!0,isCloseable:!0,isRenameable:!0,isPrivate:!0,url:"about:blank"}).load(_.docker),this.on("pgadmin-datagrid:transaction:created",(function(e){this.launch_grid(e)}))}},show_data_grid:function(e,t){var n=p.getRandomInt(1,9999999);d.showDataGrid(this,_,i,e,t,n)},show_filtered_row:function(e,t){var n=p.getRandomInt(1,9999999);d.showDataGrid(this,_,i,e,t,n,!0,this.preferences)},show_query_tool:function(e,t){var n=p.getRandomInt(1,9999999);c.showQueryTool(this,_,i,e,t,n)},launch_grid:function(r,o,s,l){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g='\n          <form id="queryToolForm" action="'.concat(o,'" method="post">\n            <input id="title" name="title" hidden />');u&&(g+='<input name="query_url" value="'.concat(u,'" hidden />')),p&&(g+='<textarea name="sql_filter" hidden>'.concat(p,"</textarea>")),g+='\n          </form>\n            <script>\n              document.getElementById("title").value = "'.concat(a.escape(l.replace("\\","\\\\")),'";\n              document.getElementById("queryToolForm").submit();\n            <\/script>\n          ');var m=_.get_preferences_for_module("browser"),b=m.new_browser_tab_open;if(b&&b.includes("qt")){var v=window.open("","_blank");if(!v)return!1;v.document.write(g),v.document.title=l}else{var y=_.docker.findPanels("properties"),w=_.docker.addPanel("frm_datagrid",h.DOCK.STACKED,y[0]);c._set_dynamic_tab(_,m.dynamic_tabs),f.setQueryToolDockerTitle(w,s,a.unescape(l)),w.focus(),w.on(h.EVENT.CLOSED,(function(){n.ajax({url:t("datagrid.close",{trans_id:r}),method:"DELETE"})})),w.on(h.EVENT.RENAME,(function(t){i.prompt("",t.$titleText[0].textContent,(function(e,n){if(n){var i=!1;t.$titleText[0].innerHTML.includes("File - ")&&(i=!0);var r=_.treeMenu.selected(),o="";o=s?f.getPanelTitle(_,r,n):d.generateDatagridTitle(_,r,n),f.setQueryToolDockerTitle(w,s,a.unescape(o),i)}}),(function(e){e.cancel=!1})).set({title:e("Rename Panel")})}));var x=function(e){var t=n('<div class="pg-sp-container">\n                    <div class="pg-sp-content">\n                        <div class="row">\n                            <div class="col-12 pg-sp-icon"></div>\n                        </div>\n                    </div>\n                </div>').appendTo(n(e).data("embeddedFrame").$container),a=setInterval((function(){if(n(e).data("frameInitialized")){clearInterval(a);var i=n(e).data("embeddedFrame");i&&(i.onLoaded((function(){t.remove()})),i.openHTML(g))}}),100)};x(w)}return!0}},l.Events)),r.DataGrid}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";var a,i;n(31),n(8),n(18),n(10),n(5),n(62),n(7),a=[n(6),n(2),n,n(0),n(1),n(4),n(20),n(69),n(13),n(17),n(164),n(39),n(165),n(11),n(134),n(64)],void 0===(i=function(e,t,a,i,r,o,s,l,d,c,u,f,p){o.Browser=o.Browser||{};var h=o.Browser;if(!o.Dashboard){var _,g,m=!0,b="",v="",y=!1,w=!1,x=!1,C=l.Extension.DeleteCell.extend({render:function(){this.$el.empty();var e=this;return"cancel"===e.column.get("cell_action")?this.$el.html("<i class='fa fa-stop' data-toggle='tooltip' title='"+t("Cancel the active query")+"' aria-label='"+t("Cancel the active query")+"'></i>"):this.$el.html("<i class='fa fa-times-circle text-danger' data-toggle='tooltip' title='"+t("Terminate the session")+"' aria-label='"+t("Terminate the session")+"'></i>"),this.$el.attr("tabindex",0),this.$el.on("keydown",(function(t){32==t.keyCode&&e.$el.click()})),this.delegateEvents(),this},deleteRow:function(e){var n,a,r,o,s,c=this.column.get("cell_action");if(e.preventDefault(),l.callByNeed(this.column.get("canDeleteRow"),this.column,this.model)){"cancel"===c?(n=t("Cancel Active Query?"),a=t("Are you sure you wish to cancel the active query?"),r=t("Active query cancelled successfully."),o=t("An error occurred whilst cancelling the active query."),s=b+this.model.get("pid")):(n=t("Terminate Session?"),a=t("Are you sure you wish to terminate the session?"),r=t("Session terminated successfully."),o=t("An error occurred whilst terminating the active query."),s=v+this.model.get("pid")),d.confirm(n,a,(function(){i.ajax({url:s,type:"DELETE"}).done((function(e){e==t("Success")?(d.success(r),i("#btn_refresh").trigger("click")):d.error(o)})).fail((function(e,t,n){d.pgRespErrorNotify(e,n)}))}),(function(){return!0}))}}}),S=l.Extension.ObjectCell.extend({enterEditMode:function(){this.model.trigger("enteringEditMode",[this]),l.Cell.prototype.enterEditMode.apply(this,arguments),this.delegateEvents();var e=l.callByNeed(this.column.editable(),this.column,this.model);e&&(this.$el.html("<i class='fa fa-caret-down subnode-edit-in-process'></i>"),this.model.trigger("pg-sub-node:opened",this.model,this))},render:function(){return this.$el.empty(),this.$el.html("<i class='fa fa-caret-right' data-toggle='tooltip' title='"+t("View the active session details")+"' aria-label='"+t("View the active session details")+"'></i>"),this.delegateEvents(),this.grabFocus&&this.$el.trigger("focus"),this}}),k=s.Model.extend({defaults:{version:null},schema:[{id:"backend_type",label:t("Backend type"),type:"text",editable:!0,readonly:!0,group:t("Details"),visible:function(){return this.version>=1e5}},{id:"query_start",label:t("Query started at"),type:"text",editable:!1,readonly:!0,group:t("Details")},{id:"state_change",label:t("Last state changed at"),type:"text",editable:!0,readonly:!0,group:t("Details")},{id:"query",label:t("SQL"),type:"text",editable:!0,readonly:!0,control:c.SqlFieldControl,group:t("Details")}]});return o.Dashboard={init:function(){if(!this.initialized){this.initialized=!0,this.chartsDomObj=null,this.sid=this.did=-1,this.version=-1;var n=this.object_selected.bind(this),a=this.object_disconnected.bind(this);h.Events.on("pgadmin-browser:tree:selected",n),h.Events.on("pgadmin:server:disconnect",a);var r=e("dashboard.index"),o=h.panels.dashboard.panel;if(o){var s=o.layout().scene().find(".pg-panel-content");if(s){i(s).html('<div class="pg-panel-message" role="alert">'+t("Loading dashboard...")+"</div>"),function e(){i.ajax({url:r,type:"GET",dataType:"html"}).done((function(e){i(s).html(e)})).fail((function(n,a){d.pgNotifier(a,n,t("An error occurred whilst loading the dashboard."),(function(n){"CRYPTKEY_SET"===n?e():i(s).html('<div class="pg-panel-message" role="alert">'+t("An error occurred whilst loading the dashboard.")+"</div>")}))}))}(),i(o).data("sid",-1),i(o).data("did",-1)}}}},object_disconnected:function(){var e=h.tree.selected(),t=e&&h.tree.itemData(e);0!=e.length&&this.object_selected(e,t,h.Nodes[t._type])},object_selected:function(n,a,o){var s=this;if(a&&a._type){var l=o.getTreeNodeHierarchy(n),c=u.url(a,n,l);if(null===c){c=e("dashboard.index"),s.version=l.server&&l.server.version||0,b=c+"cancel_query/",v=c+"terminate_session/";var f=l.server;g=f&&f.db||null,f&&f.user&&f.user.is_superuser?y=!0:(y=!1,_=f&&f.user?f.user.name:null),"database"in l?(s.sid=l.server._id,s.did=l.database._id,w=!1,x=!0,c+=s.sid+"/"+s.did,b+=s.sid+"/"+s.did+"/",v+=s.sid+"/"+s.did+"/"):"server"in l?(s.sid=l.server._id,s.did=-1,w=!0,x=!1,c+=s.sid,b+=s.sid+"/",v+=s.sid+"/"):w=x=!1}else w=x=!1;var p=h.panels.dashboard.panel;if(p){var m=p.layout().scene().find(".pg-panel-content");if(m){if(a.connected||r.isUndefined(a.connected)){if(c!==i(p).data("dashboard_url")||c===i(p).data("dashboard_url")&&0==i(p).data("server_status")){this.chartsDomObj&&this.chartsDomObj.unmount(),i(m).empty();i(m).html('<div class="pg-panel-message" role="alert">'+t("Loading dashboard...")+"</div>"),function e(){i.ajax({url:c,type:"GET",dataType:"html"}).done((function(e){i(m).html(e),s.init_dashboard()})).fail((function(n,a){d.pgNotifier(a,n,t("An error occurred whilst loading the dashboard."),(function(n){"CRYPTKEY_SET"===n?e():i(m).html('<div class="pg-panel-message" role="alert">'+t("An error occurred whilst loading the dashboard.")+"</div>")}))}))}(),i(p).data("server_status",!0)}}else this.chartsDomObj&&this.chartsDomObj.unmount(),i(m).html('<div class="pg-panel-message" role="alert">'+t("Please connect to the selected server to view the dashboard.")+"</div>"),i(p).data("server_status",!1);i(p).data("dashboard_url",c)}}}},add_new_server:function(){if(h&&h.tree){for(var e=0!=h.tree.selected().length?h.tree.selected():h.tree.first(null,!1),t=n(143),a=h.tree.itemData(e);a&&"server_group"!=a._type;)e=h.tree.next(e),a=h.tree.itemData(e);if(!a)return;t&&t.callbacks.show_obj_properties.apply(t,[{action:"create"},e])}},render_grid:function(e,n,a){var r=s.Model.extend({}),o=n+this.sid;-1!=this.did&&(o+="/"+this.did);var d=new(s.Collection.extend({model:r,url:o,mode:"client"})),c=new l.Grid({emptyText:t("No data found"),columns:a,collection:d,className:"backgrid presentation table table-bordered table-noouter-border table-hover"});i(e).empty(),i(e).append(c.render().el);var u=new l.Extension.ClientSideFilter({collection:d});u.setCustomSearchBox(i("#txtGridSearch")),i(e).data("data",d),i(e).data("grid",c),i(e).data("filter",u)},render_grid_data:function(e){var n=i(e).data("data"),a=i(e).data("grid"),s=i(e).data("filter");if(r.isUndefined(n))return null;n.fetch({reset:!0,success:function(){i(e).hasClass("grid-error")&&(i(e).removeClass("grid-error"),i(e).html(a.render().el),i(s.el).show()),s.search()},error:function(a,l){var d="",c="info";0===l.readyState?d=t("Not connected to the server or the connection to the server has been closed."):(d=JSON.parse(l.responseText).errormsg,428===l.status?(r.isUndefined(d)||r.isNull(d))&&(d=t("Please connect to the selected server to view the table.")):(d=t("An error occurred whilst rendering the table."),c="error")),i(e).hasClass("grid-error")||(i(s.el).hide(),i(e).addClass("grid-error")),i(e).html('<div class="pg-panel-'+c+' pg-panel-message" role="alert">'+d+"</div>"),setTimeout((function(){o.Dashboard.render_grid_data(e,n)}),5e3)}})},init_dashboard:function(){var e=this;this.chartsDomObj=new p.default(document.getElementById("dashboard-graphs"),e.preferences,e.sid,e.did,!(i(".dashboard-container")[0].clientHeight<=0));var t=setInterval((function(){try{f.default.pgAdmin.Browser.preference_version()>0&&(clearInterval(t),e.reflectPreferences())}catch(e){throw clearInterval(t),e}}),0);h.onPreferencesChange("dashboards",(function(){e.reflectPreferences()}))},reflectPreferences:function(){this.preferences=f.default.pgAdmin.Browser.get_preferences_for_module("dashboards"),this.chartsDomObj.reflectPreferences(this.preferences),(w||x)&&(this.preferences.show_activity&&i("#dashboard-activity").hasClass("dashboard-hidden")?i("#dashboard-activity").removeClass("dashboard-hidden"):this.preferences.show_activity||i("#dashboard-activity").addClass("dashboard-hidden"),this.preferences.show_activity&&i("#dashboard-activity").hasClass("dashboard-hidden")?i("#dashboard-activity").removeClass("dashboard-hidden"):this.preferences.show_activity||i("#dashboard-activity").addClass("dashboard-hidden"),w?this.reflectPreferencesServer():x&&this.reflectPreferencesDatabase())},reflectPreferencesServer:function(){var n=this,a=i(".dashboard-container"),s=a.find("#server_activity").get(0),l=a.find("#server_locks").get(0),d=a.find("#server_prepared").get(0),u=a.find("#server_config").get(0),f={tab_server_activity:s,tab_server_locks:l,tab_server_prepared:d,tab_server_config:u};if(n.preferences.show_activity){var p=[{name:"pid",label:t("PID"),editable:!1,cell:"string"},{name:"datname",label:t("Database"),editable:!1,cell:"string"},{name:"usename",label:t("User"),editable:!1,cell:"string"},{name:"application_name",label:t("Application"),editable:!1,cell:"string"},{name:"client_addr",label:t("Client"),editable:!1,cell:"string"},{name:"backend_start",label:t("Backend start"),editable:!1,cell:"string"},{name:"state",label:t("State"),editable:!1,cell:"string"}];p=n.version<90600?p.concat([{name:"waiting",label:t("Waiting?"),editable:!1,cell:"string"}]):p.concat([{name:"wait_event",label:t("Wait event"),editable:!1,cell:"string"},{name:"blocking_pids",label:t("Blocking PIDs"),editable:!1,cell:"string"}]);var h=new k,_=c.generateViewSchema(null,h,"create",null,null,!0);r.each(_[0].fields,(function(e){e.version=n.version})),p.unshift({name:"pg-backform-expand",label:"",cell:S,cell_priority:-1,postgres_version:n.version,schema:_}),p.unshift({name:"pg-backform-delete",label:"",cell:C,cell_action:"cancel",editable:!1,cell_priority:-1,canDeleteRow:o.Dashboard.can_take_action,postgres_version:n.version}),p.unshift({name:"pg-backform-delete",label:"",cell:C,cell_action:"terminate",editable:!1,cell_priority:-1,canDeleteRow:o.Dashboard.can_take_action,postgres_version:n.version});var g=[{name:"pid",label:t("PID"),editable:!1,cell:"string"},{name:"datname",label:t("Database"),editable:!1,cell:"string"},{name:"locktype",label:t("Lock type"),editable:!1,cell:"string"},{name:"relation",label:t("Target relation"),editable:!1,cell:"string"},{name:"page",label:t("Page"),editable:!1,cell:"string"},{name:"tuple",label:t("Tuple"),editable:!1,cell:"string"},{name:"virtualxid",label:t("vXID (target)"),editable:!1,cell:"string"},{name:"transactionid",label:t("XID (target)"),editable:!1,cell:"string"},{name:"classid",label:t("Class"),editable:!1,cell:"string"},{name:"objid",label:t("Object ID"),editable:!1,cell:"string"},{name:"virtualtransaction",label:t("vXID (owner)"),editable:!1,cell:"string"},{name:"mode",label:t("Mode"),editable:!1,cell:"string"},{name:"granted",label:t("Granted?"),editable:!1,cell:"string"}],m=[{name:"git",label:t("Name"),editable:!1,cell:"string"},{name:"database",label:t("Database"),editable:!1,cell:"string"},{name:"Owner",label:t("Owner"),editable:!1,cell:"string"},{name:"transaction",label:t("XID"),editable:!1,cell:"string"},{name:"prepared",label:t("Prepared at"),editable:!1,cell:"string"}],b=[{name:"name",label:t("Name"),editable:!1,cell:"string"},{name:"category",label:t("Category"),editable:!1,cell:"string"},{name:"setting",label:t("Setting"),editable:!1,cell:"string"},{name:"unit",label:t("Unit"),editable:!1,cell:"string"},{name:"short_desc",label:t("Description"),editable:!1,cell:"string"}];i(s).addClass("pg-el-container"),i(s).attr("el","sm"),o.Dashboard.render_grid(s,e("dashboard.activity"),p),o.Dashboard.render_grid(l,e("dashboard.locks"),g),o.Dashboard.render_grid(d,e("dashboard.prepared"),m),o.Dashboard.render_grid(u,e("dashboard.config"),b),o.Dashboard.render_grid_data(s),i('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){var t=f[i(e.relatedTarget).attr("aria-controls")];i(t).data("filtertext",i("#txtGridSearch").val());var n=f[i(e.target).attr("aria-controls")];i("#txtGridSearch").val(i(n).data("filtertext")),o.Dashboard.render_grid_data(n)})),i("#btn_refresh").off("click").on("click",(function(){var e=f[i("#dashboard-activity .nav-tabs .active").attr("aria-controls")];o.Dashboard.render_grid_data(e)}))}},reflectPreferencesDatabase:function(){var n=this,a=document.getElementById("database_activity"),s=document.getElementById("database_locks"),l=document.getElementById("database_prepared"),d={tab_database_activity:a,tab_database_locks:s,tab_database_prepared:l};if(n.preferences.show_activity){var u=[{name:"pid",label:t("PID"),editable:!1,cell:"string"},{name:"usename",label:t("User"),editable:!1,cell:"string"},{name:"application_name",label:t("Application"),editable:!1,cell:"string"},{name:"client_addr",label:t("Client"),editable:!1,cell:"string"},{name:"backend_start",label:t("Backend start"),editable:!1,cell:"string"},{name:"state",label:t("State"),editable:!1,cell:"string"}];u=n.version<90600?u.concat([{name:"waiting",label:t("Waiting?"),editable:!1,cell:"string"}]):u.concat([{name:"wait_event",label:t("Wait event"),editable:!1,cell:"string"},{name:"blocking_pids",label:t("Blocking PIDs"),editable:!1,cell:"string"}]);var f=new k,p=c.generateViewSchema(null,f,"create",null,null,!0);r.each(p[0].fields,(function(e){e.version=n.version})),u.unshift({name:"pg-backform-expand",label:"",cell:S,cell_priority:-1,postgres_version:n.version,schema:p}),u.unshift({name:"pg-backform-delete",label:"",cell:C,cell_action:"cancel",editable:!1,cell_priority:-1,canDeleteRow:o.Dashboard.can_take_action,postgres_version:n.version}),u.unshift({name:"pg-backform-delete",label:"",cell:C,cell_action:"terminate",editable:!1,cell_priority:-1,canDeleteRow:o.Dashboard.can_take_action,postgres_version:n.version});var h=[{name:"pid",label:t("PID"),editable:!1,cell:"string"},{name:"locktype",label:t("Lock type"),editable:!1,cell:"string"},{name:"relation",label:t("Target relation"),editable:!1,cell:"string"},{name:"page",label:t("Page"),editable:!1,cell:"string"},{name:"tuple",label:t("Tuple"),editable:!1,cell:"string"},{name:"virtualxid",label:t("vXID (target)"),editable:!1,cell:"string"},{name:"transactionid",label:t("XID (target)"),editable:!1,cell:"string"},{name:"classid",label:t("Class"),editable:!1,cell:"string"},{name:"objid",label:t("Object ID"),editable:!1,cell:"string"},{name:"virtualtransaction",label:t("vXID (owner)"),editable:!1,cell:"string"},{name:"mode",label:t("Mode"),editable:!1,cell:"string"},{name:"granted",label:t("Granted?"),editable:!1,cell:"string"}],_=[{name:"git",label:t("Name"),editable:!1,cell:"string"},{name:"Owner",label:t("Owner"),editable:!1,cell:"string"},{name:"transaction",label:t("XID"),editable:!1,cell:"string"},{name:"prepared",label:t("Prepared at"),editable:!1,cell:"string"}];i(a).addClass("pg-el-container"),i(a).attr("el","sm"),o.Dashboard.render_grid(a,e("dashboard.activity"),u),o.Dashboard.render_grid(s,e("dashboard.locks"),h),o.Dashboard.render_grid(l,e("dashboard.prepared"),_),o.Dashboard.render_grid_data(a),i('a[data-toggle="tab"]').on("shown.bs.tab",(function(e){var t=d[i(e.relatedTarget).attr("aria-controls")];i(t).data("filtertext",i("#txtGridSearch").val());var n=d[i(e.target).attr("aria-controls")];i("#txtGridSearch").val(i(n).data("filtertext")),o.Dashboard.render_grid_data(n)})),i("#btn_refresh").off("click").on("click",(function(){var e=d[i("#dashboard-activity .nav-tabs .active").attr("aria-controls")];o.Dashboard.render_grid_data(e)}))}},toggleVisibility:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];m=e,t?this.chartsDomObj&&this.chartsDomObj.unmount():this.chartsDomObj&&this.chartsDomObj.setPageVisible(m)},can_take_action:function(e){var n,a=e.collection.where({state:"active"}),i=this.get("postgres_version")||null,r="cancel"===(this.get("cell_action")||null);return i&&i>=1e5&&!e.get("datname")?(n=t(r?"You cannot cancel background worker processes.":"You cannot terminate background worker processes."),d.info(n),!1):g==e.get("datname")&&"active"==e.get("state")&&1==a.length?(n=t(r?"You are not allowed to cancel the main active session.":"You are not allowed to terminate the main active session."),d.error(n),!1):r&&"idle"==e.get("state")?(d.info(t("The session is already in idle state.")),!1):!!y||(!(!_||_!=e.get("usename"))||(n=t(r?"Superuser privileges are required to cancel another users query.":"Superuser privileges are required to terminate another users query."),d.error(n),!1))}},o.Dashboard}}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.url=function(e,t,n){var a=r.default.treeMenu.findNodeByDomElement(t),o=null;a&&a.anyFamilyMember((function(e){var t=e.getData(),a=r.default.Nodes[t._type],s=a&&a.dashboard;return(0,i.isFunction)(s)&&(s=s.apply(a,[e,t,n])),null!==(o=(0,i.isString)(s)?s:null)}));return o};var a,i=n(22),r=(a=n(11))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n(76)),i=o(n(258)),r=o(n(166));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var d=function(){function e(t,n,a,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];s(this,e),this.container=t,this.preferences=n,this.sid=a,this.did=i,this.pageVisible=r}var t,n,o;return t=e,(n=[{key:"render",value:function(){this.container&&this.preferences.show_graphs&&i.default.render(a.default.createElement(r.default,{sid:this.sid,did:this.did,preferences:this.preferences,pageVisible:this.pageVisible}),this.container)}},{key:"unmount",value:function(){this.container&&i.default.unmountComponentAtNode(this.container)}},{key:"setSidDid",value:function(e,t){this.sid=e,this.did=t,this.render()}},{key:"reflectPreferences",value:function(e){this.preferences=e,e.show_graphs?this.render():this.unmount()}},{key:"setPageVisible",value:function(e){this.pageVisible=e,this.render()}}])&&l(t.prototype,n),o&&l(t,o),e}();t.default=d},function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(21),n(24),n(25),n(31),n(41),n(40),n(85),n(59),n(14),n(23),n(35),n(42),n(27),n(10),n(70),n(3),n(34),n(71),n(43),n(12),n(36),n(29),n(19),n(44),n(46),n(16),Object.defineProperty(t,"__esModule",{value:!0}),t.transformData=x,t.legendCallback=C,t.getStatsUrl=S,t.statsReducer=k,t.default=E,t.GraphsWrapper=q,t.POINT_SIZE=t.X_AXIS_LENGTH=void 0;var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=h();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(76)),r=n(167),o=n(168),s=p(n(6)),l=p(n(54)),d=p(n(2)),c=n(22),u=n(169),f=p(n(108));function p(e){return e&&e.__esModule?e:{default:e}}function h(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return h=function(){return e},e}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}return n}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}t.X_AXIS_LENGTH=75;function x(e,t){var n=["#00BCD4","#9CCC65","#E64A19"],a=Object.keys(e).map((function(t,a){return{label:t,data:e[t]||[],borderColor:n[a],backgroundColor:n[a],pointHitRadius:2}}))||[];return{labels:v(Array(75).keys()),datasets:a,refreshRate:t}}function C(e){var t=[];t.push('<div class="'+e.id+'-legend d-flex">');for(var n=0;n<e.data.datasets.length;n++)t.push('<div class="legend-value"><span style="background-color:'+e.data.datasets[n].backgroundColor+'">&nbsp;&nbsp;&nbsp;&nbsp;</span>'),e.data.datasets[n].label&&t.push('<span class="legend-label">'+e.data.datasets[n].label+"</span>"),t.push("</div>");return t.push("</div>"),t.join("")}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=(0,s.default)("dashboard.dashboard_stats");return a+="/"+e,a+=t>0?"/"+t:"",a+="?chart_names="+n.join(",")}function k(e,t){if(t.reset)return t.reset;if(!t.incoming)return e;t.counterData||(t.counterData=t.incoming);var n={};return Object.keys(t.incoming).forEach((function(a){e[a]?n[a]=[t.counter?t.incoming[a]-t.counterData[a]:t.incoming[a]].concat(v(e[a].slice(0,74))):n[a]=[t.counter?t.incoming[a]-t.counterData[a]:t.incoming[a]]})),n}t.POINT_SIZE=2;var T={session_stats:{Total:[],Active:[],Idle:[]},tps_stats:{Transactions:[],Commits:[],Rollbacks:[]},ti_stats:{Inserts:[],Updates:[],Delete:[]},to_stats:{Fetched:[],Returned:[]},bio_stats:{Reads:[],Hits:[]}};function E(e){var t=e.preferences,n=e.sid,a=e.did,r=e.pageVisible,o=e.enablePoll,s=void 0===o||o,f=(0,i.useRef)(null),p=(0,u.usePrevious)(t),h=b((0,i.useReducer)(k,T.session_stats),2),_=h[0],m=h[1],v=b((0,i.useReducer)(k,T.tps_stats),2),y=v[0],w=v[1],C=b((0,i.useReducer)(k,T.ti_stats),2),E=C[0],O=C[1],P=b((0,i.useReducer)(k,T.to_stats),2),D=P[0],N=P[1],j=b((0,i.useReducer)(k,T.bio_stats),2),M=j[0],R=j[1],A=b((0,i.useState)({}),2),I=A[0],L=A[1],B=b((0,i.useState)(null),2),V=B[0],U=B[1],H=b((0,i.useState)(1e3),2),F=H[0],z=H[1],$=b((0,i.useState)(!1),2),K=$[0],G=$[1];return(0,i.useEffect)((function(){var e=!1;p?(p.session_stats_refresh!=t.session_stats_refresh&&(m({reset:T.session_stats}),e=!0),p.tps_stats_refresh!=t.tps_stats_refresh&&(w({reset:T.tps_stats}),e=!0),p.ti_stats_refresh!=t.ti_stats_refresh&&(O({reset:T.ti_stats}),e=!0),p.to_stats_refresh!=t.to_stats_refresh&&(N({reset:T.to_stats}),e=!0),p.bio_stats_refresh!=t.bio_stats_refresh&&(R({reset:T.bio_stats}),e=!0)):e=!0,e&&z(1e3*(0,c.getGCD)(Object.keys(T).map((function(e){return t[e+"_refresh"]}))))}),[t]),(0,i.useEffect)((function(){r&&!K&&G(!0)}),[r]),(0,u.useInterval)((function(){var e=(0,c.getEpoch)();if(null===f.current){var i={};Object.keys(T).forEach((function(t){i[t]=e})),f.current=i}var r=[];Object.keys(T).forEach((function(n){e>=f.current[n]&&(r.push(n),f.current[n]=e+t[n+"_refresh"])}));var o=S(n,a,r);l.default.get(o).then((function(e){var t=e.data;U(null),m({incoming:t.session_stats}),w({incoming:t.tps_stats,counter:!0,counterData:I.tps_stats}),O({incoming:t.ti_stats,counter:!0,counterData:I.ti_stats}),N({incoming:t.to_stats,counter:!0,counterData:I.to_stats}),R({incoming:t.bio_stats,counter:!0,counterData:I.bio_stats}),L((function(e){return g(g({},e),t)}))})).catch((function(e){if(!V)if(m({reset:T.session_stats}),w({reset:T.tps_stats}),O({reset:T.ti_stats}),N({reset:T.to_stats}),R({reset:T.bio_stats}),L({}),e.response)428===e.response.status?U((0,d.default)("Please connect to the selected server to view the graph.")):U((0,d.default)("An error occurred whilst rendering the graph."));else{if(e.request)return void U((0,d.default)("Not connected to the server or the connection to the server has been closed."));console.error(e)}}))}),s?F:-1),i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{"data-testid":"graph-poll-delay",className:"d-none"},F),K&&i.default.createElement(q,{sessionStats:x(_,t.session_stats_refresh),tpsStats:x(y,t.tps_stats_refresh),tiStats:x(E,t.ti_stats_refresh),toStats:x(D,t.to_stats_refresh),bioStats:x(M,t.bio_stats_refresh),errorMsg:V,showTooltip:t.graph_mouse_track,showDataPoints:t.graph_data_points,isDatabase:a>0}))}function q(e){var t=(0,i.useRef)(),n=(0,i.useRef)(),a=(0,i.useRef)(),s=(0,i.useRef)(),l=(0,i.useRef)(),c=(0,i.useMemo)((function(){return{normalized:!0,legendCallback:C,animation:{duration:0},hover:{animationDuration:0},responsiveAnimationDuration:0,legend:{display:!1},elements:{point:{radius:e.showDataPoints?2:0}},tooltips:{enabled:e.showTooltip,callbacks:{title:function(e,t){var n="";try{n=parseInt(e[0].xLabel)*t.refreshRate+(0,d.default)(" seconds ago")}catch(e){n=""}return n}}},scales:{yAxes:[{ticks:{min:0,userCallback:function(e){if(Math.floor(e)===e)return e},fontColor:getComputedStyle(document.documentElement).getPropertyValue("--color-fg")},gridLines:{drawBorder:!1,zeroLineColor:getComputedStyle(document.documentElement).getPropertyValue("--border-color"),color:getComputedStyle(document.documentElement).getPropertyValue("--border-color")}}],xAxes:[{display:!1,gridLines:{display:!1},ticks:{display:!1,reverse:!0}}]}}}),[e.showTooltip,e.showDataPoints]),u=(0,i.useMemo)((function(){return{duration:0}}),[]),f=(0,i.useCallback)((function(e){return function(t){e.current.innerHTML=t.generateLegend()}}));return i.default.createElement(i.default.Fragment,null,i.default.createElement(o.DashboardRow,null,i.default.createElement(o.DashboardRowCol,{breakpoint:"md",parts:6},i.default.createElement(o.ChartContainer,{id:"sessions-graph",title:e.isDatabase?(0,d.default)("Database sessions"):(0,d.default)("Server sessions"),legendRef:t,errorMsg:e.errorMsg},i.default.createElement(r.LineChart,{options:c,data:e.sessionStats,updateOptions:u,onInit:f(t)}))),i.default.createElement(o.DashboardRowCol,{breakpoint:"md",parts:6},i.default.createElement(o.ChartContainer,{id:"tps-graph",title:(0,d.default)("Transactions per second"),legendRef:n,errorMsg:e.errorMsg},i.default.createElement(r.LineChart,{options:c,data:e.tpsStats,updateOptions:u,onInit:f(n)})))),i.default.createElement(o.DashboardRow,null,i.default.createElement(o.DashboardRowCol,{breakpoint:"md",parts:4},i.default.createElement(o.ChartContainer,{id:"ti-graph",title:(0,d.default)("Tuples in"),legendRef:a,errorMsg:e.errorMsg},i.default.createElement(r.LineChart,{options:c,data:e.tiStats,updateOptions:u,onInit:f(a)}))),i.default.createElement(o.DashboardRowCol,{breakpoint:"md",parts:4},i.default.createElement(o.ChartContainer,{id:"to-graph",title:(0,d.default)("Tuples out"),legendRef:s,errorMsg:e.errorMsg},i.default.createElement(r.LineChart,{options:c,data:e.toStats,updateOptions:u,onInit:f(s)}))),i.default.createElement(o.DashboardRowCol,{breakpoint:"md",parts:4},i.default.createElement(o.ChartContainer,{id:"bio-graph",title:(0,d.default)("Block I/O"),legendRef:l,errorMsg:e.errorMsg},i.default.createElement(r.LineChart,{options:c,data:e.bioStats,updateOptions:u,onInit:f(l)})))))}E.propTypes={preferences:f.default.object.isRequired,sid:f.default.oneOfType([f.default.string.isRequired,f.default.number.isRequired]),did:f.default.oneOfType([f.default.string.isRequired,f.default.number.isRequired]),enablePoll:f.default.bool};var O=f.default.shape({labels:f.default.array.isRequired,datasets:f.default.array,refreshRate:f.default.number.isRequired});q.propTypes={sessionStats:O.isRequired,tpsStats:O.isRequired,tiStats:O.isRequired,toStats:O.isRequired,bioStats:O.isRequired,errorMsg:f.default.string,showTooltip:f.default.bool.isRequired,showDataPoints:f.default.bool.isRequired,isDatabase:f.default.bool.isRequired}},function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(21),n(24),n(25),n(41),n(40),n(15),n(14),n(97),n(70),n(3),n(34),n(71),n(43),n(12),n(19),n(44),n(46),n(16),Object.defineProperty(t,"__esModule",{value:!0}),t.default=_,t.LineChart=function(e){return i.default.createElement(_,d({},e,{type:"line"}))};var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=l();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(76)),r=s(n(259)),o=s(n(108));function s(e){return e&&e.__esModule?e:{default:e}}function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var h={responsive:!0,maintainAspectRatio:!1,elements:{line:{tension:0,borderWidth:2,fill:!1}},layout:{padding:8},hover:{animationDuration:0}};function _(e){var t=e.type,n=void 0===t?"line":t,a=e.id,o=e.options,s=e.data,l=e.redraw,d=void 0!==l&&l,c=p(e,["type","id","options","data","redraw"]),f=i.default.useRef(),_=i.default.useRef(),g=r.default.helpers.configMerge(h,o),m=function(){var e=f.current.getContext("2d");_.current=new r.default(e,{type:n,data:s,options:g}),c.onInit&&c.onInit(_.current)},b=function(){_.current&&_.current.destroy()};return(0,i.useEffect)((function(){return m(),b}),[]),(0,i.useEffect)((function(){if(void 0!==_.current){_.current.data=s;for(var e=0;e<_.current.data.datasets.length;e++)_.current.data.datasets[e]=u(u({},_.current.data.datasets[e]),s.datasets[e]);_.current.options=g,_.current.update(c.updateOptions||{}),c.onUpdate&&c.onUpdate(_.current)}}),[s,o]),(0,i.useEffect)((function(){d&&(b(),m())}),[d]),i.default.createElement("canvas",{id:a,ref:f})}_.propTypes={type:o.default.string.isRequired,data:o.default.object.isRequired,options:o.default.object,updateOptions:o.default.object,onInit:o.default.func,onUpdate:o.default.func}},function(e,t,n){"use strict";n(31),n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.ChartContainer=o,t.ChartError=s,t.DashboardRow=l,t.DashboardRowCol=d;var a=r(n(76)),i=r(n(108));function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return a.default.createElement("div",{className:"card dashboard-graph",role:"object-document",tabIndex:"0","aria-labelledby":e.id},a.default.createElement("div",{className:"card-header"},a.default.createElement("div",{className:"d-flex"},a.default.createElement("div",{id:e.id},e.title),a.default.createElement("div",{className:"ml-auto my-auto legend",ref:e.legendRef}))),a.default.createElement("div",{className:"card-body dashboard-graph-body"},a.default.createElement("div",{className:"chart-wrapper "+(e.errorMsg?"d-none":"")},e.children),a.default.createElement(s,{message:e.errorMsg})))}function s(e){return null===e.message?a.default.createElement(a.default.Fragment,null):a.default.createElement("div",{className:"pg-panel-error pg-panel-message",role:"alert"},e.message)}function l(e){var t=e.children;return a.default.createElement("div",{className:"row dashboard-row"},t)}function d(e){var t=e.breakpoint,n=e.parts,i=e.children;return a.default.createElement("div",{className:"col-".concat(t,"-").concat(n)},i)}o.propTypes={id:i.default.string.isRequired,title:i.default.string.isRequired,legendRef:i.default.oneOfType([i.default.func,i.default.shape({current:i.default.any})]).isRequired,children:i.default.node.isRequired,errorMsg:i.default.string},s.propTypes={message:i.default.string},l.propTypes={children:i.default.node.isRequired},d.propTypes={breakpoint:i.default.oneOf(["xs","sm","md","lg","xl"]).isRequired,parts:i.default.number.isRequired,children:i.default.node.isRequired}},function(e,t,n){"use strict";n(3),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.useInterval=function(e,t){var n=(0,a.useRef)();(0,a.useEffect)((function(){n.current=e})),(0,a.useEffect)((function(){if(t>-1){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])},t.usePrevious=function(e){var t=(0,a.useRef)();return(0,a.useEffect)((function(){t.current=e})),t.current};var a=n(76)},function(e,t,n){"use strict";var a,i;n(8),n(15),n(48),n(18),n(10),n(7),a=[n(2),n(1),n(0),n(20),n(4),n(11),n(33),n(52),n(171),n(172)],void 0===(i=function(e,t,n,a,i,r,o,s,l,d){if(r.NodeStatistics)return r.NodeStatistics;if(r.NodeStatistics=r.NodeStatistics||{},r.NodeStatistics.initialized)return r.NodeStatistics;var c=o.SizeFormatter=function(){};t.extend(c.prototype,{fromRaw:function(e){return l(e)},toRaw:function(e){return e}});var u=o.Extension.SwitchCell.extend({defaults:t.extend({},o.Extension.SwitchCell.prototype.defaults)}),f={16:u,20:o.IntegerCell,21:o.IntegerCell,23:o.IntegerCell,700:o.NumberCell,701:o.NumberCell,1700:o.NumberCell,702:o.DatetimeCell,703:o.DatetimeCell,1082:o.DatetimeCell.extend({includeDate:!0,includeTime:!1,includeMilli:!1}),1083:o.DatetimeCell.extend({includeDate:!1,includeTime:!0,includeMilli:!0}),1114:o.DatetimeCell.extend({includeDate:!0,includeTime:!0,includeMilli:!0}),1184:"string",1266:"string"},p=window.wcDocker;return t.extend(u.prototype.defaults.options,{onText:e("True"),offText:e("False"),onColor:"success",offColor:"ternary",size:"mini"}),t.extend(r.NodeStatistics,{init:function(){if(!this.initialized){this.initialized=!0,t.bindAll(this,"showStatistics","panelVisibilityChanged","__createMultiLineStatistics","__createSingleLineStatistics","__loadMoreRows"),t.extend(this,{initialized:!0,collection:new a.Collection(null),statistic_columns:[{editable:!1,name:"statistics",label:e("Statistics"),cell:"string",headerCell:o.Extension.CustomHeaderCell,cellHeaderClasses:"width_percent_25"},{editable:!1,name:"value",label:e("Value"),cell:"string"}],panel:r.docker.findPanels("statistics"),columns:null,grid:null});var i=this;r.Events.on("pgadmin-browser:panel-statistics:"+p.EVENT.VISIBILITY_CHANGED,this.panelVisibilityChanged),r.Events.on("pgadmin:browser:node:updated",(function(){this.panel&&this.panel.length&&(n(this.panel[0]).data("node-prop",""),this.panelVisibilityChanged(this.panel[0]))}),this),0==this.panel.length?r.Events.on("pgadmin-browser:panel-statistics:"+p.EVENT.INIT,function(){i.panel=r.docker.findPanels("statistics"),(i.panel[0].isVisible()||1!=i.panel.length)&&(r.Events.on("pgadmin-browser:tree:selected",this.showStatistics),r.Events.on("pgadmin-browser:tree:refreshing",this.refreshStatistics,this))}.bind(this)):(i.panel[0].isVisible()||1!=i.panel.length)&&(r.Events.on("pgadmin-browser:tree:selected",this.showStatistics),r.Events.on("pgadmin-browser:tree:refreshing",this.refreshStatistics,this)),i.panel.length>0&&i.panel[0].isVisible()&&(r.Events.on("pgadmin-browser:tree:selected",this.showStatistics),r.Events.on("pgadmin-browser:tree:refreshing",this.refreshStatistics,this))}},__updateCollection:function(a,l,c,u){var f=this.panel[0].layout().scene().find(".pg-panel-content"),h=f.find(".pg-panel-statistics-message"),_=f.find(".pg-panel-statistics-container"),g=this.panel,m=this,b="",v=u;if(l){b=e("No statistics are available for the selected object.");var y=l.getTreeNodeHierarchy(c),w={node_type:u,url:a};if(t.isEqual(n(g[0]).data("node-prop"),w))return;if(n(g[0]).data("node-prop",w),d.nodeHasStatistics(l,c)){var x;b="";!function t(){n.ajax({url:a,type:"GET",beforeSend:function(t){t.setRequestHeader(i.csrf_token_header,i.csrf_token),x=setTimeout((function(){h.text(e("Retrieving data from the server...")),h.removeClass("d-none"),m.grid&&m.grid.remove()}),1e3)}}).done((function(t){if(clearTimeout(x),h.text(""),t.data){var n=m.data=t.data;l.hasCollectiveStatistics||n.rows.length>1?(r.Events.on("pgadmin-browser:panel-statistics:"+p.EVENT.SCROLLED,m.__loadMoreRows),m.__createMultiLineStatistics.call(m,n,l.statsPrettifyFields)):(r.Events.off("pgadmin-browser:panel-statistics:"+p.EVENT.SCROLLED,m.__loadMoreRows),m.__createSingleLineStatistics.call(m,n,l.statsPrettifyFields)),m.grid&&(delete m.grid,m.grid=null),m.grid=new o.Grid({emptyText:e("No data found"),columns:m.columns,collection:m.collection,className:"backgrid presentation table table-bordered table-noouter-border table-hover"}),m.grid.render(),_.empty(),_.append(m.grid.$el),h.hasClass("d-none")||h.addClass("d-none"),_.removeClass("d-none")}else t.info&&(_.hasClass("d-none")||_.addClass("d-none"),h.text(t.info),h.removeClass("d-none"))})).fail((function(n,a,i){var o=y[v].label;r.Events.trigger("pgadmin:node:retrieval:error","statistics",n,a,i,c),s.pgHandleItemError(n,a,i,{item:c,info:y})||s.pgNotifier(a,n,e("Error retrieving the information - %s",i||o),(function(e){"CRYPTKEY_SET"===e?t():console.warn(arguments)})),h.text(e("Failed to retrieve data from the server."))}))}()}}""!=b&&(_.hasClass("d-none")||_.addClass("d-none"),h.removeClass("d-none"),h.text(b))},refreshStatistics:function(e,a,i){var r={node_type:a._type,url:i.generate_url(e,"stats",a,!0)};t.isEqual(n(this.panel[0]).data("node-prop"),r)&&(n(this.panel[0]).data("node-prop",""),this.showStatistics(e,a,i))},showStatistics:function(e,t,n){var a=this;n&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout((function(){a.__updateCollection.call(a,n.generate_url(e,"stats",t,!0),n,e,t._type)}),400))},__createMultiLineStatistics:function(e,n){var a=e.rows,i=e.columns;for(var r in this.columns=[],i){var o=i[r],s=f[o.type_code]||"string";"PID"==o.name&&(s=s.extend({orderSeparator:""}));var l={editable:!1,name:o.name,cell:s};-1!=t.indexOf(n,o.name)&&(l.formatter=c),this.columns.push(l)}this.collection.reset(a.splice(0,50))},__loadMoreRows:function(){var e=n(".pg-panel-statistics-container").closest(".wcFrameCenter")[0];if(e.scrollHeight-10<e.scrollTop+e.offsetHeight){var t=this.data.rows;t.length>0&&this.collection.add(t.splice(0,50))}},__createSingleLineStatistics:function(e,n){var a,i=e.rows[0],r=e.columns,o=[];for(var s in this.columns=this.statistic_columns,r)a=r[s].name,o.push({statistics:a,value:i&&i[a]?-1!=t.indexOf(n,a)?l(i[a]):i[a]:null});this.collection.reset(o)},panelVisibilityChanged:function(e){if(e.isVisible()){var t=r.tree,n=t.selected(),a=n&&t.itemData(n),i=n&&a&&r.Nodes[a._type];r.NodeStatistics.showStatistics.apply(r.NodeStatistics,[n,a,i]),r.Events.on("pgadmin-browser:tree:selected",r.NodeStatistics.showStatistics),r.Events.on("pgadmin-browser:tree:refreshing",r.NodeStatistics.refreshStatistics,this)}else r.Events.off("pgadmin-browser:tree:selected",r.NodeStatistics.showStatistics),r.Events.off("pgadmin-browser:tree:refreshing",r.NodeStatistics.refreshStatistics,this)}}),r.NodeStatistics}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";var a;void 0===(a=function(){return function(e){var t=Math.abs(e),n=0,a=["bytes","kB","MB","GB","TB","PB"];if(t<10240)return t+" "+a[n];do{t/=1024,n+=1}while(t>10239);return Math.round(t)+" "+a[n]}}.apply(t,[]))||(e.exports=a)},function(e,t,n){"use strict";n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.nodeHasStatistics=function(e,t){if("function"==typeof e.hasStatistics){var n=e.getTreeNodeHierarchy(t);return e.hasStatistics(n)}return e.hasStatistics}},function(e,t,n){"use strict";var a,i;n(8),n(48),n(5),n(9),n(7),a=[n(2),n(1),n(0),n(20),n(4),n(11),n(13),n(33),n(22)],void 0===(i=function(e,t,n,a,i,r,o,s,l){if(r.NodeDependencies)return r.NodeDependencies;var d=window.wcDocker;return r.NodeDependencies=r.NodeDependencies||{},t.extend(r.NodeDependencies,{init:function(){if(!this.initialized){this.initialized=!0,this.dependenciesPanel=r.docker.findPanels("dependencies")[0],t.bindAll(this,"showDependencies","__loadMoreRows","__appendGridToPanel");var e=a.Model.extend({defaults:{icon:"icon-unknown",type:void 0,name:void 0,field:void 0},parse:function(e){var n=r.Nodes[e.type];return null!=e.icon&&""!=e.icon||(e.icon=n?t.isFunction(n.node_image)?n.node_image.apply(n,[null,null]):n.node_image||"icon-"+e.type:"icon-"+e.type),e.type=l.titleize(e.type.replace(/_/g," "),!0),e}});this.dependenciesCollection=new(a.Collection.extend({model:e}))(null),r.Events.on("pgadmin-browser:tree:selected",this.showDependencies),this.__appendGridToPanel()}},__appendGridToPanel:function(){var t=this.dependenciesPanel.layout().scene().find(".pg-panel-content").find(".pg-panel-dependencies-container"),a=new s.Grid({emptyText:e("No data found"),columns:[{name:"type",label:e("Type"),cell:s.Cell.extend({render:function(){return s.Cell.prototype.render.apply(this,arguments),this.$el.prepend(n("<i>",{class:"wcTabIcon "+this.model.get("icon")})),this}}),editable:!1},{name:"name",label:e("Name"),cell:"string",editable:!1},{name:"field",label:e("field"),cell:"string",editable:!1}],collection:this.dependenciesCollection,className:"backgrid table presentation table-bordered table-noouter-border table-hover"});return this.dependenciesGrid=a,t.append(a.render().el),!0},showDependencies:function(t,a,s){var l=this,c=e("Please select an object in the tree view."),u=this.dependenciesPanel.layout().scene().find(".pg-panel-content"),f=u.find(".pg-panel-depends-message"),p=u.find(".pg-panel-dependencies-container"),h=s.getTreeNodeHierarchy(t),_=a._type,g=s.generate_url(t,"dependency",a,!0);if(s&&(c=e("No dependency information is available for the selected object."),s.hasDepends)){this.dependenciesGrid.columns.models[2].set({label:e("Restriction")}),f.addClass("d-none"),p.removeClass("d-none");var m="";n.ajax({url:g,type:"GET",beforeSend:function(t){t.setRequestHeader(i.csrf_token_header,i.csrf_token),m=setTimeout((function(){f.text(e("Fetching dependency information from the server...")),f.removeClass("d-none"),c=""}),1e3)}}).done((function(e){clearTimeout(m),e.length>0?(f.hasClass("d-none")||f.addClass("d-none"),p.removeClass("d-none"),l.dependenciesData=e,l.dependenciesCollection.reset(l.dependenciesData.splice(0,100),{parse:!0}),r.Events.on("pgadmin-browser:panel-dependencies:"+d.EVENT.SCROLLED,l.__loadMoreRows)):(r.Events.off("pgadmin-browser:panel-dependencies:"+d.EVENT.SCROLLED),l.dependenciesCollection.reset({silent:!0}),f.text(c),f.removeClass("d-none"),p.hasClass("d-none")||p.addClass("d-none"))})).fail((function(n,i,d){var c=h[_].label;r.Events.trigger("pgadmin:node:retrieval:error","depends",n,i,d),o.pgHandleItemError(n,i,d,{item:t,info:h})||o.pgNotifier(i,n,e("Error retrieving data from the server: %s",d||c),(function(e){"CRYPTKEY_SET"===e?l.showDependencies(t,a,s):console.warn(arguments)})),f.text(e("Failed to retrieve data from the server."))}))}""!=c&&(f.text(c),f.removeClass("d-none"),p.hasClass("d-none")||p.addClass("d-none"))},__loadMoreRows:function(){if(!(this.dependenciesPanel.length<1)){var e=this.dependenciesPanel.$container.find(".pg-panel-dependencies-container").closest(".wcFrameCenter")[0];e.scrollHeight-10<e.scrollTop+e.offsetHeight&&this.dependenciesData.length>0&&this.dependenciesCollection.add(this.dependenciesData.splice(0,100),{parse:!0})}}}),r.NodeDependencies}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";var a,i;n(8),n(48),n(5),n(9),n(7),a=[n(2),n(1),n(0),n(20),n(4),n(11),n(13),n(33),n(22)],void 0===(i=function(e,t,n,a,i,r,o,s,l){if(r.NodeDependents)return r.NodeDependents;var d=window.wcDocker;return r.NodeDependents=r.NodeDependents||{},t.extend(r.NodeDependents,{init:function(){if(!this.initialized){this.initialized=!0,this.dependentsPanel=r.docker.findPanels("dependents")[0],t.bindAll(this,"showDependents","__loadMoreRows","__appendGridToPanel");var e=a.Model.extend({defaults:{icon:"icon-unknown",type:void 0,name:void 0,field:void 0},parse:function(e){var n=r.Nodes[e.type];return null!=e.icon&&""!=e.icon||(e.icon=n?t.isFunction(n.node_image)?n.node_image.apply(n,[null,null]):n.node_image||"icon-"+e.type:"icon-"+e.type),e.type=l.titleize(e.type.replace(/_/g," "),!0),e}});this.dependentCollection=new(a.Collection.extend({model:e}))(null),r.Events.on("pgadmin-browser:tree:selected",this.showDependents),r.Events.on("pgadmin-browser:tree:refreshing",this.refreshDependents,this),this.__appendGridToPanel()}},__appendGridToPanel:function(){var t=this.dependentsPanel.layout().scene().find(".pg-panel-content").find(".pg-panel-dependents-container"),a=new s.Grid({emptyText:e("No data found"),columns:[{name:"type",label:e("Type"),cell:s.Cell.extend({render:function(){return s.Cell.prototype.render.apply(this,arguments),this.$el.prepend(n("<i>",{class:"wcTabIcon "+this.model.get("icon")})),this}}),editable:!1},{name:"name",label:e("Name"),cell:"string",editable:!1},{name:"field",label:e("field"),cell:"string",editable:!1}],collection:this.dependentCollection,className:"backgrid table presentation table-bordered table-noouter-border table-hover"});return this.dependentGrid=a,t.append(a.render().el),!0},showDependents:function(t,a,s){var l=this,c=e("Please select an object in the tree view."),u=this.dependentsPanel.layout().scene().find(".pg-panel-content"),f=u.find(".pg-panel-depends-message"),p=u.find(".pg-panel-dependents-container"),h=s.getTreeNodeHierarchy(t),_=a._type,g=s.generate_url(t,"dependent",a,!0);if(s&&(c=e("No dependent information is available for the selected object."),s.hasDepends)){"tablespace"==s.type||"role"==s.type?this.dependentGrid.columns.models[2].set({label:e("Database")}):this.dependentGrid.columns.models[2].set({label:e("Restriction")}),f.addClass("d-none"),p.removeClass("d-none");var m="";n.ajax({url:g,type:"GET",beforeSend:function(t){t.setRequestHeader(i.csrf_token_header,i.csrf_token),m=setTimeout((function(){f.text(e("Fetching dependent information from the server...")),f.removeClass("d-none"),c=""}),1e3)}}).done((function(e){clearTimeout(m),e.length>0?(f.hasClass("d-none")||f.addClass("d-none"),p.removeClass("d-none"),l.dependentData=e,l.dependentCollection.reset(l.dependentData.splice(0,100),{parse:!0}),r.Events.on("pgadmin-browser:panel-dependents:"+d.EVENT.SCROLLED,l.__loadMoreRows)):(r.Events.off("pgadmin-browser:panel-dependents:"+d.EVENT.SCROLLED),l.dependentCollection.reset({silent:!0}),f.text(c),f.removeClass("d-none"),p.hasClass("d-none")||p.addClass("d-none"))})).fail((function(n,i,d){var c=h[_].label;r.Events.trigger("pgadmin:node:retrieval:error","depends",n,i,d),o.pgHandleItemError(n,i,d,{item:t,info:h})||o.pgNotifier(i,n,e("Error retrieving data from the server: %s",d||c),(function(e){"CRYPTKEY_SET"===e?l.showDependents(t,a,s):console.warn(arguments)})),f.text(e("Failed to retrieve data from the server."))}))}""!=c&&(f.text(c),f.removeClass("d-none"),p.hasClass("d-none")||p.addClass("d-none"))},__loadMoreRows:function(){if(!(this.dependentsPanel.length<1)){var e=this.dependentsPanel.$container.find(".pg-panel-dependents-container").closest(".wcFrameCenter")[0];e.scrollHeight-10<e.scrollTop+e.offsetHeight&&this.dependentData.length>0&&this.dependentCollection.add(this.dependentData.splice(0,100),{parse:!0})}}}),r.NodeDependents}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";var a,i;n(18),n(7),a=[n(2),n(1),n(0),n(4),n(11),n(13)],void 0===(i=function(e,t,n,a,i,r){if(i.ShowNodeSQL=i.ShowNodeSQL||{},i.ShowNodeSQL.initialized)return i.ShowNodeSQL;var o=window.wcDocker;return t.extend(i.ShowNodeSQL,{init:function(){var e;this.initialized||(this.initialized=!0,t.bindAll(this,"showSQL","sqlPanelVisibilityChanged"),this.sqlPanels=e=i.docker.findPanels("sql"),i.Events.on("pgadmin-browser:panel-sql:"+o.EVENT.VISIBILITY_CHANGED,this.sqlPanelVisibilityChanged),i.Events.on("pgadmin:browser:node:updated",(function(){this.sqlPanels&&this.sqlPanels.length&&(n(this.sqlPanels[0]).data("node-prop",""),this.sqlPanelVisibilityChanged(this.sqlPanels[0]))}),this),0==e.length?i.Events.on("pgadmin-browser:panel-sql:"+o.EVENT.INIT,function(){(e[0].isVisible()||1!=e.length)&&(i.Events.on("pgadmin-browser:tree:selected",this.showSQL),i.Events.on("pgadmin-browser:tree:refreshing",this.refreshSQL,this))}.bind(this)):(e[0].isVisible()||1!=e.length)&&(i.Events.on("pgadmin-browser:tree:selected",this.showSQL),i.Events.on("pgadmin-browser:tree:refreshing",this.refreshSQL,this)))},refreshSQL:function(e,a,i){var r={node_type:a._type,url:i.generate_url(e,"sql",a,!0)};t.isEqual(n(this.sqlPanels[0]).data("node-prop"),r)&&(n(this.sqlPanels[0]).data("node-prop",""),this.showSQL(e,a,i))},showSQL:function(o,s,l){this.timeout&&clearTimeout(this.timeout);var d=this;this.timeout=setTimeout((function(){var c="-- "+e("Please select an object in the tree view.");if(l){c="-- "+e("No SQL could be generated for the selected object.");var u=s._type,f=l.generate_url(o,"sql",s,!0),p=l.getTreeNodeHierarchy(o),h={node_type:u,url:f};if(t.isEqual(n(d.sqlPanels[0]).data("node-prop"),h))return;if(n(d.sqlPanels[0]).data("node-prop",h),l.hasSQL){var _;c="";!function t(){n.ajax({url:f,type:"GET",beforeSend:function(t){t.setRequestHeader(a.csrf_token_header,a.csrf_token),_=setTimeout((function(){a.Browser.editor.setValue(e("Retrieving data from the server..."))}),1e3)}}).done((function(e){a.Browser.editor.getValue()!=e&&a.Browser.editor.setValue(e),clearTimeout(_)})).fail((function(n,a,s){var l=p[u].label;i.Events.trigger("pgadmin:node:retrieval:error","sql",n,a,s,o),r.pgHandleItemError(n,a,s,{item:o,info:p})||r.pgNotifier(a,n,e("Error retrieving the information - %s",s||l),(function(e){"CRYPTKEY_SET"===e?t():console.warn(arguments)}))}))}()}}""!=c&&a.Browser.editor.setValue(c)}),400)},sqlPanelVisibilityChanged:function(e){if(e.isVisible()){var t=i.tree,n=t.selected(),a=n&&t.itemData(n),r=n&&a&&i.Nodes[a._type];i.ShowNodeSQL.showSQL.apply(i.ShowNodeSQL,[n,a,r]),i.Events.on("pgadmin-browser:tree:selected",i.ShowNodeSQL.showSQL),i.Events.on("pgadmin-browser:tree:refreshing",i.ShowNodeSQL.refreshSQL,this)}else i.Events.off("pgadmin-browser:tree:selected",i.ShowNodeSQL.showSQL),i.Events.off("pgadmin-browser:tree:refreshing",i.ShowNodeSQL.refreshSQL,this)}}),i.ShowNodeSQL}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";var a,i;n(31),n(8),n(23),n(27),n(18),n(12),n(74),n(36),n(61),n(5),n(29),n(7),a=[n(4),n(2),n(6),n(1),n(0),n(11),n(52)],void 0===(i=function(e,t,n,a,i,r,o){if(r.BackgroundProcessObsorver=r.BackgroundProcessObsorver||{},r.BackgroundProcessObsorver.initialized)return r.BackgroundProcessObsorver;var s="True"==e.server_mode,l=window.wcDocker,d=function(e,t){var n=this;setTimeout((function(){n.initialize.apply(n,[e,t])}),1)};return a.extend(d.prototype,{success_status_tpl:a.template('\n      <div class="d-flex px-2 py-1 bg-success-light border border-success rounded">\n        <div class="pr-2">\n          <i class="fa fa-check text-success pg-bg-status-icon" aria-hidden="true" role="img"></i>\n        </div>\n        <div class="mx-auto pg-bg-status-text alert-text-body"><%-status_text%></div>\n      </div>'),failed_status_tpl:a.template('\n      <div class="d-flex px-2 py-1 bg-danger-lighter border border-danger rounded">\n        <div class="pr-2">\n          <i class="fa fa-times fa-lg text-danger pg-bg-status-icon" aria-hidden="true" role="img"></i>\n        </div>\n        <div class="mx-auto pg-bg-status-text alert-text-body"><%-status_text%></div>\n      </div>'),other_status_tpl:a.template('\n      <div class="d-flex px-2 py-1 bg-primary-light border border-primary rounded">\n        <div class="pr-2">\n          <i class="fa fa-info fa-lg text-primary pg-bg-status-icon" aria-hidden="true" role="img"></i>\n        </div>\n        <div class="mx-auto pg-bg-status-text alert-text-body"><%-status_text%></div>\n      </div>'),initialize:function(e,t){a.extend(this,{details:!1,notify:a.isUndefined(t)||t,curr_status:null,state:0,completed:!1,current_storage_dir:null,id:e.id,type_desc:null,desc:null,detailed_desc:null,stime:null,exit_code:null,acknowledge:e.acknowledge,execution_time:null,out:-1,err:-1,lot_more:!1,notifier:null,container:null,panel:null,logs:i("<ol></ol>",{class:"pg-bg-process-logs"})}),this.notify&&(r.Events&&r.Events.on("pgadmin-bgprocess:started:"+this.id,(function(e){e.notifier||e.show.apply(e)})),r.Events&&r.Events.on("pgadmin-bgprocess:finished:"+this.id,(function(e){e.notifier||e.show.apply(e)})));var n=this;setTimeout((function(){n.update.apply(n,[e])}),1)},bgprocess_url:function(e){switch(e){case"status":return this.details&&-1!=this.out&&-1!=this.err?n("bgprocess.detailed_status",{pid:this.id,out:this.out,err:this.err}):n("bgprocess.status",{pid:this.id});case"acknowledge":return n("bgprocess.acknowledge",{pid:this.id});case"stop_process":return n("bgprocess.stop_process",{pid:this.id});default:return n("bgprocess.list")}},update:function(n){var i=this,o=[],s=[];"stime"in n&&(i.stime=new Date(n.stime)),"execution_time"in n&&(i.execution_time=parseFloat(n.execution_time)),"type_desc"in n&&(i.type_desc=n.type_desc),"desc"in n&&(i.desc=n.desc),"details"in n&&(i.detailed_desc=n.details),"exit_code"in n&&(i.exit_code=n.exit_code),"process_state"in n&&(i.state=n.process_state),"current_storage_dir"in n&&(i.current_storage_dir=n.current_storage_dir),"out"in n&&(i.out=n.out&&n.out.pos,n.out&&n.out.lines&&(o=n.out.lines)),"err"in n&&(i.err=n.err&&n.err.pos,n.err&&n.err.lines&&(s=n.err.lines)),i.completed=i.completed||"err"in n&&"out"in n&&n.err.done&&n.out.done||!i.details&&!a.isNull(i.exit_code);for(var l=0,d=0,c=[],u=document.createElement("textarea"),f=function(e){return u.textContent=e,u.innerHTML};l<o.length&&d<s.length;)if(e.natural_sort(o[l][0],s[d][0])<=0)c.push('<li class="pg-bg-res-out">'+f(o[l++][1])+"</li>");else{var p=f(s[d++][1]);new RegExp(": ("+t("error")+"|"+t("fatal")+"):","i").test(p)?c.push('<li class="pg-bg-res-err">'+p+"</li>"):c.push('<li class="pg-bg-res-out">'+p+"</li>")}for(;l<o.length;)c.push('<li class="pg-bg-res-out">'+f(o[l++][1])+"</li>");for(;d<s.length;){var h=f(s[d++][1]);new RegExp(": ("+t("error")+"|"+t("fatal")+"):","i").test(h)?c.push('<li class="pg-bg-res-err">'+h+"</li>"):c.push('<li class="pg-bg-res-out">'+h+"</li>")}c.length&&(i.logs.append(c.join("")),setTimeout((function(){i.logs[0].scrollTop=i.logs[0].scrollHeight}))),i.logs_loading&&(i.logs_loading.remove(),i.logs_loading=null),i.stime&&(i.curr_status=i.other_status_tpl({status_text:t("Started")}),i.execution_time>=2&&(i.curr_status=i.other_status_tpl({status_text:t("Running...")})),a.isNull(i.exit_code)?a.isNull(i.exit_code)&&3===i.state&&(i.curr_status=i.other_status_tpl({status_text:t("Terminating the process...")})):3===i.state?i.curr_status=i.failed_status_tpl({status_text:t("Terminated by user.")}):0==i.exit_code?i.curr_status=i.success_status_tpl({status_text:t("Successfully completed.")}):i.curr_status=i.failed_status_tpl({status_text:t("Failed (exit code: %s).",String(i.exit_code))}),0==i.state&&i.stime&&(i.state=1,r.Events&&r.Events.trigger("pgadmin-bgprocess:started:"+i.id,i,i)),1!=i.state||a.isNull(i.exit_code)||(i.state=2,r.Events&&r.Events.trigger("pgadmin-bgprocess:finished:"+i.id,i,i)),setTimeout((function(){i.show.apply(i)}),10)),i.completed||setTimeout((function(){i.status.apply(i)}),1e3)},status:function(){var e=this;i.ajax({typs:"GET",timeout:3e4,url:e.bgprocess_url("status"),cache:!1,async:!0,contentType:"application/json"}).done((function(t){setTimeout((function(){e.update(t)}),10)})).fail((function(t){410!=t.status&&setTimeout((function(){e.update(t)}),1e4)}))},show:function(){if(this.notify&&!this.details){if(!this.notifier){var e=i('\n            <div class="card">\n              <div class="card-header bg-primary d-flex">\n                <div>'.concat(this.type_desc,'</div>\n                <div class="ml-auto">\n                  <button class="btn btn-sm-sq btn-primary pg-bg-close"><i class="fa fa-lg fa-times" role="img"></i></button>\n                </div>\n              </div>\n              <div class="card-body px-2">\n                <div class="py-1">').concat(this.desc,'</div>\n                <div class="py-1">').concat(this.stime.toString(),'</div>\n                <div class="d-flex py-1">\n                  <div class="my-auto mr-2">\n                    <span class="fa fa-clock fa-lg" role="img"></span>\n                  </div>\n                  <div class="pg-bg-etime my-auto mr-2"></div>\n                  <div class="ml-auto">\n                    <button class="btn btn-secondary pg-bg-more-details" title="More Details"><span class="fa fa-info-circle" role="img"></span>&nbsp;')+t("More details...")+'</button>\n                    <button class="btn btn-danger bg-process-stop" disabled><span class="fa fa-times-circle" role="img" title="Stop the operation"></span>&nbsp;'+t("Stop Process")+'</button>\n                  </div>\n                </div>\n                <div class="pg-bg-status py-1">\n                </div>\n              </div>\n            </div>\n            '),n=e.find(".pg-bg-more-details"),a=e.find(".pg-bg-close");this.container=e,this.notifier=o.notify(e.get(0),"bg-bgprocess",0,null),n.on("click",function(e){(e=e||window.event).cancelBubble=!0,e.stopPropagation(),this.notifier.dismiss(),this.notifier=null,this.completed=!1,this.show_detailed_view.apply(this)}.bind(this)),a.on("click",function(){this.notifier.dismiss(),this.notifier=null,this.acknowledge_server.apply(this)}.bind(this)),this.container.on("click",(function(e){(e=e||window.event).cancelBubble=!0,e.stopPropagation()})),e.find(".bg-process-stop").off("click").on("click",this.stop_process.bind(this))}this.container.find(".pg-bg-etime").empty().append(i("<span></span>").text(String(this.execution_time))).append(i("<span></span>").text(" "+t("seconds"))),i(this.container.find(".pg-bg-status")).html(this.curr_status);var r=i(this.container.find(".bg-process-stop"));1===parseInt(this.state)?r.attr("disabled",!1):r.attr("disabled",!0)}else this.show_detailed_view.apply(this)},show_detailed_view:function(){var e=this,n=this.panel,a=!1;e.panel||(a=!0,(n=this.panel=r.BackgroundProcessObsorver.create_panel()).title(t("Process Watcher - %s",e.type_desc)),n.focus());var o=n.$container,d=o.find(".bg-process-watcher"),c=o.find(".bg-process-details"),u=o.find(".bg-process-footer"),f=o.find(".bg-process-stop"),p=o.find(".bg-process-storage-manager");if(e.current_storage_dir&&s){if(0==p.length){o.find(".bg-process-details .bg-btn-section").prepend('<button id="bg-process-storage-manager" class="btn btn-secondary bg-process-storage-manager" title="Click to open file location" aria-label="Storage Manager" tabindex="0" disabled><span class="pg-font-icon icon-storage-manager" role="img"></span></button>&nbsp;'),p=o.find(".bg-process-storage-manager")}1===parseInt(e.state)?p.attr("disabled",!0):p.attr("disabled",!1),p.off("click").on("click",e.storage_manager.bind(this))}if(1===parseInt(e.state)?f.attr("disabled",!1):f.attr("disabled",!0),f.off("click").on("click",e.stop_process.bind(this)),a&&(d.html(e.logs),setTimeout((function(){e.logs[0].scrollTop=e.logs[0].scrollHeight})),e.logs_loading=i('<li class="pg-bg-res-out loading-logs">'+t("Loading process logs...")+"</li>"),e.logs.append(e.logs_loading),c.find(".bg-detailed-desc").html(e.detailed_desc)),c.find(".bg-process-stats .bgprocess-start-time").html(e.stime),u.find(".bg-process-status").html(e.curr_status),u.find(".bg-process-exec-time p").empty().append(i("<span></span>").text(String(e.execution_time))).append(i("<span></span>").text(" "+t("seconds"))),a){e.details=!0,e.err=0,e.out=0,setTimeout((function(){e.status.apply(e)}),1e3);var h=function(e,t,n){var a=t.outerHeight()+n.outerHeight();e.css("padding-bottom",a)}.bind(n,d,c,u);n.on(l.EVENT.RESIZED,h),n.on(l.EVENT.ATTACHED,h),n.on(l.EVENT.DETACHED,h),h(),n.on(l.EVENT.CLOSED,function(e){e.panel=null,e.details=!1,null!=e.exit_code&&e.acknowledge_server.apply(e)}.bind(n,this))}},acknowledge_server:function(){i.ajax({type:"PUT",timeout:3e4,url:this.bgprocess_url("acknowledge"),cache:!1,async:!0,contentType:"application/json"}).done((function(){})).fail((function(){console.warn(arguments)}))},stop_process:function(){this.state=3,i.ajax({type:"PUT",timeout:3e4,url:this.bgprocess_url("stop_process"),cache:!1,async:!0,contentType:"application/json"}).done((function(){})).fail((function(){console.warn(arguments)}))},storage_manager:function(){this.current_storage_dir&&r.Events.trigger("pgadmin:tools:storage_manager",this.current_storage_dir)}}),a.extend(r.BackgroundProcessObsorver,{bgprocesses:{},init:function(){var e=this;e.initialized||(e.initialized=!0,setTimeout((function(){e.update_process_list.apply(e)}),1e3),r.Events.on("pgadmin-bgprocess:created",(function(){setTimeout((function(){r.BackgroundProcessObsorver.update_process_list(!0)}),1e3)})))},update_process_list:function(e){var t=this;i.ajax({typs:"GET",timeout:3e4,url:n("bgprocess.list"),cache:!1,async:!0,contentType:"application/json"}).done((function(n){if(n&&a.isArray(n)){for(var i in n){var r=n[i];"id"in r&&(r.id in t.bgprocesses||(t.bgprocesses[r.id]=new d(r)))}e&&0==n.length&&setTimeout((function(){t.update_process_list(!1)}),3e3)}})).fail((function(){console.warn(arguments)}))},create_panel:function(){return this.register_panel(),r.docker.addPanel("bg_process_watcher",l.DOCK.FLOAT,null,{w:screen.width<700?.95*screen.width:.5*screen.width,h:screen.height<500?.95*screen.height:.5*screen.height,x:screen.width<700?"2%":"25%",y:screen.height<500?"2%":"25%"})},register_panel:function(){var e=r.docker.findPanels("bg_process_watcher");e&&e.length>=1||new r.Panel({name:"bg_process_watcher",showTitle:!0,isCloseable:!0,isPrivate:!0,isLayoutMember:!1,content:'<div class="bg-process-details"><div class="bg-detailed-desc"></div><div class="bg-process-stats d-flex py-1"><div class="my-auto mr-2"><span class="fa fa-clock fa-lg" role="img"></span></div><div class="pg-bg-etime my-auto mr-2"><span>'+t("Start time")+': <span class="bgprocess-start-time"></span></span></div><div class="ml-auto bg-btn-section"><button type="button" class="btn btn-danger bg-process-stop" disabled><span class="fa fa-times-circle" role="img"></span>&nbsp;'+t("Stop Process")+'</button></div></div></div><div class="bg-process-watcher"></div><div class="bg-process-footer p-2 d-flex"><div class="bg-process-status flex-grow-1"></div><div class="bg-process-exec-time ml-4 my-auto"><div class="exec-div"><span>'+t("Execution time")+":</span><p></p></div></div></div>",onCreate:function(e,t){t.addClass("pg-no-overflow p-2")}}).load(r.docker)}}),r.BackgroundProcessObsorver}.apply(t,a))||(e.exports=i)},,function(e,t,n){"use strict";(function(e){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(21),n(24),n(25),n(8),n(14),n(10),n(3),n(34),n(12),n(19),n(44),n(16),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.showDataGrid=function(e,t,n,a,s,l){var d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=t.treeMenu.findNodeByDomElement(s);if(void 0===f||!f.getData())return void n.alert((0,i.default)("Data Grid Error"),(0,i.default)("No object selected."));var p=o.getTreeNodeHierarchyFromIdentifier.call(t,s);if(m(p)||!b(p))return;var y=h(l,a,f.getData(),p),w=v(t,s);if(d){g(n,t);var x=_(f.getData(),p),C=function(t){e.launch_grid(l,y,!1,w,null,t)};c.default.get((0,r.default)("datagrid.filter"),(function(e){n.filterDialog((0,i.default)("Data Filter - %s",w),e,x,u,C).resizeTo(t.stdW.sm,t.stdH.sm)}))}else e.launch_grid(l,y,!1,w)},t.retrieveNameSpaceName=p,t.generateDatagridTitle=v;var i=f(n(2)),r=f(n(6)),o=n(51),s=n(65),l=f(n(84)),d=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(63)),c=f(n(0));function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function f(e){return e&&e.__esModule?e:{default:e}}function p(e){return void 0!==e.schema?e.schema.label:void 0!==e.view?e.view.label:void 0!==e.catalog?e.catalog.label:""}function h(e,t,n,a){var i=(0,r.default)("datagrid.panel",{trans_id:e});return i+="?is_query_tool=".concat(!1)+"&cmd_type=".concat(t.mnuid)+"&obj_type=".concat(n._type)+"&obj_id=".concat(n._id)+"&sgid=".concat(a.server_group._id)+"&sid=".concat(a.server._id)+"&did=".concat(a.database._id)+"&server_type=".concat(a.server.server_type)}function _(e,t){var n={sid:t.server._id,did:t.database._id,obj_id:e._id};return(0,r.default)("datagrid.filter_validate",n)}function g(e,t){e.filterDialog||e.dialog("filterDialog",(function(){return{main:function(e,t,n,a,i){this.set("title",e),this.message=t,this.validateUrl=n,this.okCallback=i,this.preferences=a},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-primary-icon pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:(0,i.default)("Data Filter"),"aria-label":(0,i.default)("Help"),url:(0,r.default)("help.static",{filename:"viewdata_filter.html"})}},{text:(0,i.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times pg-alertify-button"},{text:(0,i.default)("OK"),key:null,className:"btn btn-primary fa fa-check pg-alertify-button"}],options:{modal:0,resizable:!0,maximizable:!1,pinnable:!1,autoReset:!1}}},build:function(){var t=this;e.pgDialogBuild.apply(t),(0,c.default)(t.__internal.buttons[2].element).attr("title",(0,i.default)("Use SHIFT + ENTER to apply filter...")),(0,c.default)(t.elements.body).on("keypress",(function(e){e.shiftKey&&13==e.keyCode&&t.__internal.buttons[2].element.click()}))},prepare:function(){var e=this,n=(0,c.default)(this.message),a=n.find("#sql_filter");(0,c.default)(this.elements.header).attr("data-title",this.get("title")),(0,c.default)(this.elements.body.childNodes[0]).addClass("dataview_filter_dialog"),this.setContent(n.get(0)),e.__internal.buttons[2].element.disabled=!0,this.filter_obj=l.default.fromTextArea(a.get(0),{lineNumbers:!0,mode:"text/x-pgsql",extraKeys:t.editor_shortcut_keys,indentWithTabs:!e.preferences.use_spaces,indentUnit:e.preferences.tab_size,tabSize:e.preferences.tab_size,lineWrapping:e.preferences.wrap_code,autoCloseBrackets:e.preferences.insert_pair_brackets,matchBrackets:e.preferences.brace_matching,screenReaderLabel:(0,i.default)("Filter SQL")});var r=d.calcFontSize(e.preferences.sql_font_size);(0,c.default)(this.filter_obj.getWrapperElement()).css("font-size",r),setTimeout((function(){e.filter_obj.refresh(),e.filter_obj.focus()}),500),e.filter_obj.on("change",(function(){""!==e.filter_obj.getValue()?e.__internal.buttons[2].element.disabled=!1:e.__internal.buttons[2].element.disabled=!0}))},callback:function(n){if(n.button.text==(0,i.default)("OK")){var a=this.filter_obj.getValue(),r=this;n.cancel=!0,c.default.ajax({url:r.validateUrl,method:"POST",async:!1,contentType:"application/json",data:JSON.stringify(a)}).done((function(t){t.data.status?(r.okCallback(a),r.close()):e.alert((0,i.default)("Validation Error"),t.data.result)})).fail((function(n){410===n.status?t.report_error((0,i.default)("Error filtering rows - %s.",n.statusText),n.responseJSON.errormsg):e.alert((0,i.default)("Validation Error"),n)}))}else if(0==n.index)return n.cancel=!0,void t.showHelp(n.button.element.name,n.button.element.getAttribute("url"),null,null)}}}))}function m(e){return void 0===e.server||void 0===e.database}function b(e){return void 0!==e.schema||void 0!==e.view||void 0!==e.catalog}function v(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t.get_preferences_for_module("browser"),r=o.getTreeNodeHierarchyFromIdentifier.call(t,n),l=p(r),d=(0,s.getDatabaseLabel)(r),c=t.treeMenu.findNodeByDomElement(n),u="";u=a||i.vw_edt_tab_title_placeholder;var f={database:d,username:r.server.user.name,server:r.server.label,schema:l,table:c.getData().label,type:"datagrid"},h=(0,s.generateTitle)(u,f);return e.escape(h)}}).call(this,n(1))},,function(e,t,n){"use strict";(function(a){var i,r;n(8),n(35),n(18),i=[n(0),n(58),n(107)],void 0===(r=function(e,t){return function(){var n=window.Slick,i=new n.EventHandler,r=new n.Event,o=new n.Event,s=function(t,n,a){var i=a.column;if(t.focus(),f(i)){var o=e(n.target);if(u(n)){if(e(n.target).hasClass("slick-resizable-handle"))return;o=e(n.target).parents(".slick-header-column")}o.toggleClass("selected"),o.hasClass("selected")&&r.notify(a,n),n.isPropagationStopped()||n.isImmediatePropagationStopped()||c(t,i.id)}else l(t)},l=function(t){if(e(".copy-with-header").hasClass("visibility-hidden"))e(".slick-header-column").each((function(t,n){e(n).removeClass("selected")}));else{var n=t.getSelectedRows();e(".slick-header-column").each((function(a,i){0==n.length?(e(i).removeClass("selected"),t.getColumns()[a].selected=!1):a>0&&t.getColumns()[a].selectable&&(e(i).addClass("selected"),t.getColumns()[a].selected=!0)}))}}.bind(t),d=function(n,a,i){e(".slick-header-column").each((function(a,r){var o=e(r).find('[data-cell-type="column-header-row"]'),s=n.getColumnIndex(o.data("column-id"));p(n,i,s)?(e(r).addClass("selected"),s&&(n.getColumns()[s].selected=!0)):t.areAllRangesCompleteRows(n,i)||(e(r).removeClass("selected"),s&&(n.getColumns()[s].selected=!1))}))},c=function(e,n){var a,i=e.getSelectionModel(),r=i.getSelectedRanges(),o=e.getColumnIndex(n),s=t.rangeForColumn(e,o);a=t.isRangeSelected(r,s)?t.removeRange(r,s):t.areAllRangesSingleColumns(r,e)?t.addRange(r,s):[s],i.setSelectedRanges(a)},u=function(t){return!e(t.target).hasClass("slick-header-column")},f=function(e){return!1!==e.selectable},p=function(e,n,a){var i=t.areAllRangesCompleteRows(e,n);return h(e,n,a)&&!i},h=function(e,n,a){var i=t.isRangeEntirelyWithinSelectedRanges(n,t.rangeForColumn(e,a)),r=t.isAnyCellOfColumnSelected(n,a);return i||r};e.extend(this,{init:function(e){i.subscribe(e.onHeaderClick,s.bind(null,e)),e.getSelectionModel().onSelectedRangesChanged.subscribe(d.bind(null,e)),o.subscribe((function(e,t){c(t.grid,t.column.id)}))},getColumnDefinitions:function(e){return a.map(e,(function(e){if(f(e)){var t="<span data-cell-type='column-header-row'        data-test='output-column-header'       data-column-id='"+e.id+"'>  <span class='column-description'>    <span class='column-name'>"+e.display_name+"</span>    <span class='column-type'>"+e.column_type+"</span>  </span></span>";return a.extend(e,{name:t})}return e}))},onBeforeColumnSelectAll:r,onColumnSelectAll:o,toggleColumnHeaderForCopyHeader:l})}}.apply(t,i))||(e.exports=r)}).call(this,n(1))},function(e,t,n){"use strict";e.exports={TRANSACTION_STATUS_IDLE:0,TRANSACTION_STATUS_ACTIVE:1,TRANSACTION_STATUS_INTRANS:2,TRANSACTION_STATUS_INERROR:3,TRANSACTION_STATUS_UNKNOWN:5}},function(e,t,n){"use strict";n(27);var a=r(n(0)),i=r(n(39));function r(e){return e&&e.__esModule?e:{default:e}}var o={_verbose:function(){return!(0,a.default)(".explain-verbose").hasClass("visibility-hidden")},_costsEnabled:function(){return!(0,a.default)(".explain-costs").hasClass("visibility-hidden")},_buffers:function(){return!(0,a.default)(".explain-buffers").hasClass("visibility-hidden")},_timing:function(){return!(0,a.default)(".explain-timing").hasClass("visibility-hidden")},_summary:function(){return!(0,a.default)(".explain-summary").hasClass("visibility-hidden")},_settings:function(){return!(0,a.default)(".explain-settings").hasClass("visibility-hidden")},_clearMessageTab:function(){(0,a.default)(".sql-editor-message").html("")},executeMacro:function(e,t){this._clearMessageTab(),e.check_data_changes_to_execute_query(null,!1,t)},executeQuery:function(e){this._clearMessageTab(),e.check_data_changes_to_execute_query()},explainAnalyze:function(e){var t={format:"json",analyze:!0,verbose:this._verbose(),costs:this._costsEnabled(),buffers:this._buffers(),timing:this._timing(),summary:this._summary(),settings:this._settings()};this._clearMessageTab(),e.check_data_changes_to_execute_query(t)},explain:function(e){var t={format:"json",analyze:!1,verbose:this._verbose(),costs:this._costsEnabled(),buffers:!1,timing:!1,summary:this._summary(),settings:this._settings()};this._clearMessageTab(),e.check_data_changes_to_execute_query(t)},download:function(e){var t=e.gridView.query_tool_obj.getSelection();if(t||(t=e.gridView.query_tool_obj.getValue()),t){var n=","===e.preferences.csv_field_separator?".csv":".txt",a="data-"+(new Date).getTime()+n;e.is_query_tool||(a=e.table_name+n),e.trigger_csv_download(t,a)}},commentBlockCode:function(e){var t=e.gridView.query_tool_obj;t.getValue()&&t.toggleComment(t.getCursor(!0),t.getCursor(!1))},commentLineCode:function(e){var t=e.gridView.query_tool_obj;t.getValue()&&t.lineComment(t.getCursor(!0),t.getCursor(!1),{lineComment:"--"})},uncommentLineCode:function(e){var t=e.gridView.query_tool_obj;t.getValue()&&t.uncomment(t.getCursor(!0),t.getCursor(!1),{lineComment:"--"})},formatSql:function(e){e.gridView.on_format_sql()},focusOut:function(){document.activeElement.blur(),i.default.document.activeElement.blur()},toggleCaseOfSelectedText:function(e){var t=e.gridView.query_tool_obj,n=t.getSelection();n&&(n===n.toUpperCase()?t.replaceSelection(n.toLowerCase()):t.replaceSelection(n.toUpperCase()))},executeCommit:function(e){e.special_sql="COMMIT;",this.executeQuery(e)},executeRollback:function(e){e.special_sql="ROLLBACK;",this.executeQuery(e)},saveDataChanges:function(e){e.close_on_save=!1,e.save_data()},openQueryTool:function(e){e.gridView.handler.trigger("pgadmin-sqleditor:button:show_query_tool",e.gridView,e.gridView.handler)}};e.exports=o},function(e,t,n){"use strict";n(3),n(36),n(88),Object.defineProperty(t,"__esModule",{value:!0}),t.calculateQueryRunTime=function(e,t){var n,r,o,s=(0,a.default)(t).diff(e);return n=parseInt(s/1e3),s%=1e3,r=parseInt(n/60),n%=60,o=parseInt(r/60),r%=60,((o>0?o+" "+(0,i.default)("hr")+" ":"")+(r>0?r+" "+(0,i.default)("min")+" ":"")+(o<=0&&n>0?n+" "+(0,i.default)("secs")+" ":"")+(o<=0&&r<=0?s+" "+(0,i.default)("msec")+" ":"")).trim()};var a=r(n(116)),i=r(n(2));function r(e){return e&&e.__esModule?e:{default:e}}},,,,,,,,,,,,,function(e,t,n){"use strict";var a,i;n(15),n(5),n(9),n(83),a=[n(0),n(1)],void 0===(i=function(e,t){return function(e,n){if(t.isUndefined(n)||t.isNull(n))return!0;n.startsWith("coll-")&&(n=n.replace("coll-",""));if(t.indexOf(["server_group","server","catalog_object_column"],n)>=0)return!0;var a=e.get_preference("browser","show_node_"+n);return!a||a.value}}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";(function(e){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(21),n(24),n(25),n(14),n(27),n(10),n(3),n(34),n(43),n(12),n(19),n(44),n(16),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.pgBrowser=void 0;var i=f(n(4)),r=f(n(6)),o=f(n(0)),s=u(n(13)),l=u(n(63)),d=f(n(39));function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}function f(e){return e&&e.__esModule?e:{default:e}}var p=n(99),h=i.default.Browser=i.default.Browser||{};t.pgBrowser=h,e.extend(h,{preferences_cache:[],prefcache_version:0,generate_preference_version:function(){return(new Date).getTime()},preference_version:function(e){if(!e)return this.prefcache_version;this.prefcache_version=e},get_preference:function(t,n){var a=this;if(0!=e.size(a.preferences_cache))return e.findWhere(a.preferences_cache,{module:t,name:n});var i=setInterval((function(){if(a.preferences_cache.length>0)return clearInterval(i),e.findWhere(a.preferences_cache,{module:t,name:n})}),1e3)},get_preferences_for_module:function(t){var n={};if(e.each(e.where(this.preferences_cache,{module:t}),(function(e){n[e.name]=e.value})),Object.keys(n).length>0)return n},get_preference_for_id:function(t){return e.findWhere(this.preferences_cache,{id:t})},cache_preferences:function(t){var n=this,a={};a[i.default.csrf_token_header]=i.default.csrf_token,setTimeout((function(){o.default.ajax({url:(0,r.default)("preferences.get_all"),headers:a}).done((function(a){n.preferences_cache=a,n.preference_version(n.generate_preference_version()),h.keyboardNavigation.init(),h.tree&&(p.modifyAcitreeAnimation(n),p.modifyAlertifyAnimation(n)),h.browserTreeState.init(),t&&("string"==typeof t?o.default.event.trigger("prefchange:"+t):e.each(t,(function(e,t){o.default.event.trigger("prefchange:"+t)})))})).fail((function(e,t,n){s.pgRespErrorNotify(e,n)}))}),500)},reflectPreferences:function(e){if("sqleditor"===e||null==e){var t=this.get_preferences_for_module("sqleditor");(0,o.default)(this.editor.getWrapperElement()).css("font-size",l.calcFontSize(t.sql_font_size)),this.editor.setOption("tabSize",t.tab_size),this.editor.setOption("lineWrapping",t.wrap_code),this.editor.setOption("autoCloseBrackets",t.insert_pair_brackets),this.editor.setOption("matchBrackets",t.brace_matching),this.editor.refresh()}},onPreferencesChange:function(e,t){(0,o.default)(d.default).on("prefchange:"+e,(function(e){t(e)}))}})}).call(this,n(1))},,function(e,t){e.exports=i},function(e,t,n){"use strict";(function(e){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(21),n(24),n(25),n(14),n(10),n(3),n(34),n(12),n(19),n(44),n(16),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.pgBrowser=void 0;var i=u(n(4)),r=u(n(6)),o=u(n(0)),s=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(13)),l=u(n(2));n(64);var d=u(n(39));function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function u(e){return e&&e.__esModule?e:{default:e}}var f=i.default.Browser=i.default.Browser||{};t.pgBrowser=f;var p=window.wcDocker;e.extend(f,{lock_layout_levels:{PREVENT_DOCKING:"docking",FULL:"full",NONE:"none"},buildDefaultLayout:function(e){var t=e.addPanel("browser",p.DOCK.LEFT),n=e.addPanel("dashboard",p.DOCK.RIGHT,t);e.addPanel("properties",p.DOCK.STACKED,n,{tabOrientation:p.TAB.TOP}),e.addPanel("sql",p.DOCK.STACKED,n),e.addPanel("statistics",p.DOCK.STACKED,n),e.addPanel("dependencies",p.DOCK.STACKED,n),e.addPanel("dependents",p.DOCK.STACKED,n)},save_current_layout:function(e,t){if(t){var n={setting:e,value:t.save()};o.default.ajax({type:"POST",url:(0,r.default)("settings.store_bulk"),data:n})}},restore_layout:function(e,t,n){if(""!=t)try{e.restore(t)}catch(t){e.clear(),n&&n(e)}else n&&n(e);var a=d.default.pgAdmin.Browser,i=setInterval((function(){a.get_preferences_for_module("browser")&&(clearInterval(i),a.reflectLocklayoutChange(e),a.onPreferencesChange("browser",(function(){a.reflectLocklayoutChange(e)})))}),500)},reflectLocklayoutChange:function(e){var t=d.default.pgAdmin.Browser,n=t.get_preferences_for_module("browser");t.lock_layout(e,n.lock_layout)},lock_layout:function(t,n){var a=this.menus.file.mnu_locklayout.menu_items;switch(n){case this.lock_layout_levels.PREVENT_DOCKING:t.lockLayout(p.LOCK_LAYOUT_LEVEL.PREVENT_DOCKING);break;case this.lock_layout_levels.FULL:t.lockLayout(p.LOCK_LAYOUT_LEVEL.FULL);break;case this.lock_layout_levels.NONE:t.lockLayout(p.LOCK_LAYOUT_LEVEL.NONE)}e.each(a,(function(e){e.name!="mnu_lock_"+n?e.change_checked(!1):e.change_checked(!0)}))},save_lock_layout:function(e){var t=d.default.pgAdmin.Browser;o.default.ajax({url:(0,r.default)("browser.lock_layout"),method:"PUT",contentType:"application/json",data:JSON.stringify({value:e})}).done((function(){t.cache_preferences("browser")})).fail((function(e,t){s.pgNotifier(t,e,(0,l.default)("Failed to save the lock layout setting."))}))},mnu_lock_docking:function(){this.lock_layout(this.docker,this.lock_layout_levels.PREVENT_DOCKING),this.save_lock_layout(this.lock_layout_levels.PREVENT_DOCKING)},mnu_lock_full:function(){this.lock_layout(this.docker,this.lock_layout_levels.FULL),this.save_lock_layout(this.lock_layout_levels.FULL)},mnu_lock_none:function(){this.lock_layout(this.docker,this.lock_layout_levels.NONE),this.save_lock_layout(this.lock_layout_levels.NONE)}})}).call(this,n(1))},,function(e,t,n){"use strict";n(40),n(3),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.pgBrowser=void 0;var a=l(n(0)),i=l(n(1)),r=l(n(4)),o=l(n(39)),s=n(22);function l(e){return e&&e.__esModule?e:{default:e}}var d=r.default.Browser=r.default.Browser||{};t.pgBrowser=d;i.default.extend(d,{inactivity_timeout_at:null,logging_activity:!1,inactivity_timeout_daemon_running:!1,is_pgadmin_timedout:function(){return!o.default.pgAdmin},is_inactivity_timeout:function(){return o.default.pgAdmin.Browser.inactivity_timeout_at<this.get_epoch_now()},get_epoch_now:function(){return(0,s.getEpoch)()},log_activity:function(){var e=this;this.logging_activity||(this.logging_activity=!0,this.inactivity_timeout_at=this.get_epoch_now()+r.default.user_inactivity_timeout,setTimeout((function(){e.logging_activity=!1}),1e3))},register_to_activity_listener:function(e,t){var n=["mousemove","mousedown","keydown"],a=this;n.forEach((function(i){e.addEventListener(i,(function i(){a.is_pgadmin_timedout()?(n.forEach((function(t){e.removeEventListener(t,i,!0)})),t()):o.default.pgAdmin.Browser.log_activity()}),!0)}))},override_activity_event_decorator:function(e){return function(){return r.default.override_user_inactivity_timeout&&o.default.pgAdmin.Browser.log_activity(),e.apply(this,arguments)}},logout_inactivity_user:function(){i.default.isUndefined(d.utils)||i.default.isUndefined(d.utils.logout_url)||(window.location.href=d.utils.logout_url)},start_inactivity_timeout_daemon:function(){var e=this;if(r.default.user_inactivity_timeout>0&&!e.inactivity_timeout_daemon_running)var t=setInterval((function(){e.inactivity_timeout_daemon_running=!0,e.is_inactivity_timeout()&&(clearInterval(t),e.inactivity_timeout_daemon_running=!1,(0,a.default)(window).off("beforeunload"),e.logout_inactivity_user())}),1e3)}})},function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(21),n(24),n(25),n(8),n(14),n(18),n(3),n(34),n(12),n(19),n(44),n(16),n(7);var i=h(n(1)),r=h(n(4)),o=h(n(0)),s=h(n(118)),l=p(n(22)),d=h(n(124)),c=p(n(78)),u=h(n(39));function f(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return f=function(){return e},e}function p(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=f();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,t&&t.set(e,n),n}function h(e){return e&&e.__esModule?e:{default:e}}var _=r.default.Browser=r.default.Browser||{};_.keyboardNavigation=_.keyboardNavigation||{},i.default.extend(_.keyboardNavigation,{init:function(){s.default.reset(),_.preferences_cache.length>0&&(this.keyboardShortcut={file_shortcut:l.parseShortcutValue(_.get_preference("browser","main_menu_file").value),object_shortcut:l.parseShortcutValue(_.get_preference("browser","main_menu_object").value),tools_shortcut:l.parseShortcutValue(_.get_preference("browser","main_menu_tools").value),help_shortcut:l.parseShortcutValue(_.get_preference("browser","main_menu_help").value),left_tree_shortcut:l.parseShortcutValue(_.get_preference("browser","browser_tree").value),tabbed_panel_backward:l.parseShortcutValue(_.get_preference("browser","tabbed_panel_backward").value),tabbed_panel_forward:l.parseShortcutValue(_.get_preference("browser","tabbed_panel_forward").value),sub_menu_query_tool:l.parseShortcutValue(_.get_preference("browser","sub_menu_query_tool").value),sub_menu_view_data:l.parseShortcutValue(_.get_preference("browser","sub_menu_view_data").value),sub_menu_search_objects:l.parseShortcutValue(_.get_preference("browser","sub_menu_search_objects").value),sub_menu_properties:l.parseShortcutValue(_.get_preference("browser","sub_menu_properties").value),sub_menu_create:l.parseShortcutValue(_.get_preference("browser","sub_menu_create").value),sub_menu_delete:l.parseShortcutValue(_.get_preference("browser","sub_menu_delete").value),sub_menu_refresh:l.parseShortcutValue(_.get_preference("browser","sub_menu_refresh").value),context_menu:l.parseShortcutValue(_.get_preference("browser","context_menu").value),direct_debugging:l.parseShortcutValue(_.get_preference("browser","direct_debugging").value),drop_multiple_objects:l.parseShortcutValue(_.get_preference("browser","grid_menu_drop_multiple").value),drop_cascade_multiple_objects:l.parseShortcutValue(_.get_preference("browser","grid_menu_drop_cascade_multiple").value),add_grid_row:l.parseShortcutValue(_.get_preference("browser","add_grid_row").value)},this.shortcutMethods={bindMainMenu:{shortcuts:[this.keyboardShortcut.file_shortcut,this.keyboardShortcut.object_shortcut,this.keyboardShortcut.tools_shortcut,this.keyboardShortcut.help_shortcut]},bindRightPanel:{shortcuts:[this.keyboardShortcut.tabbed_panel_backward,this.keyboardShortcut.tabbed_panel_forward]},bindLeftTree:{shortcuts:this.keyboardShortcut.left_tree_shortcut},bindSubMenuQueryTool:{shortcuts:this.keyboardShortcut.sub_menu_query_tool},bindSubMenuViewData:{shortcuts:this.keyboardShortcut.sub_menu_view_data},bindSubMenuSearchObjects:{shortcuts:this.keyboardShortcut.sub_menu_search_objects},bindSubMenuProperties:{shortcuts:this.keyboardShortcut.sub_menu_properties},bindSubMenuCreate:{shortcuts:this.keyboardShortcut.sub_menu_create},bindSubMenuDelete:{shortcuts:this.keyboardShortcut.sub_menu_delete},bindSubMenuRefresh:{shortcuts:this.keyboardShortcut.sub_menu_refresh,bindElem:"#tree"},bindContextMenu:{shortcuts:this.keyboardShortcut.context_menu},bindDirectDebugging:{shortcuts:this.keyboardShortcut.direct_debugging},bindDropMultipleObjects:{shortcuts:this.keyboardShortcut.drop_multiple_objects},bindDropCascadeMultipleObjects:{shortcuts:this.keyboardShortcut.drop_cascade_multiple_objects},bindAddGridRow:{shortcuts:this.keyboardShortcut.add_grid_row}},this.bindShortcuts())},bindShortcuts:function(){var e=this;i.default.each(e.shortcutMethods,(function(t,n){e._bindWithMousetrap(t.shortcuts,e[n],t.bindElem)}));(0,o.default)(".pg-navbar").on("keydown",(function(t){switch(t.keyCode){case 37:e.bindMainMenuLeft(t);break;case 38:e.bindMainMenuUpDown(t,"up");break;case 39:e.bindMainMenuRight(t);break;case 40:e.bindMainMenuUpDown(t,"down")}}))},_bindWithMousetrap:function(e,t,n){var a=this;if(s.default.unbind(e),n){var i=document.querySelector(n);(0,s.default)(i).bind(e,function(){t.apply(this,arguments)}.bind(i))}else s.default.bind(e,(function(){t.apply(a,arguments)}))},unbindShortcuts:function(){i.default.each(this.mousetrapInstances,(function(e){e.instance.reset()})),this.mousetrapInstances=[]},bindMainMenu:function(e,t){var n=this.keyboardShortcut;t===n.file_shortcut&&(0,o.default)("#mnu_file a.dropdown-toggle").dropdown("toggle"),t===n.object_shortcut&&(0,o.default)("#mnu_obj a.dropdown-toggle").first().dropdown("toggle"),t===n.tools_shortcut&&(0,o.default)("#mnu_tools a.dropdown-toggle").dropdown("toggle"),t===n.help_shortcut&&(0,o.default)("#mnu_help a.dropdown-toggle").dropdown("toggle")},bindRightPanel:function(e,t){var n=0,a=r.default.Browser.docker.findPanels().length-1,o=0,s=!1,l=this.keyboardShortcut;i.default.each(r.default.Browser.docker.findPanels(),(function(e,t){e.isVisible()&&!s&&"browser"!==e._type&&(o=t,s=!0)})),t===l.tabbed_panel_backward?n=o>0?o-1:1:t===l.tabbed_panel_forward&&(n=o<a?o+1:a),r.default.Browser.docker.findPanels()[n].focus(),setTimeout((function(){document.activeElement instanceof HTMLIFrameElement&&document.activeElement.blur()}),1e3)},bindMainMenuLeft:function(e){if((0,o.default)(e.target).hasClass("nav-link")){var t=(0,o.default)(e.target).closest(".nav-item");for(c._stopEventPropagation(e),t=t.prev(".nav-item");t.hasClass("d-none");)t=t.prev(".nav-item");t.find(".dropdown-toggle").first().dropdown("toggle")}else if((0,o.default)(e.target).closest(".dropdown-menu").length>0){var n=(0,o.default)(e.target).closest("li");c._stopEventPropagation(e);var a=n.closest(".dropdown-menu");a.closest(".dropdown-submenu").length>0&&(a.removeClass("show"),a.closest(".dropdown-submenu").removeClass("dropdown-submenu-visible"),(n=a.closest(".dropdown-submenu")).find(".dropdown-item").trigger("focus"))}},bindMainMenuRight:function(e){if((0,o.default)(e.target).hasClass("nav-link")){var t=(0,o.default)(e.target).closest(".nav-item");for(c._stopEventPropagation(e),t=t.next(".nav-item");t.hasClass("d-none");)t=t.next(".nav-item");t.find(".dropdown-toggle").first().dropdown("toggle")}else if((0,o.default)(e.target).closest(".dropdown-menu").length>0){var n=(0,o.default)(e.target).closest("li");c._stopEventPropagation(e),n.hasClass("dropdown-submenu")&&(n.addClass("dropdown-submenu-visible"),n.find(".dropdown-menu").addClass("show"),n.find(".dropdown-menu .dropdown-item").first().trigger("focus"))}},bindMainMenuUpDown:function(e,t){if((0,o.default)(e.target).closest(".dropdown-menu").length>0){c._stopEventPropagation(e);var n=(0,o.default)(e.target).closest("li"),a=(0,o.default)(e.target).closest(".dropdown-menu");for(a.find(".show").removeClass("show"),a.find(".dropdown-submenu").removeClass("dropdown-submenu-visible"),"up"===t?n=n.prev():"down"===t&&(n=n.next());n.hasClass("dropdown-divider")||n.find(".dropdown-item").first().hasClass("disabled");)"up"===t?n=n.prev():"down"===t&&(n=n.next());n.find(".dropdown-item").trigger("focus")}},bindLeftTree:function(){var e=this.getTreeDetails();(0,o.default)("#tree").trigger("focus"),e.t.focus(e.i),e.t.select(e.i)},bindSubMenuQueryTool:function(){var e=this.getTreeDetails();e.d&&r.default.DataGrid.show_query_tool("",e.i)},bindSubMenuViewData:function(){var e=this.getTreeDetails();e.d&&r.default.DataGrid.show_data_grid({mnuid:1},e.i)},bindSubMenuSearchObjects:function(){var e=this.getTreeDetails();e.d&&r.default.SearchObjects.show_search_objects("",e.i)},bindSubMenuProperties:function(){var e=this.getTreeDetails();e.d&&!0!==r.default.Browser.Nodes[e.t.itemData(e.i)._type].collection_node&&r.default.Browser.Node.callbacks.show_obj_properties.call(r.default.Browser.Nodes[e.t.itemData(e.i)._type],{action:"edit"})},bindSubMenuCreate:function(){var e=this.getTreeDetails(),t=r.default.Browser.Nodes[e.t.itemData(e.i)._type];if(e.d){if(!0===t.collection_node){if(!t.node)return;t=r.default.Browser.Nodes[t.node]}r.default.Browser.Node.callbacks.show_obj_properties.call(t,{action:"create",item:e.i})}},bindSubMenuDelete:function(){var e=this.getTreeDetails();e.d&&!0!==r.default.Browser.Nodes[e.t.itemData(e.i)._type].collection_node&&r.default.Browser.Node.callbacks.delete_obj.call(r.default.Browser.Nodes[e.t.itemData(e.i)._type])},bindSubMenuRefresh:function(e){e.preventDefault();var t=_.keyboardNavigation.getTreeDetails();r.default.Browser.Node.callbacks.refresh.call(r.default.Browser.Nodes[t.t.itemData(t.i)._type])},bindContextMenu:function(e){var t=this.getTreeDetails(),n=e.srcElement||e.target,a=(0,o.default)(n).find(".aciTreeEntry").position().left+70,i=(0,o.default)(n).find(".aciTreeEntry").position().top+70;t.t.blur(t.i),(0,o.default)("#tree").trigger("blur"),t.i.children().contextMenu({x:a,y:i})},bindDirectDebugging:function(){var e=this.getTreeDetails(),t=e.t.itemData(e.i)._type;!e.d||"function"!==t&&"procedure"!==t||r.default.Tools.Debugger.can_debug(e.d,e.i,{debug_type:"direct"})&&r.default.Tools.Debugger.get_function_information(r.default.Browser.Nodes[t])},bindDropMultipleObjects:function(){!0===this.isPropertyPanelVisible()&&(0,o.default)("button.delete_multiple").length>0&&(0,o.default)("button.delete_multiple").click()},bindDropCascadeMultipleObjects:function(){!0===this.isPropertyPanelVisible()&&(0,o.default)("button.delete_multiple_cascade").length>0&&(0,o.default)("button.delete_multiple_cascade").click()},bindAddGridRow:function(){var e=(0,o.default)(document.activeElement).closest(".object.subnode");(0,o.default)(e).length&&(0,o.default)(e).find(".add").click()},isPropertyPanelVisible:function(){var e=!1;return i.default.each(r.default.Browser.docker.findPanels(),(function(t){"properties"===t._type&&(e=t.isVisible())})),e},getTreeDetails:function(){var e=r.default.Browser.tree,t=e.selected().length>0?e.selected():e.first(),n=t&&1===t.length?e.itemData(t):void 0;return{t:e,i:t,d:n}},getDialogTabNavigator:function(e){var t=u.default.pgAdmin.Browser.get_preference("browser","dialog_tab_backward").value,n=u.default.pgAdmin.Browser.get_preference("browser","dialog_tab_forward").value;return new d.default.dialogTabNavigator(e,t,n)}}),e.exports=r.default.Browser.keyboardNavigation},,,,function(e,t,n){"use strict";n(3),n(88),Object.defineProperty(t,"__esModule",{value:!0}),t.ModelValidation=void 0;var a=o(n(2)),i=o(n(1)),r=n(255);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.err={},this.errmsg="",this.model=t}var t,n,o;return t=e,o=[{key:"isEmptyString",value:function(e){return i.default.isUndefined(e)||i.default.isNull(e)||""===String(e).trim()}}],(n=[{key:"validate",value:function(){var t=this.model.get("service");return!this.model.isNew()&&"id"in this.model.sessAttrs?(this.err.id=(0,a.default)("The ID cannot be changed."),this.errmsg=this.err.id):this.model.errorModel.unset("id"),this.checkForEmpty("name",(0,a.default)("Name must be specified.")),e.isEmptyString(t)?(this.setNullValueForEmptyString("service"),this.checkHostAndHostAddress(),this.checkForEmpty("db",(0,a.default)("Maintenance database must be specified.")),this.checkForEmpty("username",(0,a.default)("Username must be specified.")),this.checkForEmpty("port",(0,a.default)("Port must be specified."))):(this.checkForEmpty("db",(0,a.default)("Maintenance database must be specified.")),this.clearHostAddressAndDbErrors()),this.model.get("use_ssh_tunnel")&&(this.checkForEmpty("tunnel_host",(0,a.default)("SSH Tunnel host must be specified.")),this.checkForEmpty("tunnel_port",(0,a.default)("SSH Tunnel port must be specified.")),this.checkForEmpty("tunnel_username",(0,a.default)("SSH Tunnel username must be specified.")),this.model.get("tunnel_authentication")&&this.checkForEmpty("tunnel_identity_file",(0,a.default)("SSH Tunnel identity file must be specified."))),this.model.errorModel.set(this.err),i.default.size(this.err)?this.errmsg:null}},{key:"setNullValueForEmptyString",value:function(e){var t=this.model.get(e);i.default.isUndefined(t)||i.default.isNull(t)||""===String(t).trim()&&this.model.set(e,null)}},{key:"clearHostAddressAndDbErrors",value:function(){var e=this;i.default.each(["host","hostaddr","db","username","port"],(function(t){e.setNullValueForEmptyString(t),e.model.errorModel.unset(t)}))}},{key:"checkHostAndHostAddress",value:function(){var e=(0,a.default)("Either Host name, Address or Service must be specified.");this.checkForEmpty("host",e)&&this.checkForEmpty("hostaddr",e)?this.errmsg=this.errmsg||e:(this.errmsg=void 0,delete this.err.host,delete this.err.hostaddr),this.checkForValidIp(this.model.get("hostaddr"),(0,a.default)("Host address must be valid IPv4 or IPv6 address."))}},{key:"checkForValidIp",value:function(e,t){if(e){var n=new r.Address6(e).isValid();new r.Address4(e).isValid()||n||(this.err.hostaddr=t,this.errmsg=t)}else this.model.errorModel.unset("hostaddr")}},{key:"checkForEmpty",value:function(t,n){var a=this.model.get(t);return e.isEmptyString(a)?(this.err[t]=n,this.errmsg=this.errmsg||n,!0):(this.model.errorModel.unset(t),!1)}}])&&s(t.prototype,n),o&&s(t,o),e}();t.ModelValidation=l},,,,function(e,t,n){"use strict";var a,i;n(41),n(15),n(35),n(114),n(10),n(5),n(9),n(30),n(7),a=[n(2),n(0),n(1),n(20),n(11),n(17),n(33),n(32)],void 0===(i=function(e,t,n,a,i,r,o){o.PartitionRow=o.Row.extend({modelDuplicateClass:"bg-model-duplicate",initialize:function(){o.Row.prototype.initialize.apply(this,arguments);var e=this;e.model.on("change:is_attach",(function(){setTimeout((function(){e.columns.each((function(t){if("partition_name"==t.get("name")){var n=e.columns.indexOf(t),a=new(t.get("cellFunction").apply(t,[e.model]))({column:t,model:e.model});e.cells[n].remove(),e.cells[n]=a,e.render()}}))}),10)})),e.listenTo(e.model,"pgadmin-session:model:duplicate",e.modelDuplicate),e.listenTo(e.model,"pgadmin-session:model:unique",e.modelUnique)},modelDuplicate:function(){t(this.el).removeClass("new"),t(this.el).addClass(this.modelDuplicateClass)},modelUnique:function(){t(this.el).removeClass(this.modelDuplicateClass)}});r.PartitionKeyModel=i.Node.Model.extend({defaults:{key_type:"column",pt_column:void 0,expression:void 0},keys:["pt_column"],schema:[{id:"key_type",label:e("Key type"),type:"select2",editable:!0,cell:"select2",cellHeaderClasses:"width_percent_25",select2:{allowClear:!1},options:[{label:e("Column"),value:"column"},{label:e("Expression"),value:"expression"}]},{id:"pt_column",label:e("Column"),type:"text",cell:o.Extension.Select2DepCell.extend({keyPathAccessor:function(e,t){var a=e;if(n.isArray(a))return n.map(a,(function(e){return e.pt_column}));t=t.split(".");for(var i=0;i<t.length;i++){if(n.isNull(a))return null;n.isEmpty(t[i])||(n.isUndefined(a[t[i]])||(a=a[t[i]]))}return n.isObject(a)&&!n.isArray(a)?null:a},initialize:function(){var e=this;if(this.model.handler){if(o.Extension.Select2DepCell.prototype.initialize.apply(this,arguments),n.isUndefined(e.model.get("oid"))){var t=e.model.top.get("columns");e.listenTo(t,"remove",e.resetColOptions),e.listenTo(t,"change:name",e.resetColOptions)}e.custom_options()}},resetColOptions:function(){var e=this;setTimeout((function(){e.custom_options(),e.render.apply(e)}),50)},custom_options:function(){var e=this.model.top.get("columns"),t=this.model.top.get("typname"),a=this.model.top.of_types_tables,i=[];e.length>0?n.each(e.models,(function(e){var t=e.get("name");n.isUndefined(t)||n.isNull(t)||i.push({label:t,value:t,image:"icon-column"})})):!n.isUndefined(t)&&!n.isNull(t)&&!n.isUndefined(a)&&a.length>0&&n.each(a,(function(e){e.label==t&&n.each(e.oftype_columns,(function(e){i.push({label:e.name,value:e.name,image:"icon-column"})}))})),this.column.set("options",i)},remove:function(){if(this.model.handler){var e=this,t=e.model.top.get("columns");e.stopListening(t,"remove",e.resetColOptions),e.stopListening(t,"change:name",e.resetColOptions),o.Extension.Select2DepCell.prototype.remove.apply(this,arguments)}}}),deps:["key_type"],cellHeaderClasses:"width_percent_30",transform:function(e){var t=[];return e&&n.isArray(e)&&n.each(e,(function(e){t.push({label:e.label,value:e.label,image:"icon-column"})})),t},select2:{allowClear:!1},editable:function(e){return"expression"!=e.get("key_type")||(setTimeout((function(){e.set("pt_column",void 0)}),10),!1)}},{id:"expression",label:e("Expression"),type:"text",cell:o.Extension.StringDepCell,cellHeaderClasses:"width_percent_45",deps:["key_type"],editable:function(e){return"column"!=e.get("key_type")||(setTimeout((function(){e.set("expression",void 0)}),10),!1)}}],validate:function(){var t,a=this.get("key_type"),i=this.get("pt_column"),r=this.get("expression");return this.errorModel.clear(),n.isUndefined(a)||n.isNull(a)||""==String(a).replace(/^\s+|\s+$/g,"")?(t=e("Partition key type cannot be empty."),this.errorModel.set("key_type",t),t):"column"==a&&n.isUndefined(i)||n.isNull(i)||""==String(i).replace(/^\s+|\s+$/g,"")?(t=e("Partition key column cannot be empty."),this.errorModel.set("pt_column",t),t):"expression"==a&&n.isUndefined(r)||n.isNull(r)||""==String(r).replace(/^\s+|\s+$/g,"")?(t=e("Partition key expression cannot be empty."),this.errorModel.set("expression",t),t):null}}),r.PartitionsModel=i.Node.Model.extend({idAttribute:"oid",defaults:{oid:void 0,is_attach:!1,partition_name:void 0,is_default:void 0,values_from:void 0,values_to:void 0,values_in:void 0,values_modulus:void 0,values_remainder:void 0,is_sub_partitioned:!1,sub_partition_type:"range"},keys:["partition_name"],schema:[{id:"oid",label:e("OID"),type:"text",mode:["properties"]},{id:"is_attach",label:e("Operation"),cell:"switch",type:"switch",options:{onText:e("Attach"),offText:e("Create"),width:65},cellHeaderClasses:"width_percent_5",editable:function(e){return!(!(e instanceof a.Model&&e.isNew())||e.top.isNew())},disabled:function(e){return!(e instanceof a.Model&&e.isNew()&&!e.top.isNew())}},{id:"partition_name",label:e("Name"),type:"text",cell:"string",cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e instanceof a.Model&&e.isNew())},cellFunction:function(e){if(e.get("is_attach")){var t=[];return e.set({partition_name:void 0},{silent:!0}),n.each(e.top.table_options,(function(e){t.push([e.label,e.value])})),o.Extension.Select2Cell.extend({optionValues:t})}return o.StringCell},disabled:function(e){return!(e instanceof a.Model&&e.isNew())}},{id:"is_default",label:e("Default"),type:"switch",cell:"switch",cellHeaderClasses:"width_percent_5",min_version:11e4,options:{onText:e("Yes"),offText:e("No")},editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&("range"===e.handler.top.attributes.partition_type||"list"===e.handler.top.attributes.partition_type)&&e instanceof a.Model&&e.isNew()&&e.handler.top.node_info.server.version>=11e4)},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&("range"===e.handler.top.attributes.partition_type||"list"===e.handler.top.attributes.partition_type)&&e instanceof a.Model&&e.isNew()&&e.handler.top.node_info.server.version>=11e4)}},{id:"values_from",label:e("From"),type:"text",cell:o.Extension.StringDepCell,deps:["is_default"],cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"range"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew()&&!0!==e.get("is_default"))},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"range"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew()&&!0!==e.get("is_default"))}},{id:"values_to",label:e("To"),type:"text",cell:o.Extension.StringDepCell,deps:["is_default"],cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"range"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew()&&!0!==e.get("is_default"))},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"range"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew()&&!0!==e.get("is_default"))}},{id:"values_in",label:e("In"),type:"text",cell:o.Extension.StringDepCell,deps:["is_default"],cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"list"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew()&&!0!==e.get("is_default"))},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"list"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew()&&!0!==e.get("is_default"))}},{id:"values_modulus",label:e("Modulus"),type:"int",cell:o.Extension.StringDepCell,cellHeaderClasses:"width_percent_15",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"hash"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew())},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"hash"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew())}},{id:"values_remainder",label:e("Remainder"),type:"int",cell:o.Extension.StringDepCell,cellHeaderClasses:"width_percent_15 width_percent_20",editable:function(e){return!!(e.handler&&e.handler.top&&e.handler.top.attributes&&"hash"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew())},disabled:function(e){return!(e.handler&&e.handler.top&&e.handler.top.attributes&&"hash"===e.handler.top.attributes.partition_type&&e instanceof a.Model&&e.isNew())}},{id:"is_sub_partitioned",label:e("Partitioned table?"),cell:"switch",group:"Partition",type:"switch",mode:["properties","create","edit"],deps:["is_attach"],disabled:function(e){return!e.isNew()||!!e.get("is_attach")&&(setTimeout((function(){e.set("is_sub_partitioned",!1)}),10),!0)}},{id:"sub_partition_type",label:e("Partition Type"),editable:!1,type:"select2",select2:{allowClear:!1},group:"Partition",deps:["is_sub_partitioned"],options:function(){var t=[{label:e("Range"),value:"range"},{label:e("List"),value:"list"}];return!n.isUndefined(this.node_info)&&!n.isUndefined(this.node_info.server)&&!n.isUndefined(this.node_info.server.version)&&this.node_info.server.version>=11e4&&t.push({label:e("Hash"),value:"hash"}),t},visible:function(e){return!!e.isNew()},disabled:function(e){return!e.isNew()||!e.get("is_sub_partitioned")}},{id:"sub_partition_keys",label:e("Partition Keys"),model:r.PartitionKeyModel,subnode:r.PartitionKeyModel,editable:!0,type:"collection",group:"Partition",mode:["properties","create","edit"],deps:["is_sub_partitioned","sub_partition_type"],canEdit:!1,canDelete:!0,control:"sub-node-collection",canAdd:function(e){return!(!e.isNew()||!e.get("is_sub_partitioned"))},canAddRow:function(e){var t=e.top.get("columns"),a=e.top.get("typname"),i=!1,r=1e3;return e.get("sub_partition_type")&&"list"==e.get("sub_partition_type")&&(r=1),t.length<=0&&!n.isUndefined(a)&&!n.isNull(a)&&e.of_types_tables.length>0?n.each(e.of_types_tables,(function(e){e.label==a&&e.oftype_columns.length>0&&(i=!0)})):t.length>0&&(i=n.some(t.pluck("name"))),e.get("sub_partition_keys")&&e.get("sub_partition_keys").length<r&&i},disabled:function(e){e.get("sub_partition_keys")&&e.get("sub_partition_keys").models.length>0&&setTimeout((function(){var t=e.get("sub_partition_keys");t.remove(t.filter((function(){return!0})))}),10)},visible:function(e){return!!e.isNew()}},{id:"sub_partition_scheme",label:e("Partition Scheme"),type:"note",group:"Partition",mode:["edit"],visible:function(e){return!e.isNew()&&!n.isUndefined(e.get("sub_partition_scheme"))&&""!=e.get("sub_partition_scheme")},disabled:function(e){e.isNew()||(this.text=e.get("sub_partition_scheme"))}}],validate:function(){var t,a=this.get("partition_name"),i=this.get("is_default"),r=this.get("values_from"),o=this.get("values_to"),s=this.get("values_in"),l=this.get("values_modulus"),d=this.get("values_remainder"),c=this.get("is_sub_partitioned"),u=this.get("sub_partition_keys");if(this.errorModel.clear(),this.top.errorModel.clear(),n.isUndefined(a)||n.isNull(a)||""===String(a).replace(/^\s+|\s+$/g,""))return t=e("Partition name cannot be empty."),this.errorModel.set("partition_name",t),t;if(c&&this.isNew()&&!n.isNull(u)&&u.length<=0)return t=e("Please specify at least one key for partitioned table."),this.top.errorModel.set("sub_partition_keys",t),t;if("range"===this.top.get("partition_type")){if(!0!==i&&(n.isUndefined(r)||n.isNull(r)||""===String(r).replace(/^\s+|\s+$/g,"")))return t=e("For range partition From field cannot be empty."),this.errorModel.set("values_from",t),t;if(!0!==i&&(n.isUndefined(o)||n.isNull(o)||""===String(o).replace(/^\s+|\s+$/g,"")))return t=e("For range partition To field cannot be empty."),this.errorModel.set("values_to",t),t}else if("list"===this.top.get("partition_type")){if(!0!==i&&(n.isUndefined(s)||n.isNull(s)||""===String(s).replace(/^\s+|\s+$/g,"")))return t=e("For list partition In field cannot be empty."),this.errorModel.set("values_in",t),t}else if("hash"===this.top.get("partition_type")){if(n.isUndefined(l)||n.isNull(l)||""===String(l).replace(/^\s+|\s+$/g,""))return t=e("For hash partition Modulus field cannot be empty."),this.errorModel.set("values_modulus",t),t;if(n.isUndefined(d)||n.isNull(d)||""===String(d).replace(/^\s+|\s+$/g,""))return t=e("For hash partition Remainder field cannot be empty."),this.errorModel.set("values_remainder",t),t}return null}})}.apply(t,a))||(e.exports=i)},,function(e,t,n){"use strict";var a,i;n(35),a=[n(0),n(1),n(119),n(58),n(311)],void 0===(i=function(e,t,n,a,i){var r=function(){return!e(".copy-with-header").hasClass("visibility-hidden")},o=function(t,n){t&&(e("#btn-paste-row").prop("disabled",!n),n&&window.parent.$&&window.parent.$(window.parent.document).trigger("pgadmin-sqleditor:rows-copied",r()))};return function(){var e=this||window,t=e.slickgrid,s=t.getColumns(),l=t.getSelectionModel().getSelectedRanges(),d=t.getData(),c=t.getSelectedRows(),u=t.CSVOptions;a.areAllRangesCompleteRows(t,l)?(e.copied_rows=c.map((function(e){return t.getDataItem(e)})),o(e.can_edit,!0)):(e.copied_rows=[],o(e.can_edit,!1));var f=i.rangesToCsv(d.getItems(),s,l,u,r());f&&n.copyTextToClipboard(f)}}.apply(t,a))||(e.exports=i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";(function(t){n(8),n(7);var a=d(n(2)),i=d(n(6)),r=d(n(0)),o=d(n(13)),s=d(n(4)),l=n(106);function d(e){return e&&e.__esModule?e:{default:e}}e.exports=o.default.dialog("fileSelectionDlg",(function(){return{main:function(e){t.isUndefined(e.dialog_title)&&(e.dialog_title=(0,a.default)("Select file")),this.dialog_type=e.dialog_type,this.set("title",e.dialog_title),this.params=JSON.stringify(e),this.show()},settings:{label:void 0},settingUpdated:function(e,t,n){switch(e){case"message":this.setMessage(n);break;case"label":this.__internal.buttons[0].element&&(this.__internal.buttons[0].element.innerHTML=n)}},prepare:function(){var e=this;e.$container.find(".storage_content").remove(),e.$container.append("<div class='storage_content'></div>");var n=e.$container.find(".storage_content");n.empty(),(0,r.default)(this.elements.body.childNodes[0]).addClass("alertify_tools_dialog_properties"),r.default.get((0,i.default)("file_manager.index"),(function(e){n.append(e)}));var a,o=(0,l.getTransId)(e.params);4==o.readyState&&(a=JSON.parse(o.responseText)),e.trans_id=t.isUndefined(a)?0:a.data.fileTransId,setTimeout((function(){(0,r.default)(e.$container.find(".file_manager")).on("enter-key",(function(){(0,r.default)((0,r.default)(e.elements.footer).find(".file_manager_ok")).trigger("click")}))}),200),e.__internal.buttons[1]&&(e.__internal.buttons[1].element.disabled=!0)},setup:function(){return{buttons:[{text:(0,a.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times pg-alertify-button"},{text:(0,a.default)("Select"),key:13,className:"btn btn-primary fa fa-file file_manager_ok pg-alertify-button disabled"}],options:{closableByDimmer:!1,maximizable:!1,closable:!1,movable:!0,padding:!1,overflow:!1,model:0,resizable:!0,pinnable:!1,modal:!1,autoReset:!1}}},callback:function(e){var t;if(e.button.text==(0,a.default)("Select")){var n=(0,r.default)(".storage_dialog #uploader .input-path").val(),i={path:(0,r.default)(".currentpath").val()};s.default.Browser.Events.trigger("pgadmin-storage:finish_btn:"+this.dialog_type,n),t=(0,r.default)(this.elements.body).find(".storage_content"),(0,r.default)(t).find("*").off(),t.remove(),(0,l.removeTransId)(this.trans_id),(0,l.set_last_traversed_dir)(i,this.trans_id)}else e.button.text==(0,a.default)("Cancel")&&(t=(0,r.default)(this.elements.body).find(".storage_content"),(0,r.default)(t).find("*").off(),t.remove(),(0,l.removeTransId)(this.trans_id),s.default.Browser.Events.trigger("pgadmin-storage:cancel_btn:"+this.dialog_type))},build:function(){this.$container=(0,r.default)('<div class="storage_dialog file_selection_dlg"></div>'),this.elements.content.appendChild(this.$container.get(0)),o.default.pgDialogBuild.apply(this)},hooks:{onshow:function(){}}}}))}).call(this,n(1))},function(e,t,n){"use strict";(function(t){n(8),n(66),n(122),n(5),n(67),n(30);var a=d(n(2)),i=d(n(6)),r=d(n(0)),o=d(n(13)),s=d(n(4)),l=n(106);function d(e){return e&&e.__esModule?e:{default:e}}e.exports=o.default.dialog("createModeDlg",(function(){return{setup:function(){return{buttons:[{text:(0,a.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times file_manager_create_cancel pg-alertify-button"},{text:(0,a.default)("Create"),key:13,className:"btn btn-primary fa fa-file file_manager_create file_manager_ok pg-alertify-button disabled"}],options:{closableByDimmer:!1,maximizable:!1,closable:!1,movable:!0,padding:!1,overflow:!1,model:0,resizable:!0,pinnable:!1,modal:!1,autoReset:!1}}},replace_file:function(){var e=(0,r.default)(".replace_file .btn_yes"),t=(0,r.default)(".replace_file .btn_no");(0,r.default)(".storage_dialog #uploader .input-path").attr("disabled",!0),(0,r.default)(".file_manager_ok").addClass("disabled"),(0,r.default)(".replace_file, .fm_dimmer").show(),e.on("click",(function(){(0,r.default)(".replace_file, .fm_dimmer").hide(),e.off(),t.off();var n=(0,r.default)(".storage_dialog #uploader .input-path").val();s.default.Browser.Events.trigger("pgadmin-storage:finish_btn:create_file",n),(0,r.default)(".file_manager_create_cancel").trigger("click"),(0,r.default)(".storage_dialog #uploader .input-path").attr("disabled",!1),(0,r.default)(".file_manager_ok").removeClass("disabled")})),t.on("click",(function(){(0,r.default)(".replace_file, .fm_dimmer").hide(),e.off(),t.off(),(0,r.default)(".storage_dialog #uploader .input-path").attr("disabled",!1),(0,r.default)(".file_manager_ok").removeClass("disabled")}))},is_file_exist:function(){var e=(0,r.default)(".storage_dialog #uploader .input-path").val(),t=e.substr(0,e.lastIndexOf("/")+1),n=e.substr(e.lastIndexOf("/")+1),a=!1,o={path:t,name:n,mode:"is_file_exist"};return r.default.ajax({type:"POST",data:JSON.stringify(o),url:(0,i.default)("file_manager.filemanager",{trans_id:this.trans_id}),dataType:"json",contentType:"application/x-download; charset=utf-8",async:!1}).done((function(e){var t=e.data.result;a=1===t.Code})),a},check_permission:function(e){var t=!1,n={path:e,mode:"permission"};return r.default.ajax({type:"POST",data:JSON.stringify(n),url:(0,i.default)("file_manager.filemanager",{trans_id:this.trans_id}),dataType:"json",contentType:"application/json; charset=utf-8",async:!1}).done((function(e){var n=e.data.result;1===n.Code?t=!0:((0,r.default)(".file_manager_ok").addClass("disabled"),o.default.error(n.Error))})).fail((function(){(0,r.default)(".file_manager_ok").addClass("disabled"),o.default.error((0,a.default)("Error occurred while checking access permission."))})),t},callback:function(e){if(e.button.text==(0,a.default)("Create")){var n,i=(0,r.default)(".storage_dialog #uploader .input-path").val(),o={path:(0,r.default)(".currentpath").val()},d=(0,r.default)(".allowed_file_types select").val();if(i.includes(".")&&i.split(".").pop()==d||"*"==d||(i=i+"."+d,(0,r.default)(".storage_dialog #uploader .input-path").val(i)),!this.check_permission(i))return void(e.cancel=!0);!t.isUndefined(i)&&""!==i&&this.is_file_exist()?(this.replace_file(),this.$container.find(".replace_file").find(".btn_yes").trigger("focus"),e.cancel=!0):(s.default.Browser.Events.trigger("pgadmin-storage:finish_btn:create_file",i),n=(0,r.default)(this.elements.body).find(".storage_content"),(0,r.default)(n).find("*").off(),n.remove(),(0,l.removeTransId)(this.trans_id)),(0,l.set_last_traversed_dir)(o,this.trans_id)}else e.button.text==(0,a.default)("Cancel")&&(n=(0,r.default)(this.elements.body).find(".storage_content"),(0,r.default)(n).find("*").off(),n.remove(),(0,l.removeTransId)(this.trans_id),s.default.Browser.Events.trigger("pgadmin-storage:cancel_btn:create_file"))}}}),!0,"fileSelectionDlg")}).call(this,n(1))},function(e,t,n){"use strict";var a=r(n(2)),i=r(n(13));function r(e){return e&&e.__esModule?e:{default:e}}e.exports=i.default.dialog("fileStorageDlg",(function(){return{settingUpdated:function(e,t,n){"message"==e&&this.setMessage(n)},setup:function(){return{buttons:[{text:(0,a.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times pg-alertify-button"}],options:{closableByDimmer:!1,maximizable:!1,closable:!1,movable:!0,padding:!1,overflow:!1,model:0,resizable:!0,pinnable:!1,modal:!1,autoReset:!1}}}}}),!0,"fileSelectionDlg")},,,,,,,,,,function(e,t){e.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.disableTriggers=function(e,t,n,a){return r(e,t,n,a,{is_enable_trigger:"D"})},t.enableTriggers=function(e,t,n,a){return r(e,t,n,a,{is_enable_trigger:"O"})};var a,i=(a=n(54))&&a.__esModule?a:{default:a};function r(e,t,n,a,r){var o=function(e,t){var n=(e||{}).item||t.selected();return t.findNodeByDomElement(n)}(a,e);if(!o||null===o.getData()||void 0===o.getData())return!1;i.default.put(n(o.getHtmlIdentifier(),"set_trigger",o.getData(),!0),r).then((function(n){1===n.data.success&&(t.success(n.data.info),o.reload(e))})).catch((function(n){try{var a=n.response.data;0===a.success&&t.error(a.errormsg)}catch(e){console.warn(e.stack||e)}o.unload(e)}))}},function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(21),n(24),n(25),n(14),n(3),n(34),n(12),n(19),n(44),n(16),Object.defineProperty(t,"__esModule",{value:!0}),t.show_advanced_tab=function(e){if(function(e){return!i.isUndefined(e.node_info)&&!i.isUndefined(e.node_info.server)&&"gpdb"===e.node_info.server.server_type}(e))return!1;return!0};var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=r();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,t&&t.set(e,n);return n}(n(1));function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}},,,function(e,t,n){"use strict";var a,i;n(21),n(41),n(8),n(40),n(66),n(15),n(14),n(122),n(35),n(212),n(42),n(94),n(48),n(201),n(27),n(18),n(10),n(97),n(70),n(3),n(34),n(71),n(43),n(12),n(36),n(5),n(29),n(67),n(19),n(68),n(9),n(30),n(88),n(46),n(16),n(7),n(179);var r=n(92);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}a=[n(2),n(6),n(0),n(379),n(380),n(1),n(13),n(4),n(20),n(84),n(22),n(304),n(109),n(308),n(310),n(119),n(213),n(58),n(381),n(313),n(314),n(63),n(315),n(126),n(316),n(318),n(320),n(321),n(322),n(325),n(78),n(182),n(326),n(162),n(99),n(183),n(327),n(328),n(181),n(89),n(65),n(39),n(329),n(330),n(205),n(204),n(386),n(387),n(253),n(11),n(125)],void 0===(i=function(e,t,n,a,i,o,d,c,u,f,p,h,_,g,m,b,v,y,w,x,C,S,k,T,E,q,O,P,D,N,j,M,R,A,I,L,B,V,U,H,F,z,$,K){if(c.SqlEditor)return c.SqlEditor;var G=window.wcDocker,Q=c.Browser,J=f.default,W=window.Slick,Y=P.default,Z=D.default,X=N.QuerySources;H.setPGCSRFToken(c.csrf_token_header,c.csrf_token);var ee=!1,te='<div role="status" class="pg-panel-message">'+e("No data output. Execute a query to get output.")+"</div>",ne='<div role="status" class="pg-panel-message">'+e('Use Explain/Explain analyze button to generate the plan for a query. Alternatively, you can also execute "EXPLAIN (FORMAT JSON) [QUERY]".')+"</div>",ae=u.View.extend({initialize:function(t){this.$el=t.el,this.handler=t.handler,this.handler.col_size={};var n=z.default.pgAdmin.Browser;this.preferences=n.get_preferences_for_module("sqleditor"),this.browser_preferences=n.get_preferences_for_module("browser"),this.handler.preferences=this.preferences,this.handler.browser_preferences=this.browser_preferences,this.connIntervalId=null,this.layout=t.layout,this.set_server_version(t.server_ver),this.trigger("pgadmin-sqleditor:view:initialised"),this.connection_list=[{server_group:null,server:null,database:null,user:null,role:null,title:"&lt;"+e("New Connection")+"&gt;"}]},events:{"click #btn-show-query-tool":"on_show_query_tool","click .btn-load-file":"on_file_load","click #btn-save-file":"on_save_file","click #btn-file-menu-save":"on_save_file","click #btn-file-menu-save-as":"on_save_as","click #btn-find":"on_find","click #btn-find-menu-find":"on_find","click #btn-find-menu-find-next":"on_find_next","click #btn-find-menu-find-previous":"on_find_previous","click #btn-find-menu-replace":"on_replace","click #btn-find-menu-replace-all":"on_replace_all","click #btn-find-menu-find-persistent":"on_find_persistent","click #btn-find-menu-jump":"on_jump","click #btn-delete-row":"on_delete","click #btn-save-data":"on_save_data","click #btn-filter":"on_show_filter","click #btn-filter-menu":"on_show_filter","click #btn-include-filter":"on_include_filter","click #btn-exclude-filter":"on_exclude_filter","click #btn-remove-filter":"on_remove_filter","click #btn-cancel":"on_cancel","click #btn-copy-row":"on_copy_row","click #btn-copy-with-header":"on_copy_row_with_header","click #btn-paste-row":"on_paste_row","click #btn-flash":"on_flash","click #btn-flash-menu":"on_flash","click #btn-cancel-query":"on_cancel_query","click #btn-download":"on_download","click #btn-clear":"on_clear","click #btn-auto-commit":"on_auto_commit","click #btn-auto-rollback":"on_auto_rollback","click #btn-clear-history":"on_clear_history","click .noclose":"do_not_close_menu","click #btn-explain":"on_explain","click #btn-explain-analyze":"on_explain_analyze","click #btn-explain-verbose":"on_explain_verbose","click #btn-explain-costs":"on_explain_costs","click #btn-explain-buffers":"on_explain_buffers","click #btn-explain-timing":"on_explain_timing","click #btn-explain-summary":"on_explain_summary","click #btn-explain-settings":"on_explain_settings","change .limit":"on_limit_change",keydown:"keyAction","click #btn-comment-code":"on_toggle_comment_block_code","click #btn-toggle-comment-block":"on_toggle_comment_block_code","click #btn-comment-line":"on_comment_line_code","click #btn-uncomment-line":"on_uncomment_line_code","click #btn-indent-code":"on_indent_code","click #btn-unindent-code":"on_unindent_code","click #btn-format-sql":"on_format_sql","click #btn-commit":"on_commit_transaction","click #btn-rollback":"on_rollback_transaction","click #btn-manage-macros":"on_manage_macros","click .btn-macro":"on_execute_macro"},render_connection:function(e){if(this.handler.is_query_tool){document.getElementById("connections-list").innerHTML="",e.forEach((function(e,t){var a="";a="is_selected"in e&&e.is_selected?'<li class="connection-list-item selected-connection" data-index='+t+'><a class="dropdown-item" href="#" tabindex="0">'+e.title+"</a></li>":'<li class="connection-list-item" data-index='+t+'><a class="dropdown-item" href="#" tabindex="0">'+e.title+"</a></li>",n("#connections-list").append(a)}));var t=this;n(".connection-list-item").click((function(){t.get_connection_data(this)}))}else n(".conn-info-dd").hide(),n(".connection-data").css({pointerEvents:"none",cursor:"arrow"})},get_connection_data:function(e){var t=n(e).attr("data-index"),a=this.connection_list[t];a.server_group?this.on_change_connection(a):this.on_new_connection()},reflectPreferences:function(){var e=z.default.pgAdmin.Browser,t=e.get_preferences_for_module("browser");Q.preference_version()<e.preference_version()&&(Q.preference_version(e.preference_version()),this.preferences=e.get_preferences_for_module("sqleditor"),this.preferences.show_query_tool=t.sub_menu_query_tool,this.handler.preferences=this.preferences,V.updateUIPreferences(this))},buildDefaultLayout:function(e){var t=e.addPanel("sql_panel",G.DOCK.TOP);e.addPanel("scratch",G.DOCK.RIGHT,t),e.addPanel("history",G.DOCK.STACKED,t);var n=e.addPanel("data_output",G.DOCK.BOTTOM);e.addPanel("explain",G.DOCK.STACKED,n),e.addPanel("messages",G.DOCK.STACKED,n),e.addPanel("notifications",G.DOCK.STACKED,n)},set_server_version:function(e){var t=this;t.server_ver=e,this.$el.find("*[data-min-ver]").map((function(){var e=n(this);parseInt(e.attr("data-min-ver"))>t.server_ver?e.addClass("d-none"):e.removeClass("d-none")}))},set_editor_title:function(e){this.$el.find(".editor-title").text(o.unescape(e)),this.render_connection(this.connection_list)},render:function(){var a=this;a.gain_focus=function(){setTimeout((function(){S.updateConnectionStatusFlag("visible")}),100)},a.lost_focus=function(){setTimeout((function(){S.updateConnectionStatusFlag("hidden")}),100)},a.docker=new G("#editor-panel",{allowContextMenu:!0,allowCollapse:!1,loadingClass:"pg-sp-icon",themePath:t("static",{filename:"css"}),theme:"webcabin.overrides.css"});var i=new c.Browser.Panel({name:"sql_panel",title:e("Query Editor"),width:"75%",height:"33%",isCloseable:!1,isPrivate:!0}),r=new c.Browser.Panel({name:"data_output",title:e("Data Output"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,extraClasses:"hide-vertical-scrollbar",content:'<div id ="datagrid" class="sql-editor-grid-container text-12" tabindex="0">'.concat(te,"</div>")}),l=new c.Browser.Panel({name:"explain",title:e("Explain"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div class="sql-editor-explain pg-el-container" tabindex="0">'.concat(ne,"</div>")}),u=new c.Browser.Panel({name:"messages",title:e("Messages"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div role="status" class="sql-editor-message" tabindex="0"></div>'}),f=new c.Browser.Panel({name:"history",title:e("Query History"),width:"100%",height:"33%",isCloseable:!1,isPrivate:!0,content:'<div id ="history_grid" class="sql-editor-history-container" tabindex="0"></div>'}),p=new c.Browser.Panel({name:"scratch",title:e("Scratch Pad"),width:"25%",height:"33%",isCloseable:!0,isPrivate:!1,content:'<div class="sql-scratch"><textarea wrap="off" tabindex="0"></textarea></div>'}),h=new c.Browser.Panel({name:"notifications",title:e("Notifications"),width:"100%",height:"100%",isCloseable:!1,isPrivate:!0,content:'<div id ="notification_grid" class="sql-editor-notifications" tabindex="0"></div>'}),_=new c.Browser.Panel({name:"geometry_viewer",title:e("Geometry Viewer"),width:"100%",height:"100%",isCloseable:!0,isPrivate:!0,isLayoutMember:!1,content:'<div id ="geometry_viewer_panel" class="sql-editor-geometry-viewer" tabindex="0"></div>'});i.load(a.docker),r.load(a.docker),l.load(a.docker),u.load(a.docker),f.load(a.docker),p.load(a.docker),h.load(a.docker),_.load(a.docker),Q.restore_layout(a.docker,this.layout,this.buildDefaultLayout.bind(this)),a.docker.on(G.EVENT.LAYOUT_CHANGED,(function(){Q.save_current_layout("SQLEditor/Layout",a.docker)})),a.sql_panel_obj=a.docker.findPanels("sql_panel")[0],a.history_panel=a.docker.findPanels("history")[0],a.data_output_panel=a.docker.findPanels("data_output")[0],a.explain_panel=a.docker.findPanels("explain")[0],a.messages_panel=a.docker.findPanels("messages")[0],a.notifications_panel=a.docker.findPanels("notifications")[0],(o.isUndefined(a.sql_panel_obj)||o.isUndefined(a.history_panel)||o.isUndefined(a.data_output_panel)||o.isUndefined(a.explain_panel)||o.isUndefined(a.messages_panel)||o.isUndefined(a.notifications_panel))&&d.alert(e("Panel Loading Error"),e("Something went wrong while loading the panels. Please make sure to reset the layout (File > Reset Layout) for the better user experience.")),a.sql_panel_obj.on(G.EVENT.RESIZE_ENDED,(function(){setTimeout((function(){a&&a.query_tool_obj&&a.query_tool_obj.refresh()}),200)})),a.render_history_grid(),Q.Events.on("pgadmin:query_tool:connected:"+a.handler.transId,(function(){a.fetch_query_history()})),R.renderNotificationsGrid(a.notifications_panel);var g=n('<textarea id="sql_query_tool" tabindex="-1"></textarea>'),m=n('<label for="sql_query_tool" class="sr-only">SQL Editor</label><div id="output-panel" tabindex="0"></div>').append(g);a.sql_panel_obj.$container.find(".pg-panel-content").append(m),a.query_tool_obj=J.fromTextArea(g.get(0),{tabindex:"0",lineNumbers:!0,styleSelectedText:!0,mode:"gpdb"===a.handler.server_type?"text/x-gpsql":"text/x-pgsql",foldOptions:{widget:""},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:Q.editor_shortcut_keys,scrollbarStyle:"simple",dragDrop:!1,screenReaderLabel:e("SQL editor")}),a.handler.is_query_tool&&(a.query_tool_obj.setOption("dragDrop",!0),a.query_tool_obj.on("drop",(function(e,t){var n=null;try{n=JSON.parse(t.dataTransfer.getData("text")),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()}catch(e){return}var a=e.coordsChar({left:t.x,top:t.y});e.replaceRange(n.text,a),e.focus(),e.setSelection(s(s({},a),{},{ch:a.ch+n.cur.from}),s(s({},a),{},{ch:a.ch+n.cur.to}))}))),Q.Events.on("pgadmin:query_tool:sql_panel:focus",(function(){a.query_tool_obj.focus()})),Q.Events.on("pgadmin:query_tool:explain:focus",(function(){setTimeout((function(){n(".sql-editor-explain .backform-tab .nav-link.active").focus()}),200)}));var b=a.browser_preferences.new_browser_tab_open;(o.isNull(b)||o.isUndefined(b)||!b.includes("qt"))&&(o.each(z.default.pgAdmin.Browser.docker.findPanels("frm_datagrid"),(function(e){e.isVisible()&&(e.on(G.EVENT.CLOSING,(function(){return a.handler.check_needed_confirmations_before_closing_panel(!0)})),e.on(G.EVENT.GAIN_FOCUS,(function(){var e=n(this.$container),t=a.handler.transId;e.hasClass("wcPanelTabContentHidden")||(setTimeout((function(){a.handler.gridView.query_tool_obj.focus()}),200),Q.Events.trigger("pgadmin:query_tool:panel:gain_focus:"+t))})),e.on(G.EVENT.LOST_FOCUS,(function(){var e=n(this.$container),t=a.handler.transId;e.hasClass("wcPanelTabContentHidden")&&Q.Events.trigger("pgadmin:query_tool:panel:lost_focus:"+t)})))})),Q.Events.on("pgadmin:query_tool:panel:gain_focus:"+a.handler.transId,a.gain_focus,a),Q.Events.on("pgadmin:query_tool:panel:lost_focus:"+a.handler.transId,a.lost_focus,a)),setTimeout((function(){a.query_tool_obj.focus()}),500),J.registerHelper("hint","sql",(function(e){var i=[],r=e.getDoc(),s=r.getCursor(),l=s.ch,d={editor:e,url:t("sqleditor.autocomplete",{trans_id:a.transId}),data:i,current_line:s.line,hint_render:function(e,t,n){var a=document.createElement("span");switch(n.type){case"database":a.className="sqleditor-hint pg-icon-"+n.type;break;case"datatype":a.className="sqleditor-hint icon-type";break;case"keyword":a.className="fa fa-key";break;case"table alias":a.className="fa fa-at";break;default:a.className="sqleditor-hint icon-"+n.type}a.appendChild(document.createTextNode(n.text)),e.appendChild(a)}};return i.push(r.getValue()),i.push(r.getRange({line:0,ch:0},{line:d.current_line,ch:l})),{then:function(e){var t=this;n.ajax({url:t.url,method:"POST",contentType:"application/json",data:JSON.stringify(t.data)}).done((function(n){var a=[];o.each(n.data.result,(function(e,n){a.push({text:n,type:e.object_type,render:t.hint_render})})),a.sort((function(e,t){var n=e.text.toLowerCase(),a=t.text.toLowerCase();return n<a?-1:n>a?1:0}));var i,r,l,d=t.editor.getTokenAt(s);d.end>s.ch&&(d.end=s.ch,d.string=d.string.slice(0,s.ch-d.start)),d.string.match(/^[.`\w@]\w*$/)?(l=d.string,i=d.start,r=d.end):(i=r=s.ch,l=""),"."!=l.charAt(0)&&"``"!=l.charAt(0)||(i+=1),e({list:a,from:{line:t.current_line,ch:i},to:{line:t.current_line,ch:r}})})).fail((function(e){return T.handleLoginRequiredAndTransactionRequired(c,t,e,null,[],!1)}))}.bind(d)}})),n(".dropdown-submenu").on("mouseenter",(function(){var e=n(this).find("ul.dropdown-menu");if(n(e).offset().left+e.width()>n(window).width()){var t=-n(e).width();e.css("left",t)}})).on("mouseleave",(function(){n(this).find("ul.dropdown-menu").css("left","")})),a.reflectPreferences(),a.preferences.auto_commit?n(".auto-commit").removeClass("visibility-hidden"):n(".auto-commit").addClass("visibility-hidden"),a.preferences.auto_rollback?n(".auto-rollback").removeClass("visibility-hidden"):n(".auto-rollback").addClass("visibility-hidden"),z.default.pgAdmin.Browser.onPreferencesChange("sqleditor",(function(){a.reflectPreferences()}));var v=a.browser_preferences.new_browser_tab_open;v&&v.includes("qt")&&(Q.bind_beforeunload(),setInterval((function(){z.default.pgAdmin&&a.reflectPreferences()}),1e3)),Q.register_to_activity_listener(document,(function(){d.alert(e("Timeout"),e("Your session has timed out due to inactivity. Please close the window and login again."))})),a.render_connection(a.connection_list)},render_grid:function(t,a,i,r,s){var c=this;c.handler.numberOfModifiedCells=0,c.handler.reset_data_store(),c.handler.rows_to_disable=new Array,c.handler.temp_new_rows=new Array,c.handler.primary_keys_data={},c.client_primary_key=r,c.client_primary_key_counter=0,c.handler.slickgrid&&c.handler.slickgrid.destroy(),o.isArray(t)&&o.size(t)||(t=[]);var u,f=[],p=c.handler.col_size,h=c.handler.query,_=h.match(/select.*from\s+\w+\.*(\w+)/i);u=_?_[1]:S.getHash(h),c.handler.table_name=u,p[u]=p[u]||{},o.each(a,(function(t){t.display_name=o.escape(t.display_name),t.column_type=o.escape(t.column_type);var a={id:o.escape(t.name),pos:t.pos,field:t.name,nonative_field:'"'.concat(t.name,'"'),name:t.label,display_name:t.display_name,column_type:t.column_type,column_type_internal:t.column_type_internal,cell:t.cell,not_null:t.not_null,has_default_val:t.has_default_val,is_array:t.is_array,can_edit:t.can_edit},i=t.column_type.trim(),r=t.name.length>i.length?o.escape(t.display_name):i;if(o.isUndefined(p[u][a.nonative_field])?(a.width=S.calculateColumnWidth(r),p[u][t.nonative_field]=a.width):a.width=p[u][a.nonative_field],"oid"==t.cell&&"oid"==t.name?a.editor=null:"Json"==t.cell?(a.editor=t.can_edit?W.Editors.JsonText:W.Editors.ReadOnlyJsonText,a.formatter=W.Formatters.JsonString):"number"==t.cell||"oid"==t.cell||-1!==n.inArray(t.type,["xid","real"])?(a.editor=t.can_edit?W.Editors.CustomNumber:W.Editors.ReadOnlyText,a.formatter=W.Formatters.Numbers):"boolean"==t.cell?(a.editor=t.can_edit?W.Editors.Checkbox:W.Editors.ReadOnlyCheckbox,a.formatter=W.Formatters.Checkmark):"binary"==t.cell?a.formatter=W.Formatters.Binary:"geometry"==t.cell||"geography"==t.cell?(a.width+=28,a.can_edit=!1):(a.editor=t.can_edit?W.Editors.pgText:W.Editors.ReadOnlypgText,a.formatter=W.Formatters.Text),!o.isUndefined(t.can_edit)){a.width+=12;var s="";s=t.can_edit?e("Editable column"):e("Read-only column"),a.toolTip=s}f.push(a)}));var b=new g;f=c.grid_columns=b.getColumnDefinitions(f),o.each(f,(function(e){"geometry"!=e.column_type_internal&&"geography"!=e.column_type_internal||O.add_header_button(e),o.isUndefined(e.can_edit)||S.addEditableIcon(e,e.can_edit)})),s&&(f[0].width=S.calculateColumnWidth(s));var v={editable:!0,enableAddRow:i,enableCellNavigation:!0,enableColumnReorder:!1,asyncEditorLoading:!1,autoEdit:!1},y=n("#datagrid"),k=n(this.data_output_panel.$container.parent().parent()).height()-35;y.height(k);var T=c.dataView=new W.Data.DataView,E=c.grid=new W.Grid(y,T,f,v);T.getItemMetadata=function(e){var t="",n=c.handler.data_store;return o.has(c.handler,"data_store")&&(e in n.added_index&&n.added_index[e]in n.added?(t="new_row",n.added[n.added_index[e]].err&&(t+=" error")):e in n.updated_index&&e in n.updated&&(t="updated_row",n.updated[n.updated_index[e]].err&&(t+=" error"))),!o.isUndefined(c.handler.rows_to_disable)&&c.handler.rows_to_disable.length>0&&-1!==o.indexOf(c.handler.rows_to_disable,e)&&(t+=" disabled_row"),{cssClasses:t}},E.registerPlugin(new W.AutoTooltips({enableForHeaderCells:!1})),E.registerPlugin(new m),E.setSelectionModel(new x),E.registerPlugin(b),E.registerPlugin(new W.AutoColumnSize);var q=new W.Plugins.HeaderButtons;q.onCommand.subscribe((function(e,t){if("view-geometries"===t.command){var n=t.grid.getColumns(),a=n.indexOf(t.column),i=t.grid.getSelectedRows();if(0===i.length)if(c.handler.has_more_rows)c.fetch_next_all((function(){b.onGridSelectAll.notify(t,new W.EventData);var e=t.grid.getData().getItems();O.render_geometries(c.handler,e,n,a)}));else{b.onGridSelectAll.notify(t,new W.EventData);var r=t.grid.getData().getItems();O.render_geometries(c.handler,r,n,a)}else{var s=t.grid.getData().getItems(),l=o.map(i,(function(e){return s[e]}));O.render_geometries(c.handler,l,n,a)}}})),E.registerPlugin(q);var P={keys:o.isEmpty(c.handler.primary_keys)&&c.handler.has_oids?c.handler.oids:c.handler.primary_keys,vals:t,columns:a,grid:E,selection:E.getSelectionModel(),editor:c,client_primary_key:c.client_primary_key,has_oids:c.handler.has_oids};c.handler.slickgrid=E,c.handler.slickgrid.CSVOptions={quoting:c.preferences.results_grid_quoting,quote_char:c.preferences.results_grid_quote_char,field_separator:c.preferences.results_grid_field_separator},P.selection&&P.selection.onSelectedRangesChanged.subscribe(C.bind(P)),E.onColumnsResized.subscribe(function(){var e=this.getColumns();o.each(e,(function(e){c.handler.col_size[c.handler.table_name][e.nonative_field]=e.width}))}.bind(E)),b.onBeforeGridSelectAll.subscribe((function(e,t){c.handler.has_more_rows&&(e.stopImmediatePropagation(),c.fetch_next_all((function(){b.onGridSelectAll.notify(t,new W.EventData)})))})),b.onBeforeGridColumnSelectAll.subscribe((function(e,t){c.handler.has_more_rows&&(e.stopImmediatePropagation(),c.fetch_next_all((function(){b.onGridColumnSelectAll.notify(t,new W.EventData)})))})),T.onRowCountChanged.subscribe((function(){E.updateRowCount(),E.render()})),T.onRowsChanged.subscribe((function(e,t){E.invalidateRows(t.rows),E.render()})),E.onBeforeEditCell.subscribe((function(e,t){if("bytea"==t.column.column_type_internal||"bytea[]"==t.column.column_type_internal)return!1;var n=t.item;if(c.handler.rows_to_disable&&o.contains(c.handler.rows_to_disable,t.row))return!1;if(c.handler.can_edit&&n&&c.client_primary_key in n){var a=n[c.client_primary_key],i=c.handler.primary_keys,r={};if(a in c.handler.primary_keys_data)return;o.each(i,(function(e,t){r[t]=n[t]})),c.handler.primary_keys_data[a]=r}})),E.onKeyDown.subscribe((function(e,t){var n=e.keyCode;(e.ctrlKey||e.metaKey)&&65==n&&c.handler.has_more_rows?c.fetch_next_all((function(){w(e,t)})):w(e,t)})),n(".slick-viewport").on("blur","input.editor-text",(function(){window.setTimeout((function(){W.GlobalEditorLock.isActive()&&W.GlobalEditorLock.commitCurrentEdit()}))})),E.onCellChange.subscribe(function(e,t){var a=t.grid.getColumns()[t.cell].field,i=t.item[a],r=t.item[c.client_primary_key]||null,s={};c.handler.numberOfModifiedCells++,t.grid.addCellCssStyles(c.handler.numberOfModifiedCells,l({},t.row,l({},a,"highlighted_grid_cells")));var d=t.grid.getDataItem(t.row);if(c.primary_keys&&o.all(o.values(o.pick(d,c.primary_keys)),(function(e){return null!=e}))&&c.handler.temp_new_rows){var u=c.handler.temp_new_rows.indexOf(t.row);u>-1&&c.handler.temp_new_rows.splice(u,1)}s[a]=i,r&&(r in c.handler.data_store.added?(o.extend(c.handler.data_store.added[r].data,s),c.handler.data_store.added[r].err=!1):r in c.handler.data_store.updated?(o.extend(c.handler.data_store.updated[r].data,s),c.handler.data_store.updated[r].err=!1):(c.handler.data_store.updated[r]={err:!1,data:s,primary_keys:c.handler.primary_keys_data[r]},c.handler.data_store.updated_index[t.row]=r)),n("#btn-save-data").prop("disabled",!1)}.bind(P)),E.onAddNewRow.subscribe(function(e,t){var a=t.column,i=t.item,r=this.grid.getDataLength(),s=(c.client_primary_key_counter++).toString(),d=this.grid.getData();o.isUndefined(i[0])&&c.handler.temp_new_rows.push(r),i&&(i[c.client_primary_key]=s),o.each(t.grid.getColumns(),(function(e){$(i[e.field])&&(i[e.field]=void 0)})),d.addItem(i),c.handler.data_store.added[s]={err:!1,data:i},c.handler.data_store.added_index[r]=s;({})[a.name]=o.where(this.columns,{pos:a.pos})[0].type,E.updateRowCount(),E.render();var u=d.getRowByItem(i);c.handler.numberOfModifiedCells++,t.grid.addCellCssStyles(c.handler.numberOfModifiedCells,l({},u,l({},a.field,"highlighted_grid_cells"))),n("#btn-save-data").prop("disabled",!1)}.bind(P)),E.onViewportChanged.subscribe((function(e,t){var n=t.grid.getRenderedRange(),a=t.grid.getDataLength();c.handler.has_more_rows&&!c.handler.fetching_rows&&n.bottom>a-100&&setTimeout(c.fetch_next.bind(c))})),E.onValidationError.subscribe((function(e,t){d.error(t.validationResults.msg)})),n(window).resize((function(){c.data_output_panel.isVisible()&&c.grid_resize(E)})),c.data_output_panel.on(G.EVENT.RESIZE_ENDED,(function(){c.data_output_panel.isVisible()&&c.grid_resize(E)})),c.data_output_panel.on(G.EVENT.VISIBILITY_CHANGED,(function(){c.data_output_panel.isVisible()&&c.grid_resize(E)}));for(var D=0;D<t.length;D++){for(var N={},j=1;j<f.length;j++)N[f[j].field]=t[D][f[j].pos];N[c.client_primary_key]=(c.client_primary_key_counter++).toString(),t[D]=N}T.setItems(t,c.client_primary_key)},fetch_next_all:function(e){this.fetch_next(!0,e)},fetch_next:function(a,i){var r=this,o="";r.handler.fetching_rows=!0,n("#btn-flash").prop("disabled",!0),n("#btn-download").prop("disabled",!0),a?(r.handler.trigger("pgadmin-sqleditor:loading-icon:show",e("Fetching all records...")),o=t("sqleditor.fetch_all",{trans_id:r.transId,fetch_all:1})):o=t("sqleditor.fetch",{trans_id:r.transId}),n.ajax({url:o,method:"GET"}).done((function(e){r.handler.has_more_rows=e.data.has_more_rows,n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),r.handler.trigger("pgadmin-sqleditor:loading-icon:hide"),r.update_grid_data(e.data.result),r.handler.fetching_rows=!1,"function"==typeof i&&i()})).fail((function(e){n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),r.handler.trigger("pgadmin-sqleditor:loading-icon:hide"),r.handler.has_more_rows=!1,r.handler.fetching_rows=!1,"function"==typeof i&&i();var t=T.handleQueryToolAjaxError(c,r,e,null,[],!1);t&&r.update_msg_history(!1,t)}))},update_grid_data:function(e){this.dataView.beginUpdate();for(var t=0;t<e.length;t++){for(var n={},a=1;a<this.grid_columns.length;a++)n[this.grid_columns[a].field]=e[t][this.grid_columns[a].pos];n[this.client_primary_key]=(this.client_primary_key_counter++).toString(),this.dataView.addItem(n)}this.dataView.endUpdate()},grid_resize:function(e){var t=n("#datagrid").height(),a=n(this.data_output_panel.$container.parent().parent()).height()-35,i=e.getViewport(),r=e.getRenderedRange(),o=e.getActiveCell();t!=a&&n("#datagrid").css({height:a+"px"}),e.resizeCanvas(),o&&e.scrollCellIntoView(o.row,o.cell),i.top!=r.top&&(i.bottom-2==r.bottom?e.scrollRowIntoView(i.bottom):e.scrollRowIntoView(i.bottom-2))},fetch_query_history:function(){var e=this;n.ajax({url:t("sqleditor.get_query_history",{trans_id:e.handler.transId}),method:"GET",contentType:"application/json"}).done((function(t){t.data.result.map((function(t){var n=JSON.parse(t);n.start_time=new Date(n.start_time),e.history_collection.add(n)}))})).fail((function(){}))},render_history_grid:function(){var e=this;e.history_collection||(e.history_collection=new Y([])),e.historyComponent||(e.historyComponent=new Z(n("#history_grid"),e.history_collection),e.historyComponent.onCopyToEditorClick((function(t){e.query_tool_obj.setValue(t),e.sql_panel_obj.focus(),setTimeout((function(){e.query_tool_obj.focus(),e.query_tool_obj.setCursor(e.query_tool_obj.lineCount(),0)}),100)})),e.historyComponent.render(),e.history_panel.off(G.EVENT.VISIBILITY_CHANGED),e.history_panel.on(G.EVENT.VISIBILITY_CHANGED,(function(){e.history_panel.isVisible()&&setTimeout((function(){e.historyComponent.focus()}),100)}))),e.handler.is_query_tool||e.historyComponent.setEditorPref({copy_to_editor:!1})},on_delete:function(){this.handler.trigger("pgadmin-sqleditor:button:deleterow",this,this.handler)},_stopEventPropogation:function(e){(e=e||window.event).cancelBubble=!0,e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()},_closeDropDown:function(e){var t=e&&(e.currentTarget||e.target);t&&n(t).closest(".editor-toolbar").find(".show").removeClass("show")},on_save_file:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.close_on_save=!1,this.handler.trigger("pgadmin-sqleditor:button:save_file")},on_save_as:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.close_on_save=!1,this.handler.trigger("pgadmin-sqleditor:button:save_file",this,this.handler,!0)},on_find:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("find")},on_find_next:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("findNext")},on_find_previous:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("findPrev")},on_replace:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("replace")},on_replace_all:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("replaceAll")},on_find_persistent:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("findPersistent")},on_jump:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.query_tool_obj.execCommand("jumpToLine")},on_show_filter:function(){this.handler.trigger("pgadmin-sqleditor:button:show_filter",this,this.handler)},on_new_connection:function(){this.handler.trigger("pgadmin-sqleditor:button:show_new_connection",this,this.handler)},on_include_filter:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.trigger("pgadmin-sqleditor:button:include_filter",this,this.handler)},on_exclude_filter:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.trigger("pgadmin-sqleditor:button:exclude_filter",this,this.handler)},on_remove_filter:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.trigger("pgadmin-sqleditor:button:remove_filter",this,this.handler)},on_cancel:function(){n("#filter").addClass("d-none"),n("#editor-panel").removeClass("sql-editor-busy-fetching")},on_copy_row:function(){this.handler.trigger("pgadmin-sqleditor:button:copy_row",this,this.handler)},on_copy_row_with_header:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:copy_row_with_header",this,this.handler)},on_paste_row:function(){this.handler.trigger("pgadmin-sqleditor:button:paste_row",this,this.handler)},on_limit_change:function(){this.handler.trigger("pgadmin-sqleditor:button:limit",this,this.handler)},on_save_data:function(){this.handler.history_query_source=X.SAVE_DATA,M.saveDataChanges(this.handler)},on_flash:function(){var e=n("#btn-flash").attr("data-click-counter");e=(parseInt(e)+1)%10,n("#btn-flash").attr("data-click-counter",e),this.handler.history_query_source=X.EXECUTE,M.executeQuery(this.handler)},on_cancel_query:function(){this.handler.trigger("pgadmin-sqleditor:button:cancel-query",this,this.handler)},on_comment_line_code:function(){M.commentLineCode(this.handler)},on_uncomment_line_code:function(){M.uncommentLineCode(this.handler)},on_toggle_comment_block_code:function(){M.commentBlockCode(this.handler)},on_indent_code:function(){this.handler.trigger("pgadmin-sqleditor:indent_selected_code",this,this.handler)},on_unindent_code:function(){this.handler.trigger("pgadmin-sqleditor:unindent_selected_code",this,this.handler)},on_format_sql:function(){this.handler.trigger("pgadmin-sqleditor:format_sql",this,this.handler)},on_clear:function(t){var n=this;this._stopEventPropogation(t),this._closeDropDown(t),n.handler.is_query_changed?d.confirm(e("Unsaved changes"),e("Are you sure you wish to discard the current changes?"),(function(){n.query_tool_obj.setValue(""),setTimeout((function(){n.query_tool_obj.focus()}),200)}),(function(){return!0})).set("labels",{ok:e("Yes"),cancel:e("No")}):n.query_tool_obj.setValue("")},on_clear_history:function(a){var i=this;this._stopEventPropogation(a),this._closeDropDown(a),i.history_collection.length()&&d.confirm(e("Clear history"),e("Are you sure you wish to clear the history?")+"</br>"+e("This will remove all of your query history from this and other sessions for this database."),(function(){i.history_collection&&i.history_collection.reset(),i.handler.is_query_tool&&n.ajax({url:t("sqleditor.clear_query_history",{trans_id:i.handler.transId}),method:"DELETE",contentType:"application/json"}).done((function(){})).fail((function(){})),setTimeout((function(){i.query_tool_obj.focus()}),200)}),(function(){return!0})).set("labels",{ok:e("Yes"),cancel:e("No")})},on_auto_commit:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:auto_commit",this,this.handler)},on_auto_rollback:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:auto_rollback",this,this.handler)},on_explain:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.history_query_source=X.EXPLAIN,M.explain(this.handler)},on_explain_analyze:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.history_query_source=X.EXPLAIN_ANALYZE,M.explainAnalyze(this.handler)},on_explain_verbose:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-verbose",this,this.handler)},on_explain_costs:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-costs",this,this.handler)},on_explain_buffers:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-buffers",this,this.handler)},on_explain_timing:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-timing",this,this.handler)},on_explain_summary:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-summary",this,this.handler)},on_explain_settings:function(e){this._stopEventPropogation(e),this.handler.trigger("pgadmin-sqleditor:button:explain-settings",this,this.handler)},do_not_close_menu:function(e){e.stopPropagation()},on_show_query_tool:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.trigger("pgadmin-sqleditor:button:show_query_tool",this,this.handler)},on_file_load:function(e){this._stopEventPropogation(e),this._closeDropDown(e),this.handler.trigger("pgadmin-sqleditor:button:load_file",this,this.handler)},on_download:function(){M.download(this.handler)},keyAction:function(e){var t;t=j.processEventQueryTool(this.handler,M,e,this.docker),o.isNull(t)||o.isUndefined(t)||""==t||setTimeout((function(){Q.Events.trigger("pgadmin:query_tool:".concat(t,":focus"))}),100)},on_commit_transaction:function(){this.handler.close_on_idle_transaction=!1,this.handler.history_query_source=X.COMMIT,M.executeCommit(this.handler)},on_rollback_transaction:function(){this.handler.close_on_idle_transaction=!1,this.handler.history_query_source=X.ROLLBACK,M.executeRollback(this.handler)},on_manage_macros:function(){this.handler.trigger("pgadmin-sqleditor:button:manage_macros",this,this.handler)},on_execute_macro:function(e){var t=n(e.currentTarget).data("macro-id");this.handler.history_query_source=X.EXECUTE,M.executeMacro(this.handler,t)},set_selected_option:function(e){this.connection_list.forEach((function(t){t.server==e.server&&t.database==e.database&&t.user==e.user&&t.role==e.role?e.is_selected=!0:t.is_selected=!1}))},on_change_connection:function(t,a){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t.is_selected){var r=this;i?d.confirm(e("Change connection"),e("By changing the connection you will lose all your unsaved data for the current connection. <br> Do you want to continue?"),(function(){r.change_connection(t,a,!0)}),(function(){return n("#fetching_data").addClass("d-none"),d.newConnectionDialog().destroy(),!0})).set("labels",{ok:e("Yes"),cancel:e("No")}):r.change_connection(t,a,!1)}},change_connection:function(e,a,i){var r=this,s=null;a?((s=n("#show_filter_progress")).removeClass("d-none"),s.find(".sql-editor-busy-text").text("Connecting to database...")):((s=n("#fetching_data")).removeClass("d-none"),s.find(".sql-editor-busy-text")),r.set_selected_option(e),n.ajax({url:t("datagrid.update_query_tool_connection",{trans_id:r.transId,sgid:e.server_group,sid:e.server,did:e.database}),method:"POST",contentType:"application/json",data:JSON.stringify(e)}).done((function(t){if(t.success){delete e.password,r.transId=t.data.tran_id,r.handler.transId=t.data.tran_id,r.handler.url_params={did:e.database,is_query_tool:r.handler.url_params.is_query_tool,server_type:r.handler.url_params.server_type,sgid:e.server_group,sid:e.server,title:e.title},r.set_editor_title(o.unescape(r.handler.url_params.title)),r.handler.setTitle(o.unescape(r.handler.url_params.title));var n=e.server_name+"/"+e.database_name+"- Database connected";if(d.success(n),a){var l={server_group:r.handler.url_params.sgid,server:e.server,database:e.database,user:e.user,title:e.title,role:e.role,is_allow_new_connection:!0,database_name:e.database_name,server_name:e.server_name,is_selected:!0};delete l.password,i&&r.connection_list.unshift(l),r.render_connection(r.connection_list),s.addClass("d-none"),d.newConnectionDialog().destroy(),d.connectServer().destroy()}else s.addClass("d-none"),d.connectServer().destroy()}return!0})).fail((function(t){if(428==t.status){var n=e;a&&(n={}),d.connectServer("Connect to server",t.responseJSON.result,e.server,!1,n)}else d.error(t.responseJSON.errormsg)}))}}),ie=function(){this.initialize.apply(this,arguments)},re=function(){(z.default&&z.default.closed||z.default.pgAdmin&&z.default.pgAdmin.Browser&&z.default.pgAdmin.Browser.preference_version()<=0)&&d.alert().setting({title:e("Connection lost"),label:e("Close"),message:e("The pgAdmin browser window has been closed and the connection to the server is lost. Please close this window and open a new pgAdmin session."),onok:function(){window.close()}}).show()};return o.extend(ie.prototype,u.Events,{initialize:function(t){var a=this;this.container=t,this.state={},this.csrf_token=c.csrf_token,re(),I.modifyAlertifyAnimation(),d.dlgGetServerPass||d.dialog("dlgGetServerPass",(function(){return{main:function(e,t){this.set("title",e),this.setting("message",t)},setup:function(){return{buttons:[{text:e("OK"),key:13,className:"btn btn-primary"},{text:e("Cancel"),key:27,className:"btn btn-danger"}],focus:{element:"#password",select:!0},options:{modal:0,resizable:!1,maximizable:!1,pinnable:!1}}},build:function(){},settings:{message:null},prepare:function(){this.setContent(this.setting("message"))},callback:function(t){if(t.button.text==e("OK")){var i=n(this.elements.content).find("#frmPassword").serialize();a.init_connection(!1,i)}}}})),this.on("pgadmin-datagrid:transaction:created",(function(e){a.transId=e.gridTransId,a.warn_before_continue()})),Q.Events.on("pgadmin:user:logged-in",(function(){a.initTransaction()}))},saveState:function(e,t){this.state=e?{fn:e,args:t}:{}},initTransaction:function(){var a,i=this;i.is_query_tool?(a="datagrid.initialize_query_tool",i.url_params.did&&(a="datagrid.initialize_query_tool_with_did")):a="datagrid.initialize_datagrid";var r=t(a,s(s({},i.url_params),{},{trans_id:i.transId}));n.ajax({url:r,type:"POST",data:i.is_query_tool?null:JSON.stringify(i.url_params.sql_filter),contentType:"application/json"}).done((function(e){Q.Events.trigger("pgadmin:query_tool:connected:"+i.transId,e.data)})).fail((function(t,n,a){if(410===t.status){var r=i.browser_preferences.new_browser_tab_open;r&&r.includes("qt")?Q.report_error(e("Error fetching rows - %s.",t.statusText),t.responseJSON.errormsg,void 0,window.close):Q.report_error(e("Error fetching rows - %s.",t.statusText),t.responseJSON.errormsg,void 0,i.close.bind(i))}else Q.Events.trigger("pgadmin:query_tool:connected_fail:"+i.transId,t,a)}))},handle_connection_lost:function(e,t){void 0!==t.responseJSON&&t.responseJSON.data&&!t.responseJSON.data.conn_id||void 0!==t.data&&t.data.data&&!t.data.data.conn_id?this.init_connection(e):this.warn_before_continue()},handle_cryptkey_missing:function(){var e=this;Q.set_master_password("",(function(){e.warn_before_continue()}))},warn_before_continue:function(){var t=this;d.confirm(e("Connection Warning"),'<p style="float:left"><span class="fa fa-exclamation-triangle warn-icon" aria-hidden="true" role="img"></span></p><p style="display: inline-block;"><span class="warn-header">'+e("The application has lost the database connection:")+'</span><br><span class="warn-body">'+e(" If the connection was idle it may have been forcibly disconnected.")+"<br>"+e(" The application server or database server may have been restarted.")+"<br>"+e(" The user session may have timed out.")+'</span><br><span class="warn-footer">'+e("Do you want to continue and establish a new session?")+"</span></p>",(function(){if("fn"in t.state){var e=t.state.fn,n=t.state.args;t.saveState(),-1==n.indexOf("connect")&&n.push("connect"),e in t?t[e].apply(t,n):console.warn("The callback is not valid for this context")}}),(function(){t.saveState()})).set({labels:{ok:e("Continue"),cancel:e("Cancel")}})},init_connection:function(a,i){var r=this;n.post(t("NODE-server.connect_id",{gid:this.url_params.sgid,sid:this.url_params.sid}),i).done((function(e){if(1==e.success)if(d.success(e.info),a)r.initTransaction();else if("fn"in r.state){var t=r.state.fn,n=r.state.args;r.saveState(),r[t].apply(r,n)}})).fail((function(t){var n=T.handleQueryToolAjaxError(c,r,t,null,[],!1);n&&d.dlgGetServerPass(e("Connect to Server"),n)}))},start:function(t,a,i,r){var s=this;if(s.is_query_tool="true"===a.is_query_tool,s.rows_affected=0,s.marked_line_no=0,s.has_more_rows=!1,s.fetching_rows=!1,s.close_on_save=!1,s.close_on_idle_transaction=!1,s.last_transaction_status=-1,s.server_type=a.server_type,s.url_params=a,s.is_transaction_buttons_disabled=!0,!s.gridView){s.gridView=new ae({el:s.container,handler:s,layout:i}),s.transId=s.gridView.transId=t,s.macros=s.gridView.macros=r,s.gridView.current_file=void 0,s.gridView.render(),s.trigger("pgadmin-sqleditor:loading-icon:hide"),s.gridView.set_editor_title("("+e("Obtaining connection...")+" ".concat(o.unescape(a.title)));var l=function(){(s.is_query_tool?["#btn-flash","#btn-explain","#btn-explain-analyze"]:["#btn-flash"]).forEach((function(e){n(e).prop("disabled",!1)})),n("#btn-conn-status i").removeClass("obtaining-conn");var e=z.default.pgAdmin.Browser.treeMenu.translateTreeNodeIdFromACITree(z.default.pgAdmin.Browser.treeMenu.selected()),t=z.default.pgAdmin.Browser.treeMenu.findNode(e.slice(0,2)),i=z.default.pgAdmin.Browser.treeMenu.findNode(e.slice(0,4));s.gridView.set_editor_title(o.unescape(a.title));var r={server_group:s.gridView.handler.url_params.sgid,server:s.gridView.handler.url_params.sid,database:s.gridView.handler.url_params.did,user:t.data.user.name,role:null,title:o.unescape(a.title),is_allow_new_connection:!1,database_name:o.unescape(i.data.label),server_name:o.unescape(t.data.label),is_selected:!0};delete r.password,s.gridView.connection_list.unshift(r),s.gridView.render_connection(s.gridView.connection_list)};if(Q.Events.on("pgadmin:query_tool:connected:"+t,l),Q.Events.on("pgadmin:query_tool:connected_fail:"+t,l),Q.Events.on("pgadmin:query_tool:connected:"+t,(function(e){s.gridView.set_server_version(e.serverVersion)})),Q.Events.on("pgadmin:query_tool:connected_fail:"+t,(function(e,t){d.pgRespErrorNotify(e,t)})),s.initTransaction(),n(window).on("keydown",(function(e){0===n(".sql-editor").find(e.target).length&&e.target!=n("body.wcDesktop")[0]||!s.gridView.keyAction||s.gridView.keyAction(e)})),s.init_events(),s.is_query_tool)a.query_url&&n.ajax({url:a.query_url,type:"GET"}).done((function(e){s.gridView.query_tool_obj.refresh(),e&&s.gridView.query_tool_obj.setValue(e)})).fail((function(t){if(T.handleQueryToolAjaxError(c,s,t,null,[],!1)){var n=s.browser_preferences.new_browser_tab_open;n&&n.includes("qt")?Q.report_error(e("Error fetching SQL for script - %s.",t.statusText),t.responseJSON.errormsg,void 0,window.close):Q.report_error(e("Error fetching SQL for script - %s.",t.statusText),t.responseJSON.errormsg,void 0,s.close.bind(s))}}));else{s.gridView.query_tool_obj.setOption("readOnly",!0);var u=s.gridView.query_tool_obj.getWrapperElement();u&&(u.className+=" bg-gray-lighter opacity-5 hide-cursor-workaround"),s.disable_tool_buttons(!0),Q.Events.on("pgadmin:query_tool:connected:"+t,(function(){s.check_data_changes_to_execute_query()}))}}},set_value_to_editor:function(e){this.gridView&&this.gridView.query_tool_obj&&!o.isUndefined(e)&&this.gridView.query_tool_obj.setValue(e)},init_events:function(){c.Browser.Events.on("pgadmin-storage:finish_btn:select_file",this._select_file_handler,this),c.Browser.Events.on("pgadmin-storage:finish_btn:create_file",this._save_file_handler,this),this.is_query_tool&&this.gridView.query_tool_obj.on("change",this._on_query_change.bind(this)),this.on("pgadmin-sqleditor:button:load_file",this._load_file,this),this.on("pgadmin-sqleditor:button:save_file",this._save_file,this),this.on("pgadmin-sqleditor:button:deleterow",this._delete,this),this.on("pgadmin-sqleditor:button:show_filter",this._show_filter,this),this.on("pgadmin-sqleditor:button:show_new_connection",this._show_new_connection,this),this.on("pgadmin-sqleditor:button:include_filter",this._include_filter,this),this.on("pgadmin-sqleditor:button:exclude_filter",this._exclude_filter,this),this.on("pgadmin-sqleditor:button:remove_filter",this._remove_filter,this),this.on("pgadmin-sqleditor:button:copy_row",this._copy_row,this),this.on("pgadmin-sqleditor:button:copy_row_with_header",this._copy_row_with_header,this),this.on("pgadmin-sqleditor:button:paste_row",this._paste_row,this),this.on("pgadmin-sqleditor:button:limit",this._set_limit,this),this.on("pgadmin-sqleditor:button:cancel-query",this._cancel_query,this),this.on("pgadmin-sqleditor:button:auto_rollback",this._auto_rollback,this),this.on("pgadmin-sqleditor:button:auto_commit",this._auto_commit,this),this.on("pgadmin-sqleditor:button:explain-verbose",this._explain_verbose,this),this.on("pgadmin-sqleditor:button:explain-costs",this._explain_costs,this),this.on("pgadmin-sqleditor:button:explain-buffers",this._explain_buffers,this),this.on("pgadmin-sqleditor:button:explain-timing",this._explain_timing,this),this.on("pgadmin-sqleditor:button:explain-summary",this._explain_summary,this),this.on("pgadmin-sqleditor:button:explain-settings",this._explain_settings,this),this.on("pgadmin-sqleditor:button:show_query_tool",this._show_query_tool,this),this.on("pgadmin-sqleditor:indent_selected_code",this._indent_selected_code,this),this.on("pgadmin-sqleditor:unindent_selected_code",this._unindent_selected_code,this),this.on("pgadmin-sqleditor:format_sql",this._format_sql,this),this.on("pgadmin-sqleditor:button:manage_macros",this._manage_macros,this),this.on("pgadmin-sqleditor:button:execute_macro",this._execute_macro,this),window.parent.$(window.parent.document).on("pgadmin-sqleditor:rows-copied",this._copied_in_other_session)},check_data_changes_to_execute_query:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=this;o.has(i,"data_store")&&(o.size(i.data_store.added)||o.size(i.data_store.updated)||o.size(i.data_store.deleted))?d.confirm(e("Unsaved changes"),e("The data has been modified, but not saved. Are you sure you wish to discard the changes?"),(function(){void 0!==a?i._execute_macro_query(t,n,a):i.is_query_tool?i._execute_sql_query(t,n):i._execute_view_data_query()}),(function(){return!0})).set("labels",{ok:e("Yes"),cancel:e("No")}):void 0!==a?i._execute_macro_query(t,n,a):i.is_query_tool?i._execute_sql_query(t,n):i._execute_view_data_query()},_execute_view_data_query:function(){var a=this,i=t("sqleditor.view_data_start",{trans_id:a.transId});a.query_start_time=new Date,a.rows_affected=0,a._init_polling_flags(),a.has_more_rows=!1,a.fetching_rows=!1,a.trigger("pgadmin-sqleditor:loading-icon:show",e("Running query...")),n("#btn-flash").prop("disabled",!0),n("#btn-download").prop("disabled",!0),a.trigger("pgadmin-sqleditor:loading-icon:message",e("Waiting for the query to complete...")),arguments.length>0&&"connect"==arguments[arguments.length-1]&&(i+="?connect=1"),n.ajax({url:i,method:"GET"}).done((function(e){e.data.status?(a.can_edit=e.data.can_edit,a.can_filter=e.data.can_filter,a.info_notifier_timeout=e.data.info_notifier_timeout,a.gridView.query_tool_obj.setValue(e.data.sql),a.query=e.data.sql,a.can_filter&&e.data.filter_applied?(n("#btn-filter").removeClass("btn-secondary"),n("#btn-filter-dropdown").removeClass("btn-secondary"),n("#btn-filter").addClass("btn-primary"),n("#btn-filter-dropdown").addClass("btn-primary")):(n("#btn-filter").removeClass("btn-primary"),n("#btn-filter-dropdown").removeClass("btn-primary"),n("#btn-filter").addClass("btn-secondary"),n("#btn-filter-dropdown").addClass("btn-secondary")),n("#btn-copy-row").prop("disabled",!0),n("#btn-paste-row").prop("disabled",!0),n(".limit").val(e.data.limit),a._poll()):(a.trigger("pgadmin-sqleditor:loading-icon:hide"),a.update_msg_history(!1,e.data.result))})).fail((function(e){a.trigger("pgadmin-sqleditor:loading-icon:hide");var t=T.handleQueryToolAjaxError(c,a,e,"_execute_view_data_query",[],!0);t&&a.update_msg_history(!1,t)}))},_execute_macro_query:function(e,a,i){var r=this;r.has_more_rows=!1,r.fetching_rows=!1,n.ajax({url:t("sqleditor.get_macro",{macro_id:i,trans_id:r.transId}),method:"GET",contentType:"application/json",dataType:"json"}).done((function(t){if(t){var n=t.sql.replace(/\$SELECTION\$/gi,r.gridView.query_tool_obj.getSelection()),i=new k.ExecuteQuery(r,c.Browser.UserManagement);i.poll=Q.override_activity_event_decorator(i.poll).bind(i),i.execute(n,e,a)}})).fail((function(){}))},_execute_sql_query:function(e,t){var n="";if(this.has_more_rows=!1,this.fetching_rows=!1,o.isUndefined(this.special_sql)){var a=this.gridView.query_tool_obj.getSelection();n=a.length>0?a:this.gridView.query_tool_obj.getValue()}else n=this.special_sql;var i=new k.ExecuteQuery(this,c.Browser.UserManagement);i.poll=Q.override_activity_event_decorator(i.poll).bind(i),i.execute(n,e,t)},call_render_after_poll:function(e){B.callRenderAfterPoll(this,d,e)},_poll:function(){new k.ExecuteQuery(this,c.Browser.UserManagement).delayedPoll(this)},_render:function(t){this.colinfo=t.colinfo,this.primary_keys=o.isEmpty(t.primary_keys)&&t.has_oids?t.oids:t.primary_keys,this.client_primary_key=t.client_primary_key,this.cell_selected=!1,this.selected_model=null,this.changedModels=[],this.has_oids=t.has_oids,this.oids=t.oids,n(".sql-editor-explain").html(ne),this.explain_plan=!1,null!==this.primary_keys&&void 0!==this.primary_keys&&0!==o.size(this.primary_keys)||0!=this.has_oids?this.can_edit=!0:this.can_edit=!1,this.can_filter&&(n(".limit").prop("disabled",!1),n(".limit").addClass("limit-enabled"),n("#btn-filter").prop("disabled",!1),n("#btn-filter-dropdown").prop("disabled",!1)),n("#btn-save-data").prop("disabled",!0),n("#btn-delete-row").prop("disabled",!0),this.can_edit||(n("#btn-delete-row").prop("disabled",!0),n("#btn-copy-row").prop("disabled",!0),n("#btn-paste-row").prop("disabled",!0)),this._fetch_column_metadata.call(this,t,function(){var a=this;a.trigger("pgadmin-sqleditor:loading-icon:message",e("Loading data from the database server and rendering..."),a),a.total_time=L.calculateQueryRunTime(a.query_start_time,a.query_end_time);var i=e("Successfully run. Total query runtime: %s.",a.total_time),r=e("%s rows affected.",a.rows_affected);a.info_notifier_timeout>=0&&d.success(i+" "+r,a.info_notifier_timeout);var s=i+"\n"+r;o.isNull(t.additional_messages)||o.isUndefined(t.additional_messages)||(s=t.additional_messages+"\n"+s),a.update_msg_history(!0,s,!1);var l=[],c=null;if(t.result&&!o.isEmpty(a.colinfo)&&"QUERY PLAN"==a.colinfo[0].name&&!o.isEmpty(t.types)&&t.types[0]&&"json"===t.types[0].typname&&(c=JSON.parse(t.result[0][0])),c&&c[0]&&c[0].hasOwnProperty("Plan")&&o.isObject(c[0].Plan)){var u=[JSON.stringify(c,null,2)];l.push(u),a.gridView.data_output_panel.focus(),setTimeout((function(){a.gridView.render_grid(l,a.columns,a.can_edit,a.client_primary_key,0),a.gridView.explain_panel.focus(),h.DrawJSONPlan(n(".sql-editor-explain"),c)}),10)}else a.gridView.data_output_panel.focus(),setTimeout((function(){a.gridView.render_grid(t.result,a.columns,a.can_edit,a.client_primary_key,t.rows_affected)}),10);a.trigger("pgadmin-sqleditor:loading-icon:hide"),n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1)}.bind(this))},_fetch_column_metadata:function(e,t){var n=e.colinfo,a=e.primary_keys,i=[],r=this,s=new Array;o.each(e.types,(function(e){s[e.oid]=[e.typname]})),o.each(n,(function(e){var t=!1,n=r.can_edit&&(!r.is_query_tool||e.is_editable);n&&o.size(a)>0&&o.each(a,(function(n,a){a===e.name&&(t=!0)}));var l,d,c="",u=s[e.type_code]?s[e.type_code][0]:s[s.length-1][0]?s[s.length-1][0]:"unknown";switch(c+=t?"[PK] "+u:u,e.precision&&e.precision>=0&&65535!=e.precision&&(c+=" ("+e.precision,c+=e.scale&&65535!=e.scale?","+e.scale+")":")"),u){case"oid":d="oid";break;case"json":case"json[]":case"jsonb":case"jsonb[]":d="Json";break;case"smallint":case"smallint[]":case"integer":case"integer[]":case"bigint":case"bigint[]":case"decimal":case"decimal[]":case"numeric":case"numeric[]":case"real":case"real[]":case"double precision":case"double precision[]":d="number";break;case"boolean":d="boolean";break;case"character":case"character[]":case'"char"':case'"char"[]':case"character varying":case"character varying[]":e.internal_size&&e.internal_size>=0&&65535!=e.internal_size&&(c+=" ("+e.internal_size+")"),d="string";break;case"bytea":case"bytea[]":d="binary";break;case"geometry":d="geometry";break;case"geography":d="geography";break;default:d="string"}l=e.display_name+"<br>"+c;var f=u.lastIndexOf("[]"),p={name:e.name,display_name:e.display_name,column_type:c,column_type_internal:u,pos:e.pos,label:l,cell:d,can_edit:"oid"!=e.name&&n,type:u,not_null:e.not_null,has_default_val:e.has_default_val,is_array:f>-1&&f+2==u.length};i.push(p)})),r.columns=i,t&&"function"==typeof t&&t()},resetQueryHistoryObject:function(e){e.total_time="-"},set_sql_message:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?n(".sql-editor-message").append(e):n(".sql-editor-message").text(e),setTimeout((function(){n(".sql-editor-message").scrollTop(n(".sql-editor-message")[0].scrollHeight)}),10)},update_msg_history:function(t,a,i){if(void 0===i&&(i=!0),this.gridView.messages_panel.focus(),i?(this.gridView.handler.slickgrid&&this.gridView.handler.slickgrid.destroy(),this.columns=void 0,this.collection=void 0,this.set_sql_message(a)):this.set_sql_message(o.escape(a),!0),"Busy"!=t){n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),this.trigger("pgadmin-sqleditor:loading-icon:hide"),this.total_time||(this.total_time=L.calculateQueryRunTime(this.query_start_time,new Date)),o.isUndefined(this.history_query_source)&&(this.history_query_source=X.VIEW_DATA);var r={status:t,start_time:this.query_start_time,query:this.query,row_affected:this.rows_affected,total_time:this.total_time,message:a,query_source:this.history_query_source,is_pgadmin_query:!this.is_query_tool};if(!this.is_query_tool){var s=e('This query was generated by pgAdmin as part of a "View/Edit Data" operation');r.info=s}this.add_to_history(r)}},add_to_history:function(e){n.ajax({url:t("sqleditor.add_query_history",{trans_id:this.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(e)}).done((function(){})).fail((function(){})),this.gridView.history_collection.add(e)},is_editable:function(e){return!(e instanceof u.Collection)&&this.get("can_edit")},rows_to_delete:function(e){var t=this,n=t.primary_keys;t.temp_new_rows=[],e.forEach((function(e,a){var i=o.pick(e,o.keys(n));Object.keys(i).length>0||t.temp_new_rows.push(a)})),t.rows_to_disable=o.clone(t.temp_new_rows)},_delete:function(){var t=this,a=[],i=o.size(t.data_store.added),r=o.size(t.data_store.updated);if(i&&o.each(t.data_store.added,(function(e,n){n in t.data_store.staged_rows&&a.push(n)})),o.size(t.data_store.staged_rows)>0&&o.size(t.data_store.staged_rows)===o.size(a)){var s=t.slickgrid,l=s.getData();s.resetActiveCell(),l.beginUpdate();for(var c=0;c<a.length;c++)delete t.data_store.staged_rows[a[c]],delete t.data_store.added[a[c]],delete t.data_store.added_index[a[c]],l.deleteItem(a[c]);l.endUpdate(),t.rows_to_delete.apply(t,[l.getItems()]),s.resetActiveCell(),s.setSelectedRows([]),s.invalidate(),n("#btn-delete-row").prop("disabled",!0),n("#btn-copy-row").prop("disabled",!0),o.size(t.data_store.added)||r?n("#btn-save-data").prop("disabled",!1):n("#btn-save-data").prop("disabled",!0),d.success(e("Row(s) deleted."))}else{var u=!0;o.each(o.keys(t.data_store.staged_rows),(function(e){e in t.data_store.deleted&&(u=!1)})),u?(t.data_store.deleted=Object.assign({},t.data_store.deleted,t.data_store.staged_rows),n(t.gridView.grid.getCanvasNode()).find("div.selected").addClass("strikeout")):(n(t.gridView.grid.getCanvasNode()).find("div.selected").removeClass("strikeout"),o.each(o.keys(t.data_store.staged_rows),(function(e){e in t.data_store.deleted&&delete t.data_store.deleted[e]}))),o.size(t.data_store.added)||r||o.size(t.data_store.deleted)?n("#btn-save-data").prop("disabled",!1):n("#btn-save-data").prop("disabled",!0)}},_save_file:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this,n=t.gridView.current_file;if(o.isUndefined(n)||e){var a={supported_types:["*","sql"],dialog_type:"create_file",dialog_title:"Save File",btn_primary:"Save"};c.FileManager.init(),c.FileManager.show_dialog(a)}else t._save_file_handler(n)},save_data:function(){var a=this;if(a.can_edit){var i=o.size(a.data_store.added),r=o.size(a.data_store.updated),s=o.size(a.data_store.deleted);if(i||r||s){a.trigger("pgadmin-sqleditor:loading-icon:show",e("Saving the updated data...")),a.is_query_tool&&a.disable_tool_buttons(!0,!0);var l=a.data_store,u=a.gridView;l.columns=u?u.handler.columns:a.columns;var f=!1,p=new Date;n.ajax({url:t("sqleditor.save",{trans_id:a.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(l)}).done((function(t){var r=a.slickgrid,c=r.getData(),u=c.getLength(),h=[],_=t.data.transaction_status;a.last_transaction_status=_;var g=_>0;if(g?a.disable_transaction_buttons(!1):a.disable_transaction_buttons(!0),a.is_query_tool&&a.disable_tool_buttons(!1),t.data.status){n("#btn-save-data").prop("disabled",!0),f=!0;for(var m=1;m<=a.numberOfModifiedCells;m++)r.removeCellCssStyles(m);if(a.numberOfModifiedCells=0,i&&(c.beginUpdate(),o.each(t.data.query_results,(function(e){if(!o.isNull(e.row_added)){var t=Object.keys(e.row_added)[0];o.each(l.added_index,(function(n,a){if(n==t){var i=r.getDataItem(a);o.extend(i,e.row_added[t])}}))}})),c.endUpdate()),o.each(h,(function(e){e.is_row_copied&&delete e.is_row_copied})),r.copied_rows&&delete r.copied_rows,s){var b=o.keys(a.data_store.deleted);if(u==b.length)h=[],c.setItems(h,a.client_primary_key);else{c.beginUpdate();for(var v=0;v<b.length;v++){var y=r.getDataItem(b[v]);h.push(y),c.deleteItem(y[a.client_primary_key])}c.endUpdate()}a.rows_to_delete.apply(a,[h])}r.setSelectedRows([]),a.reset_data_store(),a.primary_keys_data={},a.set_sql_message(""),d.success(e("Data saved successfully.")),g&&d.info(e("Auto-commit is off. You still need to commit changes to the database."))}else{a.set_sql_message(t.data.result);var w=e("%s.",t.data.result);if(d.error(w,20),0!=_&&d.info(e("Saving data changes was rolled back but the current transaction is still active; previous queries are unaffected.")),r.setSelectedRows([]),o.has(t.data,"_rowid")&&(!o.isUndefined(t.data._rowid)||!o.isNull(t.data._rowid))){var x=a._find_rowindex(t.data._rowid);if(x in a.data_store.added_index){var C=a.handler.temp_new_rows.indexOf(t.data._rowid);C>-1&&a.handler.temp_new_rows.splice(C,1),a.data_store.added[a.data_store.added_index[x]].err=!0}else x in a.data_store.updated_index&&(a.data_store.updated[a.data_store.updated_index[x]].err=!0)}r.gotoCell(x,1)}var S=e('This query was generated by pgAdmin as part of a "Save Data" operation');o.each(t.data.query_results,(function(e){var t={status:e.status,start_time:p,query:e.sql,row_affected:e.rows_affected,total_time:null,message:e.result,query_source:X.SAVE_DATA,is_pgadmin_query:!0,info:S};a.add_to_history(t)})),a.trigger("pgadmin-sqleditor:loading-icon:hide"),r.invalidate(),a.close_on_save&&(f?a.check_needed_confirmations_before_closing_panel():a.close_on_save=!1)})).fail((function(e){var t=[u],n=T.handleQueryToolAjaxError(c,a,e,"save_data",t,!0);a.is_query_tool&&a.disable_tool_buttons(!1),n&&a.update_msg_history(!1,n)}))}}},reset_data_store:function(){this.data_store={updated:{},added:{},staged_rows:{},deleted:{},updated_index:{},added_index:{}}},_find_rowindex:function(e){var t,n=this.slickgrid.getData().getItems(),a=0,i=-1;if(o.isObject(e))t=e;else{if(!o.isString(e))return i;(e={})[this.client_primary_key]=e,t=e}return o.find(n,(function(e){var n=[];if(n.push(e),o.findWhere(n,t))return i=a,!0;a++})),i},_save_as:function(){return this._save_file(!0)},setTitle:function(e,t){var n=this,a=n.browser_preferences.new_browser_tab_open;a&&a.includes("qt")?window.document.title=e:o.each(z.default.pgAdmin.Browser.docker.findPanels("frm_datagrid"),(function(a){a.isVisible()&&F.setQueryToolDockerTitle(a,n.is_query_tool,e,t)}))},_load_file:function(){var t=this;t.is_query_changed?d.confirm(e("Unsaved changes"),e("Are you sure you wish to discard the current changes?"),(function(){t._open_select_file_manager()}),(function(){return!0})).set("labels",{ok:e("Yes"),cancel:e("No")}):t._open_select_file_manager()},_open_select_file_manager:function(){c.FileManager.init(),c.FileManager.show_dialog({supported_types:["sql"],dialog_type:"select_file"})},_select_file_handler:function(a){var i=this,r=a,o={file_name:decodeURI(a)};i.trigger("pgadmin-sqleditor:loading-icon:show",e("Loading the file..."));var s=n(".sql-editor-busy-fetching");s.addClass("show_progress"),n.ajax({url:t("sqleditor.load_file"),method:"POST",contentType:"application/json",data:JSON.stringify(o)}).done((function(e){i.gridView.query_tool_obj.setValue(e),i.gridView.current_file=a,i.setTitle(i.gridView.current_file.split("\\").pop().split("/").pop(),!0),i.trigger("pgadmin-sqleditor:loading-icon:hide"),s.removeClass("show_progress"),n("#btn-save-file").prop("disabled",!0),n("#btn-file-menu-save").css("display","none"),i.is_query_changed=!1,setTimeout((function(){i.gridView.query_tool_obj.focus()}),200)})).fail((function(e){i.trigger("pgadmin-sqleditor:loading-icon:hide");var t=[r],n=T.handleQueryToolAjaxError(c,i,e,"_select_file_handler",t,!1);n&&d.error(n),s.removeClass("show_progress")}))},_save_file_handler:function(a){var i=this,r=a,o={file_name:decodeURI(a),file_content:i.gridView.query_tool_obj.getValue()};i.trigger("pgadmin-sqleditor:loading-icon:show",e("Saving the queries in the file...")),n.ajax({url:t("sqleditor.save_file"),method:"POST",contentType:"application/json",data:JSON.stringify(o)}).done((function(t){t.data.status&&(d.success(e("File saved successfully.")),i.gridView.current_file=a,i.setTitle(i.gridView.current_file.replace(/^.*[\\\/]/g,""),!0),n("#btn-save-file").prop("disabled",!0),n("#btn-file-menu-save").css("display","none"),i.is_query_changed=!1,setTimeout((function(){i.gridView.query_tool_obj.focus()}),200)),i.trigger("pgadmin-sqleditor:loading-icon:hide"),i.close_on_save&&i.check_needed_confirmations_before_closing_panel()})).fail((function(e){i.trigger("pgadmin-sqleditor:loading-icon:hide");var t=[r],n=T.handleQueryToolAjaxError(c,i,e,"_save_file_handler",t,!1);n&&d.error(n)}))},_on_query_change:function(){var e=this;if(!e.is_query_changed){if(e.is_query_changed=!0,e.gridView.current_file){var t=e.gridView.current_file.replace(/^.*[\\\/]/g,"")+" *";e.setTitle(t,!0)}else{var a=e.browser_preferences.new_browser_tab_open;a&&a.includes("qt")?t=window.document.title+" *":(o.each(z.default.pgAdmin.Browser.docker.findPanels("frm_datagrid"),(function(t){t.isVisible()&&(e.gridView.panel_title=n(t._title).text())})),t=e.gridView.panel_title+" *"),e.setTitle(t)}n("#btn-save-file").prop("disabled",!1),n("#btn-file-menu-save").css("display","block"),n("#btn-file-menu-dropdown").prop("disabled",!1)}},_init_polling_flags:function(){var e=this;e.POLL_FALLBACK_TIME=function(){var t=parseInt((Date.now()-e.query_start_time.getTime())/1e3);return t>=10&&t<30?500:t>=30&&t<60?1e3:t>=60&&t<90?2e3:t>=90?5e3:1}},_show_filter:function(){var e=this,t=!1;arguments.length>0&&"connect"==arguments[arguments.length-1]&&(t=!0),E.dialog(e,t)},_show_new_connection:function(){var e=this,t=!1;arguments.length>0&&"connect"==arguments[arguments.length-1]&&(t=!0),q.dialog(e,t,e.browser_preferences)},_include_filter:function(){var a,i,r,s,l=this,u={};i=(a=l.slickgrid).getActiveCell(),o.isNull(i)||o.isUndefined(i)||(r=a.getColumns()[i.cell],s=a.getDataItem(i.row,i.cell),o.isNull(s)||o.isUndefined(s)||(u[r.field]=s[r.field]||"",l.trigger("pgadmin-sqleditor:loading-icon:show",e("Applying the new filter...")),n.ajax({url:t("sqleditor.inclusive_filter",{trans_id:l.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(u)}).done((function(t){l.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout((function(){t.data.status?M.executeQuery(l):d.alert(e("Filter By Selection Error"),t.data.result)}))})).fail((function(t){l.trigger("pgadmin-sqleditor:loading-icon:hide");var n=T.handleQueryToolAjaxError(c,l,t,"_include_filter",[],!0);n&&d.alert(e("Filter By Selection Error"),n)}))))},_exclude_filter:function(){var a,i,r,s,l=this,u={};i=(a=l.slickgrid).getActiveCell(),o.isNull(i)||o.isUndefined(i)||(r=a.getColumns()[i.cell],s=a.getDataItem(i.row,i.cell),o.isNull(s)||o.isUndefined(s)||(u[r.field]=s[r.field]||"",l.trigger("pgadmin-sqleditor:loading-icon:show",e("Applying the new filter...")),n.ajax({url:t("sqleditor.exclusive_filter",{trans_id:l.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(u)}).done((function(t){l.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout((function(){t.data.status?M.executeQuery(l):d.alert(e("Filter Exclude Selection Error"),t.data.result)}),10)})).fail((function(t){l.trigger("pgadmin-sqleditor:loading-icon:hide");var n=T.handleQueryToolAjaxError(c,l,t,"_exclude_filter",[],!0);n&&d.alert(e("Filter Exclude Selection Error"),n)}))))},_remove_filter:function(){var a=this;a.trigger("pgadmin-sqleditor:loading-icon:show",e("Removing the filter...")),n.ajax({url:t("sqleditor.remove_filter",{trans_id:a.transId}),method:"POST"}).done((function(t){a.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout((function(){t.data.status?M.executeQuery(a):d.alert(e("Remove Filter Error"),t.data.result)}))})).fail((function(t){a.trigger("pgadmin-sqleditor:loading-icon:hide");var n=T.handleQueryToolAjaxError(c,a,t,"_remove_filter",[],!0);n&&d.alert(e("Remove Filter Error"),n)}))},_copy_row:v,_copy_row_with_header:function(){n(".copy-with-header").toggleClass("visibility-hidden")},_copied_in_other_session:function(e,t){c.SqlEditor.copiedInOtherSessionWithHeaders=t,n("#btn-paste-row").prop("disabled",!1)},_paste_row:function(){var e=this,t=b.getTextFromClipboard(),a=p.CSVToArray(t,e.preferences.results_grid_field_separator,e.preferences.results_grid_quote_char);if(c.SqlEditor.copiedInOtherSessionWithHeaders&&(a=a.slice(1)),(a=a.reduce((function(t,n){var a={};for(var i in e.columns){var r=n[i];""===r&&(r=e.columns[i].has_default_val?void 0:null),a[e.columns[i].name]=r}return t.push(a),t}),[])).length>0){n("#btn-save-data").prop("disabled",!1);var i=e.slickgrid,r=i.getData(),s=r.getLength(),l=[];for(var d in e.columns)e.columns[d].is_array&&l.push(e.columns[d].name);r.beginUpdate(),o.each(a,(function(t){var n,a,i=(n=t,a={},o.each(n,(function(e,t){void 0!==n[t]&&(o.isObject(n[t])&&-1==l.indexOf(t)?a[String(t)]=JSON.stringify(n[t]):a[String(t)]=n[t])})),a),d=(e.gridView.client_primary_key_counter++).toString();i.is_row_copied=!0,e.temp_new_rows.push(s),i[e.client_primary_key]=d,e.has_oids&&i.oid&&(i.oid=null),r.addItem(i),e.data_store.added[d]={err:!1,data:i},e.data_store.added_index[s]=d,s++})),r.endUpdate(),i.invalidateRow(i.getSelectedRows()),i.updateRowCount(),i.render(),i.scrollRowIntoView(r.getLength()),i.setSelectedRows([])}},_set_limit:function(){var a=this,i=parseInt(n(".limit").val());a.trigger("pgadmin-sqleditor:loading-icon:show",e("Setting the limit on the result...")),n.ajax({url:t("sqleditor.set_limit",{trans_id:a.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(i)}).done((function(t){a.trigger("pgadmin-sqleditor:loading-icon:hide"),setTimeout((function(){t.data.status?M.executeQuery(a):d.alert(e("Change limit Error"),t.data.result)}),10)})).fail((function(t){a.trigger("pgadmin-sqleditor:loading-icon:hide");var n=T.handleQueryToolAjaxError(c,a,t,"_set_limit",[],!0);n&&d.alert(e("Change limit Error"),n)}))},disable_tool_buttons:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=e;this.is_query_tool||(a=!0),n("#btn-explain").prop("disabled",a),n("#btn-explain-analyze").prop("disabled",a),n("#btn-explain-options-dropdown").prop("disabled",a),n("#btn-edit-dropdown").prop("disabled",a),n("#btn-load-file").prop("disabled",a),n("#btn-save-file").prop("disabled",a),n("#btn-file-menu-dropdown").prop("disabled",a),n("#btn-find").prop("disabled",a),n("#btn-find-menu-dropdown").prop("disabled",a),n("#btn-macro-dropdown").prop("disabled",a),this.is_query_tool?(null!==t?n("#btn-cancel-query").prop("disabled",t):n("#btn-cancel-query").prop("disabled",!e),this.is_transaction_buttons_disabled?n("#btn-query-dropdown").prop("disabled",e):n("#btn-query-dropdown").prop("disabled",!0)):n("#btn-query-dropdown").prop("disabled",a)},disable_transaction_buttons:function(e){this.is_transaction_buttons_disabled=e,this.is_query_tool&&(n("#btn-commit").prop("disabled",e),n("#btn-rollback").prop("disabled",e))},_highlight_error:function(e){var t=0,n=0,a=0,i=0;this.gridView.query_tool_obj.removeLineClass(this.marked_line_no,"wrap","CodeMirror-activeline-background"),this.gridView.query_tool_obj.getSelection().length>0&&(i=this.gridView.query_tool_obj.getCursor(!0).line);var r=/LINE (\d+)/.exec(e),o=/Character: (\d+)/.exec(e);if(null!=r&&null!=o){t=this.marked_line_no=parseInt(r[1])-1+i;for(var s=parseInt(o[1])-1,l=0,d=i>0?i:0;d<t;d++)l+=this.gridView.query_tool_obj.getLine(d).length+1;n=s-l;var c=this.gridView.query_tool_obj.getLine(t);(a=c.indexOf(" ",n))<0&&(a=c.length),this.gridView.marker=this.gridView.query_tool_obj.markText({line:t,ch:n},{line:t,ch:a},{className:"sql-editor-mark"}),this.gridView.query_tool_obj.addLineClass(this.marked_line_no,"wrap","CodeMirror-activeline-background")}},_cancel_query:function(){var a=this;n.ajax({url:t("sqleditor.cancel_transaction",{trans_id:a.transId}),method:"POST",contentType:"application/json"}).done((function(t){t.data.status||d.alert(e("Cancel Query Error"),t.data.result),a.disable_tool_buttons(!1),ee=!1,o.isUndefined(a.download_csv_obj)||(a.download_csv_obj.abort(),n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),a.trigger("pgadmin-sqleditor:loading-icon:hide")),setTimeout((function(){a.gridView.query_tool_obj.focus()}),200)})).fail((function(t){a.disable_tool_buttons(!1);var n=T.handleQueryToolAjaxError(c,a,t,"_cancel_query",[],!1);n&&d.alert(e("Cancel Query Error"),n)}))},trigger_csv_download:function(a,i){var r=this,s=t("sqleditor.query_tool_download",{trans_id:r.transId}),l={query:a,filename:i};n("#btn-flash").prop("disabled",!0),n("#btn-download").prop("disabled",!0),r.disable_tool_buttons(!0),r.set_sql_message(""),r.trigger("pgadmin-sqleditor:loading-icon:show",e("Downloading CSV...")),r.download_csv_obj=n.ajax({type:"POST",url:s,data:l,cache:!1}).done((function(e){if(o.isUndefined(e.data)){var t=new Blob([e],{type:"text/csv"}),a=(window.URL||window.webkitURL).createObjectURL(t),s=c.Browser.get_browser(),l=document.createElement("a");document.body.appendChild(l),"IE"===s.name&&window.navigator.msSaveBlob?window.navigator.msSaveBlob(t,i):(l.setAttribute("href",a),l.setAttribute("download",i),l.click()),document.body.removeChild(l),r.download_csv_obj=void 0}else e.status||(r._highlight_error(e.data.result),r.set_sql_message(e.data.result));n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),r.disable_tool_buttons(!1),r.trigger("pgadmin-sqleditor:loading-icon:hide")})).fail((function(t){var a="";n("#btn-flash").prop("disabled",!1),n("#btn-download").prop("disabled",!1),r.disable_tool_buttons(!1),r.trigger("pgadmin-sqleditor:loading-icon:hide"),(a="abort"==t.statusText?e("CSV Download cancelled."):T.handleQueryToolAjaxError(c,r,t,"trigger_csv_download",[],!0))&&d.alert(e("Download CSV error"),a)}))},call_cache_preferences:function(){z.default.pgAdmin.Browser.cache_preferences("sqleditor"),Q.preference_version(Q.generate_preference_version())},_auto_rollback:function(){var a=this,i=!0;!0===n(".auto-rollback").hasClass("visibility-hidden")?n(".auto-rollback").removeClass("visibility-hidden"):(n(".auto-rollback").addClass("visibility-hidden"),i=!1),n.ajax({url:t("sqleditor.auto_rollback",{trans_id:a.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(i)}).done((function(t){t.data.status||d.alert(e("Auto Rollback Error"),t.data.result)})).fail((function(t){var n=T.handleQueryToolAjaxError(c,a,t,"_auto_rollback",[],!0);n&&d.alert(e("Auto Rollback Error"),n)}))},_auto_commit:function(){var a=this,i=!0;!0===n(".auto-commit").hasClass("visibility-hidden")?n(".auto-commit").removeClass("visibility-hidden"):(n(".auto-commit").addClass("visibility-hidden"),i=!1),n.ajax({url:t("sqleditor.auto_commit",{trans_id:a.transId}),method:"POST",contentType:"application/json",data:JSON.stringify(i)}).done((function(t){t.data.status||d.alert(e("Auto Commit Error"),t.data.result)})).fail((function(t){var n=T.handleQueryToolAjaxError(c,a,t,"_auto_commit",[],!0);n&&d.alert(e("Auto Commit Error"),n)}))},_toggle_explain_option:function(e){var t=".explain-".concat(e);n(t).toggleClass("visibility-hidden")},_explain_verbose:function(){this._toggle_explain_option("verbose")},_explain_costs:function(){this._toggle_explain_option("costs")},_explain_buffers:function(){this._toggle_explain_option("buffers")},_explain_timing:function(){this._toggle_explain_option("timing")},_explain_summary:function(){this._toggle_explain_option("summary")},_explain_settings:function(){this._toggle_explain_option("settings")},_show_query_tool:function(){var e=this.browser_preferences.new_browser_tab_open;e&&e.includes("qt")&&re(),this._open_query_tool(this)},_open_query_tool:function(e){var n=p.getRandomInt(1,9999999),a=t("datagrid.panel",{trans_id:n});a+="?is_query_tool=".concat(!0)+"&sgid=".concat(e.url_params.sgid)+"&sid=".concat(e.url_params.sid)+"&server_type=".concat(e.url_params.server_type),e.url_params.did&&(a+="&did=".concat(e.url_params.did));var i=e.url_params.title;if("false"==e.url_params.is_query_tool){var o=e.url_params.title.split("/");o.length>2&&(i=o[o.length-2]+"/"+o[o.length-1])}(0,r.launchDataGrid)(z.default.pgAdmin.DataGrid,n,a,i,"",d)},_indent_selected_code:function(){this.gridView.query_tool_obj.execCommand("indentMore")},_unindent_selected_code:function(){this.gridView.query_tool_obj.execCommand("indentLess")},_format_sql:function(){var e=this.gridView.query_tool_obj,a=!0,i="";""==(i=e.getSelection())&&(i=e.getValue(),a=!1),n.ajax({url:t("sql.format"),data:JSON.stringify({sql:i}),method:"POST",contentType:"application/json",dataType:"json"}).done((function(t){!0===a?e.replaceSelection(t.data.sql,"around"):e.setValue(t.data.sql)})).fail((function(){}))},_manage_macros:function(){K.dialog(this)},_execute_macro:function(){M.executeMacro(this.handler)},isQueryRunning:function(){return ee},setIsQueryRunning:function(e){ee=e},check_needed_confirmations_before_closing_panel:function(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=this;a.ignore_on_close&&!n||(a.ignore_on_close={unsaved_data:!1,unsaved_query:!1});var i=a.ignore_on_close.unsaved_data,r=a.ignore_on_close.unsaved_query;if(!i&&a.can_edit&&a.preferences.prompt_save_data_changes&&a.data_store&&(o.size(a.data_store.added)||o.size(a.data_store.updated)||o.size(a.data_store.deleted)))t=e("The data has changed. Do you want to save changes?"),a.unsaved_changes_user_confirmation(t,!0);else if(!r&&a.is_query_tool&&a.is_query_changed&&a.preferences.prompt_save_query_changes)t=e("The text has changed. Do you want to save changes?"),a.unsaved_changes_user_confirmation(t,!1);else if(!a.preferences.prompt_commit_transaction||a.last_transaction_status!==U.TRANSACTION_STATUS_INTRANS&&a.last_transaction_status!==U.TRANSACTION_STATUS_INERROR)a.ignore_on_close=void 0,a.close();else{var s=a.last_transaction_status==U.TRANSACTION_STATUS_INERROR;a.uncommitted_transaction_user_confirmation(s)}return!1},uncommitted_transaction_user_confirmation:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this;d.confirmCommit||d.dialog("confirmCommit",(function(){return{main:function(e,t,n){this.is_commit_disabled=n,this.setHeader(e),this.setContent(t)},setup:function(){return{buttons:[{text:e("Cancel"),key:27,invokeOnClose:!0,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button"},{text:e("Rollback"),className:"btn btn-primary fa fa-lg pg-alertify-button"},{text:e("Commit"),className:"btn btn-primary fa fa-lg pg-alertify-button"}],focus:{element:0,select:!1},options:{maximizable:!1,resizable:!1}}},prepare:function(){this.is_commit_disabled?this.__internal.buttons[2].element.disabled=!0:this.__internal.buttons[2].element.disabled=!1},callback:function(e){switch(e.index){case 0:break;case 1:n.close_on_idle_transaction=!0,M.executeRollback(n);break;case 2:n.close_on_idle_transaction=!0,M.executeCommit(n)}}}}));var a=e("The current transaction is not commited to the database. Do you want to commit or rollback the transaction?");d.confirmCommit(e("Commit transaction?"),a,t)},unsaved_changes_user_confirmation:function(t,n){var a=this;d.confirmSave||d.dialog("confirmSave",(function(){return{main:function(e,t,n){this.is_unsaved_data=n,this.setHeader(e),this.setContent(t)},setup:function(){return{buttons:[{text:e("Cancel"),key:27,invokeOnClose:!0,className:"btn btn-secondary fa fa-lg fa-times pg-alertify-button"},{text:e("Don't save"),className:"btn btn-secondary fa fa-lg fa-trash-alt pg-alertify-button"},{text:e("Save"),className:"btn btn-primary fa fa-lg fa-save pg-alertify-button"}],focus:{element:0,select:!1},options:{maximizable:!1,resizable:!1}}},callback:function(e){switch(e.index){case 0:break;case 1:a.close_on_save=!1,this.is_unsaved_data?a.ignore_on_close.unsaved_data=!0:a.ignore_on_close.unsaved_query=!0,a.check_needed_confirmations_before_closing_panel()||(e.cancel=!0);break;case 2:a.close_on_save=!0,this.is_unsaved_data?a.save_data():a._save_file()}}}})),d.confirmSave(e("Save changes?"),t,n)},close:function(){var e=this;Q.Events.off("pgadmin:user:logged-in",this.initTransaction),o.each(z.default.pgAdmin.Browser.docker.findPanels("frm_datagrid"),(function(t){t.isVisible()&&(window.onbeforeunload=null,t.off(G.EVENT.CLOSING),o.isUndefined(e.col_size)||delete e.col_size,z.default.pgAdmin.Browser.docker.removePanel(t))}))},update_notifications:function(e){R.updateNotifications(e)}}),c.SqlEditor={create:function(e){return new ie(e)},jquery:n},c.SqlEditor}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";var a,i;n(31),n(41),n(8),n(40),n(14),n(23),n(42),n(37),n(27),n(10),n(12),n(36),n(5),n(29),n(30),n(83),n(16),n(7),n(38),a=[n(6),n(0),n(1),n(4),n(20),n(305),n(306),n(307),n(2),n(134)],void 0===(i=function(t,a,i,r,o,s,l,d,c){r=r||window.pgAdmin||{},l=l.default;var u=null;if(r.Explain)return r.Explain;var f=r.Explain={prefix:t("misc.index")+"static/explain/img/"},p=i.template(['<tr<% if (className) {%> class="<%=className%>"<%}%>>',' <td class="renderable name"><%- data.name %></td>',' <td class="renderable text-right"><%- data.count %></td>',' <td class="renderable timings d-none text-right">',"<%=Math.ceil10(data.sum_of_times, -3)%> ms","</td>",' <td class="renderable timings d-none text-right">',"<%=Math.ceil10(((data.sum_of_times||0)/(total_time||1)) * 100, -2)%>%","</td>","</tr>"].join("")),h=i.template(['<tr class="pga-ex-row','<% if (data["Plans"] && data["Plans"].length > 0) {%>'," pga-ex-collapsible","<%}%>",'<% if (data["exclusive_flag"] !== "undefined") {%>'," pga-ex-exclusive-",'<%- data["exclusive_flag"] %>',"<%}%>",'<% if (data["inclusive_flag"] !== "undefined") {%>'," pga-ex-inclusive-",'<%- data["inclusive_flag"] %>',"<%}%>",'<% if (data["rowsx_flag"] !== "undefined") {%>'," pga-ex-rowsx-",'<%- data["rowsx_flag"] %>',"<%}%>",'"','<% if (data["parent_node"]) {%>',' data-parent="pga_ex_<%= data["parent_node"] %>"',"<%}%>",' data-ex-id="pga_ex_<%= data["level"].join("_") %>">',' <td class="renderable pg-ex-highlighter clickable">','  <i class="fa fa-circle invisible"></i>',"</td>",' <td class="renderable clickable serial text-right">','<%= (data["_serial"]) %>.</td>',' <td class="renderable clickable" style="padding-left: ','<%= (data["level"].length) * 30%>px"','title="<%= tooltip_text %>"',">",'  <i class="pg-ex-subplans fa fa-long-arrow-alt-right"></i>',"<%= display_text %>","<%if (node_extra_info && node_extra_info.length > 0 ) {%>","<ui>","<%  for (var node_info_idx=0; "," node_info_idx<node_extra_info.length;node_info_idx++) {%>"," <li>","<%= node_extra_info[node_info_idx] %>","</li>","<% }%>","</ui>","<%}%>"," </td>",' <td class="renderable timings d-none text-right ','<% if (data["exclusive_flag"] !== "undefined") {%>',"pga-ex-exclusive-",'<%- data["exclusive_flag"] %>',"<%}%>",'">','<% if (typeof(data["exclusive"]) !== "undefined") {%>','<%= data["exclusive"] %> ms',"<%}%>"," </td>",' <td class="renderable timings d-none text-right ','<% if (data["inclusive_flag"] !== "undefined") {%>',"pga-ex-inclusive-",'<%- data["inclusive_flag"] %>',"<%}%>",'">','<% if (typeof(data["inclusive"]) !== "undefined") {%>','<%= data["inclusive"] %> ms',"<%}%>"," </td>",' <td class="renderable rowsx d-none text-right ','<% if (data["rowsx_flag"] !== "undefined") {%>',"pga-ex-rowsx-",'<%- data["rowsx_flag"] %>',"<%}%>",'">','<% if (data["rowsx_direction"] === "positive") {%>',"&uarr;","<%} else {%>","&darr;","<%}%> ",'<% if (typeof(data["rowsx"]) !== "undefined") {%>','<%- data["rowsx"] %>',"<%}%>  "," </td>",' <td class="renderable rowsx rows d-none text-right">','<% if (typeof(data["Actual Rows"]) !== "undefined") {%>','<%= data["Actual Rows"] %>',"<%}%>"," </td>",' <td class="renderable rowsx plan_rows d-none text-right">','<%= data["Plan Rows"] %>'," </td>",' <td class="renderable rows rowsx d-none text-right">','<% if (typeof(data["Actual Loops"]) !== "undefined") {%>','<%= data["Actual Loops"] %>',"<%}%>"," </td>",' <td class="renderable d-none">','  <i class="fa fa-ellipsis-h"></i>'," </td>","</tr>"].join("")),_=o.Model.extend({defaults:{Plans:[],level:[],image:void 0,image_text:void 0,xpos:void 0,ypos:void 0,width:100,height:100},_createSame:function(){return new _},parse:function(e,t){var n=1,a=e.level=e.level||[n],r=[],o=e["Node Type"],s=e.xpos=e.xpos-100,l=e.ypos,c=0;t.ctx.totalNodes++,t.ctx._explainTable.total_time=e.total_time||e["Actual Total Time"],e._serial=t.ctx.totalNodes,e.width=100,e.height=100,"SubPlan"===e["Parent Relationship"]&&(e.width+=62.5,e.height+=50,e.ypos+=25,s-=25,l+=25),o.startsWith("(slice")&&(o=o.substring(0,7));var u=d.default,f=i.isFunction(u[o])&&u[o].apply(void 0,[e])||u[o]||{image:"ex_unknown.svg",image_text:o};if(e.image=f.image,e.image_text=f.image_text,"Actual Total Time"in e&&"Actual Loops"in e&&(e.inclusive=Math.ceil10(e["Actual Total Time"]*e["Actual Loops"],-3),e.exclusive=e.inclusive,e.inclusive_factor=e.inclusive/(e.total_time||e["Actual Total Time"]),e.inclusive_flag=e.inclusive_factor<=.1?"1":e.inclusive_factor<.5?"2":e.inclusive_factor<=.9?"3":"4"),"Actual Rows"in e&&"Plan Rows"in e&&(0===e["Actual Rows"]||e["Actual Rows"]>e["Plan Rows"]?(e.rowsx=0===e["Plan Rows"]?0:e["Actual Rows"]/e["Plan Rows"],e.rowsx_direction="negative"):(e.rowsx=0===e["Actual Rows"]?0:e["Plan Rows"]/e["Actual Rows"],e.rowsx_direction="positive"),e.rowsx_flag=e.rowsx<=10?"1":e.rowsx<=100?"2":e.rowsx<=1e3?"3":"4",e.rowsx=Math.ceil10(e.rowsx,-2)),"Plans"in e){var p,h=this;e.width+=200,i.each(e.Plans,(function(o){var d=i.clone(a),u=h._createSame();d.push(n),u.set(u.parse(i.extend(o,{level:d,xpos:s-200,ypos:l,total_time:e.total_time||e["Actual Total Time"],parent_node:a.join("_")}),t)),c<u.get("width")&&(c=u.get("width")),"exclusive"in e&&(p=u.get("inclusive"))&&(e.exclusive-=p);var f=u.get("height");1!==n?e.height=e.height+f+60:f>e.height&&(e.height=f),l+=f+60,r.push(u),n++}))}return"exclusive"in e&&(e.exclusive=Math.ceil10(e.exclusive,-3),e.exclusive_factor=e.exclusive/(e.total_time||e["Actual Total Time"]),e.exclusive_flag=e.exclusive_factor<=.1?"1":e.exclusive_factor<.5?"2":e.exclusive_factor<=.9?"3":"4"),e.width+=c,e.Plans=r,e},draw:function(e,t,n,a,r,o,s,l){var d=e.g(),u=t+this.get("xpos"),p=n+this.get("ypos"),_="SubPlan"===this.get("Parent Relationship"),g=this.toJSON(),m=getComputedStyle(document.documentElement).getPropertyValue("--color-fg");!function(e,t){var n,a,r=['<span class="pg-explain-text-name">'],o=[],s=[],l=t._explainTable;if(/Scan/.test(e["Node Type"])?(r.push(e["Node Type"]),o.push(e["Node Type"])):(r.push(e.image_text),o.push(e.image_text)),n=o.join(""),r.push("</span>"),void 0!==e["Index Name"]&&(r.push(" using "),o.push(" using "),r.push('<span class="pg-explain-text-name">'),r.push(i.escape(e["Index Name"])),o.push(e["Index Name"]),r.push("</span>")),void 0!==e["Relation Name"]&&(r.push(" on "),o.push(" on "),void 0!==e.Schema&&(r.push('<span class="pg-explain-text-name">'),r.push(i.escape(e.Schema)),o.push(e.Schema),r.push("</span>"),r.push("."),o.push(".")),r.push('<span class="pg-explain-text-name">'),r.push(i.escape(e["Relation Name"])),o.push(e["Relation Name"]),r.push("</span>"),void 0!==e.Alias&&(r.push(" as "),o.push(" as "),r.push('<span class="pg-explain-text-name">'),r.push(i.escape(e.Alias)),o.push(i.escape(e.Alias)),r.push("</span>"))),void 0!==e["Plan Rows"]&&void 0!==e["Plan Width"]){var d=[" (cost=",void 0!==e["Startup Cost"]?e["Startup Cost"]:"","..",void 0!==e["Total Cost"]?e["Total Cost"]:""," rows=",e["Plan Rows"]," width=",e["Plan Width"],")"].join("");r.push(d),o.push(d)}if(void 0!==e["Actual Startup Time"]||void 0!==e["Actual Total Time"]||void 0!==e["Actual Rows"]){var u=[" (",void 0!==e["Actual Startup Time"]?"actual="+e["Actual Startup Time"]+"..":"",void 0!==e["Actual Total Time"]?e["Actual Total Time"]+" ":"",void 0!==e["Actual Rows"]?"rows="+e["Actual Rows"]:"",void 0!==e["Actual Loops"]?" loops="+e["Actual Loops"]:"",")"].join("");r.push(u),o.push(u)}if("Join Filter"in e&&s.push("<strong>"+c("Join Filter")+"</strong>: "+i.escape(e["Join Filter"])),"Filter"in e&&s.push("<strong>"+c("Filter")+"</strong>: "+i.escape(e.Filter)),"Index Cond"in e&&s.push("<strong>"+c("Index Cond")+"</strong>: "+i.escape(e["Index Cond"])),"Hash Cond"in e&&s.push("<strong>"+c("Hash Cond")+"</strong>: "+i.escape(e["Hash Cond"])),"Rows Removed by Filter"in e&&s.push("<strong>"+c("Rows Removed by Filter")+"</strong>: "+i.escape(e["Rows Removed by Filter"])),"Peak Memory Usage"in e){var f=["<strong>"+c("Buckets")+"</strong>:",i.escape(e["Hash Buckets"]),"<strong>"+c("Batches")+"</strong>:",i.escape(e["Hash Batches"]),"<strong>"+c("Memory Usage")+"</strong>:",i.escape(e["Peak Memory Usage"]),"kB"].join(" ");s.push(f)}if("Recheck Cond"in e&&s.push("<strong>"+c("Recheck Cond")+"</strong>: "+e["Recheck Cond"]),"Exact Heap Blocks"in e&&s.push("<strong>"+c("Heap Blocks")+"</strong>: exact="+e["Exact Heap Blocks"]),l.rows.push(h({data:e,display_text:r.join(""),tooltip_text:o.join(""),node_extra_info:s})),void 0!==e.exclusive_flag&&(l.show_timings=!0),void 0!==e.rowsx_flag&&(l.show_rowsx=!0),void 0!==e["Actual Loops"]&&(l.show_rows=!0),void 0!==e["Plan Rows"]&&(l.show_plan_rows=!0),void 0!==e.total_time&&(l.total_time=e.total_time),void 0!==e["Relation Name"]){var p=(void 0!==e.Schema?e.Schema+".":"")+e["Relation Name"],_=l.statistics.tables[p]||{name:p,count:0,sum_of_times:0,nodes:{}};a=_.nodes[n]||{name:n,count:0,sum_of_times:0},_.count++,_.sum_of_times+=e.exclusive,a.count++,a.sum_of_times+=e.exclusive,_.nodes[n]=a,l.statistics.tables[p]=_}(a=l.statistics.nodes[n]||{name:n,count:0,sum_of_times:0}).count++,a.sum_of_times+=e.exclusive,l.statistics.nodes[n]=a}(g,l),_&&(d.rect(u-this.get("width")+100+25,p-this.get("height")+100+25-5,this.get("width")-25,this.get("height")+(p-25),5).attr({stroke:"#444444",strokeWidth:1.2,fill:"gray",fillOpacity:.2}),d.text(u+100-this.get("width")/2-25,p+100-this.get("height")/2-25,this.get("Subplan Name")).attr({fontSize:"15px","text-anchor":"start",fill:"red"})),this._drawImage(e,d,f.prefix+this.get("image"),u,p,o,s,l);var b=null==this.get("Schema")?this.get("image_text"):this.get("Schema")+"."+this.get("image_text");if(d.multitext(u+50+5,p+100-5,b,150,{"font-size":"15px","text-anchor":"middle",fill:m}),!i.isUndefined(r)){var v=u+100,y=p+50,w=a-10,x=r+50,C=this.get("Startup Cost"),S=this.get("Total Cost"),k=2;null!=C&&null!=S&&(k=(k=Math.round(Math.log((C+S)/2+C)))<1?1:k>10?10:k);var T={stroke:m,strokeWidth:k+2},E={stroke:m,strokeWidth:k+2},q={viewBox:[0,0,20,20].join(" "),fill:m};this.drawPolyLine(d,v,y,w,x,_?E:T,q)}var O=this.get("Plans");i.each(O,(function(a){a.draw(e,t,n,u,p,o,s,l)}))},_drawImage:function(e,t,n,a,i,r,o){this.drawImage(t,n,a,i,r,o)},toJSON:function(e){var t=o.Model.prototype.toJSON.apply(this,arguments);if(e)delete t.Plans;else{var n=[];i.each(t.Plans,(function(e){n.push(e.toJSON())})),t.Plans=n}return t},drawPolyLine:function(e,t,n,a,i,r,o){var s=t+(a-t)/3,l=t+(a-t)/3*2,d=e.polygon([0,10,5,10,2.5,0,0,10]).transform("r90").marker(0,0,10,10,0,5).attr(o);e.line(t,n,s,n).attr(r),e.line(s-1,n,l,i).attr(r),e.line(l,i,a,i).attr(r).attr({markerEnd:d})},drawImage:function(e,t,n,r,o,s){var l=e.image(t,n+25,r+25,50,50),d=this.toJSON(),c="<title>";i.each(d,(function(e,t){"image"!==t&&"Plans"!==t&&"level"!==t&&"image"!==t&&"image_text"!==t&&"xpos"!==t&&"ypos"!==t&&"width"!==t&&"height"!==t&&(c+="".concat(t,": ").concat(e,"\n"))})),c+="</title>",l.append(u.parse(c)),l.mouseover((function(){s.empty(),l.node.textContent="";var e=a("<table></table>",{class:"pgadmin-tooltip-table"}).appendTo(s);i.each(d,(function(t,n){"image"!==n&&"Plans"!==n&&"level"!==n&&"image"!==n&&"image_text"!==n&&"xpos"!==n&&"ypos"!==n&&"width"!==n&&"height"!==n&&(n=i.escape(n),t=i.escape(t),e.append('\n              <tr>\n                <td class="label explain-tooltip">'.concat(n,'</td>\n                <td class="label explain-tooltip-val">').concat(t,"</td>\n              </tr>\n            ")))}));var t=o.data("zoom-factor"),c=(n+100)*t-o.scrollLeft(),u=r*t-o.scrollTop();u=u<0?0:u,c=(c=c<0?0:c)>o.width()-s[0].clientWidth?c-(s[0].clientWidth+100*t):c,u=u>o.height()-s[0].clientHeight?o.height()-s[0].clientHeight:u,s.css({opacity:"0.8"}),s.css("left",c),s.css("top",u),a(".pgadmin-explain-tooltip").css("padding","5px"),a(".pgadmin-explain-tooltip").css("border","1px solid white")})),l.mouseout((function(){l.append(u.parse(c)),s.empty(),s.css({opacity:"0"}),s.css("left",0),s.css("top",0)}))}}),g=_.extend({_createSame:function(){return new g({parse:!0})},_drawImage:function(e,t,n,a,i,o,s,l){var d=r.Browser.get_browser();if("IE"===d.name||"Safari"===d.name&&parseInt(d.version)<10)this.drawImage(t,n,a,i,o,s);else{var c=this,p=f.prefix+this.get("image");u.load(p,(function(n){var r=u();r.append(n),c.drawImage(t,r.toDataURL(),a,i,o,s),e.parent().attr({"xmlns:xlink":"http://www.w3.org/1999/xlink"}),setTimeout((function(){l._onImageDownloaded()}),100)}))}}}),m=o.Model.extend({defaults:{Plan:void 0,xpos:0,ypos:0},initialize:function(){this.set("Plan",new _),this.set("Statistics",new s)},parse:function(e,t){if(e&&"Plan"in e){var n=this.get("Plan");n.set(n.parse(i.extend(e.Plan,{xpos:0,ypos:0}),t)),e.xpos=0,e.ypos=0,e.width=n.get("width")+50,e.height=n.get("height")+100,delete e.Plan}var a=this.get("Statistics");if(e&&"JIT"in e&&(a.set("JIT",e.JIT),delete e.JIT),e&&"Triggers"in e&&(a.set("Triggers",e.Triggers),delete e.Triggers),e){var r={};["Planning Time","Execution Time"].forEach((function(t){t in e&&(r[t]=e[t])})),a.set("Summary",r)}return e&&"Settings"in e&&(a.set("Settings",e.Settings),delete e.Settings),e},toJSON:function(){var e=o.Model.prototype.toJSON.apply(this,arguments);return e.Plan&&(e.Plan=e.Plan.toJSON()),e},draw:function(e,t,n,a,i,r){var o=e.g(),s=getComputedStyle(document.documentElement).getPropertyValue("--color-bg");o.rect(0,0,this.get("width")-10,this.get("height")-10,5).attr({fill:s}),this.get("Plan").draw(o,t,n,void 0,void 0,a,i,r),this.get("Statistics").set_statistics(i)}});return i.extend(f,{DrawJSONPlan:function(t,a,i,r){var o=this;n.e(15).then(function(s){(function(e){e=n(214);(u=e).plugin((function(e,t,n){n.prototype.multitext=function(t,n,a,i,r){var o=e(),s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",l=o.text(0,0,s);l.attr(r);var d=l.getBBox().width/s.length,c=Math.round(i/d)-1;o.remove();for(var u=a.split(" "),f=0,p=[],h="",_=function e(t,n,a){var r=a.length,o=[];return 0==r||(n&&n+r*d>i?(o.push(t),o=o.concat(e("",0,a))):n?o.push(t+" "+a):(t&&o.push(t),a.length>c+1?o.push(a.slice(0,c)+"-"):o.push(a),o=o.concat(e("",0,a.slice(c))))),o},g=0;g<u.length;g++){var m=_(h,f,u[g]);h&&(p=p.slice(0,p.length-1)),f=(h=(p=p.concat(m))[p.length-1]).length*d}var b=this.text(t,n,p).attr(r);return b.selectAll("tspan:nth-child(n+2)").attr({dy:"1.2em",x:t}),b}})),o.goForDraw(t,a,i,r)}).call(this,n(135)(e))}.bind(null,n)).catch((function(e){throw e}))},goForDraw:function(e,t,n,o){var d=i.extend(o||{},{totalNodes:0,totalDownloadedNodes:0,isDownloaded:0});e.empty().attr("el","sm").addClass("pg-no-overflow pg-el-container");var h=function e(){var t=e.cnt=(e.cnt||0)+1,n=function(e,n,a,i){return['   <li class="nav-item" role="presentation">','    <a class="nav-link ',i?"active":"",'"','       data-toggle="tab" tabindex="0"','       data-tab-index="'.concat(e,'"'),'       aria-selected="',i?"true":"false",'"','       role="tab" data-explain-role="'.concat(n,'"'),'       href="#pga_explain_'.concat(n,"_").concat(t,'"'),'       aria-controls="pga_explain_'.concat(n,"_").concat(t,'"'),'       id="pgah_explain_'.concat(n,"_").concat(t,'"> '),a,"</a>","</li>"].join("")},i=function(e,n,a){return['   <div role="tabpanel" tabindex="0" class="tab-pane pg-el-sm-12',"        pg-el-md-12 pg-el-lg-12 pg-el-12 fade collapse",n?" active show":""," ".concat(a,'"'),'        data-explain-tabpanel="'.concat(e,'"'),'        id="pga_explain_'.concat(e,"_").concat(t,'"'),'        aria-labelledby="pgah_explain_'.concat(e,"_").concat(t,'">'),"   </div>"].join("")};return a(['<div class="obj_properties container-fluid">',' <div tabindex="1" class="backform-tab pg-el-12" role="tabpanel">','  <ul class="nav nav-tabs" role="tablist">',"   </li>",'   <li class="nav-item" role="presentation">',n(1,"graphical",c("Graphical"),!0),n(2,"table",c("Analysis"),!1),n(3,"statistics",c("Statistics"),!1),"  </ul>",'  <div class="tab-content pg-el-sm-12 pg-el-12">',i("graphical",!0,"w-100 h-100 p-0"),i("table",!1,"p-0"),i("statistics",!1,""),"   </div>","  </div>"," </div>","</div>"].join(""))}(),_=a(['<table class="backgrid table presentation table-bordered ','       table-noouter-border table-hover">'," <thead>","  <tr>",'    <th class="renderable pga-ex-collapsible" rowspan="2"></th>','    <th class="renderable" rowspan="2"><button disabled>',c("#"),"</button></th>",'    <th class="renderable" rowspan="2"><button disabled>',c("Node"),"</button></th>",'    <th class="renderable timings d-none" colspan="2"><button disabled>',c("Timings"),"</button></th>",'    <th class="renderable rowsx rows plan_rows d-none" colspan="3">',"<button disabled>",c("Rows"),"</button></th>",'    <th class="renderable rows rowsx d-none" rowspan="2">',"<button disabled>",c("Loops"),"</button></th>",'    <th class="renderable d-none" rowspan="2"><button disabled>',"  </tr>","  <tr>",'    <th class="renderable timings d-none"><button disabled>',c("Exclusive"),"</button></th>",'    <th class="renderable timings d-none"><button disabled>',c("Inclusive"),"</button></th>",'    <th class="renderable rowsx d-none"><button disabled>',c("Rows X"),"</button></th>",'    <th class="renderable rows rowsx d-none"><button disabled>',c("Actual"),"</button></th>",'    <th class="renderable plan_rows rowsx d-none"><button disabled>',c("Plan"),"</button></th>","  </tr>"," </thead>","</table>"].join("")),b=a(['<div class="row row-eq-height">',' <div class="col-sm-6 col-xs-6">','  <div class="col-xs-12 badge">',c("Statistics per Node Type"),"  </div>",'  <table class="backgrid table presentation table-bordered ','         table-hover" for="per_node_type">',"   <thead>","    <tr>",'      <th class="renderable"><button disabled>',c("Node type"),"</button></th>",'      <th class="renderable"><button disabled>',c("Count"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("Time spent"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("%% of query"),"</button></th>","    </tr>","   </thead>","  </table>"," </div>",' <div class="col-sm-6 col-xs-6">','  <div class="col-xs-12 badge">',c("Statistics per Table"),"  </div>",'  <table class="backgrid table presentation table-bordered ','         table-hover" for="per_table">',"   <thead>","    <tr>",'      <th class="renderable"><button disabled>',c("Table name"),"</button></th>",'      <th class="renderable"><button disabled>',c("Scan count"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("Total time"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("%% of query"),"</button></th>","    </tr>","    <tr>",'      <th class="renderable"><button disabled>',c("Node type"),"</button></th>",'      <th class="renderable"><button disabled>',c("Count"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("Sum of times"),"</button></th>",'      <th class="renderable timings d-none"><button disabled>',c("%% of table"),"</button></th>","    </tr>","   </thead>","  </table>"," </div>","</div>"].join("")),v=h.find("[data-explain-tabpanel=graphical]"),y=h.find("[data-explain-tabpanel=table]");d.currentTab=e.find(".nav-link[aria-selected=true]").attr("data-explain-role"),h.appendTo(e),_.appendTo(y),b.appendTo(h.find("[data-explain-tabpanel=statistics]"));var w=a.extend(!0,[],t),x=1,C=a("<div></div>",{class:"pg-explain-zoom-area btn-group btn-group-sm",role:"group"}).appendTo(v),S=a("<button></button>",{class:"btn btn-primary-icon pg-explain-zoom-btn",title:c("Zoom in"),"aria-label":c("Zoom in"),tabindex:0}).appendTo(C).append(a("<i></i>",{class:"fa fa-search-plus"})),k=a("<button></button>",{class:"btn btn-primary-icon pg-explain-zoom-btn",title:c("Zoom to original"),"aria-label":c("Zoom to original"),tabindex:0}).appendTo(C).append(a("<i></i>",{class:"fa fa-arrows-alt"})),T=a("<button></button>",{class:"btn btn-primary-icon pg-explain-zoom-btn",title:c("Zoom out"),"aria-label":c("Zoom out"),tabindex:0}).appendTo(C).append(a("<i></i>",{class:"fa fa-search-minus"})),E=a("<div></div>",{class:"pg-explain-download-area btn-group btn-group-sm",role:"group"}).appendTo(v),q=a("<button></button>",{id:"btn-explain-download",class:"btn btn-primary-icon pg-explain-download-btn",title:c("Download"),"aria-label":c("Download"),tabindex:0,disabled:function(){var e=r.Browser.get_browser();return"IE"===e.name?(this.title="Not supported for Internet Explorer",!0):"Safari"===e.name&&parseInt(e.version)<10&&(this.title="Not supported for Safari version less than 10.1",!0)}}).appendTo(E).append(a("<i></i>",{class:"fa fa-download"})),O=a("<div></div>",{class:"pg-explain-stats-area btn-group btn-group-sm d-none",role:"group"}).appendTo(v);a("<button></button>",{id:"btn-explain-stats",class:"btn btn-primary-icon pg-explain-stats-btn",title:c("Statistics"),"aria-label":c("Statistics"),tabindex:0}).appendTo(O).append(a("<i></i>",{class:"fa fa-chart-line"}));var P=a("<div></div>",{class:"pgadmin-explain-container w-100 h-100 overflow-auto"}).appendTo(v),D=a("<div></div>",{id:"toolTip",class:"pgadmin-explain-tooltip"}).appendTo(v);D.empty(),P.data("zoom-factor",x);var N,j,M,R=0,A=25;d._explainTable={rows:[],statistics:{tables:{},nodes:{}}},d._onImageDownloaded=function(){if(d.totalDownloadedNodes++,!d.isDownloaded&&d.totalNodes===d.totalDownloadedNodes){d.isDownloaded=!0;var e=u("#".concat(v.attr("id")," .pgadmin-explain-container svg")),t="explain_plan_"+(new Date).getTime()+".svg";l.downloadSVG(e.toString(),t)}},i.each(t,(function(t){var i;n?i=new(m.extend({initialize:function(){this.set("Plan",new g({parse:!0})),this.set("Statistics",new s)}}))({parse:!0}):i=new m;i.set(i.parse(t,{ctx:d})),R=i.get("width"),A=i.get("height");var r=u(R,A),o=a(r.node).detach();P.append(o),i.draw(r,R-25,25,P,D,d);var c=P.width();if(c<R){x=(x=(x=c/R)<.01?.01:x)>1?1:x;var p=new u.matrix;p.scale(x,x),o.find("g").first().attr({transform:p}),o.attr({width:R*x,height:A*x}),P.data("zoom-factor",x)}S.on("click",(function(){x=x+.05>2?2:x+.05;var e=new u.matrix;e.scale(x,x),o.find("g").first().attr({transform:e}),o.attr({width:R*x,height:A*x}),P.data("zoom-factor",x)})),T.on("click",(function(){x=x-.05<.01?.01:x-.05;var e=new u.matrix;e.scale(x,x),o.find("g").first().attr({transform:e}),o.attr({width:R*x,height:A*x}),P.data("zoom-factor",x)})),k.on("click",(function(){x=1;var e=new u.matrix;e.scale(x,x),o.find("g").first().attr({transform:e}),o.attr({width:R*x,height:A*x}),P.data("zoom-factor",x)})),q.on("click",(function(){f.DrawJSONPlan(e,w,!0),P.on("explain:svg:downloaded",(function(){if(d.totalDownloadedNodes++,!d.isDownloaded&&d.totalNodes===d.totalDownloadedNodes){d.isDownloaded=!0;var e=u(".pgadmin-explain-container svg"),t="explain_plan_"+(new Date).getTime()+".svg";l.downloadSVG(e.toString(),t)}}))}))})),N=d._explainTable,j=_,M=a("<tbody></tbody>"),i.each(N.rows,(function(e){a(e).appendTo(M)})),M.appendTo(j),!0===N.show_timings&&j.find(".timings").removeClass("d-none"),!0===N.show_rowsx?j.find(".rowsx").removeClass("d-none"):!0===N.show_rows?(j.find(".rows").removeClass("d-none"),j.find("thead .rows[colspan=3]").attr("colspan",1)):!0===N.show_plan_rows&&(j.find(".plan_rows").removeClass("d-none"),j.find("thead .rows[colspan=3]").attr("colspan",1)),function(e,t){var n=t.find('table[for="per_table"]'),a=t.find('table[for="per_node_type"]');i.each(i.sortBy(i.values(e.statistics.nodes),"name"),(function(t){return a.append(p({data:t,total_time:e.total_time,className:""}))})),i.each(i.sortBy(i.values(e.statistics.tables),"name"),(function(t){t.sum_of_times=0,i.each(t.nodes,(function(e){return t.sum_of_times+=e.sum_of_times})),n.append(p({data:t,total_time:e.total_time,className:"table"})),i.each(i.sortBy(i.values(t.nodes),"name"),(function(e){n.append(p({data:e,total_time:t.sum_of_times,className:"node"}))}))})),e.show_timings&&t.find(".timings").removeClass("d-none")}(d._explainTable,b),e.on("shown.bs.tab",(function(){d.currentTab=e.find(".nav-link[aria-selected=true]").attr("data-explain-role")}))}}),a(document).on("mouseenter",".pga-ex-row.pga-ex-collapsible",(function(e){var t=a(e.currentTarget);t.parent().find("[data-parent="+t.attr("data-ex-id")+"] > td.pg-ex-highlighter > i").removeClass("invisible")})).on("mouseleave",".pga-ex-row.pga-ex-collapsible",(function(e){var t=a(e.currentTarget);t.parent().find(".pga-ex-row[data-parent="+t.attr("data-ex-id")+"] > td.pg-ex-highlighter > i").addClass("invisible")})).on("click",".pga-ex-row.pga-ex-collapsible",(function(e){var t=a(e.currentTarget);"true"===t.attr("data-collapsed")?(t.parent().find(".pga-ex-row[data-parent^="+t.attr("data-ex-id")+"]").removeClass("d-none").filter("[data-collapsed=true]").each((function(e,t){var n=a(t);n.parent().find(".pga-ex-row[data-parent^="+n.attr("data-ex-id")+"]").addClass("d-none")})),t.attr("data-collapsed","false")):(t.parent().find(".pga-ex-row[data-parent^="+t.attr("data-ex-id")+"]").addClass("d-none"),t.attr("data-collapsed","true"))})),f}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";(function(t){n(31),n(43);var a=o(n(0)),i=o(n(20)),r=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}var s=i.default.Model.extend({defaults:{JIT:[],Triggers:[],Summary:{}},set_statistics:function(e){var n=this.get("JIT"),i=this.get("Triggers"),o=this.get("Summary");(Object.keys(n).length>0||Object.keys(i).length>0||Object.keys(o).length>0)&&(0,a.default)(".pg-explain-stats-area").removeClass("d-none");var s=(0,a.default)("<table></table>",{class:"pgadmin-tooltip-table"});Object.keys(n).length>0&&(s.append('<tr><td class="label explain-tooltip">'+(0,r.default)("JIT:")+"</td></tr>"),t.each(n,(function(e,n){n=t.escape(n),e=t.escape(e),s.append('\n          <tr>\n            <td class="label explain-tooltip">  '.concat(n,'</td>\n            <td class="label explain-tooltip-val">').concat(e,"</td>\n          </tr>\n        "))}))),Object.keys(i).length>0&&(s.append('<tr><td class="label explain-tooltip">'+(0,r.default)("Triggers:")+"</td></tr>"),t.each(i,(function(e,n){e instanceof Object?t.each(e,(function(e,n){"Trigger Name"===n?(n=t.escape(n),e=t.escape(e),s.append('\n                <tr>\n                  <td class="label explain-tooltip">  '.concat(n,'</td>\n                  <td class="label explain-tooltip-val">').concat(e,"</td>\n                </tr>\n              "))):(n=t.escape(n),e=t.escape(e),s.append('\n                <tr>\n                  <td class="label explain-tooltip">    '.concat(n,'</td>\n                  <td class="label explain-tooltip-val">').concat(e,"</td>\n                </tr>\n              ")))})):(n=t.escape(n),e=t.escape(e),s.append('\n            <tr>\n              <td class="label explain-tooltip">  '.concat(n,'</td>\n              <td class="label explain-tooltip-val">').concat(e,"</td>\n            </tr>\n          ")))}))),Object.keys(o).length>0&&(s.append('<tr><td class="label explain-tooltip">'+(0,r.default)("Summary:")+"</td></tr>"),t.each(o,(function(e,n){n=t.escape(n),e=t.escape(e),s.append('\n          <tr>\n            <td class="label explain-tooltip">  '.concat(n,'</td>\n            <td class="label explain-tooltip-val">').concat(e,"</td>\n          </tr>\n        "))}))),(0,a.default)(".pg-explain-stats-area").off("mouseover").on("mouseover",(function(){0==Object.keys(n).length&&0==Object.keys(i).length&&0==Object.keys(o).length||(e.empty(),e.append(s),e.css({opacity:"0.8",left:"",right:"65px",top:"15px"}),(0,a.default)(".pgadmin-explain-tooltip").css("padding","5px"),(0,a.default)(".pgadmin-explain-tooltip").css("border","1px solid white"))})),(0,a.default)(".pg-explain-stats-area").off("mouseout").on("mouseout",(function(){e.empty(),e.css({opacity:"0",left:0,top:0,right:""})}))}});e.exports=s}).call(this,n(1))},function(e,t,n){"use strict";n(14),n(3),n(12),n(5),n(19),n(9),n(16),n(179),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={blobURL:function(e,t){var n=new Blob([e],{type:t});return(window.URL||window.webkitURL).createObjectURL(n)},downloadSVG:function(e,t){e=e.replace(/NS\d+:href/gi,"xlink:href");var n=this.blobURL(e,"image/svg+xml"),a=document.createElement("a");a.href=n,a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a)}};t.default=a},function(e,t,n){"use strict";n(3),n(83),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={Aggregate:{image:"ex_aggregate.svg",image_text:"Aggregate"},Append:{image:"ex_append.svg",image_text:"Append"},"Bitmap Index Scan":function(e){return{image:"ex_bmp_index.svg",image_text:e["Index Name"]}},"Bitmap Heap Scan":function(e){return{image:"ex_bmp_heap.svg",image_text:e["Relation Name"]}},BitmapAnd:{image:"ex_bmp_and.svg",image_text:"Bitmap AND"},BitmapOr:{image:"ex_bmp_or.svg",image_text:"Bitmap OR"},"CTE Scan":{image:"ex_cte_scan.svg",image_text:"CTE Scan"},"Function Scan":{image:"ex_result.svg",image_text:"Function Scan"},"Foreign Scan":{image:"ex_foreign_scan.svg",image_text:"Foreign Scan"},Gather:{image:"ex_gather_motion.svg",image_text:"Gather"},"Gather Merge":{image:"ex_gather_merge.svg",image_text:"Gather Merge"},Group:{image:"ex_group.svg",image_text:"Group"},GroupAggregate:{image:"ex_aggregate.svg",image_text:"Group Aggregate"},Hash:{image:"ex_hash.svg",image_text:"Hash"},"Hash Join":function(e){if(!e["Join Type"])return{image:"ex_join.svg",image_text:"Join"};switch(e["Join Type"]){case"Anti":return{image:"ex_hash_anti_join.svg",image_text:"Hash Anti Join"};case"Semi":return{image:"ex_hash_semi_join.svg",image_text:"Hash Semi Join"};default:return{image:"ex_hash.svg",image_text:String("Hash "+e["Join Type"]+" Join")}}},HashAggregate:{image:"ex_aggregate.svg",image_text:"Hash Aggregate"},"Index Only Scan":function(e){return{image:"ex_index_only_scan.svg",image_text:e["Index Name"]}},"Index Scan":function(e){return{image:"ex_index_scan.svg",image_text:e["Index Name"]}},"Index Scan Backword":{image:"ex_index_scan.svg",image_text:"Index Backward Scan"},Limit:{image:"ex_limit.svg",image_text:"Limit"},LockRows:{image:"ex_lock_rows.svg",image_text:"Lock Rows"},Materialize:{image:"ex_materialize.svg",image_text:"Materialize"},"Merge Append":{image:"ex_merge_append.svg",image_text:"Merge Append"},"Merge Join":function(e){switch(e["Join Type"]){case"Anti":return{image:"ex_merge_anti_join.svg",image_text:"Merge Anti Join"};case"Semi":return{image:"ex_merge_semi_join.svg",image_text:"Merge Semi Join"};default:return{image:"ex_merge.svg",image_text:String("Merge "+e["Join Type"]+" Join")}}},ModifyTable:function(e){switch(e.Operation){case"Insert":return{image:"ex_insert.svg",image_text:"Insert"};case"Update":return{image:"ex_update.svg",image_text:"Update"};case"Delete":return{image:"ex_delete.svg",image_text:"Delete"}}},"Named Tuplestore Scan":{image:"ex_named_tuplestore_scan.svg",image_text:"Named Tuplestore Scan"},"Nested Loop":function(e){switch(e["Join Type"]){case"Anti":return{image:"ex_nested_loop_anti_join.svg",image_text:"Nested Loop Anti Join"};case"Semi":return{image:"ex_nested_loop_semi_join.svg",image_text:"Nested Loop Semi Join"};default:return{image:"ex_nested.svg",image_text:"Nested Loop "+e["Join Type"]+" Join"}}},ProjectSet:{image:"ex_projectset.svg",image_text:"ProjectSet"},"Recursive Union":{image:"ex_recursive_union.svg",image_text:"Recursive Union"},Result:{image:"ex_result.svg",image_text:"Result"},"Sample Scan":{image:"ex_scan.svg",image_text:"Sample Scan"},Scan:{image:"ex_scan.svg",image_text:"Scan"},Seek:{image:"ex_seek.svg",image_text:"Seek"},SetOp:function(e){var t=e.Strategy,n=e.Command;return"Hashed"==t?n.startsWith("Intersect")?"Intersect All"==n?{image:"ex_hash_setop_intersect_all.svg",image_text:"Hashed Intersect All"}:{image:"ex_hash_setop_intersect.svg",image_text:"Hashed Intersect"}:n.startsWith("Except")?"Except All"==n?{image:"ex_hash_setop_except_all.svg",image_text:"Hashed Except All"}:{image:"ex_hash_setop_except.svg",image_text:"Hash Except"}:{image:"ex_hash_setop_unknown.svg",image_text:"Hashed SetOp Unknown"}:{image:"ex_setop.svg",image_text:"SetOp"}},"Seq Scan":function(e){return{image:"ex_scan.svg",image_text:e["Relation Name"]}},"Subquery Scan":{image:"ex_subplan.svg",image_text:"SubQuery Scan"},Sort:{image:"ex_sort.svg",image_text:"Sort"},"Tid Scan":{image:"ex_tid_scan.svg",image_text:"Tid Scan"},"Table Function Scan":{image:"ex_table_func_scan.svg",image_text:"Table Function Scan"},Unique:{image:"ex_unique.svg",image_text:"Unique"},"Values Scan":{image:"ex_values_scan.svg",image_text:"Values Scan"},WindowAgg:{image:"ex_window_aggregate.svg",image_text:"Window Aggregate"},"WorkTable Scan":{image:"ex_worktable_scan.svg",image_text:"WorkTable Scan"},Undefined:{image:"ex_unknown.svg",image_text:"Undefined"}};t.default=a},function(e,t,n){"use strict";var a,i;n(18),n(10),a=[n(0),n(2),n(180),n(309),n(58),n(6)],void 0===(i=function(e,t,n,a,i,r){return function(o){var s=window.Slick,l=new a(o),d=new n(o),c=new s.Event,u=new s.Event,f=d.onBeforeColumnSelectAll,p=d.onColumnSelectAll;function h(t){i.isEntireGridSelected(t)?e("[data-id='select-all']").addClass("selected"):e("[data-id='select-all']").removeClass("selected")}e.extend(this,{init:function(t){this.grid=t,t.onHeaderClick.subscribe((function(n,a){a.column.selectAllOnClick&&!e(n.target).hasClass("slick-resizable-handle")&&function(e,t,n){i.isEntireGridSelected(e)?function(e){e.getSelectionModel().setSelectedRanges([])}(e):(c.notify(n,t),t.isPropagationStopped()||t.isImmediatePropagationStopped()||i.selectAll(e))}(t,n,a)})),t.getSelectionModel().onSelectedRangesChanged.subscribe(h.bind(null,t)),t.registerPlugin(l),t.registerPlugin(d),u.subscribe((function(e,t){i.selectAll(t.grid)}))},getColumnDefinitions:function(e){return e=d.getColumnDefinitions(e),(e=l.getColumnDefinitions(e))[0].selectAllOnClick=!0,e[0].name='<span data-id="select-all" title="'+t("Select/Deselect All")+'"><br>'+e[0].name+'<img class="select-all-icon" src="'+r("static",{filename:"img/select-all-icon.png"})+'"></img></span>',e},onBeforeGridSelectAll:c,onGridSelectAll:u,onBeforeGridColumnSelectAll:f,onGridColumnSelectAll:p})}}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";var a,i;n(8),n(18),n(36),a=[n(0),n(58),n(180),n(107)],void 0===(i=function(e,t,n){return function(){var a=new window.Slick.EventHandler,i=new n,r=function(t,n,a){if("row-header-column"===t.getColumns()[a.cell].id){var r=e(n.target);"row-header-selector"!=r.data("cell-type")&&(r=e(n.target).find('[data-cell-type="row-header-selector"]')),r.parent().toggleClass("selected"),s(t,a.row),i.toggleColumnHeaderForCopyHeader(t)}},o=function(t,n,a){e('[data-cell-type="row-header-selector"]').each((function(n,i){var r=e(i),o=parseInt(r.data("row"));l(t,a,o)?r.parent().addClass("selected"):r.parent().removeClass("selected")}))},s=function(e,n){var a,i=e.getSelectionModel(),r=i.getSelectedRanges(),o=t.rangeForRow(e,n);a=t.isRangeSelected(r,o)?t.removeRange(r,o):t.areAllRangesSingleRows(r,e)?t.addRange(r,o):[o],i.setSelectedRanges(a)},l=function(e,n,a){var i=t.areAllRangesCompleteColumns(e,n);return function(e,n,a){var i=t.isRangeEntirelyWithinSelectedRanges(n,t.rangeForRow(e,a)),r=t.isAnyCellOfRowSelected(n,a);return i||r}(e,n,a)&&!i};e.extend(this,{init:function(e){e.getSelectionModel().onSelectedRangesChanged.subscribe(o.bind(null,e)),a.subscribe(e.onClick,r.bind(null,e))},getColumnDefinitions:function(e){return e.unshift({id:"row-header-column",name:"",selectable:!1,focusable:!1,formatter:function(e){return'<span data-row="'+e+'" data-cell-type="row-header-selector">'+(e+1)+"</span>"},width:30}),e}})}}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";var a,i;a=[n(0),n(58)],void 0===(i=function(e,t){return function(){var n,a=!1,i=!1,r=!1;function o(e,t){a=!0,n.setActiveCell(t.range.start.row,t.range.start.cell)}function s(o,s){if(r&&i)return i=!1,void o.stopPropagation();if(!e(o.target).hasClass("slick-resizable-handle")){a=!0;var l=s.column.pos+1;h(0,l)?_()?n.resetActiveCell():n.setActiveCell(0,g().fromCell):function(e){var a=t.rangeForColumn(n,e),i=n.getSelectionModel().getSelectedRanges();return t.isRangeSelected(i,a)}(l)||n.setActiveCell(0,l)}}function l(){r=!1}function d(){r=!0,i=!1}function c(){i=!0}function u(e,i){if(o=i.cell,"row-header-column"===n.getColumns()[o].id){a=!0;var r=i.row;if(r>=n.getDataLength())return;h(r,1)?_()?n.resetActiveCell():n.setActiveCell(g().fromRow,1):function(e){var a=t.rangeForRow(n,e),i=n.getSelectionModel().getSelectedRanges();return t.isRangeSelected(i,a)}(r)||n.setActiveCell(r,1)}var o}function f(e){a&&(a=!1,e.stopPropagation())}function p(e){var t,a;m()&&function(e){return function(e){return e.shiftKey&&!e.ctrlKey&&!e.altKey}(e)&&function(e){return 39===e.which||38===e.which||37===e.which||40===e.which}(e)}(e)&&(t=n.getSelectionModel(),(a=t.getSelectedRanges()).length>1&&t.setSelectedRanges([a.pop()]))}function h(e,t){return m()&&n.getActiveCell().row===e&&n.getActiveCell().cell===t}function _(){return 1===n.getSelectionModel().getSelectedRanges().length}function g(){var e=n.getSelectionModel().getSelectedRanges();return e[e.length-2]}function m(){return!!n.getActiveCell()}e.extend(this,{init:function(e){(n=e).onDragEnd.subscribe(o),n.onHeaderClick.subscribe(s),n.onClick.subscribe(u),n.onActiveCellChanged.subscribe(f),n.onKeyDown.subscribe(p),n.onHeaderMouseEnter.subscribe(d),n.onHeaderMouseLeave.subscribe(l),n.onColumnsResized.subscribe(c)},destroy:function(){n.onDragEnd.unsubscribe(o),n.onHeaderClick.unsubscribe(s),n.onActiveCellChanged.unsubscribe(f),n.onKeyDown.unsubscribe(p),n.onHeaderMouseEnter.unsubscribe(d),n.onHeaderMouseLeave.unsubscribe(l),n.onColumnsResized.unsubscribe(c)}})}}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";(function(a){var i,r;n(40),n(23),n(35),n(94),n(27),n(18),n(12),n(5),n(29),n(9),n(46),i=[n(58),n(312)],void 0===(r=function(e,t){return{getUnion:function(e){if(a.isEmpty(e))return[];e.sort((function(e,t){return e[0]-t[0]}));var t=[e[0]];return e.forEach((function(e){var n=a.last(t);!function(e,t){return e[0]<=t[1]+1}(e,n)?t.push(e):function(e,t){return e[1]<=t[1]}(e,n)||(n[1]=e[1])})),t},mapDimensionBoundaryUnion:function(e,t){var n=[];return e.forEach((function(e){for(var a=e[0];a<=e[1];a+=1)n.push(t(a))})),n},mapOver2DArray:function(e,t,n,a){var i=this.getUnion(e),r=this.getUnion(t);return this.mapDimensionBoundaryUnion(i,function(e){var t=this.mapDimensionBoundaryUnion(r,(function(t){return n(e,t)}));return a(t)}.bind(this))},getHeaderData:function(e,t){var n=[],i=t.field_separator||"\t",r=t.quote_char||'"';return a.each(e,(function(e){e.display_name&&e.selected&&n.push(r+e.display_name+r)})),n.join(i)},rangesToCsv:function(t,n,a,i,r){var o=a.map((function(e){return[e.fromRow,e.toRow]})),s=a.map((function(e){return[e.fromCell,e.toCell]}));e.isFirstColumnData(n)||(s=this.removeFirstColumn(s));var l=this.mapOver2DArray(o,s,this.csvCell.bind(this,t,n,i),(function(e){var t=i.field_separator||"\t";return e.join(t)}));if(r){return this.getHeaderData(n,i)+"\n"+l.join("\n")}return l.join("\n")},removeFirstColumn:function(e){var t=this.getUnion(e);if(0==t.length)return[];return 0==t[0][0]&&(0==t[0][1]?t.shift():t[0][0]=1),t},csvCell:function(e,n,i,r,o){var s=e[r][n[o].field],l=n[o].cell||"",d=i.quoting||"strings",c=i.quote_char||'"',u=function(e){return'"'==c?e.replace(/\"/g,'""'):e.replace(/\'/g,"''")};return"all"==d?s&&a.isObject(s)?s=c+t.stringify(s)+c:s?s=c+u(s.toString())+c:(a.isNull(s)||a.isUndefined(s))&&(s=""):"strings"==d&&(s&&a.isObject(s)?s=c+t.stringify(s)+c:s&&"number"!=l&&"boolean"!=l?s=c+u(s.toString())+c:(a.isNull(s)||a.isUndefined(s))&&(s="")),s}}}.apply(t,i))||(e.exports=r)}).call(this,n(1))},,function(e,t,n){"use strict";var a,i;a=[n(0),n(1),n(58),n(39),n(107)],void 0===(i=function(e,t,n,a){return function(i){var r,o,s=window.Slick,l=[],d=this,c=new s.CellRangeSelector({selectionCss:{border:"2px solid black"},offset:{top:0,left:-1,height:2,width:1}}),u={selectActiveCell:!0};function f(e){for(var t=[],n=0;n<e.length;n++){var a=e[n];r.canCellBeSelected(a.fromRow,a.fromCell)&&r.canCellBeSelected(a.toRow,a.toCell)&&t.push(a)}return t}function p(e){(l&&0!==l.length||e&&0!==e.length)&&(l=f(e),d.onSelectedRangesChanged.notify(l))}function h(){return l}function _(e){if(r.getEditorLock().isActive())return e.stopPropagation(),!1}function g(e,t){p([t.range])}function m(e,t){o.selectActiveCell&&null!=t.row&&null!=t.cell&&p([new s.Range(t.row,t.cell)])}function b(e){var t,n,a,i,o,l,d,c,u,_,g,m,b=r.getActiveCell();function v(t){return e.which===t}if(b&&((m=e).shiftKey&&!m.ctrlKey&&!m.altKey&&function(e){return 39==e.which||37==e.which||38==e.which||40==e.which}(m))){(t=h()).length||t.push(new s.Range(b.row,b.cell)),(n=t.pop()).contains(b.row,b.cell)||(n=new s.Range(b.row,b.cell));var y=(_=b,(g={}).row=(u=n).fromRow===_.row?u.toRow:u.fromRow,g.cell=u.fromCell===_.cell?u.toCell:u.fromCell,g);switch(e.which){case 37:y.cell-=1;break;case 39:y.cell+=1;break;case 38:y.row-=1;break;case 40:y.row+=1}var w=(i=y,o=(a=b).cell<=i.cell?a.cell:i.cell,l=a.cell<=i.cell?i.cell:a.cell,d=a.row<=i.row?a.row:i.row,c=a.row<=i.row?i.row:a.row,new s.Range(d,o,c,l));if(f([w]).length){var x=b.row===w.fromRow?w.toRow:w.fromRow,C=b.cell===w.fromCell?w.toCell:w.fromCell;v(39)||v(37)?r.scrollColumnIntoView(C):(v(38)||v(40))&&r.scrollRowIntoView(x),t.push(w)}else t.push(n);p(t),e.preventDefault(),e.stopPropagation()}}function v(){var e=c.getCurrentRange();t.isUndefined(e)||r.onDragEnd.notify({range:e})}e.extend(this,{getSelectedRanges:h,setSelectedRanges:p,setSelectedRows:function(e){l=[];for(var t=0;t<e.length;t++)l.push(n.rangeForRow(r,e[t]))},init:function(t){o=e.extend(!0,{},u,i),(r=t).onActiveCellChanged.subscribe(m),r.onKeyDown.subscribe(b),t.registerPlugin(c),c.onCellRangeSelected.subscribe(g),c.onBeforeCellRangeSelected.subscribe(_),e(a.default).on("mouseup",v)},destroy:function(){r.onActiveCellChanged.unsubscribe(m),r.onKeyDown.unsubscribe(b),c.onCellRangeSelected.unsubscribe(g),c.onBeforeCellRangeSelected.unsubscribe(_),r.unregisterPlugin(c),e(a.default).off("mouseup",v)},onSelectedRangesChanged:new s.Event})}}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";var a,i;n(8),n(14),n(212),n(12),n(16),a=[n(0),n(1),n(58)],void 0===(i=function(e,t,n){function a(t){e(t).prop("disabled",!0)}function i(t){e(t).prop("disabled",!1)}function r(e,n,a,i){return t.reduce(e,(function(e,r){var o=a.getItem(r);return function(e,n){if(t.isUndefined(e))return!0;return!t.isUndefined(t.find(n,(function(n){return t.isUndefined(e[n])})))}(o,n)||(e[o[i]]=function(e,n){var a={};e&&e.length&&t.each(t.keys(n),(function(i){t.contains(e,i)&&(a[i]=n[i])}));return a}(n,o)),e}),{})}return function(){var e=this;function o(t){e.editor.handler.data_store.staged_rows=t}if(a("#btn-delete-row"),a("#btn-copy-row"),this.selection.getSelectedRanges().length>0&&i("#btn-copy-row"),n.areAllRangesCompleteRows(e.grid,e.selection.getSelectedRanges())){var s=n.getIndexesOfCompleteRows(this.grid,this.selection.getSelectedRanges()),l=function(e,n){var a=e.grid.getData();return r(n,t.keys(e.keys),a,e.client_primary_key)}(e,s);o(l),t.isEmpty(l)&&this.selection.setSelectedRows([]),e.editor.handler.can_edit&&!t.isEmpty(l)&&i("#btn-delete-row")}else o({})}}.apply(t,a))||(e.exports=i)},function(e,t,n){"use strict";(function(t){n(21),n(24),n(25),n(14),n(27),n(3),n(34),n(12),n(19),n(44),n(16),n(7);var a=u(n(2)),i=u(n(0)),r=u(n(6)),o=u(n(54)),s=c(n(126)),l=c(n(181));function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!==f(e)&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=a?Object.getOwnPropertyDescriptor(e,i):null;r&&(r.get||r.set)?Object.defineProperty(n,i,r):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}function u(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}var g=function(){function e(t){p(this,e),this.sqlEditor=t}return _(e,[{key:"setMessage",value:function(e){this.sqlEditor.trigger("pgadmin-sqleditor:loading-icon:message",(0,a.default)(e))}},{key:"show",value:function(e){this.sqlEditor.trigger("pgadmin-sqleditor:loading-icon:show",e)}},{key:"hide",value:function(){this.sqlEditor.trigger("pgadmin-sqleditor:loading-icon:hide")}}]),e}(),m=function(){function e(t,n){p(this,e),this.sqlServerObject=t,this.loadingScreen=new g(t),this.userManagement=n}return _(e,[{key:"delayedPoll",value:function(){var e=this;setTimeout((function(){e.poll()}),e.sqlServerObject.POLL_FALLBACK_TIME())}},{key:"execute",value:function(t,n,a){if(!(t.length<=0)){var i=this;i.explainPlan=n;var r=e.prepareAnalyzeSql(t,n);i.initializeExecutionOnSqlEditor(r),o.default.post(this.generateURLReconnectionFlag(a),JSON.stringify(r),{headers:{"Content-Type":"application/json"}}).then((function(t){var n=t.data;i.removeGridViewMarker(),i.updateSqlEditorLastTransactionStatus(n.data.transaction_status),e.isSqlCorrect(n)?(i.loadingScreen.setMessage("Waiting for the query to complete..."),i.updateSqlEditorStateWithInformationFromServer(n.data),i.delayedPoll()):(i.loadingScreen.hide(),i.enableSQLEditorButtons(),t.data.data.transaction_status==l.TRANSACTION_STATUS_INTRANS||t.data.data.transaction_status==l.TRANSACTION_STATUS_INERROR?i.enableTransactionButtons():i.disableTransactionButtons(),i.sqlServerObject.update_msg_history(!1,n.data.result),"notifies"in n.data&&i.sqlServerObject.update_notifications(n.data.notifies),i.sqlServerObject._highlight_error(n.data.result))})).catch((function(e){i.onExecuteHTTPError(e)}))}}},{key:"generateURLReconnectionFlag",value:function(e){var t=(0,r.default)("sqleditor.query_tool_start",{trans_id:this.sqlServerObject.transId});return e&&(t+="?connect=1"),t}},{key:"poll",value:function(){var t=this,n=this;o.default.get((0,r.default)("sqleditor.poll",{trans_id:n.sqlServerObject.transId})).then((function(a){n.updateSqlEditorLastTransactionStatus(a.data.data.transaction_status),a.data.data.transaction_status==l.TRANSACTION_STATUS_INTRANS||a.data.data.transaction_status==l.TRANSACTION_STATUS_INERROR?n.enableTransactionButtons():n.disableTransactionButtons(),e.isQueryFinished(a)?(t.sqlServerObject.close_on_idle_transaction&&a.data.data.transaction_status==l.TRANSACTION_STATUS_IDLE&&t.sqlServerObject.check_needed_confirmations_before_closing_panel(),n.loadingScreen.setMessage("Loading data from the database server and rendering..."),n.sqlServerObject.call_render_after_poll(a.data.data),"notifies"in a.data.data&&n.sqlServerObject.update_notifications(a.data.data.notifies)):e.isQueryStillRunning(a)?(t.delayedPoll(),n.sqlServerObject.setIsQueryRunning(!0),a.data.data.result&&n.sqlServerObject.update_msg_history(a.data.data.status,a.data.data.result,!1)):e.isConnectionToServerLostWhilePolling(a)?(n.loadingScreen.hide(),n.sqlServerObject.is_query_tool&&n.enableSQLEditorButtons(),n.sqlServerObject.update_msg_history(!1,a.data.data.result,!0)):e.isQueryCancelled(a)&&(n.loadingScreen.hide(),n.sqlServerObject.update_msg_history(!1,"Execution Cancelled!",!0))})).catch((function(t){if(n.sqlServerObject.resetQueryHistoryObject(n.sqlServerObject),n.loadingScreen.hide(),n.sqlServerObject.setIsQueryRunning(!1),n.sqlServerObject.is_query_tool&&n.enableSQLEditorButtons(),t.response){if(e.wasConnectionLostToPythonServer(t.response))return void n.handleConnectionToServerLost();var a=t.response.data;if(n.userManagement.isPgaLoginRequired(a))return n.userManagement.pgaLogin();var i=e.extractErrorMessage(a);n.sqlServerObject.update_msg_history(!1,i),n.sqlServerObject._highlight_error(i)}else{if(t.request)return void n.handleConnectionToServerLost();console.error(t)}}))}},{key:"initializeExecutionOnSqlEditor",value:function(e){this.loadingScreen.show((0,a.default)("Running query...")),(0,i.default)("#btn-flash").prop("disabled",!0),(0,i.default)("#btn-download").prop("disabled",!0),this.sqlServerObject.query_start_time=new Date,"object"===f(e)?this.sqlServerObject.query=e.sql:this.sqlServerObject.query=e,this.sqlServerObject.rows_affected=0,this.sqlServerObject._init_polling_flags(),this.disableSQLEditorButtons(),this.disableTransactionButtons()}},{key:"onExecuteHTTPError",value:function(t){if(this.loadingScreen.hide(),this.enableSQLEditorButtons(),e.wasConnectionLostToPythonServer(t.response))this.handleConnectionToServerLost();else{if(this.userManagement.isPgaLoginRequired(t.response)&&(this.sqlServerObject.saveState("check_data_changes_to_execute_query",[this.explainPlan]),this.userManagement.pgaLogin()),s.httpResponseRequiresNewTransaction(t.response)&&(this.sqlServerObject.saveState("check_data_changes_to_execute_query",[this.explainPlan]),this.sqlServerObject.initTransaction()),this.wasDatabaseConnectionLost(t)&&(this.sqlServerObject.saveState("check_data_changes_to_execute_query",[this.explainPlan]),this.sqlServerObject.handle_connection_lost(!1,t)),this.isCryptKeyMissing(t))return this.sqlServerObject.saveState("check_data_changes_to_execute_query",[this.explainPlan]),void this.sqlServerObject.handle_cryptkey_missing();var n=t.response.data.errormsg;this.sqlServerObject.update_msg_history(!1,n)}}},{key:"wasDatabaseConnectionLost",value:function(e){return 503===e.response.status&&void 0!==e.response.data.info&&"CONNECTION_LOST"===e.response.data.info}},{key:"isCryptKeyMissing",value:function(e){return 503===e.response.status&&void 0!==e.response.data.info&&"CRYPTKEY_MISSING"===e.response.data.info}},{key:"removeGridViewMarker",value:function(){this.sqlServerObject.gridView.marker&&(this.sqlServerObject.gridView.marker.clear(),delete this.sqlServerObject.gridView.marker,this.sqlServerObject.gridView.marker=null,this.sqlServerObject.gridView.query_tool_obj.removeLineClass(this.sqlServerObject.marked_line_no,"wrap","CodeMirror-activeline-background"))}},{key:"enableSQLEditorButtons",value:function(){this.sqlServerObject.disable_tool_buttons(!1)}},{key:"disableSQLEditorButtons",value:function(){this.sqlServerObject.disable_tool_buttons(!0)}},{key:"enableTransactionButtons",value:function(){this.sqlServerObject.disable_transaction_buttons(!1)}},{key:"disableTransactionButtons",value:function(){this.sqlServerObject.special_sql=void 0,this.sqlServerObject.disable_transaction_buttons(!0)}},{key:"handleConnectionToServerLost",value:function(){this.sqlServerObject.update_msg_history(!1,(0,a.default)("Not connected to the server or the connection to the server has been closed."))}},{key:"updateSqlEditorStateWithInformationFromServer",value:function(e){this.sqlServerObject.can_edit=e.can_edit,this.sqlServerObject.can_filter=e.can_filter,this.sqlServerObject.info_notifier_timeout=e.info_notifier_timeout}},{key:"updateSqlEditorLastTransactionStatus",value:function(e){this.sqlServerObject.last_transaction_status=e}}],[{key:"prepareAnalyzeSql",value:function(e,t){return{sql:e,explain_plan:t}}},{key:"wasConnectionLostToPythonServer",value:function(e){return t.isUndefined(e)||t.isUndefined(e.data)}},{key:"isSqlCorrect",value:function(e){return e.data.status}},{key:"extractErrorMessage",value:function(e){var t=e.errormsg;return void 0!==e.responseJSON&&void 0!==e.responseJSON.errormsg&&(t=e.responseJSON.errormsg),t}},{key:"isQueryFinished",value:function(e){return"Success"===e.data.data.status}},{key:"isQueryStillRunning",value:function(e){return"Busy"===e.data.data.status}},{key:"isQueryCancelled",value:function(e){return"Cancel"===e.data.data.status}},{key:"isConnectionToServerLostWhilePolling",value:function(e){return"NotConnected"===e.data.data.status}}]),e}();e.exports={ExecuteQuery:m}}).call(this,n(1))},function(e,t,n){"use strict";n(8),n(37),n(10),n(7),n(38);var a=f(n(2)),i=f(n(6)),r=f(n(0)),o=f(n(13)),s=f(n(4)),l=f(n(17)),d=f(n(54)),c=f(n(317)),u=n(126);function f(e){return e&&e.__esModule?e:{default:e}}var p=n(182),h={geturl:function(e,t){var n=(0,i.default)("sqleditor.get_filter_data",{trans_id:e});return t&&(n+="?connect=1"),n},dialog:function(e,t){var n=(0,a.default)("Sort/Filter options");r.default.ajax({url:this.geturl(e.transId,t),headers:{"Cache-Control":"no-cache"}}).done((function(t){var u=t.data.result;o.default.filterDialog&&delete o.default.filterDialog,o.default.dialog("filterDialog",(function(){var t=(0,r.default)("<div class='data_sorting_dialog'></div>");return{main:function(){this.set("title",(0,a.default)("Sort/Filter options"))},build:function(){this.elements.content.appendChild(t.get(0)),o.default.pgDialogBuild.apply(this)},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-primary-icon pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:(0,a.default)("Help"),"aria-label":(0,a.default)("Help"),url:(0,i.default)("help.static",{filename:"editgrid.html"})}},{text:(0,a.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times pg-alertify-button","data-btn-name":"cancel"},{text:(0,a.default)("OK"),className:"btn btn-primary fa fa-check pg-alertify-button","data-btn-name":"ok"}],options:{title:n,padding:!1,overflow:!1,model:0,resizable:!0,maximizable:!0,pinnable:!1,closableByDimmer:!1,modal:!1,autoReset:!1}}},hooks:{onclose:function(){this.view&&(this.filterCollectionModel.stopSession(),this.view.model.stopSession(),this.view.remove({data:!0,internal:!0,silent:!0}))}},prepare:function(){var e=this;t.html(""),this.__internal.buttons[2].element.disabled=!0,this.statusBar=(0,r.default)('<div class=\'pg-prop-status-bar pg-el-xs-12 d-none\'>  <div class="error-in-footer">     <div class="d-flex px-2 py-1">       <div class="pr-2">         <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i>       </div>       <div class="alert-text" role="alert"></div>     </div>   </div> </div>').appendTo(t),this.showFilterProgress=(0,r.default)('<div id="show_filter_progress" class="pg-sp-container sql-editor-busy-fetching d-none">\n                  <div class="pg-sp-content">\n                      <div class="row"><div class="col-12 pg-sp-icon sql-editor-busy-icon"></div></div>\n                      <div class="row"><div class="col-12 pg-sp-text sql-editor-busy-text">'+(0,a.default)("Loading data...")+"</div></div>\n                  </div>\n              </div>").appendTo(t),(0,r.default)(e.showFilterProgress[0]).removeClass("d-none"),e.filterCollectionModel=(0,c.default)(u);var n=l.default.generateViewSchema(null,e.filterCollectionModel,"create",null,null,!0),i=this.view=new l.default.Dialog({el:"<div></div>",model:e.filterCollectionModel,schema:n});(0,r.default)(this.elements.body.childNodes[0]).addClass("alertify_tools_dialog_properties obj_properties"),t.append(i.render().$el),i.listenTo(i.model,"pgadmin-session:start",(function(){i.listenTo(i.model,"pgadmin-session:invalid",(function(t){e.statusBar.removeClass("d-none"),(0,r.default)(e.statusBar.find(".alert-text")).html(t),e.__internal.buttons[2].element.disabled=!0})),i.listenTo(i.model,"pgadmin-session:valid",(function(){e.statusBar.addClass("d-none"),(0,r.default)(e.statusBar.find(".alert-text")).html(""),e.__internal.buttons[2].element.disabled=!1}))})),i.listenTo(i.model,"pgadmin-session:stop",(function(){i.stopListening(i.model,"pgadmin-session:invalid"),i.stopListening(i.model,"pgadmin-session:valid")})),i.model.startNewSession(),i.model.get("data_sorting").add(u.data_sorting),(0,r.default)(e.showFilterProgress[0]).addClass("d-none")},callback:function(t){var n=this;if("dialog_help"==t.button.element.name)return t.cancel=!0,void s.default.Browser.showHelp(t.button.element.name,t.button.element.getAttribute("url"),null,null);if("ok"===t.button["data-btn-name"]){t.cancel=!0;var l=this.filterCollectionModel.toJSON();(0,r.default)(n.showFilterProgress[0]).removeClass("d-none"),d.default.put((0,i.default)("sqleditor.set_filter_data",{trans_id:e.transId}),l).then((function(t){(0,r.default)(n.showFilterProgress[0]).addClass("d-none");var i=t.data.data;i.status?setTimeout((function(){n.close(),o.default.success((0,a.default)("Filter updated successfully")),p.executeQuery(e)}),10):o.default.alert((0,a.default)("Validation Error"),i.result)})).catch((function(t){(0,r.default)(n.showFilterProgress[0]).addClass("d-none"),e.onExecuteHTTPError(t),setTimeout((function(){o.default.error(t)}),10)}))}else n.close()}}})),o.default.filterDialog(n).resizeTo(s.default.Browser.stdW.md,s.default.Browser.stdH.md)})).fail((function(t){(0,u.handleQueryToolAjaxError)(s.default,e,t,"_show_filter",[],!0)}))}};e.exports=h},function(e,t,n){"use strict";n(35),n(3),n(5),n(9),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={asc:(0,a.default)("ASC"),desc:(0,a.default)("DESC")},n=r.default.Browser.DataModel.extend({idAttribute:"name",defaults:{name:void 0,order:"asc"},schema:[{id:"name",name:"name",label:(0,a.default)("Column"),cell:"select2",editable:!0,cellHeaderClasses:"width_percent_60",headerCell:o.default.Extension.CustomHeaderCell,disabled:!1,control:"select2",select2:{allowClear:!1},options:function(){return i.default.map(e.column_list,(function(e){return{value:e,label:e}}))}},{id:"order",name:"order",label:(0,a.default)("Order"),control:"select2",cell:"select2",cellHeaderClasses:"width_percent_40",headerCell:o.default.Extension.CustomHeaderCell,editable:!0,deps:["type"],select2:{allowClear:!1},options:function(){return i.default.map(t,(function(e,t){return{value:t,label:e}}))}}],validate:function(){var e=null;return this.errorModel.clear(),i.default.isUndefined(this.get("name"))||i.default.isNull(this.get("name"))||""==String(this.get("name")).replace(/^\s+|\s+$/g,"")?(e=(0,a.default)("Please select a column."),this.errorModel.set("name",e),e):i.default.isUndefined(this.get("order"))||i.default.isNull(this.get("order"))||""==String(this.get("order")).replace(/^\s+|\s+$/g,"")?(e=(0,a.default)("Please select the order."),this.errorModel.set("order",e),e):null}});return new(r.default.Browser.DataModel.extend({idAttribute:"sql",defaults:{sql:e.sql||null},schema:[{id:"sql",label:(0,a.default)("SQL Filter"),cell:"string",type:"text",mode:["create"],control:s.default.SqlFieldControl.extend({render:function(){var e=s.default.SqlFieldControl.prototype.render.apply(this,arguments);return setTimeout((function(){e.sqlCtrl.focus()}),1e3),e}}),extraClasses:["custom_height_css_class"]},{id:"data_sorting",name:"data_sorting",label:(0,a.default)("Data Sorting"),model:n,editable:!0,type:"collection",mode:["create"],control:"unique-col-collection",uniqueCol:["name"],canAdd:!0,canEdit:!1,canDelete:!0,visible:!0,version_compatible:!0}],validate:function(){return null}}))};var a=l(n(2)),i=l(n(1)),r=l(n(4)),o=l(n(33)),s=l(n(17));function l(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";(function(t){n(8),n(40),n(37),n(10),n(36),n(61),n(5),n(29),n(9),n(46),n(7),n(38);var a=c(n(2)),i=c(n(6)),r=c(n(0)),o=c(n(13)),s=c(n(4)),l=c(n(17)),d=c(n(319));function c(e){return e&&e.__esModule?e:{default:e}}var u={dialog:function(e,n,c){var u=(0,i.default)("sqleditor.get_new_connection_data",{sid:e.url_params.sid,sgid:e.url_params.sgid});n&&(u+="?connect=1");var f=(0,a.default)("Connect to server");r.default.ajax({url:u,headers:{"Cache-Control":"no-cache"}}).done((function(n){var u=n.data.result;u.database_list=[],u.user_list=[],o.default.newConnectionDialog&&delete o.default.newConnectionDialog,o.default.dialog("newConnectionDialog",(function(){var n=(0,r.default)("<div class='new-connection-dialog'></div>");return{main:function(e){this.msg=e},build:function(){this.elements.content.appendChild(n.get(0)),o.default.pgDialogBuild.apply(this)},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-primary-icon pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:(0,a.default)("Help"),"aria-label":(0,a.default)("Help"),url:(0,i.default)("help.static",{filename:"query_tool.html"})}},{text:(0,a.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times pg-alertify-button","data-btn-name":"cancel"},{text:(0,a.default)("OK"),key:13,className:"btn btn-primary fa fa-check pg-alertify-button","data-btn-name":"ok"}],options:{title:f,padding:!1,overflow:!1,model:0,resizable:!0,maximizable:!1,pinnable:!1,closableByDimmer:!1,modal:!1,autoReset:!1,closable:!1}}},prepare:function(){var t=this;n.html(""),this.__internal.buttons[2].element.disabled=!0,this.statusBar=(0,r.default)('<div class=\'pg-prop-status-bar pg-el-xs-12 d-none\'>  <div class="error-in-footer">     <div class="d-flex px-2 py-1">       <div class="pr-2">         <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i>       </div>       <div class="alert-text" role="alert"></div>     </div>   </div> </div>').appendTo(n),this.showNewConnectionProgress=(0,r.default)('<div id="show_filter_progress" class="pg-sp-container sql-editor-busy-fetching d-none">\n                <div class="pg-sp-content">\n                    <div class="row"><div class="col-12 pg-sp-icon sql-editor-busy-icon"></div></div>\n                    <div class="row"><div class="col-12 pg-sp-text sql-editor-busy-text">'+(0,a.default)("Loading data...")+"</div></div>\n                </div>\n            </div>").appendTo(n),(0,r.default)(t.showNewConnectionProgress[0]).removeClass("d-none"),t.newConnCollectionModel=(0,d.default)(u,e.url_params.sgid,e.url_params.sid,e,t);var i=l.default.generateViewSchema(null,t.newConnCollectionModel,"create",null,null,!0),o=this.view=new l.default.Dialog({el:"<div></div>",model:t.newConnCollectionModel,schema:i});(0,r.default)(this.elements.body.childNodes[0]).addClass("alertify_tools_dialog_properties obj_properties"),n.append(o.render().$el),o.listenTo(o.model,"pgadmin-session:start",(function(){o.listenTo(o.model,"pgadmin-session:invalid",(function(e){t.statusBar.removeClass("d-none"),(0,r.default)(t.statusBar.find(".alert-text")).html(e),t.__internal&&(t.__internal.buttons[2].element.disabled=!0)})),o.listenTo(o.model,"pgadmin-session:valid",(function(){t.statusBar.addClass("d-none"),(0,r.default)(t.statusBar.find(".alert-text")).html(""),t.__internal&&(t.__internal.buttons[2].element.disabled=!1)}))})),o.listenTo(o.model,"pgadmin-session:stop",(function(){o.stopListening(o.model,"pgadmin-session:invalid"),o.stopListening(o.model,"pgadmin-session:valid")})),o.model.startNewSession(),(0,r.default)(t.showNewConnectionProgress[0]).addClass("d-none")},callback:function(n){if("dialog_help"==n.button.element.name)return n.cancel=!0,void s.default.Browser.showHelp(n.button.element.name,n.button.element.getAttribute("url"),null,null);if("ok"===n.button["data-btn-name"]){n.cancel=!0;var a=this.newConnCollectionModel.toJSON(),i=null;u.database_list.forEach((function(e){if(a.database==e.value)return i=e.label,!1}));var r,l=c.qt_tab_title_placeholder;l=l.replace(new RegExp("%DATABASE%"),i),r=l=(l=a.role?l.replace(new RegExp("%USERNAME%"),a.role):l.replace(new RegExp("%USERNAME%"),a.user)).replace(new RegExp("%SERVER%"),u.server_name),a.role||(a.role=null);var d=!0;if(e.gridView.connection_list.forEach((function(e){if(parseInt(e.server)==a.server&&parseInt(e.database)==a.database&&e.user==a.user&&e.role==a.role)return d=!1,!1})),d){var f={server_group:e.gridView.handler.url_params.sgid,server:a.server,database:a.database,title:t.escape(r),user:a.user,role:a.role,server_name:t.escape(u.server_name),database_name:t.escape(i),password:u.password,is_selected:!1};e.gridView.on_change_connection(f,this)}else{o.default.info("Connection with this configuration already present.")}}else o.default.newConnectionDialog().destroy()}}})),setTimeout((function(){o.default.newConnectionDialog("Connect to server.").resizeTo(s.default.Browser.stdW.md,s.default.Browser.stdH.md)}),500)})).fail((function(){o.default.alert().setting({title:(0,a.default)("Connection lost"),label:(0,a.default)("Ok"),message:(0,a.default)("Connection to the server has been lost."),onok:function(){window.close()}}).show()}))}};e.exports=u}).call(this,n(1))},function(e,t,n){"use strict";n(40),n(23),n(18),n(3),n(43),n(36),n(46),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,c,u){var f=s.default.Select2Control.extend({fetchData:function(){var e=this,n=e.field.get("url");n=(0,l.default)(n,{sid:e.model.attributes.server,sgid:t}),r.default.ajax({url:n,headers:{"Cache-Control":"no-cache"}}).done((function(t){var n=e.field.get("transform");if(t.data.status){var a=t.data.result.data;n&&i.default.isFunction(n)?e.field.set("options",n.bind(e,a)):e.field.set("options",a)}else n&&i.default.isFunction(n)?e.field.set("options",n.bind(e,[])):e.field.set("options",[]);s.default.Select2Control.prototype.render.apply(e,arguments)})).fail((function(e){var t="";t=404==e.status?"Unable to find url.":e.responseJSON.errormsg,d.default.error(t)}))},render:function(){return this.fetchData(),s.default.Select2Control.prototype.render.apply(this,arguments)},onChange:function(){s.default.Select2Control.prototype.onChange.apply(this,arguments)}});return new(o.default.Browser.DataModel.extend({idAttribute:"name",defaults:{server:parseInt(n),database:null,user:null,server_name:"",database_name:""},schema:[{id:"server",name:"server",label:(0,a.default)("Server"),type:"text",editable:!0,disabled:!1,select2:{allowClear:!1},transform:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({group:n,optval:e[n]});return t},control:s.default.Select2Control.extend({template:i.default.template(["<% if(label == false) {} else {%>",'  <label class="<%=Backform.controlLabelClassName%>"><%=label%></label>',"<% }%>",'<div class="<%=controlsClassName%>">'," <select class=\"<%=Backform.controlClassName%> <%=extraClasses.join(' ')%>\"",'  name="<%=name%>" value="<%-value%>" <%=disabled ? "disabled" : ""%>','  <%=required ? "required" : ""%><%= select2.multiple ? " multiple>" : ">" %>','  <%=select2.first_empty ? " <option></option>" : ""%>',"  <% for (var i=0; i < options.length; i++) {%>","   <% if (options[i].group) { %>","     <% var group = options[i].group; %>","     <% if (options[i].optval) { %> <% var option_length = options[i].optval.length; %>",'      <optgroup label="<%=group%>">',"      <% for (var subindex=0; subindex < option_length; subindex++) {%>","        <% var option = options[i].optval[subindex]; %>","        <option ","        <% if (option.image) { %> data-image=<%=option.image%> <%}%>","        <% if (option.connected) { %> data-connected=connected <%}%>","        value=<%- formatter.fromRaw(option.value) %>",'        <% if (option.selected) {%>selected="selected"<%} else {%>','        <% if (!select2.multiple && option.value === rawValue) {%>selected="selected"<%}%>','        <% if (select2.multiple && rawValue && rawValue.indexOf(option.value) != -1){%>selected="selected" data-index="rawValue.indexOf(option.value)"<%}%>',"        <%}%>",'        <%= disabled ? "disabled" : ""%>><%-option.label%></option>',"      <%}%>","      </optgroup>","     <%}%>","   <%} else {%>","     <% var option = options[i]; %>","     <option ","     <% if (option.image) { %> data-image=<%=option.image%> <%}%>","     <% if (option.connected) { %> data-connected=connected <%}%>","     value=<%- formatter.fromRaw(option.value) %>",'     <% if (option.selected) {%>selected="selected"<%} else {%>','     <% if (!select2.multiple && option.value === rawValue) {%>selected="selected"<%}%>','     <% if (select2.multiple && rawValue && rawValue.indexOf(option.value) != -1){%>selected="selected" data-index="rawValue.indexOf(option.value)"<%}%>',"     <%}%>",'     <%= disabled ? "disabled" : ""%>><%-option.label%></option>',"   <%}%>","  <%}%>"," </select>"," <% if (helpMessage && helpMessage.length) { %>",' <span class="<%=Backform.helpMessageClassName%>"><%=helpMessage%></span>'," <% } %>","</div>"].join("\n")),connect:function(t){var n=t;d.default.connectServer&&delete d.default.connectServer,d.default.dialog("connectServer",(function(){return{main:function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.set("title",e),this.message=t,this.server_id=n,this.submit_password=a,this.connect_server=i},setup:function(){return{buttons:[{text:(0,a.default)("Cancel"),className:"btn btn-secondary fa fa-times pg-alertify-button",key:27},{text:(0,a.default)("OK"),key:13,className:"btn btn-primary fa fa-check pg-alertify-button"}],focus:{element:"#password",select:!0},options:{modal:0,resizable:!1,maximizable:!1,pinnable:!1}}},build:function(){},prepare:function(){this.setContent(this.message)},callback:function(t){var i=(0,r.default)("#show_filter_progress");if(t.button.text==(0,a.default)("OK"))if(this.submit_password){var o=(0,l.default)("sqleditor.connect_server",{sid:this.server_id});i.removeClass("d-none"),r.default.ajax({type:"POST",timeout:3e4,url:o,data:(0,r.default)("#frmPassword").serialize()}).done((function(){n.model.attributes.database=null,n.model.attributes.user=null,n.model.attributes.role=null,s.default.Select2Control.prototype.onChange.apply(n,arguments),Object.keys(e.server_list).forEach((function(t){e.server_list[t].forEach((function(t){t.value==n.getValueFromDOM()&&(e.server_name=t.label)}))})),i.addClass("d-none"),d.default.connectServer().destroy()})).fail((function(e){i.addClass("d-none"),d.default.connectServer().destroy(),d.default.connectServer("Connect to server",e.responseJSON.result,n.getValueFromDOM())}))}else Object.keys(this.connect_server).length>0?(this.connect_server.password=(0,r.default)("#password").val(),this.connect_server.is_selected=!1,c.gridView.on_change_connection(this.connect_server,u,!1),(i=(0,r.default)("#fetching_data")).addClass("d-none")):(e.password=(0,r.default)("#password").val(),i.addClass("d-none"));else n.model.attributes.database=null,n.model.attributes.user=null,n.model.attributes.role=null,s.default.Select2Control.prototype.onChange.apply(n,arguments),i.addClass("d-none"),d.default.connectServer().destroy();t.close=!0}}}))},render:function(){var t=this;t.connect(t),Object.keys(e.server_list).forEach((function(t){e.server_list[t].forEach((function(t){t.value==parseInt(n)&&(e.server_name=t.label)}))}));var a=t.field.get("transform")||t.defaults.transform;return a&&i.default.isFunction(a)?t.field.set("options",a.bind(t,e.server_list)):t.field.set("options",e.server_list),s.default.Select2Control.prototype.render.apply(t,arguments)},onChange:function(){this.model.attributes.database=null,this.model.attributes.user=null;var t=this;t.connect(t);var n=(0,l.default)("sqleditor.connect_server",{sid:t.getValueFromDOM(),usr:t.model.attributes.user}),a=(0,r.default)("#show_filter_progress");a.removeClass("d-none"),r.default.ajax({url:n,type:"POST",headers:{"Cache-Control":"no-cache"}}).done((function(){s.default.Select2Control.prototype.onChange.apply(t,arguments),Object.keys(e.server_list).forEach((function(n){e.server_list[n].forEach((function(n){n.value==t.getValueFromDOM()&&(e.server_name=n.label)}))})),a.addClass("d-none")})).fail((function(e){a.addClass("d-none"),d.default.connectServer("Connect to server",e.responseJSON.result,t.getValueFromDOM())}))}})},{id:"database",name:"database",label:(0,a.default)("Database"),type:"text",editable:!0,disabled:function(e){var t=this;return!(!i.default.isUndefined(e.get("server"))&&!i.default.isNull(e.get("server"))&&""!==e.get("server"))||(setTimeout((function(){t.options.length&&e.set("database",t.options[0].value)}),10),!1)},deps:["server"],url:"sqleditor.get_new_connection_database",select2:{allowClear:!1,width:"100%",first_empty:!0,select_first:!1},extraClasses:["new-connection-dialog-style"],control:f,transform:function(t){return e.database_list=t,t}},{id:"user",name:"user",label:(0,a.default)("User"),type:"text",editable:!0,deps:["server"],select2:{allowClear:!1,width:"100%"},control:f,url:"sqleditor.get_new_connection_user",disabled:function(e){var t=this;return!(!i.default.isUndefined(e.get("server"))&&!i.default.isNull(e.get("server"))&&""!==e.get("server"))||(setTimeout((function(){t.options.length&&e.set("user",t.options[0].value)}),10),!1)}},{id:"role",name:"role",label:(0,a.default)("Role"),type:"text",editable:!0,deps:["server"],select2:{allowClear:!1,width:"100%",first_empty:!0},control:f,url:"sqleditor.get_new_connection_role",disabled:!1}],validate:function(){var e=null;return this.errorModel.clear(),i.default.isUndefined(this.get("database"))||i.default.isNull(this.get("database"))?(e=(0,a.default)("Please select database"),this.errorModel.set("database",e),e):i.default.isUndefined(this.get("database"))||i.default.isUndefined(this.get("user"))||i.default.isNull(this.get("user"))?(e=(0,a.default)("Please select user"),this.errorModel.set("user",e),e):null}}))};var a=c(n(2)),i=c(n(1)),r=c(n(0)),o=c(n(4)),s=c(n(17)),l=c(n(6)),d=c(n(13));function c(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";(function(t){n(177),n(15),n(14),n(23),n(35),n(382),n(384),n(12),n(36),n(19),n(16),n(7);var a=o(n(2)),i=n(332),r=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}var s=null,l=null,d={panel_closed:!0,go_for_render:function(e,n,a,i){var o=this;if(o.map_component||(o.map_component=function(){var e={radius:4,weight:3},n={closeButton:!1,minWidth:260,maxWidth:300,maxHeight:300},a=(0,r.default)('<div class="geometry-viewer-container"></div>'),i=s.map(a.get(0),{preferCanvas:!0}).setZoom(0);i.attributionControl.setPrefix("");var o=s.geoJSON([],{style:{weight:2},pointToLayer:function(t,n){return s.circleMarker(n,e)}});o.addTo(i);var l={Empty:s.tileLayer(""),Street:s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>'}),Topography:s.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>, &copy; <a href="http://viewfinderpanoramas.org" target="_blank">SRTM</a>, &copy; <a href="https://opentopomap.org" target="_blank">OpenTopoMap</a>'}),"Gray Style":s.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>, &copy; <a href="http://cartodb.com/attributions" target="_blank">CartoDB</a>',subdomains:"abcd",maxZoom:19}),"Light Color":s.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>, &copy; <a href="http://cartodb.com/attributions" target="_blank">CartoDB</a>',subdomains:"abcd",maxZoom:19}),"Dark Matter":s.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>, &copy; <a href="http://cartodb.com/attributions" target="_blank">CartoDB</a>',subdomains:"abcd",maxZoom:19})},d=s.control.layers(l),c=l.Street,u=t.values(l),f=s.control({position:"topright"});f.onAdd=function(){return this._div=s.DomUtil.create("div","geometry-viewer-info-control"),this._div},f.update=function(e){this._div.innerHTML=e};var p=function(){i.options.crs!==s.CRS.EPSG3857&&(i.options.crs=s.CRS.EPSG3857,d.addTo(i),i.addLayer(c),a.addClass("geometry-viewer-container-plain-background"),i.setMinZoom(0))},h=function(){i.options.crs!==s.CRS.Simple&&(i.options.crs=s.CRS.Simple,d.remove(),t.each(u,(function(e){i.hasLayer(e)&&(c=e,e.remove())})),a.removeClass("geometry-viewer-container-plain-background"))};return h(),p(),{mapContainer:a,clearMap:function(){i.closePopup(),f.remove(),o.clearLayers()},loseFocus:function(){i.fire("blur")},renderMap:function(e){var t=e.geoJSONs,a=e.selectedSRID,r=e.getPopupContent,l=e.infoList,c=!1;0===t.length&&(c=!0);try{o.addData(t)}catch(e){l.push("An error occurred while rendering data."),c=!0}var u=o.getBounds();if(u.isValid()||(c=!0),l.length>0){i.options.crs===s.CRS.EPSG3857?(d.remove(),f.addTo(i),d.addTo(i)):f.addTo(i);var _=function(e){return e.join("<br>")}(l);f.update(_)}if(c)return h(),void i.setView([0,0],i.getZoom());if("function"==typeof r){o.eachLayer((function(e){e.bindPopup((function(){return r(e.feature.geometry)}),n)}))}u=u.pad(.1);var g=Math.max(u.getNorth()-u.getSouth(),u.getEast()-u.getWest());if(4326===a)p();else if(h(),g>=180){var m=Math.floor(Math.log2(360/g))-2;i.setMinZoom(m)}else i.setMinZoom(0);g>0?i.fitBounds(u):i.setView(u.getCenter(),i.getZoom())},resizeMap:function(){setTimeout((function(){i.invalidateSize()}),10)}}}()),o.panel_closed){var d=window.wcDocker,u=e.gridView.geometry_viewer=e.gridView.docker.addPanel("geometry_viewer",d.DOCK.STACKED,e.gridView.data_output_panel);(0,r.default)("#geometry_viewer_panel")[0].appendChild(o.map_component.mapContainer.get(0)),o.panel_closed=!1,u.on(d.EVENT.CLOSED,(function(){(0,r.default)("#geometry_viewer_panel").empty(),o.map_component.clearMap(),o.panel_closed=!0})),u.on(d.EVENT.RESIZE_ENDED,(function(){u.isVisible()&&o.map_component.resizeMap()})),u.on(d.EVENT.VISIBILITY_CHANGED,(function(e){e?o.map_component.resizeMap():o.map_component.loseFocus()}))}e.gridView.geometry_viewer.focus(),o.map_component.clearMap();var f=c(n,a,i,l);o.map_component.renderMap(f)},render_geometries:function(e,t,a,i){var r=this;n.e(14).then(function(o){s=n(215),l=n(216).Geometry,r.go_for_render(e,t,a,i)}.bind(null,n)).catch((function(e){throw e}))},add_header_button:function(e){e.header={buttons:[{cssClass:"div-view-geometry-column",tooltip:"View all geometries in this column",showOnHover:!1,command:"view-geometries",content:'<button class="btn-xs btn-primary"><i class="fa fa-eye" aria-hidden="true"></i></button>'}]}},parse_data:c};function c(e,n,r,o){var s=n[r].field,l=[],d=[],c=[],u=[],f=new Map,p=!1,h=0,_=!1,g=!1;if(0===e.length)return u.push("Empty row."),{geoJSONs:[],selectedSRID:0,getPopupContent:void 0,infoList:u};if(t.every(e,(function(e){try{var t=e[s],n=i.Buffer.from(t,"hex"),a=o.parse(n);if(a.hasZ)l.push(a);else{if((h+=n.byteLength)>20971520)return _=!0,!1;if(d.length>=1e5)return g=!0,!1;a.srid||(a.srid=0),d.push(a),f.set(a,e)}}catch(t){c.push(e)}return!0})),(_||g)&&u.push(d.length+" of "+e.length+" geometries rendered."),l.length>0&&u.push((0,a.default)("3D geometries not rendered.")),c.length>0&&u.push((0,a.default)("Unsupported geometries not rendered.")),0===d.length)return{geoJSONs:[],selectedSRID:0,getPopupContent:void 0,infoList:u};var m=t.groupBy(d,"srid"),b=t.pairs(m);b.length>1&&(p=!0);var v,y=t.max(b,(function(e){return e[1].length})),w=parseInt(y[0]),x=y[1],C=t.map(x,(function(e){return e.toGeoJSON()}));return n.length>=3&&(v=function(e){var a=x[C.indexOf(e)];return function(e,n,a){for(var i='<table class="table table-bordered table-striped view-geometry-property-table"><tbody>',r=1;r<n.length;r++)if(r!==a){var o=n[r];i+="<tr><th>"+o.display_name+"</th>";var s=e[o.field];t.isUndefined(s)&&o.has_default_val?i+='<td class="td-disabled">[default]</td>':t.isUndefined(s)&&o.not_null||t.isUndefined(s)||null===s?i+='<td class="td-disabled">[null]</td>':i+="<td>"+s+"</td>",i+="</tr>"}return i+="</tbody></table>"}(f.get(a),n,r)}),p&&u.push((0,a.default)("Geometries with non-SRID %s not rendered.",w)),{geoJSONs:C,selectedSRID:w,getPopupContent:v,infoList:u}}e.exports=d}).call(this,n(1))},function(e,t,n){"use strict";(function(e){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}n(48),n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.historyList=e.sortBy(n,(function(e){return e.start_time})),this.onAdd((function(){}))}var n,i,r;return n=t,(i=[{key:"length",value:function(){return this.historyList.length}},{key:"add",value:function(t){var n=e.sortedIndex(this.historyList,t,(function(e){return e.start_time}));this.historyList.splice(n,0,t),this.onAddHandler(t)}},{key:"reset",value:function(){this.historyList=[],this.onResetHandler(this.historyList)}},{key:"onAdd",value:function(e){this.onAddHandler=e}},{key:"onReset",value:function(e){this.onResetHandler=e}}])&&a(n.prototype,i),r&&a(n,r),t}();t.default=i}).call(this,n(1))},function(e,t,n){"use strict";n(21),n(41),n(40),n(35),n(18),n(70),n(3),n(34),n(71),n(43),n(46),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=l(n(323)),i=n(324),r=l(n(385)),o=l(n(2)),s=l(n(0));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var p=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentNode=t,this.histCollection=n,this.editorPref={},this.onCopyToEditorHandler=function(){},this.histCollection.onAdd(this.onAddEntry.bind(this)),this.histCollection.onReset(this.onResetEntries.bind(this))}var t,n,l;return t=e,(n=[{key:"focus",value:function(){this.queryHistEntries&&this.queryHistEntries.focus()}},{key:"onAddEntry",value:function(e){1==this.histCollection.length()?this.render():this.queryHistEntries&&this.queryHistEntries.addEntry(e)}},{key:"onResetEntries",value:function(){this.isRendered=!1,this.queryHistEntries=null,this.queryHistDetails=null,this.render()}},{key:"onCopyToEditorClick",value:function(e){this.onCopyToEditorHandler=e,this.queryHistDetails&&this.queryHistDetails.onCopyToEditorClick(this.onCopyToEditorHandler)}},{key:"setEditorPref",value:function(e){this.editorPref=c(c({},this.editorPref),e),this.queryHistDetails&&this.queryHistDetails.setEditorPref(this.editorPref)}},{key:"render",value:function(){var e=this;if(0==this.histCollection.length())this.parentNode.empty().removeClass("d-flex").append('<div role="status" class="pg-panel-message">'+(0,o.default)("No history found")+"</div>");else{this.parentNode.empty().addClass("d-flex");var t=(0,s.default)("<div><div>").appendTo(this.parentNode),n=(0,s.default)("<div><div>").appendTo(this.parentNode);(0,r.default)([t[0],n[0]],{gutterSize:1,cursor:"ew-resize"}),this.queryHistDetails=new a.default(n),this.queryHistDetails.setEditorPref(this.editorPref),this.queryHistDetails.onCopyToEditorClick(this.onCopyToEditorHandler),this.queryHistDetails.render(),this.queryHistEntries=new i.QueryHistoryEntries(t),this.queryHistEntries.onSelectedChange(function(t){e.queryHistDetails.setEntry(t)}.bind(this)),this.queryHistEntries.render(),this.histCollection.historyList.map((function(t){e.queryHistEntries.addEntry(t)}))}}}])&&f(t.prototype,n),l&&f(t,l),e}();t.default=p},function(e,t,n){"use strict";n(21),n(31),n(41),n(8),n(40),n(18),n(70),n(3),n(34),n(71),n(43),n(5),n(68),n(46),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=l(n(84)),i=l(n(119)),r=l(n(2)),o=l(n(0)),s=l(n(1));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parentNode=t,this.isCopied=!1,this.timeout=null,this.isRendered=!1,this.sqlFontSize=null,this.onCopyToEditorHandler=function(){},this.editorPref={sql_font_size:"1em",copy_to_editor:!0}}var t,n,l;return t=e,(n=[{key:"setEntry",value:function(e){this.entry=e,this.isRendered?this.selectiveRender():this.render()}},{key:"setEditorPref",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.editorPref=c(c({},this.editorPref),e),this.query_codemirror&&!s.default.isUndefined(e.sql_font_size)&&((0,o.default)(this.query_codemirror.getWrapperElement()).css("font-size",this.editorPref.sql_font_size),this.query_codemirror.refresh()),this.$copyToEditor&&!s.default.isUndefined(e.copy_to_editor)&&(e.copy_to_editor?this.$copyToEditor.removeClass("d-none"):this.$copyToEditor.addClass("d-none"))}},{key:"parseErrorMessage",value:function(e){return e.match(/ERROR:\s*([^\n\r]*)/i)?e.match(/ERROR:\s*([^\n\r]*)/i)[1]:e}},{key:"formatDate",value:function(e){return e.toLocaleDateString()+" "+e.toLocaleTimeString()}},{key:"copyAllHandler",value:function(){var e=this;i.default.copyTextToClipboard(this.entry.query),this.clearPreviousTimeout(),this.updateCopyButton(!0),this.timeout=setTimeout((function(){e.updateCopyButton(!1)}),1500)}},{key:"onCopyToEditorClick",value:function(e){this.onCopyToEditorHandler=e}},{key:"clearPreviousTimeout",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}},{key:"updateCopyButton",value:function(e){e?(this.$copyBtn.addClass("was-copied").removeClass("copy-all"),this.$copyBtn.text((0,r.default)("Copied!"))):(this.$copyBtn.addClass("copy-all").removeClass("was-copied"),this.$copyBtn.text((0,r.default)("Copy")))}},{key:"updateQueryMetaData",value:function(){var e=function(e,t){return e?"<div class='item'>\n                  <span class='value'>".concat(e,"</span>\n                  <span class='description'>").concat(t,"</span>\n              </div>"):""};this.$metaData.empty().append('<div class="metadata">'+e(this.formatDate(this.entry.start_time),(0,r.default)("Date"))+e(this.entry.row_affected.toLocaleString(),(0,r.default)("Rows Affected"))+e(this.entry.total_time,(0,r.default)("Duration"))+"</div>")}},{key:"updateMessageContent",value:function(){this.$message_content.empty().append("<pre class='content-value'>".concat(s.default.escape(this.entry.message),"</pre>"))}},{key:"updateErrorMessage",value:function(){this.entry.status?(this.$errMsgBlock.addClass("d-none"),this.$errMsgBlock.empty()):(this.$errMsgBlock.removeClass("d-none"),this.$errMsgBlock.empty().append("<div class='history-error-text'>\n            <span>"+(0,r.default)("Error Message")+"</span> ".concat(s.default.escape(this.parseErrorMessage(this.entry.message)),"\n        </div>")))}},{key:"updateInfoMessage",value:function(){this.entry.info?(this.$infoMsgBlock.removeClass("d-none"),this.$infoMsgBlock.empty().append("<div class='history-info-text'>\n            ".concat(this.entry.info,"\n        </div>"))):(this.$infoMsgBlock.addClass("d-none"),this.$infoMsgBlock.empty())}},{key:"selectiveRender",value:function(){this.updateErrorMessage(),this.updateInfoMessage(),this.updateCopyButton(!1),this.updateQueryMetaData(),this.query_codemirror.setValue(this.entry.query),this.updateMessageContent()}},{key:"render",value:function(){var e=this;this.entry&&(this.parentNode.empty().append("<div id='query_detail' class='query-detail'>\n            <div class='error-message-block'></div>\n            <div class='info-message-block'></div>\n            <div class='metadata-block'></div>\n            <div class='query-statement-block'>\n              <div id='history-detail-query'>\n                <button class='btn-copy' tabindex=0 accesskey='y'></button>\n                <button class='btn-copy-editor copy-to-editor' tabindex=0 accesskey='y'>"+(0,r.default)("Copy to Query Editor")+"</button>\n                <div></div>\n              </div>\n            </div>\n            <div>\n              <hr class='block-divider'/>\n            </div>\n            <div class='message-block'>\n              <div class='message'>\n                <div class='message-header'>"+(0,r.default)("Messages")+"</div>\n                <div class='content'></div>\n              </div>\n            </div>\n        </div>"),this.$errMsgBlock=this.parentNode.find(".error-message-block"),this.$infoMsgBlock=this.parentNode.find(".info-message-block"),this.$copyBtn=this.parentNode.find("#history-detail-query .btn-copy"),this.$copyBtn.off("click").on("click",this.copyAllHandler.bind(this)),this.$copyToEditor=this.parentNode.find("#history-detail-query .btn-copy-editor"),this.$copyToEditor.off("click").on("click",(function(){e.onCopyToEditorHandler(e.entry.query)})),this.$copyToEditor.addClass(this.editorPref.copy_to_editor?"":"d-none"),this.$metaData=this.parentNode.find(".metadata-block"),this.query_codemirror=(0,a.default)(this.parentNode.find("#history-detail-query div")[0],{tabindex:-1,mode:"text/x-pgsql",readOnly:!0}),(0,o.default)(this.query_codemirror.getWrapperElement()).css("font-size",this.editorPref.sql_font_size),this.$message_content=this.parentNode.find(".message-block .content"),this.isRendered=!0,this.selectiveRender())}}])&&f(t.prototype,n),l&&f(t,l),e}();t.default=p},function(e,t,n){"use strict";n(31),n(8),n(15),n(35),n(18),n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.QueryHistoryEntries=t.QueryHistoryItem=t.QueryHistoryEntryDateGroup=void 0;var a=s(n(116)),i=s(n(0)),r=s(n(1));n(193);var o=s(n(2));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function c(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}var u=function(){function e(t,n){l(this,e),this.date=t,this.formatString="MMM DD YYYY",this.groupKey=n}return c(e,[{key:"getDatePrefix",value:function(){var e="";return this.isDaysBefore(0)?e="Today - ":this.isDaysBefore(1)&&(e="Yesterday - "),e}},{key:"getDateFormatted",value:function(e){return e.toLocaleDateString()}},{key:"isDaysBefore",value:function(e){return this.getDateFormatted(this.date)===this.getDateFormatted((0,a.default)().subtract(e,"days").toDate())}},{key:"render",value:function(){return(0,i.default)("<div class='query-group' data-key='".concat(this.groupKey,"'>\n            <div class='date-label'>").concat(this.getDatePrefix()).concat(this.getDateFormatted(this.date),"</div>\n            <ul class='query-entries'></ul>\n        </div>"))}}]),e}();t.QueryHistoryEntryDateGroup=u;var f=function(){function e(t){l(this,e),this.entry=t,this.$el=null,this.onClickHandler=null}return c(e,[{key:"onClick",value:function(e){var t=this;this.onClickHandler=e,this.$el&&this.$el.off("click").on("click",(function(e){t.onClickHandler((0,i.default)(e.currentTarget))}))}},{key:"formatDate",value:function(e){return(0,a.default)(e).format("HH:mm:ss")}},{key:"dataKey",value:function(){return this.formatDate(this.entry.start_time)}},{key:"render",value:function(e){var t=this;this.$el=(0,i.default)("<li class='list-item' tabindex='0' data-key='".concat(this.dataKey(),"'>\n          <div class='entry ").concat(this.entry.status?"":"error",'\'>\n              <div class=\'query\'>\n                  <span id="query_source_icon" class="query-history-icon sql-icon-lg"></span>\n                  ').concat(r.default.escape(this.entry.query),"\n              </div>\n              <div class='other-info'>\n              <div class='timestamp'>").concat(this.formatDate(this.entry.start_time),"</div>\n              </div>\n          </div>\n      </li>")).data("entrydata",this.entry).on("click",(function(e){t.onClickHandler((0,i.default)(e.currentTarget))}));var n=this.entry.query_source;n&&this.$el.find("#query_source_icon").addClass(n.ICON_CSS_CLASS).attr("role","img"),this.entry.is_pgadmin_query&&(this.$el.addClass("pgadmin-query-history-entry"),e||this.$el.addClass("d-none"))}}]),e}();t.QueryHistoryItem=f;var p=function(){function e(t){l(this,e),this.parentNode=t,this.$selectedItem=null,this.groupKeyFormat="YYYY MM DD",this.$el=null,this.is_pgadmin_queries_shown=null}return c(e,[{key:"onSelectedChange",value:function(e){this.onSelectedChangeHandler=e}},{key:"focus",value:function(){this.$selectedItem||this.setSelectedListItem(this.$entriesEl.find(".list-item").first()),this.$selectedItem.trigger("click"),this.$entriesEl.focus()}},{key:"isArrowDown",value:function(e){return 40===(e.keyCode||e.which)}},{key:"isArrowUp",value:function(e){return 38===(e.keyCode||e.which)}},{key:"navigateUpAndDown",value:function(e){var t=[38,40],n=e.keyCode||e.which;return!(t.indexOf(n)>-1)||(e.preventDefault(),this.onKeyDownHandler(e),!1)}},{key:"onKeyDownHandler",value:function(e){if(this.isArrowDown(e))if(this.$selectedItem.next().length>0)this.setSelectedListItem(this.$selectedItem.next());else{var t=this.$selectedItem.closest(".query-group");t.next().length>0&&this.setSelectedListItem(t.next().find(".list-item").first())}else if(this.isArrowUp(e))if(this.$selectedItem.prev().length>0)this.setSelectedListItem(this.$selectedItem.prev());else{var n=this.$selectedItem.closest(".query-group");n.prev().length>0&&this.setSelectedListItem(n.prev().find(".list-item").last())}}},{key:"onSelectListItem",value:function(e){this.setSelectedListItem((0,i.default)(e.currentTarget))}},{key:"dateAsGroupKey",value:function(e){return(0,a.default)(e).format(this.groupKeyFormat)}},{key:"setSelectedListItem",value:function(e){this.$selectedItem&&this.$selectedItem.removeClass("selected"),e.addClass("selected"),this.$selectedItem=e,this.$selectedItem[0].scrollIntoView({block:"center"}),this.onSelectedChangeHandler&&this.onSelectedChangeHandler(this.$selectedItem.data("entrydata"))}},{key:"addEntry",value:function(e){var t=this.$entriesEl.find(".query-group"),n=i.default.map(t,(function(e){return(0,i.default)(e).attr("data-key")})),a=this.dateAsGroupKey(e.start_time),o=r.default.indexOf(n,a),s=null;if(0==t.length)s=new u(e.start_time,a).render(),this.$entriesEl.prepend(s);else if(o<0&&0!=t.length){s=new u(e.start_time,a).render();for(var l=0;l<n.length;){if(a>n[l]){s.insertBefore(t[l]);break}l++}l==n.length&&this.$entriesEl.append(s)}else o>=0&&(s=(0,i.default)(t[o]));var d=new f(e);if(d.onClick(this.setSelectedListItem.bind(this)),d.render(this.is_pgadmin_queries_shown),!r.default.isUndefined(s)){var c=s.find(".query-entries").find(".list-item"),p=0;if(c.length>0)for(;p<c.length;){if(d.$el.attr("data-key")>(0,i.default)(c[p]).attr("data-key")){(0,i.default)(d.$el).insertBefore(c[p]);break}(0,i.default)(d.$el).insertAfter(c[p]),p++}else s.find(".query-entries").append(d.$el)}this.setSelectedListItem(d.$el)}},{key:"toggleGeneratedQueries",value:function(){this.$el.find(".pgadmin-query-history-entry").each((function(){(0,i.default)(this).toggleClass("d-none")})),this.is_pgadmin_queries_shown=!this.is_pgadmin_queries_shown}},{key:"render",value:function(){var e=this;e.$el=(0,i.default)('\n        <div class="toggle-and-history-container">\n            <div class="query-history-toggle">\n                <label class="control-label" for="generated-queries-toggle">\n                    '+(0,o.default)("Show queries generated internally by pgAdmin?")+'\n                </label>\n                <input id="generated-queries-toggle" type="checkbox"\n                  class="pgadmin-controls" data-style="quick"\n                  data-size="mini" data-on="'+(0,o.default)("Yes")+'" data-off="'+(0,o.default)("No")+"\"\n                  data-onstyle=\"success\" data-offstyle=\"ternary\" checked>\n            </div>\n            <div id='query_list' class='query-history' tabindex='0'></div>\n        </div>\n    "),e.$entriesEl=e.$el.find("#query_list"),e.$entriesEl.on("keydown",this.navigateUpAndDown.bind(this)),e.is_pgadmin_queries_shown=!0,e.$el.find("#generated-queries-toggle").bootstrapToggle().change((function(){e.toggleGeneratedQueries()})),e.parentNode.empty().append(e.$el)}}]),e}();t.QueryHistoryEntries=p},function(e,t,n){"use strict";n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.QuerySources=void 0;t.QuerySources={EXECUTE:{ICON_CSS_CLASS:"fa fa-play"},EXPLAIN:{ICON_CSS_CLASS:"fa fa-hand-pointer"},EXPLAIN_ANALYZE:{ICON_CSS_CLASS:"fa fa-list-alt"},COMMIT:{ICON_CSS_CLASS:"icon-commit"},ROLLBACK:{ICON_CSS_CLASS:"icon-rollback"},SAVE_DATA:{ICON_CSS_CLASS:"icon-save-data-changes"},VIEW_DATA:{ICON_CSS_CLASS:"icon-view-data"}}},function(e,t,n){"use strict";n(8);var a=s(n(2)),i=s(n(33)),r=s(n(20)),o=s(n(13));function s(e){return e&&e.__esModule?e:{default:e}}var l=r.default.Model.extend({defaults:{recorded_time:void 0,event:void 0,pid:void 0,payload:void 0},schema:[{id:"recorded_time",label:(0,a.default)("Recorded time"),cell:"string",type:"text",editable:!1,cellHeaderClasses:"width_percent_20",headerCell:i.default.Extension.CustomHeaderCell},{id:"channel",label:(0,a.default)("Event"),cell:"string",type:"text",editable:!1,cellHeaderClasses:"width_percent_20",headerCell:i.default.Extension.CustomHeaderCell},{id:"pid",label:(0,a.default)("Process ID"),cell:"string",type:"text",editable:!1,cellHeaderClasses:"width_percent_20",headerCell:i.default.Extension.CustomHeaderCell},{id:"payload",label:(0,a.default)("Payload"),cell:"string",type:"text",editable:!1,cellHeaderClasses:"width_percent_40",headerCell:i.default.Extension.CustomHeaderCell}]}),d=r.default.Collection.extend({model:l}),c={collection:null,renderNotificationsGrid:function(e){c.collection||(c.collection=new d);var t=[{name:"recorded_time",label:(0,a.default)("Recorded time"),type:"text",editable:!1,cell:"string"},{name:"channel",label:(0,a.default)("Event"),type:"text",editable:!1,cell:"string"},{name:"pid",label:(0,a.default)("Process ID"),type:"text",editable:!1,cell:"string"},{name:"payload",label:(0,a.default)("Payload"),type:"text",editable:!1,cell:"string"}],n=new i.default.Grid({emptyText:(0,a.default)("No data found"),columns:t,collection:c.collection,className:"backgrid presentation table table-bordered table-hover table-noouter-border table-bottom-border"});e&&e.$container.find(".sql-editor-notifications").append(n.render().el)},updateNotifications:function(e){if(null!=e&&e.length>0){for(var t in e){var n="";n=""!=e[t].payload?(0,a.default)('Asynchronous notification "%s" with payload "%s" received from server process with PID %s',e[t].channel,e[t].payload,e[t].pid):(0,a.default)('Asynchronous notification "%s" received from server process with PID %s',e[t].channel,e[t].pid),o.default.info(n)}c.collection.add(e)}}};e.exports=c},function(e,t,n){"use strict";n(27),n(3),Object.defineProperty(t,"__esModule",{value:!0}),t.callRenderAfterPoll=function(e,t,n){if(e.query_end_time=new Date,e.rows_affected=n.rows_affected,e.has_more_rows=n.has_more_rows,function(e){return null!=e.colinfo}(n))e._render(n);else{e.total_time=(0,i.calculateQueryRunTime)(e.query_start_time,e.query_end_time);var a=(0,r.default)("Query returned successfully in %s.",e.total_time);n.result?n.result+="\n\n"+a:n.result=a,e.update_msg_history(!0,n.result,!1),e.reset_data_store(),function(e){return e.info_notifier_timeout>=0}(e)&&t.success(a,e.info_notifier_timeout)}(function(e){return e.is_query_tool})(e)&&e.disable_tool_buttons(!1);e.setIsQueryRunning(!1),e.trigger("pgadmin-sqleditor:loading-icon:hide")};var a,i=n(183),r=(a=n(2))&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n(21),n(24),n(25),n(8),n(14),n(18),n(3),n(34),n(12),n(19),n(44),n(16),n(7),Object.defineProperty(t,"__esModule",{value:!0}),t.updateUIPreferences=function(e){var t=e.$el,n=e.preferences;e.handler.slickgrid&&(e.handler.slickgrid.CSVOptions={quoting:e.preferences.results_grid_quoting,quote_char:e.preferences.results_grid_quote_char,field_separator:e.preferences.results_grid_field_separator});t.find("#btn-load-file").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Open File"),n.btn_open_file)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Open File"),n.btn_open_file)).attr("accesskey",(0,i.shortcut_key)(n.btn_open_file)),t.find("#btn-save-file").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Save File"),n.btn_save_file)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Save File"),n.btn_save_file)).attr("accesskey",(0,i.shortcut_key)(n.btn_save_file)),t.find("#btn-find-menu-dropdown").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Find"),n.btn_find_options)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Find"),n.btn_find_options)).attr("accesskey",(0,i.shortcut_key)(n.btn_find_options)),t.find("#btn-copy-row").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Copy"),n.btn_copy_row)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Copy"),n.btn_copy_row)).attr("accesskey",(0,i.shortcut_key)(n.btn_copy_row)),t.find("#btn-paste-row").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Paste"),n.btn_paste_row)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Paste"),n.btn_paste_row)).attr("accesskey",(0,i.shortcut_key)(n.btn_paste_row)),t.find("#btn-delete-row").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Delete"),n.btn_delete_row)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Delete"),n.btn_delete_row)).attr("accesskey",(0,i.shortcut_key)(n.btn_delete_row)),t.find("#btn-filter").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Filter"),n.btn_filter_dialog)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Filter"),n.btn_filter_dialog)).attr("accesskey",(0,i.shortcut_key)(n.btn_filter_dialog)),t.find("#btn-filter-dropdown").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Filter options"),n.btn_filter_options)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Filter options"),n.btn_filter_options)).attr("accesskey",(0,i.shortcut_key)(n.btn_filter_options)),t.find("#btn-rows-limit").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Rows limit"),n.btn_rows_limit)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Rows limit"),n.btn_rows_limit)).attr("accesskey",(0,i.shortcut_key)(n.btn_rows_limit)),t.find("#btn-query-dropdown").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Execute options"),n.btn_execute_options)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Execute options"),n.btn_execute_options)).attr("accesskey",(0,i.shortcut_key)(n.btn_execute_options)),t.find("#btn-cancel-query").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Cancel query"),n.btn_cancel_query)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Cancel query"),n.btn_cancel_query)).attr("accesskey",(0,i.shortcut_key)(n.btn_cancel_query)),t.find("#btn-clear-dropdown").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Clear"),n.btn_clear_options)).attr("aria-label",(0,i.shortcut_accesskey_title)((0,s.default)("Clear"),n.btn_clear_options)).attr("accesskey",(0,i.shortcut_key)(n.btn_clear_options)),t.find("#btn-conn-status").attr("accesskey",(0,i.shortcut_key)(n.btn_conn_status)).find("i").attr("title",(0,i.shortcut_accesskey_title)((0,s.default)("Connection status (click for details)"),n.btn_conn_status)),t.find("#btn-flash").attr("title",(0,i.shortcut_title)((0,s.default)("Execute/Refresh"),n.execute_query)).attr("aria-label",(0,i.shortcut_title)((0,s.default)("Execute/Refresh"),n.execute_query)),t.find("#btn-explain").attr("title",(0,i.shortcut_title)((0,s.default)("Explain"),n.explain_query)).attr("aria-label",(0,i.shortcut_title)((0,s.default)("Explain"),n.explain_query)),t.find("#btn-explain-analyze").attr("title",(0,i.shortcut_title)((0,s.default)("Explain Analyze"),n.explain_analyze_query)).attr("aria-label",(0,i.shortcut_title)((0,s.default)("Explain Analyze"),n.explain_analyze_query)),t.find("#btn-download").attr("title",(0,i.shortcut_title)((0,s.default)("Download as CSV/TXT"),n.download_csv)).attr("aria-label",(0,i.shortcut_title)((0,s.default)("Download as CSV/TXT"),n.download_csv)),t.find("#btn-save-data").attr("title",(0,i.shortcut_title)((0,s.default)("Save Data Changes"),n.save_data)).attr("aria-label",(0,i.shortcut_title)((0,s.default)("Save Data Changes"),n.save_data)),t.find("#btn-commit").attr("title",(0,i.shortcut_title)((0,s.default)("Commit"),n.commit_transaction)).attr("aria-label",(0,i.shortcut_title)((0,s.default)("Commit"),n.commit_transaction)),t.find("#btn-rollback").attr("title",(0,i.shortcut_title)((0,s.default)("Rollback"),n.rollback_transaction)).attr("aria-label",(0,i.shortcut_title)((0,s.default)("Rollback"),n.rollback_transaction)),t.find("#btn-show-query-tool").attr("title",(0,i.shortcut_title)((0,s.default)("Query tool"),n.show_query_tool)).attr("aria-label",(0,i.shortcut_title)((0,s.default)("Query tool"),n.show_query_tool)),n.explain_verbose?t.find(".explain-verbose").removeClass("visibility-hidden"):t.find(".explain-verbose").addClass("visibility-hidden");n.explain_costs?t.find(".explain-costs").removeClass("visibility-hidden"):t.find(".explain-costs").addClass("visibility-hidden");n.explain_buffers?t.find(".explain-buffers").removeClass("visibility-hidden"):t.find(".explain-buffers").addClass("visibility-hidden");n.explain_timing?t.find(".explain-timing").removeClass("visibility-hidden"):t.find(".explain-timing").addClass("visibility-hidden");n.explain_summary?t.find(".explain-summary").removeClass("visibility-hidden"):t.find(".explain-summary").addClass("visibility-hidden");n.explain_settings?t.find(".explain-settings").removeClass("visibility-hidden"):t.find(".explain-settings").addClass("visibility-hidden");null!=e.connIntervalId&&(clearInterval(e.connIntervalId),e.connIntervalId=null);if(n.connection_status){var a=t.find("#btn-conn-status"),l=a.find("i");a.popover(),a.removeClass("connection-status-hide"),r.fetchConnectionStatus(e.handler,a,l),e.connIntervalId=setInterval(r.fetchConnectionStatus.bind(null,e.handler,a,l),1e3*n.connection_status_fetch_time)}else t.find("#btn-conn-status").addClass("connection-status-hide");var d=r.calcFontSize(n.sql_font_size);(0,o.default)(e.query_tool_obj.getWrapperElement()).css("font-size",d),n.plain_editor_mode?(e.query_tool_obj.setOption("mode","text/plain"),e.query_tool_obj.setOption("foldGutter",!1)):(e.query_tool_obj.setOption("mode","gpdb"===e.handler.server_type?"text/x-gpsql":"text/x-pgsql"),e.query_tool_obj.setOption("foldGutter",n.code_folding));e.query_tool_obj.setOption("foldGutter",n.code_folding),e.query_tool_obj.setOption("indentWithTabs",!n.use_spaces),e.query_tool_obj.setOption("indentUnit",n.tab_size),e.query_tool_obj.setOption("tabSize",n.tab_size),e.query_tool_obj.setOption("lineWrapping",n.wrap_code),e.query_tool_obj.setOption("autoCloseBrackets",n.insert_pair_brackets),e.query_tool_obj.setOption("matchBrackets",n.brace_matching),e.query_tool_obj.refresh(),e.historyComponent.setEditorPref({sql_font_size:d})};var i=n(78),r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(63)),o=l(n(0)),s=l(n(2));function l(e){return e&&e.__esModule?e:{default:e}}function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}},function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i,r,o,s;n(21),n(24),n(25),n(14),n(27),n(12),n(61),n(5),n(29),n(19),n(9),n(16),i=Object.prototype.toString,r=Function.prototype.toString,o=/^\[object .+?Constructor\]$/,s=RegExp("^"+String(i).replace(/[.*+?^${}()|[\]\/\\]/g,"\\$&").replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),e.exports=function(e){var t=a(e);return"function"==t?s.test(r.call(e)):e&&"object"==t&&o.test(i.call(e))||!1}},function(e,t,n){"use strict";n(31),n(41),n(8),n(37),n(10),n(7),n(38);var a=f(n(2)),i=f(n(6)),r=f(n(0)),o=f(n(1)),s=f(n(13)),l=f(n(4)),d=f(n(17)),c=f(n(331)),u=f(n(54));function f(e){return e&&e.__esModule?e:{default:e}}var p={dialog:function(e){var t=(0,a.default)("Manage Macros");s.default.macroDialog&&delete s.default.macroDialog,s.default.dialog("macroDialog",(function(){var n=(0,r.default)("<div class='macro_dialog'></div>");return{main:function(){this.set("title",'<i class="fa fa-scroll sql-icon-lg" aria-hidden="true" role="img"></i> '+(0,a.default)("Manage Macros"))},build:function(){this.elements.content.appendChild(n.get(0)),s.default.pgDialogBuild.apply(this)},setup:function(){return{buttons:[{text:"",key:112,className:"btn btn-primary-icon pull-left fa fa-question pg-alertify-icon-button",attrs:{name:"dialog_help",type:"button",label:(0,a.default)("Help"),"aria-label":(0,a.default)("Help"),url:(0,i.default)("help.static",{filename:"query_tool.html"})}},{text:(0,a.default)("Cancel"),key:27,className:"btn btn-secondary fa fa-times pg-alertify-button","data-btn-name":"cancel"},{text:(0,a.default)("Save"),className:"btn btn-primary fa fa-save pg-alertify-button","data-btn-name":"ok"}],options:{title:t,padding:!1,overflow:!1,model:0,resizable:!0,maximizable:!0,pinnable:!1,closableByDimmer:!1,modal:!1,autoReset:!1}}},hooks:{onclose:function(){this.view&&(this.macroCollectionModel.stopSession(),this.view.model.stopSession(),this.view.remove({data:!0,internal:!0,silent:!0}))}},prepare:function(){var t=this;n.html(""),this.statusBar=(0,r.default)('<div class=\'pg-prop-status-bar pg-el-xs-12 d-none\'>  <div class="error-in-footer">     <div class="d-flex px-2 py-1">       <div class="pr-2">         <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true"></i>       </div>       <div class="alert-text" role="alert"></div>     </div>   </div> </div>').appendTo(n),this.showFilterProgress=(0,r.default)('<div id="show_filter_progress" class="pg-sp-container sql-editor-busy-fetching d-none">\n              <div class="pg-sp-content">\n                  <div class="row"><div class="col-12 pg-sp-icon sql-editor-busy-icon"></div></div>\n                  <div class="row"><div class="col-12 pg-sp-text sql-editor-busy-text">'+(0,a.default)("Loading data...")+"</div></div>\n              </div>\n          </div>").appendTo(n),t.macroCollectionModel=(0,c.default)(e.transId);var i=d.default.generateViewSchema(null,t.macroCollectionModel,"edit",null,null,!0),s=d.default.Dialog.extend({template:{panel:o.default.template('<div role="tabpanel" tabindex="-1" class="tab-pane <%=label%> <%=tabPanelCodeClass%> pg-el-sm-12 pg-el-md-12 pg-el-lg-12 pg-el-12 fade" id="<%=cId%>"></div>')},render:function(){this.cleanup();var e=this.model,t=this.controls,n=this.template,a=this,i=100*this.tabIndex;this.$el.empty().attr("role","tabpanel").attr("class",o.default.result(this,"tabPanelClassName")),e.panelEl=this.$el;var s=(0,r.default)('<div class="tab-content pg-el-sm-12 pg-el-md-12 pg-el-lg-12 pg-el-12 macro-tab"></div>').appendTo(this.$el);return o.default.each(this.schema,(function(l){if(i++,l.version_compatible&&(d=l.visible,c=l,u=e,o.default.isFunction(d)?d.apply(c,[u]):d)){var d,c,u,f=(0,r.default)(n.panel(o.default.extend(l,{tabIndex:i,tabPanelCodeClass:l.tabPanelCodeClass?l.tabPanelCodeClass:""}))).appendTo(s).removeClass("collapse").addClass("collapse");l.fields.each((function(n){var r=new(n.get("control"))({field:n,model:e,dialog:a,tabIndex:i});f.append(r.render().$el),t.push(r)}))}})),s.find(".tab-pane").first().addClass("active show"),this}}),l=t.view=new s({el:"<div></div>",model:t.macroCollectionModel,schema:i});t.macroCollectionModel.fetch({success:function(){n.append(t.view.render().$el),t.view.listenTo(t.view.model,"pgadmin-session:start",(function(){t.view.listenTo(t.view.model,"pgadmin-session:invalid",(function(e){t.statusBar.removeClass("d-none"),(0,r.default)(t.statusBar.find(".alert-text")).html(e),t.__internal.buttons[2].element.disabled=!0})),l.listenTo(t.view.model,"pgadmin-session:valid",(function(){t.statusBar.addClass("d-none"),(0,r.default)(t.statusBar.find(".alert-text")).html(""),t.__internal.buttons[2].element.disabled=!1}))})),l.listenTo(t.view.model,"pgadmin-session:stop",(function(){l.stopListening(t.view.model,"pgadmin-session:invalid"),l.stopListening(t.view.model,"pgadmin-session:valid")})),t.view.model.startNewSession()}}),(0,r.default)(this.elements.body.childNodes[0]).addClass("alertify_tools_dialog_properties obj_properties")},callback:function(t){var n=this;if("dialog_help"==t.button.element.name)return t.cancel=!0,void l.default.Browser.showHelp(t.button.element.name,t.button.element.getAttribute("url"),null,null);if("ok"===t.button["data-btn-name"]){t.cancel=!0;var d=n.view.model.get("macro").toJSON(!0);if(null==d||null==d)return void n.close();u.default.put((0,i.default)("sqleditor.set_macros",{trans_id:e.transId}),d).then((function(t){(0,r.default)(n.showFilterProgress[0]).addClass("d-none");var i=t;i.status?setTimeout((function(){var t=n.view.model.get("macro").toJSON().filter((function(e){return void 0!==e.name||null!==e.name}));e.macros=t;var i='\n                      <li>\n                          <a class="dropdown-item" id="btn-manage-macros" href="#" tabindex="0">\n                              <span> '.concat((0,a.default)("Manage Macros..."),' </span>\n                          </a>\n                      </li>\n                      <li class="dropdown-divider"></li>');o.default.each(t,(function(e){e.name&&(i+='<li>\n                        <a class="dropdown-item btn-macro" data-macro-id="'.concat(e.id,'" href="#" tabindex="0">\n                            <span> ').concat(o.default.escape(e.name)," </span>\n                            <span> (").concat(e.key_label,") </span>\n                        </a>\n                       </li>"))})),(0,r.default)(r.default.find("div.btn-group.mr-1.user_macros ul.dropdown-menu")).html((0,r.default)(i)),n.close(),s.default.success((0,a.default)("Macro updated successfully"))}),10):s.default.alert((0,a.default)("Validation Error"),i.result)})).catch((function(e){(0,r.default)(n.showFilterProgress[0]).addClass("d-none"),setTimeout((function(){s.default.error(e.response.data.errormsg)}),10)}))}else n.close()}}})),s.default.macroDialog(t).resizeTo(l.default.Browser.stdW.calc(l.default.Browser.stdW.lg),l.default.Browser.stdH.calc(l.default.Browser.stdH.lg))}};e.exports=p},function(e,t,n){"use strict";n(8),n(15),n(37),n(10),n(3),n(38),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=i.default.Browser.DataModel.extend({idAttribute:"id",defaults:{id:void 0,key:void 0,name:void 0,sql:void 0,key_label:void 0},schema:[{id:"key_label",name:"key_label",label:(0,a.default)("Key"),type:"text",cell:"string",editable:!1,cellHeaderClasses:"width_percent_10",headerCell:o.default.Extension.CustomHeaderCell,disabled:!1},{id:"name",name:"name",label:(0,a.default)("Name"),cell:"string",type:"text",editable:!0,cellHeaderClasses:"width_percent_20",headerCell:o.default.Extension.CustomHeaderCell,disabled:!1},{id:"sql",name:"sql",label:(0,a.default)("SQL"),cell:o.default.Extension.SqlCell,type:"multiline",control:r.default.SqlCodeControl,editable:!0,cellHeaderClasses:"width_percent_70",headerCell:o.default.Extension.CustomHeaderCell,disabled:!1}],validate:function(){var e=null;return this.errorModel.clear(),d.default.isEmpty(this.get("name"))&&!d.default.isEmpty(this.get("sql"))?(e=(0,a.default)("Please enter macro name."),this.errorModel.set("name",e),e):d.default.isEmpty(this.get("sql"))&&!d.default.isEmpty(this.get("name"))?(e=(0,a.default)("Please enter macro sql."),this.errorModel.set("sql",e),e):null}});return new(i.default.Browser.DataModel.extend({defaults:{macro:void 0},urlRoot:(0,s.default)("sqleditor.get_macros",{trans_id:e}),schema:[{id:"macro",name:"macro",label:(0,a.default)("Macros"),model:t,editable:!0,type:"collection",control:r.default.SubNodeCollectionControl.extend({showGridControl:function(e){var t=(0,l.default)("<div class='pgadmin-control-group backgrid form-group pg-el-12 object subnode'></div>"),n=e.subnode.schema?e.subnode:e.subnode.prototype,s=r.default.generateGridColumnsFromModel(e.node_info,n,this.field.get("mode"),e.columns,e.schema_node);this.grid&&this.grid.remove(),(e.disabled||0==e.canAdd)&&(0,l.default)(t).find("button.add").remove(),s.columns.unshift({name:"pg-backform-clear",label:'<i aria-label="'+(0,a.default)("Clear row")+'" class="fa fa-eraser" title="'+(0,a.default)("Clear row")+'"></i>',cell:o.default.Extension.ClearCell,editable:!1,cell_priority:-1,sortable:!1,headerCell:o.default.Extension.CustomHeaderCell.extend({className:"header-icon-cell",events:{click:"clearrAll"},clearrAll:function(e){e.preventDefault();var t=this;c.default.confirm((0,a.default)("Clear All Rows"),(0,a.default)("Are you sure you wish to clear all rows?"),(function(){d.default.each(t.collection.toJSON(),(function(e){t.collection.get(e.id).set({name:null,sql:null})}))}),(function(){return!0}))},render:function(){this.$el.empty();var e=this.column,t=(0,l.default)('<button type="button" title="'+(0,a.default)("Clear row")+'" aria-label="Clear row" aria-expanded="false" tabindex="0">').html(e.get("label")).append("<span class='sort-caret' aria-hidden='true'></span>");return this.$el.append(t),this.$el.addClass(e.get("name")),this.$el.addClass(e.get("direction")),this.$el.attr("role","columnheader"),this.$el.attr("aria-label","columnheader"),this.$el.attr("alt","columnheader"),this.delegateEvents(),this}})});var u=this.model.get(e.name);u||(u=new i.default.Browser.Node.Collection(null,{handler:this.model.handler||this.model,model:e.model,top:this.model.top||this.model,silent:!0}),this.model.set(e.name,u,{silent:!0}));u.on("enteringEditMode",(function(e){var t=this,n=e[0];this.each((function(e){if(n.model!=e){var a=t.indexOf(e);if(a>-1){var i=f.body.rows[a].$el.find(".subnode-edit-in-process").parent();if(i.length>0){var r=new Event("click");i[0].dispatchEvent(r)}}}}))}),u);var f=this.grid=new o.default.Grid({columns:s.columns,collection:u,row:this.row,className:"backgrid table presentation table-bordered table-noouter-border table-hover"}),p=f.render().$el;return t.append(p)}}),columns:["key_label","name","sql"],visible:!0}],validate:function(){return null}}))};var a=u(n(2)),i=u(n(4)),r=u(n(17)),o=u(n(33)),s=u(n(6)),l=u(n(0)),d=u(n(1)),c=u(n(13));function u(e){return e&&e.__esModule?e:{default:e}}}]).default}));